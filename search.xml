<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Configuration</title>
    <url>/blog/posts/169cee22.html</url>
    <content><![CDATA[<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><h2 id="Restart-Policy"><a href="#Restart-Policy" class="headerlink" title="Restart Policy"></a>Restart Policy</h2><p>To configure the restart policy for a container, use the <code>--restart</code> flag when using the <code>docker run</code> command. The value of the <code>--restart</code> flag can be any of the following:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>no</code></td>
<td>Do not automatically restart the container. (the default)</td>
</tr>
<tr>
<td><code>on-failure[:max-retries]</code></td>
<td>Restart the container if it exits due to an error, which manifests as a non-zero exit code. Optionally, limit the number of times the Docker daemon attempts to restart the container using the <code>:max-retries</code> option.</td>
</tr>
<tr>
<td><code>always</code></td>
<td>Always restart the container if it stops. If it is manually stopped, it is restarted only when Docker daemon restarts or the container itself is manually restarted. (See the second bullet listed in <a href="https://docs.docker.com/config/containers/start-containers-automatically/#restart-policy-details">restart policy details</a>)</td>
</tr>
<tr>
<td><code>unless-stopped</code></td>
<td>Similar to <code>always</code>, except that when the container is stopped (manually or otherwise), it is not restarted even after Docker daemon restarts.</td>
</tr>
</tbody></table>
<p>The following example starts a Redis container and configures it to always restart unless it is explicitly stopped or Docker is restarted.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --restart unless-stopped redis</span><br></pre></td></tr></table></figure>

<p>This command changes the restart policy for an already running container named <code>redis</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker update --restart unless-stopped redis</span><br></pre></td></tr></table></figure>

<p>And this command will ensure all currently running containers will be restarted unless stopped.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker update --restart unless-stopped $(docker ps -q)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>config</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker Commands</title>
    <url>/blog/posts/f0401bdf.html</url>
    <content><![CDATA[<h1 id="Docker-Commands"><a href="#Docker-Commands" class="headerlink" title="Docker Commands"></a>Docker Commands</h1><h2 id="docker-logs"><a href="#docker-logs" class="headerlink" title="docker logs"></a>docker logs</h2><p> 查看日志 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker logs &lt;container&gt;</span><br><span class="line">docker logs -f &lt;container&gt;</span><br></pre></td></tr></table></figure>

<p> 查看某段时间的日志 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker logs -f -t --since=&quot;2022-08-12&quot; --tail=100 &lt;container&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>cmd</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Image Overview</title>
    <url>/blog/posts/3af1ecff.html</url>
    <content><![CDATA[<h4 id="Start-a-mysql-server-instance"><a href="#Start-a-mysql-server-instance" class="headerlink" title="Start a mysql server instance"></a>Start a <code>mysql</code> server instance</h4><p>Starting a MySQL instance is simple:</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run --name some-mysql -p33060:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br></pre></td></tr></table></figure>

<p>where <code>some-mysql</code> is the name you want to assign to your container, <code>my-secret-pw</code> is the password to be set for the MySQL root user and <code>tag</code> is the tag specifying the MySQL version you want. See the list above for relevant tags.</p>
<h4 id="Using-a-custom-MySQL-configuration-file"><a href="#Using-a-custom-MySQL-configuration-file" class="headerlink" title="Using a custom MySQL configuration file"></a>Using a custom MySQL configuration file</h4><p>The default configuration for MySQL can be found in <code>/etc/mysql/my.cnf</code>, which may <code>!includedir</code> additional directories such as <code>/etc/mysql/conf.d</code> or <code>/etc/mysql/mysql.conf.d</code>. Please inspect the relevant files and directories within the <code>mysql</code> image itself for more details.</p>
<p>If <code>/my/custom/config-file.cnf</code> is the path and name of your custom configuration file, you can start your <code>mysql</code> container like this (note that only the directory path of the custom config file is used in this command):</p>
<figure class="highlight console"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br></pre></td></tr></table></figure>

<p>This will start a new container <code>some-mysql</code> where the MySQL instance uses the combined startup settings from <code>/etc/mysql/my.cnf</code> and <code>/etc/mysql/conf.d/config-file.cnf</code>, with settings from the latter taking precedence.</p>
<h4 id="Creating-database-dumps"><a href="#Creating-database-dumps" class="headerlink" title="Creating database dumps"></a>Creating database dumps</h4><p>Most of the normal tools will work, although their usage might be a little convoluted in some cases to ensure they have access to the <code>mysqld</code> server. A simple way to ensure this is to use <code>docker exec</code> and run the tool from the same container, similar to the following:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec some-mysql sh -c &#x27;exec mysqldump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#x27; &gt; /some/path/on/your/host/all-databases.sql</span><br></pre></td></tr></table></figure>

<h4 id="Restoring-data-from-dump-files"><a href="#Restoring-data-from-dump-files" class="headerlink" title="Restoring data from dump files"></a>Restoring data from dump files</h4><p>For restoring data. You can use <code>docker exec</code> command with <code>-i</code> flag, similar to the following:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -i some-mysql sh -c &#x27;exec mysql -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#x27; &lt; /some/path/on/your/host/all-databases.sql</span><br></pre></td></tr></table></figure>

<p>For more information, please visit <a href="https://hub.docker.com/_/mysql">Quick reference</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
        <tag>ref</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle Image Overview</title>
    <url>/blog/posts/c27f44b8.html</url>
    <content><![CDATA[<h4 id="Default-setting"><a href="#Default-setting" class="headerlink" title="Default setting"></a>Default setting</h4><p>Database located in <code>/u01/app/oracle</code> folder</p>
<p><strong>OS users:</strong><br>root&#x2F;welcome<br>oracle&#x2F;oracle</p>
<p><strong>DB users:</strong><br>sys&#x2F;oacle<br>system&#x2F;oracle</p>
<p><strong>ENV:</strong><br>ORACLE_SID&#x3D;orcl<br>CHARACTERSET&#x3D;ZHS16GBK</p>
<h4 id="Start-a-oracle-server-instance"><a href="#Start-a-oracle-server-instance" class="headerlink" title="Start a oracle server instance"></a>Start a <code>oracle</code> server instance</h4><p>Starting a Oracle 11g instance is simple:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --privileged --name oracle-11g -p 15210:1521 -v /unzipped-database-folder:/install oracle:tag</span><br></pre></td></tr></table></figure>

<h4 id="Using-database-datapump"><a href="#Using-database-datapump" class="headerlink" title="Using database datapump"></a>Using database datapump</h4><p>Optionally you can map dpdump folder to easy upload dumps:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --privileged --name oracle-11g -p 15210:1521 -v /unzipped-database-folder:/install -v /datapump-folder:/datapump oracle:tag</span><br></pre></td></tr></table></figure>

<p>To execute expdp&#x2F;impdp just use docker exec command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -i oracle-11g expdp ...</span><br></pre></td></tr></table></figure>

<p>For more information, please visit <a href="https://github.com/Jove-2761781/docker-images/tree/main/oracle/11.2.0.4">Quick reference</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
        <tag>ref</tag>
      </tags>
  </entry>
  <entry>
    <title>Default Management Information</title>
    <url>/blog/posts/864c4f.html</url>
    <content><![CDATA[<h1 id="Default-Management-Information"><a href="#Default-Management-Information" class="headerlink" title="Default Management Information"></a>Default Management Information</h1><h2 id="DELLEMC"><a href="#DELLEMC" class="headerlink" title="DELLEMC"></a>DELLEMC</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>VNX</td>
<td>Management<br>Maintenance</td>
<td>1.1.1.1-2&#x2F;24<br>128.221.1.250-251&#x2F;29</td>
<td>admin&#x2F;password</td>
</tr>
<tr>
<td>PowerEdge</td>
<td>Management</td>
<td>192.168.0.120&#x2F;24</td>
<td>root&#x2F;calvin</td>
</tr>
</tbody></table>
<h2 id="Hitachi"><a href="#Hitachi" class="headerlink" title="Hitachi"></a>Hitachi</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>HUS</td>
<td>Management<br>Maintenance</td>
<td>192.168.0.16-17&#x2F;24<br>10.0.0.16-17&#x2F;24</td>
<td>system&#x2F;manager</td>
</tr>
<tr>
<td>SVP</td>
<td>Management</td>
<td>10.0.0.100&#x2F;24</td>
<td>SVP-PC\SVP&#x2F;raid-login</td>
</tr>
<tr>
<td>VSP</td>
<td>Management</td>
<td>192.168.0.16-17&#x2F;24</td>
<td>maintenance&#x2F;raid-maintenance</td>
</tr>
</tbody></table>
<h2 id="HPE"><a href="#HPE" class="headerlink" title="HPE"></a>HPE</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>ProLiant</td>
<td>Management</td>
<td>192.168.1.2&#x2F;24</td>
<td>See server tag</td>
</tr>
<tr>
<td>MSA System</td>
<td>Management</td>
<td>10.0.0.2-3&#x2F;24</td>
<td>manage&#x2F;!manage</td>
</tr>
</tbody></table>
<h2 id="Lenovo"><a href="#Lenovo" class="headerlink" title="Lenovo"></a>Lenovo</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>System x</td>
<td>Management</td>
<td>192.168.70.125&#x2F;24</td>
<td>USERID&#x2F;PASSW0RD</td>
</tr>
</tbody></table>
<h2 id="IBM"><a href="#IBM" class="headerlink" title="IBM"></a>IBM</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>System x</td>
<td>Management</td>
<td>192.168.70.125&#x2F;24</td>
<td>USERID&#x2F;PASSW0RD</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hardware</category>
      </categories>
  </entry>
  <entry>
    <title>Oracle ILOM</title>
    <url>/blog/posts/fc09a157.html</url>
    <content><![CDATA[<h1 id="Oracle-ILOM"><a href="#Oracle-ILOM" class="headerlink" title="Oracle ILOM"></a>Oracle ILOM</h1><h2 id="Assigning-a-Static-IP-Address-to-the-SP"><a href="#Assigning-a-Static-IP-Address-to-the-SP" class="headerlink" title="Assigning a Static IP Address to the SP"></a>Assigning a Static IP Address to the SP</h2><h3 id="Log-In-to-the-SP-SER-MGT-Port"><a href="#Log-In-to-the-SP-SER-MGT-Port" class="headerlink" title="Log In to the SP (SER MGT Port)"></a>Log In to the SP (SER MGT Port)</h3><div class="note info modern"><p>a. Configure a terminal or terminal emulator with these settings: <font color=info>9600 baud, 8 bits, No parity, 1 Stop bit, No handshake</font>.<br>b. Default user <code>root</code> and password <code>changeme</code>.</p>
</div>

<p>Use the <code>password</code> command to change the root password</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="built_in">set</span> /SP/users/root password</span></span><br></pre></td></tr></table></figure>

<h3 id="Assign-a-Static-IP-Address-to-the-NET-MGT-Port"><a href="#Assign-a-Static-IP-Address-to-the-NET-MGT-Port" class="headerlink" title="Assign a Static IP Address to the NET MGT Port"></a>Assign a Static IP Address to the NET MGT Port</h3><p>If you plan to connect to the SP through its NET MGT port, the SP must have a valid IP address.<br>By default, the server is configured to obtain an IP address from DHCP services in your network. If the network your server is connected to does not support DHCP for IP addressing, perform this procedure.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="built_in">set</span> /SP/network pendingipdiscovery=static</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="built_in">set</span> /SP/network pendingipaddress=192.168.10.100</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="built_in">set</span> /SP/network pendingipgateway=192.168.10.1</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="built_in">set</span> /SP/network pendingipnetmask=255.255.255.0</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">show /SP/network -display properties</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="built_in">set</span> /SP/network commitpending=<span class="literal">true</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Check-for-Faults"><a href="#Check-for-Faults" class="headerlink" title="Check for Faults"></a>Check for Faults</h2><h3 id="show-faulty-Command"><a href="#show-faulty-Command" class="headerlink" title="show faulty Command"></a><code>show faulty</code> Command</h3><p>At the Oracle ILOM prompt, type the show faulty command.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">show faulty</span></span><br></pre></td></tr></table></figure>

<h3 id="fmadm-faulty-Command"><a href="#fmadm-faulty-Command" class="headerlink" title="fmadm faulty Command"></a><code>fmadm faulty</code> Command</h3><ol>
<li><p>At the Oracle ILOM prompt, access the faultmgmt shell.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">start /SP/faultmgmt/shell</span></span><br><span class="line">Are you sure you want to start /SP/faultmgmt/shell (y/n)? y</span><br></pre></td></tr></table></figure>
</li>
<li><p>At the faultmgmtsp&gt; prompt, enter the fmadm faulty command.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">faultmgmtsp&gt; </span><span class="language-bash">fmadm faulty</span></span><br><span class="line"><span class="meta prompt_">faultmgmtsp&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Hardware</category>
      </categories>
      <tags>
        <tag>ilom</tag>
      </tags>
  </entry>
  <entry>
    <title>RedHat Developer Subscription</title>
    <url>/blog/posts/13a70f47.html</url>
    <content><![CDATA[<h1 id="RedHat-Developer-Subscription"><a href="#RedHat-Developer-Subscription" class="headerlink" title="RedHat Developer Subscription"></a>RedHat Developer Subscription</h1><p> 进入开发者社区，注册并填写相关信息。</p>
<p><a href="https://developers.redhat.com/">https://developers.redhat.com/</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>OSI</title>
    <url>/blog/posts/1a11e44c.html</url>
    <content><![CDATA[<h1 id="OSI- 参考模型"><a href="#OSI- 参考模型" class="headerlink" title="OSI 参考模型"></a>OSI 参考模型</h1><p><img src="https://pic2.zhimg.com/v2-1dd6e1ed2f348db47ce0cde38d545ae9_r.jpg"></p>
<blockquote>
<p><strong>传输层 </strong>: 源端口号 2 字节，目的端口号 2 字节，SYN 和 ACK 各 1 比特<br><strong> 网络层 </strong>: 源 IP 地址 4 字节，目的 IP 地址 4 字节，PROTOCOL 字段 1 字节<br><strong>PROTOCOL 字段</strong>: 1(ICMP), 6(TCP), 17(UDP), 88(EIGRP), 89(OSPF)<br><strong> 数据链路层</strong>: 源 MAC 地址 6 字节，目的 MAC 地址 6 字节，TYPE 字段 2 字节<br><strong>TYPE 字段</strong>: 0x0800(IPv4), 0x0806(ARP), 0x08dd(IPv6)</p>
</blockquote>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>osi</tag>
      </tags>
  </entry>
  <entry>
    <title>Preconfig</title>
    <url>/blog/posts/c6e82ea8.html</url>
    <content><![CDATA[<h1 id="Preconfig"><a href="#Preconfig" class="headerlink" title="Preconfig"></a>Preconfig</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">enable</span><br><span class="line">configure terminal</span><br><span class="line">line console 0</span><br><span class="line">no exec-timeout</span><br><span class="line">logging synchronous</span><br><span class="line">no ip domain lookup</span><br><span class="line">hostname</span><br></pre></td></tr></table></figure>

<p><strong>save config</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">copy running-config startup-config</span></span><br><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">write</span></span><br></pre></td></tr></table></figure>

<p><strong>erase config</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">erase startup-config</span></span><br><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">erase nvram:</span></span><br><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">write erase</span></span><br></pre></td></tr></table></figure>

<p><strong>filter strings</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">show running-config | include 0/0</span></span><br><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">show running-config | section 0/0</span></span><br></pre></td></tr></table></figure>

<p><strong>telnet mode</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">SW1# </span><span class="language-bash">conf t</span></span><br><span class="line"><span class="meta prompt_">SW1(config)# </span><span class="language-bash">line vty 0 4</span></span><br><span class="line"><span class="meta prompt_">SW1(config-line)# </span><span class="language-bash">transport input telnet</span></span><br><span class="line"><span class="meta prompt_">SW1(config-line)# </span><span class="language-bash">password welcome</span></span><br><span class="line"><span class="meta prompt_">SW1(config-line)# </span><span class="language-bash">login</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>config</tag>
      </tags>
  </entry>
  <entry>
    <title>Butterfly 主题美化配置</title>
    <url>/blog/posts/584538d8.html</url>
    <content><![CDATA[<h1 id="Butterfly 主题美化配置"><a href="#Butterfly 主题美化配置" class="headerlink" title="Butterfly 主题美化配置"></a>Butterfly 主题美化配置 </h1><h2 id="自定义文件结构"><a href="# 自定义文件结构" class="headerlink" title="自定义文件结构"></a> 自定义文件结构</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+--- css</span><br><span class="line">|   +--- custom.styl</span><br><span class="line">|   +--- _custom</span><br><span class="line">|   |   +--- background.css</span><br><span class="line">|   |   +--- font.css</span><br><span class="line">+--- font</span><br><span class="line">|   +--- CascadiaMono.woff2</span><br><span class="line">|   +--- ZhuZiAWan.woff2</span><br><span class="line">+--- img</span><br><span class="line">|   +--- avatar.jpg</span><br><span class="line">+--- js</span><br></pre></td></tr></table></figure>

<p>在 <code>/blog_root/source</code> 中创建 <code>css/font/js</code> 目录，在 css 目录中创建 _custom 用于存放自定义 css 文件。<br>创建 custom.styl 文件，添加如下内容:</p>
<figure class="highlight styl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;_custom/*.css&#x27;</span></span><br></pre></td></tr></table></figure>

<p>修改主题配置文件，添加 inject 参数</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span></span><br><span class="line"><span class="comment"># 插入代码到头部 &lt;/head&gt; 之前 和 底部 &lt;/body&gt; 之前</span></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/blog/css/custom.css&quot;</span> <span class="string">media=&quot;defer&quot;</span> <span class="string">onload=&quot;this.media=&#x27;all&#x27;&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="comment"># - &lt;script src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="设置主题背景"><a href="# 设置主题背景" class="headerlink" title="设置主题背景"></a>设置主题背景 </h2><h3 id="一图流"><a href="# 一图流" class="headerlink" title="一图流"></a> 一图流 </h3><p> 修改主题配置文件<code>_config.butterfly.yml</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">default_top_img:</span> <span class="string">transparent</span></span><br><span class="line"><span class="attr">background:</span> <span class="string">url(/blog/img/background.jpg)</span></span><br><span class="line"><span class="attr">footer_bg:</span> <span class="string">transparent</span></span><br></pre></td></tr></table></figure>

<p>创建自定义 <code>css</code> 文件</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 首页文章卡片 */</span></span><br><span class="line"><span class="selector-id">#recent-posts</span> &gt; <span class="selector-class">.recent-post-item</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 首页侧栏卡片 */</span></span><br><span class="line"><span class="selector-class">.card-widget</span>&#123;</span><br><span class="line"><span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>)<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 文章页面正文背景 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#post</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 分页页面 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#page</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 归档页面 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#archive</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 标签页面 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#tag</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 分类页面 */</span></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-id">#category</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 页脚透明 */</span></span><br><span class="line"><span class="selector-id">#footer</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 头图透明 */</span></span><br><span class="line"><span class="selector-id">#page-header</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 白天模式伪类遮罩层透明 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span></span><br><span class="line">  <span class="selector-id">#footer</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: transparent<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span></span><br><span class="line">  <span class="selector-id">#page-header</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: transparent<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/* 夜间模式伪类遮罩层透明 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-id">#footer</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: transparent<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-id">#page-header</span><span class="selector-pseudo">::before</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent<span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 夜间模式页面背景设置为半透明 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-class">.recent-post-item</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-id">#aside-content</span> <span class="selector-class">.card-widget</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#post</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#page</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#archive</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#tag</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-tag">div</span><span class="selector-id">#category</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/* 阅读模式 */</span></span><br><span class="line"><span class="selector-class">.read-mode</span> <span class="selector-id">#aside-content</span> <span class="selector-class">.card-widget</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">158</span>, <span class="number">204</span>, <span class="number">171</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="selector-class">.read-mode</span> <span class="selector-tag">div</span><span class="selector-id">#post</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">158</span>, <span class="number">204</span>, <span class="number">171</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/* 夜间阅读模式 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span></span><br><span class="line">  <span class="selector-class">.read-mode</span> <span class="selector-id">#aside-content</span> <span class="selector-class">.card-widget</span>&#123;</span><br><span class="line">        <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">color</span>: <span class="number">#eeeeee</span>;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span>  </span><br><span class="line">  <span class="selector-class">.read-mode</span> <span class="selector-tag">div</span><span class="selector-id">#post</span>&#123;</span><br><span class="line">      <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)<span class="meta">!important</span>;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#eeeeee</span>;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="渐变色"><a href="# 渐变色" class="headerlink" title="渐变色"></a>渐变色</h3><ol>
<li>修改主题配置文件<code>_config.butterfly.yml</code></li>
</ol>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">background:</span> <span class="string">&quot;#efefef&quot;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建自定义 <code>css</code> 文件</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 文章页背景 */</span></span><br><span class="line"><span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>) &#123;</span><br><span class="line">  <span class="comment">/* 以下代表白色透明度为 0.3 */</span></span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 所有背景（包括首页卡片、文章页、页面页等） */</span></span><br><span class="line"><span class="selector-id">#recent-posts</span> &gt; <span class="selector-class">.recent-post-item</span>,</span><br><span class="line"><span class="selector-class">.layout</span> &gt; <span class="selector-tag">div</span><span class="selector-pseudo">:first</span>-child<span class="selector-pseudo">:not</span>(<span class="selector-class">.recent-posts</span>),</span><br><span class="line"><span class="selector-class">.layout_post</span> &gt; <span class="selector-id">#page</span>,</span><br><span class="line"><span class="selector-class">.layout_post</span> &gt; <span class="selector-id">#post</span>,</span><br><span class="line"><span class="selector-class">.read-mode</span> <span class="selector-class">.layout_post</span> &gt; <span class="selector-id">#post</span> &#123;</span><br><span class="line">  <span class="comment">/* 以下代表白色透明度为 0.3 */</span></span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 侧栏卡片 */</span></span><br><span class="line"><span class="selector-class">.card-widget</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>:<span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>)<span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 日间模式页脚字体颜色 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span>&#123;</span><br><span class="line">  <span class="selector-id">#footer</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>)<span class="meta">!important</span>;</span><br><span class="line">    <span class="comment">/* 页脚 a 标签字体颜色 */</span></span><br><span class="line">    <span class="selector-id">#footer-wrap</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#050505</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*a 标签颜色 */</span></span><br><span class="line">    <span class="selector-id">#footer-wrap</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#050505</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 页脚自定义字段字体颜色 */</span></span><br><span class="line">    <span class="selector-class">.footer_custom_text</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#050505</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 夜间模式页脚字体颜色 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span>&#123;</span><br><span class="line">  <span class="selector-id">#footer</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.7</span>)<span class="meta">!important</span>;</span><br><span class="line">    <span class="comment">/* 页脚 a 标签字体颜色 */</span></span><br><span class="line">    <span class="selector-id">#footer-wrap</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#efefef</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*a 标签颜色 */</span></span><br><span class="line">    <span class="selector-id">#footer-wrap</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#efefef</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 页脚自定义字段字体颜色 */</span></span><br><span class="line">    <span class="selector-class">.footer_custom_text</span> &#123;</span><br><span class="line">      <span class="attribute">color</span>: <span class="number">#efefef</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#web_bg</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">-webkit-linear-gradient</span>(</span><br><span class="line">    <span class="number">0deg</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">247</span>, <span class="number">149</span>, <span class="number">51</span>, <span class="number">0.1</span>) <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">243</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">0.1</span>) <span class="number">15%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">239</span>, <span class="number">78</span>, <span class="number">123</span>, <span class="number">0.1</span>) <span class="number">30%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">161</span>, <span class="number">102</span>, <span class="number">171</span>, <span class="number">0.1</span>) <span class="number">44%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">80</span>, <span class="number">115</span>, <span class="number">184</span>, <span class="number">0.1</span>) <span class="number">58%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">16</span>, <span class="number">152</span>, <span class="number">173</span>, <span class="number">0.1</span>) <span class="number">72%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">179</span>, <span class="number">155</span>, <span class="number">0.1</span>) <span class="number">86%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">109</span>, <span class="number">186</span>, <span class="number">130</span>, <span class="number">0.1</span>) <span class="number">100%</span></span><br><span class="line">  );</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">-moz-linear-gradient</span>(</span><br><span class="line">    <span class="number">0deg</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">247</span>, <span class="number">149</span>, <span class="number">51</span>, <span class="number">0.1</span>) <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">243</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">0.1</span>) <span class="number">15%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">239</span>, <span class="number">78</span>, <span class="number">123</span>, <span class="number">0.1</span>) <span class="number">30%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">161</span>, <span class="number">102</span>, <span class="number">171</span>, <span class="number">0.1</span>) <span class="number">44%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">80</span>, <span class="number">115</span>, <span class="number">184</span>, <span class="number">0.1</span>) <span class="number">58%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">16</span>, <span class="number">152</span>, <span class="number">173</span>, <span class="number">0.1</span>) <span class="number">72%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">179</span>, <span class="number">155</span>, <span class="number">0.1</span>) <span class="number">86%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">109</span>, <span class="number">186</span>, <span class="number">130</span>, <span class="number">0.1</span>) <span class="number">100%</span></span><br><span class="line">  );</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">-o-linear-gradient</span>(</span><br><span class="line">    <span class="number">0deg</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">247</span>, <span class="number">149</span>, <span class="number">51</span>, <span class="number">0.1</span>) <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">243</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">0.1</span>) <span class="number">15%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">239</span>, <span class="number">78</span>, <span class="number">123</span>, <span class="number">0.1</span>) <span class="number">30%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">161</span>, <span class="number">102</span>, <span class="number">171</span>, <span class="number">0.1</span>) <span class="number">44%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">80</span>, <span class="number">115</span>, <span class="number">184</span>, <span class="number">0.1</span>) <span class="number">58%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">16</span>, <span class="number">152</span>, <span class="number">173</span>, <span class="number">0.1</span>) <span class="number">72%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">179</span>, <span class="number">155</span>, <span class="number">0.1</span>) <span class="number">86%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">109</span>, <span class="number">186</span>, <span class="number">130</span>, <span class="number">0.1</span>) <span class="number">100%</span></span><br><span class="line">  );</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">-ms-linear-gradient</span>(</span><br><span class="line">    <span class="number">0deg</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">247</span>, <span class="number">149</span>, <span class="number">51</span>, <span class="number">0.1</span>) <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">243</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">0.1</span>) <span class="number">15%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">239</span>, <span class="number">78</span>, <span class="number">123</span>, <span class="number">0.1</span>) <span class="number">30%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">161</span>, <span class="number">102</span>, <span class="number">171</span>, <span class="number">0.1</span>) <span class="number">44%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">80</span>, <span class="number">115</span>, <span class="number">184</span>, <span class="number">0.1</span>) <span class="number">58%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">16</span>, <span class="number">152</span>, <span class="number">173</span>, <span class="number">0.1</span>) <span class="number">72%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">179</span>, <span class="number">155</span>, <span class="number">0.1</span>) <span class="number">86%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">109</span>, <span class="number">186</span>, <span class="number">130</span>, <span class="number">0.1</span>) <span class="number">100%</span></span><br><span class="line">  );</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(</span><br><span class="line">    <span class="number">90deg</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">247</span>, <span class="number">149</span>, <span class="number">51</span>, <span class="number">0.1</span>) <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">243</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">0.1</span>) <span class="number">15%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">239</span>, <span class="number">78</span>, <span class="number">123</span>, <span class="number">0.1</span>) <span class="number">30%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">161</span>, <span class="number">102</span>, <span class="number">171</span>, <span class="number">0.1</span>) <span class="number">44%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">80</span>, <span class="number">115</span>, <span class="number">184</span>, <span class="number">0.1</span>) <span class="number">58%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">16</span>, <span class="number">152</span>, <span class="number">173</span>, <span class="number">0.1</span>) <span class="number">72%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">7</span>, <span class="number">179</span>, <span class="number">155</span>, <span class="number">0.1</span>) <span class="number">86%</span>,</span><br><span class="line">    <span class="built_in">rgba</span>(<span class="number">109</span>, <span class="number">186</span>, <span class="number">130</span>, <span class="number">0.1</span>) <span class="number">100%</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="中英文字符间加空格"><a href="# 中英文字符间加空格" class="headerlink" title="中英文字符间加空格"></a>中英文字符间加空格 </h2><p> 安装插件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-filter-auto-spacing --save</span><br></pre></td></tr></table></figure>

<p>配置文件 <code>_config.yml</code> 添加参数</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># hexo 中英文之间自动加空格 </span></span><br><span class="line"><span class="attr">auto_spacing:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>Cloudflare</title>
    <url>/blog/posts/6e84350.html</url>
    <content><![CDATA[<h1 id="Cloudflare"><a href="#Cloudflare" class="headerlink" title="Cloudflare"></a>Cloudflare</h1><h2 id="Native-Terminal"><a href="#Native-Terminal" class="headerlink" title="Native Terminal"></a>Native Terminal</h2><ol>
<li><p>Install cloudflared on the client machine.</p>
</li>
<li><p>Make a one-time change to your SSH configuration file:</p>
<p> <code>vim ~/.ssh/config</code></p>
</li>
<li><p>Input the following values; replacing ssh.example.com with the hostname you created.</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Host ssh.example.com</span><br><span class="line">ProxyCommand /usr/local/bin/cloudflared access ssh --hostname %h</span><br></pre></td></tr></table></figure>

<p> The cloudflared path may be different depending on your OS and package manager. For example, if you installed cloudflared on macOS with Homebrew, the path is &#x2F;opt&#x2F;homebrew&#x2F;bin&#x2F;cloudflared.</p>
</li>
<li><p>You can now test the connection by running a command to reach the service:</p>
<p> <code>ssh &lt;username&gt;@ssh.example.com</code></p>
<p> When the command is run, cloudflared will launch a browser window to prompt you to authenticate with your identity provider before establishing the connection from your terminal.</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>Git</title>
    <url>/blog/posts/69c3279c.html</url>
    <content><![CDATA[<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name  &quot;username&quot;  </span><br><span class="line">git config --global user.email  &quot;email&quot;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/blog/posts/4a17b156.html</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>Qemu</title>
    <url>/blog/posts/ecd52e49.html</url>
    <content><![CDATA[<h1 id="Qemu"><a href="#Qemu" class="headerlink" title="Qemu"></a>Qemu</h1><h2 id="AIX-7-2"><a href="#AIX-7-2" class="headerlink" title="AIX 7.2"></a>AIX 7.2</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">qemu-img create -f qcow2 hdisk0.qcow2 20G</span><br><span class="line"></span><br><span class="line">qemu-system-ppc64 -cpu POWER8 -machine pseries -m 4096 -serial stdio \</span><br><span class="line">-drive file=hdisk0.qcow2,<span class="keyword">if</span>=none,<span class="built_in">id</span>=drive-virtio-disk0 -device virtio-scsi-pci,<span class="built_in">id</span>=scsi \</span><br><span class="line">-device scsi-hd,drive=drive-virtio-disk0 -cdrom AIX_v7.2_Install_7200-03-03-1913_DVD_1_of_2_052019.iso \</span><br><span class="line">-prom-env <span class="string">&quot;boot-command=boot cdrom:&quot;</span></span><br><span class="line"></span><br><span class="line">qemu-system-ppc64 -cpu POWER8 -machine pseries -m 4096 -serial stdio \</span><br><span class="line">-drive file=hdisk0.qcow2,<span class="keyword">if</span>=none,<span class="built_in">id</span>=drive-virtio-disk0 -device virtio-scsi-pci,<span class="built_in">id</span>=scsi \</span><br><span class="line">-device scsi-hd,drive=drive-virtio-disk0 -cdrom AIX_v7.2_Install_7200-03-03-1913_DVD_1_of_2_052019.iso \</span><br><span class="line">-prom-env <span class="string">&quot;boot-command=boot disk:&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
      <tags>
        <tag>qemu</tag>
      </tags>
  </entry>
  <entry>
    <title>WSL</title>
    <url>/blog/posts/784ee20b.html</url>
    <content><![CDATA[<h1 id="WSL"><a href="#WSL" class="headerlink" title="WSL"></a>WSL</h1><h2 id="Systemd-support"><a href="#Systemd-support" class="headerlink" title="Systemd support"></a>Systemd support</h2><p>To enable systemd, open your <code>wsl.conf</code> file in a text editor using <code>sudo</code> for admin permissions and add these lines to the <code>/etc/wsl.conf</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;[boot]\nsystemd=true&quot;</span> | sudo <span class="built_in">tee</span> -a /etc/wsl.conf</span><br></pre></td></tr></table></figure>

<h2 id="Open-file-with-explorer-exe"><a href="#Open-file-with-explorer-exe" class="headerlink" title="Open file with explorer.exe"></a>Open file with explorer.exe</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">open</span></span> ()</span><br><span class="line">&#123;</span><br><span class="line">    wp=$(wslpath -w <span class="string">&quot;<span class="variable">$1</span>&quot;</span>);</span><br><span class="line">    explorer.exe <span class="string">&quot;<span class="variable">$wp</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Others</category>
      </categories>
      <tags>
        <tag>wsl</tag>
      </tags>
  </entry>
  <entry>
    <title>Resetting root password in VCSA</title>
    <url>/blog/posts/c343108e.html</url>
    <content><![CDATA[<h1 id="Resetting-root-password-in-VCSA"><a href="#Resetting-root-password-in-VCSA" class="headerlink" title="Resetting root password in VCSA"></a>Resetting root password in VCSA</h1><blockquote>
<p>The root account password of VMware vCenter Server Appliance fails<br>The root account of the vCenter Server Appliance 6.5 and above is locked or account is expired<br>The root account password has been lost or forgotten</p>
</blockquote>
<h2 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h2><p>For passwords that have expired, the default vCenter Server Appliance password expires after 90 days. For more information, see <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.vcsa.doc/GUID-C63C82F1-D430-4710-8B92-177A79D3DE65.html">Change the Password and Password Expiration Settings of the Root User</a></p>
<h2 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h2><h3 id="For-6-5-x2F-6-7-x2F-7-x"><a href="#For-6-5-x2F-6-7-x2F-7-x" class="headerlink" title="For 6.5 &#x2F; 6.7 &#x2F; 7.x"></a>For 6.5 &#x2F; 6.7 &#x2F; 7.x</h3><p><a href="https://kb.vmware.com/s/article/2147144?lang=en_US">Resetting root password in vCenter Server Appliance 6.5 &#x2F; 6.7 &#x2F; 7.x (2147144)</a></p>
<ol>
<li><p>Take a snapshot or backup of the vCenter Server Appliance before proceeding.<br><font color=caution>Caution: Do not skip this step</font></p>
<p>Note: If the vCenter Appliance is on the same ESXi hosts it manages. Connect directly to the ESXi host that it is located on to perform these steps.</p>
</li>
<li><p>Reboot the vCenter Server Appliance.</p>
</li>
<li><p>After the VCSA Photon OS starts, press the <code>e</code> key to enter the GNU GRUB Edit Menu.</p>
</li>
<li><p>Locate the line that begins with the word <code>Linux</code>.</p>
</li>
<li><p>Append these entries to the end of the line:<br><code>rw init=/bin/bash</code></p>
<p><img src="https://s2.loli.net/2023/05/05/FZAHkV36Rpj4O9c.png"></p>
</li>
<li><p>Press <code>F10</code> to continue booting.</p>
</li>
<li><p>Run the command<br><code>mount -o remount,rw /</code></p>
</li>
<li><p>In the Command prompt, enter the command passwd and provide a new root password (twice for confirmation):<br><code>passwd</code></p>
</li>
<li><p>Unmount the filesystem by running this command (yes, the unmount command is umount  -  it’s not a spelling error):<br><code>umount /</code></p>
</li>
<li><p>Reboot the vCenter Server Appliance by running this command:<br>   <code>reboot -f</code></p>
</li>
<li><p>Confirm that you can access the vCenter Server Appliance using the new root password.</p>
</li>
<li><p>Remove the snapshot taken in Step 1 if applicable.</p>
</li>
<li><p>You could set the Root password to never expire in order to prevent this issue by running command:<br>   <code>chage -I -1 -m 0 -M 99999 -E -1 root</code>  or at the VAMI  (https:&#x2F;&#x2F;<vcenter_fqdn>:5480)</p>
</li>
</ol>
<h3 id="For-6-7-U1-and-later"><a href="#For-6-7-U1-and-later" class="headerlink" title="For 6.7 U1 and later"></a>For 6.7 U1 and later</h3><p><a href="https://kb.vmware.com/s/article/75174?lang=en_US">How to reset the lost or forgotten root password in vCenter Server Appliance 6.7 U1 and later (75174)</a></p>
<div class="note info modern"><p>With the change within VCSA 6.7 U1, the SSO user who is part of <code>SystemConfiguration.BashShellAdministrator</code> group will be able to log in to Bash shell and can call any commands using sudo and without password. This aims at reducing the gap between the root and SSO administrator user. The user has to enable shell to log in to the bash shell. By default, the user will be logged into appliance shell.</p>
</div>

<ol>
<li><p>Connect SSH to VCSA 6.7 and login using <a href="mailto:&#97;&#100;&#x6d;&#105;&#x6e;&#x69;&#115;&#x74;&#x72;&#97;&#x74;&#111;&#114;&#64;&#118;&#115;&#x70;&#104;&#x65;&#114;&#101;&#x2e;&#108;&#111;&#x63;&#x61;&#108;">&#97;&#100;&#x6d;&#105;&#x6e;&#x69;&#115;&#x74;&#x72;&#97;&#x74;&#111;&#114;&#64;&#118;&#115;&#x70;&#104;&#x65;&#114;&#101;&#x2e;&#108;&#111;&#x63;&#x61;&#108;</a> where vsphere.local is your default SSO Domain.</p>
<ul>
<li>If disabled, enable SSH using the VAMI (https:&#x2F;&#x2F;<vcenter_fqdn>:5480 ).</li>
<li>Can login as <a href="mailto:&#97;&#x64;&#x6d;&#105;&#110;&#x69;&#115;&#116;&#114;&#x61;&#116;&#x6f;&#x72;&#x40;&#118;&#112;&#x68;&#101;&#x72;&#101;&#46;&#x6c;&#111;&#x63;&#97;&#108;">&#97;&#x64;&#x6d;&#105;&#110;&#x69;&#115;&#116;&#114;&#x61;&#116;&#x6f;&#x72;&#x40;&#118;&#112;&#x68;&#101;&#x72;&#101;&#46;&#x6c;&#111;&#x63;&#97;&#108;</a> or any other member of the SSO administrators group.</li>
<li>Enable or Disable SSH and Bash Shell Access.</li>
</ul>
</li>
<li><p>If first time logging in, enable shell then enter shell.</p>
<ul>
<li><code>shell.set --enable true</code></li>
<li><code>shell</code></li>
</ul>
<p><img src="https://s2.loli.net/2023/05/05/KSJcZVe5RaMLg1I.png"></p>
</li>
<li><p>Once in shell as sso-user, run the below command to change to root shell.</p>
<ul>
<li><code>sudo -i</code></li>
<li>Alternately, you could use the command: <code>sudo passwd root</code></li>
</ul>
</li>
<li><p>Then once in root shell, run passwd to change the root password.</p>
<ul>
<li><code>passwd</code></li>
</ul>
<p><img src="https://s2.loli.net/2023/05/05/hwtFZyJuiHAYpov.png"></p>
</li>
<li><p>Now you can exit the session by running the exit or logout command and then log in through a new SSH session using your root account with updated password. Alternatively, you could run the su command in order to be prompted for the root password and get access as root.</p>
</li>
</ol>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Setting Shared Disks for Oracle RAC</title>
    <url>/blog/posts/a55fe6db.html</url>
    <content><![CDATA[<h1 id="Setting-Shared-Disks-for-Oracle-RAC"><a href="#Setting-Shared-Disks-for-Oracle-RAC" class="headerlink" title="Setting Shared Disks for Oracle RAC"></a>Setting Shared Disks for Oracle RAC</h1><ol>
<li>Create Disks</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vmkfstools -c 1G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk</span><br><span class="line">vmkfstools -c 1G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk</span><br><span class="line">vmkfstools -c 1G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk</span><br><span class="line">vmkfstools -c 30G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-MGMT01-30GB.vmdk</span><br><span class="line">vmkfstools -c 10G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-ARCH01-10GB.vmdk</span><br><span class="line">vmkfstools -c 20G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-DATA01-20GB.vmdk</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Adding a storage controller to Oracle RAC VMs</li>
</ol>
<p>Leave the Bus Sharing mode as <strong>None</strong>, and choose the desired type (LSI Parallel or LSI SAS or <strong>Paravirtual</strong>).</p>
<div class="note info simple"><p>Note: The Paravirtual controller type is generally recommended for RAC shared disks.</p>
</div>

<p><img src="https://s2.loli.net/2023/04/17/AspxLyVKXjZnHbQ.png"></p>
<ol start="3">
<li>Adding shared disks to Oracle RAC VMs</li>
</ol>
<p>Select <strong>Thick provision eager zeroed</strong> option in the Disk Provisioning dropdown menu.<br>In the Sharing dropdown menu, select the <strong>Multi-writer</strong> option.<br>Change the Disk Mode to <strong>Independent-Persistent</strong>.</p>
<div class="note info simple"><p>Note: While Independent-Persistent disk mode is not a hard requirement to enable Multi-writer option, the default Dependent disk mode would cause the cannot snapshot shared disk error when a virtual machine snapshot is taken. Use of Independent-Persistent disk mode would allow taking a snapshot of the OS disk while the shared disk would need to be backed up separately by a third-party vendor software.</p>
</div>

<p><img src="https://s2.loli.net/2023/04/17/khMxL3giPZR87Ob.png"></p>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>share</tag>
      </tags>
  </entry>
  <entry>
    <title>Setting VM Disk UUID</title>
    <url>/blog/posts/91e0e9b9.html</url>
    <content><![CDATA[<h1 id="Setting-VM-Disk-UUID"><a href="#Setting-VM-Disk-UUID" class="headerlink" title="Setting VM Disk UUID"></a>Setting VM Disk UUID</h1><p> 编辑虚拟机配置文件 <code>*.vmx</code>，添加以下参数 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">disk.EnableUUID = <span class="string">&quot;TRUE&quot;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>disk</tag>
      </tags>
  </entry>
  <entry>
    <title>VMware PowerCLI</title>
    <url>/blog/posts/65f9e0ae.html</url>
    <content><![CDATA[<h1 id="VMware-PowerCLI"><a href="#VMware-PowerCLI" class="headerlink" title="VMware PowerCLI"></a>VMware PowerCLI</h1><h2 id="Install-PowerShell"><a href="#Install-PowerShell" class="headerlink" title="Install PowerShell"></a>Install PowerShell</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Register the Microsoft RedHat repository</span></span><br><span class="line">curl https://packages.microsoft.com/config/rhel/8/prod.repo | sudo <span class="built_in">tee</span> /etc/yum.repos.d/microsoft.repo</span><br><span class="line"><span class="comment"># Install PowerShell</span></span><br><span class="line">sudo dnf install --assumeyes powershell</span><br><span class="line"><span class="comment"># Start PowerShell</span></span><br><span class="line">pwsh</span><br></pre></td></tr></table></figure>

<h2 id="Install-PowerCLI-Module"><a href="#Install-PowerCLI-Module" class="headerlink" title="Install PowerCLI Module"></a>Install PowerCLI Module</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> <span class="literal">-Name</span> VMware.PowerCLI</span><br></pre></td></tr></table></figure>

<h2 id="Connectting-VCSA"><a href="#Connectting-VCSA" class="headerlink" title="Connectting VCSA"></a>Connectting VCSA</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-PowerCLIConfiguration</span> <span class="literal">-InvalidCertificateAction</span> Ignore</span><br><span class="line"><span class="built_in">Connect-VIServer</span> <span class="literal">-Protocol</span> https <span class="literal">-User</span> <span class="string">&#x27;administrator@vsphere.local&#x27;</span> <span class="literal">-Password</span> <span class="string">&#x27;Welcome@123&#x27;</span> <span class="literal">-Server</span> <span class="number">192.168</span>.<span class="number">12.3</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>powercli</tag>
      </tags>
  </entry>
  <entry>
    <title>Architecture</title>
    <url>/blog/posts/6ca88502.html</url>
    <content><![CDATA[<h1 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h1><h2 id="Physical-Architecture"><a href="#Physical-Architecture" class="headerlink" title="Physical Architecture"></a>Physical Architecture</h2><p><img src="https://s2.loli.net/2022/04/26/nLNcJ5qkIbFCDWU.png"></p>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>1 区 -&gt; 2 区 -&gt; 3 区<br>1 区 -&gt; 3 区</p>
<h2 id="PGA"><a href="#PGA" class="headerlink" title="PGA"></a>PGA</h2><ol>
<li>保存用户的连接信息，如会话属性、绑定变量、用户权限等重要信息。</li>
<li>硬解析首次执行的 SQL 指令，生成唯一指令 HASH 值。</li>
<li>当发起的 SQL 指令需要排序时，如果内存空间充足，则在 PGA 中完成，如果不足，超出部分在临时表空间完成排序。</li>
</ol>
<h2 id="SGA"><a href="#SGA" class="headerlink" title="SGA"></a>SGA</h2><ol>
<li><strong>Shared Pool - Library Cache</strong> 保存硬解析生成唯一 SQL 指令 HASH 值，保留了语法语意检查及执行计划等解析动作的劳动成功，下次执行该 SQL 指令时，直接拿来主义。</li>
<li>如果 SQL 指令需要的数据不在 <strong>Database Buffer Cache</strong>，则从硬盘中获取数据到数据缓存区。</li>
<li><strong>Redo Log Buffer</strong> 保存数据库相关操作日志。</li>
</ol>
<h2 id="Background-Processes"><a href="#Background-Processes" class="headerlink" title="Background Processes"></a>Background Processes</h2><p><strong>DBWR</strong>: 将数据缓存区的数据批量写入（提高数据库写性能）磁盘数据文件中，需等待 LGWR 先完成。<br><strong>CKPT</strong>: Check Point，由 Oracle 的 FAST_SMART_MTTR_TARGET 参数控制，用于触发 DBWR 将数据缓存区的数据中写入磁盘。<br><strong>LGWR</strong>: 将日志缓存区的数据写入磁盘的联机日志文件，记录所有从数据缓存区写入磁盘数据文件的动作。为了顺序记录日志，因此 LGWR 采用单线程。</p>
<ul>
<li>每隔 3 秒，LGWR 运行一次</li>
<li>任何 COMMIT，触发 LGWR 运行一次</li>
<li>DBWR 要把数据从数据缓存区写入磁盘，触发 LGWR 运行一次</li>
<li>日志缓存区满三分之一或记满 1MB，触发 LGWR 运行一次</li>
<li>联机日志文件切换，触发 LGWR 运行一次<br><strong>PMON</strong>: Processes Monitor，进程监视器。在执行某些更新语句，未提交时进程崩溃了，这时候 PMON 会自动回滚该操作。除此之外还可以干预后台进程，比如 RECO 一次失败，会重启 RECO 进程，遇到 LGWR 进程失败，会中止实例，用于防止数据错乱。<br><strong>SMON</strong>: System Mointor，系统监视器。重点工作在于 Instance Recovery，还有清理临时表空间、清理回滚段表空间、合并空闲空间等。<br><strong>LCKn</strong>: 仅使用于 RAC 数据库，最多可有 10 个进程（LCK0 - LCK9），用于实例间的封锁。<br><strong>RECO</strong>: Distributed Database Recovery，用于分布式数据库的恢复。<br><strong>ARCH</strong>: 在 LGWR 写联机日志写到需要覆盖重写时，触发 ARCH 进程复制联机日志，生成归档日志文件。</li>
</ul>
<h2 id="Undo-Segment"><a href="#Undo-Segment" class="headerlink" title="Undo Segment"></a>Undo Segment</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">parameter</span> undo</span><br><span class="line">NAME                                 TYPE        <span class="keyword">VALUE</span></span><br><span class="line"><span class="comment">------------------------------------ ----------- ------------------------------</span></span><br><span class="line">undo_management                      string      AUTO</span><br><span class="line">undo_retention                       <span class="type">integer</span>     <span class="number">900</span></span><br><span class="line">undo_tablespace                      string      UNDOTBS1</span><br></pre></td></tr></table></figure>

<p>UNDO_MANAGEMENT&#x3D;AUTO，表示自动回滚段管理，空间不足时自动扩展；<br>UNDO_RETENTION&#x3D;900，表示回滚段需要 900 秒后才能覆盖标记为重新使用的空间。</p>
<h2 id="Logical-Architecture"><a href="#Logical-Architecture" class="headerlink" title="Logical Architecture"></a>Logical Architecture</h2><p><img src="https://s2.loli.net/2022/04/27/MRSTPdmfuiKwhsF.png"></p>
<p>数据库组成：<strong>DATABASE &lt;- Tablespace &lt;- Segment &lt;- Extent &lt;- Block</strong><br>Extent 是数据库分配空间的最小单位<br>Block 是数据库的最小逻辑单位</p>
<h2 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h2><p><img src="https://s2.loli.net/2022/04/27/Wjvg9KdH7zL8bU2.png"></p>
<p>数据库组成：</p>
<blockquote>
<ol>
<li>数据块头(Common and Variable Header) 包含了数据块的概要信息，例如块地址及此数据块所属的段的类型</li>
<li>表目录(Table Directory) 存储行数据所在的表的信息</li>
<li>行目录(Row Directory) 存储插入的行的地址</li>
<li>可用空间区(Free Space) 块中的空余空间，由 PCTFREE 参数设置。如果是表或索引块，该区域还会存储事务条目，大概有 23 字节开销</li>
<li>行数据区 (Row Data) 存储具体的行的信息或者索引的信息，这部分占用了数据块绝大部分的空间<br> 数据块头、表目录、行目录为管理开销，平均在 84-107 字节之间。</li>
</ol>
</blockquote>
<h2 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h2><p>全局临时表：一种是基于会话的全局临时表（commit preserve rows），一种是基于事务的全局临时表（commit delete rows）。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title>alwayson database can not shrink log file</title>
    <url>/blog/posts/eb1952bb.html</url>
    <content><![CDATA[<h1 id="alwayson-database-can-not-shrink-log-file"><a href="#alwayson-database-can-not-shrink-log-file" class="headerlink" title="alwayson database can not shrink log file"></a>alwayson database can not shrink log file</h1><p>AlwaysOn database 事务日志截断后，日志文件无法收缩，导致日志文件占用磁盘空间大。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>If you have scheduled T-Log Backup on alwaysOn Database, After completion of T-Log Backup check the <strong>log_reuse_wait_desc</strong> of database using query</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> name,log_reuse_wait_desc <span class="keyword">from</span> sys.databases <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;Name Of Database&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>If column log_reuse_wait_desc returns value “<strong>NOTHING</strong>“, Immediately execute <strong>DBCC SHRINKFILE</strong> Command and shrink Log File without Error.</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>orphaned users</title>
    <url>/blog/posts/877cd9cd.html</url>
    <content><![CDATA[<h1 id="orphaned-users"><a href="#orphaned-users" class="headerlink" title="orphaned users"></a>orphaned users</h1><p>Step 1:  检测、查看对应的孤立账号 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">USE <span class="operator">&lt;</span>DatabaseName<span class="operator">&gt;</span>;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">EXEC</span> sp_change_users_login <span class="variable">@Action</span><span class="operator">=</span><span class="string">&#x27;Report&#x27;</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>Step 2: 新建对应的登录名，例如上面检测到 Test 账号为孤立账号 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">USE [master]</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> LOGIN [Test] <span class="keyword">WITH</span> PASSWORD<span class="operator">=</span>N<span class="string">&#x27;Pa@#456&#x27;</span> MUST_CHANGE, DEFAULT_DATABASE<span class="operator">=</span>[xxxx], CHECK_EXPIRATION<span class="operator">=</span><span class="keyword">ON</span>, CHECK_POLICY<span class="operator">=</span><span class="keyword">ON</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>Step 3:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">USE EASN_EAP;</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">EXEC</span> sp_change_users_login <span class="variable">@Action</span><span class="operator">=</span><span class="string">&#x27;Update_one&#x27;</span>,<span class="variable">@UserNamePattern</span><span class="operator">=</span><span class="string">&#x27;xxxx&#x27;</span>,<span class="variable">@LoginName</span><span class="operator">=</span><span class="string">&#x27;xxxx&#x27;</span>;</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup &amp; Restore</title>
    <url>/blog/posts/772b3e6d.html</url>
    <content><![CDATA[<h1 id="Backup-amp-Restore"><a href="#Backup-amp-Restore" class="headerlink" title="Backup &amp; Restore"></a>Backup &amp; Restore</h1><ol>
<li>Full Backup</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">BACKUP DATABASE [zsyydb] <span class="keyword">TO</span> DISK<span class="operator">=</span>N<span class="string">&#x27;\\192.0.33.222\Backup\zsyydb.bak&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> NOFORMAT,NOINIT,NAME<span class="operator">=</span>N<span class="string">&#x27;zsyydb-full&#x27;</span>,<span class="keyword">SKIP</span>,NOREWIND,NOUNLOAD,STATS<span class="operator">=</span><span class="number">5</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Full Restore</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">RESTORE DATABASE [zsyydb] <span class="keyword">FROM</span> DISK<span class="operator">=</span>N<span class="string">&#x27;D:\backup\zsyydb.bak&#x27;</span> <span class="keyword">WITH</span> FILE<span class="operator">=</span><span class="number">1</span>,REPLACE,</span><br><span class="line">MOVE N<span class="string">&#x27;zsyydb&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\zsyydb.mdf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;HistoryData&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\HistoryData.ndf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;UnConfirm2013&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\UnConfirm2013.ndf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;zsyylog&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb.ldf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;zsyylog_1&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb1.ldf&#x27;</span>,</span><br><span class="line">NORECOVERY,NOUNLOAD,STATS<span class="operator">=</span> <span class="number">5</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<ol>
<li>Diff Backup</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">BACKUP DATABASE [zsyydb] <span class="keyword">TO</span> DISK<span class="operator">=</span>N<span class="string">&#x27;\\192.0.33.222\Backup\zsyydb01.bak&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> DIFFERENTIAL,NOFORMAT,NOINIT,NAME<span class="operator">=</span>N<span class="string">&#x27;zsyydb- 差异数据库备份 &#x27;</span>,<span class="keyword">SKIP</span>,NOREWIND,NOUNLOAD,STATS<span class="operator">=</span><span class="number">5</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Diff Restore</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">RESTORE DATABASE [zsyydb] <span class="keyword">FROM</span> DISK<span class="operator">=</span>N<span class="string">&#x27;D:\backup\zsyydb01.bak&#x27;</span> <span class="keyword">WITH</span> FILE<span class="operator">=</span> <span class="number">1</span>,REPLACE,</span><br><span class="line">MOVE N<span class="string">&#x27;zsyydb&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\zsyydb.mdf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;HistoryData&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\HistoryData.ndf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;UnConfirm2013&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\UnConfirm2013.ndf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;zsyylog&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb.ldf&#x27;</span>,</span><br><span class="line">MOVE N<span class="string">&#x27;zsyylog_1&#x27;</span><span class="keyword">TO</span> N<span class="string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb1.ldf&#x27;</span>,</span><br><span class="line">NOUNLOAD,STATS<span class="operator">=</span><span class="number">5</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>backup</tag>
        <tag>restore</tag>
      </tags>
  </entry>
  <entry>
    <title>sp_help_revlogin</title>
    <url>/blog/posts/e11d3ec.html</url>
    <content><![CDATA[<h1 id="sp-help-revlogin"><a href="#sp-help-revlogin" class="headerlink" title="sp_help_revlogin"></a>sp_help_revlogin</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">USE master</span><br><span class="line">GO</span><br><span class="line">IF OBJECT_ID (<span class="string">&#x27;sp_hexadecimal&#x27;</span>) <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">  <span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> sp_hexadecimal</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_hexadecimal</span><br><span class="line">    <span class="variable">@binvalue</span> <span class="type">varbinary</span>(<span class="number">256</span>),</span><br><span class="line">    <span class="variable">@hexvalue</span> <span class="type">varchar</span> (<span class="number">514</span>) OUTPUT</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@charvalue</span> <span class="type">varchar</span> (<span class="number">514</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@i</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@length</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@hexstring</span> <span class="type">char</span>(<span class="number">16</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@charvalue</span> <span class="operator">=</span> <span class="string">&#x27;0x&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@i</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@length</span> <span class="operator">=</span> DATALENGTH (<span class="variable">@binvalue</span>)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@hexstring</span> <span class="operator">=</span> <span class="string">&#x27;0123456789ABCDEF&#x27;</span></span><br><span class="line">WHILE (<span class="variable">@i</span> <span class="operator">&lt;=</span> <span class="variable">@length</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> <span class="variable">@tempint</span> <span class="type">int</span></span><br><span class="line">  <span class="keyword">DECLARE</span> <span class="variable">@firstint</span> <span class="type">int</span></span><br><span class="line">  <span class="keyword">DECLARE</span> <span class="variable">@secondint</span> <span class="type">int</span></span><br><span class="line">  <span class="keyword">SELECT</span> <span class="variable">@tempint</span> <span class="operator">=</span> <span class="keyword">CONVERT</span>(<span class="type">int</span>, <span class="built_in">SUBSTRING</span>(<span class="variable">@binvalue</span>,<span class="variable">@i</span>,<span class="number">1</span>))</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="variable">@firstint</span> <span class="operator">=</span> <span class="built_in">FLOOR</span>(<span class="variable">@tempint</span><span class="operator">/</span><span class="number">16</span>)</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="variable">@secondint</span> <span class="operator">=</span> <span class="variable">@tempint</span> <span class="operator">-</span> (<span class="variable">@firstint</span><span class="operator">*</span><span class="number">16</span>)</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="variable">@charvalue</span> <span class="operator">=</span> <span class="variable">@charvalue</span> <span class="operator">+</span></span><br><span class="line">    <span class="built_in">SUBSTRING</span>(<span class="variable">@hexstring</span>, <span class="variable">@firstint</span><span class="operator">+</span><span class="number">1</span>, <span class="number">1</span>) <span class="operator">+</span></span><br><span class="line">    <span class="built_in">SUBSTRING</span>(<span class="variable">@hexstring</span>, <span class="variable">@secondint</span><span class="operator">+</span><span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="variable">@i</span> <span class="operator">=</span> <span class="variable">@i</span> <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@hexvalue</span> <span class="operator">=</span> <span class="variable">@charvalue</span></span><br><span class="line">GO</span><br><span class="line">IF OBJECT_ID (<span class="string">&#x27;sp_help_revlogin&#x27;</span>) <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">  <span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> sp_help_revlogin</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_help_revlogin <span class="variable">@login</span>_name sysname <span class="operator">=</span> <span class="keyword">NULL</span> <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@name</span> sysname</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@type</span> <span class="type">varchar</span> (<span class="number">1</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@hasaccess</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@denylogin</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@is</span>_disabled <span class="type">int</span></span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@PWD</span>_varbinary  <span class="type">varbinary</span> (<span class="number">256</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@PWD</span>_string  <span class="type">varchar</span> (<span class="number">514</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@SID</span>_varbinary <span class="type">varbinary</span> (<span class="number">85</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@SID</span>_string <span class="type">varchar</span> (<span class="number">514</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@tmpstr</span>  <span class="type">varchar</span> (<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@is</span>_policy_checked <span class="type">varchar</span> (<span class="number">3</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@is</span>_expiration_checked <span class="type">varchar</span> (<span class="number">3</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="variable">@defaultdb</span> sysname</span><br><span class="line">IF (<span class="variable">@login</span>_name <span class="keyword">IS</span> <span class="keyword">NULL</span>)</span><br><span class="line">  <span class="keyword">DECLARE</span> login_curs <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line">      <span class="keyword">SELECT</span> p.sid, p.name, p.type, p.is_disabled, p.default_database_name, l.hasaccess, l.denylogin <span class="keyword">FROM</span> </span><br><span class="line">sys.server_principals p <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sys.syslogins l</span><br><span class="line">      <span class="keyword">ON</span> (l.name <span class="operator">=</span> p.name ) <span class="keyword">WHERE</span> p.type <span class="keyword">IN</span> (<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;U&#x27;</span> ) <span class="keyword">AND</span> p.name <span class="operator">&lt;&gt;</span> <span class="string">&#x27;sa&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">  <span class="keyword">DECLARE</span> login_curs <span class="keyword">CURSOR</span> <span class="keyword">FOR</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">SELECT</span> p.sid, p.name, p.type, p.is_disabled, p.default_database_name, l.hasaccess, l.denylogin <span class="keyword">FROM</span> </span><br><span class="line">sys.server_principals p <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sys.syslogins l</span><br><span class="line">      <span class="keyword">ON</span> (l.name <span class="operator">=</span> p.name ) <span class="keyword">WHERE</span> p.type <span class="keyword">IN</span> (<span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;U&#x27;</span> ) <span class="keyword">AND</span> p.name <span class="operator">=</span> <span class="variable">@login</span>_name</span><br><span class="line"><span class="keyword">OPEN</span> login_curs</span><br><span class="line"><span class="keyword">FETCH</span> NEXT <span class="keyword">FROM</span> login_curs <span class="keyword">INTO</span> <span class="variable">@SID</span>_varbinary, <span class="variable">@name</span>, <span class="variable">@type</span>, <span class="variable">@is</span>_disabled, <span class="variable">@defaultdb</span>, <span class="variable">@hasaccess</span>, <span class="variable">@denylogin</span></span><br><span class="line">IF (@<span class="variable">@fetch</span>_status <span class="operator">=</span> <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  PRINT <span class="string">&#x27;No login(s) found.&#x27;</span></span><br><span class="line">  <span class="keyword">CLOSE</span> login_curs</span><br><span class="line">  <span class="keyword">DEALLOCATE</span> login_curs</span><br><span class="line">  <span class="keyword">RETURN</span> <span class="number">-1</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="string">&#x27;/* sp_help_revlogin script &#x27;</span></span><br><span class="line">PRINT <span class="variable">@tmpstr</span></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="string">&#x27;** Generated &#x27;</span> <span class="operator">+</span> <span class="keyword">CONVERT</span> (<span class="type">varchar</span>, GETDATE()) <span class="operator">+</span> <span class="string">&#x27; on &#x27;</span> <span class="operator">+</span> @<span class="variable">@SERVERNAME</span> <span class="operator">+</span> <span class="string">&#x27; */&#x27;</span></span><br><span class="line">PRINT <span class="variable">@tmpstr</span></span><br><span class="line">PRINT <span class="string">&#x27;&#x27;</span></span><br><span class="line">WHILE (@<span class="variable">@fetch</span>_status <span class="operator">&lt;&gt;</span> <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  IF (@<span class="variable">@fetch</span>_status <span class="operator">&lt;&gt;</span> <span class="number">-2</span>)</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    PRINT <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="string">&#x27;-- Login: &#x27;</span> <span class="operator">+</span> <span class="variable">@name</span></span><br><span class="line">    PRINT <span class="variable">@tmpstr</span></span><br><span class="line">    IF (<span class="variable">@type</span> <span class="keyword">IN</span> (<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;U&#x27;</span>))</span><br><span class="line">    <span class="keyword">BEGIN</span> <span class="comment">-- NT authenticated account/group</span></span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="string">&#x27;CREATE LOGIN &#x27;</span> <span class="operator">+</span> QUOTENAME(<span class="variable">@name</span> ) <span class="operator">+</span> <span class="string">&#x27; FROM WINDOWS WITH DEFAULT_DATABASE = [&#x27;</span> <span class="operator">+</span> <span class="variable">@defaultdb</span> <span class="operator">+</span> <span class="string">&#x27;]&#x27;</span></span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">BEGIN</span> <span class="comment">-- SQL Server authentication</span></span><br><span class="line">        <span class="comment">-- obtain password and sid</span></span><br><span class="line">            <span class="keyword">SET</span> <span class="variable">@PWD</span>_varbinary <span class="operator">=</span> <span class="built_in">CAST</span>(LOGINPROPERTY( <span class="variable">@name</span>, <span class="string">&#x27;PasswordHash&#x27;</span> ) <span class="keyword">AS</span> <span class="type">varbinary</span> (<span class="number">256</span>) )</span><br><span class="line">        <span class="keyword">EXEC</span> sp_hexadecimal <span class="variable">@PWD</span>_varbinary, <span class="variable">@PWD</span>_string <span class="keyword">OUT</span></span><br><span class="line">        <span class="keyword">EXEC</span> sp_hexadecimal <span class="variable">@SID</span>_varbinary,<span class="variable">@SID</span>_string <span class="keyword">OUT</span></span><br><span class="line">        <span class="comment">-- obtain password policy state</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="variable">@is</span>_policy_checked <span class="operator">=</span> <span class="keyword">CASE</span> is_policy_checked <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;ON&#x27;</span> <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;OFF&#x27;</span> <span class="keyword">ELSE</span> <span class="keyword">NULL</span> <span class="keyword">END</span> <span class="keyword">FROM</span> sys.sql_logins <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="variable">@name</span></span><br><span class="line">        <span class="keyword">SELECT</span> <span class="variable">@is</span>_expiration_checked <span class="operator">=</span> <span class="keyword">CASE</span> is_expiration_checked <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;ON&#x27;</span> <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;OFF&#x27;</span> <span class="keyword">ELSE</span> <span class="keyword">NULL</span> <span class="keyword">END</span> <span class="keyword">FROM</span> sys.sql_logins <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="variable">@name</span></span><br><span class="line">            <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="string">&#x27;CREATE LOGIN &#x27;</span> <span class="operator">+</span> QUOTENAME(<span class="variable">@name</span> ) <span class="operator">+</span> <span class="string">&#x27; WITH PASSWORD = &#x27;</span> <span class="operator">+</span> <span class="variable">@PWD</span>_string <span class="operator">+</span> <span class="string">&#x27; HASHED, SID = &#x27;</span> <span class="operator">+</span> <span class="variable">@SID</span>_string <span class="operator">+</span> <span class="string">&#x27;, DEFAULT_DATABASE = [&#x27;</span> <span class="operator">+</span> <span class="variable">@defaultdb</span> <span class="operator">+</span> <span class="string">&#x27;]&#x27;</span></span><br><span class="line">        IF (<span class="variable">@is</span>_policy_checked <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> )</span><br><span class="line">        <span class="keyword">BEGIN</span></span><br><span class="line">          <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="variable">@tmpstr</span> <span class="operator">+</span> <span class="string">&#x27;, CHECK_POLICY = &#x27;</span> <span class="operator">+</span> <span class="variable">@is</span>_policy_checked</span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line">        IF (<span class="variable">@is</span>_expiration_checked <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> )</span><br><span class="line">        <span class="keyword">BEGIN</span></span><br><span class="line">          <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="variable">@tmpstr</span> <span class="operator">+</span> <span class="string">&#x27;, CHECK_EXPIRATION = &#x27;</span> <span class="operator">+</span> <span class="variable">@is</span>_expiration_checked</span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    IF (<span class="variable">@denylogin</span> <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">BEGIN</span> <span class="comment">-- login is denied access</span></span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="variable">@tmpstr</span> <span class="operator">+</span> <span class="string">&#x27;; DENY CONNECT SQL TO &#x27;</span> <span class="operator">+</span> QUOTENAME(<span class="variable">@name</span> )</span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    <span class="keyword">ELSE</span> IF (<span class="variable">@hasaccess</span> <span class="operator">=</span> <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">BEGIN</span> <span class="comment">-- login exists but does not have access</span></span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="variable">@tmpstr</span> <span class="operator">+</span> <span class="string">&#x27;; REVOKE CONNECT SQL TO &#x27;</span> <span class="operator">+</span> QUOTENAME(<span class="variable">@name</span> )</span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    IF (<span class="variable">@is</span>_disabled <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">BEGIN</span> <span class="comment">-- login is disabled</span></span><br><span class="line">      <span class="keyword">SET</span> <span class="variable">@tmpstr</span> <span class="operator">=</span> <span class="variable">@tmpstr</span> <span class="operator">+</span> <span class="string">&#x27;; ALTER LOGIN &#x27;</span> <span class="operator">+</span> QUOTENAME(<span class="variable">@name</span> ) <span class="operator">+</span> <span class="string">&#x27; DISABLE&#x27;</span></span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">    PRINT <span class="variable">@tmpstr</span></span><br><span class="line">  <span class="keyword">END</span></span><br><span class="line">  <span class="keyword">FETCH</span> NEXT <span class="keyword">FROM</span> login_curs <span class="keyword">INTO</span> <span class="variable">@SID</span>_varbinary, <span class="variable">@name</span>, <span class="variable">@type</span>, <span class="variable">@is</span>_disabled, <span class="variable">@defaultdb</span>, <span class="variable">@hasaccess</span>, <span class="variable">@denylogin</span></span><br><span class="line">   <span class="keyword">END</span></span><br><span class="line"><span class="keyword">CLOSE</span> login_curs</span><br><span class="line"><span class="keyword">DEALLOCATE</span> login_curs</span><br><span class="line"><span class="keyword">RETURN</span> <span class="number">0</span></span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p> 存储过程创建完成后执行 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> sp_help_revlogin</span><br></pre></td></tr></table></figure>

<p> 自动生成登录名权限脚本。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Docker on Fedora</title>
    <url>/blog/posts/bd8fd50a.html</url>
    <content><![CDATA[<h1 id="Install-Docker-on-Fedora"><a href="#Install-Docker-on-Fedora" class="headerlink" title="Install Docker on Fedora"></a>Install Docker on Fedora</h1><h2 id="Uninstall-old-versions"><a href="#Uninstall-old-versions" class="headerlink" title="Uninstall old versions"></a>Uninstall old versions</h2><p>Older versions of Docker were called <code>docker</code> or <code>docker-engine</code>. If these are installed, uninstall them, along with associated dependencies.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<h2 id="Set-up-the-repository"><a href="#Set-up-the-repository" class="headerlink" title="Set up the repository"></a>Set up the repository</h2><p>Install the <code>dnf-plugins-core</code> package (which provides the commands to manage your DNF repositories) and set up the repository.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf -y install dnf-plugins-core</span><br><span class="line"></span><br><span class="line">$ sudo dnf config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/fedora/docker-ce.repo</span><br></pre></td></tr></table></figure>

<h2 id="Install-Docker-Engine"><a href="#Install-Docker-Engine" class="headerlink" title="Install Docker Engine"></a>Install Docker Engine</h2><ol>
<li><p>Install the <em>latest version</em> of Docker Engine, containerd, and Docker Compose or go to the next step to install a specific version:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p>If prompted to accept the GPG key, verify that the fingerprint matches <code>060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35</code>, and if so, accept it.</p>
<p>This command installs Docker, but it doesn’t start Docker. It also creates a <code>docker</code> group, however, it doesn’t add any users to the group by default.</p>
</li>
<li><p>To install a <em>specific version</em> of Docker Engine, list the available versions in the repo, then select and install:</p>
<p>a. List and sort the versions available in your repo. This example sorts results by version number, highest to lowest, and is truncated:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ dnf list docker-ce  --showduplicates | <span class="built_in">sort</span> -r</span><br><span class="line"></span><br><span class="line">docker-ce.x86_64  3:18.09.1-3.fc28                 docker-ce-stabledocker-ce.x86_64  3:18.09.0-3.fc28                 docker-ce-stabledocker-ce.x86_64  18.06.1.ce-3.fc28                docker-ce-stabledocker-ce.x86_64  18.06.0.ce-3.fc28                docker-ce-stable</span><br></pre></td></tr></table></figure>

<p>The list returned depends on which repositories are enabled, and is specific to your version of Fedora (indicated by the <code>.fc28</code> suffix in this example).</p>
<p>b. Install a specific version by its fully qualified package name, which is the package name (<code>docker-ce</code>) plus the version string (2nd column) up to the first hyphen, separated by a hyphen (<code>-</code>), for example, <code>docker-ce-3:18.09.1</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf -y install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>

<p>This command installs Docker, but it doesn’t start Docker. It also creates a <code>docker</code> group, however, it doesn’t add any users to the group by default.</p>
</li>
<li><p>Start Docker.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify that Docker Engine is installed correctly by running the <code>hello-world</code> image.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<p>This command downloads a test image and runs it in a container. When the container runs, it prints a message and exits.</p>
</li>
</ol>
<p>This installs and runs Docker Engine. Use <code>sudo</code> to run Docker commands. Continue to <a href="https://docs.docker.com/engine/install/linux-postinstall/">Linux postinstall</a> to allow non-privileged users to run Docker commands and for other optional configuration steps.</p>
<h2 id="Uninstall-Docker-Engine"><a href="#Uninstall-Docker-Engine" class="headerlink" title="Uninstall Docker Engine"></a>Uninstall Docker Engine</h2><ol>
<li><p>Uninstall the Docker Engine, CLI, Containerd, and Docker Compose packages:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo dnf remove docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>
</li>
<li><p>Images, containers, volumes, or customized configuration files on your host are not automatically removed. To delete all images, containers, and volumes:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo <span class="built_in">rm</span> -rf /var/lib/docker</span><br><span class="line">$ sudo <span class="built_in">rm</span> -rf /var/lib/containerd</span><br></pre></td></tr></table></figure></li>
</ol>
<p>You must delete any edited configuration files manually.</p>
]]></content>
      <categories>
        <category>Docker</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible 配置文件</title>
    <url>/blog/posts/3260e0b5.html</url>
    <content><![CDATA[<p>Ansible 按照如下位置和顺序来查找 ansible.cfg 文件：</p>
<ol>
<li>ANSIBLE_CONFIG 环境变量所指定的文件 </li>
<li> 当前目录下的 ansible.cfg 文件 </li>
<li>Home 目录下的的.ansible.cfg 文件 </li>
<li>&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg 文件 </li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">inventory = ./inventory</span><br><span class="line">remote_user = normaluser</span><br><span class="line">ask_pass = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[privilege_escalation]</span><br><span class="line">become = <span class="literal">true</span></span><br><span class="line">become_method = sudo</span><br><span class="line">become_user = root</span><br><span class="line">become_ask_pass = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p><strong>ask_pass &#x3D; false</strong> 需要配置 ssh 免密登录；<br><strong>become_ask_pass &#x3D; false</strong> 需要在 sudoers 配置免密提权。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>RELAX-AND-RECOVER (REAR)</title>
    <url>/blog/posts/45f634ad.html</url>
    <content><![CDATA[<p><strong>Installing  ReaR</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">yum install rear genisoimage syslinux</span></span><br></pre></td></tr></table></figure>

<p><strong>Configuring ReaR</strong></p>
<p>ReaR is configured in the <code>/etc/rear/local.conf</code> file.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">OUTPUT=ISO</span><br><span class="line">OUTPUT_URL=file:///mnt/rescue_system/</span><br><span class="line">BACKUP=NETFS</span><br><span class="line">BACKUP_URL=file:///srv/backup/</span><br></pre></td></tr></table></figure>

<p>BACKUP_URL 的挂载点不能是“&#x2F;”，可以用以下命令检查 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash"><span class="built_in">df</span> -P /srv/backup/ | awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span> | <span class="built_in">tail</span> -1</span></span><br></pre></td></tr></table></figure>

<p><strong>Creating a Rescue System</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">rear -v mkrescue</span></span><br><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash"><span class="built_in">ls</span> -lh /mnt/rescue_system/rhel7/</span></span><br><span class="line">total 124M</span><br><span class="line">-rw-------. 1 root root 202 Jun 10 15:27 README</span><br><span class="line">-rw-------. 1 root root 166K Jun 10 15:27 rear.log</span><br><span class="line">-rw-------. 1 root root 124M Jun 10 15:27 rear-rhel7.iso</span><br><span class="line">-rw-------. 1 root root 274 Jun 10 15:27 VERSION</span><br></pre></td></tr></table></figure>

<p><strong>Scheduling ReaR</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">contab -e</span></span><br><span class="line">0 22 * * 1-5 root /usr/sbin/rear mkrescue</span><br></pre></td></tr></table></figure>

<p><strong>Creating a Backup Using the Internal Backup Method</strong></p>
<p>With <strong>BACKUP&#x3D;NETFS</strong> set, ReaR can create either a rescue system, a backup file, or both. To create a rescue system only , run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rear mkrescue</span><br></pre></td></tr></table></figure>

<p>To create a backup only , run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rear mkbackuponly</span><br></pre></td></tr></table></figure>

<p>To create a rescue system and a backup , run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rear mkbackup</span><br></pre></td></tr></table></figure>

<p>Note that triggering backup with ReaR is only possible if using the NETFS method. ReaR cannot trigger other backup methods.  </p>
<p><strong>Performing a System Rescue</strong></p>
<p>To perform a restore or migration:</p>
<ol>
<li><p>Boot the rescue system on the new hardware. For example, burn the ISO image to a DVD and boot from the DVD.</p>
</li>
<li><p>In the console interface, select the “Recover” option:  </p>
<p><img src="https://s2.loli.net/2022/06/01/vxCj49WLuQUFyKg.png"></p>
</li>
<li><p>You are taken to the prompt: </p>
<p><img src="https://s2.loli.net/2022/06/01/uLfHGoKIm1zZvXr.png"></p>
</li>
<li><p>Run the <strong>rear recover</strong> command to perform the restore or migration. The rescue system then recreates the partition layout and filesystems: </p>
<p><img src="https://s2.loli.net/2022/06/01/qnkZHoQ2sVgp75T.png"></p>
</li>
<li><p>Restore user and system files from the backup into the &#x2F;mnt&#x2F;local&#x2F; directory. </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">scp root@192.168.122.7:/srv/backup/rhel7/backup.tar.gz /mnt/local/</span></span><br><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">tar xf /mnt/local/backup.tar.gz -C /mnt/local/</span></span><br><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash"><span class="built_in">rm</span> -f /mnt/local/backup.tar.gz</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify that the files have been restored: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash"><span class="built_in">ls</span> /mnt/local/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Ensure that SELinux relabels the files on the next boot: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash"><span class="built_in">touch</span> /mnt/local/.autorelabel</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Finish the recovery by entering <strong>exit</strong>. ReaR will then reinstall the boot loader. After that, <strong>reboot</strong> the system:</p>
<p><img src="https://s2.loli.net/2022/06/01/cCnZqQL18UiRgNJ.png"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Backup</category>
      </categories>
      <tags>
        <tag>rear</tag>
      </tags>
  </entry>
  <entry>
    <title>Installation</title>
    <url>/blog/posts/48bb149.html</url>
    <content><![CDATA[<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><h2 id="CLUSTER-SOFTWARE-INSTALLATION"><a href="#CLUSTER-SOFTWARE-INSTALLATION" class="headerlink" title="CLUSTER SOFTWARE INSTALLATION"></a>CLUSTER SOFTWARE INSTALLATION</h2><ol>
<li><p>On each node in the cluster, install the Red Hat High Availability Add-On software packages along with all available fence agents from the High Availability channel.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install pcs pacemaker fence-agents-all</span><br></pre></td></tr></table></figure>
</li>
<li><p>If you are running the firewalld daemon, execute the following commands to enable the ports that are required by the Red Hat High Availability Add-On.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">firewall-cmd --permanent --add-service=high-availability</span><br><span class="line">firewall-cmd --add-service=high-availability</span><br></pre></td></tr></table></figure>
</li>
<li><p>In order to use pcs to configure the cluster and communicate among the nodes, you must set a password on each node for the user ID hacluster, which is the pcs administration account. It is recommended that the password for user hacluster be the same on each node.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">passwd hacluster</span><br></pre></td></tr></table></figure>
</li>
<li><p>Before the cluster can be configured, the pcsd daemon must be started and enabled to boot on startup on each node. This daemon works with the pcs command to manage configuration across the nodes in the cluster.<br>On each node in the cluster, execute the following commands to start the pcsd service and to enable pcsd at system start.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start pcsd.service</span><br><span class="line">systemctl enable pcsd.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>Authenticate the pcs user hacluster for each node in the cluster on the node from which you will be running pcs.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pcs cluster auth z1.example.com z2.example.com</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="CLUSTER-CREATION"><a href="#CLUSTER-CREATION" class="headerlink" title="CLUSTER CREATION"></a>CLUSTER CREATION</h2><ol>
<li><p>Execute the following command from z1.example.com to create the two-node cluster my_cluster that consists of nodes z1.example.com and z2.example.com. This will propagate the cluster configuration files to both nodes in the cluster. This command includes the –start option, which will start the cluster services on both nodes in the cluster.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pcs cluster setup --start --name my_cluster z1.example.com z2.example.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enable the cluster services to run on each node in the cluster when the node is booted.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pcs cluster enable --all</span><br></pre></td></tr></table></figure>
</li>
<li><p>You can display the current status of the cluster with the pcs cluster status command. Because there may be a slight delay before the cluster is up and running when you start the cluster services with the –start option of the pcs cluster setup command, you should ensure that the cluster is up and running before performing any subsequent actions on the cluster and its configuration.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pcs cluster status</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Maintenance</title>
    <url>/blog/posts/a918773e.html</url>
    <content><![CDATA[<h1 id="Maintenance"><a href="#Maintenance" class="headerlink" title="Maintenance"></a>Maintenance</h1><p> 待机模式 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs node standby &lt;node&gt;</span><br><span class="line">pcs node unstandby &lt;node&gt;</span><br></pre></td></tr></table></figure>

<p> 维护模式 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs node maintenance &lt;node&gt;</span><br><span class="line">pcs node unmaintenance &lt;node&gt;</span><br></pre></td></tr></table></figure>

<p> 清除群集资源故障状态信息 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs cluster cleanup</span><br></pre></td></tr></table></figure>

<p> 移动群集资源 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs resource move &lt;resource&gt; &lt;node&gt;</span><br></pre></td></tr></table></figure>

<div class="note info simple"><p> 何种情况下，群集为防止脑裂会启动隔离机制 STONITH</p>
<ol>
<li> 群集节点间心跳网络故障，为防止节点争抢群集资源，会将投票数少的节点 STONITH</li>
<li> 某一节点发生故障，在资源无法正常释放情况下，为强制释放群集资源，会将该故障节点 STONITH</li>
</ol>
</div>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Ports</title>
    <url>/blog/posts/485effc9.html</url>
    <content><![CDATA[<h1 id="Ports"><a href="#Ports" class="headerlink" title="Ports"></a>Ports</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --permanent --add-service=high-availability</span></span><br><span class="line"><span class="comment"># firewall-cmd --add-service=high-availability</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Port</th>
<th>When Required</th>
</tr>
</thead>
<tbody><tr>
<td>TCP 2224</td>
<td>Required on all nodes (needed by the <code>pcsd</code> Web UI and required for node-to-node communication)<br><br>It is crucial to open port 2224 in such a way that <code>pcs</code> from any node can talk to all nodes in the cluster, including itself. When using the Booth cluster ticket manager or a quorum device you must open port 2224 on all related hosts, such as Booth arbiters or the quorum device host.</td>
</tr>
<tr>
<td>TCP 3121</td>
<td>Required on all nodes if the cluster has any Pacemaker Remote nodes<br><br>Pacemaker’s <code>crmd</code> daemon on the full cluster nodes will contact the <code>pacemaker_remoted</code> daemon on Pacemaker Remote nodes at port 3121. If a separate interface is used for cluster communication, the port only needs to be open on that interface. At a minimum, the port should open on Pacemaker Remote nodes to full cluster nodes. Because users may convert a host between a full node and a remote node, or run a remote node inside a container using the host’s network, it can be useful to open the port to all nodes. It is not necessary to open the port to any hosts other than nodes.</td>
</tr>
<tr>
<td>TCP 5403</td>
<td>Required on the quorum device host when using a quorum device with <code>corosync-qnetd</code>. The default value can be changed with the <code>-p</code> option of the <code>corosync-qnetd</code> command.</td>
</tr>
<tr>
<td>UDP 5404</td>
<td>Required on corosync nodes if <code>corosync</code> is configured for multicast UDP</td>
</tr>
<tr>
<td>UDP 5405</td>
<td>Required on all corosync nodes (needed by <code>corosync</code>)</td>
</tr>
<tr>
<td>TCP 21064</td>
<td>Required on all nodes if the cluster contains any resources requiring DLM (such as <code>clvm</code> or <code>GFS2</code>)</td>
</tr>
<tr>
<td>TCP 9929, UDP 9929</td>
<td>Required to be open on all cluster nodes and booth arbitrator nodes to connections from any of those same nodes when the Booth ticket manager is used to establish a multi-site cluster.</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle database in Pacemaker</title>
    <url>/blog/posts/d6fbce00.html</url>
    <content><![CDATA[<h1 id="Oracle-database-in-Pacemaker"><a href="#Oracle-database-in-Pacemaker" class="headerlink" title="Oracle database in Pacemaker"></a>Oracle database in Pacemaker</h1><h2 id="CONFIGURING-AN-LVM-VOLUME-WITH-AN-EXT4-FILE-SYSTEM"><a href="#CONFIGURING-AN-LVM-VOLUME-WITH-AN-EXT4-FILE-SYSTEM" class="headerlink" title="CONFIGURING AN LVM VOLUME WITH AN EXT4 FILE SYSTEM"></a>CONFIGURING AN LVM VOLUME WITH AN EXT4 FILE SYSTEM</h2><ol>
<li><p>Create an LVM physical volume</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pvcreate /dev/sdb1</span><br><span class="line">pvcreate /dev/sdc1</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create the volume group</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vgcreate data_vg /dev/sdb1</span><br><span class="line">vgcreate arch_vg /dev/sdc1</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a logical volume</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lvcreate -l +100%FREE -n data_lv data_vg</span><br><span class="line">lvcreate -l +100%FREE -n arch_lv arch_vg</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create an ext4 file system</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkfs.ext4 /dev/data_vg/data_lv</span><br><span class="line">mkfs.ext4 /dev/arch_vg/arch_lv</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="EXCLUSIVE-ACTIVATION-OF-A-VOLUME-GROUP-IN-A-CLUSTER"><a href="#EXCLUSIVE-ACTIVATION-OF-A-VOLUME-GROUP-IN-A-CLUSTER" class="headerlink" title="EXCLUSIVE ACTIVATION OF A VOLUME GROUP IN A CLUSTER"></a>EXCLUSIVE ACTIVATION OF A VOLUME GROUP IN A CLUSTER</h2><ol>
<li><p>Execute the following command to ensure that <strong>locking_type</strong> is set to 1 and that <strong>use_lvmetad</strong> is set to 0 in the <strong>&#x2F;etc&#x2F;lvm&#x2F;lvm.conf</strong> file. This command also disables and stops any lvmetad processes immediately.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lvmconf --enable-halvm --services --startstopservices</span><br></pre></td></tr></table></figure>
</li>
<li><p>Determine which volume groups are currently configured on your local storage with the following command.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vgs --noheadings -o vg_name</span></span><br><span class="line">  arch_vg</span><br><span class="line">  data_vg</span><br><span class="line">  rhel</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add the volume groups other than <strong>data_vg&#x2F;arch_vg</strong> (the volume group you have just defined for the cluster) as entries to <strong>volume_list</strong> in the &#x2F;etc&#x2F;lvm&#x2F;lvm.conf configuration file.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">volume_list = [<span class="string">&quot;rhel&quot;</span> ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Rebuild the <strong>initramfs</strong> boot image to guarantee that the boot image will not try to activate avolume group controlled by the cluster. Update the <strong>initramfs</strong> device with the following command. This command may take up to a minute to complete.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dracut -H -f /boot/initramfs-$(<span class="built_in">uname</span> -r).img $(<span class="built_in">uname</span> -r)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Reboot the node.</p>
</li>
<li><p>Start clusterservices on each of the nodes with the following command.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs cluster start --all</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="CREATING-THE-RESOURCES-AND-RESOURCE-GROUPS"><a href="#CREATING-THE-RESOURCES-AND-RESOURCE-GROUPS" class="headerlink" title="CREATING THE RESOURCES AND RESOURCE GROUPS"></a>CREATING THE RESOURCES AND RESOURCE GROUPS</h2><ol>
<li><p>Create LVM resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs resource create data_lvm LVM volgrpname=data_vg exclusive=<span class="literal">true</span> --group coco_inst_grp</span><br><span class="line">pcs resource create arch_lvm LVM volgrpname=arch_vg exclusive=<span class="literal">true</span> --group coco_inst_grp</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create Filesystem resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs resource create data_fs Filesystem \</span><br><span class="line">device=<span class="string">&quot;/dev/data_vg/data_lv&quot;</span> directory=<span class="string">&quot;/database/datafile&quot;</span> fstype=<span class="string">&quot;ext4&quot;</span> --group coco_inst_grp</span><br><span class="line">pcs resource create arch_fs Filesystem \</span><br><span class="line">device=<span class="string">&quot;/dev/arch_vg/arch_lv&quot;</span> directory=<span class="string">&quot;/database/archive&quot;</span> fstype=<span class="string">&quot;ext4&quot;</span> --group coco_inst_grp</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create VirtualIP resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs resource create VirtualIP IPaddr2 ip=192.168.184.149 \</span><br><span class="line">cidr_netmask=24 nic=ens32 --group coco_inst_grp</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create Oracle Database Listener resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs resource create coco_lsnr oralsnr \</span><br><span class="line">sid=<span class="string">&quot;coco&quot;</span> home=<span class="string">&quot;/u01/app/oracle/product/11.2.0/db_1&quot;</span> user=<span class="string">&quot;oracle&quot;</span> \</span><br><span class="line">listener=<span class="string">&quot;LISTENER&quot;</span> tns_admin=<span class="string">&quot;/u01/app/oracle/product/11.2.0/db_1/network/admin&quot;</span> --group coco_inst_grp</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create Oracle Database resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pcs resource create coco_inst oracle \</span><br><span class="line">sid=<span class="string">&quot;coco&quot;</span> home=<span class="string">&quot;/u01/app/oracle/product/11.2.0/db_1&quot;</span> user=<span class="string">&quot;oracle&quot;</span> --group coco_inst_grp</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Changing and Resetting the Root Password</title>
    <url>/blog/posts/497a035.html</url>
    <content><![CDATA[<h1 id="Changing-and-Resetting-the-Root-Password"><a href="#Changing-and-Resetting-the-Root-Password" class="headerlink" title="Changing and Resetting the Root Password"></a>Changing and Resetting the Root Password</h1><p>Setting up the root password is a mandatory part of the Red Hat Enterprise Linux 7 installation. If you forget or lose the root password it is possible to reset it, however users who are members of the wheel group can change the root password as follows:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]$ </span><span class="language-bash">sudo passwd root</span></span><br></pre></td></tr></table></figure>

<p>Note that in GRUB 2, resetting the password is no longer performed in single-user mode as it was in GRUB included in Red Hat Enterprise Linux 6. The root password is now required to operate in singleuser mode as well as in emergency mode.</p>
<h2 id="1-Resetting-the-Root-Password-Using-an-Installation-Disk"><a href="#1-Resetting-the-Root-Password-Using-an-Installation-Disk" class="headerlink" title="1 Resetting the Root Password Using an Installation Disk"></a>1 Resetting the Root Password Using an Installation Disk</h2><ol>
<li><p>Start the system and when BIOS information is displayed, select the option for a boot menu and<br>select to boot from the installation disk.</p>
</li>
<li><p>Choose <strong>Troubleshooting</strong>.</p>
</li>
<li><p>Choose <strong>Rescue a Red Hat Enterprise Linux System</strong>.</p>
</li>
<li><p>Choose Continue which is the default option. At this point you will be promoted for a passphrase if an encrypted file system is found.</p>
</li>
<li><p>Press <strong>OK</strong> to acknowledge the information displayed until the shell prompt appears.</p>
</li>
<li><p>Change the file system root as follows:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh-4.2# chroot /mnt/sysimage</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enter the passwd command and follow the instructions displayed on the command line to change the root password.</p>
</li>
<li><p>Remove the autorelable file to prevent a time consuming SELinux relabel of the disk:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh-4.2# rm -f /.autorelabel</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enter the <strong>exit</strong> command to exit the chroot environment.</p>
</li>
<li><p>Enter the <strong>exit</strong> command again to resume the initialization and finish the system boot.</p>
</li>
</ol>
<h2 id="2-Resetting-the-Root-Password-Using-rd-break"><a href="#2-Resetting-the-Root-Password-Using-rd-break" class="headerlink" title="2 Resetting the Root Password Using rd.break"></a>2 Resetting the Root Password Using rd.break</h2><ol>
<li><p>Start the system and, on the GRUB 2 boot screen, press the <strong>e</strong> key for edit.</p>
</li>
<li><p>Remove the <strong>rhgb</strong> and <strong>quiet</strong> parameters from the end, or near the end, of the linux16 line, or linuxefi on UEFI systems.<br>Press Ctrl+a and Ctrl+e to jump to the start and end of the line, respectively. On some systems, Home and End might also work.</p>
<hr>
<p><font color=important> IMPORTANT: The rhgb and quiet parameters must be removed in order to enable system messages. </font></p>
<hr>
</li>
<li><p>Add the following parameters at the end of the <strong>linux</strong> line on 64-Bit IBM Power Series, the <strong>linux16</strong> line on x86-64 BIOS-based systems, or the <strong>linuxefi</strong> line on UEFI systems:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rd.break enforcing=0</span><br></pre></td></tr></table></figure>

<p>Adding the <strong>enforcing&#x3D;0</strong> option enables omitting the time consuming SELinux relabeling process.</p>
<p>The initramfs will stop before passing control to the Linux kernel, enabling you to work with the root file system.<br>Note that the initramfs prompt will appear on the last console specified on the Linux line.</p>
</li>
<li><p>Press <strong>Ctrl+x</strong> to boot the system with the changed parameters.<br>With an encrypted file system, a password is required at this point. However the password prompt might not appear as it is obscured by logging messages. You can press the Backspace key to see the prompt. Release the key and enter the password for the encrypted file system, while ignoring the logging messages. The initramfs switch_root prompt appears.</p>
</li>
<li><p>The file system is mounted read-only on &#x2F;sysroot&#x2F;. You will not be allowed to change the password if the file system is not writable.<br>Remount the file system as writable:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">switch_root:/# mount -o remount,rw /sysroot</span><br></pre></td></tr></table></figure>
</li>
<li><p>The file system is remounted with write enabled.<br>Change the file system’s root as follows:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">switch_root:/# chroot /sysroot</span><br></pre></td></tr></table></figure>

<p>The prompt changes to sh-4.2#.</p>
</li>
<li><p>Enter the passwd command and follow the instructions displayed on the command line to change the root password.<br>Note that if the system is not writable, the passwd tool fails with the following error:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Authentication token manipulation error</span><br></pre></td></tr></table></figure>
</li>
<li><p>Updating the password file results in a file with the incorrect SELinux security context. To relabel all files on next system boot, enter the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh-4.2# touch /.autorelabel</span><br></pre></td></tr></table></figure>

<p>Alternatively, to save the time it takes to relabel a large disk, you can omit this step provided you included the enforcing&#x3D;0 option in step 3.</p>
</li>
<li><p>Remount the file system as read only:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh-4.2# mount -o remount,ro /</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enter the <strong>exit</strong> command to exit the chroot environment.</p>
</li>
<li><p>Enter the <strong>exit</strong> command again to resume the initialization and finish the system boot.<br>With an encrypted file system, a pass word or phrase is required at this point. However the password prompt might not appear as it is obscured by logging messages. You can press and hold the Backspace key to see the prompt. Release the key and enter the password for the encrypted file system, while ignoring the logging messages.</p>
<hr>
<p><font color=notice>NOTE: The SELinux relabeling process can take a long time. A system reboot<br>will occur automatically when the process is complete.</font></p>
<hr>
</li>
<li><p>If you added the enforcing&#x3D;0 option in step 3 and omitted the touch &#x2F;.autorelabel command in step 8, enter the following command to restore the &#x2F;etc&#x2F;shadow file’s SELinux security context:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">restorecon /etc/shadow</span></span><br></pre></td></tr></table></figure>

<p>Enter the following commands to turn SELinux policy enforcement back on and verify that it is on:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">setenforce 1</span></span><br><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">getenforce</span></span><br><span class="line">Enforcing</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating a second instance of the sshd service</title>
    <url>/blog/posts/622bfdea.html</url>
    <content><![CDATA[<h1 id="Creating-a-second-instance-of-the-sshd-service"><a href="#Creating-a-second-instance-of-the-sshd-service" class="headerlink" title="Creating a second instance of the sshd service"></a>Creating a second instance of the sshd service</h1><p>System Administrators often need to configure and run multiple instances of a service. This is done by creating copies of the original service configuration files and modifying certain parameters to avoid conflicts with the primary instance of the service. The following procedure shows how to create a second instance of the sshd service:</p>
<ol>
<li><p>Create a copy of the sshd_config file that will be used by the second daemon:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># cp /etc/ssh/sshd&#123;,-second&#125;_config</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Edit the sshd-second_config file created in the previous step to assign a different port number and PID file to the second daemon:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Port 22220</span><br><span class="line">PidFile /var/run/sshd-second.pid</span><br></pre></td></tr></table></figure>

<p> See the sshd_config(5) manual page for more information on Port and PidFile options. Make sure the port you choose is not in use by any other service. The PID file does not have to exist before running the service, it is generated automatically on service start.</p>
</li>
<li><p>Create a copy of the systemd unit file for the sshd service:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># cp /usr/lib/systemd/system/sshd.service /etc/systemd/system/sshd-second.service</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Alter the sshd-second.service created in the previous step as follows:<br> a. Modify the Description option:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Description=OpenSSH server second instance daemon</span><br></pre></td></tr></table></figure>

<p> b. Add sshd.service to services specified in the After option, so that the second instance starts only after the first one has already started:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">After=syslog.target network.target auditd.service sshd.service</span><br></pre></td></tr></table></figure>

<p> c. The first instance of sshd includes key generation, therefore remove the <code>ExecStartPre=/usr/sbin/sshd-keygen</code> line.</p>
<p> d. Add the -f &#x2F;etc&#x2F;ssh&#x2F;sshd-second_config parameter to the sshd command, so that the alternative configuration file is used:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ExecStart=/usr/sbin/sshd -D -f /etc/ssh/sshd-second_config <span class="variable">$OPTIONS</span></span><br></pre></td></tr></table></figure>

<p> e. After the above modifications, the sshd-second.service should look as follows:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=OpenSSH server second instance daemon</span><br><span class="line">After=syslog.target network.target auditd.service sshd.service</span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/etc/sysconfig/sshd</span><br><span class="line">ExecStart=/usr/sbin/sshd -D -f /etc/ssh/sshd-second_config <span class="variable">$OPTIONS</span></span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=42s</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
</li>
<li><p>If using SELinux, add the port for the second instance of sshd to SSH ports, otherwise the second instance of sshd will be rejected to bind to the port:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># semanage port -a -t ssh_port_t -p tcp 22220</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Enable sshd-second.service, so that it starts automatically upon boot:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># systemctl enable sshd-second.service</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Verify if the sshd-second.service is running by using the systemctl status command. Also, verify if the port is enabled correctly by connecting to the service:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]$ ssh -p 22220 user@server</span><br></pre></td></tr></table></figure>
</li>
<li><p>If the firewall is in use, make sure that it is configured appropriately in order to allow connections to the second instance of sshd.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># firewall-cmd --add-port=22220/tcp</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>sshd</tag>
      </tags>
  </entry>
  <entry>
    <title>How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</title>
    <url>/blog/posts/ffa54a43.html</url>
    <content><![CDATA[<h1 id="How-to-disable-transparent-hugepages-THP-on-Red-Hat-Enterprise-Linux-7-8-and-9"><a href="#How-to-disable-transparent-hugepages-THP-on-Red-Hat-Enterprise-Linux-7-8-and-9" class="headerlink" title="How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9"></a>How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</h1><h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><ul>
<li>Red Hat Enterprise Linux 7</li>
<li>Red Hat Enterprise Linux 8</li>
<li>Red Hat Enterprise Linux 9</li>
<li>transparent hugepages (THP)</li>
<li>tuned</li>
</ul>
<h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><ul>
<li>How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</li>
<li>Disabling transparent hugepages (THP) on Red Hat Enterprise Linux 7 is not taking effect.</li>
</ul>
<h2 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h2><p>Follow the steps below</p>
<p>Add the “transparent_hugepage&#x3D;never” kernel parameter option to the grub2 configuration file.</p>
<p>Append or change the <code>transparent_hugepage=never</code> kernel parameter on the <strong>GRUB_CMDLINE_LINUX</strong> option in <code>/etc/default/grub</code> file. Only include the parameter once.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -p /etc/default/grub&#123;,.bak.`<span class="built_in">date</span> +%m%d`&#125;</span><br><span class="line">sed -i <span class="string">&#x27;/GRUB_CMDLINE_LINUX/ s/&quot;$/ transparent_hugepage=never&quot;/&#x27;</span> /etc/default/grub</span><br></pre></td></tr></table></figure>

<p>Verify the parameter is set correctly</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap ... transparent_hugepage=never&quot;</span></span><br></pre></td></tr></table></figure>

<p>Rebuild the &#x2F;boot&#x2F;grub2&#x2F;grub.cfg file by running the grub2-mkconfig -o command as follows:<br>Please ensure to take a backup of the existing &#x2F;boot&#x2F;grub2&#x2F;grub.cfg before rebuilding.</p>
<ul>
<li>Detect whether Linux runs in UEFI or BIOS mode: <code>[-d /sys/firmware/efi] &amp;&amp; echo UEFI || echo BIOS</code></li>
<li>On BIOS-based machines: ~]# <code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></li>
<li>On UEFI-based machines: ~]# <code>grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg</code></li>
</ul>
<p>Reboot the system and verify option has been added.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># shutdown -r now</span></span><br></pre></td></tr></table></figure>

<p>Verify the parameter is set correctly</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat /proc/cmdline</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="If-Transparent-Huge-Pages-THP-is-still-not-disabled-continue-and-use-one-of-the-options-below"><a href="#If-Transparent-Huge-Pages-THP-is-still-not-disabled-continue-and-use-one-of-the-options-below" class="headerlink" title="If Transparent Huge Pages (THP) is still not disabled, continue and use one of the options below."></a>If Transparent Huge Pages (THP) is still not disabled, continue and use one of the options below.</h1><h2 id="Option-1-Recommended-create-a-customized-tuned-profile-with-disabled-THP"><a href="#Option-1-Recommended-create-a-customized-tuned-profile-with-disabled-THP" class="headerlink" title="Option 1: (Recommended) create a customized tuned profile with disabled THP"></a>Option 1: (Recommended) create a customized tuned profile with disabled THP</h2><p>With this resolution we will create a customized version of the currently running profile. The customized version will disable THP.<br>Find out which profile is active, create a copy. In the following example we currently use the throughput-performance profile:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tuned-adm active</span></span><br></pre></td></tr></table></figure>

<p>Current active profile: throughput-performance<br>To create customized profile, create a new directory in &#x2F;etc&#x2F;tuned directory with desired profile name.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mkdir /etc/tuned/myprofile-nothp</span></span><br></pre></td></tr></table></figure>

<p>Then create a new tuned.conf file for myprofile-nothp, and insert the new tuning info:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat /etc/tuned/myprofile-nothp/tuned.conf </span></span><br><span class="line">[main]</span><br><span class="line">include=throughput-performance</span><br><span class="line"></span><br><span class="line">[vm]</span><br><span class="line">transparent_hugepages=never</span><br></pre></td></tr></table></figure>

<p>Make the script executable:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># chmod +x /etc/tuned/myprofile-nothp/tuned.conf</span></span><br></pre></td></tr></table></figure>

<p>Enable myprofile like so:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tuned-adm profile myprofile-nothp</span></span><br></pre></td></tr></table></figure>

<p>This change will immediately take effect and persist reboots.</p>
<p>To verify if THP are disabled or not, run below command:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span></span><br></pre></td></tr></table></figure>

<h2 id="Option-2-Alternative-Disable-tuned-services"><a href="#Option-2-Alternative-Disable-tuned-services" class="headerlink" title="Option 2: (Alternative) Disable tuned services"></a>Option 2: (Alternative) Disable tuned services</h2><p>This resolution will disable the tuned services.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># systemctl stop tuned</span></span><br><span class="line"><span class="comment"># systemctl disable tuned</span></span><br><span class="line">OR</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="comment"># tuned-adm off</span></span><br></pre></td></tr></table></figure>

<p>Now add “transparent_hugepage&#x3D;never” kernel parameter in grub2 configuration file as explained in steps 1-3 above.<br>Reboot the server for changes to take effect.</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>THP</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating Custom Unit Files</title>
    <url>/blog/posts/9e6e8cc7.html</url>
    <content><![CDATA[<h1 id="Creating-Custom-Unit-Files"><a href="#Creating-Custom-Unit-Files" class="headerlink" title="Creating Custom Unit Files"></a>Creating Custom Unit Files</h1><ol>
<li><p>Prepare the executable file with the custom service. This can be a custom-created script, or an executable delivered by a software provider. If required, prepare a PID file to hold a constant PID for the main process of the custom service. It is also possible to include environment files to store shell variables for the service. Make sure the source script is executable (by executing the <strong>chmod a+x</strong>) and is not interactive.</p>
</li>
<li><p>Create a unit file in the &#x2F;etc&#x2F;systemd&#x2F;system&#x2F; directory and make sure it has correct file permissions. Execute as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">touch</span> /etc/systemd/system/name.service</span><br><span class="line"><span class="built_in">chmod</span> 664 /etc/systemd/system/name.service</span><br></pre></td></tr></table></figure>

<p>Replace name with a name of the service to be created. Note that file does not need to be executable.</p>
</li>
<li><p>Open the name.service file created in the previous step, and add the service configuration options. There is a variety of options that can be used depending on the type of service you wish to create, The following is an example unit configuration for a network-related service:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=service_description</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">ExecStart=path_to_executable</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=path_to_pidfile</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure>

<p>Where:</p>
<ul>
<li><em>service_description</em> is an informative description that is displayed in journal log files and in the output of the <strong>systemctl status</strong> command.</li>
<li>the <strong>After</strong> setting ensures that the service is started only after the network is running. Add a space-separated list of other relevant services or targets.</li>
<li><em>path_to_executable</em> stands for the path to the actual service executable.</li>
<li><strong>WantedBy</strong> states the target or targets that the service should be started under. Think of these targets as of a replacement of the older concept of runlevels.</li>
<li><strong>Type&#x3D;forking</strong> is used for daemons that make the fork system call. The main process of the service is created with - the PID specified in path_to_pidfile.</li>
</ul>
</li>
<li><p>Notify systemd that a new name.service file exists by executing the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start name.service</span><br></pre></td></tr></table></figure></li>
</ol>
<p>:::warning<br>Always run the systemctl daemon-reload command after creating new unit files or modifying existing unit files. Otherwise, the systemctl start or systemctl enable commands could fail due to a mismatch between states<br>of systemd and actual service unit files on disk.</font><br>:::</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating a Yum Repository</title>
    <url>/blog/posts/1bb50798.html</url>
    <content><![CDATA[<h1 id="Creating-a-Yum-Repository"><a href="#Creating-a-Yum-Repository" class="headerlink" title="Creating a Yum Repository"></a>Creating a Yum Repository</h1><p>To set up a yum repository:</p>
<ol>
<li><p>Install the createrepo package:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install createrepo</span><br></pre></td></tr></table></figure>
</li>
<li><p>Copy all packages for your new repository into one directory, such as &#x2F;tmp&#x2F;local_repo&#x2F;:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /your/packages/*.rpm /tmp/local_repo/</span><br></pre></td></tr></table></figure>
</li>
<li><p>To create the repository run:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">createrepo /tmp/local_repo/</span><br></pre></td></tr></table></figure>

<p>This creates the necessary metadata for the yum repository and places metadata in a newly created subdirectory repodata.</p>
</li>
</ol>
<p>The repository is now ready to be consumed by yum. This repository can be shared over the HTTP or FTP protocol, or refered directly from the local machine.</p>
<hr>
<p><font color=notice>NOTE: When constructing the URL for a repository, refer to the &#x2F;mnt&#x2F;local_repo not to &#x2F;mnt&#x2F;local_repo&#x2F;repodata, as this directory contains only metadata. Actual yum packages are in &#x2F;mnt&#x2F;local_repo.</font></p>
<hr>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>yum</tag>
      </tags>
  </entry>
  <entry>
    <title>Found Duplicate PV</title>
    <url>/blog/posts/cf80567.html</url>
    <content><![CDATA[<p>存储 LUN 做 LVM 时，出现如下报错：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# pvs</span><br><span class="line">Found duplicate PV gdJ3qQtqoOjwZs2dtFw9vP0zIpz0HQhj: using /dev/sdba not /dev/emcpowerai</span><br><span class="line">Found duplicate PV 8jLc3hNNwiSnGz4fEEasw8PQwthrGBpO: using /dev/sdbq not /dev/emcpowers</span><br><span class="line">Found duplicate PV BY29XsIxW1I4LUOcoqAepnG7eGUcPxZl: using /dev/emcpoweru not /dev/sdbo</span><br></pre></td></tr></table></figure>

<p>在默认配置下，LVM 对所有磁盘进行扫描，以确定哪一块上面包含 PV。如果使用了 device-mapper-multipath 或其他多路径软件如 EMC PowerPath 或 Hitachi Dynamic Link Manager (HDLM)，那么对于每一个 LUN 的每一条路径就注册成为一个不同的 SCSI 设备。如 &#x2F;dev&#x2F;sdb，&#x2F;dev&#x2F;sdc，等等。多路径软件之后会创建一个新的设备映射到这些路径如：&#x2F;dev&#x2F;mapper&#x2F;mpath1 (device-mapper-multipath)，&#x2F;dev&#x2F;emcpowerb (EMC PowerPath)，或 &#x2F;dev&#x2F;sddlmab (HDLM)。由于每一个设备都指向同一个 LUN，所以它们都包含相同的 LVM 元数据，因此在扫描时显示为 duplicate。运行任何 LVM 命令，都会出现重复 PV 告警。<br>所以要确保 LVM 只扫描想要的多路径设备而不是单条路径，需要在 <code>/etc/lvm/lvm.conf</code> 文件中加上过滤条件，格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Example</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Accept every block device:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter = [<span class="string">&quot;a|.*|&quot;</span> ]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Reject the cdrom drive:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter = [<span class="string">&quot;r|/dev/cdrom|&quot;</span> ]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Work with just loopback devices, e.g. <span class="keyword">for</span> testing:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter = [<span class="string">&quot;a|loop|&quot;</span>, <span class="string">&quot;r|.*|&quot;</span> ]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Accept all loop devices and ide drives except hdc:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter = [<span class="string">&quot;a|loop|&quot;</span>, <span class="string">&quot;r|/dev/hdc|&quot;</span>, <span class="string">&quot;a|/dev/ide|&quot;</span>, <span class="string">&quot;r|.*|&quot;</span> ]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use anchors to be very specific:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter = [<span class="string">&quot;a|^/dev/hda8$|&quot;</span>, <span class="string">&quot;r|.*|&quot;</span> ]</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This configuration option has an automatic default value.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter = [<span class="string">&quot;a|.*|&quot;</span> ]</span></span><br></pre></td></tr></table></figure>

<p>过滤语法接收多重条件。形式如 “a” (add) or “r” (remove)，中间以逗号为间隔。所有符合 add 条件的设备都会被扫描，同时忽略所有符合 remove 条件的设备。<br>注意：如果本地存储设备包含物理卷，确保除了多路径设备外，这些设备也包含在过滤条件中。<br>比如，只扫描 device-mapper-multipath 设备：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">filter = [&quot;a|/dev/mapper/mpath.*|&quot;, &quot;r|.*|&quot;]</span><br></pre></td></tr></table></figure>

<p>只扫描 EMC PowerPath 设备:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">filter = [&quot;a|/dev/emcpower.*|&quot;, &quot;r|.*|&quot;]</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>lvm</tag>
      </tags>
  </entry>
  <entry>
    <title>HugePages</title>
    <url>/blog/posts/564cfbab.html</url>
    <content><![CDATA[<h1 id="HugePages"><a href="#HugePages" class="headerlink" title="HugePages"></a>HugePages</h1><h2 id="简介"><a href="# 简介" class="headerlink" title="简介"></a>简介</h2><p>HugePages 是 Linux 内核的一个特性，它允许更大的页面管理内存，以替代 4KB 的页面大小。</p>
<p>操作系统把逻辑地址映射成物理地址时，需要把映射关系也存储到一块内存中，这部分内容就是页表（PageTables）。计算机内存是通过表映射（页表）的方式进行内存寻址。CPU 拥有内置的内存管理单元，包含这些页面的列表，每个页面通过页表条目引用。当内存越来越大的时候， CPU 需要管理这些内存页的成本也就越高，这样会对操作系统的性能产生影响。 在 64 位机器上，目前系统默认内存以 4KB 为一个页，作为内存寻址的最小单元，随着内存和进程数的不断增大，页表的大小将会不断增大。内存是以块即页的方式进行管理的，当前大部分系统默认的页大小为 4096 bytes 即 4K 。 1MB 内存等于 256 页； 1GB 内存等于 256000 页。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># getconf PAGESIZE</span></span><br><span class="line">4096</span><br></pre></td></tr></table></figure>

<p>在 Linux 操作系统中，即使是同一块共享内存，每个进程中的逻辑地址也是不相同的，因此不同进程中的映射表项也不相同。在 64 位的机器上，每个 4k 页需要占用大约 8 字节的内存，一台 48GB 内存的机器，如果分配了 24GB 的共享内存，则每个进程的页表大小为 24GB&#x2F;4K*8&#x3D;48MB；如果连接上 500 个进程，那么页表的大小将是 500*48MB&#x3D;24GB。这会立刻把机器上的所有内存吃光。当然，并不是每个新连接一连接上来就会分配 48MB，而是当进程需要建立逻辑地址和物理地址之间的映射关系时才会分配，所以，进程占用的页表空间是缓慢增加的，但最终还是会占用很大的页表内存。 页表是必须装在内存的，而且是在 CPU 内存，太大就会发生大量 miss，内存寻址性能就会下降。<br>要查看是否存在大页表的问题，可以使用如下的命令来检查页表的大小：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># grep PageTables /proc/meminfo</span></span><br><span class="line">PageTables:        82588 kB</span><br></pre></td></tr></table></figure>

<p>如果发现页表的大小不是几十兆，而是达到了 1GB 以上，就说明共享内存使用存在此问题。基于共享内存的多进程架构的程序都会存在此问题。<br>Huge Page 就是为了解决这个问题，它使用 2MB 的大页代替传统小页 4KB 来管理内存，这样页表大小就可以控制的很小，进而全部装在 CPU 内存，防止出现 miss。</p>
<blockquote>
<p>在 Linux 中，大页分为两种：一是静态大页面（Static Huge Pages，SHP）也称为标准大页，二是透明大页面（Transparent Huge Pages，THP）。从它们的名字就可以看出，SHP 是静态的，而 THP 是动态的。由于 THP 是在运行期做分配和管理，因此会有一定程度的延迟，对于内存密集型的应用（例如数据库类）十分不利，必须关闭它。</p>
</blockquote>
<h2 id="Static-HugePages（标准大页）"><a href="#Static-HugePages（标准大页）" class="headerlink" title="Static HugePages（标准大页）"></a>Static HugePages（标准大页）</h2><p>Huge pages 是从 Linux Kernel 2.6 后被引入的，目的是通过使用大页内存来取代传统的 4kb 内存页面，以适应越来越大的系统内存，让操作系统可以支持现代硬件架构的大页面容量功能。<br>Huge pages 有两种格式大小：2MB 和 1GB，2MB 页块大小适合用于 GB 大小的内存，1GB 页块大小适合用于 TB 级别的内存；2MB 是默认的页大小。</p>
<p>标准大页的页面大小：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle-rac1 ~]<span class="comment"># grep Hugepagesize /proc/meminfo</span></span><br><span class="line">Hugepagesize:       2048 kB</span><br></pre></td></tr></table></figure>

<p><strong>使用 Huge Pages 优点</strong></p>
<ul>
<li>适合大内存或内存密集型应用（例如数据库）的调优。</li>
<li>减小页表尺寸（避免页表过大），降低查找缓存（TLB，Translation Lookaside Buffer)的 cache-miss，加速 VM 内存转换。</li>
<li>可以使花费在内存管理上的 CPU 时间更少，从而提高性能。</li>
</ul>
<p><strong>使用 Huge Pages 缺点</strong></p>
<ul>
<li>开启该功能需要进行额外设置，不同的数据库配置方法不同。</li>
<li>大页内存一旦设置，内存就实际分配出去了，也会一直驻留在内存中，不会被交换出去。若数据库没有使用这部分大页，那么相当于这部分大页内存是白白浪费掉的，因为它不会给文件系统缓存使用，也不能给其它不使用大页内存的程序使用。</li>
</ul>
<h2 id="Transparent-HugePages（透明大页）"><a href="#Transparent-HugePages（透明大页）" class="headerlink" title="Transparent HugePages（透明大页）"></a>Transparent HugePages（透明大页）</h2><p>Transparent Huge Pages 缩写 THP，这个是 <strong>RHEL 6</strong> 开始引入的一个功能，只支持 2M 页块，在 Linux 6 上透明大页是 <strong> 默认启用 </strong> 的。<br>由于 Huge pages 很难手动管理，而且通常需要对代码进行重大的更改才能有效的使用，因此 RHEL 6 开始引入了 Transparent Huge Pages（THP），THP 是一个抽象层，能够自动创建、管理和使用传统大页。THP 为系统管理员和开发人员减少了很多使用传统大页的复杂性，因为 THP 的目标是改进性能，因此其它开发人员（来自社区和红帽）已在各种系统、配置、应用程序和负载中对 THP 进行了测试和优化。这样可让 THP 的默认设置改进大多数系统配置性能。但是，<font color=recommand>不建议对数据库工作负载使用 THP （Oracle、MySQL、PostgreSQL、MongoDB 均建议关闭 THP）</font>，因为 THP 在运行时动态分配内存，而运行时的内存分配会有延迟，对于数据库的管理来说并不友好，会导致数据库性能抖动。</p>
<p><strong>如何关闭 THP？（禁用透明大页）</strong></p>
<p>检查当前的 transparent_hugepage 状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span></span><br><span class="line">always [madvise] never</span><br></pre></td></tr></table></figure>

<blockquote>
<p>never 关闭，不使用透明大页内存<br>always 尽量使用透明内存，扫描内存，有 512 个 4k 页面可以整合，就整合成一个 2M 的页面<br>madvise 避免改变内存占用，表示只在 MADV_HUGEPAGE 标志的 VMA 中使用 THP</p>
</blockquote>
<p><strong>运行时关闭：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure>

<p><strong>启动时关闭：</strong></p>
<p>GRUB 配置文件备份</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/default/grub /etc/default/grub.`<span class="built_in">date</span> +%F`.bak</span><br><span class="line"><span class="built_in">cp</span> /boot/grub2/grub.cfg /boot/grub2/grub.cfg.`<span class="built_in">date</span> +%F`.bak</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/etc/default/grub</code> 文件，在 <code>GRUB_CMDLINE_LINUX</code> 那一行后面追加 <code>transparent_hugepage=never</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># cat /etc/default/grub</span></span><br><span class="line">GRUB_TIMEOUT=5</span><br><span class="line">GRUB_DISTRIBUTOR=<span class="string">&quot;<span class="subst">$(sed &#x27;s, release .*$,,g&#x27; /etc/system-release)</span>&quot;</span></span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_DISABLE_SUBMENU=<span class="literal">true</span></span><br><span class="line">GRUB_TERMINAL_OUTPUT=<span class="string">&quot;console&quot;</span></span><br><span class="line">GRUB_CMDLINE_LINUX=<span class="string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never&quot;</span></span><br><span class="line">GRUB_DISABLE_RECOVERY=<span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>grub2-mkconfig</code> 重新生成 <code>grub.cfg</code> 配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line">reboot   <span class="comment"># 重启后生效</span></span><br></pre></td></tr></table></figure>

<p>重启后状态确认</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># cat /proc/cmdline </span></span><br><span class="line">BOOT_IMAGE=/vmlinuz-3.10.0-1127.el7.x86_64 root=/dev/mapper/rhel-root ro crashkernel=auto rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rd.lvm.lv=rhel/usr rhgb quiet transparent_hugepage=never</span><br><span class="line"></span><br><span class="line">[root@rac1 ~]<span class="comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span></span><br><span class="line">always madvise [never]</span><br></pre></td></tr></table></figure>

<p>如果未成功关闭，可能是由于 <code>tuned</code> 和<code>ktune</code>造成的，请参考以下 KB</p>
<ul>
<li><a href="https://access.redhat.com/solutions/422283">Disabling transparent hugepages (THP) on Red Hat Enterprise Linux 6 is not taking effect</a></li>
<li><a href="https://access.redhat.com/solutions/4968001">Disable Transparent Huge Pages(THP) persistently not working on RHEL7</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>hugepages</tag>
      </tags>
  </entry>
  <entry>
    <title>Introduction to grub 2</title>
    <url>/blog/posts/cc3df016.html</url>
    <content><![CDATA[<h1 id="Introduction-to-grub-2"><a href="#Introduction-to-grub-2" class="headerlink" title="Introduction to grub 2"></a>Introduction to grub 2</h1><p><strong>GRUB 2 配置文件的路径：</strong></p>
<p>​    <strong>BIOS-based</strong></p>
<p>​    <code>/boot/grub2/grub.cfg</code></p>
<p>​    <strong>UEFI</strong></p>
<p>​    <code>/boot/efi/EFI/redhat/grub.cfg</code></p>
<p><strong>Menu Entries in grub.cfg</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">menuentry &#x27;Red Hat Enterprise Linux Server&#x27; --class red --class gnu-linux --class gnu --class os</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">menuentry_id_option <span class="string">&#x27;gnulinux-simple-c60731dc-9046-4000-9182-64bdcce08616&#x27;</span> &#123;</span></span><br><span class="line">    load_video</span><br><span class="line">    set gfxpayload=keep</span><br><span class="line">    insmod gzio</span><br><span class="line">    insmod part_msdos</span><br><span class="line">    insmod xfs</span><br><span class="line">    set root=&#x27;hd0,msdos1&#x27;</span><br><span class="line">    if [x$feature_platform_search_hint = xy]; then</span><br><span class="line">        search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hintbaremetal=ahci0,msdos1 --hint=&#x27;hd0,msdos1&#x27; 19d9e294-65f8-4e37-8e73-d41d6daa6e58</span><br><span class="line">    else</span><br><span class="line">        search --no-floppy --fs-uuid --set=root 19d9e294-65f8-4e37-8e73-d41d6daa6e58</span><br><span class="line">    fi</span><br><span class="line">    echo &#x27;Loading Linux 3.8.0-0.40.el7.x86_64 ...&#x27;</span><br><span class="line">    linux16 /vmlinuz-3.8.0-0.40.el7.x86_64 root=/dev/mapper/rhel-root ro rd.md=0 rd.dm=0</span><br><span class="line">rd.lvm.lv=rhel/swap crashkernel=auto rd.luks=0 vconsole.keymap=us rd.lvm.lv=rhel/root rhgb quiet</span><br><span class="line">    echo &#x27;Loading initial ramdisk ...&#x27;</span><br><span class="line">    initrd /initramfs-3.8.0-0.40.el7.x86_64.img</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>linux</strong> on 64-bit IBM POWER Series, <strong>linux16</strong> on x86_64 BIOS-based systems, and <strong>linuxefi</strong> on UEFI-based systems.</p>
<p>The <strong>initrd</strong> directives followed by the path to the kernel and the <strong>initramfs</strong> image respectively.</p>
<h2 id="Configuring-GRUB-2-to-Require-a-Password-only-for-Modifying-Entries"><a href="#Configuring-GRUB-2-to-Require-a-Password-only-for-Modifying-Entries" class="headerlink" title="Configuring GRUB 2 to Require a Password only for Modifying Entries"></a>Configuring GRUB 2 to Require a Password only for Modifying Entries</h2><ol>
<li><p>Run the grub2-setpassword command as root:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">~]# </span><span class="language-bash">grub2-setpassword</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Enter and confirm the password:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Enter password:</span><br><span class="line">Confirm password:  </span><br></pre></td></tr></table></figure></li>
</ol>
<p>Following this procedure creates a <strong>&#x2F;boot&#x2F;grub2&#x2F;user.cfg</strong> file that contains the hash of the password. The user for this password, <strong>root</strong>, is defined in the <strong>&#x2F;boot&#x2F;grub2&#x2F;grub.cfg</strong> file. With this change, modifying a boot entry during booting requires you to specify the <strong>root</strong> user name and your password.  </p>
<h2 id="Changing-the-Default-Boot-Entry"><a href="#Changing-the-Default-Boot-Entry" class="headerlink" title="Changing the Default Boot Entry"></a>Changing the Default Boot Entry</h2><p>GRUB 2 supports using a numeric value as the key for the saved entry directive to change the default order in which the operating systems are loaded. To specify which operating system should be loaded first, pass its number to the grub2-set-default command. For example:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># grub2-set-default 2</span></span><br></pre></td></tr></table></figure>

<p>To force a system to always use a particular menu entry, use the menu entry name as the key to the GRUB_DEFAULT directive in the &#x2F;etc&#x2F;default&#x2F;grub file. To list the available menu entries, run the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># awk -F\&#x27; &#x27;$1==&quot;menuentry &quot; &#123;print $2&#125;&#x27; /etc/grub2.cfg</span></span><br></pre></td></tr></table></figure>

<h2 id="Rebuilding-the-grub-cfg-file"><a href="#Rebuilding-the-grub-cfg-file" class="headerlink" title="Rebuilding the grub.cfg file"></a>Rebuilding the grub.cfg file</h2><p>Changes to &#x2F;etc&#x2F;default&#x2F;grub require rebuilding the grub.cfg file as follows:<br>On BIOS-based machines, issue the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br></pre></td></tr></table></figure>

<p>On UEFI-based machines, issue the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">~]<span class="comment"># grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>grub2</tag>
      </tags>
  </entry>
  <entry>
    <title>Shrinking XFS root partition</title>
    <url>/blog/posts/3008d1b6.html</url>
    <content><![CDATA[<h1 id="Shrinking-XFS-root-partition"><a href="#Shrinking-XFS-root-partition" class="headerlink" title="Shrinking XFS root partition"></a>Shrinking XFS root partition</h1><ol>
<li><p><strong>Reboot the system in Rescue Mode by booting Installation Media</strong></p>
<p>Select <strong>Rescue a Oracle Linux system</strong>.</p>
<p><img src="https://s2.loli.net/2022/06/01/ma2ZBpIdWszn4ev.png"></p>
<p>Select option <strong>3 - Skip to shell</strong>.</p>
<p><img src="https://s2.loli.net/2022/06/01/YDpByUNX738jhzT.png"></p>
</li>
<li><p><strong>Preparing a backup by xfs_dump</strong></p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># lvs --segments -o +devices</span></span><br><span class="line">  LV      VG      Attr       <span class="comment">#Str Type   SSize  Devices</span></span><br><span class="line">  data_lv data_vg -wi-------    1 linear 10.00g /dev/sdb1(0)</span><br><span class="line">  log_lv  log_vg  -wi-------    1 linear  4.99g /dev/sdc1(0)</span><br><span class="line">  home    rhel    -wi-a-----    1 linear 26.99g /dev/sda2(512)</span><br><span class="line">  root    rhel    -wi-a-----    1 linear 50.00g /dev/sda2(7422)</span><br><span class="line">  root    rhel    -wi-a-----    1 linear &lt;5.00g /dev/sdd1(0)</span><br><span class="line">  swap    rhel    -wi-a-----    1 linear  2.00g /dev/sda2(0)</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgchange -a y rhel</span></span><br><span class="line">  3 logical volume(s) <span class="keyword">in</span> volume group <span class="string">&quot;rhel&quot;</span> now active</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /mnt/root</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /mnt/home</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/rhel/root /mnt/root/</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/rhel/home /mnt/home/</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># xfsdump -f /mnt/home/root.dmp /mnt/root</span></span><br><span class="line">xfsdump: using file dump (drive_simple) strategy</span><br><span class="line">xfsdump: version 3.1.7 (dump format 3.0) - <span class="built_in">type</span> ^C <span class="keyword">for</span> status and control</span><br><span class="line"></span><br><span class="line"> ============================= dump label dialog ==============================</span><br><span class="line"></span><br><span class="line">please enter label <span class="keyword">for</span> this dump session (<span class="built_in">timeout</span> <span class="keyword">in</span> 300 sec)</span><br><span class="line"> -&gt; root</span><br><span class="line">session label entered: <span class="string">&quot;root&quot;</span></span><br><span class="line"></span><br><span class="line"> --------------------------------- end dialog ---------------------------------</span><br><span class="line"></span><br><span class="line">xfsdump: level 0 dump of localhost.localdomain:/mnt/root</span><br><span class="line">xfsdump: dump <span class="built_in">date</span>: Wed Mar  9 03:16:07 2022</span><br><span class="line">xfsdump: session <span class="built_in">id</span>: 8075cffa-e01e-4fd9-a177-23a056ce8be8</span><br><span class="line">xfsdump: session label: <span class="string">&quot;root&quot;</span></span><br><span class="line">xfsdump: ino map phase 1: constructing initial dump list</span><br><span class="line">xfsdump: ino map phase 2: skipping (no pruning necessary)</span><br><span class="line">xfsdump: ino map phase 3: skipping (only one dump stream)</span><br><span class="line">xfsdump: ino map construction complete</span><br><span class="line">xfsdump: estimated dump size: 10083792512 bytes</span><br><span class="line">xfsdump: /var/lib/xfsdump/inventory created</span><br><span class="line"></span><br><span class="line"> ============================= media label dialog =============================</span><br><span class="line"></span><br><span class="line">please enter label <span class="keyword">for</span> media <span class="keyword">in</span> drive 0 (<span class="built_in">timeout</span> <span class="keyword">in</span> 300 sec)</span><br><span class="line"> -&gt; root</span><br><span class="line">media label entered: <span class="string">&quot;root&quot;</span></span><br><span class="line"></span><br><span class="line"> --------------------------------- end dialog ---------------------------------</span><br><span class="line"></span><br><span class="line">xfsdump: creating dump session media file 0 (media 0, file 0)</span><br><span class="line">xfsdump: dumping ino map</span><br><span class="line">xfsdump: dumping directories</span><br><span class="line">xfsdump: dumping non-directory files</span><br><span class="line">xfsdump: ending media file</span><br><span class="line">xfsdump: media file size 9977044328 bytes</span><br><span class="line">xfsdump: dump size (non-dir files) : 9919957304 bytes</span><br><span class="line">xfsdump: dump complete: 436 seconds elapsed</span><br><span class="line">xfsdump: Dump Summary:</span><br><span class="line">xfsdump:   stream 0 /mnt/home/root.dmp OK (success)</span><br><span class="line">xfsdump: Dump Status: SUCCESS</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>reduce and format root logical volume, restore the root content</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># umount /mnt/root</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># lvreduce -L -5G /dev/rhel/root</span></span><br><span class="line">  WARNING: Reducing active and open logical volume to 50.00 GiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce rhel/root? [y/n]: y</span><br><span class="line">  Size of logical volume rhel/root changed from 55.00 GiB (14080 extents) to 50.00 GiB (12800 extents).</span><br><span class="line">  Logical volume rhel/root successfully resized.</span><br><span class="line">[root@localhost ~]<span class="comment"># vgreduce rhel /dev/sdd1</span></span><br><span class="line">  Removed <span class="string">&quot;/dev/sdd1&quot;</span> from volume group <span class="string">&quot;rhel&quot;</span></span><br><span class="line">[root@localhost ~]<span class="comment"># pvremove /dev/sdd1</span></span><br><span class="line">  Labels on physical volume <span class="string">&quot;/dev/sdd1&quot;</span> successfully wiped.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs.xfs -L root -f /dev/rhel/root</span></span><br><span class="line">meta-data=/dev/rhel/root         isize=512    agcount=4, agsize=3276800 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=13107200, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=6400, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/rhel/root /mnt/root/</span></span><br><span class="line">[root@localhost ~]<span class="comment"># xfsrestore -f /mnt/home/root.dmp /mnt/root</span></span><br><span class="line">xfsrestore: using file dump (drive_simple) strategy</span><br><span class="line">xfsrestore: version 3.1.7 (dump format 3.0) - <span class="built_in">type</span> ^C <span class="keyword">for</span> status and control</span><br><span class="line">xfsrestore: searching media <span class="keyword">for</span> dump</span><br><span class="line">xfsrestore: examining media file 0</span><br><span class="line">xfsrestore: dump description:</span><br><span class="line">xfsrestore: hostname: localhost.localdomain</span><br><span class="line">xfsrestore: mount point: /mnt/root</span><br><span class="line">xfsrestore: volume: /dev/mapper/rhel-root</span><br><span class="line">xfsrestore: session time: Wed Mar  9 03:16:07 2022</span><br><span class="line">xfsrestore: level: 0</span><br><span class="line">xfsrestore: session label: <span class="string">&quot;root&quot;</span></span><br><span class="line">xfsrestore: media label: <span class="string">&quot;root&quot;</span></span><br><span class="line">xfsrestore: file system <span class="built_in">id</span>: 82d461cb-002a-4bd3-9f33-0870656b154a</span><br><span class="line">xfsrestore: session <span class="built_in">id</span>: 8075cffa-e01e-4fd9-a177-23a056ce8be8</span><br><span class="line">xfsrestore: media <span class="built_in">id</span>: 1cf8a3f9-de8d-4125-a3c1-c7305a5b0668</span><br><span class="line">xfsrestore: using online session inventory</span><br><span class="line">xfsrestore: searching media <span class="keyword">for</span> directory dump</span><br><span class="line">xfsrestore: reading directories</span><br><span class="line">xfsrestore: 12396 directories and 94871 entries processed</span><br><span class="line">xfsrestore: directory post-processing</span><br><span class="line">xfsrestore: restoring non-directory files</span><br><span class="line">xfsrestore: restore complete: 316 seconds elapsed</span><br><span class="line">xfsrestore: Restore Summary:</span><br><span class="line">xfsrestore:   stream 0 /mnt/home/root.dmp OK (success)</span><br><span class="line">xfsrestore: Restore Status: SUCCESS</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># lsblk -o name,size,mountpoint,uuid</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /mnt/root/etc/fstab</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># umount /mnt/root</span></span><br><span class="line">[root@localhost ~]<span class="comment"># umount /mnt/home</span></span><br><span class="line">[root@localhost ~]<span class="comment"># init 6</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>xfs</tag>
      </tags>
  </entry>
  <entry>
    <title>iSCSI Share</title>
    <url>/blog/posts/275eae45.html</url>
    <content><![CDATA[<h1 id="iSCSI-Share"><a href="#iSCSI-Share" class="headerlink" title="iSCSI Share"></a>iSCSI Share</h1><h2 id="iSCSI 目录介绍"><a href="#iSCSI 目录介绍" class="headerlink" title="iSCSI 目录介绍"></a>iSCSI 目录介绍 </h2><ul>
<li><code>/backstores/block</code> 存放本地共享设备的位置 </li>
<li><code>/iscsi/&lt;target&gt;/tpg1/luns</code> 存放加入到 target 的共享资源设备 </li>
<li><code>/iscsi/&lt;target&gt;/tpg1/acls</code> 用于存放能够访问共享存储资源的客户端名称 </li>
<li><code>/iscsi/&lt;target&gt;/tpg1/portals</code> 用于指定客户端可被访问的监听 IP 地址及端口 </li>
</ul>
<h2 id="iSCSI- 服务端配置"><a href="#iSCSI- 服务端配置" class="headerlink" title="iSCSI 服务端配置"></a>iSCSI 服务端配置 </h2><ol>
<li><p> 安装 iSCSI，启动服务 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install targetcli</span><br><span class="line">systemctl enable target --now</span><br></pre></td></tr></table></figure>
</li>
<li><p> 创建虚拟设备 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dd if=/dev/zero of=/sharedisk/disk-1 bs=1M seek=1024 count=0</span><br><span class="line">losetup /dev/loop0 /sharedisk/disk-1</span><br></pre></td></tr></table></figure>
</li>
<li><p> 定义后端存储 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">targetcli</span><br><span class="line"><span class="meta prompt_">/&gt; </span><span class="language-bash">/backstores/block create lun1 /dev/loop0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 创建 target iqn 对象 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">/&gt; </span><span class="language-bash">/iscsi create</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 绑定后端存储 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">/&gt; </span><span class="language-bash">/iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/luns create /backstores/block/lun1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 设置访问控制 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">/&gt; </span><span class="language-bash">/iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/acls create iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61:xsk</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 绑定服务监听的地址，重启服务 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">/&gt; </span><span class="language-bash">/iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/portals create</span></span><br><span class="line"><span class="meta prompt_">/&gt; </span><span class="language-bash">saveconfig</span></span><br><span class="line"></span><br><span class="line">systemctl restart target</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="iSCSI- 客户端配置"><a href="#iSCSI- 客户端配置" class="headerlink" title="iSCSI 客户端配置"></a>iSCSI 客户端配置 </h2><ol>
<li><p> 安装客户端软件，设置开机自启 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install iscsi-initiator-utils</span><br><span class="line">systemctl enable iscsid --now</span><br></pre></td></tr></table></figure>
</li>
<li><p> 将服务端访问控制表中的共享名称加入到客户端配置文件 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt;/etc/iscsi/initiatorname.iscsi &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">InitiatorName=iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61:xsk</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 重启客户端 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl restart iscsid</span><br></pre></td></tr></table></figure>
</li>
<li><p> 扫描 iSCSI 共享存储设备 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iscsiadm -m discovery -t st -p 192.168.184.129</span><br></pre></td></tr></table></figure>
</li>
<li><p> 登录 iSCSI 共享服务端 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">iscsiadm -m node -T iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61 -p 192.168.184.129 --login</span><br></pre></td></tr></table></figure>
</li>
<li><p> 查看已挂载的存储设备 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line">...</span><br><span class="line">Disk /dev/sdb: 5368 MB, 5368709120 bytes, 10485760 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 126976 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x401b1c76</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p> 删除共享服务端 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iscsiadm -m node -T iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61 -u</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /var/lib/iscsi/nodes/*</span><br><span class="line"><span class="built_in">rm</span> -rf /var/lib/iscsi/send_targets/*</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>iscsi</tag>
      </tags>
  </entry>
  <entry>
    <title>Scan Disk Online</title>
    <url>/blog/posts/4bb25ed9.html</url>
    <content><![CDATA[<h1 id="Scan-Disk-Online"><a href="#Scan-Disk-Online" class="headerlink" title="Scan Disk Online"></a>Scan Disk Online</h1><h2 id="在线扫描新添加的硬盘："><a href="# 在线扫描新添加的硬盘：" class="headerlink" title="在线扫描新添加的硬盘："></a> 在线扫描新添加的硬盘：</h2><p> 添加一块 SCSI 类型的硬盘，执行下面命令扫描磁盘 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span> /sys/class/scsi_host/`; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;- - -&quot;</span> &gt; /sys/class/scsi_host/<span class="variable">$&#123;i&#125;</span>/scan; <span class="keyword">done</span></span><br><span class="line"><span class="comment"># for i in `ls /sys/class/scsi_device/`; do echo 1 &gt; /sys/class/scsi_device/$&#123;i&#125;/device/rescan; done</span></span><br><span class="line"></span><br><span class="line">/usr/bin/scsi-rescan -s</span><br></pre></td></tr></table></figure>

<h2 id="EMC-PowerPath- 环境中增加 LUN："><a href="#EMC-PowerPath- 环境中增加 LUN：" class="headerlink" title="EMC PowerPath 环境中增加 LUN："></a>EMC PowerPath 环境中增加 LUN：</h2><ol>
<li><p> 确保存储端已配置好 LUN 并映射给 Linux 主机，通过 powermt 命令获得 HBA 卡列表，并扫描列表中所有的 HBA 卡 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> `<span class="built_in">ls</span> /sys/class/scsi_host/`; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">&quot;- - -&quot;</span> &gt; /sys/class/scsi_host/<span class="variable">$&#123;host&#125;</span>/scan; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 执行 <code>powermt config</code> 配置新认到的磁盘，生成虚拟设备 </p>
</li>
<li><p> 执行 <code>powermt display</code> 检查新识别到的 LUN 及设备路径 </p>
</li>
<li><p> 执行 <code>powermt save</code> 保存 </p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>disk</tag>
      </tags>
  </entry>
  <entry>
    <title>Kickstart</title>
    <url>/blog/posts/f45c3997.html</url>
    <content><![CDATA[<h1 id="Kickstart"><a href="#Kickstart" class="headerlink" title="Kickstart"></a>Kickstart</h1><p>通过编辑引导装载程序配置启动 Kickstart 安装</p>
<ol>
<li><p>打开 PXE 服务器中的引导装载程序配置文件，并在合适的行中添加 inst.ks&#x3D; 引导选项。该文件的名称及句法取决于您系统的架构和硬件：<br>在使用 BIOS 的 AMD64 和 Intel 64 系统中，该文件名称可以是 default，也可以是根据您的系统 IP 地址命名。因此，请在安装条目的 append 行中添加 inst.ks&#x3D; 选项。该配置文件中 append 行示例类似如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">append initrd=initrd.img inst.ks=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/kickstarts/ks.cfg</span><br></pre></td></tr></table></figure>
</li>
<li><p>在使用 GRUB2 引导装载程序（使用 UEFI 的 AMD64 和 Intel 64 系统，以及 IBM Power Systems Server）中，该文件名可能是 grub.cfg。在这个文件安装条目的 kernel 行添加 inst.ks&#x3D; 选项。该配置文件 kernel 行示例如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kernel vmlinuz inst.ks=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/kickstarts/ks.cfg</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="语法参考"><a href="# 语法参考" class="headerlink" title="语法参考"></a>语法参考</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">version=DEVEL</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">System authorization information</span></span><br><span class="line">auth --enableshadow --passalgo=sha512</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use CDROM installation media</span></span><br><span class="line">cdrom</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Use graphical install</span></span><br><span class="line">graphical</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Run the Setup Agent on first boot</span></span><br><span class="line">firstboot --enable</span><br><span class="line">ignoredisk --only-use=sda</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Keyboard layouts</span></span><br><span class="line">keyboard --vckeymap=us --xlayouts=&#x27;us&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">System language</span></span><br><span class="line">lang en_US.UTF-8</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Network information</span></span><br><span class="line">network  --bootproto=static --device=ens33 --gateway=192.168.184.2 --ip=192.168.184.139 --nameserver=192.168.184.2 --netmask=255.255.255.0 --ipv6=auto --activate</span><br><span class="line">network  --hostname=rhel7.localdomain</span><br><span class="line"></span><br><span class="line">repo --name=&quot;Server-HighAvailability&quot; --baseurl=file:///run/install/repo/addons/HighAvailability</span><br><span class="line">repo --name=&quot;Server-ResilientStorage&quot; --baseurl=file:///run/install/repo/addons/ResilientStorage</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Root password</span></span><br><span class="line">rootpw --iscrypted $6$40.EhuRQPJ6OltGD$tYEcqbMNDwOmIMMpXhGMyVax5Sw9vyl7znesBaWr/H/pWkmG5qHXCmMHfT9VZSWtHCqinkE5ibO8ZVOzqpmvI0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">System services</span></span><br><span class="line">services --disabled=&quot;chronyd&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">System timezone</span></span><br><span class="line">timezone Asia/Shanghai --isUtc --nontp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">System bootloader configuration</span></span><br><span class="line">bootloader --location=mbr --boot-drive=sda</span><br><span class="line">autopart --type=lvm</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Partition clearing information</span></span><br><span class="line">clearpart --none --initlabel</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">packages</span></span><br><span class="line">@^minimal</span><br><span class="line">@core</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">end</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">addon com_redhat_kdump --<span class="built_in">disable</span> --reserve-mb=<span class="string">&#x27;auto&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">end</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">anaconda</span></span><br><span class="line">pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line">pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok</span><br><span class="line">pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">end</span></span><br></pre></td></tr></table></figure>

<p>**rootpw –iscrypted ** 的加密密码可由 python 生成</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python -c &#x27;import crypt; print(crypt.crypt(&quot;My Password&quot;))&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="验证 Kickstart 文件"><a href="# 验证 Kickstart 文件" class="headerlink" title="验证 Kickstart 文件"></a>验证 Kickstart 文件 </h2><p> 生成定制 kickstart 文件时，请在使用该文件进行安装前确认其是否有效。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yum install pykickstart</span></span><br></pre></td></tr></table></figure>

<p>安装该软件包后，可以很使用以下命令验证 Kickstart 文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ksvalidator /path/to/kickstart.ks</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>kickstart</tag>
      </tags>
  </entry>
  <entry>
    <title>PXE for UEFI</title>
    <url>/blog/posts/b04159b7.html</url>
    <content><![CDATA[<h1 id="PXE-for-UEFI"><a href="#PXE-for-UEFI" class="headerlink" title="PXE for UEFI"></a>PXE for UEFI</h1><p> 为使用 UEFI 的 AMD64 和 Intel 64 客户端配置 PXE 服务器 </p>
<ol>
<li><p> 安装 tftp 软件包。请作为 root 运行以下命令完成此步骤：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># yum install tftp-server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 在 &#x2F;etc&#x2F;xinet.d&#x2F;tftp 配置文件中，将 disabled 参数从 yes 改为 no。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># vim /etc/xinetd.d/tftp</span></span><br><span class="line"><span class="comment"># default: off</span></span><br><span class="line"><span class="comment"># description: The tftp server serves files using the trivial file transfer \</span></span><br><span class="line"><span class="comment">#       protocol.  The tftp protocol is often used to boot diskless \</span></span><br><span class="line"><span class="comment">#       workstations, download configuration files to network-aware printers, \</span></span><br><span class="line"><span class="comment">#       and to start the installation process for some operating systems.</span></span><br><span class="line">service tftp</span><br><span class="line">&#123;</span><br><span class="line">        socket_type             = dgram</span><br><span class="line">        protocol                = udp</span><br><span class="line">        <span class="built_in">wait</span>                    = <span class="built_in">yes</span></span><br><span class="line">        user                    = root</span><br><span class="line">        server                  = /usr/sbin/in.tftpd</span><br><span class="line">        server_args             = -s /var/lib/tftpboot</span><br><span class="line">        <span class="built_in">disable</span>                 = no</span><br><span class="line">        per_source              = 11</span><br><span class="line">        cps                     = 100 2</span><br><span class="line">        flags                   = IPv4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这个配置文件中还有其他控制 tftp 服务器行为的选项。可用选项请查看 xinetd.conf(5) 手册页。</p>
</li>
<li><p> 在防火墙中允许 tftp 服务的进入连接：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># firewall-cmd --add-service=tftp</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># firewall-cmd --add-service=tftp --permanent</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 安装配置 DHCP 服务器 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># yum install dhcp</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># vim /etc/dhcp/dhcpd.conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># DHCP Server Configuration file.</span></span><br><span class="line"><span class="comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span></span><br><span class="line"><span class="comment">#   see dhcpd.conf(5) man page</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">option space pxelinux;</span><br><span class="line">option pxelinux.magic code 208 = string;</span><br><span class="line">option pxelinux.configfile code 209 = text;</span><br><span class="line">option pxelinux.pathprefix code 210 = text;</span><br><span class="line">option pxelinux.reboottime code 211 = unsigned <span class="built_in">integer</span> 32;</span><br><span class="line">option architecture-type code 93 = unsigned <span class="built_in">integer</span> 16;</span><br><span class="line">subnet 192.168.184.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  option routers 192.168.184.254;</span><br><span class="line">  range 192.168.184.2 192.168.184.253;</span><br><span class="line">  class <span class="string">&quot;pxeclients&quot;</span> &#123;</span><br><span class="line">    match <span class="keyword">if</span> substring (option vendor-class-identifier, 0, 9) = <span class="string">&quot;PXEClient&quot;</span>;</span><br><span class="line">    next-server 192.168.184.129;</span><br><span class="line">    <span class="keyword">if</span> option architecture-type = 00:07 &#123;</span><br><span class="line">      filename <span class="string">&quot;uefi/shim.efi&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      filename <span class="string">&quot;pxelinux/pxelinux.0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 现在您需要 shim 软件包中的 shim.efi 文件，以及 ISO 映像文件中 grub2-efi 软件包的 grubx64.efi 文件。要访问该文件，请作为 root 运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># mount -t iso9660 /path_to_image/name_of_image.iso /mount_point -o loop,ro</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># cp -pr /mount_point/Packages/shim-version-architecture.rpm /publicly_available_directory</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># cp -pr /mount_point/Packages/grub2-efi-version-architecture.rpm /publicly_available_directory</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># umount /mount_point</span></span><br></pre></td></tr></table></figure>

<p> 提取软件包：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># rpm2cpio shim-version-architecture.rpm | cpio -dimv</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># rpm2cpio grub2-efi-version-architecture.rpm | cpio -dimv</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 在 tftpboot&#x2F; 目录中为 EFI 引导映像创建名为 uefi&#x2F; 的目录，并从您的 boot 目录复制它们：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># mkdir /var/lib/tftpboot/uefi</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># cp publicly_available_directory/boot/efi/EFI/redhat/shim.efi /var/lib/tftpboot/uefi/</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># cp publicly_available_directory/boot/efi/EFI/redhat/grubx64.efi /var/lib/tftpboot/uefi/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 在 uefi&#x2F; 目录中添加名为 grub.cfg 的配置文件。<code>/var/lib/tftpboot/uefi/grub.cfg</code> 配置文件示例类似如下：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> <span class="built_in">timeout</span>=60</span><br><span class="line">menuentry <span class="string">&#x27;RHEL 7&#x27;</span> &#123;</span><br><span class="line">  linuxefi uefi/vmlinuz ip=dhcp inst.repo=http://192.168.184.129/mnt/archive/RHEL-7/7.1/Server/x86_64/os/</span><br><span class="line">  initrdefi uefi/initrd.img</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 将引导映像复制到您的 uefi&#x2F; 目录下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment">#  cp /path/to/x86_64/os/images/pxeboot/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/uefi/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 最后，如果没有运行 xinetd 和 dhcp 服务，则需要启动该服务；如果该服务已运行，则需重新载入 tftp、xinetd 和 dhcp。</p>
<p> 如果这些服务之前没有运行，则需启动这些服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># systemctl start xinetd.service dhcpd.service</span></span><br></pre></td></tr></table></figure>

<p> 如果要永久启用这些服务以便每次系统重启后自动启动，则还需要执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># systemctl enable xinetd.service dhcpd.service  </span></span><br></pre></td></tr></table></figure>

<p> 要重新载入已运行服务的配置，请使用 <code>systemctl reload</code> 命令。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>pxe</tag>
      </tags>
  </entry>
  <entry>
    <title>PXE for BIOS</title>
    <url>/blog/posts/58358dc6.html</url>
    <content><![CDATA[<h1 id="PXE-for-BIOS"><a href="#PXE-for-BIOS" class="headerlink" title="PXE for BIOS"></a>PXE for BIOS</h1><p> 为使用 BIOS 的 AMD64 和 Intel 64 客户端配置 PXE 服务器 </p>
<ol>
<li><p> 安装 tftp 软件包。请作为 root 运行以下命令完成此步骤：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># yum install tftp-server</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 在 &#x2F;etc&#x2F;xinet.d&#x2F;tftp 配置文件中，将 disabled 参数从 yes 改为 no。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># vim /etc/xinetd.d/tftp</span></span><br><span class="line"><span class="comment"># default: off</span></span><br><span class="line"><span class="comment"># description: The tftp server serves files using the trivial file transfer \</span></span><br><span class="line"><span class="comment">#       protocol.  The tftp protocol is often used to boot diskless \</span></span><br><span class="line"><span class="comment">#       workstations, download configuration files to network-aware printers, \</span></span><br><span class="line"><span class="comment">#       and to start the installation process for some operating systems.</span></span><br><span class="line">service tftp</span><br><span class="line">&#123;</span><br><span class="line">        socket_type             = dgram</span><br><span class="line">        protocol                = udp</span><br><span class="line">        <span class="built_in">wait</span>                    = <span class="built_in">yes</span></span><br><span class="line">        user                    = root</span><br><span class="line">        server                  = /usr/sbin/in.tftpd</span><br><span class="line">        server_args             = -s /var/lib/tftpboot</span><br><span class="line">        <span class="built_in">disable</span>                 = no</span><br><span class="line">        per_source              = 11</span><br><span class="line">        cps                     = 100 2</span><br><span class="line">        flags                   = IPv4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这个配置文件中还有其他控制 tftp 服务器行为的选项。可用选项请查看 xinetd.conf(5) 手册页。</p>
</li>
<li><p> 在防火墙中允许 tftp 服务的进入连接：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># firewall-cmd --add-service=tftp</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># firewall-cmd --add-service=tftp --permanent</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 安装配置 DHCP 服务器 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># yum install dhcp</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># vim /etc/dhcp/dhcpd.conf</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># DHCP Server Configuration file.</span></span><br><span class="line"><span class="comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span></span><br><span class="line"><span class="comment">#   see dhcpd.conf(5) man page</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">option space pxelinux;</span><br><span class="line">option pxelinux.magic code 208 = string;</span><br><span class="line">option pxelinux.configfile code 209 = text;</span><br><span class="line">option pxelinux.pathprefix code 210 = text;</span><br><span class="line">option pxelinux.reboottime code 211 = unsigned <span class="built_in">integer</span> 32;</span><br><span class="line">option architecture-type code 93 = unsigned <span class="built_in">integer</span> 16;</span><br><span class="line">subnet 192.168.184.0 netmask 255.255.255.0 &#123;</span><br><span class="line">  option routers 192.168.184.254;</span><br><span class="line">  range 192.168.184.2 192.168.184.253;</span><br><span class="line">  class <span class="string">&quot;pxeclients&quot;</span> &#123;</span><br><span class="line">    match <span class="keyword">if</span> substring (option vendor-class-identifier, 0, 9) = <span class="string">&quot;PXEClient&quot;</span>;</span><br><span class="line">    next-server 192.168.184.129;</span><br><span class="line">    <span class="keyword">if</span> option architecture-type = 00:07 &#123;</span><br><span class="line">      filename <span class="string">&quot;uefi/shim.efi&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      filename <span class="string">&quot;pxelinux/pxelinux.0&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 现在需要完整安装 DVD 的 ISO 映像文件中 SYSLINUX 软件包中的 pxelinux.0 文件。要访问该文件，请作为 root 运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># mount -t iso9660 /path_to_image/name_of_image.iso /mount_point -o loop,ro</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># cp -pr /mount_point/Packages/syslinux-version-architecture.rpm /publicly_available_directory</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># umount /mount_point</span></span><br></pre></td></tr></table></figure>

<p> 提取软件包：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># rpm2cpio syslinux-version-architecture.rpm | cpio -dimv</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 在 tftpboot 中创建 pxelinux 目录，并将 pxelinux.0 复制到该目录中：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># mkdir /var/lib/tftpboot/pxelinux</span></span><br><span class="line">[root@rhel-7 ~]<span class="comment"># cp publicly_available_directory/usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/pxelinux</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 在 pxelinux&#x2F; 目录中创建目录 pxelinux.cfg&#x2F;：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># mkdir /var/lib/tftpboot/pxelinux/pxelinux.cfg</span></span><br></pre></td></tr></table></figure>

<p> 在 pxelinux.cfg&#x2F; 目录中添加名为 default 的配置文件。<br><code>/var/lib/tftpboot/pxelinux/pxelinux.cfg/default</code> 中的示例配置文件类似如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">default vesamenu.c32</span><br><span class="line">prompt 1</span><br><span class="line"><span class="built_in">timeout</span> 600</span><br><span class="line"></span><br><span class="line">display boot.msg</span><br><span class="line"></span><br><span class="line">label linux</span><br><span class="line">  menu label ^Install system</span><br><span class="line">  menu default</span><br><span class="line">  kernel vmlinuz</span><br><span class="line">  append initrd=initrd.img ip=dhcp inst.repo=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/os/</span><br><span class="line">label vesa</span><br><span class="line">  menu label Install system with ^basic video driver</span><br><span class="line">  kernel vmlinuz</span><br><span class="line">  append initrd=initrd.img ip=dhcp inst.xdriver=vesa nomodeset inst.repo=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/os/</span><br><span class="line">label rescue</span><br><span class="line">  menu label ^Rescue installed system</span><br><span class="line">  kernel vmlinuz</span><br><span class="line">  append initrd=initrd.img rescue</span><br><span class="line">label <span class="built_in">local</span></span><br><span class="line">  menu label Boot from ^<span class="built_in">local</span> drive</span><br><span class="line">  localboot 0xffff</span><br></pre></td></tr></table></figure>
</li>
<li><p> 将引导映象复制到您的 tftp&#x2F; root 目录中：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># cp /path/to/x86_64/os/images/pxeboot/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/pxelinux/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 最后，如果没有运行 xinetd 和 dhcp 服务，则需要启动该服务；如果该服务已运行，则需重新载入 tftp、xinetd 和 dhcp。</p>
<p> 如果这些服务之前没有运行，则需启动这些服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># systemctl start xinetd.service dhcpd.service</span></span><br></pre></td></tr></table></figure>

<p> 如果要永久启用这些服务以便每次系统重启后自动启动，则还需要执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rhel-7 ~]<span class="comment"># systemctl enable xinetd.service dhcpd.service  </span></span><br></pre></td></tr></table></figure>

<p> 要重新载入已运行服务的配置，请使用 <code>systemctl reload</code> 命令。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>pxe</tag>
      </tags>
  </entry>
  <entry>
    <title>Brocade Configuration</title>
    <url>/blog/posts/cd75cb2e.html</url>
    <content><![CDATA[<h1 id="Brocade-Configuration"><a href="#Brocade-Configuration" class="headerlink" title="Brocade Configuration"></a>Brocade Configuration</h1><h4 id="默认 IP 密码"><a href="# 默认 IP 密码" class="headerlink" title="默认 IP 密码"></a>默认 IP 密码 </h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"> 初始默认 IP: 10.77.77.77</span><br><span class="line">用户密码: admin/password    root/fibranne</span><br></pre></td></tr></table></figure>

<h4 id="常用命令"><a href="# 常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">porterrshow     # 查看端口计数</span><br><span class="line">portstatsclear  # 清除全部端口计数</span><br><span class="line"></span><br><span class="line">sfpshow         # 查看光衰</span><br><span class="line"></span><br><span class="line">portperfshow    # 查看端口流量</span><br><span class="line"></span><br><span class="line">fabricshow      # 查看与当前交换机级联的交换机</span><br></pre></td></tr></table></figure>

<h4 id="初始化配置"><a href="# 初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">switchname SW1</span><br><span class="line">tstimezone Asia/Shanghai</span><br><span class="line">date &quot;0101235922&quot;</span><br><span class="line">tsclockserver &quot;192.168.2.1&quot;</span><br><span class="line">ipaddrset</span><br><span class="line">ipaddrshow</span><br></pre></td></tr></table></figure>

<h4 id="ZONE 配置"><a href="#ZONE 配置" class="headerlink" title="ZONE 配置"></a>ZONE 配置 </h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 创建 <span class="built_in">alias</span>/zone/cfg</span></span><br><span class="line">alicreate &quot;Esxi168_HBA0&quot;,&quot;10:00:00:00:c9:60:15:2a&quot;</span><br><span class="line">zonecreate &quot;Esxi168_HBA0_VNX5200_01_SPA01&quot;,&quot;Esxi168_HBA0;VNX5200_01_SPA01&quot;</span><br><span class="line">cfgadd &quot;HIS_CONFIG&quot;,&quot;Esxi168_HBA0_VNX5200_01_SPA01&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 移除 cfg/zone/alias</span></span><br><span class="line">cfgremove &quot;HIS_CONFIG&quot;, &quot;bcmz1_zone3;bcmz1_zone4&quot;</span><br><span class="line">zonedelete &quot;bcmz1_zone3&quot;</span><br><span class="line">alidelete &quot;bcmz1_x3650_m3_p4&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">保存 </span></span><br><span class="line">cfgenable HIS_CONFIG</span><br><span class="line">cfgsave</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 删除清空 cfg</span></span><br><span class="line">cfgdisable &quot;HIS_CONFIG&quot;</span><br><span class="line">cfgclear</span><br><span class="line">cfgsave</span><br></pre></td></tr></table></figure>

<h4 id="配置级联"><a href="# 配置级联" class="headerlink" title="配置级联"></a>配置级联 </h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 查看级联许可 </span></span><br><span class="line">switch:admin&gt; licenseshow</span><br><span class="line">ddedcHQyRSeefet: </span><br><span class="line">Fabric license </span><br><span class="line">Enhanced Group Management license </span><br><span class="line">gBFMmPLMYJGKfDgf?3Rg9DKa3gDNE9JBJGAM: </span><br><span class="line">8 Gig FC license]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 添加许可 </span></span><br><span class="line">switch:admin&gt; licenseadd &lt; 许可字符串 &gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 激活端口 </span></span><br><span class="line">switch:admin&gt; licenseport --reserve 0-15</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 更改 Domain-ID，级联的光交 Domain-ID 不能相同</span></span><br><span class="line">switch:admin&gt; fabricshow</span><br><span class="line">switch:admin&gt; switchdisable</span><br><span class="line">switch:admin&gt; configure</span><br><span class="line">Configure...</span><br><span class="line">Fabric</span><br><span class="line">Parameters (yes, y, no, n): [no] y</span><br><span class="line">Domain</span><br><span class="line">(1...239): [1] 2</span><br><span class="line">…</span><br><span class="line">&lt;ctrl+D&gt;</span><br><span class="line">switch:admin&gt; switchenable</span><br></pre></td></tr></table></figure>

<h4 id="开启端口 NPIV 功能"><a href="# 开启端口 NPIV 功能" class="headerlink" title="开启端口 NPIV 功能"></a>开启端口 NPIV 功能 </h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 开启指定端口的 npiv 功能 </span></span><br><span class="line">DS:root&gt;portcfgnpivport --enable [slot/]port</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 关闭指定端口的 npiv 功能 </span></span><br><span class="line">DS:root&gt;portcfgnpivport --disable [slot/]port</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> 查看端口 npiv 功能状态</span></span><br><span class="line">DS:root&gt; portcfgshow</span><br></pre></td></tr></table></figure>

<h4 id="FOS 升级"><a href="#FOS 升级" class="headerlink" title="FOS 升级"></a>FOS 升级</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">switch:admin&gt; firmwareshow</span><br><span class="line">switch:admin&gt; firmwaredownload</span><br><span class="line">switch:admin&gt; firmwareactivate</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Network</category>
        <category>SANSwitch</category>
      </categories>
      <tags>
        <tag>config</tag>
        <tag>sanswitch</tag>
      </tags>
  </entry>
  <entry>
    <title>Upgrade Brocade Switch Firmware</title>
    <url>/blog/posts/a37e949c.html</url>
    <content><![CDATA[<h1 id="Upgrade-Brocade-Switch-Firmware"><a href="#Upgrade-Brocade-Switch-Firmware" class="headerlink" title="Upgrade Brocade Switch Firmware"></a>Upgrade Brocade Switch Firmware</h1><p>we use the <strong>firmwareshow</strong> command to see which firmware version is currently installed on the switch.</p>
<p><img src="https://s2.loli.net/2023/02/15/uQXwEkDJboZyvRC.png"></p>
<p>Next, we are going to initiate a <strong>firmwaredownload</strong> command and put in all the required options.</p>
<p><img src="https://s2.loli.net/2023/02/15/XT9LSvAfOF6DlPw.png"></p>
<p>The Server name or IP Address is the IP address of your workstation that hosts the FTP server.</p>
<p>The Username is the FTP user. The filename is the folder where the firmware is residing in and for Network Protocol, choose FTP. Lastly, put in the password for the user. Then the system is going to do a check of the firmware and if everything is good, it will start installing the upgrade.</p>
<p><img src="https://s2.loli.net/2023/02/15/c3zJUQAxVPWBgeH.png"></p>
<p>Please note that this is a <strong>disruptive</strong> upgrade, which means the switch will be restarted.</p>
]]></content>
      <categories>
        <category>Network</category>
        <category>SANSwitch</category>
      </categories>
      <tags>
        <tag>sanswitch</tag>
        <tag>upgrade</tag>
      </tags>
  </entry>
  <entry>
    <title>echo_color</title>
    <url>/blog/posts/92f698f7.html</url>
    <content><![CDATA[<h1 id="echo-color"><a href="#echo-color" class="headerlink" title="echo_color"></a>echo_color</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">ecred=<span class="string">&#x27;\033[0;31m&#x27;</span></span><br><span class="line">ecyellow=<span class="string">&#x27;\033[0;33m&#x27;</span></span><br><span class="line">ecgreen=<span class="string">&#x27;\033[32m&#x27;</span></span><br><span class="line">ecend=<span class="string">&#x27;\033[0m&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">echo_red</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;ecred&#125;</span>$@<span class="variable">$&#123;ecend&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">echo_yellow</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;ecyellow&#125;</span>$@<span class="variable">$&#123;ecend&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">echo_green</span></span>() &#123;</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;<span class="variable">$&#123;ecgreen&#125;</span>$@<span class="variable">$&#123;ecend&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong> 格式解析 </strong></p>
<p>@<a href="https://s2.loli.net/2022/07/08/LqJ8Dch6GHlQjYt.png"></a></p>
<p><strong>Colors Reference</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> 字颜色：30—–37</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[30m 黑色字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[31m 红色字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[32m 绿色字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[33m 黄色字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[34m 蓝色字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[35m 紫色字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[36m 天蓝字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[37m 白色字 \033[0m”</span><br><span class="line"></span><br><span class="line"> 字背景颜色范围：40—–47</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[40;37m 黑底白字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[41;37m 红底白字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[42;37m 绿底白字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[43;37m 黄底白字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[44;37m 蓝底白字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[45;37m 紫底白字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[46;37m 天蓝底白字 \033[0m”</span><br><span class="line">　　<span class="built_in">echo</span> -e “\033[47;30m 白底黑字 \033[0m”</span><br><span class="line"></span><br><span class="line"> 最后面控制选项说明 </span><br><span class="line">　　\33[0m 关闭所有属性 </span><br><span class="line">　　\33[1m 设置高亮度 </span><br><span class="line">　　\33[4m 下划线 </span><br><span class="line">　　\33[5m 闪烁 </span><br><span class="line">　　\33[7m 反显 </span><br><span class="line">　　\33[8m 消隐 </span><br><span class="line">　　\33[30m — \33[37m 设置前景色 </span><br><span class="line">　　\33[40m — \33[47m 设置背景色 </span><br><span class="line">　　\33[nA 光标上移 n 行 </span><br><span class="line">　　\33[nB 光标下移 n 行 </span><br><span class="line">　　\33[nC 光标右移 n 行 </span><br><span class="line">　　\33[nD 光标左移 n 行 </span><br><span class="line">　　\33[y;xH 设置光标位置 </span><br><span class="line">　　\33[2J 清屏 </span><br><span class="line">　　\33[K 清除从光标到行尾的内容 </span><br><span class="line">　　\33[s 保存光标位置 </span><br><span class="line">　　\33[u 恢复光标位置 </span><br><span class="line">　　\33[?25l 隐藏光标 </span><br><span class="line">　　\33[?25h 显示光标 </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>hugepages_settings</title>
    <url>/blog/posts/c62bc587.html</url>
    <content><![CDATA[<h1 id="hugepages-settings"><a href="#hugepages-settings" class="headerlink" title="hugepages_settings"></a>hugepages_settings</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># hugepages_settings.sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Linux bash script to compute values for the</span></span><br><span class="line"><span class="comment"># recommended HugePages/HugeTLB configuration</span></span><br><span class="line"><span class="comment"># on Oracle Linux</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note: This script does calculation for all shared memory</span></span><br><span class="line"><span class="comment"># segments available when the script is run, no matter it</span></span><br><span class="line"><span class="comment"># is an Oracle RDBMS shared memory segment or not.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This script is provided by Doc ID 401749.1 from My Oracle Support</span></span><br><span class="line"><span class="comment"># http://support.oracle.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Welcome text</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">This script is provided by Doc ID 401749.1 from My Oracle Support</span></span><br><span class="line"><span class="string">(http://support.oracle.com) where it is intended to compute values for</span></span><br><span class="line"><span class="string">the recommended HugePages/HugeTLB configuration for the current shared</span></span><br><span class="line"><span class="string">memory segments on Oracle Linux. Before proceeding with the execution please note following:</span></span><br><span class="line"><span class="string"> * For ASM instance, it needs to configure ASMM instead of AMM.</span></span><br><span class="line"><span class="string"> * The &#x27;pga_aggregate_target&#x27; is outside the SGA and</span></span><br><span class="line"><span class="string">   you should accommodate this while calculating the overall size.</span></span><br><span class="line"><span class="string"> * In case you changes the DB SGA size,</span></span><br><span class="line"><span class="string">   as the new SGA will not fit in the previous HugePages configuration,</span></span><br><span class="line"><span class="string">   it had better disable the whole HugePages,</span></span><br><span class="line"><span class="string">   start the DB with new SGA size and run the script again.</span></span><br><span class="line"><span class="string">And make sure that:</span></span><br><span class="line"><span class="string"> * Oracle Database instance(s) are up and running</span></span><br><span class="line"><span class="string"> * Oracle Database 11g Automatic Memory Management (AMM) is not setup</span></span><br><span class="line"><span class="string">   (See Doc ID 749851.1)</span></span><br><span class="line"><span class="string"> * The shared memory segments can be listed by command:</span></span><br><span class="line"><span class="string">     # ipcs -m</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Press Enter to proceed...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check for the kernel version</span></span><br><span class="line">KERN=`<span class="built_in">uname</span> -r | awk -F. <span class="string">&#x27;&#123; printf(&quot;%d.%d\n&quot;,$1,$2); &#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find out the HugePage size</span></span><br><span class="line">HPG_SZ=`grep Hugepagesize /proc/meminfo | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"><span class="keyword">if</span> [-z <span class="string">&quot;<span class="variable">$HPG_SZ</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The hugepages may not be supported in the system where the script is being executed.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize the counter</span></span><br><span class="line">NUM_PG=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cumulative number of pages required to handle the running shared memory segments</span></span><br><span class="line"><span class="keyword">for</span> SEG_BYTES <span class="keyword">in</span> `ipcs -m | <span class="built_in">cut</span> -c44-300 | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | grep <span class="string">&quot;[0-9][0-9]*&quot;</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    MIN_PG=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$SEG_BYTES</span>/(<span class="variable">$HPG_SZ</span>*1024)&quot;</span> | bc -q`</span><br><span class="line">    <span class="keyword">if</span> [<span class="variable">$MIN_PG</span> -gt 0 ]; <span class="keyword">then</span></span><br><span class="line">        NUM_PG=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NUM_PG</span>+<span class="variable">$MIN_PG</span>+1&quot;</span> | bc -q`</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">RES_BYTES=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NUM_PG</span> * <span class="variable">$HPG_SZ</span> * 1024&quot;</span> | bc -q`</span><br><span class="line"></span><br><span class="line"><span class="comment"># An SGA less than 100MB does not make sense</span></span><br><span class="line"><span class="comment"># Bail out if that is the case</span></span><br><span class="line"><span class="keyword">if</span> [<span class="variable">$RES_BYTES</span> -lt 100000000 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;***********&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;** ERROR **&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;***********&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Sorry! There are not enough total of shared memory segments allocated for</span></span><br><span class="line"><span class="string">HugePages configuration. HugePages can only be used for shared memory segments</span></span><br><span class="line"><span class="string">that you can list by command:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # ipcs -m</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">of a size that can match an Oracle Database SGA. Please make sure that:</span></span><br><span class="line"><span class="string"> * Oracle Database instance is up and running</span></span><br><span class="line"><span class="string"> * Oracle Database 11g Automatic Memory Management (AMM) is not configured&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Finish with results</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$KERN</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&#x27;2.4&#x27;</span>) HUGETLB_POOL=`<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$NUM_PG</span>*<span class="variable">$HPG_SZ</span>/1024&quot;</span> | bc -q`;</span><br><span class="line">           <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.hugetlb_pool = <span class="variable">$HUGETLB_POOL</span>&quot;</span> ;;</span><br><span class="line">    <span class="string">&#x27;2.6&#x27;</span>) <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span> ;;</span><br><span class="line">    <span class="string">&#x27;3.8&#x27;</span>) <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span> ;;</span><br><span class="line">    <span class="string">&#x27;3.10&#x27;</span>) <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span> ;;</span><br><span class="line">    <span class="string">&#x27;4.1&#x27;</span>) <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span> ;;</span><br><span class="line">    <span class="string">&#x27;4.14&#x27;</span>) <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span> ;;</span><br><span class="line">    <span class="string">&#x27;4.18&#x27;</span>) <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span> ;;</span><br><span class="line">    <span class="string">&#x27;5.4&#x27;</span>) <span class="built_in">echo</span> <span class="string">&quot;Recommended setting: vm.nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span> ;;</span><br><span class="line">    *) <span class="built_in">echo</span> <span class="string">&quot;Kernel version <span class="variable">$KERN</span> is not supported by this script (yet). Exiting.&quot;</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># End</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>File Archive</title>
    <url>/blog/posts/2c6685ff.html</url>
    <content><![CDATA[<h1 id="File-Archive"><a href="#File-Archive" class="headerlink" title="File Archive"></a>File Archive</h1><p> 归档 1 天前的文件，并将原文件删除。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">find /log/ -<span class="built_in">type</span> f -name <span class="string">&#x27;file_*&#x27;</span> -atime -1 -<span class="built_in">exec</span> <span class="built_in">mv</span> &#123;&#125; /log/bak/ \;</span><br><span class="line">tar -zcf /log/bak_`<span class="built_in">date</span> +%H%M%S`.tar.gz -P /log/bak/</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /l/bak/*</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Commands</title>
    <url>/blog/posts/1c8267d6.html</url>
    <content><![CDATA[<h1 id="Linux-Commands"><a href="#Linux-Commands" class="headerlink" title="Linux Commands"></a>Linux Commands</h1><p>Repalce <code>CRLF</code> to <code>LF</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/\r//g&#x27;</span> filename</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>lsb_functions</title>
    <url>/blog/posts/2debbdbd.html</url>
    <content><![CDATA[<h1 id="lsb-functions"><a href="#lsb-functions" class="headerlink" title="lsb_functions"></a>lsb_functions</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use LSB init script functions for printing messages, if possible</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">lsb_functions=<span class="string">&quot;/lib/lsb/init-functions&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f <span class="variable">$lsb_functions</span> ; <span class="keyword">then</span></span><br><span class="line">  . <span class="variable">$lsb_functions</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># Include non-LSB Redhat init functions to make systemctl redirect work</span></span><br><span class="line">  init_functions=<span class="string">&quot;/etc/init.d/functions&quot;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> -f <span class="variable">$init_functions</span>; <span class="keyword">then</span></span><br><span class="line">    . <span class="variable">$init_functions</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="function"><span class="title">log_success_msg</span></span>()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; SUCCESS! <span class="variable">$@</span>&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">log_failure_msg</span></span>()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; ERROR! <span class="variable">$@</span>&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>oracle_11g_setup</title>
    <url>/blog/posts/333e3a3a.html</url>
    <content><![CDATA[<h1 id="oracle-11g-setup"><a href="#oracle-11g-setup" class="headerlink" title="oracle_11g_setup"></a>oracle_11g_setup</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/env bash</span></span><br><span class="line"><span class="comment"># set -e  Exit immediately if a command exits with a non-zero status.</span></span><br><span class="line"><span class="built_in">set</span> -e</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /assets/colorecho</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo_red &#x27;******* ERROR: Something went wrong.&#x27;; exit 1&quot;</span> SIGTERM</span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;echo_red &#x27;******* Caught SIGINT signal. Stopping...&#x27;; exit 2&quot;</span> SIGINT</span><br><span class="line"></span><br><span class="line"><span class="comment">#Install prerequisites directly without virtual package</span></span><br><span class="line"><span class="function"><span class="title">deps</span></span> () &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Installing dependencies&quot;</span></span><br><span class="line">  yum -y install binutils compat-libstdc++-33 compat-libstdc++-33.i686 \</span><br><span class="line">  ksh elfutils-libelf elfutils-libelf-devel glibc glibc-common glibc-devel \</span><br><span class="line">  gcc gcc-c++ libaio libaio.i686 libaio-devel libaio-devel.i686 libgcc libstdc++ \</span><br><span class="line">  libstdc++.i686 libstdc++-devel libstdc++-devel.i686 make sysstat unixODBC unixODBC-devel</span><br><span class="line">  yum clean all</span><br><span class="line">  <span class="built_in">rm</span> -rf /var/lib/&#123;cache,<span class="built_in">log</span>&#125; /var/log/lastlog</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">create_users</span></span> () &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Configuring users&quot;</span></span><br><span class="line">  groupadd -g 500 oinstall</span><br><span class="line">  groupadd -g 501 dba</span><br><span class="line">  useradd -u 500 -g oinstall -G dba oracle</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;oracle:oracle&quot;</span> | chpasswd</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;root:welcome&quot;</span> | chpasswd</span><br><span class="line">  <span class="built_in">mkdir</span> -p -m 755 /u01/app/oracle</span><br><span class="line">  <span class="built_in">mkdir</span> -p -m 755 /u01/app/oraInventory</span><br><span class="line">  <span class="built_in">mkdir</span> -p -m 755 /u01/app/dpdump</span><br><span class="line">  <span class="built_in">chown</span> -R oracle:oinstall /u01/app</span><br><span class="line">  sed -i <span class="string">&quot;s/pam_namespace.so/pam_namespace.so\nsession    required     pam_limits.so/g&quot;</span> /etc/pam.d/login</span><br><span class="line">  <span class="built_in">cat</span> /assets/profile &gt;&gt; ~oracle/.bash_profile</span><br><span class="line">  <span class="built_in">cat</span> /assets/profile &gt;&gt; ~oracle/.bashrc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">sysctl_and_limits</span></span> () &#123;</span><br><span class="line">  <span class="built_in">cat</span> /assets/sysctl.conf &gt;&gt; /etc/sysctl.conf</span><br><span class="line">  <span class="built_in">cat</span> /assets/limits.conf &gt;&gt; /etc/security/limits.conf</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">deps</span><br><span class="line">create_users</span><br><span class="line">sysctl_and_limits</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ping</title>
    <url>/blog/posts/25d53dfd.html</url>
    <content><![CDATA[<p> 检测某个网段的 IP 地址是否可达。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"> ping -c 1 192.168.0.<span class="variable">$&#123;i&#125;</span> &amp;&gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;192.168.0.<span class="variable">$&#123;i&#125;</span> is alive&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;192.168.0.<span class="variable">$&#123;i&#125;</span> is down&quot;</span></span><br><span class="line">&#125; &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br></pre></td></tr></table></figure>

<p><code>wait</code> - Wait for job completion and return exit status.</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>hacmp extendvg</title>
    <url>/blog/posts/b517c7c1.html</url>
    <content><![CDATA[<h1 id="hacmp-extendvg"><a href="#hacmp-extendvg" class="headerlink" title="hacmp extendvg"></a>hacmp extendvg</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">smitty hacmp</span><br><span class="line">-&gt; System Management (C-SPOC)</span><br><span class="line">-&gt; Storage</span><br><span class="line">-&gt; Logical Volumes</span><br><span class="line">-&gt; Add a Logical Volume</span><br><span class="line">-&gt; &lt;pacsdatavg&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Unix</category>
        <category>AIX</category>
      </categories>
      <tags>
        <tag>hacmp</tag>
      </tags>
  </entry>
  <entry>
    <title>Install MySQL on Linux</title>
    <url>/blog/posts/a792efb.html</url>
    <content><![CDATA[<h4 id="Using-the-MySQL-Yum-Repository"><a href="#Using-the-MySQL-Yum-Repository" class="headerlink" title="Using the MySQL Yum Repository"></a>Using the MySQL Yum Repository</h4><ol>
<li><p>Adding the MySQL Yum Repository</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum localinstall mysql57-community-release-el7-&#123;version-number&#125;.noarch.rpm</span><br><span class="line">sudo yum-config-manager --<span class="built_in">enable</span> mysql57-community</span><br></pre></td></tr></table></figure>
</li>
<li><p>Disabling the Default MySQL Module</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum module <span class="built_in">disable</span> mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>Installing MySQL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum install mysql-community-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>Starting the MySQL Server</p>
<p>Start the MySQL server</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> mysqld --now</span><br></pre></td></tr></table></figure>

<p>Get root temporary password in the error log file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo grep <span class="string">&#x27;temporary password&#x27;</span> /var/log/mysqld.log</span><br></pre></td></tr></table></figure>

<p>Change the root password</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;MyNewPass4!&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Using-Generic-Binaries"><a href="#Using-Generic-Binaries" class="headerlink" title="Using Generic Binaries"></a>Using Generic Binaries</h4><ol>
<li><p>Create a mysql User and Group</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -r -g mysql -s /bin/false mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>Obtain and Unpack the Distribution</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local</span><br><span class="line">tar zxvf /path/to/mysql-VERSION-OS.tar.gz</span><br><span class="line"><span class="built_in">ln</span> -s full-path-to-mysql-VERSION-OS mysql</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=<span class="variable">$PATH</span>:/usr/local/mysql/bin&quot;</span> &gt;&gt; /etc/profile</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create directories and grant permissions</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> mysql</span><br><span class="line"><span class="built_in">mkdir</span> mysql-files</span><br><span class="line"><span class="built_in">chmod</span> 750 mysql-files</span><br><span class="line"><span class="built_in">chown</span> mysql:mysql mysql-files</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create my.cnf configuration file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -a /etc/my.cnf /etc/my.cnf_`<span class="built_in">date</span> +%F`</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/my.cnf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">basedir=/usr/local/mysql</span></span><br><span class="line"><span class="string">datadir=/usr/local/mysql/data</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Starting the MySQL Server</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data</span><br><span class="line">bin/mysql_ssl_rsa_setup</span><br><span class="line">bin/mysqld_safe --user=mysql &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Next command is optional</span></span><br><span class="line"><span class="comment"># cp support-files/mysql.server /etc/init.d/mysql.server</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Using-Source"><a href="#Using-Source" class="headerlink" title="Using Source"></a>Using Source</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Preconfiguration setup</span></span><br><span class="line">$&gt; groupadd mysql</span><br><span class="line">$&gt; useradd -r -g mysql -s /bin/false mysql</span><br><span class="line"><span class="comment"># Beginning of source-build specific instructions</span></span><br><span class="line">$&gt; tar zxvf mysql-VERSION.tar.gz</span><br><span class="line">$&gt; <span class="built_in">cd</span> mysql-VERSION</span><br><span class="line">$&gt; <span class="built_in">mkdir</span> bld</span><br><span class="line">$&gt; <span class="built_in">cd</span> bld</span><br><span class="line">$&gt; cmake ..</span><br><span class="line">$&gt; make</span><br><span class="line">$&gt; make install</span><br><span class="line"><span class="comment"># End of source-build specific instructions</span></span><br><span class="line"><span class="comment"># Postinstallation setup</span></span><br><span class="line">$&gt; <span class="built_in">cd</span> /usr/local/mysql</span><br><span class="line">$&gt; <span class="built_in">mkdir</span> mysql-files</span><br><span class="line">$&gt; <span class="built_in">chown</span> mysql:mysql mysql-files</span><br><span class="line">$&gt; <span class="built_in">chmod</span> 750 mysql-files</span><br><span class="line">$&gt; bin/mysqld --initialize --user=mysql</span><br><span class="line">$&gt; bin/mysql_ssl_rsa_setup</span><br><span class="line">$&gt; bin/mysqld_safe --user=mysql &amp;</span><br><span class="line"><span class="comment"># Next command is optional</span></span><br><span class="line">$&gt; <span class="built_in">cp</span> support-files/mysql.server /etc/init.d/mysql.server</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Replace harddisk for rootvg</title>
    <url>/blog/posts/22af3e09.html</url>
    <content><![CDATA[<h1 id="Replace-harddisk-for-rootvg"><a href="#Replace-harddisk-for-rootvg" class="headerlink" title="Replace harddisk for rootvg"></a>Replace harddisk for rootvg</h1><ol>
<li><p>查看系统故障日志，确定故障硬盘信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:taadm] /home/taadm&gt; errpt</span><br><span class="line">IDENTIFIER TIMESTAMP  T C RESOURCE_NAME  DESCRIPTION</span><br><span class="line">EAA3D429   1113051522 U S LVDD           PHYSICAL PARTITION MARKED STALE</span><br><span class="line">E86653C3   1113051522 P H LVDD           I/O ERROR DETECTED BY LVM</span><br><span class="line">B6267342   1113051522 P H hdisk0         DISK OPERATION ERROR</span><br><span class="line"></span><br><span class="line">[TRDGMES1:taadm] /home/taadm&gt; errpt -aj B6267342</span><br><span class="line">......</span><br><span class="line">Diagnostic Analysis</span><br><span class="line">Diagnostic Log sequence number: 2639</span><br><span class="line">Resource tested:        hdisk0</span><br><span class="line">Resource Description:   SAS Disk Drive</span><br><span class="line">Location:               U78AA.001.WZSKPLU-P2-D1</span><br><span class="line">SRN:                    2672-128</span><br><span class="line">Description:            Error log analysis indicates a hardware failure.</span><br><span class="line">Possible FRUs:</span><br><span class="line">hdisk0      FRU: 00E6167      U78AA.001.WZSKPLU-P2-D1      SAS Disk Drive</span><br><span class="line"></span><br><span class="line">[TRDGMES1:root]/#lscfg -vl hdisk0</span><br><span class="line">hdisk0           U78AA.001.WZSKPLU-P2-D1  SAS Disk Drive (300000 MB)</span><br><span class="line">Manufacturer................IBM     </span><br><span class="line">Machine Type and Model......HUC109030CSS600 </span><br><span class="line">FRU Number..................00E6167     </span><br><span class="line">ROS Level and ID............45354336</span><br><span class="line">Serial Number...............KFGK2XER</span><br><span class="line">EC Level....................L37106    </span><br><span class="line">Part Number.................74Y9268     </span><br><span class="line">Device Specific.(Z0)........000006329F011002</span><br><span class="line">Device Specific.(Z1)........CEIPE5C6    </span><br><span class="line">Device Specific.(Z2)........00SS</span><br><span class="line">Device Specific.(Z3)........14156</span><br><span class="line">Device Specific.(Z4)........</span><br><span class="line">Device Specific.(Z5)........22</span><br><span class="line">Device Specific.(Z6)........L37510    </span><br><span class="line">Hardware Location Code......U78AA.001.WZSKPLU-P2-D1</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看系统启动逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#bootlist -m normal -o</span><br><span class="line">hdisk0 blv=hd5 pathid=0</span><br><span class="line">hdisk1 blv=hd5 pathid=0</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查 rootvg 卷组状态信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#lsvg rootvg</span><br><span class="line">VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf</span><br><span class="line">VG STATE:           active                   PP SIZE:        512 megabyte(s)</span><br><span class="line">VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)</span><br><span class="line">MAX LVs:            256                      FREE PPs:       520 (266240 megabytes)</span><br><span class="line">LVs:                15                       USED PPs:       596 (305152 megabytes)</span><br><span class="line">OPEN LVs:           14                       QUORUM:         1 (Disabled)</span><br><span class="line">TOTAL PVs:          2                        VG DESCRIPTORS: 3</span><br><span class="line">STALE PVs:          1                        STALE PPs:      1</span><br><span class="line">ACTIVE PVs:         2                        AUTO ON:        yes</span><br><span class="line">MAX PPs per VG:     32512                                     </span><br><span class="line">MAX PPs per PV:     1016                     MAX PVs:        32</span><br><span class="line">LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no</span><br><span class="line">HOT SPARE:          no                       BB POLICY:      relocatable </span><br><span class="line">PV RESTRICTION:     none                     INFINITE RETRY: no</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lsvg -p rootvg</span><br><span class="line">rootvg:</span><br><span class="line">PV_NAME           PV STATE          TOTAL PPs   FREE PPs    FREE DISTRIBUTION</span><br><span class="line">hdisk0            active            558         250         111..00..00..27..112</span><br><span class="line">hdisk1            active            558         270         111..00..00..47..112</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lsvg -l rootvg</span><br><span class="line">rootvg:</span><br><span class="line">LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT</span><br><span class="line">hd5                 boot       1       2       2    closed/syncd  N/A</span><br><span class="line">hd6                 paging     32      64      2    open/syncd    N/A</span><br><span class="line">hd8                 jfs2log    1       2       2    open/syncd    N/A</span><br><span class="line">hd4                 jfs2       20      40      2    open/syncd    /</span><br><span class="line">hd2                 jfs2       30      60      2    open/syncd    /usr</span><br><span class="line">hd9var              jfs2       20      40      2    open/syncd    /var</span><br><span class="line">hd3                 jfs2       20      40      2    open/syncd    /tmp</span><br><span class="line">hd1                 jfs2       120     240     2    open/stale    /home</span><br><span class="line">hd10opt             jfs2       20      40      2    open/syncd    /opt</span><br><span class="line">hd11admin           jfs2       1       2       2    open/syncd    /admin</span><br><span class="line">lg_dumplv           sysdump    20      20      1    open/syncd    N/A</span><br><span class="line">livedump            jfs2       1       2       2    open/syncd    /var/adm/ras/livedump</span><br><span class="line">loglv00             jfslog     1       2       2    open/syncd    N/A</span><br><span class="line">lv00                jfs        1       2       2    open/syncd    /var/adm/csd</span><br><span class="line">fslv00              jfs2       20      40      2    open/syncd    /isc</span><br></pre></td></tr></table></figure>
<p>可以看到 rootvg 卷组中存在 1 个过期的 STALE PPs。卷组的 LPs:PPs 为 1:2 处于镜像中。</p>
</li>
<li><p>查看卷组的物理卷状态</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#lspv hdisk0</span><br><span class="line">PHYSICAL VOLUME:    hdisk0                   VOLUME GROUP:     rootvg</span><br><span class="line">PV IDENTIFIER:      00f9838959802512 VG IDENTIFIER     00f9838900004c0000000149a2d111cf</span><br><span class="line">PV STATE:           active                                     </span><br><span class="line">STALE PARTITIONS:   1                        ALLOCATABLE:      yes</span><br><span class="line">PP SIZE:            512 megabyte(s)          LOGICAL VOLUMES:  15</span><br><span class="line">TOTAL PPs:          558 (285696 megabytes)   VG DESCRIPTORS:   2</span><br><span class="line">FREE PPs:           250 (128000 megabytes)   HOT SPARE:        no</span><br><span class="line">USED PPs:           308 (157696 megabytes)   MAX REQUEST:      1 megabyte</span><br><span class="line">FREE DISTRIBUTION:  111..00..00..27..112                       </span><br><span class="line">USED DISTRIBUTION:  01..112..111..84..00                       </span><br><span class="line">MIRROR POOL:        None                                       </span><br><span class="line">[TRDGMES1:root]/#  </span><br><span class="line">[TRDGMES1:root]/#lspv hdisk1</span><br><span class="line">PHYSICAL VOLUME:    hdisk1                   VOLUME GROUP:     rootvg</span><br><span class="line">PV IDENTIFIER:      00f98389cb6fdbfe VG IDENTIFIER     00f9838900004c0000000149a2d111cf</span><br><span class="line">PV STATE:           active                                     </span><br><span class="line">STALE PARTITIONS:   0                        ALLOCATABLE:      yes</span><br><span class="line">PP SIZE:            512 megabyte(s)          LOGICAL VOLUMES:  14</span><br><span class="line">TOTAL PPs:          558 (285696 megabytes)   VG DESCRIPTORS:   1</span><br><span class="line">FREE PPs:           270 (138240 megabytes)   HOT SPARE:        no</span><br><span class="line">USED PPs:           288 (147456 megabytes)   MAX REQUEST:      1 megabyte</span><br><span class="line">FREE DISTRIBUTION:  111..00..00..47..112                       </span><br><span class="line">USED DISTRIBUTION:  01..112..111..64..00                       </span><br><span class="line">MIRROR POOL:        None                                       </span><br></pre></td></tr></table></figure>
<p>过期的 STALE PPs 位于物理卷 hdisk0，即故障盘 hdisk0，因此无需处理。否则需要执行物理卷同步命令<code>syncvg –p hdisk0 hdisk1</code></p>
</li>
<li><p>迁移 sysdump 设备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#lspv -l hdisk0</span><br><span class="line">hdisk0:</span><br><span class="line">LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT</span><br><span class="line">hd10opt               20      20      00..00..20..00..00    /opt</span><br><span class="line">hd2                   30      30      00..10..20..00..00    /usr</span><br><span class="line">hd9var                20      20      00..00..20..00..00    /var</span><br><span class="line">hd3                   20      20      00..00..20..00..00    /tmp</span><br><span class="line">hd1                   120     120     00..27..09..84..00    /home</span><br><span class="line">hd5                   1       1       01..00..00..00..00    N/A</span><br><span class="line">hd6                   32      32      00..32..00..00..00    N/A</span><br><span class="line">hd8                   1       1       00..00..01..00..00    N/A</span><br><span class="line">hd4                   20      20      00..00..20..00..00    /</span><br><span class="line">hd11admin             1       1       00..00..01..00..00    /admin</span><br><span class="line">lg_dumplv             20      20      00..20..00..00..00    N/A</span><br><span class="line">livedump              1       1       00..01..00..00..00    /var/adm/ras/livedump</span><br><span class="line">loglv00               1       1       00..01..00..00..00    N/A</span><br><span class="line">lv00                  1       1       00..01..00..00..00    /var/adm/csd</span><br><span class="line">fslv00                20      20      00..20..00..00..00    /isc</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#migratepv -l lg_dumplv hdisk0 hdisk1</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lspv -l hdisk1</span><br><span class="line">hdisk1:</span><br><span class="line">LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT</span><br><span class="line">hd10opt               20      20      00..20..00..00..00    /opt</span><br><span class="line">hd2                   30      30      00..01..29..00..00    /usr</span><br><span class="line">hd9var                20      20      00..00..20..00..00    /var</span><br><span class="line">hd3                   20      20      00..00..20..00..00    /tmp</span><br><span class="line">hd1                   120     120     00..36..20..64..00    /home</span><br><span class="line">hd5                   1       1       01..00..00..00..00    N/A</span><br><span class="line">hd6                   32      32      00..32..00..00..00    N/A</span><br><span class="line">hd8                   1       1       00..00..01..00..00    N/A</span><br><span class="line">hd4                   20      20      00..00..20..00..00    /</span><br><span class="line">hd11admin             1       1       00..00..01..00..00    /admin</span><br><span class="line">lg_dumplv             20      20      20..00..00..00..00    N/A</span><br><span class="line">livedump              1       1       00..01..00..00..00    /var/adm/ras/livedump</span><br><span class="line">loglv00               1       1       00..01..00..00..00    N/A</span><br><span class="line">lv00                  1       1       00..01..00..00..00    /var/adm/csd</span><br><span class="line">fslv00                20      20      00..20..00..00..00    /isc</span><br></pre></td></tr></table></figure>
</li>
<li><p>取消卷组 rootvg 镜像，移除物理卷 hdisk0</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#unmirrorvg rootvg hdisk0</span><br><span class="line">0516-1246 rmlvcopy: If hd5 is the boot logical volume, please run &#x27;chpv -c &lt;diskname&gt;&#x27;</span><br><span class="line">     as root user to clear the boot record and avoid a potential boot</span><br><span class="line">     off an old boot image that may reside on the disk from which this</span><br><span class="line">     logical volume is moved/removed.</span><br><span class="line">0516-1804 chvg: The quorum change takes effect immediately.</span><br><span class="line">0516-1144 unmirrorvg: rootvg successfully unmirrored, user should perform</span><br><span class="line">     bosboot of system to reinitialize boot records.  Then, user must modify</span><br><span class="line">     bootlist to just include:  hdisk1.</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lsvg rootvg</span><br><span class="line">VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf</span><br><span class="line">VG STATE:           active                   PP SIZE:        512 megabyte(s)</span><br><span class="line">VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)</span><br><span class="line">MAX LVs:            256                      FREE PPs:       808 (413696 megabytes)</span><br><span class="line">LVs:                15                       USED PPs:       308 (157696 megabytes)</span><br><span class="line">OPEN LVs:           14                       QUORUM:         2 (Enabled)</span><br><span class="line">TOTAL PVs:          2                        VG DESCRIPTORS: 3</span><br><span class="line">STALE PVs:          0                        STALE PPs:      0</span><br><span class="line">ACTIVE PVs:         2                        AUTO ON:        yes</span><br><span class="line">MAX PPs per VG:     32512                                     </span><br><span class="line">MAX PPs per PV:     1016                     MAX PVs:        32</span><br><span class="line">LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no</span><br><span class="line">HOT SPARE:          no                       BB POLICY:      relocatable </span><br><span class="line">PV RESTRICTION:     none                     INFINITE RETRY: no</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lsvg -l rootvg</span><br><span class="line">rootvg:</span><br><span class="line">LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT</span><br><span class="line">hd5                 boot       1       1       1    closed/syncd  N/A</span><br><span class="line">hd6                 paging     32      32      1    open/syncd    N/A</span><br><span class="line">hd8                 jfs2log    1       1       1    open/syncd    N/A</span><br><span class="line">hd4                 jfs2       20      20      1    open/syncd    /</span><br><span class="line">hd2                 jfs2       30      30      1    open/syncd    /usr</span><br><span class="line">hd9var              jfs2       20      20      1    open/syncd    /var</span><br><span class="line">hd3                 jfs2       20      20      1    open/syncd    /tmp</span><br><span class="line">hd1                 jfs2       120     120     1    open/syncd    /home</span><br><span class="line">hd10opt             jfs2       20      20      1    open/syncd    /opt</span><br><span class="line">hd11admin           jfs2       1       1       1    open/syncd    /admin</span><br><span class="line">lg_dumplv           sysdump    20      20      1    open/syncd    N/A</span><br><span class="line">livedump            jfs2       1       1       1    open/syncd    /var/adm/ras/livedump</span><br><span class="line">loglv00             jfslog     1       1       1    open/syncd    N/A</span><br><span class="line">lv00                jfs        1       1       1    open/syncd    /var/adm/csd</span><br><span class="line">fslv00              jfs2       20      20      1    open/syncd    /isc</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#reducevg rootvg hdisk0</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#chpv -c hdisk0</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>diag</code> 命令进行硬盘热拔插更换，或使用 <code>rmdev -dl hdisk0</code> 删除硬盘。<br>参考链接：<a href="https://www.ibm.com/docs/en/power6?topic=rdd-replacing-disk-drive-aix-system-logical-partition-powered">Replacing a disk drive with the AIX system or logical partition powered on</a></p>
<p>更换时可能遇到进程占用导致磁盘忙问题，可根据实际情况杀掉占用进程。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#fuser /dev/hdisk0</span><br><span class="line">/dev/hdisk0:  22282522</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#proctree 22282522</span><br><span class="line">22282522    /usr/bin/topas_nmon  -f -d -T -^ -J -s 300 -c 288 -youtput_dir=/KIC/LOG/NMON/TR</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#kill -9 22282522</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#fuser /dev/hdisk0</span><br><span class="line">/dev/hdisk0: </span><br></pre></td></tr></table></figure>
</li>
<li><p>重新配置卷组 rootvg 镜像</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#cfgmgr -v</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lspv</span><br><span class="line">hdisk0          none                                None                        </span><br><span class="line">hdisk1          00f98389cb6fdbfe                    rootvg          active      </span><br><span class="line">hdisk2          00f98389ad9cf4af                    None                        </span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#chdev -l hdisk0 -a pv=yes</span><br><span class="line">hdisk0 changed </span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#extendvg rootvg hdisk0</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lspv</span><br><span class="line">hdisk0          00f983897ac05ab6                    rootvg          active      </span><br><span class="line">hdisk1          00f98389cb6fdbfe                    rootvg          active      </span><br><span class="line">hdisk2          00f98389ad9cf4af                    None              </span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#mirrorvg -S rootvg hdisk0</span><br><span class="line">0516-1804 chvg: The quorum change takes effect immediately.</span><br><span class="line">0516-1126 mirrorvg: rootvg successfully mirrored, user should perform</span><br><span class="line">        bosboot of system to initialize boot records.  Then, user must modify</span><br><span class="line">        bootlist to include:  hdisk0 hdisk1.</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lsvg rootvg</span><br><span class="line">VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf</span><br><span class="line">VG STATE:           active                   PP SIZE:        512 megabyte(s)</span><br><span class="line">VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)</span><br><span class="line">MAX LVs:            256                      FREE PPs:       520 (266240 megabytes)</span><br><span class="line">LVs:                15                       USED PPs:       596 (305152 megabytes)</span><br><span class="line">OPEN LVs:           15                       QUORUM:         1 (Disabled)</span><br><span class="line">TOTAL PVs:          2                        VG DESCRIPTORS: 3</span><br><span class="line">STALE PVs:          1                        STALE PPs:      288</span><br><span class="line">ACTIVE PVs:         2                        AUTO ON:        yes</span><br><span class="line">MAX PPs per VG:     32512                                     </span><br><span class="line">MAX PPs per PV:     1016                     MAX PVs:        32</span><br><span class="line">LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no</span><br><span class="line">HOT SPARE:          no                       BB POLICY:      relocatable </span><br><span class="line">PV RESTRICTION:     none                     INFINITE RETRY: no</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lsvg -l rootvg</span><br><span class="line">rootvg:</span><br><span class="line">LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT</span><br><span class="line">hd5                 boot       1       2       2    closed/syncd  N/A</span><br><span class="line">hd6                 paging     32      64      2    open/stale    N/A</span><br><span class="line">hd8                 jfs2log    1       2       2    open/stale    N/A</span><br><span class="line">hd4                 jfs2       20      40      2    open/stale    /</span><br><span class="line">hd2                 jfs2       30      60      2    open/stale    /usr</span><br><span class="line">hd9var              jfs2       20      40      2    open/stale    /var</span><br><span class="line">hd3                 jfs2       20      40      2    open/stale    /tmp</span><br><span class="line">hd1                 jfs2       120     240     2    open/stale    /home</span><br><span class="line">hd10opt             jfs2       20      40      2    open/stale    /opt</span><br><span class="line">hd11admin           jfs2       1       2       2    open/stale    /admin</span><br><span class="line">lg_dumplv           sysdump    20      20      1    open/syncd    N/A</span><br><span class="line">livedump            jfs2       1       2       2    open/stale    /var/adm/ras/livedump</span><br><span class="line">loglv00             jfslog     1       2       2    open/stale    N/A</span><br><span class="line">lv00                jfs        1       2       2    open/stale    /var/adm/csd</span><br><span class="line">fslv00              jfs2       20      40      2    open/stale    /isc</span><br></pre></td></tr></table></figure>
</li>
<li><p>等待镜像同步完成，LV STATE 由 stale 变为 syncd。</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#lsvg -l rootvg</span><br><span class="line">rootvg:</span><br><span class="line">LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT</span><br><span class="line">hd5                 boot       1       2       2    closed/syncd  N/A</span><br><span class="line">hd6                 paging     32      64      2    open/syncd    N/A</span><br><span class="line">hd8                 jfs2log    1       2       2    open/syncd    N/A</span><br><span class="line">hd4                 jfs2       20      40      2    open/syncd    /</span><br><span class="line">hd2                 jfs2       30      60      2    open/syncd    /usr</span><br><span class="line">hd9var              jfs2       20      40      2    open/syncd    /var</span><br><span class="line">hd3                 jfs2       20      40      2    open/syncd    /tmp</span><br><span class="line">hd1                 jfs2       120     240     2    open/syncd    /home</span><br><span class="line">hd10opt             jfs2       20      40      2    open/syncd    /opt</span><br><span class="line">hd11admin           jfs2       1       2       2    open/syncd    /admin</span><br><span class="line">lg_dumplv           sysdump    20      20      1    open/syncd    N/A</span><br><span class="line">livedump            jfs2       1       2       2    open/syncd    /var/adm/ras/livedump</span><br><span class="line">loglv00             jfslog     1       2       2    open/syncd    N/A</span><br><span class="line">lv00                jfs        1       2       2    open/syncd    /var/adm/csd</span><br><span class="line">fslv00              jfs2       20      40      2    open/syncd    /isc</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#lsvg rootvg</span><br><span class="line">VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf</span><br><span class="line">VG STATE:           active                   PP SIZE:        512 megabyte(s)</span><br><span class="line">VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)</span><br><span class="line">MAX LVs:            256                      FREE PPs:       520 (266240 megabytes)</span><br><span class="line">LVs:                15                       USED PPs:       596 (305152 megabytes)</span><br><span class="line">OPEN LVs:           14                       QUORUM:         1 (Disabled)</span><br><span class="line">TOTAL PVs:          2                        VG DESCRIPTORS: 3</span><br><span class="line">STALE PVs:          0                        STALE PPs:      0</span><br><span class="line">ACTIVE PVs:         2                        AUTO ON:        yes</span><br><span class="line">MAX PPs per VG:     32512                                     </span><br><span class="line">MAX PPs per PV:     1016                     MAX PVs:        32</span><br><span class="line">LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no</span><br><span class="line">HOT SPARE:          no                       BB POLICY:      relocatable </span><br><span class="line">PV RESTRICTION:     none                     INFINITE RETRY: no</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置系统启动逻辑卷</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[TRDGMES1:root]/#bootlist -m normal -o</span><br><span class="line">hdisk0 pathid=0</span><br><span class="line">hdisk1 blv=hd5 pathid=0</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#bosboot -ad hdisk0</span><br><span class="line">bosboot: Boot image is 55324 512 byte blocks.</span><br><span class="line">[TRDGMES1:root]/#</span><br><span class="line">[TRDGMES1:root]/#bootlist -m normal -o</span><br><span class="line">hdisk0 blv=hd5 pathid=0</span><br><span class="line">hdisk1 blv=hd5 pathid=0</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Unix</category>
        <category>AIX</category>
      </categories>
      <tags>
        <tag>rootvg</tag>
      </tags>
  </entry>
  <entry>
    <title>Configure systemd for MySQL</title>
    <url>/blog/posts/7f2e2fe4.html</url>
    <content><![CDATA[<ol>
<li><p>Add a systemd service unit configuration file with details about the MySQL service</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$&gt; <span class="built_in">cd</span> /usr/lib/systemd/system</span><br><span class="line">$&gt; <span class="built_in">touch</span> mysqld.service</span><br><span class="line">$&gt; <span class="built_in">chmod</span> 644 mysqld.service</span><br></pre></td></tr></table></figure>

<p>Add this configuration information to the mysqld.service file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">Documentation=man:mysqld(7)</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">After=network.target</span><br><span class="line">After=syslog.target</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/local/mysql/data/mysqld.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable service start and stop timeout logic of systemd for mysqld service.</span></span><br><span class="line">TimeoutSec=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start main service</span></span><br><span class="line">ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf --daemonize --pid-file=/usr/local/mysql/data/mysqld.pid <span class="variable">$MYSQLD_OPTS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use this to switch malloc implementation</span></span><br><span class="line">EnvironmentFile=-/etc/sysconfig/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets open_files_limit</span></span><br><span class="line">LimitNOFILE = 5000</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartPreventExitStatus=1</span><br><span class="line">PrivateTmp=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Add a configuration file for the systemd tmpfiles feature</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$&gt; <span class="built_in">cd</span> /usr/lib/tmpfiles.d</span><br><span class="line">$&gt; <span class="built_in">touch</span> mysql.conf</span><br><span class="line">$&gt; <span class="built_in">chmod</span> 644 mysql.conf</span><br></pre></td></tr></table></figure>

<p>Add this configuration information to the mysql.conf file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">d /usr/local/mysql/data 0750 mysql mysql -</span><br></pre></td></tr></table></figure>
</li>
<li><p>Enable the mysqld service to automatically start at reboot</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> mysqld.service --now</span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>Reset Root Password</title>
    <url>/blog/posts/e24cfc6c.html</url>
    <content><![CDATA[<h2 id="MySQL-5-7-6-and-later"><a href="#MySQL-5-7-6-and-later" class="headerlink" title="MySQL 5.7.6 and later"></a>MySQL 5.7.6 and later</h2><ol>
<li><p>Modify my.cnf, append <code>skip-grant-tables</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>
</li>
<li><p>Restart mysql server, update root password</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host,authentication_string <span class="keyword">from</span> mysql.user;</span><br><span class="line"><span class="keyword">update</span> mysql.user <span class="keyword">set</span> authentication_string<span class="operator">=</span>password(<span class="string">&#x27;Jove!123&#x27;</span>) <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="MySQL-5-7-5-and-earlier"><a href="#MySQL-5-7-5-and-earlier" class="headerlink" title="MySQL 5.7.5 and earlier"></a>MySQL 5.7.5 and earlier</h2><ol>
<li><p>Modify my.cnf, append <code>skip-grant-tables</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>
</li>
<li><p>Restart mysql server, update root password</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host,password <span class="keyword">from</span> mysql.user;</span><br><span class="line"><span class="keyword">update</span> mysql.user <span class="keyword">set</span> password<span class="operator">=</span>password(<span class="string">&#x27;Jove!123&#x27;</span>) <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span> <span class="keyword">and</span> host<span class="operator">=</span><span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>ArchiveLog Mode</title>
    <url>/blog/posts/35cf2db4.html</url>
    <content><![CDATA[<h1 id="Enabling-ArchiveLog-Mode"><a href="#Enabling-ArchiveLog-Mode" class="headerlink" title="Enabling ArchiveLog Mode"></a>Enabling ArchiveLog Mode</h1><h2 id="Single-Instance"><a href="#Single-Instance" class="headerlink" title="Single Instance"></a>Single Instance</h2><p><strong>Oracle 10g and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL>":1-6)</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> log_archive_dest_1<span class="operator">=</span><span class="string">&#x27;location=/archivelog&#x27;</span> <span class="keyword">scope</span><span class="operator">=</span>spfile;</span><br><span class="line">shutdown immediate</span><br><span class="line">startup mount</span><br><span class="line"><span class="keyword">alter</span> database archivelog;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> switch logfile;  <span class="comment">-- 切换归档 </span></span><br></pre></td></tr></table></figure>

<h2 id="Real-Application-Clusters"><a href="#Real-Application-Clusters" class="headerlink" title="Real Application Clusters"></a>Real Application Clusters</h2><p><strong>Oracle 10gR2 and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL>":1,4-5,7||"[grid@rac1 ~]$":2-3,6)</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> log_archive_dest_1<span class="operator">=</span><span class="string">&#x27;location=+ARCHDG&#x27;</span> sid<span class="operator">=</span><span class="string">&#x27;*&#x27;</span> <span class="keyword">scope</span><span class="operator">=</span>spfile;</span><br><span class="line">srvctl stop database <span class="operator">-</span>d coco</span><br><span class="line">srvctl <span class="keyword">start</span> instance <span class="operator">-</span>d coco <span class="operator">-</span>i coco1 <span class="operator">-</span>o mount</span><br><span class="line"><span class="keyword">alter</span> database archivelog;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br><span class="line">srvctl <span class="keyword">start</span> database <span class="operator">-</span>d coco</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> archive log <span class="keyword">current</span>;  <span class="comment">-- 切换归档 </span></span><br></pre></td></tr></table></figure>

<h1 id="Disabling-ArchiveLog-Mode"><a href="#Disabling-ArchiveLog-Mode" class="headerlink" title="Disabling ArchiveLog Mode"></a>Disabling ArchiveLog Mode</h1><h2 id="Single-Instance-1"><a href="#Single-Instance-1" class="headerlink" title="Single Instance"></a>Single Instance</h2><p><strong>Oracle 10g and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL>":1-4)</span></figcaption><table><tr><td class="code"><pre><span class="line">shutdown immediate</span><br><span class="line">startup mount</span><br><span class="line"><span class="keyword">alter</span> database noarchivelog;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Real-Application-Clusters-1"><a href="#Real-Application-Clusters-1" class="headerlink" title="Real Application Clusters"></a>Real Application Clusters</h2><p><strong>Oracle 10gR2 and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL>":3-4||"[grid@rac1 ~]$":1-2,5)</span></figcaption><table><tr><td class="code"><pre><span class="line">srvctl stop database <span class="operator">-</span>d coco</span><br><span class="line">srvctl <span class="keyword">start</span> instance <span class="operator">-</span>d coco <span class="operator">-</span>i coco1 <span class="operator">-</span>o mount</span><br><span class="line"><span class="keyword">alter</span> database noarchivelog;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br><span class="line">srvctl <span class="keyword">start</span> database <span class="operator">-</span>d coco</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>archivelog</tag>
      </tags>
  </entry>
  <entry>
    <title>Automatic Optimizer Statistics Collection</title>
    <url>/blog/posts/6df4f1a1.html</url>
    <content><![CDATA[<h4 id="概述"><a href="# 概述" class="headerlink" title="概述"></a> 概述 </h4><p>   在 Oracle 10g 之前并没有自动收集统计信息的机制，从 Oracle 10g 开始引入了自动收集统计信息的功能，这个功能在 Oracle 10g 中被称为自动统计信息收集（Automatic Statistics Gathering）<br>   在 Oracle 11g 中被称为自动优化器统计信息收集（Automatic Optimizer Statistics Collection）。自动统计信息收集作业能够每天收集普通对象和数据字典的统计信息，但不会收集 X$ 系列表的内部对象统计信息。</p>
<p>  Oracle 的初始化参数 STATISTICS_LEVEL 控制收集统计信息的级别，有三个参数值：<br>  1、 BASIC：收集基本的统计信息 <br>  2、 TYPICAL：收集大部分统计信息（数据库的默认设置）<br>  3、 ALL：收集全部统计信息 <br>  当使用 Oracle 自动收集统计信息时，必须要确保 Oracle 的参数 STATISTICS_LEVEL 的值为 TYPICAL 或者 ALL。默认值为 TYPICAL，该值可以确保数据库自我管理功能所需求的所有主要统计信息的正确收集，及提供最好的综合性能。这个默认值可以能胜任大多数的环境，并且 Oracle 不推荐去修改该值。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>statistics</tag>
      </tags>
  </entry>
  <entry>
    <title>Job Schedule</title>
    <url>/blog/posts/f322012a.html</url>
    <content><![CDATA[<ol>
<li><p> 运行 job</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  DBMS_JOB.RUN(<span class="number">43</span>); <span class="comment">/* job id */</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 禁用 &#x2F; 启用 job</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_job.broken(<span class="number">43</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_job.broken(<span class="number">43</span>,<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 删除 job</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_job.remove(<span class="number">43</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>job</tag>
      </tags>
  </entry>
  <entry>
    <title>Index</title>
    <url>/blog/posts/41b24805.html</url>
    <content><![CDATA[<p><img src="https://images.cnblogs.com/cnblogs_com/liuning8023/201211/201211172345262843.jpg"></p>
<p>访问索引列的数据一般需要 3 次 IO，Root-Branch-Leaf。<br>访问索引列外的数据需要 4 次 IO，Root-Branch-Leaf- 回表 (TABLE ACCESS BY INDEX ROWID)。<br> 索引对 DML 操作的影响，INSERT &gt; DELETE &gt; UPDATE</p>
<p>[创建索引会引发排序及全表索，排序会非常消耗 CPU 性能，全表锁会阻止 DML 操作]{.red}</p>
<p><strong>索引的三大特点</strong></p>
<ul>
<li>索引树的高度一般比较低。</li>
<li>索引由索引列存储的值及 ROWID 组成。</li>
<li>索引本身是有序的。</li>
</ul>
<p><strong>分区表索引</strong></p>
<ul>
<li>分为全局索引和分区索引。</li>
<li>分区索引，要有使用分区字段条件的场景，否则建议使用全局索引。</li>
</ul>
<p><strong>count(*)优化</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--NULL 和 NOT NULL 不等价，排除 NULL 值，执行计划由 TABLE ACCESS FULL 变为 INDEX FAST FULL SCAN</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t <span class="keyword">where</span> id <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或将列设置 NOT NULL，执行计划为 INDEX FAST FULL SCAN</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t modify id <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure>

<p><strong>MAX&#x2F;MIN 优化</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--NULL 和 NOT NULL 等价，执行计划为 INDEX FULL SCAN (MIN/MAX)，MIN 一定位于左边的叶子块，MAX 一定位于最右边的叶子块</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(id) <span class="keyword">from</span> t;</span><br><span class="line"></span><br><span class="line"><span class="comment">--Oracle 无法同时在左边和最右边读取，执行计划为 TABLE ACCESS FULL</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(id),<span class="built_in">min</span>(id) <span class="keyword">from</span> t;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分开查询，执行计划为 INDEX FULL SCAN (MIN/MAX)</span></span><br><span class="line"><span class="keyword">select</span> min,max <span class="keyword">from</span> (<span class="keyword">select</span> mix(id) min <span class="keyword">from</span> t) a, (<span class="keyword">select</span> <span class="built_in">max</span>(id) max <span class="keyword">from</span> t) b;</span><br></pre></td></tr></table></figure>

<p><strong>回表优化</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看索引列以外的数据，会出现回表，执行计划 TABLE ACCESS BY INDEX ROWID</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> id<span class="operator">=</span><span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p><strong>索引全扫与索引快速全扫</strong></p>
<ul>
<li>INDEX FAST FULL SCAN 一次读取多个索引块，INDEX FULL SCAN 一次只读取一个索引块。</li>
<li>INDEX FAST FULL SCAN 一次读取多个索引块不容易保持有序，而 INDEX FULL SCAN 一次读取一个索引块可以保持有序，因此在有排序的场合，INDEX FULL SCAN 的顺序读可以消除排序，INDEX FAST FULL SCAN 虽然减少了逻辑读，但是无法消除排序。</li>
</ul>
<p><strong>UNION 合并优化</strong></p>
<p>UNION 合并会去除重复记录，UNION ALL 则是简单的合并，在 UNION 中索引一般无法消除排序，最常见的优化是将 UNION 改为 UNION ALL。</p>
<p><strong>联合索引</strong></p>
<p>联合索引不宜超过 3 个字段，否则不仅影响定位数据，更严重影响更新性能。可以用类似如下方式测试联合字段返回的记录是否比单个字段记录少得多。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t <span class="keyword">where</span> a<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t <span class="keyword">where</span> b<span class="operator">=</span><span class="number">2</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> t <span class="keyword">where</span> a<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> b<span class="operator">=</span><span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在两列都是等值查询的情况下，组合索引的列无论哪一列在前，性能都一样;</p>
<p>在一列是范围查询，一列是等值查询的情况下，等值查询列在前，范围查询列在后，这样索引才最高效；</p>
<p>单列的查询列和联合索引的前置列一样，那单列可以不建索引，直接利用联合索引来进行检索数据。</p>
</blockquote>
<p><strong>位图索引</strong></p>
<p>位图索引的适用场景要满足两个条件：一，位图索引列大量重复；二，该表极少更新。</p>
<p><strong>函数索引</strong></p>
<p>对索引列进行运算会导致索引无法使用，在无法避免列运算时，可以创建函数索引加以优化。</p>
<h4 id="分析是否需要重建索引"><a href="# 分析是否需要重建索引" class="headerlink" title="分析是否需要重建索引"></a>分析是否需要重建索引 </h4><p> 分析索引的数据块是否有坏块，以及根据分析得到的数据（存放在 index_stats）來判断索引是否需要重新建立。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> analyze index AATD_IDX1 validate structure; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>validate structure 有两种模式：<br>online ：（默认）会对表加一个 4 级別的锁（表共享），对 run 系統可能造成一定的影响。<br>offline ：没有表 lock 的影响，但当以 online 模式分析时， 在视图 index_stats 没有统计信息。</p>
</blockquote>
<p>从 9i 开始，Oracle 以建议使用 dbms_stats package 代替 analyze 了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">exec</span> dbms_stats.gather_table_stats(‘用户名’,‘表名’,cascade<span class="operator">=</span><span class="operator">&gt;</span><span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>下面视图只支持：analyze index 命令</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> height,DEL_LF_ROWS<span class="operator">/</span>LF_ROWS <span class="keyword">from</span> index_stats;</span><br><span class="line">HEIGHT DEL_LF_ROWS<span class="operator">/</span>LF_ROWS</span><br><span class="line"><span class="comment">---------- -------------------</span></span><br><span class="line">    <span class="number">1</span>                   <span class="number">0</span></span><br><span class="line">Executed <span class="keyword">in</span> <span class="number">0.381</span> seconds</span><br></pre></td></tr></table></figure>

<p>当查询出来的 height&gt;&#x3D;4，或者 DEL_LF_ROWS&#x2F;LF_ROWS&gt;0.2 的场合, 该索引考虑重建。</p>
<h4 id="重建索引"><a href="# 重建索引" class="headerlink" title="重建索引"></a>重建索引</h4><ol>
<li><p>删除创建索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> index idx_id_t1;</span><br><span class="line"><span class="keyword">create</span> index idx_id_t1 <span class="keyword">on</span> t1(id);</span><br></pre></td></tr></table></figure>

<p>说明：此方式耗时间，无法在 24*7 环境中实现，不建议使用。</p>
</li>
<li><p>重建索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> index idx_id_t1 rebuild;</span><br><span class="line"><span class="keyword">alter</span> index idx_id_t1 rebuild online;</span><br></pre></td></tr></table></figure>

<p>说明：此方式比较快，可以在 24*7 环境中实现，建议使用此方式。</p>
<blockquote>
<p>rebuild 与 rebuild online 的区别</p>
<ol>
<li><p>rebuild 根据统计信息的 cost 采用 index fast full scan 或者 table full scan 方式读取原索引中的数据来构建一个新的索引，有排序的操作; rebuild online 执行表扫描获取数据，有排序的操作。</p>
</li>
<li><p>rebuild 会阻塞 dml 操作，rebuild online 不会阻塞 dml 操作。rebuild online 时系统会产生一个 SYS_JOURNAL_xxx 的 IOT 类型的系统临时日志表, 所有 rebuild online 时索引的变化都记录在这个表中，当新的索引创建完成后，把这个表的记录维护到新的索引中去，然后 drop 掉旧的索引，rebuild online 就完成了。</p>
</li>
</ol>
</blockquote>
</li>
</ol>
<p>注意点：</p>
<ol>
<li>执行 rebuild 操作时，需要检查表空间是否足够</li>
<li>虽然说 rebuild online 操作允许 dml 操作，但是还是建议在业务不繁忙时间段进行 rebuild 操作会产生大量 redo log</li>
</ol>
<h4 id="重建分区索引"><a href="# 重建分区索引" class="headerlink" title="重建分区索引"></a>重建分区索引</h4><ol>
<li>重建分区表上的分区索引:</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> index indexname rebuild <span class="keyword">partition</span> PARTITION_NAME tablespace tablespacename;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;alter index &#x27;</span><span class="operator">||</span> index_name <span class="operator">||</span> <span class="string">&#x27; rebuild partition &#x27;</span><span class="operator">||</span> partition_name <span class="operator">||</span> <span class="string">&#x27; online;&#x27;</span> <span class="keyword">from</span> user_ind_partitions <span class="keyword">where</span> index_name <span class="operator">=</span><span class="string">&#x27; 索引 &#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>子分区索引重建：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> index indexname rebuild subpartition PARTITION_NAME tablespace tablespacename;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;alter index &#x27;</span><span class="operator">||</span> index_name <span class="operator">||</span> <span class="string">&#x27; rebuild subpartition &#x27;</span><span class="operator">||</span> subpartition_name <span class="operator">||</span> <span class="string">&#x27; online;&#x27;</span> <span class="keyword">from</span> user_ind_subpartitions;</span><br></pre></td></tr></table></figure>

<p>注：这里的 PARTITION_NAME 指 USER_IND_PARTITIONS 中的 PARTITION_NAME(索引分区中的索引分区名)</p>
<ol start="3">
<li>查询分区表索引所在的分区</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> PI.TABLE_NAME,</span><br><span class="line">IP.INDEX_NAME,</span><br><span class="line">IP.PARTITION_NAME,</span><br><span class="line">IP.STATUS,</span><br><span class="line">IP.GLOBAL_STATS</span><br><span class="line"><span class="keyword">FROM</span> USER_PART_INDEXES PI, USER_IND_PARTITIONS IP</span><br><span class="line"><span class="keyword">WHERE</span> PI.INDEX_NAME <span class="operator">=</span> IP.INDEX_NAME <span class="keyword">AND</span> PI.TABLE_NAME <span class="operator">=</span> <span class="string">&#x27; 表名 &#x27;</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>index</tag>
      </tags>
  </entry>
  <entry>
    <title>Password Expired Limited</title>
    <url>/blog/posts/f6117f7c.html</url>
    <content><![CDATA[<h1 id="Oracle 密码过期，取消密码 180 天限制"><a href="#Oracle 密码过期，取消密码 180 天限制" class="headerlink" title="Oracle 密码过期，取消密码 180 天限制"></a>Oracle 密码过期，取消密码 180 天限制 </h1><ol>
<li> 查看用户的 profile</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username, profile <span class="keyword">FROM</span> dba_users <span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;EXFSYS&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 查看 profile 的密码有效期设置 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dba_profiles s <span class="keyword">WHERE</span> s.profile<span class="operator">=</span><span class="string">&#x27;DEFAULT&#x27;</span> <span class="keyword">AND</span> resource_name <span class="keyword">LIKE</span> <span class="string">&#x27;PASSWORD%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 将密码有效期由默认的 180 天修改成“无限制”，修改之后不需要重启动数据库，会立即生效 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> PROFILE <span class="keyword">DEFAULT</span> LIMIT PASSWORD_LIFE_TIME UNLIMITED;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li> 用户再改一次密码 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> exfsys identified <span class="keyword">by</span> abc123;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li> 用户解锁 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> exfsys account unlock;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Setting Oracle Huagepages Parameters</title>
    <url>/blog/posts/1ae7b462.html</url>
    <content><![CDATA[<h1 id="Setting-Oracle-Huagepages-Parameters"><a href="#Setting-Oracle-Huagepages-Parameters" class="headerlink" title="Setting Oracle Huagepages Parameters"></a>Setting Oracle Huagepages Parameters</h1><ul>
<li><strong>memlock</strong>: KB, At least 90 percent of the current RAM when HugePages memory is enabled and at least 3145728 KB (3 GB) when HugePages memory is disabled.</li>
<li><strong>kernel.shmall</strong>: This parameter sets the total amount of shared memory pages that can be used system wide. Hence, SHMALL should always be at least ceil(SHMMAX &#x2F; PAGESIZE).</li>
<li><strong>kernel.shmmax</strong>: B, This parameter defines the maximum size in bytes of a single shared memory segment that a Linux process can allocate in its virtual address space. Recommended half the size of physical memory in bytes.</li>
<li><strong>vm.nr_hugepages</strong>: value &#x3D; TotalSharedMemory &#x2F; Hugepagesize</li>
</ul>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><div class="note info modern"><p>physical memory: 12288 MB<br>sga_target: 6144 MB<br>pga_aggregate_target: 2048 MB</p>
</div>

<p><strong>MemTotal</strong>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># grep MemTotal /proc/meminfo</span></span><br><span class="line">MemTotal:       12077768 kB</span><br><span class="line">[root@oracle19crac ~]<span class="comment">#</span></span><br><span class="line">[root@oracle19crac ~]<span class="comment"># free -k</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:       12077768     9707116      533356      221304     1837296     1843296</span><br><span class="line">Swap:       8278012     2460812     5817200</span><br></pre></td></tr></table></figure>

<p>Script:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check for the kernel version</span></span><br><span class="line">KERN=`<span class="built_in">uname</span> -r | awk -F. <span class="string">&#x27;&#123; printf(&quot;%d.%d\n&quot;,$1,$2); &#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find out the Page size</span></span><br><span class="line">PG_SIZE=`getconf PAGESIZE`</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find out the HugePage size</span></span><br><span class="line">HPG_SZ=`grep Hugepagesize /proc/meminfo | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"><span class="keyword">if</span> [-z <span class="string">&quot;<span class="variable">$HPG_SZ</span>&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The hugepages may not be supported in the system where the script is being executed.&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Initialize the counter</span></span><br><span class="line">NUM_PG=0</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&#x27;Please input sga_target expect value (GB): &#x27;</span> SGA_SIZE</span><br><span class="line">MEM_LOCK=`free -k | awk <span class="string">&#x27;/Mem/ &#123;printf &quot;%d\n&quot;,$2*0.9+1&#125;&#x27;</span>`</span><br><span class="line">SGE_BYTES=`free -b | awk <span class="string">&#x27;/Mem/ &#123;printf &quot;%d\n&quot;,$2*0.5+1&#125;&#x27;</span>`</span><br><span class="line">ALL_SGES=`<span class="built_in">echo</span> <span class="string">&quot;(<span class="variable">$SGA_SIZE</span>+1)*1024*1024*1024/<span class="variable">$PG_SIZE</span>&quot;</span> | bc -q`</span><br><span class="line">NUM_PG=`<span class="built_in">echo</span> <span class="string">&quot;(<span class="variable">$SGA_SIZE</span>+1)*1024*1024/<span class="variable">$HPG_SZ</span>&quot;</span> | bc -q`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;memlock = <span class="variable">$MEM_LOCK</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;shmmax = <span class="variable">$SGE_BYTES</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;shmall = <span class="variable">$ALL_SGES</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;nr_hugepages = <span class="variable">$NUM_PG</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Please input sga_target expect value (GB): 6</span><br><span class="line">memlock = 10869992</span><br><span class="line">shmmax = 6183817217</span><br><span class="line">shmall = 1835008</span><br><span class="line">nr_hugepages = 3584</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>hugepages</tag>
      </tags>
  </entry>
  <entry>
    <title>Table</title>
    <url>/blog/posts/37e8a042.html</url>
    <content><![CDATA[<p><strong>DBA_TABLES &gt;&#x3D; ALL_TABLES &gt;&#x3D; USER_TABLES</strong></p>
<ul>
<li>DBA_TABLES：DBA 拥有的或者可以访问的所有关系表 </li>
<li>ALL_TABLES：某一用户所拥有的或者可以访问的所有关系表 </li>
<li>USER_TABLES：某一用户所拥有的所有关系表 </li>
</ul>
<p> 查看表属于哪个用户 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> owner <span class="keyword">from</span> dba_tables <span class="keyword">where</span> table_name<span class="operator">=</span><span class="built_in">upper</span>(<span class="string">&#x27;table_name&#x27;</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>table</tag>
      </tags>
  </entry>
  <entry>
    <title>user_privs</title>
    <url>/blog/posts/eb6b8ac4.html</url>
    <content><![CDATA[<h1 id="user-privs"><a href="#user-privs" class="headerlink" title="user_privs"></a>user_privs</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询系统权限，角色 </span></span><br><span class="line"><span class="keyword">select</span> grantee,privilege <span class="keyword">as</span> privs_or_roles,admin_option <span class="keyword">from</span> dba_sys_privs <span class="keyword">where</span> grantee<span class="operator">=</span><span class="string">&#x27;JOVE&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> grantee,granted_role,admin_option <span class="keyword">from</span> dba_role_privs <span class="keyword">where</span> grantee<span class="operator">=</span><span class="string">&#x27;JOVE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询对象权限 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_tab_privs <span class="keyword">where</span> grantee<span class="operator">=</span><span class="string">&#x27;JOVE&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询角色 / 角色权限 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_roles;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> role_sys_privs <span class="keyword">where</span> role<span class="operator">=</span><span class="string">&#x27;DBA&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> role_tab_privs <span class="keyword">where</span> role<span class="operator">=</span><span class="string">&#x27;DBA&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据库提供的系统权限 / 对象权限 </span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> sys.system_privilege_map;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_privilege_map;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>privs</tag>
      </tags>
  </entry>
  <entry>
    <title>Overview</title>
    <url>/blog/posts/1eb5b3ed.html</url>
    <content><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><h2 id="Change-ASM-DiskGroup-compatibility"><a href="#Change-ASM-DiskGroup-compatibility" class="headerlink" title="Change ASM DiskGroup compatibility"></a>Change ASM DiskGroup compatibility</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> diskgroup dg2 <span class="keyword">set</span> attribute <span class="string">&#x27;compatible.asm&#x27;</span><span class="operator">=</span><span class="string">&#x27;11.1&#x27;</span>;</span><br><span class="line"><span class="keyword">alter</span> diskgroup dg2 <span class="keyword">set</span> attribute <span class="string">&#x27;compatible.rdbms&#x27;</span><span class="operator">=</span><span class="string">&#x27;11.1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="REDUNDANCY"><a href="#REDUNDANCY" class="headerlink" title="REDUNDANCY"></a>REDUNDANCY</h2><p>指的是一个 diskgroup 内同一份数据的保护级别，通过 failgroup 的冗余来保证数据的冗余，有三个取值，external，normal，high。</p>
<h2 id="FAILGROUP"><a href="#FAILGROUP" class="headerlink" title="FAILGROUP"></a>FAILGROUP</h2><p>一个或多个磁盘构成的整体，它是磁盘组的一部分，Oracle 保证每一个 extent 和它对应的镜像不会保存在相同的 failure group 中，从而确保了当 Failure group 中的某一个或多个磁盘，甚至整个 failure group 全部丢失时也不会有数据丢失，并实现了数据的镜像。如果在创建磁盘组时指定了 failure group，数据就以 AU 为单位在 failure group 之间实现镜像，如果创建磁盘组时没有指定 failure group，那么每一块磁盘就作为一个 failure group，以 AU 为单位对数据进行镜像。</p>
<blockquote>
<p><strong>external redundancy</strong><br>冗余级别为 external 时，ASM 不保证数据的冗余，完全依赖于存储的冗余，不能指定 failgroup，但是默认会为每一个 disk 分配一个 failgroup，同一份数据只能存在一个 failgroup 中。<br><strong>normal redundancy</strong><br>冗余级别为 normal 时，ASM 要求至少 2 个 failgroup，可以大于 2 个，每一份数据会存储两份，分别位于两个不同的 failgroup 中 <br><strong>high redundancy</strong><br> 冗余级别为 high 时，ASM 要求至少 3 个 failgroup，可以大于 3 个，每一份数据会存储三份，分别位于三个不同的 failgroup 中</p>
</blockquote>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>overview</tag>
      </tags>
  </entry>
  <entry>
    <title>ASMLib</title>
    <url>/blog/posts/d08e9af.html</url>
    <content><![CDATA[<ol>
<li><p>Install</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># ll /soft/</span></span><br><span class="line">total 3664732</span><br><span class="line">-r-xr-x---. 1 root root         304920 Apr 30 20:50 kmod-oracleasm-2.0.8-28.0.1.el7.x86_64.rpm</span><br><span class="line">-r-xr-x---. 1 root root          19360 Apr 30 20:50 oracleasmlib-2.0.12-1.el7.x86_64.rpm</span><br><span class="line">-r-xr-x---. 1 root root          86908 Apr 30 20:51 oracleasm-support-2.1.11-2.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">[root@rac1 ~]<span class="comment"># yum -y localinstall /soft/*</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Configure</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># oracleasm configure -i</span></span><br><span class="line">Configuring the Oracle ASM library driver.</span><br><span class="line"></span><br><span class="line">This will configure the on-boot properties of the Oracle ASM library</span><br><span class="line">driver.  The following questions will determine whether the driver is</span><br><span class="line">loaded on boot and what permissions it will have.  The current values</span><br><span class="line">will be shown <span class="keyword">in</span> brackets (<span class="string">&#x27;[]&#x27;</span>).  Hitting &lt;ENTER&gt; without typing an</span><br><span class="line">answer will keep that current value.  Ctrl-C will abort.</span><br><span class="line"></span><br><span class="line">Default user to own the driver interface []: grid</span><br><span class="line">Default group to own the driver interface []: asmadmin</span><br><span class="line">Start Oracle ASM library driver on boot (y/n) [n]: y</span><br><span class="line">Scan <span class="keyword">for</span> Oracle ASM disks on boot (y/n) [y]: y</span><br><span class="line">Writing Oracle ASM library driver configuration: <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>View ASMLib driver configuration file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># cat /etc/sysconfig/oracleasm</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This is a configuration file for automatic loading of the Oracle</span></span><br><span class="line"><span class="comment"># Automatic Storage Management library kernel driver.  It is generated</span></span><br><span class="line"><span class="comment"># By running /etc/init.d/oracleasm configure.  Please use that method</span></span><br><span class="line"><span class="comment"># to modify this file</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_ENABLED: &#x27;true&#x27; means to load the driver on boot.</span></span><br><span class="line">ORACLEASM_ENABLED=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_UID: Default user owning the /dev/oracleasm mount point.</span></span><br><span class="line">ORACLEASM_UID=grid</span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_GID: Default group owning the /dev/oracleasm mount point.</span></span><br><span class="line">ORACLEASM_GID=asmadmin</span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_SCANBOOT: &#x27;true&#x27; means scan for ASM disks on boot.</span></span><br><span class="line">ORACLEASM_SCANBOOT=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_SCANORDER: Matching patterns to order disk scanning</span></span><br><span class="line">ORACLEASM_SCANORDER=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_SCANEXCLUDE: Matching patterns to exclude disks from scan</span></span><br><span class="line">ORACLEASM_SCANEXCLUDE=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_SCAN_DIRECTORIES: Scan disks under these directories</span></span><br><span class="line">ORACLEASM_SCAN_DIRECTORIES=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ORACLEASM_USE_LOGICAL_BLOCK_SIZE: &#x27;true&#x27; means use the logical block size</span></span><br><span class="line"><span class="comment"># reported by the underlying disk instead of the physical. The default</span></span><br><span class="line"><span class="comment"># is &#x27;false&#x27;</span></span><br><span class="line">ORACLEASM_USE_LOGICAL_BLOCK_SIZE=<span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Load and initialize the ASMLib driver</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># oracleasm init</span></span><br><span class="line">Creating /dev/oracleasm mount point: /dev/oracleasm</span><br><span class="line">Loading module <span class="string">&quot;oracleasm&quot;</span>: oracleasm</span><br><span class="line">Configuring <span class="string">&quot;oracleasm&quot;</span> to use device physical block size</span><br><span class="line">Mounting ASMlib driver filesystem: /dev/oracleasm</span><br><span class="line">[root@rac1 ~]<span class="comment">#</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm status</span></span><br><span class="line">Checking <span class="keyword">if</span> ASM is loaded: <span class="built_in">yes</span></span><br><span class="line">Checking <span class="keyword">if</span> /dev/oracleasm is mounted: <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Create disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># oracleasm createdisk OCR_VOTE1 /dev/sdb1</span></span><br><span class="line">Writing disk header: <span class="keyword">done</span></span><br><span class="line">Instantiating disk: <span class="keyword">done</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm createdisk OCR_VOTE2 /dev/sdc1</span></span><br><span class="line">Writing disk header: <span class="keyword">done</span></span><br><span class="line">Instantiating disk: <span class="keyword">done</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm createdisk OCR_VOTE3 /dev/sdd1</span></span><br><span class="line">Writing disk header: <span class="keyword">done</span></span><br><span class="line">Instantiating disk: <span class="keyword">done</span></span><br><span class="line">[root@rac1 ~]<span class="comment">#</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm listdisks</span></span><br><span class="line">OCR_VOTE1</span><br><span class="line">OCR_VOTE2</span><br><span class="line">OCR_VOTE3</span><br></pre></td></tr></table></figure>
</li>
<li><p>Scan disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac2 ~]<span class="comment"># oracleasm scandisks</span></span><br><span class="line">Reloading disk partitions: <span class="keyword">done</span></span><br><span class="line">Cleaning any stale ASM disks...</span><br><span class="line">Scanning system <span class="keyword">for</span> ASM disks...</span><br><span class="line">Instantiating disk <span class="string">&quot;OCR_VOTE1&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;OCR_VOTE2&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;OCR_VOTE3&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>asmlib</tag>
      </tags>
  </entry>
  <entry>
    <title>Maintenance</title>
    <url>/blog/posts/a918773e.html</url>
    <content><![CDATA[<h4 id="Setting-Disk-String"><a href="#Setting-Disk-String" class="headerlink" title="Setting Disk String"></a>Setting Disk String</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> asm_diskstring<span class="operator">=</span><span class="string">&#x27;ORCL:*&#x27;</span> <span class="keyword">scope</span><span class="operator">=</span><span class="keyword">both</span> sid<span class="operator">=</span><span class="string">&#x27;*&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Creating-Disk-Groups"><a href="#Creating-Disk-Groups" class="headerlink" title="Creating Disk Groups"></a>Creating Disk Groups</h4><p><img src="https://docs.oracle.com/cd/B19306_01/server.102/b14200/img/create_diskgroup.gif"><br><img src="https://docs.oracle.com/cd/B19306_01/server.102/b14200/img/qualified_disk_clause.gif"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DISKGROUP data NORMAL REDUNDANCY</span><br><span class="line">  FAILGROUP controller1 DISK</span><br><span class="line">    <span class="string">&#x27;/devices/diska1&#x27;</span> NAME diska1,</span><br><span class="line">    <span class="string">&#x27;/devices/diska2&#x27;</span> NAME diska2,</span><br><span class="line">    <span class="string">&#x27;/devices/diska3&#x27;</span> NAME diska3,</span><br><span class="line">    <span class="string">&#x27;/devices/diska4&#x27;</span> NAME diska4</span><br><span class="line">  FAILGROUP controller2 DISK</span><br><span class="line">    <span class="string">&#x27;/devices/diskb1&#x27;</span> NAME diskb1,</span><br><span class="line">    <span class="string">&#x27;/devices/diskb2&#x27;</span> NAME diskb2,</span><br><span class="line">    <span class="string">&#x27;/devices/diskb3&#x27;</span> NAME diskb3,</span><br><span class="line">    <span class="string">&#x27;/devices/diskb4&#x27;</span> NAME diskb4</span><br><span class="line">  ATTRIBUTE <span class="string">&#x27;au_size&#x27;</span><span class="operator">=</span><span class="string">&#x27;4M&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;compatible.asm&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;compatible.rdbms&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;compatible.advm&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DISKGROUP DATA <span class="keyword">EXTERNAL</span> REDUNDANCY</span><br><span class="line">  DISK <span class="string">&#x27;ORCL:DATA1&#x27;</span>,<span class="string">&#x27;ORCL:DATA2&#x27;</span>,<span class="string">&#x27;ORCL:DATA3&#x27;</span></span><br><span class="line">  ATTRIBUTE <span class="string">&#x27;COMPATIBLE.ASM&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Dropping-Disk-Groups"><a href="#Dropping-Disk-Groups" class="headerlink" title="Dropping Disk Groups"></a>Dropping Disk Groups</h4><p>The default is <code>EXCLUDING CONTENTS</code>, which provides syntactic consistency and prevents you from dropping the disk group if it has any contents.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> diskgroup DATA;</span><br></pre></td></tr></table></figure>

<p>You can specify the <code>INCLUDING CONTENTS</code> clause if you also want to delete all files that are contained in the disk group.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> diskgroup DATA including contents;</span><br></pre></td></tr></table></figure>

<p>If you cannot mount a disk group but must drop it, you can use the <code>FORCE</code> option of the <code>DROP DISKGROUP</code> statement.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> diskgroup DATA force;</span><br></pre></td></tr></table></figure>

<h4 id="Disk-Group-Compatibility"><a href="#Disk-Group-Compatibility" class="headerlink" title="Disk Group Compatibility"></a>Disk Group Compatibility</h4><p>Valid Combinations of Compatibility Attribute Settings for 11g</p>
<table>
<thead>
<tr>
<th>COMPATIBLE.ASM</th>
<th>COMPATIBLE.RDBMS</th>
<th>COMPATIBLE.ADVM</th>
<th>ASM Instance Version</th>
<th>COMPATIBLE Setting for RDBMS Instance</th>
</tr>
</thead>
<tbody><tr>
<td>10.1</td>
<td>10.1</td>
<td>n&#x2F;a</td>
<td>&gt;&#x3D; 10.1</td>
<td>&gt;&#x3D; 10.1</td>
</tr>
<tr>
<td>11.1</td>
<td>10.1</td>
<td>n&#x2F;a</td>
<td>&gt;&#x3D; 11.1</td>
<td>&gt;&#x3D; 10.1</td>
</tr>
<tr>
<td>11.2</td>
<td>11.1</td>
<td>11.2</td>
<td>&gt;&#x3D; 11.2</td>
<td>&gt;&#x3D; 11.1</td>
</tr>
<tr>
<td>11.2</td>
<td>11.2</td>
<td>11.2</td>
<td>&gt;&#x3D; 11.2</td>
<td>&gt;&#x3D; 11.2</td>
</tr>
</tbody></table>
<p>Using <code>ALTER DISKGROUP</code> with Compatibility Attributes</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DISKGROUP DATA <span class="keyword">SET</span> ATTRIBUTE <span class="string">&#x27;compatible.asm&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>;</span><br><span class="line"><span class="keyword">ALTER</span> DISKGROUP DATA <span class="keyword">SET</span> ATTRIBUTE <span class="string">&#x27;compatible.rdbms&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>;</span><br><span class="line"><span class="keyword">ALTER</span> DISKGROUP DATA <span class="keyword">SET</span> ATTRIBUTE <span class="string">&#x27;compatible.advm&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>maintenance</tag>
      </tags>
  </entry>
  <entry>
    <title>Migrate ASM Diskgroup to Another SAN</title>
    <url>/blog/posts/d7934161.html</url>
    <content><![CDATA[<h1 id="Migrate-ASM-Diskgroup-to-Another-SAN"><a href="#Migrate-ASM-Diskgroup-to-Another-SAN" class="headerlink" title="Migrate ASM Diskgroup to Another SAN"></a>Migrate ASM Diskgroup to Another SAN</h1><ol>
<li><p>if necessary, modify asm_diskstring</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> asm_diskstring <span class="operator">=</span> <span class="string">&#x27;/dev/emcpowerc*&#x27;</span>,<span class="string">&#x27;/dev/emcpowerh*&#x27;</span> <span class="keyword">scope</span><span class="operator">=</span><span class="keyword">both</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> path <span class="keyword">from</span> v$asm_disk;</span><br></pre></td></tr></table></figure>
</li>
<li><p>query the fail groups</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">col path <span class="keyword">for</span> a20</span><br><span class="line">col state <span class="keyword">for</span> a10</span><br><span class="line">col failgroup <span class="keyword">for</span> a15</span><br><span class="line">col name <span class="keyword">for</span> a15</span><br><span class="line"><span class="keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state </span><br><span class="line"><span class="keyword">from</span> v$asm_diskgroup dg, v$asm_disk d</span><br><span class="line"><span class="keyword">where</span> dg.group_number<span class="operator">=</span>d.group_number <span class="keyword">and</span> dg.name<span class="operator">=</span><span class="string">&#x27;DATA&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> dg.name,d.disk_number;</span><br><span class="line"></span><br><span class="line">NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE</span><br><span class="line"><span class="comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span></span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">0</span> ORCL:DATA1           CACHED  DATA1           DATA1           NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">1</span> ORCL:DATA2           CACHED  DATA2           DATA2           NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">2</span> ORCL:DATA3           CACHED  DATA3           DATA3           NORMAL</span><br></pre></td></tr></table></figure>
</li>
<li><p>create new disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># oracleasm createdisk NEW_DATA1 /dev/sdl1</span></span><br><span class="line">Writing disk header: <span class="keyword">done</span></span><br><span class="line">Instantiating disk: <span class="keyword">done</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm createdisk NEW_DATA2 /dev/sdm1</span></span><br><span class="line">Writing disk header: <span class="keyword">done</span></span><br><span class="line">Instantiating disk: <span class="keyword">done</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm createdisk NEW_DATA3 /dev/sdn1</span></span><br><span class="line">Writing disk header: <span class="keyword">done</span></span><br><span class="line">Instantiating disk: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@rac2 ~]<span class="comment"># oracleasm scandisks</span></span><br><span class="line">Reloading disk partitions: <span class="keyword">done</span></span><br><span class="line">Cleaning any stale ASM disks...</span><br><span class="line">Scanning system <span class="keyword">for</span> ASM disks...</span><br><span class="line">Instantiating disk <span class="string">&quot;NEW_DATA1&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;NEW_DATA2&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;NEW_DATA3&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>from node1 add each disk to a fail group</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sqlplus &quot; / as sysasm&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- external type not need to specify a fail group</span></span><br><span class="line"><span class="keyword">ALTER</span> DISKGROUP DATA <span class="keyword">ADD</span> DISK</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_DATA1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_DATA2&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_DATA3&#x27;</span></span><br><span class="line">REBALANCE POWER <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- chanage rebalance power. compatiable.asm &gt;= 11.2.0.2, power range is 0 to 1024; if &lt; 11.2.0.2, power range is 0 to 11.</span></span><br><span class="line"><span class="keyword">alter</span> diskgroup DATA rebalance power <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> gv$asm_operation;</span><br><span class="line"><span class="keyword">no</span> <span class="keyword">rows</span> selected</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> col path <span class="keyword">for</span> a20</span><br><span class="line">col state <span class="keyword">for</span> a10</span><br><span class="line">col failgroup <span class="keyword">for</span> a15</span><br><span class="line">col name <span class="keyword">for</span> a15</span><br><span class="line"><span class="keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state</span><br><span class="line"><span class="keyword">from</span> v$asm_diskgroup dg, v$asm_disk d</span><br><span class="line"><span class="keyword">where</span> dg.group_number<span class="operator">=</span>d.group_number <span class="keyword">and</span> dg.name<span class="operator">=</span><span class="string">&#x27;DATA&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> dg.name,d.disk_number;</span><br><span class="line"></span><br><span class="line">NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE</span><br><span class="line"><span class="comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span></span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">0</span> ORCL:DATA1           CACHED  DATA1           DATA1           NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">1</span> ORCL:DATA2           CACHED  DATA2           DATA2           NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">2</span> ORCL:DATA3           CACHED  DATA3           DATA3           NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">3</span> ORCL:NEW_DATA1       CACHED  NEW_DATA1       NEW_DATA1       NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">4</span> ORCL:NEW_DATA2       CACHED  NEW_DATA2       NEW_DATA2       NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">5</span> ORCL:NEW_DATA3       CACHED  NEW_DATA3       NEW_DATA3       NORMAL</span><br></pre></td></tr></table></figure>
</li>
<li><p>drop old disks</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DISKGROUP DATA <span class="keyword">DROP</span> DISK</span><br><span class="line"><span class="string">&#x27;DATA1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;DATA2&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;DATA3&#x27;</span></span><br><span class="line">REBALANCE POWER <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> gv$asm_operation;</span><br><span class="line"><span class="keyword">no</span> <span class="keyword">rows</span> selected</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> col path <span class="keyword">for</span> a20</span><br><span class="line">col state <span class="keyword">for</span> a10</span><br><span class="line">col failgroup <span class="keyword">for</span> a15</span><br><span class="line">col name <span class="keyword">for</span> a15</span><br><span class="line"><span class="keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state</span><br><span class="line"><span class="keyword">from</span> v$asm_diskgroup dg, v$asm_disk d</span><br><span class="line"><span class="keyword">where</span> dg.group_number<span class="operator">=</span>d.group_number <span class="keyword">and</span> dg.name<span class="operator">=</span><span class="string">&#x27;DATA&#x27;</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> dg.name,d.disk_number;</span><br><span class="line"></span><br><span class="line">NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE</span><br><span class="line"><span class="comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span></span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">3</span> ORCL:NEW_DATA1       CACHED  NEW_DATA1       NEW_DATA1       NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">4</span> ORCL:NEW_DATA2       CACHED  NEW_DATA2       NEW_DATA2       NORMAL</span><br><span class="line">DATA            MOUNTED    EXTERN           <span class="number">5</span> ORCL:NEW_DATA3       CACHED  NEW_DATA3       NEW_DATA3       NORMAL</span><br></pre></td></tr></table></figure>
</li>
<li><p>note: add and drop disks in one command, only one rebalancing operation will occur</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DISKGROUP DATA <span class="keyword">ADD</span> DISK</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_DATA1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_DATA2&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_DATA3&#x27;</span></span><br><span class="line"><span class="keyword">DROP</span> DISK</span><br><span class="line"><span class="string">&#x27;DATA1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;DATA2&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;DATA3&#x27;</span></span><br><span class="line">REBALANCE POWER <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>delete old disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># oracleasm deletedisk DATA1</span></span><br><span class="line">Clearing disk header: <span class="keyword">done</span></span><br><span class="line">Dropping disk: <span class="keyword">done</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm deletedisk DATA2</span></span><br><span class="line">Clearing disk header: <span class="keyword">done</span></span><br><span class="line">Dropping disk: <span class="keyword">done</span></span><br><span class="line">[root@rac1 ~]<span class="comment"># oracleasm deletedisk DATA3</span></span><br><span class="line">Clearing disk header: <span class="keyword">done</span></span><br><span class="line">Dropping disk: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@rac2 ~]<span class="comment"># oracleasm scandisks</span></span><br><span class="line">Reloading disk partitions: <span class="keyword">done</span></span><br><span class="line">Cleaning any stale ASM disks...</span><br><span class="line">Cleaning disk <span class="string">&quot;DATA1&quot;</span></span><br><span class="line">Cleaning disk <span class="string">&quot;DATA2&quot;</span></span><br><span class="line">Cleaning disk <span class="string">&quot;DATA3&quot;</span></span><br><span class="line">Scanning system <span class="keyword">for</span> ASM disks...</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>migrate</tag>
      </tags>
  </entry>
  <entry>
    <title>PreCheck</title>
    <url>/blog/posts/28a7074e.html</url>
    <content><![CDATA[<h4 id="PreCheck"><a href="#PreCheck" class="headerlink" title="PreCheck"></a>PreCheck</h4><ol>
<li><p>System info</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 系统版本 </span></span><br><span class="line"><span class="built_in">uname</span> -a</span><br><span class="line"><span class="built_in">cat</span> /etc/os-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># ASM 磁盘创建方式：udev or asmlib</span></span><br><span class="line"><span class="comment"># udev:</span></span><br><span class="line"><span class="built_in">cat</span> /etc/udev/rules.d/99-oracle-asmdevices.rules</span><br><span class="line"></span><br><span class="line"><span class="comment"># asmlib:</span></span><br><span class="line"><span class="built_in">cat</span> /etc/sysconfig/oracleasm</span><br><span class="line">/etc/init.d/oracleasm listdisks</span><br></pre></td></tr></table></figure>
</li>
<li><p>GI info</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># grid 用户查询，群集资源状态，版本，ocr 信息，votedisk 信息 </span></span><br><span class="line">crsctl <span class="built_in">stat</span> res -t</span><br><span class="line">asmcmd lsdg</span><br><span class="line">ocrcheck</span><br><span class="line">crsctl query crs activeversion</span><br><span class="line">crsctl query css votedisk</span><br></pre></td></tr></table></figure>
</li>
<li><p>ASM DiskGroup info</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 数据库版本 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$version;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 磁盘组信息 </span></span><br><span class="line"><span class="keyword">set</span> lines <span class="number">200</span> pages <span class="number">100</span></span><br><span class="line"><span class="keyword">select</span> d.name group_name,f.type,<span class="built_in">count</span>(<span class="operator">*</span>) cnt <span class="keyword">from</span> v$asm_file f </span><br><span class="line"> <span class="keyword">join</span> v$asm_diskgroup d <span class="keyword">on</span> f.group_number<span class="operator">=</span>d.group_number </span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">rollup</span> (d.name,f.type);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 磁盘组成员，故障组 </span></span><br><span class="line">col path <span class="keyword">for</span> a20</span><br><span class="line">col state <span class="keyword">for</span> a10</span><br><span class="line">col failgroup <span class="keyword">for</span> a15</span><br><span class="line">col name <span class="keyword">for</span> a20</span><br><span class="line"><span class="keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state </span><br><span class="line"> <span class="keyword">from</span> v$asm_diskgroup dg, v$asm_disk d</span><br><span class="line"> <span class="keyword">where</span> dg.group_number<span class="operator">=</span>d.group_number</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> dg.name,d.disk_number;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 磁盘组兼容版本 </span></span><br><span class="line">col COMPATIBILITY form a10</span><br><span class="line">col DATABASE_COMPATIBILITY form a10</span><br><span class="line">col NAME form a20</span><br><span class="line"><span class="keyword">select</span> group_number, name, compatibility, database_compatibility <span class="keyword">from</span> v$asm_diskgroup;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>precheck</tag>
      </tags>
  </entry>
  <entry>
    <title>Replace OCR and Voting disks</title>
    <url>/blog/posts/c9d09ad6.html</url>
    <content><![CDATA[<h4 id="OCR"><a href="#OCR" class="headerlink" title="OCR"></a>OCR</h4><ol>
<li><p>Perform ocr backup</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 bin]<span class="comment"># ./ocrconfig -manualbackup</span></span><br><span class="line">rac2     2022/05/06 09:21:54     /u01/app/11.2.0/grid/cdata/rac-cluster/backup_20220506_092154.ocr</span><br><span class="line"></span><br><span class="line">[root@rac1 bin]<span class="comment"># ./ocrconfig -showbackup</span></span><br><span class="line">PROT-24: Auto backups <span class="keyword">for</span> the Oracle Cluster Registry are not available</span><br><span class="line">rac2     2022/05/06 09:21:54     /u01/app/11.2.0/grid/cdata/rac-cluster/backup_20220506_092154.ocr</span><br></pre></td></tr></table></figure>
</li>
<li><p>Perform ocrcheck</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 bin]<span class="comment"># ./ocrcheck</span></span><br><span class="line">Status of Oracle Cluster Registry is as follows :</span><br><span class="line">         Version                  :          3</span><br><span class="line">         Total space (kbytes)     :     262120</span><br><span class="line">         Used space (kbytes)      :       3012</span><br><span class="line">         Available space (kbytes) :     259108</span><br><span class="line">         ID                       :  354983601</span><br><span class="line">         Device/File Name         :  +OCR_VOTE</span><br><span class="line">                                    Device/File integrity check succeeded</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">         Cluster registry integrity check succeeded</span><br><span class="line"></span><br><span class="line">         Logical corruption check succeeded</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a new NEW_OCRVOTE diskgroup</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DISKGROUP NEW_OCRVOTE NORMAL REDUNDANCY</span><br><span class="line">FAILGROUP F1 DISK</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_OCRVOTE1&#x27;</span>,<span class="string">&#x27;ORCL:NEW_OCRVOTE2&#x27;</span></span><br><span class="line">FAILGROUP F2 DISK</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_OCRVOTE3&#x27;</span>,<span class="string">&#x27;ORCL:NEW_OCRVOTE4&#x27;</span></span><br><span class="line">ATTRIBUTE <span class="string">&#x27;COMPATIBLE.ASM&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;11.2&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add new ocrmirror</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 bin]<span class="comment"># ./ocrconfig -add +NEW_OCRVOTE</span></span><br><span class="line">[root@rac1 bin]<span class="comment"># ./ocrcheck</span></span><br><span class="line">Status of Oracle Cluster Registry is as follows :</span><br><span class="line">         Version                  :          3</span><br><span class="line">         Total space (kbytes)     :     262120</span><br><span class="line">         Used space (kbytes)      :       3012</span><br><span class="line">         Available space (kbytes) :     259108</span><br><span class="line">         ID                       :  354983601</span><br><span class="line">         Device/File Name         :  +OCR_VOTE</span><br><span class="line">                                    Device/File integrity check succeeded</span><br><span class="line"></span><br><span class="line">         Device/File Name         :  +NEW_OCRVOTE</span><br><span class="line">                                    Device/File integrity check succeeded</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">         Cluster registry integrity check succeeded</span><br><span class="line"></span><br><span class="line">         Logical corruption check succeeded</span><br></pre></td></tr></table></figure>
</li>
<li><p>Delete old ocr device</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 bin]<span class="comment"># ./ocrconfig -delete +OCR_VOTE</span></span><br><span class="line">[root@rac1 bin]<span class="comment"># ./ocrcheck</span></span><br><span class="line">Status of Oracle Cluster Registry is as follows :</span><br><span class="line">         Version                  :          3</span><br><span class="line">         Total space (kbytes)     :     262120</span><br><span class="line">         Used space (kbytes)      :       3012</span><br><span class="line">         Available space (kbytes) :     259108</span><br><span class="line">         ID                       :  354983601</span><br><span class="line">         Device/File Name         :  +NEW_OCRVOTE</span><br><span class="line">                                    Device/File integrity check succeeded</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">                                    Device/File not configured</span><br><span class="line"></span><br><span class="line">         Cluster registry integrity check succeeded</span><br><span class="line"></span><br><span class="line">         Logical corruption check succeeded</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Voting-Disks"><a href="#Voting-Disks" class="headerlink" title="Voting Disks"></a>Voting Disks</h4><ol>
<li><p>Query css votedisk</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@rac1 ~]$ crsctl query css votedisk</span><br><span class="line"><span class="comment">##  STATE    File Universal Id                File Name Disk group</span></span><br><span class="line">--  -----    -----------------                --------- ---------</span><br><span class="line"> 1. ONLINE   adbb58e65c384ff0bf5fc171cba469a4 (ORCL:OCR_VOTE1) [OCR_VOTE]</span><br><span class="line">Located 1 voting disk(s).</span><br></pre></td></tr></table></figure>
</li>
<li><p>Replace votedisk</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@rac1 ~]$ crsctl replace votedisk +NEW_OCRVOTE</span><br><span class="line"></span><br><span class="line">[grid@rac1 ~]$ crsctl query css votedisk</span><br><span class="line"><span class="comment">##  STATE    File Universal Id                File Name Disk group</span></span><br><span class="line">--  -----    -----------------                --------- ---------</span><br><span class="line"> 1. ONLINE   adbb58e65c384ff0bf5fc171cba469a4 (ORCL:NEW_OCRVOTE1) [NEW_OCRVOTE]</span><br><span class="line"> 2. ONLINE   07d2464674ac4fabbf27f3132d8448b0 (ORCL:NEW_OCRVOTE2) [NEW_OCRVOTE]</span><br><span class="line"> 3. ONLINE   9761ccf221524f66bff0766ad5721239 (ORCL:NEW_OCRVOTE3) [NEW_OCRVOTE]</span><br><span class="line">Located 3 voting disk(s).</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="ASM-spfile"><a href="#ASM-spfile" class="headerlink" title="ASM spfile"></a>ASM spfile</h4><ol>
<li><p>Replace asm spfile to new diskgroup</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">show</span> <span class="keyword">parameter</span> spfile;</span><br><span class="line">NAME                                TYPE        <span class="keyword">VALUE</span></span><br><span class="line"><span class="comment">------------------------------------ ----------- ------------------------------</span></span><br><span class="line">spfile                               string      <span class="operator">+</span>OCR_VOTE<span class="operator">/</span>rac<span class="operator">-</span>cluster<span class="operator">/</span>asmparame</span><br><span class="line">                                                 terfile<span class="operator">/</span>registry<span class="number">.253</span><span class="number">.946671547</span></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">create</span> pfile<span class="operator">=</span><span class="string">&#x27;/u01/app/grid/asmpfile.ora&#x27;</span> <span class="keyword">from</span> spfile;</span><br><span class="line">File created.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">create</span> spfile<span class="operator">=</span><span class="string">&#x27;+NEW_OCRVOTE&#x27;</span> <span class="keyword">from</span> pfile<span class="operator">=</span><span class="string">&#x27;/u01/app/grid/asmpfile.ora&#x27;</span>;</span><br><span class="line">File created.</span><br></pre></td></tr></table></figure>
</li>
<li><p>Restart cluster</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 bin]<span class="comment"># ./crsctl stop cluster -all</span></span><br><span class="line">[root@rac1 bin]<span class="comment"># ./crsctl start cluster -all</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>ocr</tag>
        <tag>voting</tag>
        <tag>replace</tag>
      </tags>
  </entry>
  <entry>
    <title>Swap Voting Disks Across Storage</title>
    <url>/blog/posts/463891ca.html</url>
    <content><![CDATA[<h4 id="Swap-Voting-Disks-Across-Storage"><a href="#Swap-Voting-Disks-Across-Storage" class="headerlink" title="Swap Voting Disks Across Storage"></a>Swap Voting Disks Across Storage</h4><ol>
<li><p>Query css votedisk</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">crsctl query css votedisk;</span><br><span class="line"></span><br><span class="line"><span class="comment">##  STATE    File Universal Id                File Name Disk group</span></span><br><span class="line">--  -----    -----------------                --------- ---------</span><br><span class="line">1. ONLINE   73e1c48069d64fefbfc44cd8e65107d8 (ORCL:OCR_VOTE1) [OCR_VOTE]</span><br><span class="line">Located 1 voting disk(s).</span><br></pre></td></tr></table></figure>
</li>
<li><p>Query the fail groups</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">col path <span class="keyword">for</span> a20</span><br><span class="line">col state <span class="keyword">for</span> a10</span><br><span class="line">col failgroup <span class="keyword">for</span> a15</span><br><span class="line">col name <span class="keyword">for</span> a15</span><br><span class="line"><span class="keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state </span><br><span class="line"> <span class="keyword">from</span> v$asm_diskgroup dg, v$asm_disk d</span><br><span class="line"> <span class="keyword">where</span> dg.group_number<span class="operator">=</span>d.group_number <span class="keyword">and</span> dg.name<span class="operator">=</span><span class="string">&#x27;OCR_VOTE&#x27;</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> dg.name,d.disk_number;</span><br><span class="line"></span><br><span class="line">NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE</span><br><span class="line"><span class="comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span></span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">0</span> ORCL:OCR_VOTE1       CACHED  OCR_VOTE1       OCR_VOTE1       NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">1</span> ORCL:OCR_VOTE2       CACHED  OCR_VOTE2       OCR_VOTE2       NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">2</span> ORCL:OCR_VOTE3       CACHED  OCR_VOTE3       OCR_VOTE3       NORMAL</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create new disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">oracleasm createdisk NEW_OCR_VOTE1 /dev/sdi1</span><br><span class="line">oracleasm createdisk NEW_OCR_VOTE2 /dev/sdj1</span><br><span class="line">oracleasm createdisk NEW_OCR_VOTE3 /dev/sdk1</span><br></pre></td></tr></table></figure>
</li>
<li><p>From node1 add each disk to a fail group</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sqlplus &quot; / as sysasm&quot;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- external type not need to specify a fail group</span></span><br><span class="line"><span class="keyword">ALTER</span> DISKGROUP OCR_VOTE <span class="keyword">ADD</span> DISK</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_OCR_VOTE1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_OCR_VOTE2&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;ORCL:NEW_OCR_VOTE3&#x27;</span></span><br><span class="line">REBALANCE POWER <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> gv$asm_operation;</span><br><span class="line"><span class="keyword">no</span> <span class="keyword">rows</span> selected</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> col path <span class="keyword">for</span> a20</span><br><span class="line">col state <span class="keyword">for</span> a10</span><br><span class="line">col failgroup <span class="keyword">for</span> a15</span><br><span class="line">col name <span class="keyword">for</span> a15</span><br><span class="line"><span class="keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state</span><br><span class="line"> <span class="keyword">from</span> v$asm_diskgroup dg, v$asm_disk d</span><br><span class="line"> <span class="keyword">where</span> dg.group_number<span class="operator">=</span>d.group_number <span class="keyword">and</span> dg.name<span class="operator">=</span><span class="string">&#x27;OCR_VOTE&#x27;</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> dg.name,d.disk_number;</span><br><span class="line"></span><br><span class="line">NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE</span><br><span class="line"><span class="comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span></span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">0</span> ORCL:OCR_VOTE1       CACHED  OCR_VOTE1       OCR_VOTE1       NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">1</span> ORCL:OCR_VOTE2       CACHED  OCR_VOTE2       OCR_VOTE2       NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">2</span> ORCL:OCR_VOTE3       CACHED  OCR_VOTE3       OCR_VOTE3       NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">3</span> ORCL:NEW_OCR_VOTE1   CACHED  NEW_OCR_VOTE1   NEW_OCR_VOTE1   NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">4</span> ORCL:NEW_OCR_VOTE2   CACHED  NEW_OCR_VOTE2   NEW_OCR_VOTE2   NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">5</span> ORCL:NEW_OCR_VOTE3   CACHED  NEW_OCR_VOTE3   NEW_OCR_VOTE3   NORMAL</span><br></pre></td></tr></table></figure>
</li>
<li><p>Drop old disks</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DISKGROUP OCR_VOTE <span class="keyword">DROP</span> DISK</span><br><span class="line"><span class="string">&#x27;OCR_VOTE1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;OCR_VOTE2&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;OCR_VOTE3&#x27;</span></span><br><span class="line">REBALANCE POWER <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> gv$asm_operation;</span><br><span class="line"> <span class="keyword">no</span> <span class="keyword">rows</span> selected</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> col path <span class="keyword">for</span> a20</span><br><span class="line">col state <span class="keyword">for</span> a10</span><br><span class="line">col failgroup <span class="keyword">for</span> a15</span><br><span class="line">col name <span class="keyword">for</span> a15</span><br><span class="line"><span class="keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state</span><br><span class="line"> <span class="keyword">from</span> v$asm_diskgroup dg, v$asm_disk d</span><br><span class="line"> <span class="keyword">where</span> dg.group_number<span class="operator">=</span>d.group_number <span class="keyword">and</span> dg.name<span class="operator">=</span><span class="string">&#x27;OCR_VOTE&#x27;</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> dg.name,d.disk_number;</span><br><span class="line"></span><br><span class="line">NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE</span><br><span class="line"><span class="comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span></span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">3</span> ORCL:NEW_OCR_VOTE1   CACHED  NEW_OCR_VOTE1   NEW_OCR_VOTE1   NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">4</span> ORCL:NEW_OCR_VOTE2   CACHED  NEW_OCR_VOTE2   NEW_OCR_VOTE2   NORMAL</span><br><span class="line">OCR_VOTE        MOUNTED    EXTERN           <span class="number">5</span> ORCL:NEW_OCR_VOTE3   CACHED  NEW_OCR_VOTE3   NEW_OCR_VOTE3   NORMAL</span><br></pre></td></tr></table></figure>
</li>
<li><p>Delete old disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">oracleasm deletedisk OCR_VOTE1</span><br><span class="line">oracleasm deletedisk OCR_VOTE2</span><br><span class="line">oracleasm deletedisk OCR_VOTE3</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>voting</tag>
        <tag>swap</tag>
      </tags>
  </entry>
  <entry>
    <title>UDEV SCSI Rules</title>
    <url>/blog/posts/f173f122.html</url>
    <content><![CDATA[<h1 id="UDEV-SCSI-Rules-Configuration-In-Oracle-Linux-5-8"><a href="#UDEV-SCSI-Rules-Configuration-In-Oracle-Linux-5-8" class="headerlink" title="UDEV SCSI Rules Configuration In Oracle Linux 5-8"></a>UDEV SCSI Rules Configuration In Oracle Linux 5-8</h1><p>For Oracle Automatic Storage Manager (ASM) to use disks, it needs to be able to identify the devices consistently and for them to have the correct ownership and permissions. In Linux you can use ASMLib to manage these tasks, but it is seen as an additional layer of complexity and has never really gained any popularity. Instead, many people use the Linux device manager “udev” to perform these tasks. This article presents a brief overview of setting up udev rules with respect to disks for use with ASM in Oracle 11g. The examples are all done using Oracle Linux 5, 6, 7 and 8 so they will be consistent with RHEL and CentOS 5, 6, 7 and 8.</p>
<ul>
<li>Identify the Disks (&#x2F;sbin&#x2F;scsi_id)</li>
<li>Make SCSI Devices Trusted</li>
<li>Create UDEV Rules File</li>
<li>Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)</li>
<li>Test Rules (udevtest)</li>
<li>Restart UDEV Service</li>
<li>Check Ownership and Permissions</li>
</ul>
<h2 id="Identify-the-Disks-x2F-sbin-x2F-scsi-id"><a href="#Identify-the-Disks-x2F-sbin-x2F-scsi-id" class="headerlink" title="Identify the Disks (&#x2F;sbin&#x2F;scsi_id)"></a>Identify the Disks (&#x2F;sbin&#x2F;scsi_id)</h2><p>We are going to write device-specific rules, so we need to be able to identify each device consistently, irrespective of the order in which Linux discovers it.<br>To do this we are going to use the SCSI ID for each disk (not the partition), which we get using the scsi_id command. The “-s” option makes the paths relative to the “&#x2F;sys” directory. </p>
<p>For <strong>Oracle Linux 5</strong>, use the following command.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/scsi_id -g -u -s /block/sdb</span></span><br><span class="line">SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_</span><br></pre></td></tr></table></figure>

<p>The “-s” is not available in <strong>Oracle Linux 6</strong>, so you must use the following syntax.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/scsi_id -g -u -d /dev/sdb</span></span><br><span class="line">SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_</span><br></pre></td></tr></table></figure>

<p>The location of the scsi_id command has changed in <strong>Oracle Linux 7 and 8</strong>, so you must use the following syntax.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/lib/udev/scsi_id -g -u -d /dev/sdb</span></span><br><span class="line">SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_</span><br></pre></td></tr></table></figure>

<h2 id="Make-SCSI-Devices-Trusted"><a href="#Make-SCSI-Devices-Trusted" class="headerlink" title="Make SCSI Devices Trusted"></a>Make SCSI Devices Trusted</h2><p>Add the <code>options=-g</code> to the “&#x2F;etc&#x2F;scsi_id.config” file to configure SCSI devices as trusted. Create the file if it doesn’t already exist.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat &gt;&gt; /etc/scsi_id.config &lt;&lt; EOF</span><br><span class="line">options=-g</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="Create-UDEV-Rules-File"><a href="#Create-UDEV-Rules-File" class="headerlink" title="Create UDEV Rules File"></a>Create UDEV Rules File</h2><p>Create the “&#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;99-oracle-asmdevices.rules” file.<br>The file should contain the following lines for <strong>Oracle Linux 5</strong>. The PROGRAM parameter must match the command you used to retrieve the SCSI ID, and the RESULT parameter must match the value returned from your disks.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a b c</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;KERNEL==\&quot;sd*\&quot;, BUS==\&quot;scsi\&quot;, PROGRAM==\&quot;/sbin/scsi_id -g -u -s /block/<span class="variable">$parent</span>&quot;</span>, RESULT==\&quot;`/sbin/scsi_id -g -u -s /block/sd<span class="variable">$i</span>`\&quot;, NAME=\&quot;asm-disk<span class="variable">$i</span>\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;<span class="string">&quot; &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules</span></span><br><span class="line"><span class="string">done</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># <span class="variable">$parent</span> is used if the device is partitioned, <span class="variable">$name</span> is used if the device is not partitioned.</span></span><br></pre></td></tr></table></figure>

<p>The equivalent for <strong>Oracle Linux 6</strong> is shown below.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a b c</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;KERNEL==\&quot;sd*\&quot;, BUS==\&quot;scsi\&quot;, PROGRAM==\&quot;/sbin/scsi_id -g -u -d /dev/\$parent\&quot;, RESULT==\&quot;`/sbin/scsi_id -g -u -d /dev/sd<span class="variable">$i</span>`\&quot;, NAME=\&quot;asm-disk<span class="variable">$i</span>\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;&quot;</span> &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $parent is used if the device is partitioned, $name is used if the device is not partitioned.</span></span><br></pre></td></tr></table></figure>

<p>The equivalent for <strong>Oracle Linux 7 and 8</strong> is shown below.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a b c</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;KERNEL==\&quot;sd?1\&quot;, SUBSYSTEM==\&quot;block\&quot;, PROGRAM==\&quot;/usr/lib/udev/scsi_id -g -u -d /dev/\$parent\&quot;, RESULT==\&quot;`/usr/lib/udev/scsi_id -g -u -d /dev/sd<span class="variable">$i</span>`\&quot;, SYMLINK+=\&quot;asm-disk<span class="variable">$i</span>\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;&quot;</span> &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $parent is used if the device is partitioned, $name is used if the device is not partitioned.</span></span><br></pre></td></tr></table></figure>

<h2 id="Load-Updated-Block-Device-Partitions-x2F-sbin-x2F-partprobe"><a href="#Load-Updated-Block-Device-Partitions-x2F-sbin-x2F-partprobe" class="headerlink" title="Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)"></a>Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)</h2><p>Load updated block device partition tables.<br>For OL5, OL6 and OL7</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/partprobe /dev/sdb1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/partprobe /dev/sdc1</span></span><br></pre></td></tr></table></figure>

<p>For OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/partx -u /dev/sbc1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/partx -u /dev/sdc1</span></span><br></pre></td></tr></table></figure>

<h2 id="Test-Rules-udevtest"><a href="#Test-Rules-udevtest" class="headerlink" title="Test Rules (udevtest)"></a>Test Rules (udevtest)</h2><p>Test the rules are working as expected.<br>For OL5</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">udevtest /block/sdb/sdb1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">udevtest /block/sdc/sdc1</span></span><br></pre></td></tr></table></figure>

<p>For OL6, OL7 and OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">udevadm <span class="built_in">test</span> /block/sdb/sdb1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">udevadm <span class="built_in">test</span> /block/sdc/sdc1</span></span><br></pre></td></tr></table></figure>

<p>The output from the first disk should look something like this.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">udevtest /block/sdb/sdb1</span></span><br><span class="line">main: looking at device &#x27;/block/sdb/sdb1&#x27; from subsystem &#x27;block&#x27;</span><br><span class="line">udev_rules_get_name: add symlink &#x27;disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1&#x27;</span><br><span class="line">udev_rules_get_name: add symlink &#x27;disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1&#x27;</span><br><span class="line">run_program: &#x27;/lib/udev/vol_id --export /dev/.tmp-8-17&#x27;</span><br><span class="line">run_program: &#x27;/lib/udev/vol_id&#x27; returned with status 4</span><br><span class="line">run_program: &#x27;/sbin/scsi_id -g -u -s /block/sdb/sdb1&#x27;</span><br><span class="line">run_program: &#x27;/sbin/scsi_id&#x27; (stdout) &#x27;SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_&#x27;</span><br><span class="line">run_program: &#x27;/sbin/scsi_id&#x27; returned with status 0</span><br><span class="line">udev_rules_get_name: rule applied, &#x27;sdb1&#x27; becomes &#x27;asm-disk1&#x27;</span><br><span class="line">udev_device_event: device &#x27;/block/sdb/sdb1&#x27; already in database, validate currently present symlinks</span><br><span class="line">udev_node_add: creating device node &#x27;/dev/asm-disk1&#x27;, major = &#x27;8&#x27;, minor = &#x27;17&#x27;, mode = &#x27;0660&#x27;, uid = &#x27;1100&#x27;, gid = &#x27;1200&#x27;</span><br><span class="line">udev_node_add: creating symlink &#x27;/dev/disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1&#x27; to &#x27;../../asm-disk1&#x27;</span><br><span class="line">udev_node_add: creating symlink &#x27;/dev/disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1&#x27; to &#x27;../../asm-disk1&#x27;</span><br><span class="line">main: run: &#x27;socket:/org/kernel/dm/multipath_event&#x27;</span><br><span class="line">main: run: &#x27;socket:/org/kernel/udev/monitor&#x27;</span><br><span class="line">main: run: &#x27;/lib/udev/udev_run_devd&#x27;</span><br><span class="line">main: run: &#x27;socket:/org/freedesktop/hal/udev_event&#x27;</span><br><span class="line">main: run: &#x27;/sbin/pam_console_apply /dev/asm-disk1 /dev/disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1 /dev/disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Restart-UDEV-Service"><a href="#Restart-UDEV-Service" class="headerlink" title="Restart UDEV Service"></a>Restart UDEV Service</h2><p>Restart the UDEV service.<br>For OL5</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/udevcontrol reload_rules</span></span><br></pre></td></tr></table></figure>

<p>For OL5 and OL6 : Not needed for OL7 and OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/start_udev</span></span><br></pre></td></tr></table></figure>

<p>For OL6, OL7 and OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/udevadm control --reload-rules</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/sbin/udevadm trigger</span></span><br></pre></td></tr></table></figure>

<h2 id="Check-Ownership-and-Permissions"><a href="#Check-Ownership-and-Permissions" class="headerlink" title="Check Ownership and Permissions"></a>Check Ownership and Permissions</h2><p>Check the disks are now available with the “asm-disk*” alias and the correct ownership and permissions.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span> -al /dev/asm-disk*</span></span><br><span class="line">brw-rw---- 1 oracle dba 8, 17 Apr 8 22:47 asm-disk1</span><br><span class="line">brw-rw---- 1 oracle dba 8, 33 Apr 8 22:47 asm-disk2</span><br><span class="line">brw-rw---- 1 oracle dba 8, 49 Apr 8 22:47 asm-disk3</span><br><span class="line">brw-rw---- 1 oracle dba 8, 65 Apr 8 22:47 asm-disk4</span><br></pre></td></tr></table></figure>

<p>So the ASM_DISKSTRING initialization parameter in the ASM instance can be set to ‘&#x2F;dev&#x2F;asm-disk*’ to identify the ASM disks.</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>udev</tag>
      </tags>
  </entry>
  <entry>
    <title>Exadata Virtual Machine</title>
    <url>/blog/posts/78416e0d.html</url>
    <content><![CDATA[<h1 id="Exadata-Virtual-Machine"><a href="#Exadata-Virtual-Machine" class="headerlink" title="Exadata Virtual Machine"></a>Exadata Virtual Machine</h1><h2 id="Cell-Node"><a href="#Cell-Node" class="headerlink" title="Cell Node:"></a>Cell Node:</h2><ol>
<li><p> 软件包下载 </p>
<p> 可到 <a href="https://edelivery.oracle.com/">https://edelivery.oracle.com/</a> 下载 V46145-01.zip，V27570-01.zip。<br>V46145-01.zip 为 Exadata Cell 11.2.3.2 介质；<br>V27570-01.zip 为 OracleLinux-R5-U7-Server-x86_64-dvd.iso；<br>Oracle 安装包：p10404530_112030_Linux-x86-64_1of7.zip; p10404530_112030_Linux-x86-64_2of7.zip<br>Grid 安装包：p10404530_112030_Linux-x86-64_3of7.zip</p>
</li>
<li><p> 配置 hosts，修改启动内核 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.184.160 db01.localdomain db01&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.184.160 cell01.localdomain cell01&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;s/^default.*/default=1/&#x27;</span> /etc/grub.conf</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
</li>
<li><p> 修改资源限制 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;fs.file-max = 65536&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">* soft nofile 65536</span></span><br><span class="line"><span class="string">* hard nofile 65536</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p> 安装 oracle-vaildated</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y oracle-validated</span><br></pre></td></tr></table></figure>
</li>
<li><p> 创建日志文件夹 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/log/oracle</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /var/log/oracle</span><br></pre></td></tr></table></figure>
</li>
<li><p> 安装 Cell 软件 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip V46145-01.zip</span><br><span class="line">tar -xvf cellImageMaker_11.2.3.3.1_LINUX.X64_140708-1.x86_64.tar</span><br><span class="line"><span class="built_in">cd</span> dl180/boot/cellbits</span><br><span class="line">unzip cell.bin</span><br><span class="line">tar -xvf cellrpms.tbz jdk-1.7.0_55-fcs.x86_64.rpm</span><br><span class="line">rpm -ivh jdk-1.7.0_55-fcs.x86_64.rpm</span><br><span class="line">rpm -ivh cell-11.2.3.3.1_LINUX.X64_140708-1.x86_64.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p> 创建虚拟磁盘 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; disk.sh &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk01 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk02 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk03 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk04 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk05 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk06 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk07 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk08 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk09 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk10 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk11 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk12 bs=1M count=5120</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH01 bs=1M count=1024</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH02 bs=1M count=1024</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH03 bs=1M count=1024</span></span><br><span class="line"><span class="string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH04 bs=1M count=1024</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sh disk.sh</span><br><span class="line"><span class="built_in">chmod</span> 660 /opt/oracle/cell/disks/raw/*</span><br></pre></td></tr></table></figure>
</li>
<li><p> 启动 cell 服务 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su - celladmin</span><br><span class="line"></span><br><span class="line">cellcli -e create cell cell01 interconnect1=eth0</span><br><span class="line">cellcli -e alter cell restart services all</span><br></pre></td></tr></table></figure>
</li>
<li><p> 创建磁盘 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cellcli -e create celldisk all</span><br><span class="line">cellcli -e create flashcache all size=2G</span><br><span class="line">cellcli -e create flashlog all</span><br><span class="line">cellcli -e create griddisk all harddisk prefix=data,size=4G</span><br><span class="line">cellcli -e create griddisk all harddisk prefix=reco</span><br><span class="line">cellcli -e list griddisk</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="DB-Node"><a href="#DB-Node" class="headerlink" title="DB Node:"></a>DB Node:</h2><ol>
<li><p> 创建 Exadata 配置文件 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/oracle/cell/network-config</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ipaddress1=192.168.184.160/24&quot;</span> &gt; /etc/oracle/cell/network-config/cellinit.ora</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cell=\&quot;192.168.184.170\&quot;&quot;</span> &gt; /etc/oracle/cell/network-config/cellip.ora</span><br><span class="line"><span class="built_in">chown</span> -R grid:oinstall /etc/oracle/cell/network-config</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /etc/oracle/cell/network-config</span><br></pre></td></tr></table></figure>
</li>
<li><p> 安装完 Grid 后，创建磁盘组 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DISKGROUP DATA NORMAL REDUNDANCY</span><br><span class="line">FAILGROUP CELL01_DATA_F1 DISK</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk01_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk02_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk03_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk04_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk05_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk06_cell01&#x27;</span></span><br><span class="line">FAILGROUP CELL01_DATA_F2 DISK</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk07_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk08_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk09_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk10_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk11_cell01&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;o/192.168.184.170/data_CD_disk12_cell01&#x27;</span></span><br><span class="line">ATTRIBUTE <span class="string">&#x27;compatible.asm&#x27;</span><span class="operator">=</span><span class="string">&#x27;11.2.0.0.0&#x27;</span>,<span class="string">&#x27;compatible.rdbms&#x27;</span><span class="operator">=</span><span class="string">&#x27;11.1.0.7.0&#x27;</span>,<span class="string">&#x27;au_size&#x27;</span><span class="operator">=</span><span class="string">&#x27;4M&#x27;</span>,<span class="string">&#x27;cell.smart_scan_capable&#x27;</span><span class="operator">=</span><span class="string">&#x27;TRUE&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Exadata</category>
      </categories>
      <tags>
        <tag>exadata</tag>
      </tags>
  </entry>
  <entry>
    <title>db_install_11g.rsp</title>
    <url>/blog/posts/fc154a3d.html</url>
    <content><![CDATA[<h1 id="db-install-11g-rsp"><a href="#db-install-11g-rsp" class="headerlink" title="db_install_11g.rsp"></a>db_install_11g.rsp</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment">## Copyright(c) Oracle Corporation 1998,2013. All rights reserved.##</span></span><br><span class="line"><span class="comment">##                                                                ##</span></span><br><span class="line"><span class="comment">## Specify values for the variables listed below to customize     ##</span></span><br><span class="line"><span class="comment">## your installation.                                             ##</span></span><br><span class="line"><span class="comment">##                                                                ##</span></span><br><span class="line"><span class="comment">## Each variable is associated with a comment. The comment        ##</span></span><br><span class="line"><span class="comment">## can help to populate the variables with the appropriate        ##</span></span><br><span class="line"><span class="comment">## values.                                                        ##</span></span><br><span class="line"><span class="comment">##                                                                ##</span></span><br><span class="line"><span class="comment">## IMPORTANT <span class="doctag">NOTE:</span> This file contains plain text passwords and    ##</span></span><br><span class="line"><span class="comment">## should be secured to have read permission only by oracle user  ##</span></span><br><span class="line"><span class="comment">## or db administrator who owns this installation.                ##</span></span><br><span class="line"><span class="comment">##                                                                ##</span></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Do not change the following system generated value.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the installation option.</span></span><br><span class="line"><span class="comment"># It can be one of the following:</span></span><br><span class="line"><span class="comment">#   - INSTALL_DB_SWONLY</span></span><br><span class="line"><span class="comment">#   - INSTALL_DB_AND_CONFIG</span></span><br><span class="line"><span class="comment">#   - UPGRADE_DB</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.option=INSTALL_DB_SWONLY</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the hostname of the system as set during the install. It can be used</span></span><br><span class="line"><span class="comment"># to force the installation to use an alternative hostname rather than using the</span></span><br><span class="line"><span class="comment"># first hostname found on the system. (e.g., for systems with multiple hostnames</span></span><br><span class="line"><span class="comment"># and network interfaces)</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">ORACLE_HOSTNAME=localhost</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the Unix group to be set for the inventory directory.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">UNIX_GROUP_NAME=oinstall</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the location which holds the inventory files.</span></span><br><span class="line"><span class="comment"># This is an optional parameter if installing on</span></span><br><span class="line"><span class="comment"># Windows based Operating System.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">INVENTORY_LOCATION=/u01/app/oraInventory</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the languages in which the components will be installed.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># en   : English                  ja   : Japanese</span></span><br><span class="line"><span class="comment"># fr   : French                   ko   : Korean</span></span><br><span class="line"><span class="comment"># ar   : Arabic                   es   : Latin American Spanish</span></span><br><span class="line"><span class="comment"># bn   : Bengali                  lv   : Latvian</span></span><br><span class="line"><span class="comment"># pt_BR: Brazilian Portuguese     lt   : Lithuanian</span></span><br><span class="line"><span class="comment"># bg   : Bulgarian                ms   : Malay</span></span><br><span class="line"><span class="comment"># fr_CA: Canadian French          es_MX: Mexican Spanish</span></span><br><span class="line"><span class="comment"># ca   : Catalan                  no   : Norwegian</span></span><br><span class="line"><span class="comment"># hr   : Croatian                 pl   : Polish</span></span><br><span class="line"><span class="comment"># cs   : Czech                    pt   : Portuguese</span></span><br><span class="line"><span class="comment"># da   : Danish                   ro   : Romanian</span></span><br><span class="line"><span class="comment"># nl   : Dutch                    ru   : Russian</span></span><br><span class="line"><span class="comment"># ar_EG: Egyptian                 zh_CN: Simplified Chinese</span></span><br><span class="line"><span class="comment"># en_GB: English (Great Britain)  sk   : Slovak</span></span><br><span class="line"><span class="comment"># et   : Estonian                 sl   : Slovenian</span></span><br><span class="line"><span class="comment"># fi   : Finnish                  es_ES: Spanish</span></span><br><span class="line"><span class="comment"># de   : German                   sv   : Swedish</span></span><br><span class="line"><span class="comment"># el   : Greek                    th   : Thai</span></span><br><span class="line"><span class="comment"># iw   : Hebrew                   zh_TW: Traditional Chinese</span></span><br><span class="line"><span class="comment"># hu   : Hungarian                tr   : Turkish</span></span><br><span class="line"><span class="comment"># is   : Icelandic                uk   : Ukrainian</span></span><br><span class="line"><span class="comment"># in   : Indonesian               vi   : Vietnamese</span></span><br><span class="line"><span class="comment"># it   : Italian</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># all_langs   : All languages</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Specify value as the following to select any of the languages.</span></span><br><span class="line"><span class="comment"># Example : SELECTED_LANGUAGES=en,fr,ja</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Specify value as the following to select all the languages.</span></span><br><span class="line"><span class="comment"># Example : SELECTED_LANGUAGES=all_langs</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">SELECTED_LANGUAGES=en,zh_CN</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the complete path of the Oracle Home.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the complete path of the Oracle Base.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">ORACLE_BASE=/u01/app/oracle</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the installation edition of the component.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The value should contain only one of these choices.</span></span><br><span class="line"><span class="comment">#   - EE     : Enterprise Edition</span></span><br><span class="line"><span class="comment">#   - SE     : Standard Edition</span></span><br><span class="line"><span class="comment">#   - SEONE  : Standard Edition One</span></span><br><span class="line"><span class="comment">#   - PE     : Personal Edition (WINDOWS ONLY)</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.InstallEdition=EE</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable is used to enable or disable custom install and is considered</span></span><br><span class="line"><span class="comment"># only if InstallEdition is EE.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># true  : Components mentioned as part of &#x27;optionalComponents&#x27; property</span></span><br><span class="line"><span class="comment">#         are considered for install.</span></span><br><span class="line"><span class="comment"># false : Value for &#x27;optionalComponents&#x27; is not considered.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.EEOptionsSelection=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable is considered only if &#x27;EEOptionsSelection&#x27; is set to true.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Description: List of Enterprise Edition Options you would like to enable.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#              The following choices are available. You may specify any</span></span><br><span class="line"><span class="comment">#              combination of these choices.  The components you choose should</span></span><br><span class="line"><span class="comment">#              be specified in the form &quot;internal-component-name:version&quot;</span></span><br><span class="line"><span class="comment">#              Below is a list of components you may specify to enable.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#              oracle.oraolap:11.2.0.4.0 - Oracle OLAP</span></span><br><span class="line"><span class="comment">#              oracle.rdbms.dm:11.2.0.4.0 - Oracle Data Mining</span></span><br><span class="line"><span class="comment">#              oracle.rdbms.dv:11.2.0.4.0 - Oracle Database Vault</span></span><br><span class="line"><span class="comment">#              oracle.rdbms.lbac:11.2.0.4.0 - Oracle Label Security</span></span><br><span class="line"><span class="comment">#              oracle.rdbms.partitioning:11.2.0.4.0 - Oracle Partitioning</span></span><br><span class="line"><span class="comment">#              oracle.rdbms.rat:11.2.0.4.0 - Oracle Real Application Testing</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.optionalComponents=oracle.rdbms.partitioning:11.2.0.4.0,oracle.oraolap:11.2.0.4.0,oracle.rdbms.dm:11.2.0.4.0,oracle.rdbms.dv:11.2.0.4.0,oracle.rdbms.lbac:11.2.0.4.0,oracle.rdbms.rat:11.2.0.4.0</span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment"># PRIVILEGED OPERATING SYSTEM GROUPS                                          #</span></span><br><span class="line"><span class="comment"># ------------------------------------------                                  #</span></span><br><span class="line"><span class="comment"># Provide values for the OS groups to which OSDBA and OSOPER privileges       #</span></span><br><span class="line"><span class="comment"># needs to be granted. If the install is being performed as a member of the   #</span></span><br><span class="line"><span class="comment"># group &quot;dba&quot;, then that will be used unless specified otherwise below.       #</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment"># The value to be specified for OSDBA and OSOPER group is only for UNIX based #</span></span><br><span class="line"><span class="comment"># Operating System.                                                           #</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># The DBA_GROUP is the OS group which is to be granted OSDBA privileges.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.DBA_GROUP=dba</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># The OPER_GROUP is the OS group which is to be granted OSOPER privileges.</span></span><br><span class="line"><span class="comment"># The value to be specified for OSOPER group is optional.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.OPER_GROUP=dba</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the cluster node names selected during the installation.</span></span><br><span class="line"><span class="comment"># Example : oracle.install.db.CLUSTER_NODES=node1,node2</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.CLUSTER_NODES=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable is used to enable or disable RAC One Node install.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - true  : Value of RAC One Node service name is used.</span></span><br><span class="line"><span class="comment">#   - false : Value of RAC One Node service name is not used.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If left blank, it will be assumed to be false</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.isRACOneInstall=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the name for RAC One Node Service.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.racOneServiceName=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the type of database to create.</span></span><br><span class="line"><span class="comment"># It can be one of the following:</span></span><br><span class="line"><span class="comment">#   - GENERAL_PURPOSE/TRANSACTION_PROCESSING</span></span><br><span class="line"><span class="comment">#   - DATA_WAREHOUSE</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.type=GENERAL_PURPOSE</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the Starter Database Global Database Name.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.globalDBName=orcl</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the Starter Database SID.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.SID=orcl</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the Starter Database character set.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It can be one of the following:</span></span><br><span class="line"><span class="comment"># AL32UTF8, WE8ISO8859P15, WE8MSWIN1252, EE8ISO8859P2,</span></span><br><span class="line"><span class="comment"># EE8MSWIN1250, NE8ISO8859P10, NEE8ISO8859P4, BLT8MSWIN1257,</span></span><br><span class="line"><span class="comment"># BLT8ISO8859P13, CL8ISO8859P5, CL8MSWIN1251, AR8ISO8859P6,</span></span><br><span class="line"><span class="comment"># AR8MSWIN1256, EL8ISO8859P7, EL8MSWIN1253, IW8ISO8859P8,</span></span><br><span class="line"><span class="comment"># IW8MSWIN1255, JA16EUC, JA16EUCTILDE, JA16SJIS, JA16SJISTILDE,</span></span><br><span class="line"><span class="comment"># KO16MSWIN949, ZHS16GBK, TH8TISASCII, ZHT32EUC, ZHT16MSWIN950,</span></span><br><span class="line"><span class="comment"># ZHT16HKSCS, WE8ISO8859P9, TR8MSWIN1254, VN8MSWIN1258</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.characterSet=AL32UTF8</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable should be set to true if Automatic Memory Management</span></span><br><span class="line"><span class="comment"># in Database is desired.</span></span><br><span class="line"><span class="comment"># If Automatic Memory Management is not desired, and memory allocation</span></span><br><span class="line"><span class="comment"># is to be done manually, then set it to false.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.memoryOption=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the total memory allocation for the database. Value(in MB) should be</span></span><br><span class="line"><span class="comment"># at least 256 MB, and should not exceed the total physical memory available</span></span><br><span class="line"><span class="comment"># on the system.</span></span><br><span class="line"><span class="comment"># Example: oracle.install.db.config.starterdb.memoryLimit=512</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.memoryLimit=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable controls whether to load Example Schemas onto</span></span><br><span class="line"><span class="comment"># the starter database or not.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.installExampleSchemas=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable includes enabling audit settings, configuring password profiles</span></span><br><span class="line"><span class="comment"># and revoking some grants to public. These settings are provided by default.</span></span><br><span class="line"><span class="comment"># These settings may also be disabled.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.enableSecuritySettings=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment"># Passwords can be supplied for the following four schemas in the             #</span></span><br><span class="line"><span class="comment"># starter database:                                                           #</span></span><br><span class="line"><span class="comment">#   SYS                                                                       #</span></span><br><span class="line"><span class="comment">#   SYSTEM                                                                    #</span></span><br><span class="line"><span class="comment">#   SYSMAN (used by Enterprise Manager)                                       #</span></span><br><span class="line"><span class="comment">#   DBSNMP (used by Enterprise Manager)                                       #</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment"># Same password can be used for all accounts (not recommended)                #</span></span><br><span class="line"><span class="comment"># or different passwords for each account can be provided (recommended)       #</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable holds the password that is to be used for all schemas in the</span></span><br><span class="line"><span class="comment"># starter database.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.password.ALL=oracle</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the SYS password for the starter database.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.password.SYS=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the SYSTEM password for the starter database.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.password.SYSTEM=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the SYSMAN password for the starter database.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.password.SYSMAN=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the DBSNMP password for the starter database.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.password.DBSNMP=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the management option to be selected for the starter database.</span></span><br><span class="line"><span class="comment"># It can be one of the following:</span></span><br><span class="line"><span class="comment">#   - GRID_CONTROL</span></span><br><span class="line"><span class="comment">#   - DB_CONTROL</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.control=DB_CONTROL</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the Management Service to use if Grid Control is selected to manage</span></span><br><span class="line"><span class="comment"># the database.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.gridcontrol.gridControlServiceURL=</span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment"># SPECIFY BACKUP AND RECOVERY OPTIONS                                         #</span></span><br><span class="line"><span class="comment"># ------------------------------------                                        #</span></span><br><span class="line"><span class="comment"># Out-of-box backup and recovery options for the database can be mentioned    #</span></span><br><span class="line"><span class="comment"># using the entries below.                                                    #</span></span><br><span class="line"><span class="comment">#                                                                             #</span></span><br><span class="line"><span class="comment">###############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># This variable is to be set to false if automated backup is not required. Else</span></span><br><span class="line"><span class="comment"># this can be set to true.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.automatedBackup.<span class="built_in">enable</span>=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Regardless of the type of storage that is chosen for backup and recovery, if</span></span><br><span class="line"><span class="comment"># automated backups are enabled, a job will be scheduled to run daily to backup</span></span><br><span class="line"><span class="comment"># the database. This job will run as the operating system user that is</span></span><br><span class="line"><span class="comment"># specified in this variable.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.automatedBackup.osuid=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Regardless of the type of storage that is chosen for backup and recovery, if</span></span><br><span class="line"><span class="comment"># automated backups are enabled, a job will be scheduled to run daily to backup</span></span><br><span class="line"><span class="comment"># the database. This job will run as the operating system user specified by the</span></span><br><span class="line"><span class="comment"># above entry. The following entry stores the password for the above operating</span></span><br><span class="line"><span class="comment"># system user.</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.automatedBackup.ospwd=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the type of storage to use for the database.</span></span><br><span class="line"><span class="comment"># It can be one of the following:</span></span><br><span class="line"><span class="comment">#   - FILE_SYSTEM_STORAGE</span></span><br><span class="line"><span class="comment">#   - ASM_STORAGE</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.storageType=FILE_SYSTEM_STORAGE</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the database file location which is a directory for datafiles, control</span></span><br><span class="line"><span class="comment"># files, redo logs.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Applicable only when oracle.install.db.config.starterdb.storage=FILE_SYSTEM_STORAGE</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the backup and recovery location.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Applicable only when oracle.install.db.config.starterdb.storage=FILE_SYSTEM_STORAGE</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the existing ASM disk groups to be used for storage.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Applicable only when oracle.install.db.config.starterdb.storage=ASM_STORAGE</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.asm.diskGroup=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the password for ASMSNMP user of the ASM instance.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Applicable only when oracle.install.db.config.starterdb.storage=ASM_STORAGE</span></span><br><span class="line"><span class="comment">#-------------------------------------------------------------------------------</span></span><br><span class="line">oracle.install.db.config.asm.ASMSNMPPassword=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the My Oracle Support Account Username.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  Example   : MYORACLESUPPORT_USERNAME=abc@oracle.com</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">MYORACLESUPPORT_USERNAME=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the My Oracle Support Account Username password.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : MYORACLESUPPORT_PASSWORD=password</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">MYORACLESUPPORT_PASSWORD=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify whether to enable the user to set the password for</span></span><br><span class="line"><span class="comment"># My Oracle Support credentials. The value can be either true or false.</span></span><br><span class="line"><span class="comment"># If left blank it will be assumed to be false.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : SECURITY_UPDATES_VIA_MYORACLESUPPORT=true</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">SECURITY_UPDATES_VIA_MYORACLESUPPORT=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify whether user doesn&#x27;t want to configure Security Updates.</span></span><br><span class="line"><span class="comment"># The value for this variable should be true if you don&#x27;t want to configure</span></span><br><span class="line"><span class="comment"># Security Updates, false otherwise.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The value can be either true or false. If left blank it will be assumed</span></span><br><span class="line"><span class="comment"># to be false.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : DECLINE_SECURITY_UPDATES=false</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">DECLINE_SECURITY_UPDATES=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the Proxy server name. Length should be greater than zero.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : PROXY_HOST=proxy.domain.com</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">PROXY_HOST=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the proxy port number. Should be Numeric and at least 2 chars.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : PROXY_PORT=25</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">PROXY_PORT=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the proxy user name. Leave PROXY_USER and PROXY_PWD</span></span><br><span class="line"><span class="comment"># blank if your proxy server requires no authentication.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : PROXY_USER=username</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">PROXY_USER=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the proxy password. Leave PROXY_USER and PROXY_PWD</span></span><br><span class="line"><span class="comment"># blank if your proxy server requires no authentication.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : PROXY_PWD=password</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">PROXY_PWD=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the proxy realm. This value is used if auto-updates option is selected.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : PROXY_REALM=metalink</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">PROXY_REALM=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the Oracle Support Hub URL.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : COLLECTOR_SUPPORTHUB_URL=https://orasupporthub.company.com:8080/</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">COLLECTOR_SUPPORTHUB_URL=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the auto-updates option. It can be one of the following:</span></span><br><span class="line"><span class="comment">#   - MYORACLESUPPORT_DOWNLOAD</span></span><br><span class="line"><span class="comment">#   - OFFLINE_UPDATES</span></span><br><span class="line"><span class="comment">#   - SKIP_UPDATES</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.installer.autoupdates.option=</span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># In case MYORACLESUPPORT_DOWNLOAD option is chosen, specify the location where</span></span><br><span class="line"><span class="comment"># the updates are to be downloaded.</span></span><br><span class="line"><span class="comment"># In case OFFLINE_UPDATES option is chosen, specify the location where the updates</span></span><br><span class="line"><span class="comment"># are present.</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">oracle.installer.autoupdates.downloadUpdatesLoc=</span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the My Oracle Support Account Username which has the patches download privileges</span></span><br><span class="line"><span class="comment"># to be used for software updates.</span></span><br><span class="line"><span class="comment">#  Example   : AUTOUPDATES_MYORACLESUPPORT_USERNAME=abc@oracle.com</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">AUTOUPDATES_MYORACLESUPPORT_USERNAME=</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Specify the My Oracle Support Account Username password which has the patches download privileges</span></span><br><span class="line"><span class="comment"># to be used for software updates.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Example    : AUTOUPDATES_MYORACLESUPPORT_PASSWORD=password</span></span><br><span class="line"><span class="comment">#------------------------------------------------------------------------------</span></span><br><span class="line">AUTOUPDATES_MYORACLESUPPORT_PASSWORD=</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>rsp</tag>
      </tags>
  </entry>
  <entry>
    <title>dbca_11g.rsp</title>
    <url>/blog/posts/c589b96.html</url>
    <content><![CDATA[<h1 id="dbca-rsp"><a href="#dbca-rsp" class="headerlink" title="dbca.rsp"></a>dbca.rsp</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">##                            DBCA response file                            ##</span></span><br><span class="line"><span class="comment">##                            ------------------                            ##</span></span><br><span class="line"><span class="comment">## Copyright   1998, 2014, Oracle Corporation. All Rights Reserved.         ##</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">## Specify values for the variables listed below to customize Oracle        ##</span></span><br><span class="line"><span class="comment">## Database Configuration installation.                                     ##</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">## Each variable is associated with a comment. The comment identifies the   ##</span></span><br><span class="line"><span class="comment">## variable type.                                                           ##</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">## Please specify the values in the following format :                      ##</span></span><br><span class="line"><span class="comment">##          Type       :  Example                                           ##</span></span><br><span class="line"><span class="comment">##          String     :  &quot;&lt;value&gt;&quot;                                         ##</span></span><br><span class="line"><span class="comment">##          Boolean    :  True or False                                     ##</span></span><br><span class="line"><span class="comment">##          Number     :  &lt;numeric value&gt;                                   ##</span></span><br><span class="line"><span class="comment">##          StringList :  &#123;&quot;&lt;value1&gt;&quot;,&quot;&lt;value2&gt;&quot;&#125;                           ##</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">## Examples :                                                               ##</span></span><br><span class="line"><span class="comment">##     1. dbca -progress_only -responseFile &lt;response file&gt;                 ##</span></span><br><span class="line"><span class="comment">##        Display a progress bar depicting progress of database creation    ##</span></span><br><span class="line"><span class="comment">##        process.                                                          ##</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">##     2. dbca -silent -responseFile &lt;response file&gt;                        ##</span></span><br><span class="line"><span class="comment">##        Creates database silently. No user interface is displayed.        ##</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">##     3. dbca -silent -createDatabase -cloneTemplate                       ##</span></span><br><span class="line"><span class="comment">##             -responseFile &lt;response file&gt;                      ##</span></span><br><span class="line"><span class="comment">##        Creates database silently with clone template. The template in    ##</span></span><br><span class="line"><span class="comment">##      responsefile is a clone template.                         ##</span></span><br><span class="line"><span class="comment">##                                                                          ##</span></span><br><span class="line"><span class="comment">##     4. dbca -silent -deleteDatabase -responseFile &lt;response file&gt;        ##</span></span><br><span class="line"><span class="comment">##        Deletes database silently.                                        ##</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># GENERAL section is required for all types of database creations.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[GENERAL]</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : RESPONSEFILE_VERSION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Version of the database to create</span></span><br><span class="line"><span class="comment"># Valid values  : &quot;11.2.0&quot;</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">RESPONSEFILE_VERSION = <span class="string">&quot;11.2.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OPERATION_TYPE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Type of operation</span></span><br><span class="line"><span class="comment"># Valid values  : &quot;createDatabase&quot; \ &quot;createTemplateFromDB&quot; \ &quot;createCloneTemplate&quot; \ &quot;deleteDatabase&quot; \ &quot;configureDatabase&quot; \ &quot;addInstance&quot; (RAC-only) \ &quot;deleteInstance&quot; (RAC-only) \ &quot;createPluggableDatabase&quot; \ &quot;unplugDatabase&quot; \ &quot;deletePluggableDatabase&quot; \ &quot;configurePluggableDatabase&quot;</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">OPERATION_TYPE = <span class="string">&quot;createDatabase&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of GENERAL section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CREATEDATABASE section is used when OPERATION_TYPE is defined as &quot;createDatabase&quot;.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[CREATEDATABASE]</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : GDBNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Global database name of the database</span></span><br><span class="line"><span class="comment"># Valid values  : &lt;db_name&gt;.&lt;db_domain&gt; - when database domain isn&#x27;t NULL</span></span><br><span class="line"><span class="comment">#                 &lt;db_name&gt;             - when database domain is NULL</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">GDBNAME = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DATABASECONFTYPE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : database conf type as Single Instance, Real Application Cluster or Real Application Cluster One Nodes database</span></span><br><span class="line"><span class="comment"># Valid values  : SI\RAC\RACONENODE</span></span><br><span class="line"><span class="comment"># Default value : SI</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">DATABASECONFTYPE  = <span class="string">&quot;SI&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : RACONENODESERVICENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Service is required by application to connect to RAC One</span></span><br><span class="line"><span class="comment">#          Node Database</span></span><br><span class="line"><span class="comment"># Valid values  : Service Name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No [required in case DATABASECONFTYPE is set to RACONENODE]</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#RACONENODESERVICENAME =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : POLICYMANAGED</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Set to true if Database is policy managed and</span></span><br><span class="line"><span class="comment">#          set to false if  Database is admin managed</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE\FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#POLICYMANAGED = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CREATESERVERPOOL</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Set to true if new server pool need to be created for database</span></span><br><span class="line"><span class="comment">#          if this option is specified then the newly created database</span></span><br><span class="line"><span class="comment">#          will use this newly created serverpool.</span></span><br><span class="line"><span class="comment">#          Multiple serverpoolname can not be specified for database</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE\FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#CREATESERVERPOOL = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SERVERPOOLNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Only one serverpool name need to be specified</span></span><br><span class="line"><span class="comment">#           if Create Server Pool option is specified.</span></span><br><span class="line"><span class="comment">#           Comma-separated list of Serverpool names if db need to use</span></span><br><span class="line"><span class="comment">#           multiple Server pool</span></span><br><span class="line"><span class="comment"># Valid values  : ServerPool name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No [required in case of RAC service centric database]</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SERVERPOOLNAME =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CARDINALITY</span></span><br><span class="line"><span class="comment"># Datatype      : Number</span></span><br><span class="line"><span class="comment"># Description   : Specify Cardinality for create server pool operation</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Valid values  : any positive Integer value</span></span><br><span class="line"><span class="comment"># Default value : Number of qualified nodes on cluster</span></span><br><span class="line"><span class="comment"># Mandatory     : No [Required when a new serverpool need to be created]</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#CARDINALITY =</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : FORCE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Set to true if new server pool need to be created by force</span></span><br><span class="line"><span class="comment">#          if this option is specified then the newly created serverpool</span></span><br><span class="line"><span class="comment">#          will be assigned server even if no free servers are available.</span></span><br><span class="line"><span class="comment">#          This may affect already running database.</span></span><br><span class="line"><span class="comment">#          This flag can be specified for Admin managed as well as policy managed db.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE\FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#FORCE = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PQPOOLNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Only one serverpool name needs to be specified</span></span><br><span class="line"><span class="comment">#           if create server pool option is specified.</span></span><br><span class="line"><span class="comment">#           Comma-separated list of serverpool names if use</span></span><br><span class="line"><span class="comment">#           server pool. This is required to</span></span><br><span class="line"><span class="comment">#                  create Parallel Query (PQ) database. Applicable to Big Cluster</span></span><br><span class="line"><span class="comment"># Valid values  :  Parallel Query (PQ) pool name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No [required in case of RAC service centric database]</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#PQPOOLNAME =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PQCARDINALITY</span></span><br><span class="line"><span class="comment"># Datatype      : Number</span></span><br><span class="line"><span class="comment"># Description   : Specify Cardinality for create server pool operation.</span></span><br><span class="line"><span class="comment">#                 Applicable to Big Cluster</span></span><br><span class="line"><span class="comment"># Valid values  : any positive Integer value</span></span><br><span class="line"><span class="comment"># Default value : Number of qualified nodes on cluster</span></span><br><span class="line"><span class="comment"># Mandatory     : No [Required when a new serverpool need to be created]</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#PQCARDINALITY =</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SID</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : System identifier (SID) of the database</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : &lt;db_name&gt; specified in GDBNAME</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SID = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CREATEASCONTAINERDATABASE</span></span><br><span class="line"><span class="comment"># Datatype      : boolean</span></span><br><span class="line"><span class="comment"># Description   : flag to create database as container database</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : false</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#CREATEASCONTAINERDATABASE =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : NUMBEROFPDBS</span></span><br><span class="line"><span class="comment"># Datatype      : Number</span></span><br><span class="line"><span class="comment"># Description   : Specify the number of pdb to be created</span></span><br><span class="line"><span class="comment"># Valid values  : 0 to 252</span></span><br><span class="line"><span class="comment"># Default value : 0</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#NUMBEROFPDBS =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specify the pdbname/pdbanme prefix if one or more pdb need to be created</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#PDBNAME =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBADMINPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : PDB Administrator user password</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBADMINPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : NODELIST</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Comma-separated list of cluster nodes</span></span><br><span class="line"><span class="comment"># Valid values  : Cluster node names</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No (Yes for RAC database-centric database)</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#NODELIST=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : TEMPLATENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Name of the template</span></span><br><span class="line"><span class="comment"># Valid values  : Template file name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">TEMPLATENAME = <span class="string">&quot;General_Purpose.dbc&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OBFUSCATEDPASSWORDS</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Set to true if passwords are encrypted</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE\FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OBFUSCATEDPASSWORDS = FALSE</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for SYS user</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SYSPASSWORD = <span class="string">&quot;oracle&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSTEMPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for SYSTEM user</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SYSTEMPASSWORD = <span class="string">&quot;oracle&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SERVICEUSERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for Windows Service user</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : If Oracle home is installed with windows service user</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SERVICEUSERPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Enterprise Manager Configuration Type</span></span><br><span class="line"><span class="comment"># Valid values  : CENTRAL|DBEXPRESS|ALL|NONE</span></span><br><span class="line"><span class="comment"># Default value : NONE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMCONFIGURATION = &quot;NONE&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMEXPRESSPORT</span></span><br><span class="line"><span class="comment"># Datatype      : Number</span></span><br><span class="line"><span class="comment"># Description   : Enterprise Manager Configuration Type</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : NONE</span></span><br><span class="line"><span class="comment"># Mandatory     : No, will be picked up from DBEXPRESS_HTTPS_PORT env variable</span></span><br><span class="line"><span class="comment">#                 or auto generates a free port between 5500 and 5599</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMEXPRESSPORT = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : RUNCVUCHECKS</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify whether to run Cluster Verification Utility checks</span></span><br><span class="line"><span class="comment">#                 periodically in Cluster environment</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE\FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#RUNCVUCHECKS = FALSE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DBSNMPPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for DBSNMP user</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if EMCONFIGURATION is specified or</span></span><br><span class="line"><span class="comment">#                 the value of RUNCVUCHECKS is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DBSNMPPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OMSHOST</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : EM management server host name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OMSHOST =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OMSPORT</span></span><br><span class="line"><span class="comment"># Datatype      : Number</span></span><br><span class="line"><span class="comment"># Description   : EM management server port number</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OMSPORT =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMUSER</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : EM Admin username to add or modify targets</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMUSER =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : EM Admin user password</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMPASSWORD=</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span></span><br><span class="line"><span class="comment"># Valid values  : True/False</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVCONFIGURATION = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for  DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OLSCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Label Security</span></span><br><span class="line"><span class="comment"># Valid values  : True/False</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OLSCONFIGURATION = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DATAFILEJARLOCATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Location of the data file jar</span></span><br><span class="line"><span class="comment"># Valid values  : Directory containing compressed datafile jar</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DATAFILEJARLOCATION =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DATAFILEDESTINATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Location of the data file&#x27;s</span></span><br><span class="line"><span class="comment"># Valid values  : Directory for all the database files</span></span><br><span class="line"><span class="comment"># Default value : $ORACLE_BASE/oradata</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">DATAFILEDESTINATION=/u01/app/oracle/oradata</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : RECOVERYAREADESTINATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Location of the data file&#x27;s</span></span><br><span class="line"><span class="comment"># Valid values  : Recovery Area location</span></span><br><span class="line"><span class="comment"># Default value : $ORACLE_BASE/flash_recovery_area</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">RECOVERYAREADESTINATION=/u01/app/oracle/oradata</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : STORAGETYPE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the storage on which the database is to be created</span></span><br><span class="line"><span class="comment"># Valid values  : FS (CFS for RAC), ASM</span></span><br><span class="line"><span class="comment"># Default value : FS</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">STORAGETYPE=FS</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DISKGROUPNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the disk group name for the storage</span></span><br><span class="line"><span class="comment"># Default value : DATA</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DISKGROUPNAME=DATA</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : ASMSNMP_PASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for ASM Monitoring</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#ASMSNMP_PASSWORD=&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : RECOVERYGROUPNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the disk group name for the recovery area</span></span><br><span class="line"><span class="comment"># Default value : RECOVERY</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#RECOVERYGROUPNAME=RECOVERY</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CHARACTERSET</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Character set of the database</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c National Language Support Guide</span></span><br><span class="line"><span class="comment"># Default value : &quot;US7ASCII&quot;</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">CHARACTERSET=<span class="string">&quot;AL32UTF8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : NATIONALCHARACTERSET</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : National Character set of the database</span></span><br><span class="line"><span class="comment"># Valid values  : &quot;UTF8&quot; or &quot;AL16UTF16&quot;. For details, check Oracle12c National Language Support Guide</span></span><br><span class="line"><span class="comment"># Default value : &quot;AL16UTF16&quot;</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#NATIONALCHARACTERSET= &quot;UTF8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : REGISTERWITHDIRSERVICE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether to register with Directory Service.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#REGISTERWITHDIRSERVICE= TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the name of the directory service user</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the directory service user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : WALLETPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password for wallet to created or modified.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#WALLETPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : LISTENERS</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies list of listeners to register the database with.</span></span><br><span class="line"><span class="comment">#          By default the database is configured for all the listeners specified in the</span></span><br><span class="line"><span class="comment">#          $ORACLE_HOME/network/admin/listener.ora</span></span><br><span class="line"><span class="comment"># Valid values  : The list should be comma separated like &quot;listener1,listener2&quot;.</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#LISTENERS = &quot;listener1,listener2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : VARIABLESFILE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Location of the file containing variable value pair</span></span><br><span class="line"><span class="comment"># Valid values  : A valid file-system file. The variable value pair format in this file</span></span><br><span class="line"><span class="comment">#          is &lt;variable&gt;=&lt;value&gt;. Each pair should be in a new line.</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#VARIABLESFILE=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : VARIABLES</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : comma separated list of name=value pairs. Overrides variables defined in variablefile and templates</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#VARIABLES=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : INITPARAMS</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : comma separated list of name=value pairs. Overrides initialization parameters defined in templates</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">INITPARAMS=<span class="string">&quot;memory_target=0,sga_target=500,pga_aggregate_target=100,java_jit_enabled=false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SAMPLESCHEMA</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether or not to add the Sample Schemas to your database</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FASLE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SAMPLESCHEMA=TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : MEMORYPERCENTAGE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : percentage of physical memory for Oracle</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#MEMORYPERCENTAGE = &quot;40&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DATABASETYPE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : used for memory distribution when MEMORYPERCENTAGE specified</span></span><br><span class="line"><span class="comment"># Valid values  : MULTIPURPOSE|DATA_WAREHOUSING|OLTP</span></span><br><span class="line"><span class="comment"># Default value : MULTIPURPOSE</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DATABASETYPE = &quot;MULTIPURPOSE&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : AUTOMATICMEMORYMANAGEMENT</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : flag to indicate Automatic Memory Management is used</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE/FALSE</span></span><br><span class="line"><span class="comment"># Default value : TRUE</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">AUTOMATICMEMORYMANAGEMENT=<span class="string">&quot;False&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : TOTALMEMORY</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : total memory in MB to allocate to Oracle</span></span><br><span class="line"><span class="comment"># Valid values  :</span></span><br><span class="line"><span class="comment"># Default value :</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#TOTALMEMORY = &quot;800&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of CREATEDATABASE section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># createTemplateFromDB section is used when OPERATION_TYPE is defined as &quot;createTemplateFromDB&quot;.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[createTemplateFromDB]</span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database from which to create the template</span></span><br><span class="line"><span class="comment"># Valid values  : The format is &lt;host&gt;:&lt;port&gt;:&lt;sid&gt;</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SOURCEDB = <span class="string">&quot;myhost:1521:orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : A user with DBA role.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SYSDBAUSERNAME = <span class="string">&quot;system&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the DBA user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : TEMPLATENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Name for the new template.</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">TEMPLATENAME = <span class="string">&quot;My Copy TEMPLATE&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of createTemplateFromDB section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># createCloneTemplate section is used when OPERATION_TYPE is defined as &quot;createCloneTemplate&quot;.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[createCloneTemplate]</span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database is the SID from which to create the template.</span></span><br><span class="line"><span class="comment">#          This database must be local and on the same ORACLE_HOME.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SOURCEDB = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : A user with DBA role.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if no OS authentication</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAUSERNAME = &quot;sys&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the DBA user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : TEMPLATENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Name for the new template.</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">TEMPLATENAME = <span class="string">&quot;My Clone TEMPLATE&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DATAFILEJARLOCATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Location of the data file jar</span></span><br><span class="line"><span class="comment"># Valid values  : Directory where the new compressed datafile jar will be placed</span></span><br><span class="line"><span class="comment"># Default value : $ORACLE_HOME/assistants/dbca/templates</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DATAFILEJARLOCATION =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of createCloneTemplate section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># DELETEDATABASE section is used when DELETE_TYPE is defined as &quot;deleteDatabase&quot;.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[DELETEDATABASE]</span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database is the SID</span></span><br><span class="line"><span class="comment">#          This database must be local and on the same ORACLE_HOME.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SOURCEDB = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : A user with DBA role.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if no OS authentication</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAUSERNAME = &quot;sys&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the DBA user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if no OS authentication</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAPASSWORD = &quot;password&quot;</span></span><br><span class="line"><span class="comment">#-----------------------*** End of deleteDatabase section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># GENERATESCRIPTS section</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[generateScripts]</span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : TEMPLATENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Name of the template</span></span><br><span class="line"><span class="comment"># Valid values  : Template name as seen in DBCA</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">TEMPLATENAME = <span class="string">&quot;New Database&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : GDBNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Global database name of the database</span></span><br><span class="line"><span class="comment"># Valid values  : &lt;db_name&gt;.&lt;db_domain&gt; - when database domain isn&#x27;t NULL</span></span><br><span class="line"><span class="comment">#                 &lt;db_name&gt;             - when database domain is NULL</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">GDBNAME = <span class="string">&quot;orcl11.us.oracle.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SCRIPTDESTINATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Location of the scripts</span></span><br><span class="line"><span class="comment"># Valid values  : Directory for all the scripts</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SCRIPTDESTINATION =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Enterprise Manager Configuration Type</span></span><br><span class="line"><span class="comment"># Valid values  : CENTRAL</span></span><br><span class="line"><span class="comment"># Default value : NONE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMCONFIGURATION = &quot;NONE&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OMSHOST</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : EM management server host name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OMSHOST =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OMSPORT</span></span><br><span class="line"><span class="comment"># Datatype      : Number</span></span><br><span class="line"><span class="comment"># Description   : EM management server port number</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OMSPORT =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMUSER</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : EM Admin username to add or modify targets</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMUSER =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : EM Admin user password</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMPASSWORD=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of deleteDatabase section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CONFIGUREDATABASE section is used when OPERATION_TYPE is defined as &quot;configureDatabase&quot;.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[CONFIGUREDATABASE]</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database is the SID</span></span><br><span class="line"><span class="comment">#          This database must be local and on the same ORACLE_HOME.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SOURCEDB = &quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : A user with DBA role.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if no OS authentication</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAUSERNAME = &quot;sys&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the DBA user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if no OS authentication</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAPASSWORD =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : REGISTERWITHDIRSERVICE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether to register with Directory Service.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#REGISTERWITHDIRSERVICE= TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : UNREGISTERWITHDIRSERVICE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether to unregister with Directory Service.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#UNREGISTERWITHDIRSERVICE= TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : REGENERATEDBPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether regenerate database password in OID/Wallet</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#REGENERATEDBPASSWORD= TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the name of the directory service user</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the directory service user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : WALLETPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password for wallet to created or modified.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#WALLETPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : ENABLESECURITYCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Database Security Settings</span></span><br><span class="line"><span class="comment"># Valid values  : true|false</span></span><br><span class="line"><span class="comment"># Default value : true</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#ENABLESECURITYCONFIGURATION = &quot;true&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DBSNMPPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for DBSNMP user</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if EMCONFIGURATION is specified</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DBSNMPPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span></span><br><span class="line"><span class="comment"># Valid values  : True/False</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVCONFIGURATION = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for  DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of CONFIGUREDATABASE section ***------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># ADDINSTANCE section is used when OPERATION_TYPE is defined as &quot;addInstance&quot;.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[ADDINSTANCE]</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DB_UNIQUE_NAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DB Unique Name of the RAC database</span></span><br><span class="line"><span class="comment"># Valid values  : &lt;db_unique_name&gt;</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">DB_UNIQUE_NAME = <span class="string">&quot;orcl11c.us.oracle.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : INSTANCENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : RAC instance name to be added</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : &lt;sid_prefix&gt;+&lt;highest_current_thread+1&gt;</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#INSTANCENAME = &quot;orcl1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : NODENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Node on which to add new instance</span></span><br><span class="line"><span class="comment">#                 (in 10gR2, instance addition is supported on 1 node at a time)</span></span><br><span class="line"><span class="comment"># Valid values  : Cluster node name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">NODENAME=</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OBFUSCATEDPASSWORDS</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Set to true if passwords are encrypted</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE\FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OBFUSCATEDPASSWORDS = FALSE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : A user with DBA role.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SYSDBAUSERNAME = <span class="string">&quot;sys&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the DBA user.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SERVICEUSERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for Windows Service user</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : If Oracle home is installed with windows service user</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SERVICEUSERPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of ADDINSTANCE section ***------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># DELETEINSTANCE section is used when OPERATION_TYPE is defined as &quot;deleteInstance&quot;.</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">[DELETEINSTANCE]</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DB_UNIQUE_NAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DB Unique Name of the RAC database</span></span><br><span class="line"><span class="comment"># Valid values  : &lt;db_unique_name&gt;</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">DB_UNIQUE_NAME = <span class="string">&quot;orcl11c.us.oracle.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : INSTANCENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : RAC instance name to be deleted</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">INSTANCENAME = <span class="string">&quot;orcl11g&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : NODENAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Node on which instance to be deleted (SID) is located</span></span><br><span class="line"><span class="comment"># Valid values  : Cluster node name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#NODENAME=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OBFUSCATEDPASSWORDS</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Set to true if passwords are encrypted</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE\FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OBFUSCATEDPASSWORDS = FALSE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : A user with DBA role.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SYSDBAUSERNAME = <span class="string">&quot;sys&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SYSDBAPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the DBA user.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#SYSDBAPASSWORD = &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of DELETEINSTANCE section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CREATEPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as &quot;createPluggableDatabase&quot;.</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line">[CREATEPLUGGABLEDATABASE]</span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database is the SID</span></span><br><span class="line"><span class="comment">#          This database must be local and on the same ORACLE_HOME.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SOURCEDB = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The name of new pluggable database</span></span><br><span class="line"><span class="comment">#          This pdb name must not be same as sourcedb name.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">PDBNAME = <span class="string">&quot;PDB1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CREATEASCLONE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : specify true or false for PDB to be create as Clone.</span></span><br><span class="line"><span class="comment">#               : When &quot;true&quot; is passed a new PDB GUID is generated for the plugged in PDB</span></span><br><span class="line"><span class="comment"># Default value : true</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CREATEASCLONE = &quot;TRUE&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CREATEPDBFROM</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : specify the source of pdb to be plugged</span></span><br><span class="line"><span class="comment"># Valid values  : DEFAULT | FILEARCHIVE | RMANBACKUP | USINGXML</span></span><br><span class="line"><span class="comment"># Default value : DEFAULT</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CREATEPDBFROM = &quot;DEFAULT&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBARCHIVEFILE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Full path and name for pdbArchive file</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Mandatory when creating new PDB using FILEARCHIVE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBARCHIVEFILE = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBBACKUPFILE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Full path and name for pdb back up file</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Mandatory when creating new PDB using RMANBACKUP</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBBACKUPFILE = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBMETADATAFILE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Full path and name for pdb metadata file</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Mandatory when creating new PDB using RMANBACKUP or USINGXML</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBMETADATAFILE = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBUSEMULTIPLEBACKUP</span></span><br><span class="line"><span class="comment"># Datatype      : boolean</span></span><br><span class="line"><span class="comment"># Description   : Flag that can used to create PDB from single or multiple backupsets</span></span><br><span class="line"><span class="comment"># Default value : true</span></span><br><span class="line"><span class="comment"># Mandatory     : Optional when creating new PDB using RMANBACKUP or USINGXML</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBUSEMULTIPLEBACKUP =</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBADMINUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : PDB Administrator user name</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Mandatory only when creating new DEFAULT PDB</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBADMINUSERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBADMINPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : PDB Administrator user password</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Mandatory only when creating new DEFAULT PDB</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBADMINPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CREATENEWPDBADMINUSER</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : When Plugging a pdb from FILEARCHIVE or RMANBACKUP</span></span><br><span class="line"><span class="comment">#          a new PDB Administrator user can be created using this option</span></span><br><span class="line"><span class="comment">#          This option should be given along with pdbadmin username and password</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CREATENEWPDBADMINUSER = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEFILENAMECONVERT</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : This clause specifies how to locate files listed in an XML file</span></span><br><span class="line"><span class="comment">#          describing a Pluggable Database if they reside in a location different</span></span><br><span class="line"><span class="comment">#          from that specified in the XML file.</span></span><br><span class="line"><span class="comment">#          This clause is valid when creating Pluggable database in USINGXML option</span></span><br><span class="line"><span class="comment"># Valid values  : (&lt;filename_pattern&gt;, &lt;replacement_filename_pattern&gt;,....)</span></span><br><span class="line"><span class="comment"># Default value : &quot;NONE&quot;</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># SOURCEFILENAMECONVERT = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : FILENAMECONVERT</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : This clause specifies how to generate names of files</span></span><br><span class="line"><span class="comment">#          for the Pluggable Database being created using names of existing files</span></span><br><span class="line"><span class="comment">#          This clause is valid when creating Pluggable database in USINGXML option</span></span><br><span class="line"><span class="comment"># Valid values  : (&lt;filename_pattern&gt;, &lt;replacement_filename_pattern&gt;,....)</span></span><br><span class="line"><span class="comment"># Default value : &quot;NONE&quot;</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># FILENAMECONVERT = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : COPYPDBFILES</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : If COPY is specified, it will indicate that datafiles need to be copied.</span></span><br><span class="line"><span class="comment">#        : This option can be true only when FILENAMECONVERT is specified or</span></span><br><span class="line"><span class="comment">#           CDB files are Oracle Managed Files(OMF)</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># COPYPDBFILES = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBDATAFILEDESTINATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : common location for PDB datafile area</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBDATAFILEDESTINATION = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : USEMETADATAFILELOCATION</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify true if datafile path defined in Meta datafile within PDB</span></span><br><span class="line"><span class="comment">#          archive file is to be used to un-archive datafile.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># USEMETADATAFILELOCATION = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : REGISTERWITHDIRSERVICE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether to register with Directory Service.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#REGISTERWITHDIRSERVICE= TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the name of the directory service user</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the directory service user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : WALLETPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password for wallet to created or modified.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#WALLETPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : LBACSYSPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for LBACSYS user</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService are TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#LBACSYSPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : CREATEUSERTABLESPACE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify true if a default user tablespace need to be created in new PDB</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : TRUE</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CREATEUSERTABLESPACE = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span></span><br><span class="line"><span class="comment"># Valid values  : True/False</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVCONFIGURATION = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for  DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of createPluggableDatabase section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># UNPLUGDATABASE section is used when OPERATION_TYPE is defined as &quot;unplugDatabase&quot;.</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line">[UNPLUGDATABASE]</span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database is the SID</span></span><br><span class="line"><span class="comment">#          This database must be local and on the same ORACLE_HOME.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SOURCEDB = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The name of new pluggable database</span></span><br><span class="line"><span class="comment">#          This pdb name must not be same as sourcedb name.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">PDBNAME = <span class="string">&quot;PDB1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : ARCHIVETYPE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The unplugged database datafile backup will in tar.gz or rman backup</span></span><br><span class="line"><span class="comment">#          This pdb name must not be same as sourcedb name.</span></span><br><span class="line"><span class="comment"># Valid values  : TAR | RMAN</span></span><br><span class="line"><span class="comment"># Default value : TAR</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">ARCHIVETYPE = <span class="string">&quot;TAR&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBARCHIVEFILE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Full path and name for pdbArchive file</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : NO</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBARCHIVEFILE = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBBACKUPFILE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Full path and name for pdb back up file</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBBACKUPFILE = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBMETADATAFILE</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Full path and name for pdb metadata file</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># PDBMETADATAFILE = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : UNREGISTERWITHDIRSERVICE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether to unregister with Directory Service.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#UNREGISTERWITHDIRSERVICE= TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the name of the directory service user</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the directory service user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : WALLETPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password for wallet to created or modified.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#WALLETPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of unplugDatabase section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># DELETEPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as &quot;deletePluggableDatabase&quot;.</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line">[DELETEPLUGGABLEDATABASE]</span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database is the SID</span></span><br><span class="line"><span class="comment">#          This database must be local and on the same ORACLE_HOME.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SOURCEDB = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The name of new pluggable database</span></span><br><span class="line"><span class="comment">#          This pdb name must not be same as sourcedb name.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">PDBNAME = <span class="string">&quot;PDB1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of deletePluggableDatabase section ***------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CONFIGUREPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as &quot;configurePluggableDatabase&quot;.</span></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line">[CONFIGUREPLUGGABLEDATABASE]</span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : SOURCEDB</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The source database is the SID</span></span><br><span class="line"><span class="comment">#          This database must be local and on the same ORACLE_HOME.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">SOURCEDB = <span class="string">&quot;orcl&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : PDBNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The name of new pluggable database</span></span><br><span class="line"><span class="comment">#          This pdb name must not be same as sourcedb name.</span></span><br><span class="line"><span class="comment"># Default value : none</span></span><br><span class="line"><span class="comment"># Mandatory     : YES</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line">PDBNAME = <span class="string">&quot;PDB1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span></span><br><span class="line"><span class="comment"># Valid values  : True/False</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVCONFIGURATION = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVOWNERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for DataVault Owner</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : Yes, if DataVault option is chosen</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVOWNERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DVACCOUNTMANAGERPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for  DataVault Account Manager</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : None</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : OLSCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Label Security</span></span><br><span class="line"><span class="comment"># Valid values  : True/False</span></span><br><span class="line"><span class="comment"># Default value : False</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#OLSCONFIGURATION = &quot;false&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : REGISTERWITHDIRSERVICE</span></span><br><span class="line"><span class="comment"># Datatype      : Boolean</span></span><br><span class="line"><span class="comment"># Description   : Specifies whether to register with Directory Service.</span></span><br><span class="line"><span class="comment"># Valid values  : TRUE \ FALSE</span></span><br><span class="line"><span class="comment"># Default value : FALSE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#REGISTERWITHDIRSERVICE= TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEUSERNAME</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Specifies the name of the directory service user</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : DIRSERVICEPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password of the directory service user.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : WALLETPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : The password for wallet to created or modified.</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#WALLETPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : LBACSYSPASSWORD</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Password for LBACSYS user</span></span><br><span class="line"><span class="comment">#          You can also specify the password at the command prompt instead of here.</span></span><br><span class="line"><span class="comment"># Mandatory     : YES, if the value of olsConfiguration and registerWithDirService are TRUE</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#LBACSYSPASSWORD= &quot;password&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMCONFIGURATION</span></span><br><span class="line"><span class="comment"># Datatype      : String</span></span><br><span class="line"><span class="comment"># Description   : Enterprise Manager Configuration Type</span></span><br><span class="line"><span class="comment"># Valid values  : DBEXPRESS|NONE</span></span><br><span class="line"><span class="comment"># Default value : NONE</span></span><br><span class="line"><span class="comment"># Mandatory     : No</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMCONFIGURATION = &quot;NONE&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Name          : EMEXPRESSPORT</span></span><br><span class="line"><span class="comment"># Datatype      : Number</span></span><br><span class="line"><span class="comment"># Description   : Enterprise Manager Configuration Type</span></span><br><span class="line"><span class="comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span></span><br><span class="line"><span class="comment"># Default value : NONE</span></span><br><span class="line"><span class="comment"># Mandatory     : No, will be picked up from DBEXPRESS_HTTPS_PORT env variable</span></span><br><span class="line"><span class="comment">#                 or auto generates a free port between 5500 and 5599</span></span><br><span class="line"><span class="comment">#-----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">#EMEXPRESSPORT = &quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------*** End of configurePluggableDatabase section ***------------------------</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>rsp</tag>
      </tags>
  </entry>
  <entry>
    <title>Deinstall for RAC</title>
    <url>/blog/posts/b50a3062.html</url>
    <content><![CDATA[<h1 id="Deinstall-for-rac-11g-and-latest"><a href="#Deinstall-for-rac-11g-and-latest" class="headerlink" title="Deinstall for rac 11g and latest"></a>Deinstall for rac 11g and latest</h1><p>执行如下操作 (所有的目录以实际为准)：<br> 关闭数据库，如果数据库关闭不了强行杀进程，关闭监听。<br>清除 GRID 家目录(视版本而定)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /u01/app/grid/*</span><br><span class="line"><span class="built_in">rm</span> -rf /u01/app/11.2.0/*</span><br></pre></td></tr></table></figure>

<p>清除 ORACLE 家目录(视版本而定)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /u01/app/oraInventory/*</span><br><span class="line"><span class="built_in">rm</span> -rf /u01/app/oracle/*</span><br></pre></td></tr></table></figure>

<p>清除相关文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /tmp/.oracle</span><br><span class="line"><span class="built_in">rm</span> -rf /var/tmp/.oracle</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/init/oracle-ohasd.conf</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/init.d/ohasd</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/init.d/init.ohasd</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/oraInst.loc</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/oratab</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/oracle</span><br></pre></td></tr></table></figure>

<p>清除 ASM 磁盘信息(根据真实情况而定)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sdb bs=8192 count=128000</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sdc bs=8192 count=128000</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sdd bs=8192 count=128000</span><br></pre></td></tr></table></figure>

<h1 id="Deinstall-for-rac-10g"><a href="#Deinstall-for-rac-10g" class="headerlink" title="Deinstall for rac 10g"></a>Deinstall for rac 10g</h1><p>删除 Oracle database db sofetware:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /u01/app/oracle/product/10.2.0/db_1</span><br></pre></td></tr></table></figure>

<p>删除 Oracle database clustware sofetware:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /u01/app/oracle/product/10.2.0/crs_1</span><br><span class="line"><span class="built_in">rm</span> -rf /u01/app/oracle/oraInventory</span><br></pre></td></tr></table></figure>

<p>清除相关文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/rc5.d/S96init.crs</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/init.d/init.crs</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/rc4.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/rc6.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/rc1.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/rc0.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/rc2.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/rc.d/rc3.d/S96init.crs</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /etc/oracle/*</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/oraInst.loc</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/oratab</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /usr/local/bin/coraenv</span><br><span class="line"><span class="built_in">rm</span> -rf /usr/local/bin/dbhome</span><br><span class="line"><span class="built_in">rm</span> -rf /usr/local/bin/oraenv</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /etc/init.d/init.cssd</span><br><span class="line"><span class="built_in">rm</span> -f /etc/init.d/init.crs</span><br><span class="line"><span class="built_in">rm</span> -f /etc/init.d/init.crsd</span><br><span class="line"><span class="built_in">rm</span> -f /etc/init.d/init.evmd</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /etc/rc2.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -f /etc/rc2.d/S96init.crs</span><br><span class="line"><span class="built_in">rm</span> -f /etc/rc3.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -f /etc/rc3.d/S96init.crs</span><br><span class="line"><span class="built_in">rm</span> -f /etc/rc5.d/K96init.crs</span><br><span class="line"><span class="built_in">rm</span> -f /etc/rc5.d/S96init.crs</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /etc/inittab.crs</span><br><span class="line"></span><br><span class="line"><span class="comment"># restore inittab</span></span><br><span class="line"><span class="built_in">mv</span> /etc/inittab /etc/inittab_bak</span><br><span class="line"><span class="built_in">cp</span> /etc/inittab.orig /etc/inittab</span><br></pre></td></tr></table></figure>

<p>清理裸设备：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/raw/raw1 bs=1M count=300</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/raw/raw2 bs=1M count=300</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/raw/raw3 bs=1M count=300</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>deinstall</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 10g</title>
    <url>/blog/posts/f3918776.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-10g"><a href="#Install-Oracle-10g" class="headerlink" title="Install Oracle 10g"></a>Install Oracle 10g</h1><blockquote>
<p>Operation System: CentOS Linux release 7.9.2009 (Core)<br>Database Software: 10201_database_linux_x86_64.cpio<br>Database Patches: p8202632_10205_Linux-x86-64.zip</p>
</blockquote>
<h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Checking Package Requirements</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -q --qf <span class="string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n&#x27;</span> \</span><br><span class="line">make gcc glibc glibc-devel compat-db compat-gcc compat-gcc-c++ \</span><br><span class="line">compat-libstdc++ compat-libstdc++-devel gnome-libs openmotif21 setarch \</span><br><span class="line">libaio libaio-devel</span><br></pre></td></tr></table></figure>

<p><strong>Installing Packages</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install binutils compat-libstdc++-33 compat-libstdc++-33.i686 \</span><br><span class="line">elfutils-libelf elfutils-libelf-devel gcc gcc-c++ glibc glibc.i686 glibc-common \</span><br><span class="line">glibc-devel glibc-devel.i686 glibc-headers ksh libaio libaio.i686 libaio-devel \</span><br><span class="line">libaio-devel.i686 libgcc libgcc.i686 libstdc++ libstdc++.i686 libstdc++-devel make sysstat</span><br></pre></td></tr></table></figure>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Disable Firewall and SElinux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.184.150 `hostname`&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld --now</span><br><span class="line">sed -i <span class="string">&#x27;/SELINUX=/&#123;s/enforcing/disabled/&#125;&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>

<p><strong>Creating Oracle User Accounts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd oinstall</span><br><span class="line">groupadd dba</span><br><span class="line">useradd -c <span class="string">&quot;Oracle software owner&quot;</span> -g oinstall -G dba oracle</span><br><span class="line"><span class="built_in">echo</span> oracle | passwd --stdin oracle</span><br></pre></td></tr></table></figure>

<p><strong>Creating Oracle Directories</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /u01/app</span><br><span class="line"><span class="built_in">chown</span> -R oracle.oinstall /u01</span><br><span class="line"><span class="built_in">chmod</span> 775 -R /u01</span><br></pre></td></tr></table></figure>

<p><strong>Setting Oracle Environment Variables</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/10.2.0/db_1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:<span class="variable">$ORACLE_HOME</span>/lib32</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Changing system release</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i -e <span class="string">&#x27;s/CentOS/# CentOS/&#x27;</span> -e <span class="string">&#x27;1i redhat 4&#x27;</span> /etc/redhat-release</span><br></pre></td></tr></table></figure>

<p><strong>Setting kernel parameters</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">kernel.shmall = 4294967296</span></span><br><span class="line"><span class="string">kernel.shmmax = 68719476736</span></span><br><span class="line"><span class="string">kernel.shmmni = 4096</span></span><br><span class="line"><span class="string">kernel.sem = 250 32000 100 128</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 1024 65000</span></span><br><span class="line"><span class="string">net.core.rmem_default = 4194304</span></span><br><span class="line"><span class="string">net.core.rmem_max = 4194304</span></span><br><span class="line"><span class="string">net.core.wmem_default = 262144</span></span><br><span class="line"><span class="string">net.core.wmem_max = 262144</span></span><br><span class="line"><span class="string"># hugetlb_shm_group is dba group id</span></span><br><span class="line"><span class="string">vm.hugetlb_shm_group = 1001</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<p><strong>Setting shell limits</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">oracle soft nproc 2047</span></span><br><span class="line"><span class="string">oracle hard nproc 16384</span></span><br><span class="line"><span class="string">oracle soft nofile 1024</span></span><br><span class="line"><span class="string">oracle hard nofile 65536</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p><strong>Setting pam login</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/pam.d/login &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">session required /lib64/security/pam_limits.so</span></span><br><span class="line"><span class="string">session required pam_limits.so</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="Unpacking-the-Installation-Files-and-starting-runInstaller"><a href="#Unpacking-the-Installation-Files-and-starting-runInstaller" class="headerlink" title="Unpacking the Installation Files and starting runInstaller"></a>Unpacking the Installation Files and starting runInstaller</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">chown</span> -R oracle.oinstall /soft</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /soft</span><br><span class="line"></span><br><span class="line"><span class="comment"># Login as oracle user</span></span><br><span class="line"><span class="built_in">cd</span> /soft</span><br><span class="line">gunzip 10201_database_linux_x86_64.cpio.gz</span><br><span class="line">cpio -idmv &lt; 10201_database_linux_x86_64.cpio</span><br><span class="line">database/runInstaller</span><br></pre></td></tr></table></figure>

<h2 id="Patching-Oracle-10g-to-10-2-0-5-19"><a href="#Patching-Oracle-10g-to-10-2-0-5-19" class="headerlink" title="Patching Oracle 10g to 10.2.0.5.19"></a>Patching Oracle 10g to 10.2.0.5.19</h2><p><strong>Patching to 10.2.0.5.0</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Login as oracle user</span></span><br><span class="line">unzip p8202632_10205_Linux-x86-64.zip</span><br><span class="line">/soft/Disk1/runInstaller</span><br></pre></td></tr></table></figure>

<p><strong>Patching to 10.2.0.5.19</strong></p>
<p><a href="https://jove-2761781.github.io/hexo_blog/database/oracle/upgrade/patch%20p20299014/">patch p20299014</a></p>
<h2 id="Oracle-Post-Installation-Tasks"><a href="#Oracle-Post-Installation-Tasks" class="headerlink" title="Oracle Post Installation Tasks"></a>Oracle Post Installation Tasks</h2><p><strong>Setting automatic restart</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/N$/Y/&#x27;</span> /etc/oratab</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/rc.d/rc.local &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">su oracle -lc &quot;/u01/app/oracle/product/10.2.0/db_1/bin/lsnrctl start&quot;</span></span><br><span class="line"><span class="string">su oracle -lc &quot;/u01/app/oracle/product/10.2.0/db_1/bin/dbstart&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure>

<p><strong>Setting EM</strong></p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">emca -repos recreate</span><br><span class="line">emca -config dbcontrol db -repos create</span><br><span class="line">emca -deconfig dbcontrol db -repos drop</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 11g for RAC</title>
    <url>/blog/posts/cb2b044.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-11g-for-RAC"><a href="#Install-Oracle-11g-for-RAC" class="headerlink" title="Install Oracle 11g for RAC"></a>Install Oracle 11g for RAC</h1><blockquote>
<p>Operation System:<br>Database Software:<br>Database Patches: </p>
</blockquote>
<h2 id="Oracle-Standalone-Cluster-Requirements"><a href="#Oracle-Standalone-Cluster-Requirements" class="headerlink" title="Oracle Standalone Cluster Requirements"></a>Oracle Standalone Cluster Requirements</h2><h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Setting YUM Repository</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount /dev/sr0 /mnt</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/media.repo &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[InstallMedia_BaseOS]</span></span><br><span class="line"><span class="string">name=Red Hat Enterprise Linux 8.7.0 BaseOS</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/BaseOS</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[InstallMedia_AppStream]</span></span><br><span class="line"><span class="string">name=Red Hat Enterprise Linux 8.7.0 AppStream</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/AppStream</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure>

<p><strong>Checking Package Requirements</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -q --qf <span class="string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n&#x27;</span> \</span><br><span class="line">bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \</span><br><span class="line">glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \</span><br><span class="line">libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \</span><br><span class="line">libxcb libibverbs make smartmontools sysstat</span><br></pre></td></tr></table></figure>

<p><strong>Installing Packages</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \</span><br><span class="line">glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \</span><br><span class="line">libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \</span><br><span class="line">libxcb libibverbs make smartmontools sysstat</span><br></pre></td></tr></table></figure>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Setting hosts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.3.101   oracle19crac01</span></span><br><span class="line"><span class="string">192.168.3.102   oracle19crac02</span></span><br><span class="line"><span class="string">192.168.3.103   oracle19crac01-vip</span></span><br><span class="line"><span class="string">192.168.3.104   oracle19crac02-vip</span></span><br><span class="line"><span class="string">192.168.3.105   oracle19crac-scan</span></span><br><span class="line"><span class="string">100.100.100.101 oracle19crac01-priv</span></span><br><span class="line"><span class="string">100.100.100.102 oracle19crac02-priv</span></span><br></pre></td></tr></table></figure>

<p><strong>Disable Firewall and SElinux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> firewalld --now</span><br><span class="line">sed -i <span class="string">&#x27;/SELINUX=/&#123;s/enforcing/disabled/&#125;&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>

<p><strong>Creating Oracle User Accounts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd -g 1000 oinstall</span><br><span class="line">groupadd -g 1200 asmadmin</span><br><span class="line">groupadd -g 1201 asmdba</span><br><span class="line">groupadd -g 1202 asmoper</span><br><span class="line">groupadd -g 1300 dba</span><br><span class="line">groupadd -g 1301 oper</span><br><span class="line">useradd -c <span class="string">&quot;Oracle software owner&quot;</span> -u 1100 -g oinstall -G asmadmin,asmdba,asmoper grid</span><br><span class="line">useradd -c <span class="string">&quot;Grid software owner&quot;</span> -u 1101 -g oinstall -G dba,oper,asmdba oracle</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;oracle&quot;</span> | passwd --stdin oracle</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;grid&quot;</span> | passwd --stdin grid</span><br></pre></td></tr></table></figure>

<p><strong>Creating Oracle Directories</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /u01/app/11.2.0/grid</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/grid</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/oraInventory</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/oracle/product/11.2.0/db_1</span><br><span class="line"><span class="built_in">chown</span> -R grid:oinstall /u01</span><br><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /u01/app/oracle</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /u01/</span><br></pre></td></tr></table></figure>

<p><strong>Setting Oracle Environment Variables</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=coco1</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/db_1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib</span><br><span class="line"><span class="built_in">alias</span> sqlplus=<span class="string">&#x27;rlwrap sqlplus&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> rman=<span class="string">&#x27;rlwrap rman&#x27;</span></span><br><span class="line">EOF</span><br><span class="line">su - oracle -c <span class="string">&#x27;source ~/.bash_profile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /home/grid/.bash_profile &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=+ASM1</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/grid</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=/u01/app/11.2.0/grid</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib</span><br><span class="line"><span class="built_in">alias</span> sqlplus=<span class="string">&#x27;rlwrap sqlplus&#x27;</span></span><br><span class="line">EOF</span><br><span class="line">su - grid -c <span class="string">&#x27;source ~/.bash_profile&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Setting kernel parameters</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/99-oracle-database-preinstall-11g-sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">fs.file-max = 6815744</span></span><br><span class="line"><span class="string">kernel.sem = 250 32000 100 128</span></span><br><span class="line"><span class="string">kernel.shmmni = 4096</span></span><br><span class="line"><span class="string">kernel.shmall = 1073741824</span></span><br><span class="line"><span class="string">kernel.shmmax = 4398046511104</span></span><br><span class="line"><span class="string">kernel.panic_on_oops = 1</span></span><br><span class="line"><span class="string">net.core.rmem_default = 262144</span></span><br><span class="line"><span class="string">net.core.rmem_max = 4194304</span></span><br><span class="line"><span class="string">net.core.wmem_default = 262144</span></span><br><span class="line"><span class="string">net.core.wmem_max = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 2</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 2</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 9000 65500</span></span><br></pre></td></tr></table></figure>

<p><strong>Setting shell limits</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/security/limits.d/oracle-database-preinstall-11g.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">oracle   soft   nofile    1024</span></span><br><span class="line"><span class="string">oracle   hard   nofile    65536</span></span><br><span class="line"><span class="string">oracle   soft   nproc    16384</span></span><br><span class="line"><span class="string">oracle   hard   nproc    16384</span></span><br><span class="line"><span class="string">oracle   soft   stack    10240</span></span><br><span class="line"><span class="string">oracle   hard   stack    32768</span></span><br><span class="line"><span class="string">oracle   hard   memlock    134217728</span></span><br><span class="line"><span class="string">oracle   soft   memlock    134217728</span></span><br><span class="line"><span class="string">grid   soft   nofile    1024</span></span><br><span class="line"><span class="string">grid   hard   nofile    65536</span></span><br><span class="line"><span class="string">grid   soft   nproc    16384</span></span><br><span class="line"><span class="string">grid   hard   nproc    16384</span></span><br><span class="line"><span class="string">grid   soft   stack    10240</span></span><br><span class="line"><span class="string">grid   hard   stack    32768</span></span><br><span class="line"><span class="string">grid   hard   memlock    134217728</span></span><br><span class="line"><span class="string">grid   soft   memlock    134217728</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-SSH-Manually-on-All-Cluster-Nodes"><a href="#Configuring-SSH-Manually-on-All-Cluster-Nodes" class="headerlink" title="Configuring SSH Manually on All Cluster Nodes"></a>Configuring SSH Manually on All Cluster Nodes</h3><h3 id="Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB"><a href="#Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB" class="headerlink" title="Configuring Storage Device Path Persistence Using Oracle ASMLIB"></a>Configuring Storage Device Path Persistence Using Oracle ASMLIB</h3><h2 id="Installing-the-cvuqdisk-RPM-for-Linux"><a href="#Installing-the-cvuqdisk-RPM-for-Linux" class="headerlink" title="Installing the cvuqdisk RPM for Linux"></a>Installing the cvuqdisk RPM for Linux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CVUQDISK_GRP=oinstall; <span class="built_in">export</span> CVUQDISK_GRP</span><br><span class="line">rpm -iv /u01/app/19.0.0/grid/cv/rpm/cvuqdisk-1.0.10-1.rpm</span><br></pre></td></tr></table></figure>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R grid:oinstall /soft/LINUX.X64_193000_grid_home.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log in as grid user</span></span><br><span class="line">unzip -q /soft/LINUX.X64_193000_grid_home.zip -d /u01/app/19.0.0/grid/</span><br><span class="line">/u01/app/19.0.0/grid/gridSetup.sh</span><br></pre></td></tr></table></figure>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /soft/LINUX.X64_193000_db_home.zip</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log in as oracle user</span></span><br><span class="line">unzip -q /soft/LINUX.X64_193000_db_home.zip -d /u01/app/oracle/product/19.0.0/db_1/</span><br><span class="line">/u01/app/oracle/product/19.0.0/db_1/runInstaller</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 19c for RAC</title>
    <url>/blog/posts/11dd2bb7.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-19c-for-RAC"><a href="#Install-Oracle-19c-for-RAC" class="headerlink" title="Install Oracle 19c for RAC"></a>Install Oracle 19c for RAC</h1><blockquote>
<p>Operation System: RedHat 8.7.0 x86_64<br>Database Software: LINUX.X64_193000_grid_home.zip, LINUX.X64_193000_db_home.zip</p>
</blockquote>
<h2 id="Oracle-Standalone-Cluster-Requirements"><a href="#Oracle-Standalone-Cluster-Requirements" class="headerlink" title="Oracle Standalone Cluster Requirements"></a>Oracle Standalone Cluster Requirements</h2><p>Minimum Available Space Requirements for Oracle Standalone Cluster With GIMR Configuration</p>
<table>
<thead>
<tr>
<th>Redundancy Level</th>
<th>DATA Disk Group</th>
<th>MGMT Disk Group</th>
<th>Oracle Fleet Patching and Provisioning</th>
<th>Total Storage</th>
</tr>
</thead>
<tbody><tr>
<td>External</td>
<td>1 GB</td>
<td>28 GB Each node beyond four: 5 GB</td>
<td>1 GB</td>
<td>30 GB</td>
</tr>
<tr>
<td>Normal</td>
<td>2 GB</td>
<td>56 GB Each node beyond four: 5 GB</td>
<td>2 GB</td>
<td>60 GB</td>
</tr>
<tr>
<td>High&#x2F;Flex&#x2F;Extended</td>
<td>3 GB</td>
<td>84 GB Each node beyond four: 5 GB</td>
<td>3 GB</td>
<td>90 GB</td>
</tr>
</tbody></table>
<div class="note info modern"><p>a. The DATA disk group stores OCR and voting files, and the MGMT disk group stores GIMR and Oracle Clusterware backup files.<br>b. Starting with Oracle Grid Infrastructure 19c, configuring GIMR is optional for Oracle Standalone Cluster deployments.</p>
</div>

<h2 id="Configuring-Operating-Systems-for-Oracle-Grid-Infrastructure-on-Linux"><a href="#Configuring-Operating-Systems-for-Oracle-Grid-Infrastructure-on-Linux" class="headerlink" title="Configuring Operating Systems for Oracle Grid Infrastructure on Linux"></a>Configuring Operating Systems for Oracle Grid Infrastructure on Linux</h2><p>Disabling Firewall and SElinux.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> firewalld --now</span><br><span class="line">sed -i <span class="string">&#x27;/SELINUX=/&#123;s/enforcing/disabled/&#125;&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>

<p>Disabling Zero Configuration Network.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -p /etc/sysconfig/network&#123;,.bak.`<span class="built_in">date</span> +%m%d`&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;NOZEROCONF=yes&quot;</span> &gt;&gt; /etc/sysconfig/network</span><br></pre></td></tr></table></figure>

<p>Disabling Transparent Huagepages.</p>
<ul>
<li><a href="http://localhost:4000/blog/posts/49294.html">How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</a></li>
</ul>
<p>Configuring Public, Private, Virtual and SCAN IP names and Addresses.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># The following is add for Oracle 19c</span></span><br><span class="line"><span class="string">192.168.3.101   oracle19crac01</span></span><br><span class="line"><span class="string">192.168.3.102   oracle19crac02</span></span><br><span class="line"><span class="string">192.168.3.103   oracle19crac03</span></span><br><span class="line"><span class="string">192.168.3.104   oracle19crac01-vip</span></span><br><span class="line"><span class="string">192.168.3.105   oracle19crac02-vip</span></span><br><span class="line"><span class="string">192.168.3.106   oracle19crac02-vip</span></span><br><span class="line"><span class="string">192.168.3.107   oracle19crac-scan</span></span><br><span class="line"><span class="string">100.100.100.101 oracle19crac01-priv</span></span><br><span class="line"><span class="string">100.100.100.102 oracle19crac02-priv</span></span><br><span class="line"><span class="string">100.100.100.103 oracle19crac03-priv</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>Setting Yum Repository.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount /dev/sr0 /mnt</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/media.repo &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[InstallMedia_BaseOS]</span></span><br><span class="line"><span class="string">name=Red Hat Enterprise Linux 8.7.0 BaseOS</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/BaseOS</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[InstallMedia_AppStream]</span></span><br><span class="line"><span class="string">name=Red Hat Enterprise Linux 8.7.0 AppStream</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/AppStream</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure>

<p>Installing Operating System Packages.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -q --qf <span class="string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n&#x27;</span> \</span><br><span class="line">bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \</span><br><span class="line">glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \</span><br><span class="line">libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \</span><br><span class="line">libxcb libibverbs make smartmontools sysstat unzip xorg-x11-xauth</span><br></pre></td></tr></table></figure>

<h2 id="Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database"><a href="#Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database" class="headerlink" title="Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database"></a>Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database</h2><p>Create Oracle software owner user accounts on each cluster node</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd -g 54321 oinstall</span><br><span class="line">groupadd -g 54322 dba</span><br><span class="line">groupadd -g 54323 oper</span><br><span class="line">groupadd -g 54324 backupdba</span><br><span class="line">groupadd -g 54325 dgdba</span><br><span class="line">groupadd -g 54326 kmdba</span><br><span class="line">groupadd -g 54327 asmdba</span><br><span class="line">groupadd -g 54328 asmoper</span><br><span class="line">groupadd -g 54329 asmadmin</span><br><span class="line">groupadd -g 54330 racdba</span><br><span class="line">useradd -c <span class="string">&quot;oracle software owner&quot;</span> -u 54321 -g oinstall -G dba,oper,backupdba,dgdba,kmdba,asmdba,racdba oracle</span><br><span class="line">useradd -c <span class="string">&quot;grid software owner&quot;</span> -u 54331 -g oinstall -G dba,asmdba,asmoper,asmadmin,racdba grid</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;oracle&quot;</span> | passwd --stdin oracle </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;grid&quot;</span> | passwd --stdin grid</span><br></pre></td></tr></table></figure>

<p>Create Grid home and Oracle home directories on each cluster node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /u01/app/19.0.0/grid</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/grid</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/oracle/product/19.0.0/dbhome_1</span><br><span class="line"><span class="built_in">chown</span> -R grid:oinstall /u01</span><br><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /u01/app/oracle</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /u01</span><br></pre></td></tr></table></figure>

<p>Configure Oracle Software owner user account environment on each cluster node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="comment"># The following is add for Oracle 19c</span></span><br><span class="line"><span class="built_in">umask</span> 022</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=coco1</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/19.0.0/dbhome_1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib</span><br><span class="line"><span class="comment"># alias sqlplus=&#x27;rlwrap sqlplus&#x27;</span></span><br><span class="line"><span class="comment"># alias rman=&#x27;rlwrap rman&#x27;</span></span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /home/grid/.bash_profile &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="comment"># The following is add for Oracle 19c</span></span><br><span class="line"><span class="built_in">umask</span> 022</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=+ASM1</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/grid</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=/u01/app/19.0.0/grid</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib</span><br><span class="line"><span class="comment"># alias sqlplus=&#x27;rlwrap sqlplus&#x27;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-SSH-Manually-on-All-Cluster-Nodes"><a href="#Configuring-SSH-Manually-on-All-Cluster-Nodes" class="headerlink" title="Configuring SSH Manually on All Cluster Nodes"></a>Configuring SSH Manually on All Cluster Nodes</h3><h4 id="Create-SSH-Directory-and-Create-SSH-Keys-On-Each-Node"><a href="#Create-SSH-Directory-and-Create-SSH-Keys-On-Each-Node" class="headerlink" title="Create SSH Directory and Create SSH Keys On Each Node"></a>Create SSH Directory and Create SSH Keys On Each Node</h4><ol>
<li><p>Logged in as <code>grid</code>, create the .ssh directory in the grid user’s home directory, and set permissions on it to ensure that only the oracle user has read and write permissions:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 700 ~/.ssh</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create <code>RSA</code> or <code>DSA</code> key:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>

<p>At the prompts, accept the default location for the key file (press <strong>Enter</strong>).</p>
</li>
<li><p>Repeat the steps 1 through 2 on each node that you intend to make a member of the cluster, using the DSA key.</p>
</li>
</ol>
<h4 id="Add-All-Keys-to-a-Common-authorized-keys-File"><a href="#Add-All-Keys-to-a-Common-authorized-keys-File" class="headerlink" title="Add All Keys to a Common authorized_keys File"></a>Add All Keys to a Common authorized_keys File</h4><p>To configure SSH, copy all the generated keys on all cluster node members into an authorized keys file that is identical on each node.<br>On the local node, add the DSA key to the authorized_keys file, then copy the authorized_keys file to the user .ssh directory on a remote node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line"><span class="built_in">cat</span> id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line">scp authorized_keys oracle19crac02:~/.ssh/</span><br><span class="line">scp authorized_keys oracle19crac03:~/.ssh/</span><br></pre></td></tr></table></figure>

<p>Repeat from each node to each other member node in the cluster.</p>
<h4 id="Enabling-SSH-User-Equivalency-on-Cluster-Nodes"><a href="#Enabling-SSH-User-Equivalency-on-Cluster-Nodes" class="headerlink" title="Enabling SSH User Equivalency on Cluster Nodes"></a>Enabling SSH User Equivalency on Cluster Nodes</h4><p>On the system where you want to run OUI, log in as the <code>grid</code> user.<br>If you have configured SSH correctly, then you can now use the ssh or scp commands <strong>without</strong> being prompted for a password. For example:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@oracle19crac01 ~]$ ssh oracle19crac02 <span class="built_in">date</span></span><br><span class="line">Wed May 10 11:02:23 CST 2023</span><br><span class="line">[grid@oracle19crac01 ~]$ ssh oracle19crac03 <span class="built_in">date</span></span><br><span class="line">Wed May 10 11:02:27 CST 2023</span><br></pre></td></tr></table></figure>

<p>Repeat from each node to each other member node in the cluster.<br>If any node prompts for a password, then verify that the <code>~/.ssh/authorized_keys</code> file on that node contains the correct public keys, and that you have created an Oracle software owner with identical group membership and IDs.</p>
<h3 id="Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB"><a href="#Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB" class="headerlink" title="Configuring Storage Device Path Persistence Using Oracle ASMLIB"></a>Configuring Storage Device Path Persistence Using Oracle ASMLIB</h3><div class="note info modern"><p>If you configure disks using Oracle ASMLIB, then you must change the disk discovery string to <strong>ORCL:</strong><em>. If the diskstring is set to ORCL:</em>, or is left empty (“”), then the installer discovers these disks.</p>
</div>

<h4 id="Installing-and-Configuring-Oracle-ASMLIB-Software"><a href="#Installing-and-Configuring-Oracle-ASMLIB-Software" class="headerlink" title="Installing and Configuring Oracle ASMLIB Software"></a>Installing and Configuring Oracle ASMLIB Software</h4><p>To install and configure the Oracle Automatic Storage Management library driver software manually, perform the following steps:</p>
<ol>
<li><p>Depending on your operating system version, download the required Oracle Automatic Storage Management library driver packages and driver:</p>
<p><a href="https://support.oracle.com/knowledge/Oracle%20Linux%20and%20Virtualization/1089399_1.html">Oracle ASMLib Software Update and Support Policy (Doc ID 1089399.1)</a></p>
<p><a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html">http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html</a></p>
</li>
<li><p>Install the oracleasmlib and oracleasm-support packages for all Oracle ASMLIB installations.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dnf -y install kmod-redhat-oracleasm</span><br><span class="line">rpm -ivh oracleasmlib-2.0.17-1.el8.x86_64.rpm</span><br><span class="line">rpm -ivh oracleasm-support-2.1.12-1.el8.x86_64.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run the oracleasm initialization script with the configure option:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac01 soft]<span class="comment"># /usr/sbin/oracleasm configure -i</span></span><br><span class="line">Configuring the Oracle ASM library driver.</span><br><span class="line"></span><br><span class="line">This will configure the on-boot properties of the Oracle ASM library</span><br><span class="line">driver.  The following questions will determine whether the driver is</span><br><span class="line">loaded on boot and what permissions it will have.  The current values</span><br><span class="line">will be shown <span class="keyword">in</span> brackets (<span class="string">&#x27;[]&#x27;</span>).  Hitting &lt;ENTER&gt; without typing an</span><br><span class="line">answer will keep that current value.  Ctrl-C will abort.</span><br><span class="line"></span><br><span class="line">Default user to own the driver interface []: grid</span><br><span class="line">Default group to own the driver interface []: asmadmin</span><br><span class="line">Start Oracle ASM library driver on boot (y/n) [n]: y</span><br><span class="line">Scan <span class="keyword">for</span> Oracle ASM disks on boot (y/n) [y]: y</span><br><span class="line">Writing Oracle ASM library driver configuration: <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Load the oracleasm kernel module:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac01 soft]<span class="comment"># /usr/sbin/oracleasm init</span></span><br><span class="line">Creating /dev/oracleasm mount point: /dev/oracleasm</span><br><span class="line">Loading module <span class="string">&quot;oracleasm&quot;</span>: oracleasm</span><br><span class="line">Configuring <span class="string">&quot;oracleasm&quot;</span> to use device physical block size</span><br><span class="line">Mounting ASMlib driver filesystem: /dev/oracleasm</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="Configuring-Disk-Devices-to-Use-Oracle-ASMLIB"><a href="#Configuring-Disk-Devices-to-Use-Oracle-ASMLIB" class="headerlink" title="Configuring Disk Devices to Use Oracle ASMLIB"></a>Configuring Disk Devices to Use Oracle ASMLIB</h4><ol>
<li><p>Use either <code>fdisk</code> or <code>parted</code> to create a single whole-disk partition on the disk devices, only on local node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>Mark a disk as an Oracle Automatic Storage Management disk, only on local node:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/sbin/oracleasm createdisk OCR01 /dev/sdb1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>To make the disk available on the other nodes in the cluster, enter the following command as root on each node:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac02 soft]<span class="comment"># oracleasm scandisks</span></span><br><span class="line">Reloading disk partitions: <span class="keyword">done</span></span><br><span class="line">Cleaning any stale ASM disks...</span><br><span class="line">Scanning system <span class="keyword">for</span> ASM disks...</span><br><span class="line">Instantiating disk <span class="string">&quot;OCR01&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;OCR02&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;DATA01&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;MGMT01&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;OCR03&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;ARCH01&quot;</span></span><br><span class="line">[root@oracle19crac02 soft]<span class="comment"># oracleasm listdisks</span></span><br><span class="line">ARCH01</span><br><span class="line">DATA01</span><br><span class="line">MGMT01</span><br><span class="line">OCR01</span><br><span class="line">OCR02</span><br><span class="line">OCR03</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Configuring-Kernel-Parameters-for-Linux"><a href="#Configuring-Kernel-Parameters-for-Linux" class="headerlink" title="Configuring Kernel Parameters for Linux"></a>Configuring Kernel Parameters for Linux</h3><p>Create or edit the <code>/etc/sysctl.d/97-oracle-database-sysctl.conf</code> file, and add or edit lines similar to:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/97-oracle-database-sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">fs.file-max = 6815744</span></span><br><span class="line"><span class="string">kernel.sem = 250 32000 100 128</span></span><br><span class="line"><span class="string">kernel.shmmni = 4096</span></span><br><span class="line"><span class="string">kernel.shmall = 1835008</span></span><br><span class="line"><span class="string">kernel.shmmax = 6442450944</span></span><br><span class="line"><span class="string">kernel.panic_on_oops = 1</span></span><br><span class="line"><span class="string">net.core.rmem_default = 262144</span></span><br><span class="line"><span class="string">net.core.rmem_max = 4194304</span></span><br><span class="line"><span class="string">net.core.wmem_default = 262144</span></span><br><span class="line"><span class="string">net.core.wmem_max = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 2</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 2</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 9000 65500</span></span><br><span class="line"><span class="string">vm.nr_hugepages = 3584</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Resource-Limits-for-Oracle-Software-Installation-Users"><a href="#Configuring-Resource-Limits-for-Oracle-Software-Installation-Users" class="headerlink" title="Configuring Resource Limits for Oracle Software Installation Users"></a>Configuring Resource Limits for Oracle Software Installation Users</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/security/limits.d/oracle-database-limits.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">grid   soft   nofile    1024</span></span><br><span class="line"><span class="string">grid   hard   nofile    65536</span></span><br><span class="line"><span class="string">grid   soft   nproc    2047</span></span><br><span class="line"><span class="string">grid   hard   nproc    16384</span></span><br><span class="line"><span class="string">grid   soft   stack    10240</span></span><br><span class="line"><span class="string">grid   hard   stack    32768</span></span><br><span class="line"><span class="string">grid   hard   memlock    10869992</span></span><br><span class="line"><span class="string">grid   soft   memlock    10869992</span></span><br><span class="line"><span class="string">oracle   soft   nofile    1024</span></span><br><span class="line"><span class="string">oracle   hard   nofile    65536</span></span><br><span class="line"><span class="string">oracle   soft   nproc    2047</span></span><br><span class="line"><span class="string">oracle   hard   nproc    16384</span></span><br><span class="line"><span class="string">oracle   soft   stack    10240</span></span><br><span class="line"><span class="string">oracle   hard   stack    32768</span></span><br><span class="line"><span class="string">oracle   hard   memlock    10869992</span></span><br><span class="line"><span class="string">oracle   soft   memlock    10869992</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><ol>
<li><p>Download and change the Oracle Grid Infrastructure image files permissions.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R grid:oinstall /soft/LINUX.X64_193000_grid_home.zip</span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>grid</code> user, extract the files into the Grid home.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip -q /soft/LINUX.X64_193000_grid_home.zip -d <span class="variable">$GRID_HOME</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>root</code> user, installing the cvuqdisk RPM on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CVUQDISK_GRP=oinstall; <span class="built_in">export</span> CVUQDISK_GRP</span><br><span class="line">rpm -ivh /u01/app/19.0.0/grid/cv/rpm/cvuqdisk-1.0.10-1.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>grid</code> user, verify that all of the cluster nodes meet the installation requirements:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$GRID_HOME</span>/runcluvfy.sh stage -pre crsinst -n oracle19crac01,oracle19crac02,oracle19crac03</span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>grid</code> user, run installer script.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$GRID_HOME</span>/gridSetup.sh</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><ol>
<li><p>Download and change the Oracle Database image files permissions.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /soft/LINUX.X64_193000_db_home.zip</span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>oracle</code> user, extract the files into the Oracle home.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip -q /soft/LINUX.X64_193000_db_home.zip -d <span class="variable">$ORACLE_HOME</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>oracle</code> user, run installer.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/runInstaller</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Patch-34130714-GI-Release-Update-19-16-0-0-220719"><a href="#Patch-34130714-GI-Release-Update-19-16-0-0-220719" class="headerlink" title="Patch 34130714 - GI Release Update 19.16.0.0.220719"></a>Patch 34130714 - GI Release Update 19.16.0.0.220719</h2><ul>
<li><a href="/blog/posts/c3410626.html">Patch 34130714_190000</a></li>
</ul>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 19c</title>
    <url>/blog/posts/11dd2bb7.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-19c"><a href="#Install-Oracle-19c" class="headerlink" title="Install Oracle 19c"></a>Install Oracle 19c</h1><blockquote>
<p>Operation System: RedHat 8.7.0 x86_64<br>Database Software: LINUX.X64_193000_db_home.zip</p>
</blockquote>
<h2 id="Oracle-Oracle-Single-Instance-Requirements"><a href="#Oracle-Oracle-Single-Instance-Requirements" class="headerlink" title="Oracle Oracle Single Instance Requirements"></a>Oracle Oracle Single Instance Requirements</h2><h2 id="Configuring-Operating-Systems-for-Oracle-Single-Instance"><a href="#Configuring-Operating-Systems-for-Oracle-Single-Instance" class="headerlink" title="Configuring Operating Systems for Oracle Single Instance"></a>Configuring Operating Systems for Oracle Single Instance</h2><p>Disabling Firewall and SElinux.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> firewalld --now</span><br><span class="line">sed -i <span class="string">&#x27;/SELINUX=/&#123;s/enforcing/disabled/&#125;&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>

<p>Disabling Zero Configuration Network.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> -p /etc/sysconfig/network&#123;,.bak.`<span class="built_in">date</span> +%m%d`&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;NOZEROCONF=yes&quot;</span> &gt;&gt; /etc/sysconfig/network</span><br></pre></td></tr></table></figure>

<p>Disabling Transparent Huagepages.</p>
<ul>
<li><a href="http://localhost:4000/blog/posts/49294.html">How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</a></li>
</ul>
<p>Configuring Public, Private, Virtual and SCAN IP names and Addresses.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># The following is add for Oracle 19c</span></span><br><span class="line"><span class="string">192.168.3.108   oracle19cdg</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>Setting Yum Repository.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount /dev/sr0 /mnt</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/media.repo &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[InstallMedia_BaseOS]</span></span><br><span class="line"><span class="string">name=Red Hat Enterprise Linux 8.7.0 BaseOS</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/BaseOS</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[InstallMedia_AppStream]</span></span><br><span class="line"><span class="string">name=Red Hat Enterprise Linux 8.7.0 AppStream</span></span><br><span class="line"><span class="string">baseurl=file:///mnt/AppStream</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br></pre></td></tr></table></figure>

<p>Installing Operating System Packages.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -q --qf <span class="string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n&#x27;</span> \</span><br><span class="line">bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \</span><br><span class="line">glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \</span><br><span class="line">libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \</span><br><span class="line">libxcb libibverbs make smartmontools sysstat unzip xorg-x11-xauth</span><br></pre></td></tr></table></figure>

<h2 id="Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database"><a href="#Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database" class="headerlink" title="Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database"></a>Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database</h2><p>Create Oracle software owner user accounts on each cluster node</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd -g 54321 oinstall</span><br><span class="line">groupadd -g 54322 dba</span><br><span class="line">groupadd -g 54323 oper</span><br><span class="line">groupadd -g 54324 backupdba</span><br><span class="line">groupadd -g 54325 dgdba</span><br><span class="line">groupadd -g 54326 kmdba</span><br><span class="line">groupadd -g 54330 racdba</span><br><span class="line">useradd -c <span class="string">&quot;oracle software owner&quot;</span> -u 54321 -g oinstall -G dba,oper,backupdba,dgdba,kmdba,racdba oracle</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;oracle&quot;</span> | passwd --stdin oracle </span><br></pre></td></tr></table></figure>

<p>Create Grid home and Oracle home directories on each cluster node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /u01/app/oracle/product/19.0.0/dbhome_1</span><br><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /u01</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /u01</span><br></pre></td></tr></table></figure>

<p>Configure Oracle Software owner user account environment on each cluster node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="comment"># The following is add for Oracle 19c</span></span><br><span class="line"><span class="built_in">umask</span> 022</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=coco1</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/19.0.0/dbhome_1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib</span><br><span class="line"><span class="comment"># alias sqlplus=&#x27;rlwrap sqlplus&#x27;</span></span><br><span class="line"><span class="comment"># alias rman=&#x27;rlwrap rman&#x27;</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-Kernel-Parameters-for-Linux"><a href="#Configuring-Kernel-Parameters-for-Linux" class="headerlink" title="Configuring Kernel Parameters for Linux"></a>Configuring Kernel Parameters for Linux</h3><p>Create or edit the <code>/etc/sysctl.d/97-oracle-database-sysctl.conf</code> file, and add or edit lines similar to:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/97-oracle-database-sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">fs.file-max = 6815744</span></span><br><span class="line"><span class="string">kernel.sem = 250 32000 100 128</span></span><br><span class="line"><span class="string">kernel.shmmni = 4096</span></span><br><span class="line"><span class="string">kernel.shmall = 1835008</span></span><br><span class="line"><span class="string">kernel.shmmax = 6442450944</span></span><br><span class="line"><span class="string">kernel.panic_on_oops = 1</span></span><br><span class="line"><span class="string">net.core.rmem_default = 262144</span></span><br><span class="line"><span class="string">net.core.rmem_max = 4194304</span></span><br><span class="line"><span class="string">net.core.wmem_default = 262144</span></span><br><span class="line"><span class="string">net.core.wmem_max = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.conf.all.rp_filter = 2</span></span><br><span class="line"><span class="string">net.ipv4.conf.default.rp_filter = 2</span></span><br><span class="line"><span class="string">fs.aio-max-nr = 1048576</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range = 9000 65500</span></span><br><span class="line"><span class="string">vm.nr_hugepages = 3584</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h3 id="Configuring-Resource-Limits-for-Oracle-Software-Installation-Users"><a href="#Configuring-Resource-Limits-for-Oracle-Software-Installation-Users" class="headerlink" title="Configuring Resource Limits for Oracle Software Installation Users"></a>Configuring Resource Limits for Oracle Software Installation Users</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/security/limits.d/oracle-database-limits.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">oracle   soft   nofile    1024</span></span><br><span class="line"><span class="string">oracle   hard   nofile    65536</span></span><br><span class="line"><span class="string">oracle   soft   nproc    2047</span></span><br><span class="line"><span class="string">oracle   hard   nproc    16384</span></span><br><span class="line"><span class="string">oracle   soft   stack    10240</span></span><br><span class="line"><span class="string">oracle   hard   stack    32768</span></span><br><span class="line"><span class="string">oracle   hard   memlock    10869992</span></span><br><span class="line"><span class="string">oracle   soft   memlock    10869992</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><ol>
<li><p>Download and change the Oracle Database image files permissions.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /soft/LINUX.X64_193000_db_home.zip</span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>oracle</code> user, extract the files into the Grid home.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip -q /soft/LINUX.X64_193000_db_home.zip -d <span class="variable">$ORACLE_HOME</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Log in as the <code>oracle</code> user, Run installer.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/runInstaller</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Patch-34133642-Database-Release-Update-19-16-0-0-220719"><a href="#Patch-34133642-Database-Release-Update-19-16-0-0-220719" class="headerlink" title="Patch 34133642 - Database Release Update 19.16.0.0.220719"></a>Patch 34133642 - Database Release Update 19.16.0.0.220719</h2><ul>
<li><a href="/blog/posts/4422928f.html">Patch 34133642_190000</a></li>
</ul>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 9i</title>
    <url>/blog/posts/fdf22d0b.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-9i"><a href="#Install-Oracle-9i" class="headerlink" title="Install Oracle 9i"></a>Install Oracle 9i</h1><blockquote>
<p>Operation System: Red Hat Enterprise Linux AS release 4 (Nahant Update 8) Linux 2.6.9-89.ELsmp<br>Database Software: amd64_db_9204_Disk{1..3}.cpio.gz<br>Database Patches: p4547809_92080_Linux-x86-64.zip</p>
</blockquote>
<h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Checking Package Requirements</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -q --qf <span class="string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125; (%&#123;ARCH&#125;)\n&#x27;</span> \binutils compat-db compat-libstdc++-296 \</span><br><span class="line">control-center gcc gcc-c++ glibc glibc-common gnome-libs libstdc++ libstdc++-devel make pdksh \</span><br><span class="line">setarch glibc glibc-devel libaio compat-gcc-32 compat-gcc-32-c++- glibc-devel.i386</span><br></pre></td></tr></table></figure>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Creating Oracle User Accounts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd dba</span><br><span class="line">groupadd oinstall</span><br><span class="line">useradd -c <span class="string">&quot;Oracle software owner&quot;</span> -g oinstall -G dba oracle</span><br><span class="line"><span class="built_in">echo</span> oracle | passwd --stdin oracle</span><br></pre></td></tr></table></figure>

<p><strong>Creating Oracle Directories</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /u01/app/oracle/product/9.2.0</span><br><span class="line"><span class="built_in">chown</span> -R oracle.oinstall /u01</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /u01</span><br></pre></td></tr></table></figure>

<p><strong>Setting Oracle Environment Variables</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment"># The following is add for Oracle 9i</span></span><br><span class="line"><span class="comment"># export LD_ASSUME_KERNEL=2.4.1    # for Red Hat Enterprise Linux 3</span></span><br><span class="line"><span class="built_in">export</span> LD_ASSUME_KERNEL=2.4.19   <span class="comment"># for Red Hat Enterprise Linux 4</span></span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/9.2.0</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=orcl</span><br><span class="line"><span class="built_in">export</span> ORACLE_TERM=xterm</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN;</span><br><span class="line"><span class="built_in">export</span> ORA_NLS33=<span class="variable">$ORACLE_HOME</span>/ocommon/nls/admin/data</span><br><span class="line">LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line">LD_LIBRARY_PATH=<span class="variable">$LD_LIBRARY_PATH</span>:/usr/local/lib</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ORACLE_HOME</span>/bin</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Setting kernel parameters</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># The following is add for Oracle 9i</span></span><br><span class="line"><span class="string">kernel.sem=250 32000 100 128</span></span><br><span class="line"><span class="string">kernel.shmmax=4294967295</span></span><br><span class="line"><span class="string">kernel.shmmni=128</span></span><br><span class="line"><span class="string">kernel.shmall=2097152</span></span><br><span class="line"><span class="string">kernel.msgmnb=65536</span></span><br><span class="line"><span class="string">kernel.msgmni=2878</span></span><br><span class="line"><span class="string">fs.file-max=65536</span></span><br><span class="line"><span class="string">net.ipv4.ip_local_port_range=1024 65000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<p><strong>Setting shell limits</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># The following is add for Oracle 9i</span></span><br><span class="line"><span class="string">oracle  soft    nofile  65536</span></span><br><span class="line"><span class="string">oracle  hard    nofile  65536</span></span><br><span class="line"><span class="string">oracle  soft    nproc   16384</span></span><br><span class="line"><span class="string">oracle  hard    nproc   16384</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="Unpacking-the-Installation-Files-and-starting-runInstaller"><a href="#Unpacking-the-Installation-Files-and-starting-runInstaller" class="headerlink" title="Unpacking the Installation Files and starting runInstaller"></a>Unpacking the Installation Files and starting runInstaller</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R oracle.dba /soft</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /soft</span><br><span class="line"></span><br><span class="line"><span class="comment"># login as oracle user</span></span><br><span class="line"><span class="built_in">cd</span> /soft</span><br><span class="line">zcat amd64_db_9204_Disk1.cpio.gz | cpio -idmv</span><br><span class="line">zcat amd64_db_9204_Disk2.cpio.gz | cpio -idmv</span><br><span class="line">zcat amd64_db_9204_Disk3.cpio.gz | cpio -idmv</span><br><span class="line">Disk1/runInstaller</span><br></pre></td></tr></table></figure>

<p>Use <code>netca</code> create a listener, <code>dbca</code> create a instance.</p>
<h2 id="Patching-Oracle-9i-to-9-2-0-8-0"><a href="#Patching-Oracle-9i-to-9-2-0-8-0" class="headerlink" title="Patching Oracle 9i to 9.2.0.8.0"></a>Patching Oracle 9i to 9.2.0.8.0</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /soft</span><br><span class="line">unzip p4547809_92080_Linux-x86-64.zip -d p4547809</span><br><span class="line">p4547809/Disk1/runInstaller</span><br></pre></td></tr></table></figure>

<h2 id="Oracle-Post-Installation-Tasks"><a href="#Oracle-Post-Installation-Tasks" class="headerlink" title="Oracle Post Installation Tasks"></a>Oracle Post Installation Tasks</h2><p><strong>Setting automatic startup</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;/orcl/s/:N/:Y/&#x27;</span> /etc/oratab</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/rc.local &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"># The following is add for Oracle 9i</span></span><br><span class="line"><span class="string">su - oracle -c &quot;lsnrctl start&quot;</span></span><br><span class="line"><span class="string">su - oracle -c &quot;dbstart&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="Oracle-Installation-Errors"><a href="#Oracle-Installation-Errors" class="headerlink" title="Oracle Installation Errors"></a>Oracle Installation Errors</h2><p>[Error in invoking target install of makefile ins_sqlplus.mk].{red}.<br>You may see the following errors in <code>$ORACLE_HOME/install/make.log</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/bin/ld: crt1.o: No such file: No such file or directory</span><br><span class="line">collect2: ld returned 1 exit status</span><br><span class="line">make[1]: *** [installisqlplus32] Error 1</span><br><span class="line">make[1]: Leaving directory `/u01/app/oracle/product/9.2.0/sqlplus/lib&#x27;</span><br><span class="line">make: *** [isqlplus] Error 2</span><br></pre></td></tr></table></figure>

<p>glibc-devel.i386 (32 bit) missing on this system and degrade gcc version to 3.2.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh glibc-devel-2.3.4-2.43.i386.rpm</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> /usr/bin/gcc /usr/bin/gcc34</span><br><span class="line"><span class="built_in">mv</span> /usr/bin/g++ /usr/bin/g++34</span><br><span class="line"><span class="built_in">ln</span> -s /usr/bin/gcc32 /usr/bin/gcc</span><br><span class="line"><span class="built_in">ln</span> -s /usr/bin/g++32 /usr/bin/g++</span><br></pre></td></tr></table></figure>

<p>After that hit <strong>[Retry]</strong> in the error pop-up.</p>
<h1 id="Deinstall-Oracle-9i"><a href="#Deinstall-Oracle-9i" class="headerlink" title="Deinstall Oracle 9i"></a>Deinstall Oracle 9i</h1>   <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -f /etc/oraInst.loc</span><br><span class="line"><span class="built_in">rm</span> -f /etc/oratab</span><br><span class="line"><span class="built_in">rm</span> -f /usr/local/bin/dbhome</span><br><span class="line"><span class="built_in">rm</span> -f /usr/local/bin/oraenv</span><br><span class="line"><span class="built_in">rm</span> -f /usr/local/bin/coraenv</span><br><span class="line"><span class="built_in">rm</span> -rf /u01</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle-database-preinstall-11g-rpm</title>
    <url>/blog/posts/fba8cafc.html</url>
    <content><![CDATA[<h1 id="Oracle-database-preinstall-11g-rpm"><a href="#Oracle-database-preinstall-11g-rpm" class="headerlink" title="Oracle-database-preinstall-11g-rpm"></a>Oracle-database-preinstall-11g-rpm</h1><h2 id="Installing-the-Oracle-Preinstallation-RPM"><a href="#Installing-the-Oracle-Preinstallation-RPM" class="headerlink" title="Installing the Oracle Preinstallation RPM"></a>Installing the Oracle Preinstallation RPM</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac-1 ~]<span class="comment"># yum -y install oracle-rdbms-server-11gR2-preinstall.x86_64</span></span><br><span class="line">[root@rac-1 ~]<span class="comment"># cat /var/log/oracle-rdbms-server-11gR2-preinstall/results/orakernel.log</span></span><br><span class="line">Adding group oinstall with gid 54321</span><br><span class="line">Adding group dba</span><br><span class="line">Adding user oracle with user <span class="built_in">id</span> 54321, initial login group oinstall, supplementary group dba and  home directory /home/oracle</span><br><span class="line">Changing ownership of /home/oracle to oracle:oinstall</span><br><span class="line">Please <span class="built_in">set</span> password <span class="keyword">for</span> oracle user</span><br><span class="line">uid=54321(oracle) gid=54321(oinstall) <span class="built_in">groups</span>=54321(oinstall),54322(dba)</span><br><span class="line">Creating oracle user passed</span><br><span class="line"></span><br><span class="line">Saving a copy of the initial sysctl.conf</span><br><span class="line">Verifying  kernel parameters as per Oracle recommendations...</span><br><span class="line">Adding fs.file-max = 6815744</span><br><span class="line">Adding kernel.sem = 250 32000 100 128</span><br><span class="line">Adding kernel.shmmni = 4096</span><br><span class="line">Adding kernel.shmall = 1073741824</span><br><span class="line">Adding kernel.shmmax = 4398046511104</span><br><span class="line">Adding kernel.panic_on_oops = 1</span><br><span class="line">Adding net.core.rmem_default = 262144</span><br><span class="line">Adding net.core.rmem_max = 4194304</span><br><span class="line">Adding net.core.wmem_default = 262144</span><br><span class="line">Adding net.core.wmem_max = 1048576</span><br><span class="line">Adding net.ipv4.conf.all.rp_filter = 2</span><br><span class="line">Adding net.ipv4.conf.default.rp_filter = 2</span><br><span class="line">Adding fs.aio-max-nr = 1048576</span><br><span class="line">Adding net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">Setting kernel parameters as per oracle recommendations...</span><br><span class="line">Altered file /etc/sysctl.conf</span><br><span class="line">Saved a copy of the current file <span class="keyword">in</span> /etc/sysctl.d/99-oracle-rdbms-server-11gR2-preinstall-sysctl.conf</span><br><span class="line">Check /etc/sysctl.d <span class="keyword">for</span> backups</span><br><span class="line">Verifying &amp; setting of kernel parameters passed</span><br><span class="line"></span><br><span class="line">Setting user limits using /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">Verifying oracle user OS limits as per Oracle recommendations...</span><br><span class="line">Adding oracle soft nofile  1024</span><br><span class="line">Adding oracle hard nofile  65536</span><br><span class="line">Adding oracle soft <span class="built_in">nproc</span>  16384</span><br><span class="line">Adding oracle hard <span class="built_in">nproc</span>  16384</span><br><span class="line">Adding oracle soft stack  10240</span><br><span class="line">Adding oracle hard stack  32768</span><br><span class="line">Adding oracle hard memlock  134217728</span><br><span class="line">Adding oracle soft memlock  134217728</span><br><span class="line">Setting oracle user OS limits as per Oracle recommendations...</span><br><span class="line">Altered file /etc/security/limits.conf</span><br><span class="line">Original file backed up at /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00</span><br><span class="line">Verifying &amp; setting of user limits passed</span><br><span class="line"></span><br><span class="line">Saving a copy of /etc/default/grub file <span class="keyword">in</span> /etc/default/grub-initial.orabackup</span><br><span class="line">Saving a copy of /etc/default/grub <span class="keyword">in</span> /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00...</span><br><span class="line">Verifying kernel boot parameters as per Oracle recommendations...</span><br><span class="line">old boot params: <span class="string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet&quot;</span></span><br><span class="line">new boot params: <span class="string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span></span><br><span class="line"></span><br><span class="line">old boot params: <span class="string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span></span><br><span class="line">new boot params: <span class="string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never&quot;</span></span><br><span class="line"></span><br><span class="line">Setting kernel boot parameters as per Oracle recommendations...</span><br><span class="line">G_DIR=/boot/grub2</span><br><span class="line">Default kernel is -&gt;  5.4.17-2011.6.2.el7uek.x86_64</span><br><span class="line">Default saved_entry is -&gt; Oracle Linux Server (5.4.17-2011.6.2.el7uek.x86_64 with Unbreakable Enterprise Kernel) 7.9</span><br><span class="line">Default saved_entry_line is -&gt;  linux16 /vmlinuz-5.4.17-2011.6.2.el7uek.x86_64</span><br><span class="line">Saving a copy of grubenv... <span class="keyword">in</span> /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15821: /usr/sbin/grub2-probe</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15821: /usr/sbin/grub2-probe</span><br><span class="line">Found linux image: /boot/vmlinuz-5.4.17-2011.6.2.el7uek.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-5.4.17-2011.6.2.el7uek.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.0-1160.el7.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.0-1160.el7.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-0-rescue-1d1dab430dc147b6bd12cb0ed4a8e0cb</span><br><span class="line">Found initrd image: /boot/initramfs-0-rescue-1d1dab430dc147b6bd12cb0ed4a8e0cb.img</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 16117: /usr/sbin/grub2-probe</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 16117: /usr/sbin/grub2-probe</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">The saved kernel 5.4.17-2011.6.2.el7uek.x86_64 is now at position - 0</span><br><span class="line">Boot parameters will be effected on next reboot</span><br><span class="line">Altered file /etc/default/grub</span><br><span class="line">Copy of the changed file is <span class="keyword">in</span> - /etc/default/grub-oracle-rdbms-server-11gR2-preinstall.orabackup</span><br><span class="line">Copy of the original file is <span class="keyword">in</span> - /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00</span><br><span class="line">Verifying &amp; setting of boot parameters passed</span><br><span class="line"></span><br><span class="line">Trying to add NOZEROCONF parameter...</span><br><span class="line">Taking a backup of existing file to /etc/sysconfig/network.orabackup</span><br><span class="line">Successfully added parameter NOZEROCONF to /etc/sysconfig/network</span><br><span class="line">Setting /etc/sysconfig/network parameters passed</span><br><span class="line"></span><br><span class="line">Disabling Transparent Hugepages.</span><br><span class="line">Refer Oracle Note:1557478.1</span><br><span class="line"></span><br><span class="line">Disabling defrag.</span><br><span class="line">Refer Oracle Note:1557478.1</span><br><span class="line"></span><br><span class="line">Taking a backup of old config files under /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00</span><br></pre></td></tr></table></figure>

<h2 id="Creating-Owner-User"><a href="#Creating-Owner-User" class="headerlink" title="Creating Owner User"></a>Creating Owner User</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">groupadd -g 1000 oinstall</span><br><span class="line">groupadd -g 1200 asmadmin</span><br><span class="line">groupadd -g 1201 asmdba</span><br><span class="line">groupadd -g 1202 asmoper</span><br><span class="line">groupadd -g 1300 dba</span><br><span class="line">groupadd -g 1301 oper</span><br><span class="line">useradd -u 1100 -g oinstall -G asmadmin,asmdba,asmoper grid</span><br><span class="line">useradd -u 1101 -g oinstall -G dba,oper,asmdba oracle</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;oracle&quot;</span> | passwd --stdin oracle </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;grid&quot;</span> | passwd --stdin grid</span><br></pre></td></tr></table></figure>

<h2 id="Creating-the-Oracle-Home-and-Oracle-Base-Directory"><a href="#Creating-the-Oracle-Home-and-Oracle-Base-Directory" class="headerlink" title="Creating the Oracle Home and Oracle Base Directory"></a>Creating the Oracle Home and Oracle Base Directory</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /u01/app/11.2.0/grid</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/grid</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/oraInventory</span><br><span class="line"><span class="built_in">mkdir</span> -p /u01/app/oracle/product/11.2.0/db_1</span><br><span class="line"><span class="built_in">chown</span> -R grid:oinstall /u01</span><br><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /u01/app/oracle</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /u01/</span><br></pre></td></tr></table></figure>

<h2 id="Configuring-Owner-User-Environments"><a href="#Configuring-Owner-User-Environments" class="headerlink" title="Configuring Owner User Environments"></a>Configuring Owner User Environments</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt;/home/oracle/.bash_profile &lt;&lt;<span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=coco1</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/db_1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib</span><br><span class="line"><span class="built_in">alias</span> sqlplus=<span class="string">&#x27;rlwrap sqlplus&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> rman=<span class="string">&#x27;rlwrap rman&#x27;</span></span><br><span class="line">EOF</span><br><span class="line">su - oracle -c <span class="string">&#x27;source ~/.bash_profile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt;/home/grid/.bash_profile &lt;&lt;<span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=+ASM1</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/grid</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=/u01/app/11.2.0/grid</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib</span><br><span class="line"><span class="built_in">alias</span> sqlplus=<span class="string">&#x27;rlwrap sqlplus&#x27;</span></span><br><span class="line">EOF</span><br><span class="line">su - grid -c <span class="string">&#x27;source ~/.bash_profile&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Checking-Resource-Limits"><a href="#Checking-Resource-Limits" class="headerlink" title="Checking Resource Limits"></a>Checking Resource Limits</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac-1 ~]<span class="comment"># grep ^oracle /etc/security/limits.conf | sed &#x27;s/oracle/grid/&#x27; &gt;&gt; /etc/security/limits.conf</span></span><br><span class="line">[root@rac-1 ~]<span class="comment"># grep -E &#x27;^oracle|^grid&#x27; /etc/security/limits.conf</span></span><br><span class="line">oracle   soft   nofile    1024</span><br><span class="line">oracle   hard   nofile    65536</span><br><span class="line">oracle   soft   <span class="built_in">nproc</span>    16384</span><br><span class="line">oracle   hard   <span class="built_in">nproc</span>    16384</span><br><span class="line">oracle   soft   stack    10240</span><br><span class="line">oracle   hard   stack    32768</span><br><span class="line">oracle   hard   memlock    134217728</span><br><span class="line">oracle   soft   memlock    134217728</span><br><span class="line">grid   soft   nofile    1024</span><br><span class="line">grid   hard   nofile    65536</span><br><span class="line">grid   soft   <span class="built_in">nproc</span>    16384</span><br><span class="line">grid   hard   <span class="built_in">nproc</span>    16384</span><br><span class="line">grid   soft   stack    10240</span><br><span class="line">grid   hard   stack    32768</span><br><span class="line">grid   hard   memlock    134217728</span><br><span class="line">grid   soft   memlock    134217728</span><br></pre></td></tr></table></figure>

<h2 id="Installing-the-cvuqdisk-RPM-for-Linux"><a href="#Installing-the-cvuqdisk-RPM-for-Linux" class="headerlink" title="Installing the cvuqdisk RPM for Linux"></a>Installing the cvuqdisk RPM for Linux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CVUQDISK_GRP=oinstall; <span class="built_in">export</span> CVUQDISK_GRP</span><br><span class="line">rpm -iv /soft/grid/rpm/cvuqdisk-1.0.9-1.rpm</span><br></pre></td></tr></table></figure>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip /soft/p13390677_112040_Linux-x86-64_3of7.zip</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /soft/grid</span><br><span class="line"><span class="built_in">chown</span> -R grid:oinstall /soft/grid</span><br><span class="line"></span><br><span class="line"><span class="comment"># login oracle user</span></span><br><span class="line"><span class="built_in">cd</span> /soft/grid</span><br><span class="line">./runInstaller</span><br></pre></td></tr></table></figure>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip p13390677_112040_Linux-x86-64_1of7.zip; unzip p13390677_112040_Linux-x86-64_2of7.zip</span><br><span class="line"><span class="built_in">chmod</span> -R 775 /soft/database</span><br><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /soft/database</span><br><span class="line"></span><br><span class="line"><span class="comment"># login oracle user</span></span><br><span class="line"><span class="built_in">cd</span> /soft/database</span><br><span class="line">./runInstaller</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle-database-preinstall-19c-rpm</title>
    <url>/blog/posts/341c84ed.html</url>
    <content><![CDATA[<h1 id="Oracle-database-preinstall-19c-rpm"><a href="#Oracle-database-preinstall-19c-rpm" class="headerlink" title="Oracle-database-preinstall-19c-rpm"></a>Oracle-database-preinstall-19c-rpm</h1><h2 id="Installing-the-Oracle-Preinstallation-RPM"><a href="#Installing-the-Oracle-Preinstallation-RPM" class="headerlink" title="Installing the Oracle Preinstallation RPM"></a>Installing the Oracle Preinstallation RPM</h2><p>Use Oracle Preinstallation RPM to simplify operating system configuration in preparation for Oracle software installations.</p>
<ul>
<li><p>When installed, the Oracle Preinstallation RPM does the following:<br>Automatically downloads and installs any additional RPM packages needed forinstalling Oracle Grid Infrastructure and Oracle Database, and resolves anydependencies</p>
</li>
<li><p>Creates an oracle user, and creates the oraInventory (oinstall) and OSDBA (dba) groups for that user</p>
</li>
<li><p>As needed, sets sysctl.conf settings, system startup parameters, and driver parameters to values based on recommendations from the Oracle Preinstallation RPM program</p>
</li>
<li><p>Sets hard and soft resource limits</p>
</li>
<li><p>Sets other recommended parameters, depending on your kernel version</p>
</li>
<li><p>Sets numa&#x3D;off in the kernel for Linux x86_64 machines.</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19c ~]<span class="comment"># yum -y install oracle-database-preinstall-19c</span></span><br><span class="line">[root@oracle19c ~]<span class="comment"># cat /var/log/oracle-database-preinstall-19c/results/orakernel.log</span></span><br><span class="line">Adding group oinstall with gid 54321</span><br><span class="line">Adding group dba with gid 54322</span><br><span class="line">Adding group oper with gid 54323</span><br><span class="line">Adding group backupdba with gid 54324</span><br><span class="line">Adding group dgdba with gid 54325</span><br><span class="line">Adding group kmdba with gid 54326</span><br><span class="line">Adding group racdba with gid 54330</span><br><span class="line">Adding user oracle with user <span class="built_in">id</span> 54321, initial login group oinstall, supplementary <span class="built_in">groups</span> oinstall,dba,oper,backupdba,dgdba,kmdba,racdba and  home directory /home/oracle</span><br><span class="line">Changing ownership of /home/oracle to oracle:oinstall</span><br><span class="line">Please <span class="built_in">set</span> password <span class="keyword">for</span> user - oracle</span><br><span class="line">uid=54321(oracle) gid=54321(oinstall) <span class="built_in">groups</span>=54321(oinstall),54330(racdba),54322(dba),54323(oper),54324(backupdba),54325(dgdba),54326(kmdba)</span><br><span class="line">User creation passed</span><br><span class="line"></span><br><span class="line">Saving a copy of the initial sysctl.conf</span><br><span class="line">Verifying  kernel parameters as per Oracle recommendations...</span><br><span class="line">Adding fs.file-max = 6815744</span><br><span class="line">Adding kernel.sem = 250 32000 100 128</span><br><span class="line">Adding kernel.shmmni = 4096</span><br><span class="line">Adding kernel.shmall = 1073741824</span><br><span class="line">Adding kernel.shmmax = 4398046511104</span><br><span class="line">Adding kernel.panic_on_oops = 1</span><br><span class="line">Adding net.core.rmem_default = 262144</span><br><span class="line">Adding net.core.rmem_max = 4194304</span><br><span class="line">Adding net.core.wmem_default = 262144</span><br><span class="line">Adding net.core.wmem_max = 1048576</span><br><span class="line">Adding net.ipv4.conf.all.rp_filter = 2</span><br><span class="line">Adding net.ipv4.conf.default.rp_filter = 2</span><br><span class="line">Adding fs.aio-max-nr = 1048576</span><br><span class="line">Adding net.ipv4.ip_local_port_range = 9000 65500</span><br><span class="line">Setting kernel parameters as per oracle recommendations...</span><br><span class="line">Altered file /etc/sysctl.conf</span><br><span class="line">Saved a copy of the current file <span class="keyword">in</span> /etc/sysctl.d/99-oracle-database-preinstall-19c-sysctl.conf</span><br><span class="line">Check /etc/sysctl.d <span class="keyword">for</span> backups</span><br><span class="line">Verification &amp; setting of kernel parameters passed</span><br><span class="line"></span><br><span class="line">Setting user limits using /etc/security/limits.d/oracle-database-preinstall-19c.conf</span><br><span class="line"></span><br><span class="line">Verifying oracle user OS limits as per Oracle recommendations...</span><br><span class="line">Adding oracle soft nofile  1024</span><br><span class="line">Adding oracle hard nofile  65536</span><br><span class="line">Adding oracle soft <span class="built_in">nproc</span>  16384</span><br><span class="line">Adding oracle hard <span class="built_in">nproc</span>  16384</span><br><span class="line">Adding oracle soft stack  10240</span><br><span class="line">Adding oracle hard stack  32768</span><br><span class="line">Adding oracle hard memlock  134217728</span><br><span class="line">Adding oracle soft memlock  134217728</span><br><span class="line">Adding oracle soft data  unlimited</span><br><span class="line">Adding oracle hard data  unlimited</span><br><span class="line">Setting oracle user OS limits as per Oracle recommendations...</span><br><span class="line">Altered file /etc/security/limits.d/oracle-database-preinstall-19c.conf</span><br><span class="line">Original file backed up at /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53</span><br><span class="line">Verification &amp; setting of user limits passed</span><br><span class="line"></span><br><span class="line">Saving a copy of /etc/default/grub file <span class="keyword">in</span> /etc/default/grub-initial.orabackup</span><br><span class="line">Saving a copy of /etc/default/grub <span class="keyword">in</span> /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53...</span><br><span class="line">Verifying kernel boot parameters as per Oracle recommendations...</span><br><span class="line">old boot params: <span class="string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet&quot;</span></span><br><span class="line">new boot params: <span class="string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span></span><br><span class="line"></span><br><span class="line">Setting boot params - Checking <span class="keyword">for</span> blscfg</span><br><span class="line">GRUB_ENABLE_BLSCFG=<span class="literal">true</span></span><br><span class="line">options <span class="variable">$kernelopts</span> <span class="variable">$tuned_params</span></span><br><span class="line">options <span class="variable">$kernelopts</span> <span class="variable">$tuned_params</span></span><br><span class="line">options <span class="variable">$kernelopts</span> <span class="variable">$tuned_params</span></span><br><span class="line">old boot params: <span class="string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span></span><br><span class="line">new boot params: <span class="string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never&quot;</span></span><br><span class="line"></span><br><span class="line">Setting boot params - Checking <span class="keyword">for</span> blscfg</span><br><span class="line">GRUB_ENABLE_BLSCFG=<span class="literal">true</span></span><br><span class="line">options <span class="variable">$kernelopts</span> <span class="variable">$tuned_params</span></span><br><span class="line">options <span class="variable">$kernelopts</span> <span class="variable">$tuned_params</span></span><br><span class="line">options <span class="variable">$kernelopts</span> <span class="variable">$tuned_params</span></span><br><span class="line">Setting kernel boot parameters as per Oracle recommendations...</span><br><span class="line">G_DIR=/boot/grub2</span><br><span class="line">Checking <span class="keyword">for</span> blscfg</span><br><span class="line">GRUB_ENABLE_BLSCFG=<span class="literal">true</span></span><br><span class="line">Saved Entry = 63e2e66b7eb349e4b44eded7924c6643-5.4.17-2136.300.7.el8uek.x86_64</span><br><span class="line">Running grub2-mkconfig</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15020: /usr/sbin/grub2-probe</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15020: /usr/sbin/grub2-probe</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15195: /usr/sbin/grub2-probe</span><br><span class="line">File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15195: /usr/sbin/grub2-probe</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Restore default</span><br><span class="line">Boot parameters will be effected on next reboot</span><br><span class="line">Altered file /etc/default/grub</span><br><span class="line">Copy of the changed file is <span class="keyword">in</span> - /etc/default/grub-oracle-database-preinstall-19c.orabackup</span><br><span class="line">Copy of the original file is <span class="keyword">in</span> - /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53</span><br><span class="line">Verification &amp; setting of boot parameters passed</span><br><span class="line"></span><br><span class="line">Trying to add NOZEROCONF parameter...</span><br><span class="line">Taking a backup of existing file to /etc/sysconfig/network.orabackup</span><br><span class="line">Successfully added parameter NOZEROCONF to /etc/sysconfig/network</span><br><span class="line">Setting /etc/sysconfig/network parameters passed</span><br><span class="line"></span><br><span class="line">Disabling Transparent Hugepages.</span><br><span class="line">Refer Oracle Note:1557478.1</span><br><span class="line"></span><br><span class="line">Disabling defrag.</span><br><span class="line">Refer Oracle Note:1557478.1</span><br><span class="line"></span><br><span class="line">Taking a backup of old config files under /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>exp 9i - 11g</title>
    <url>/blog/posts/d13c15c9.html</url>
    <content><![CDATA[<ol>
<li> 检查 segment 大小、对象个数、job、所有表的记录数 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">spool check_object_source<span class="operator">/</span>target.log</span><br><span class="line"><span class="keyword">set</span> pagesize <span class="number">10000</span></span><br><span class="line">prompt <span class="comment">---------------segments_bytes_G</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(bytes)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span> <span class="keyword">from</span> dba_segments <span class="keyword">where</span> owner<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br><span class="line">prompt <span class="comment">---------------object total amounts</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> dba_objects <span class="keyword">where</span> owner<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br><span class="line">prompt <span class="comment">---------------object type amounts</span></span><br><span class="line"><span class="keyword">select</span> owner,object_type,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> dba_objects <span class="keyword">where</span> owner<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> owner,object_type <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span>;</span><br><span class="line">prompt<span class="comment">-----------------job amounts</span></span><br><span class="line"><span class="keyword">select</span> job,what,broken <span class="keyword">from</span> dba_jobs <span class="keyword">where</span> log_user<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br><span class="line">prompt <span class="comment">---------------table records</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> XXXX.<span class="operator">*</span>;</span><br><span class="line">spool off</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 创建表空间 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>space XX datafile <span class="string">&#x27;/xxx/xxx1.dbf&#x27;</span> size <span class="number">30</span>g;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span>space XX <span class="keyword">add</span> datafile <span class="string">&#x27;/xxx/xxx2.dbf&#x27;</span> size <span class="number">30</span>g;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span>space XX <span class="keyword">add</span> datafile <span class="string">&#x27;/xxx/xxx3.dbf&#x27;</span> size <span class="number">30</span>g;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 创建用户 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_metadata.get_ddl(<span class="string">&#x27;USER&#x27;</span>,<span class="string">&#x27;XXXX&#x27;</span>) <span class="keyword">from</span> dba_users;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li> 迁移用户权限 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 表空间配额 </span></span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_granted_ddl(<span class="string">&#x27;TABLESPACE_QUOTA&#x27;</span>,username) <span class="keyword">from</span> dba_users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;XXXXX&#x27;</span>;</span><br><span class="line"><span class="comment">-- 角色 </span></span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_granted_ddl(<span class="string">&#x27;ROLE_GRANT&#x27;</span>,username) <span class="keyword">from</span> dba_users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;XXXXX&#x27;</span>;</span><br><span class="line"><span class="comment">-- 系统权限 </span></span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_granted_ddl(<span class="string">&#x27;SYSTEM_GRANT&#x27;</span>, username) <span class="keyword">from</span> dba_users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;XXXXX&#x27;</span>;</span><br><span class="line"><span class="comment">-- 对象权限，最后导入完后执行 </span></span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_granted_ddl(<span class="string">&#x27;OBJECT_GRANT&#x27;</span>, username) <span class="keyword">from</span> dba_users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;XXXXX&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li> 清空回收站 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_recyclebin;</span><br><span class="line">purge recyclebin;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li> 检查失效对象 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> owner,object_name,object_type <span class="keyword">from</span> dba_objects <span class="keyword">where</span> status<span class="operator">=</span><span class="string">&#x27;INVALID&#x27;</span> <span class="keyword">and</span> OWNER<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li> 记录 JOB，并禁用 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> job,what,broken <span class="keyword">from</span> dba_jobs <span class="keyword">where</span> log_user<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;exec dbms_ijob.broken(&#x27;</span><span class="operator">||</span>job<span class="operator">||</span><span class="string">&#x27;,true);&#x27;</span> <span class="keyword">from</span> dba_jobs <span class="keyword">where</span> log_user<span class="operator">=</span>’XXXX’;</span><br></pre></td></tr></table></figure>

<ol start="8">
<li> 锁定用户 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> XXXX account lock;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li> 导出 </li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ORACLE_SID=XXX</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</span><br><span class="line">exp system/oracle full=y FILE=/expdata/exp_full_date.dmp <span class="built_in">log</span>=/expdata/exp_full_date.log</span><br></pre></td></tr></table></figure>

<ol start="10">
<li> 关闭归档 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">shutdown immediate</span><br><span class="line">startup mount</span><br><span class="line"><span class="keyword">alter</span> database noarchivelog;</span><br><span class="line"><span class="keyword">alter</span> database <span class="keyword">open</span>;</span><br></pre></td></tr></table></figure>

<ol start="11">
<li> 导入 </li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ORACLE_SID=XXX</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</span><br><span class="line">imp system/oracle file=/expdata/exp_full_date.dmp <span class="built_in">log</span>=/expdata/imp_username_date.log fromuser=XXXX touser=XXXX commit=y buffer=819200000 ignore=y</span><br></pre></td></tr></table></figure>

<ol start="12">
<li> 检查导入的对象 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">spool check_object_source<span class="operator">/</span>target.log</span><br><span class="line"><span class="keyword">set</span> pagesize <span class="number">10000</span></span><br><span class="line">prompt <span class="comment">---------------segments_bytes_G</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(byetes)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span> <span class="keyword">from</span> dba_segments <span class="keyword">where</span> owner<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br><span class="line">prompt <span class="comment">---------------object total amounts</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> dba_objects <span class="keyword">where</span> owner<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br><span class="line">prompt <span class="comment">---------------object type amounts</span></span><br><span class="line"><span class="keyword">select</span> owner,object_type,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> dba_objects <span class="keyword">where</span> owner<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> owner,object_type <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span>;</span><br><span class="line">prompt<span class="comment">-----------------job amounts</span></span><br><span class="line"><span class="keyword">select</span> job,what,broken <span class="keyword">from</span> dba_jobs <span class="keyword">where</span> log_user<span class="operator">=</span><span class="string">&#x27;XXXX&#x27;</span>;</span><br><span class="line">prompt <span class="comment">---------------table records</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> XXXX.<span class="operator">*</span>;</span><br><span class="line">spool off</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure>

<ol start="13">
<li> 检查失效对象 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> owner,object_name,object_type <span class="keyword">from</span> dba_objects <span class="keyword">where</span> status <span class="operator">=</span> <span class="string">&#x27;INVALID&#x27;</span> <span class="keyword">and</span> OWNER<span class="operator">=</span><span class="string">&#x27;XXXXX&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@?<span class="operator">/</span>rdbms<span class="operator">/</span>admin<span class="operator">/</span>utlrp.sql</span><br></pre></td></tr></table></figure>

<ol start="14">
<li> 重新收集用户统计信息 </li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 用户统计信息收集 </span></span><br><span class="line"><span class="keyword">exec</span> DBMS_STATS.GATHER_SCHEMA_STATS(ownname<span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;SCOTT&#x27;</span>,degree<span class="operator">=</span><span class="operator">&gt;</span><span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 全库统计信息收集 </span></span><br><span class="line"><span class="keyword">exec</span> DBMS_STATS.GATHER_DATABASE_STATS(degree<span class="operator">=</span><span class="operator">&gt;</span><span class="number">4</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>exp</tag>
        <tag>imp</tag>
      </tags>
  </entry>
  <entry>
    <title>endian_format</title>
    <url>/blog/posts/24a83795.html</url>
    <content><![CDATA[<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$transportable_platform <span class="keyword">order</span> <span class="keyword">by</span> platform_id;</span><br><span class="line"></span><br><span class="line">PLATFORM_ID PLATFORM_NAME                            ENDIAN_FORMAT</span><br><span class="line"><span class="comment">----------- ---------------------------------------- --------------</span></span><br><span class="line">          <span class="number">1</span> Solaris[tm] OE (<span class="number">32</span><span class="operator">-</span>bit)                  Big</span><br><span class="line">          <span class="number">2</span> Solaris[tm] OE (<span class="number">64</span><span class="operator">-</span>bit)                  Big</span><br><span class="line">          <span class="number">3</span> HP<span class="operator">-</span>UX (<span class="number">64</span><span class="operator">-</span>bit)                           Big</span><br><span class="line">          <span class="number">4</span> HP<span class="operator">-</span>UX IA (<span class="number">64</span><span class="operator">-</span>bit)                        Big</span><br><span class="line">          <span class="number">5</span> HP Tru64 UNIX                            Little</span><br><span class="line">          <span class="number">6</span> AIX<span class="operator">-</span>Based Systems (<span class="number">64</span><span class="operator">-</span>bit)               Big</span><br><span class="line">          <span class="number">7</span> Microsoft Windows IA (<span class="number">32</span><span class="operator">-</span>bit)            Little</span><br><span class="line">          <span class="number">8</span> Microsoft Windows IA (<span class="number">64</span><span class="operator">-</span>bit)            Little</span><br><span class="line">          <span class="number">9</span> IBM zSeries Based Linux                  Big</span><br><span class="line">         <span class="number">10</span> Linux IA (<span class="number">32</span><span class="operator">-</span>bit)                        Little</span><br><span class="line">         <span class="number">11</span> Linux IA (<span class="number">64</span><span class="operator">-</span>bit)                        Little</span><br><span class="line">         <span class="number">12</span> Microsoft Windows x86 <span class="number">64</span><span class="operator">-</span>bit             Little</span><br><span class="line">         <span class="number">13</span> Linux x86 <span class="number">64</span><span class="operator">-</span>bit                         Little</span><br><span class="line">         <span class="number">15</span> HP <span class="keyword">Open</span> VMS                              Little</span><br><span class="line">         <span class="number">16</span> Apple Mac OS                             Big</span><br><span class="line">         <span class="number">17</span> Solaris Operating <span class="keyword">System</span> (x86)           Little</span><br><span class="line">         <span class="number">18</span> IBM Power Based Linux                    Big</span><br><span class="line">         <span class="number">19</span> HP IA <span class="keyword">Open</span> VMS                           Little</span><br><span class="line">         <span class="number">20</span> Solaris Operating <span class="keyword">System</span> (x86<span class="number">-64</span>)        Little</span><br><span class="line">         <span class="number">21</span> Apple Mac OS (x86<span class="number">-64</span>)                    Little</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>endian</tag>
      </tags>
  </entry>
  <entry>
    <title>Migration Method Comparison</title>
    <url>/blog/posts/c6c09ea3.html</url>
    <content><![CDATA[<p> 数据库平台迁移，常用工具优缺点对比：</p>
<table>
<thead>
<tr>
<th> 方法 </th>
<th> 优点 </th>
<th> 缺点 </th>
</tr>
</thead>
<tbody><tr>
<td>RMAN</td>
<td> 操作简单 </td>
<td> 不适用于不同字节序之间的平台迁移 </td>
</tr>
<tr>
<td> 数据泵 </td>
<td> 操作简单 </td>
<td> 数据量大时需要的停机时间很长 </td>
</tr>
<tr>
<td>OGG</td>
<td> 对源端目标端平台无要求 </td>
<td> 操作较复杂，维护成本高 </td>
</tr>
<tr>
<td>XTTS</td>
<td> 源端与目标端字节序可以不同，停机时间短 </td>
<td> 被移动的表空间不能包含 offline 的数据文件 </td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>migration</tag>
      </tags>
  </entry>
  <entry>
    <title>High CPU Usage</title>
    <url>/blog/posts/c0cd38d7.html</url>
    <content><![CDATA[<p>数据库运行慢，登录操作系统发现 CPU 使用率比平常要高 <br> 查看当前会话运行的 SQL Text 和 PLAN</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> sql_id, <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> gv$session <span class="keyword">where</span> type<span class="operator">=</span><span class="string">&#x27;USER&#x27;</span> <span class="keyword">and</span> status <span class="operator">=</span> <span class="string">&#x27;ACTIVE&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> sql_id;</span><br><span class="line">SQL_ID          <span class="built_in">COUNT</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">------------- ----------</span></span><br><span class="line">arz2wrgd05c5z          <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> addr,spid <span class="keyword">from</span> v$process <span class="keyword">where</span> spid<span class="operator">=</span><span class="string">&#x27;3268&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> sid,sql_id <span class="keyword">from</span> v$session <span class="keyword">where</span> paddr<span class="operator">=</span><span class="string">&#x27;0000000090CCF600&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> sql_text <span class="keyword">from</span> v$<span class="keyword">sql</span> <span class="keyword">where</span> sql_id<span class="operator">=</span><span class="string">&#x27;arz2wrgd05c5z&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="keyword">select</span> sql_id</span><br><span class="line"> <span class="keyword">from</span> v$session</span><br><span class="line"> <span class="keyword">where</span> paddr <span class="keyword">in</span> (<span class="keyword">select</span> addr <span class="keyword">from</span> v$process</span><br><span class="line"> <span class="keyword">where</span> spid <span class="keyword">in</span> (<span class="string">&#x27;5621&#x27;</span>,<span class="string">&#x27;31801&#x27;</span>,<span class="string">&#x27;31463&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> PLAN_TABLE_OUTPUT <span class="keyword">FROM</span> <span class="keyword">TABLE</span>(DBMS_XPLAN.DISPLAY_CURSOR(<span class="string">&#x27;&amp;sql_id&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>查看 SQL_TEXT</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[root<span class="variable">@oracle</span> <span class="operator">~</span>]# top</span><br><span class="line">    PID <span class="keyword">USER</span>      PR  NI    VIRT    RES    SHR S  <span class="operator">%</span>CPU <span class="operator">%</span>MEM     <span class="type">TIME</span><span class="operator">+</span> COMMAND</span><br><span class="line"> <span class="number">3428</span> oracle    <span class="number">20</span>   <span class="number">0</span> <span class="number">1060988</span>  <span class="number">80356</span>  <span class="number">77608</span> R  <span class="number">97.7</span>  <span class="number">4.0</span>   <span class="number">0</span>:<span class="number">32.34</span> oracle</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">SELECT</span> sql_text</span><br><span class="line"> <span class="keyword">FROM</span> v$sqltext a</span><br><span class="line"> <span class="keyword">WHERE</span> (a.hash_value, a.address)</span><br><span class="line"> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> DECODE(sql_hash_value, <span class="number">0</span>, prev_hash_value, sql_hash_value),</span><br><span class="line"> DECODE(sql_hash_value, <span class="number">0</span>, prev_sql_addr, sql_address)</span><br><span class="line"> <span class="keyword">FROM</span> v$session b</span><br><span class="line"> <span class="keyword">WHERE</span> b.paddr <span class="operator">=</span> (<span class="keyword">SELECT</span> addr <span class="keyword">FROM</span> v$process c <span class="keyword">WHERE</span> c.spid <span class="operator">=</span> <span class="string">&#x27;&amp;pid&#x27;</span>))</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> piece <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line">Enter <span class="keyword">value</span> <span class="keyword">for</span> pid: <span class="number">3428</span></span><br><span class="line"><span class="keyword">old</span>   <span class="number">7</span>:  <span class="keyword">WHERE</span> b.paddr <span class="operator">=</span> (<span class="keyword">SELECT</span> addr <span class="keyword">FROM</span> v$process c <span class="keyword">WHERE</span> c.spid <span class="operator">=</span> <span class="string">&#x27;&amp;pid&#x27;</span>))</span><br><span class="line"><span class="keyword">new</span>   <span class="number">7</span>:  <span class="keyword">WHERE</span> b.paddr <span class="operator">=</span> (<span class="keyword">SELECT</span> addr <span class="keyword">FROM</span> v$process c <span class="keyword">WHERE</span> c.spid <span class="operator">=</span> <span class="string">&#x27;3428&#x27;</span>))</span><br><span class="line"></span><br><span class="line">SQL_TEXT</span><br><span class="line"><span class="comment">----------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">declare</span> num <span class="type">int</span>:<span class="operator">=</span><span class="number">0</span>; <span class="keyword">begin</span> loop num:<span class="operator">=</span>num<span class="operator">+</span><span class="number">1</span>; <span class="keyword">end</span> loop; <span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>生成 kill session 语句</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;alter system kill session &#x27;&#x27;&#x27;</span> <span class="operator">||</span> sid <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> serial# <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27; immediate;&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> v$session <span class="keyword">WHERE</span> sql_id <span class="keyword">IN</span> (<span class="string">&#x27;&amp;sql_id&#x27;</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Optimization</category>
      </categories>
      <tags>
        <tag>optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>Optimization</title>
    <url>/blog/posts/787d9e55.html</url>
    <content><![CDATA[<ol>
<li><p>what oracle waiting for ???</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> </span><br><span class="line"> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>), event, sql_id, program, inst_id</span><br><span class="line">  <span class="keyword">from</span> gv$active_session_history</span><br><span class="line">  <span class="keyword">where</span> sample_time <span class="operator">&gt;</span> sysdate<span class="number">-5</span><span class="operator">/</span><span class="number">1440</span></span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> event, sql_id, program, inst_id</span><br><span class="line">  <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span> <span class="keyword">desc</span>)</span><br><span class="line"><span class="keyword">where</span> rownum <span class="operator">&lt;=</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>query execution plan</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> plan_table_output <span class="keyword">from</span> <span class="keyword">table</span>(dbms_xplan.display_cursor(<span class="string">&#x27;&amp;sql_id&#x27;</span>)); <span class="comment">-- 已知 SQL_Id 的情况下 </span></span><br><span class="line"></span><br><span class="line">explain plan <span class="keyword">for</span> (SQL_TEXT); <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span>(dbms_xplan.display);</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> autotrace <span class="keyword">on</span> explain <span class="comment">-- 显示值和执行计划 </span></span><br><span class="line"><span class="keyword">set</span> autotrace traceonly explain <span class="comment">-- 只显示执行计划 </span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Optimization</category>
      </categories>
      <tags>
        <tag>optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>CRS-1714</title>
    <url>/blog/posts/4b6becc3.html</url>
    <content><![CDATA[<h1 id="CRS-1714"><a href="#CRS-1714" class="headerlink" title="CRS-1714"></a>CRS-1714</h1><blockquote>
<p>操作系统：OracleLinux 7.9<br>数据库：Oracle RAC 11.2.0.4<br>磁盘：iSCSI + ASMLib</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>操作系统重启后，crs 无法正常启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@rac1 ~]$ crsctl <span class="built_in">stat</span> res -t</span><br><span class="line">CRS-4535: Cannot communicate with Cluster Ready Services</span><br><span class="line">CRS-4000: Command Status failed, or completed with errors.</span><br></pre></td></tr></table></figure>

<p>查看 <code>/u01/app/11.2.0/grid/log/rac1/alertrac1.log</code> 日志，发现无法识别到 votedisk</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[cssd(3348)]CRS-1714:Unable to discover any voting files, retrying discovery in 15 seconds; Details at (:CSSNM00070:) in /u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log</span><br><span class="line">2022-05-01 12:51:13.898:</span><br><span class="line">[cssd(3348)]CRS-1714:Unable to discover any voting files, retrying discovery in 15 seconds; Details at (:CSSNM00070:) in /u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log</span><br><span class="line">2022-05-01 12:51:28.914:</span><br><span class="line">[cssd(3348)]CRS-1714:Unable to discover any voting files, retrying discovery in 15 seconds; Details at (:CSSNM00070:) in /u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log</span><br></pre></td></tr></table></figure>

<p>检查 oracleasm configure，已经设置开机启动扫描磁盘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># oracleasm configure</span></span><br><span class="line">ORACLEASM_ENABLED=<span class="literal">true</span></span><br><span class="line">ORACLEASM_UID=grid</span><br><span class="line">ORACLEASM_GID=asmadmin</span><br><span class="line">ORACLEASM_SCANBOOT=<span class="literal">true</span></span><br><span class="line">ORACLEASM_SCANORDER=<span class="string">&quot;&quot;</span></span><br><span class="line">ORACLEASM_SCANEXCLUDE=<span class="string">&quot;&quot;</span></span><br><span class="line">ORACLEASM_SCAN_DIRECTORIES=<span class="string">&quot;&quot;</span></span><br><span class="line">ORACLEASM_USE_LOGICAL_BLOCK_SIZE=<span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>

<p>而且手动扫描磁盘是可以扫到磁盘的，说明配置是没啥问题的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># oracleasm scandisks</span></span><br><span class="line">Reloading disk partitions: <span class="keyword">done</span></span><br><span class="line">Cleaning any stale ASM disks...</span><br><span class="line">Scanning system <span class="keyword">for</span> ASM disks...</span><br><span class="line">Instantiating disk <span class="string">&quot;OCR_VOTE1&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;OCR_VOTE2&quot;</span></span><br><span class="line">Instantiating disk <span class="string">&quot;OCR_VOTE3&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>经过排查是 <code>oracleasm.service</code> 的服务比 <code>iscsid.service</code> 的服务更早启动，导致没有扫描到 iscsi 磁盘</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>修改一下服务让 oracleasm 在 iscsid 后面启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@rac1 ~]$ <span class="built_in">cat</span> /usr/lib/systemd/system/oracleasm.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Load oracleasm Modules</span><br><span class="line">Requires=iscsid.service <span class="comment"># add</span></span><br><span class="line">After=iscsi.service iscsid.service <span class="comment"># add</span></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=oneshot</span><br><span class="line">RemainAfterExit=<span class="built_in">yes</span></span><br><span class="line">ExecStart=/usr/sbin/oracleasm.init start_sysctl</span><br><span class="line">ExecStop=/usr/sbin/oracleasm.init stop_sysctl</span><br><span class="line">ExecReload=/usr/sbin/oracleasm.init restart_sysctl</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>重启后，问题解决。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>CRS-4124</title>
    <url>/blog/posts/53153380.html</url>
    <content><![CDATA[<h1 id="CRS-4124"><a href="#CRS-4124" class="headerlink" title="CRS-4124"></a>CRS-4124</h1><blockquote>
<p>操作系统：Oracle Linux Server 7.9<br>Grid 版本：11.2.0.4</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>安装 Grid 软件，执行 <code>root.sh</code> 报错：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CRS-4124: Oracle High Availability Services startup failed.</span><br><span class="line">CRS-4000: Command Start failed, or completed with errors.</span><br><span class="line">ohasd failed to start: Inappropriate ioctl for device</span><br><span class="line">ohasd failed to start at /oracle/app/product/grid/crs/install/rootcrs.pl line 443.</span><br></pre></td></tr></table></figure>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>这是 Grid 安装的 BUG，参考以下文档：<br>Install of Clusterware fails while running root.sh on OL7 - ohasd fails to start (Doc ID 1959008.1)<br>patch p18370031_112040_Linux-x86-64.zip</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><ol>
<li><p>执行脚本回滚 root.sh 操作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># $GRID_HOME/crs/install/./roothas.pl -deconfig -force -verbose</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>窗口一重新执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># $GRID_HOME/root.sh</span></span><br></pre></td></tr></table></figure>

<p>同时另开一个窗口，不断执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># while true; do /bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1; sleep 1; done</span></span><br></pre></td></tr></table></figure>

<p>如果执行 dd 的时候报以下错误：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@rac1 ~]<span class="comment"># /bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1</span></span><br><span class="line">/bin/dd: opening `/var/tmp/.oracle/npohasd’: No such file or directory</span><br></pre></td></tr></table></figure>

<p>说明文件还没有生成，那就继续执行。执行成功后，命令挂起。root.sh 就可以执行成功。</p>
</li>
<li><p>创建 ohas.service 服务，使得重启服务器时能够自动启动 CRS</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /usr/lib/systemd/system/ohas.service &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=Oracle High Availability Services</span></span><br><span class="line"><span class="string">After=syslog.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStart=/etc/init.d/init.ohasd run &gt; /dev/null 2&gt;&amp;1 &lt; /dev/null</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> ohas.service --now</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>CRS-4535</title>
    <url>/blog/posts/3a009a8b.html</url>
    <content><![CDATA[<h1 id="CRS-4535"><a href="#CRS-4535" class="headerlink" title="CRS-4535"></a>CRS-4535</h1><blockquote>
<p>System Operation: RHEL 8.7<br>Database Software: 19.3.0.0.0 RAC with 3 nodes</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>安装完 GI 软件，重启服务器后，CRS 服务无法启动</p>
<p><font color=error>CRS-4535: Cannot communicate with Cluster Ready Services<br>CRS-4000: Command Status failed, or completed with errors.</font></p>
<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p><code>ora.crsd</code>资源无法联机</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac02 bin]<span class="comment"># ./crsctl stat res -t -init</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Name           Target  State        Server                   State details</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Cluster Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.asm</span><br><span class="line">      1        ONLINE  OFFLINE                               STABLE</span><br><span class="line">ora.cluster_interconnect.haip</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.crf</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.crsd</span><br><span class="line">      1        ONLINE  OFFLINE                               STABLE</span><br><span class="line">ora.cssd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.cssdmonitor</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.ctssd</span><br><span class="line">      1        ONLINE  OFFLINE                               STABLE</span><br><span class="line">ora.diskmon</span><br><span class="line">      1        OFFLINE OFFLINE                               STABLE</span><br><span class="line">ora.evmd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.gipcd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.gpnpd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.mdnsd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.storage</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>启动 <code>ora.crsd</code> 资源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac02 bin]<span class="comment"># ./crsctl start res ora.crsd -init</span></span><br><span class="line">CRS-2672: Attempting to start <span class="string">&#x27;ora.ctssd&#x27;</span> on <span class="string">&#x27;oracle19crac02&#x27;</span></span><br><span class="line">CRS-2676: Start of <span class="string">&#x27;ora.ctssd&#x27;</span> on <span class="string">&#x27;oracle19crac02&#x27;</span> succeeded</span><br><span class="line">CRS-2672: Attempting to start <span class="string">&#x27;ora.asm&#x27;</span> on <span class="string">&#x27;oracle19crac02&#x27;</span></span><br><span class="line">CRS-2672: Attempting to start <span class="string">&#x27;ora.crsd&#x27;</span> on <span class="string">&#x27;oracle19crac02&#x27;</span></span><br><span class="line">CRS-2676: Start of <span class="string">&#x27;ora.asm&#x27;</span> on <span class="string">&#x27;oracle19crac02&#x27;</span> succeeded</span><br><span class="line">CRS-2676: Start of <span class="string">&#x27;ora.crsd&#x27;</span> on <span class="string">&#x27;oracle19crac02&#x27;</span> succeeded</span><br></pre></td></tr></table></figure>

<p>重新查看状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac02 bin]<span class="comment"># ./crsctl stat res -t -init</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Name           Target  State        Server                   State details</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Cluster Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.asm</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.cluster_interconnect.haip</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.crf</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.crsd</span><br><span class="line">      1        ONLINE  INTERMEDIATE oracle19crac02           STABLE</span><br><span class="line">ora.cssd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.cssdmonitor</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.ctssd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           ACTIVE:-8600,STABLE</span><br><span class="line">ora.diskmon</span><br><span class="line">      1        OFFLINE OFFLINE                               STABLE</span><br><span class="line">ora.evmd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.gipcd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.gpnpd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.mdnsd</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.storage</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">[root@oracle19crac02 bin]<span class="comment"># ./crsctl stat res -t</span></span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Name           Target  State        Server                   State details</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Local Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.LISTENER.lsnr</span><br><span class="line">               ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.chad</span><br><span class="line">               ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.net1.network</span><br><span class="line">               ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.ons</span><br><span class="line">               ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">               ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Cluster Resources</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">ora.ARCH.dg(ora.asmgroup)</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">      2        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">      3        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.ASMNET1LSNR_ASM.lsnr(ora.asmgroup)</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">      2        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">      3        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.DATA.dg(ora.asmgroup)</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">      2        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">      3        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.LISTENER_SCAN1.lsnr</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.MGMT.dg(ora.asmgroup)</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">      2        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">      3        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.MGMTLSNR</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac03           169.254.10.67 100.10</span><br><span class="line">                                                             0.100.103,STABLE</span><br><span class="line">ora.OCR.dg(ora.asmgroup)</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">      2        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">      3        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.asm(ora.asmgroup)</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           Started,STABLE</span><br><span class="line">      2        ONLINE  ONLINE       oracle19crac02           Started,STABLE</span><br><span class="line">      3        ONLINE  ONLINE       oracle19crac03           Started,STABLE</span><br><span class="line">ora.asmnet1.asmnetwork(ora.asmgroup)</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">      2        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">      3        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.cvu</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.mgmtdb</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac03           Open,STABLE</span><br><span class="line">ora.oracle19crac01.vip</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac01           STABLE</span><br><span class="line">ora.oracle19crac02.vip</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac02           STABLE</span><br><span class="line">ora.oracle19crac03.vip</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.qosmserver</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">ora.scan1.vip</span><br><span class="line">      1        ONLINE  ONLINE       oracle19crac03           STABLE</span><br><span class="line">--------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>emdctl Error 2</title>
    <url>/blog/posts/7453db1b.html</url>
    <content><![CDATA[<h1 id="emdctl-Error-2"><a href="#emdctl-Error-2" class="headerlink" title="emdctl Error 2"></a>emdctl Error 2</h1><blockquote>
<p> 操作系统：Oracle Linux Server 7.9<br>Oracle 版本：11.2.0.4<br>Grid 版本：11.2.0.4，</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p> 安装 database 软件时，报错：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">INFO: make[1]: *** [/u01/app/oracle/product/11.2.0.4/db_1/sysman/lib/emdctl] Error 1</span><br><span class="line">make: *** [emdctl] Error 2</span><br><span class="line">INFO: End output from spawned process.</span><br><span class="line">INFO: ----------------------------------</span><br><span class="line">INFO: Exception thrown from action: make</span><br><span class="line">Exception Name: MakefileException</span><br><span class="line">Exception String: Error in invoking target &#x27;agent nmhs&#x27; of makefile &#x27;/u01/app/oracle/product/11.2.0.4/db_1/sysman/lib/ins_emagent.mk&#x27;. </span><br><span class="line">See &#x27;/u01/app/oraInventory/logs/installActions2019-12-19_07-13-02PM.log&#x27; for details.</span><br><span class="line">Exception Severity: 1</span><br></pre></td></tr></table></figure>

<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p> 备份 makefile</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> <span class="variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk <span class="variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk.bak</span><br></pre></td></tr></table></figure>

<p> 编辑 $ORACLE_HOME&#x2F;sysman&#x2F;lib&#x2F;ins_emagent.mk, 查找下面内容 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#===========================</span></span><br><span class="line"><span class="comment">#  emdctl</span></span><br><span class="line"><span class="comment">#===========================</span></span><br><span class="line"></span><br><span class="line">$(SYSMANBIN)emdctl:</span><br><span class="line">        $(MK_EMAGENT_NMECTL)</span><br></pre></td></tr></table></figure>

<p>Then append the line with <strong>-lnnz11</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#===========================</span></span><br><span class="line"><span class="comment">#  emdctl</span></span><br><span class="line"><span class="comment">#===========================</span></span><br><span class="line"></span><br><span class="line">$(SYSMANBIN)emdctl:</span><br><span class="line">        $(MK_EMAGENT_NMECTL) -lnnz11</span><br></pre></td></tr></table></figure>

<p>Use follow command to modify</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s|$(MK_EMAGENT_NMECTL)|$(MK_EMAGENT_NMECTL) -lnnz11|&#x27;</span> <span class="variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Installation Errors for Oracle 19.3 RAC on RHEL 8.7</title>
    <url>/blog/posts/43622e5f.html</url>
    <content><![CDATA[<h1 id="Installation-Errors-for-Oracle-19-3-RAC-on-RHEL-8-7"><a href="#Installation-Errors-for-Oracle-19-3-RAC-on-RHEL-8-7" class="headerlink" title="Installation Errors for Oracle 19.3 RAC on RHEL 8.7"></a>Installation Errors for Oracle 19.3 RAC on RHEL 8.7</h1><blockquote>
<p>System Operation: RHEL 8.7<br>Database Software: 19.3.0.0.0 RAC with 3 nodes</p>
</blockquote>
<h2 id="Symptoms"><a href="#Symptoms" class="headerlink" title="Symptoms"></a>Symptoms</h2><p>执行 GRID 软件 OUI<code>$GRID_HOME/gridSetup.sh</code>和 Oracle 数据库软件 OUI<code>$ORACLE_HOME/runInstaller</code>时，出现如下错误：</p>
<p><font color=error>[WARNING] [INS-08101] Unexpected error while executing the action at state: ‘supportedOSCheck’.</font></p>
<h3 id="Workaround"><a href="#Workaround" class="headerlink" title="Workaround"></a>Workaround</h3><p>参考 Requirements for Installing Oracle Database&#x2F;Client 19c on OL8 or RHEL8 64-bit (x86-64)(Doc ID 2668780.1)</p>
<p><a href="/blog/assets/pdf/Document%202668780.1.pdf">Document 2668780.1</a></p>
<p>OL&#x2F;RHEL8 操作系统版本不在 19c 预检列表中，在 RU 19.6 及更高版本中修复。<br>在执行安装脚本前，设置 <code>CV_ASSUME_DISTID</code> 变量假设操作系统版本为 OL7：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> CV_ASSUME_DISTID=OEL7</span><br><span class="line">./gridSetup.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CV_ASSUME_DISTID=OEL7</span><br><span class="line">./runInstaller</span><br></pre></td></tr></table></figure>

<h2 id="Symptoms-1"><a href="#Symptoms-1" class="headerlink" title="Symptoms"></a>Symptoms</h2><p>在节点 SSH 免密验证时，出现如下错误：</p>
<p><font color=error>[INS-06006] Passwordless SSH connectivity not set up between the following node(s): [oracle19crac02, oracle19crac03].</font></p>
<h3 id="Workaround-1"><a href="#Workaround-1" class="headerlink" title="Workaround"></a>Workaround</h3><p>参考 INS-06006 GI RunInstaller Fails If OpenSSH Is Upgraded to 8.x (Doc ID 2555697.1)</p>
<p><a href="/blog/assets/pdf/Document%202555697.1.pdf">Document 2555697.1</a></p>
<p>OpenSSH 8.x 安全机制问题，安装前，添加 <code>scp</code> 选项<code>-T</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Rename the original scp.</span></span><br><span class="line"><span class="built_in">mv</span> /usr/bin/scp /usr/bin/scp.orig</span><br><span class="line"><span class="comment"># Create a new file &lt;/usr/bin/scp&gt;.</span></span><br><span class="line">vi /usr/bin/scp</span><br><span class="line"><span class="comment"># Add the below line to the new created file &lt;/usr/bin/scp&gt;.</span></span><br><span class="line">/usr/bin/scp.orig -T $*</span><br><span class="line"><span class="comment"># Change the file permission.</span></span><br><span class="line"><span class="built_in">chmod</span> 555 /usr/bin/scp</span><br></pre></td></tr></table></figure>

<p>安装后：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mv</span> /usr/bin/scp.orig /usr/bin/scp</span><br></pre></td></tr></table></figure>

<h2 id="Symptoms-2"><a href="#Symptoms-2" class="headerlink" title="Symptoms"></a>Symptoms</h2><p>OUI 在执行拷贝 <code>$GRID_HOME</code> 到其他节点时，出现如下错误：</p>
<p><font color=error>[INS-10113] Installer encountered errors while copying &#x2F;opt&#x2F;grid&#x2F;products&#x2F;19.3.0 to nodes [<node2>, <node3>].</font><br><font color=error>PRCF-2041 : The transfer failed for all nodes</font></p>
<h3 id="Workaround-2"><a href="#Workaround-2" class="headerlink" title="Workaround"></a>Workaround</h3><p>参考 19c [INS-10113] And PRCF-2041 When Installing 3 Nodes RAC (Doc ID 2662954.1)</p>
<p><a href="/blog/assets/pdf/Document%202662954.1.pdf">Document 2662954.1</a></p>
<p>在启动 OUI 前，设置 <code>SRVM_DISABLE_MTTRANS</code> 变量：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> SRVM_DISABLE_MTTRANS=<span class="literal">true</span></span><br><span class="line">./gridSetup.sh</span><br></pre></td></tr></table></figure>

<p>设置完后可能出现如下报错，忽略即可。</p>
<p>[INS-06009] SSH performance is detected to be slow, which may impact performance during remote node operations like copying the software and executing prerequisite checks.</p>
<h2 id="Symptoms-3"><a href="#Symptoms-3" class="headerlink" title="Symptoms"></a>Symptoms</h2><p>在 ASM 私有网络验证时，出现如下错误：</p>
<p><font color=error>[INS-41208] None of the available network subnets is marked for use by Oracle Automatic Storage Management (ASM)</p>
<ul>
<li>PRVG-11081 : unable to find the matching networks for the interface “ens256” and the subnet “100.100.100.0” on nodes “oracle19crac03”  </li>
<li>Cause:  Cluster Verification Utility (CVU) connectivity checking determined that the interface-subnet combination was not found on the indicated nodes.  </li>
<li>Action:  Ensure that the interface-subnet combination is installed, is online on the indicated nodes, and retry the node connectivity checks.</font></li>
</ul>
<h3 id="Workaround-3"><a href="#Workaround-3" class="headerlink" title="Workaround"></a>Workaround</h3><p>第三节点的网卡设备名称 <code>ens256</code> 与第一节点和第二节点的网卡设备名 <code>ens224</code> 不一致。<br>修改第三节点的网卡设备名称，可参考<a href="https://access.redhat.com/solutions/1301563">How to assign a specific network interface name in RHEL7, 8</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmcli con add con-name ens224 <span class="built_in">type</span> ethernet mac <span class="string">&quot;xx.xx.xx.xx&quot;</span> ifname ens224</span><br><span class="line">nmcli con modify ens224 ipv4.add 100.100.100.103/24 ipv4.method manual autoconnect <span class="built_in">yes</span></span><br><span class="line">nmcli con up ens224</span><br></pre></td></tr></table></figure>

<h2 id="Symptoms-4"><a href="#Symptoms-4" class="headerlink" title="Symptoms"></a>Symptoms</h2><p>DBCA 创建数据库时，出现 PDB 数据库无法从备份集中还原</p>
<p><font color=error>[FATAL] Error while restoring PDB backup piece</font></p>
<p>查看 DBCA 日志文件<code>/u01/app/oracle/cfgtoollogs/dbca/coco/trace.log_2023-05-24_10-22-51PM</code>，详细报错如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[progressPage.flowWorker] [2023-05-24 15:36:07.613 CST] [RMANUtil.restorePDBBackUp:1697]  Error while restoring PDB backup piece: echo set off</span><br><span class="line">RMAN&gt; 2&gt; 3&gt; 4&gt; 5&gt;</span><br><span class="line">executing command: SET COMMAND ID</span><br><span class="line">Starting restore at 24-MAY-23</span><br><span class="line">using target database control file instead of recovery catalog</span><br><span class="line">allocated channel: ORA_DISK_1</span><br><span class="line">channel ORA_DISK_1: SID=13 device type=DISK</span><br><span class="line">channel ORA_DISK_1: starting datafile backup set restore</span><br><span class="line">channel ORA_DISK_1: specifying datafile(s) to restore from backup set</span><br><span class="line">channel ORA_DISK_1: restoring foreign file 00002</span><br><span class="line">channel ORA_DISK_1: restoring foreign file 00004</span><br><span class="line">channel ORA_DISK_1: restoring foreign file 00009</span><br><span class="line">channel ORA_DISK_1: reading from backup piece /u01/app/oracle/product/19.0.0/dbhome_1/assistants/dbca/templates/pdbseed.dfb</span><br><span class="line">channel ORA_DISK_1: restoring foreign file 2 to +DATA/COCO/pdbseed/system01.dbf</span><br><span class="line">channel ORA_DISK_1: restoring foreign file 4 to +DATA/COCO/pdbseed/sysaux01.dbf</span><br><span class="line">channel ORA_DISK_1: restoring foreign file 9 to +DATA/COCO/pdbseed/undotbs01.dbf</span><br><span class="line">RMAN-00571: ===========================================================</span><br><span class="line">RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============</span><br><span class="line">RMAN-00571: ===========================================================</span><br><span class="line">RMAN-03002: failure of restore command at 05/24/2023 15:36:07</span><br><span class="line">ORA-19870: error while restoring backup piece /u01/app/oracle/product/19.0.0/dbhome_1/assistants/dbca/templates/pdbseed.dfb</span><br><span class="line">ORA-19504: failed to create file &quot;+DATA/COCO/pdbseed/system01.dbf&quot;</span><br><span class="line">ORA-17502: ksfdcre:4 Failed to create file +DATA/COCO/pdbseed/system01.dbf</span><br><span class="line">ORA-15173: entry &#x27;pdbseed&#x27; does not exist in directory &#x27;COCO&#x27;</span><br><span class="line">RMAN&gt;</span><br><span class="line"></span><br><span class="line">SEVERE: May 24, 2023 3:36:08 PM oracle.install.commons.util.exception.AbstractErrorAdvisor getDetailedMessage</span><br><span class="line">SEVERE: [FATAL] Error while restoring PDB backup piece</span><br></pre></td></tr></table></figure>

<h3 id="Workaround-4"><a href="#Workaround-4" class="headerlink" title="Workaround"></a>Workaround</h3><p>PDB 数据库创建 BUG，无法自动创建 <code>PDBSEED</code> 和<code>&lt;PDB&gt;</code>数据文件目录，需要手动进行创建</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">asmcmd&gt; </span><span class="language-bash"><span class="built_in">cd</span> +DATA/COCO/</span></span><br><span class="line"><span class="meta prompt_">asmcmd&gt; </span><span class="language-bash"><span class="built_in">mkdir</span> PDBSEED</span></span><br><span class="line"><span class="meta prompt_">asmcmd&gt; </span><span class="language-bash"><span class="built_in">mkdir</span> PDB</span></span><br></pre></td></tr></table></figure>

<h2 id="Symptoms-5"><a href="#Symptoms-5" class="headerlink" title="Symptoms"></a>Symptoms</h2><p>DBCA 创建数据库，出现数据库无法启动，共享内存段（SGA）分配错误</p>
<p><font color=error>PRCR-1079 : Failed to start resource ora.coco.db<br>CRS-5017: The resource action “ora.coco.db start” encountered the following error:<br>ORA-27125: unable to create shared memory segment</font></p>
<p>查看数据库 <code>alert_&lt;sid&gt;.log</code> 日志文件，详细错误日志如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2023-05-24T13:11:59.696916+08:00</span><br><span class="line">Error: ENOSPC while creating shared memory segment of size 6425673728 bytes</span><br><span class="line">Check the system shared memory parameters</span><br><span class="line">2023-05-24T13:11:59.697766+08:00</span><br><span class="line">Error: ENOSPC while creating shared memory segment of size 6425673728 bytes</span><br><span class="line">Check the system shared memory parameters</span><br><span class="line">2023-05-24T13:11:59.698456+08:00</span><br><span class="line">**********************************************************************</span><br><span class="line">2023-05-24T13:11:59.698751+08:00</span><br><span class="line">Dump of system resources acquired for SHARED GLOBAL AREA (SGA)</span><br><span class="line"></span><br><span class="line">2023-05-24T13:11:59.699297+08:00</span><br><span class="line"> Per process system memlock (soft) limit = 7168M</span><br><span class="line">2023-05-24T13:11:59.699599+08:00</span><br><span class="line"> Expected per process system memlock (soft) limit to lock</span><br><span class="line"> instance MAX SHARED GLOBAL AREA (SGA) into memory: 6146M</span><br><span class="line">2023-05-24T13:11:59.700236+08:00</span><br><span class="line"> Available system pagesizes:</span><br><span class="line">  4K, 2048K</span><br><span class="line">2023-05-24T13:11:59.700836+08:00</span><br><span class="line"> Supported system pagesize(s):</span><br><span class="line">2023-05-24T13:11:59.701123+08:00</span><br><span class="line">  PAGESIZE  AVAILABLE_PAGES  EXPECTED_PAGES  ALLOCATED_PAGES  ERROR(s)</span><br><span class="line">2023-05-24T13:11:59.701447+08:00</span><br><span class="line">        4K       Configured               9               0   ORA-27125</span><br><span class="line">2023-05-24T13:11:59.701942+08:00</span><br><span class="line">     2048K             3071            3073               5   ORA-27125</span><br><span class="line">2023-05-24T13:11:59.702271+08:00</span><br><span class="line">RECOMMENDATION:</span><br><span class="line">2023-05-24T13:11:59.702601+08:00</span><br><span class="line"> 1. Configure system with expected number of pages for every</span><br><span class="line"> supported system pagesize prior to the next instance restart operation.</span><br><span class="line">2023-05-24T13:11:59.725346+08:00</span><br><span class="line">**********************************************************************</span><br><span class="line">2023-05-24T13:11:59.747369+08:00</span><br><span class="line">SGA: Realm creation failed</span><br></pre></td></tr></table></figure>

<h3 id="Workaround-5"><a href="#Workaround-5" class="headerlink" title="Workaround"></a>Workaround</h3><p>共享内存段参数设置错误，导致共享内存段不足，相关参数有 <code>memlock</code>, <code>kernel.shmmax</code>, <code>kernel.shmall</code>, <code>vm.nr_hugepages</code>。<br> 重新配置后，正常启动。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>OPATCHAUTO-72030</title>
    <url>/blog/posts/d21f8a3e.html</url>
    <content><![CDATA[<h1 id="OPATCHAUTO-72030"><a href="#OPATCHAUTO-72030" class="headerlink" title="OPATCHAUTO-72030"></a>OPATCHAUTO-72030</h1><blockquote>
<p>System Operation: RedHat 8.7<br>Database Software: 19.3.0.0 RAC</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>opatchauto failed.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]# /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/34130714 -analyze</span><br><span class="line">OPatchauto session is initiated at Tue May 23 23:22:37 2023</span><br><span class="line"></span><br><span class="line">System initialization log file is /u01/app/19.0.0/grid/cfgtoollogs/opatchautodb/systemconfig2023-05-23_11-22-43PM.log.</span><br><span class="line"></span><br><span class="line">Session log file is /u01/app/19.0.0/grid/cfgtoollogs/opatchauto/opatchauto2023-05-23_11-23-02PM.log</span><br><span class="line">The id for this session is QDHA</span><br><span class="line">Shared home /u01/app/19.0.0/grid can only be patched in nonrolling mode.</span><br><span class="line"></span><br><span class="line">OPATCHAUTO-72030: Execution mode invalid.</span><br><span class="line">OPATCHAUTO-72030: Cannot execute in rolling mode, as CRS home is shared.</span><br><span class="line">OPATCHAUTO-72030: Execute in non-rolling mode.</span><br><span class="line">OPatchAuto failed.</span><br><span class="line"></span><br><span class="line">OPatchauto session completed at Tue May 23 23:23:32 2023</span><br><span class="line">Time taken to complete the session 0 minute, 55 seconds</span><br><span class="line"></span><br><span class="line">opatchauto failed with error code 42</span><br></pre></td></tr></table></figure>

<p>found errors in System initialization log file <code>/u01/app/19.0.0/grid/cfgtoollogs/opatchautodb/systemconfig2023-05-23_11-17-19PM.log</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2023-05-23 23:17:39,695 WARNING [1] oracle.dbsysmodel.driver.sdk.util.OsysUtility - Failed:</span><br><span class="line">Verifying &#x27;/tmp/&#x27; ...FAILED (PRVG-1901)</span><br><span class="line"></span><br><span class="line">Verification of shared storage accessibility was unsuccessful on all the specified nodes.</span><br><span class="line">NODE_STATUS::oracle19crac01:EFAIL</span><br><span class="line">The result of cluvfy command contain EFAIL NODE_STATUS::oracle19crac01:EFAIL</span><br><span class="line">2023-05-23 23:17:39,697 SEVERE [1] com.oracle.glcm.patch.auto.db.integration.model.productsupport.topology.TopologyCreator - Stacktrace :: oracle.dbsysmodel.driver.sdk.prod</span><br><span class="line">uctdriver.ProductDriverException: Unable to determine if &quot;/u01/app/19.0.0/grid&quot; is a shared oracle home.</span><br><span class="line">Failed:</span><br><span class="line">Verifying &#x27;/tmp/&#x27; ...FAILED (PRVG-1901)</span><br><span class="line"></span><br><span class="line">Verification of shared storage accessibility was unsuccessful on all the specified nodes.</span><br><span class="line">NODE_STATUS::oracle19crac01:EFAIL</span><br><span class="line">The result of cluvfy command contain EFAIL NODE_STATUS::oracle19crac01:EFAIL</span><br></pre></td></tr></table></figure>

<h2 id="CASE"><a href="#CASE" class="headerlink" title="CASE"></a>CASE</h2><p>Since 19c(19.3) is already released a while ago, It does not contain Pre-req checks specific to OL&#x2F;RHEL 8.</p>
<h2 id="SULUTION"><a href="#SULUTION" class="headerlink" title="SULUTION"></a>SULUTION</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># export CV_ASSUME_DISTID=OEL7</span></span><br><span class="line">[root@oracle19crac ~]<span class="comment"># /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/34130714 -analyze</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00600 2662</title>
    <url>/blog/posts/1a397da3.html</url>
    <content><![CDATA[<h1 id="ORA-00600-2662"><a href="#ORA-00600-2662" class="headerlink" title="ORA-00600 2662"></a>ORA-00600 2662</h1><h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>在一次数据库恢复过程中，使用 <code>_ALLOW_RESETLOGS_CORRUPTION = TRUE</code> 这个隐含参数来强制打开数据库，遇到 ORA-00600: internal error code, arguments: [2662] 报错，日志如下：<br>[Errors in file &#x2F;app&#x2F;oracle&#x2F;admin&#x2F;rac&#x2F;udump&#x2F;rac1_ora_3997860.trc:ORA-00600: internal error code, arguments: [2662], [3186][3707069194], [3186], [3707142625], [29580553], [], []]{.red}</p>
<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>关于 ORA-00600: internal error code, arguments: [2662]这个报错的解释如下：<br>ORA-00600 [2662] “Block SCN is ahead of Current SCN”，说明当前数据库的据块的 SCN 早于当前的 SCN，主要是和存储在 UGA 变量中的 dependent SCN 进行比较，如当前的 SCN 小于它，数据库就会产生这个 ORA-00600 [2662]的错误了。这个错误一共有 5 个数，分别代表不同的含义</p>
<p><strong>ORA-00600 [2662] [a] [b] {c} [d] [e]</strong></p>
<blockquote>
<p>Arg [a] Current SCN WRAP;<br>Arg [b] Current SCN BASE;<br>Arg {c} dependent SCN WRAP;<br>Arg [d] dependent SCN BASE;<br>Arg [e] Where present this is the DBA where the dependent SCN came from.</p>
</blockquote>
<p>我们分析错误中的提示，它的参数 b&#x3D;3707069194,d&#x3D;3707142625, 表明当前的 SCN 确实小于 dependent SCN，所以产生了这个 ORA-00600 的错误。<br>通过查阅 oracle metalink 文档得知，出现这个报错主要有以下原因：</p>
<ol>
<li>使用隐含参数_ALLOW_RESETLOGS_CORRUPTION 后 resetlogs 打开数据库；</li>
<li>恢复了控制文件但是没有使用 recover database using backup controlfile 进行恢复；</li>
<li>数据库 crash 后设置了_DISABLE_LOGGING 隐含参数；</li>
<li>在并行服务器环境中 DLM 存在问题；</li>
<li>硬件错误引起数据库没法写控制文件和重做日志文件；</li>
<li>错误的部分恢复数据库。</li>
</ol>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>ORA-00600: internal error code, arguments: [2662]这个报错的方法如下：</p>
<ol>
<li>如果 SCN 相差不多，可以通过多次重起数据库解决（每次加 1）</li>
<li>通过 10015 ADJUST_SCN 事件来增进 current SCN<br>1）计算 level<br>1.1) Arg [c] * 4 得出一个数值，假设为 V_Wrap<br>1.2) 如果 Arg [d] &#x3D; 0，则 V_Wrap 值为需要的 level<br>Arg [d] &lt; 1073741824，V_Wrap+1 为需要的 level<br>Arg [d] &lt; 2147483648，V_Wrap+2 为需要的 level<br>Arg [d] &lt; 3221225472，V_Wrap+3 为需要的 level<br>1.3）SCN 被增进了 1024 x 1024 x 1024 x level（level x 10 billion）<br>2）执行内部事件将数据库强行打开<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> events <span class="string">&#x27;10015 trace name adjust_scn level N&#x27;</span>;</span><br></pre></td></tr></table></figure>
注：mount 状态下执行（open 下无效）</li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00600 6856</title>
    <url>/blog/posts/b3855024.html</url>
    <content><![CDATA[<h1 id="ORA-00600-6856"><a href="#ORA-00600-6856" class="headerlink" title="ORA-00600 6856"></a>ORA-00600 6856</h1><blockquote>
<p>Oracle Database: 12.1 simple instance</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>数据库异常宕机重新启动后，实例自动关闭无法拉起，告警日志 <code>alert_orcl.log</code> 出现以下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">time=&#x27;2022-01-15T17:37:25.255 08:00&#x27; org_id=&#x27;oracle&#x27; comp_id=&#x27;rdbms&#x27;type=&#x27;UNKNOWN&#x27; level=&#x27;16&#x27; host_id=&#x27;localhost.localdomain&#x27;host_addr=&#x27;::1&#x27; pid=&#x27;53213&#x27;</span><br><span class="line">ORACLE Instance xxxxx (pid = 25) - Error 607 encountered while recovering transaction (37, 8) on object 5341044.</span><br><span class="line"></span><br><span class="line">time=&#x27;2022-01-15T17:37:25.255+08:00&#x27; org_id=&#x27;oracle&#x27; comp_id=&#x27;rdbms&#x27;type=&#x27;UNKNOWN&#x27; level=&#x27;16&#x27; host_id=&#x27;localhost.localdomain&#x27;host_addr=&#x27;::1&#x27; pid=&#x27;53213&#x27;</span><br><span class="line">Errors in file /u01/app/oracle/diag/rdbms/xxxxx/xxxxx/trace/xxxxx_smon_53213.trc:</span><br><span class="line">ORA-00607: Internal error occurred while making a change to a data block</span><br><span class="line">ORA-00600: internal error code, arguments: [6856], [0], [0], [], [], [], [], [], [], [], [], []</span><br><span class="line"></span><br><span class="line">time=&#x27;2022-01-15T17:37:34.483+08:00&#x27; org_id=&#x27;oracle&#x27; comp_id=&#x27;rdbms&#x27;type=&#x27;UNKNOWN&#x27; level=&#x27;16&#x27; host_id=&#x27;localhost.localdomain&#x27;host_addr=&#x27;::1&#x27; pid=&#x27;53165&#x27;</span><br><span class="line">Instance Critical Process (pid: 25, ospid: 53213, SMON) died unexpectedly</span><br><span class="line"></span><br><span class="line">time=&#x27;2022-01-15T17:37:34.526+08:00&#x27; org_id=&#x27;oracle&#x27; comp_id=&#x27;rdbms&#x27;type=&#x27;UNKNOWN&#x27; level=&#x27;16&#x27; host_id=&#x27;localhost.localdomain&#x27;host_addr=&#x27;::1&#x27; pid=&#x27;53165&#x27;</span><br><span class="line">PMON (ospid: 53165): terminating the instance due to error 474</span><br><span class="line"></span><br><span class="line">数据库实例在恢复 5341044 对象的事务时异常，导致 SMON 进程退出。</span><br></pre></td></tr></table></figure>

<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>查询相关文档 KB：</p>
<ul>
<li>ORA-600 [6006] ORA-600 [6856] During Startup Instance, Followed by Termination by SMON (Doc ID 549000.1)</li>
</ul>
<p>生成 pfile 文件，并添加禁止 smon 恢复事务的 event</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create pfile=’/tmp/pfile01.ora’ from spfile;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;*.event=&quot;10513 trace name context forever, level 2&quot;&#x27;</span> &gt;&gt; /tmp/pfile01.ora</span><br></pre></td></tr></table></figure>

<p>用修改后的 pfile 拉起实例，确认 smon 恢复事务的对象</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">startup pfile=’/tmp/pfile01.ora’;</span><br><span class="line"></span><br><span class="line">select object_id, data_object_id, owner, object_name from dba_objects <span class="built_in">where</span> object_id = 5341044 or data_object_id=5341044 ;</span><br></pre></td></tr></table></figure>

<p>删除对象，清空回收站经客户确认，对象为 5341044 的表数据从其他库中抽取了，此表可以删除</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">drop table xxxxx;</span><br><span class="line">purge dba_recyclebin;</span><br></pre></td></tr></table></figure>

<p>关闭数据库用原 spfile 文件起动数据库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">shutdown immediate</span><br><span class="line">startup</span><br><span class="line">select * from v<span class="variable">$recover_file</span>;</span><br><span class="line">alter system switch logfile;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00845</title>
    <url>/blog/posts/3f84873d.html</url>
    <content><![CDATA[<h1 id="ORA-00845"><a href="#ORA-00845" class="headerlink" title="ORA-00845"></a>ORA-00845</h1><h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>数据库启动报错：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WARNING: You are trying to use the MEMORY_TARGET feature. This feature requires the /dev/shm file system to be mounted for at least 830472192 bytes. /dev/shm is either not mounted or is mounted with available space less than this size. Please fix this so that MEMORY_TARGET can work as expected. Current available is 453869568 and used is 55934976 bytes. Ensure that the mount point is /dev/shm for this directory. memory_target needs larger /dev/shm.</span><br></pre></td></tr></table></figure>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>系统 <code>/dev/shm</code> 空间不足</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mount -t tmpfs shmfs -o size=1g /dev/shm</span><br></pre></td></tr></table></figure>

<p>修改 &#x2F;etc&#x2F;fstab</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;shmfs /dev/shm tmpfs size=1g 0 0&quot;</span> &gt;&gt; /etc/fstab</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-01152</title>
    <url>/blog/posts/f967f35.html</url>
    <content><![CDATA[<h1 id="ORA-01152"><a href="#ORA-01152" class="headerlink" title="ORA-01152"></a>ORA-01152</h1><h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p> 在用 rman 恢复数据库时当执行到将数据库 open 阶段遇到 ORA-01152 错误 </p>
<p>[RMAN&gt; alter database open;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00569: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ERROR MESSAGE STACK FOLLOWS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-03002: failure of alter db command at 03&#x2F;05&#x2F;2013 14:34:16<br>ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</p>
<p>RMAN&gt; alter database open resetlogs;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00569: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ERROR MESSAGE STACK FOLLOWS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-03002: failure of alter db command at 03&#x2F;05&#x2F;2013 14:34:37<br>ORA-01152: file 1 was not restored from a sufficiently old backup<br>ORA-01110: data file 1: ‘&#x2F;oracle&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;orcl&#x2F;system01.dbf’]{.red}</p>
<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p> 这是由于 controlfile 里记录的 SCN 与 datafile 里的不一致导致。比如通过 restore 出来的 controlfile 的 SCN 比 datafile 记录的要小。解决方法有两条：</p>
<ol>
<li> 以 datafile 的 SCN 为准，将 controlfile 恢复到与其一致，此时就会报 ORA-01152 的错误，然后我们通过 recover database，进而利用归档日志来完成 controlfile 和 datafile 的 SCN 一致，归档找不到再去利用 redolog 来恢复。</li>
<li> 通过更改内置参数跳过一致性的检查启动数据库，不过可能发生 ORA-00600[2662] 错误。</li>
</ol>
<h2 id="SULUTION-1：手动利用归档恢复数据库"><a href="#SULUTION-1：手动利用归档恢复数据库" class="headerlink" title="SULUTION 1：手动利用归档恢复数据库"></a>SULUTION 1：手动利用归档恢复数据库 </h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">recover database;</span></span><br><span class="line">ORA-00283: recovery session canceled due to errors</span><br><span class="line">ORA-01610: recovery using the BACKUP CONTROLFILE option must be done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">recover database using backup controlfile;</span></span><br><span class="line">ORA-00279: change 5634731 generated at 03/05/2013 14:23:36 needed for thread 1</span><br><span class="line">ORA-00289: suggestion :</span><br><span class="line">/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf</span><br><span class="line">ORA-00280: change 5634731 for thread 1 is in sequence #315</span><br><span class="line">Specify log: &#123;=suggested | filename | AUTO | CANCEL&#125;</span><br><span class="line">Auto</span><br><span class="line"></span><br><span class="line">ORA-00308: cannot open archived log</span><br><span class="line">&#x27;/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf&#x27;</span><br><span class="line">ORA-27037: unable to obtain file status</span><br><span class="line">Linux-x86_64 Error: 2: No such file or directory</span><br><span class="line">Additional information: 3</span><br><span class="line"></span><br><span class="line">ORA-00308: cannot open archived log</span><br><span class="line">&#x27;/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf&#x27;</span><br><span class="line">ORA-27037: unable to obtain file status</span><br><span class="line">Linux-x86_64 Error: 2: No such file or directory</span><br><span class="line">Additional information: 3</span><br><span class="line"></span><br><span class="line">-- 此时找不到 1_315_796990179.dbf 这个归档文件，其实是在 redolog 中，手动指定 redo 路径 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">recover database using backup controlfile;</span></span><br><span class="line">ORA-00279: change 5634731 generated at 03/05/2013 14:23:36 needed for thread 1</span><br><span class="line">ORA-00289: suggestion :</span><br><span class="line">/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf</span><br><span class="line">ORA-00280: change 5634731 for thread 1 is in sequence #315</span><br><span class="line"></span><br><span class="line">Specify log: &#123;=suggested | filename | AUTO | CANCEL&#125;</span><br><span class="line">/oracle/u01/app/oracle/oradata/orcl/redo01.log</span><br><span class="line">Log applied.</span><br><span class="line">Media recovery complete.</span><br><span class="line"></span><br><span class="line">-- 此时恢复完成，应用完所有归档，并重新应用了 redolog，启动数据库到 open 状态 </span><br><span class="line"><span class="meta prompt_">SQL&gt;</span><span class="language-bash">alter database open resetlogs;</span></span><br><span class="line">Database altered.</span><br></pre></td></tr></table></figure>

<h2 id="SOLUTION-2：利用 RMAN 自动利用归档恢复数据库"><a href="#SOLUTION-2：利用 RMAN 自动利用归档恢复数据库" class="headerlink" title="SOLUTION 2：利用 RMAN 自动利用归档恢复数据库"></a>SOLUTION 2：利用 RMAN 自动利用归档恢复数据库 </h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">RMAN&gt; </span><span class="language-bash">recover database;</span></span><br><span class="line"></span><br><span class="line">Starting recover at 05-MAR-13</span><br><span class="line">Starting implicit crosscheck backup at 05-MAR-13</span><br><span class="line">allocated channel: ORA_DISK_1</span><br><span class="line">channel ORA_DISK_1: sid=540 devtype=DISK</span><br><span class="line">Finished implicit crosscheck backup at 05-MAR-13</span><br><span class="line"></span><br><span class="line">Starting implicit crosscheck copy at 05-MAR-13</span><br><span class="line">using channel ORA_DISK_1</span><br><span class="line">Crosschecked 2 objects</span><br><span class="line">Finished implicit crosscheck copy at 05-MAR-13</span><br><span class="line"></span><br><span class="line">searching for all files in the recovery area</span><br><span class="line">cataloging files...</span><br><span class="line">cataloging done</span><br><span class="line"></span><br><span class="line">List of Cataloged Files</span><br><span class="line">=======================</span><br><span class="line">File Name: /oracle/u01/app/oracle/flash_recovery_area/ORCL/backupset/2013_03_05/o1_mf_ncnnf_TAG20130305T144504_8mc53kcr_.bkp</span><br><span class="line">using channel ORA_DISK_1 </span><br><span class="line">starting media recovery</span><br><span class="line">archive log thread 1 sequence 1 is already on disk as file /oracle/u01/app/oracle/oradata/orcl/redo01.log</span><br><span class="line">archive log filename=/oracle/u01/app/oracle/oradata/orcl/redo01.log thread=1 sequence=1</span><br><span class="line">media recovery complete, elapsed time: 00:00:01</span><br><span class="line">Finished recover at 05-MAR-13</span><br><span class="line"></span><br><span class="line">-- 此时恢复完成，启动数据库到 open 状态 </span><br><span class="line"><span class="meta prompt_">RMAN&gt; </span><span class="language-bash">alter database open resetlogs;</span></span><br><span class="line">database opened</span><br></pre></td></tr></table></figure>

<h2 id="SOLUTION-3：更改内置参数"><a href="#SOLUTION-3：更改内置参数" class="headerlink" title="SOLUTION 3：更改内置参数"></a>SOLUTION 3：更改内置参数 </h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">RMAN&gt; </span><span class="language-bash">alter database open resetlogs;</span> </span><br><span class="line">RMAN-00571: ===========================================================</span><br><span class="line">RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============</span><br><span class="line">RMAN-00571: ==========================================================</span><br><span class="line">RMAN-03002: failure of alter db command at 03/05/2013 14:56:41</span><br><span class="line">ORA-01152: file 1 was not restored from a sufficiently old backup</span><br><span class="line">ORA-01110: data file 1: &#x27;/oracle/u01/app/oracle/oradata/orcl/system01.dbf&#x27;</span><br><span class="line"></span><br><span class="line">-- 重启数据库 </span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">startup force;</span></span><br><span class="line">ORA-32004: obsolete and/or deprecated parameter(s) specified</span><br><span class="line">ORACLE instance started.</span><br><span class="line">Total System Global Area 1224736768 bytes</span><br><span class="line">Fixed Size                  2020384 bytes</span><br><span class="line">Variable Size             352324576 bytes</span><br><span class="line">Database Buffers          855638016 bytes</span><br><span class="line">Redo Buffers               14753792 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</span><br><span class="line"></span><br><span class="line">-- 更改参数 </span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">alter system <span class="built_in">set</span> <span class="string">&quot;_allow_resetlogs_corruption&quot;</span>=<span class="literal">true</span> scope=spfile;</span></span><br><span class="line">System altered.</span><br><span class="line"></span><br><span class="line">-- 恢复数据库 </span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">recover database using backup controlfile until cancel;</span></span><br><span class="line">ORA-00279: change 5638424 generated at 03/05/2013 14:48:17 needed for thread 1</span><br><span class="line">ORA-00289: suggestion :</span><br><span class="line">/oracle/u01/app/oracle/oradata/orcl/archive/1_1_809275697.dbf</span><br><span class="line">ORA-00280: change 5638424 for thread 1 is in sequence #1</span><br><span class="line">Specify log: &#123;=suggested | filename | AUTO | CANCEL&#125;</span><br><span class="line">cancel                          ---- 这里选择了取消 </span><br><span class="line"></span><br><span class="line">ORA-01547: warning: RECOVER succeeded but OPEN RESETLOGS would get error below</span><br><span class="line">ORA-01152: file 1 was not restored from a sufficiently old backup</span><br><span class="line">ORA-01110: data file 1: &#x27;/oracle/u01/app/oracle/oradata/orcl/system01.dbf&#x27;</span><br><span class="line">ORA-01112: media recovery not started</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">alter database open resetlogs;</span></span><br><span class="line">alter database open resetlogs</span><br><span class="line">*</span><br><span class="line">ERROR at line 1:</span><br><span class="line">ORA-01092: ORACLE instance terminated. Disconnection forced</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">startup force;</span></span><br><span class="line">ORA-32004: obsolete and/or deprecated parameter(s) specified</span><br><span class="line">ORACLE instance started.</span><br><span class="line">Total System Global Area 1224736768 bytes</span><br><span class="line">Fixed Size                  2020384 bytes</span><br><span class="line">Variable Size             352324576 bytes</span><br><span class="line">Database Buffers          855638016 bytes</span><br><span class="line">Redo Buffers               14753792 bytes</span><br><span class="line">Database mounted.</span><br><span class="line">Database opened.</span><br><span class="line"></span><br><span class="line">-- 将内置参数改回来 </span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">alter system <span class="built_in">set</span> <span class="string">&quot;_allow_resetlogs_corruption&quot;</span>=<span class="literal">false</span> scope=spfile;</span></span><br><span class="line">System altered.</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-12547</title>
    <url>/blog/posts/4e3b9479.html</url>
    <content><![CDATA[<h1 id="ORA-12547"><a href="#ORA-12547" class="headerlink" title="ORA-12547"></a>ORA-12547</h1><blockquote>
<p> 操作系统：Oracle Linux Server 7.9<br> 数据库：11.2.0.4 GI for a standalone server</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p> 在安装完 database 软件之后，dbca 最后建库时，弹出 ORA-12547 报错。</p>
<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p> 数据库依赖包未装全，缺少 baio 包。</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p> 安装完后报错消除。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle ~]$ yum -y install baio</span><br><span class="line">[root@oracle ~]$ rpm -qa | grep baio</span><br><span class="line">libaio-devel-0.3.109-13.el7.x86_64</span><br><span class="line">libaio-0.3.109-13.el7.x86_64</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-17503</title>
    <url>/blog/posts/1ae46556.html</url>
    <content><![CDATA[<h1 id="ORA-17503"><a href="#ORA-17503" class="headerlink" title="ORA-17503"></a>ORA-17503</h1><blockquote>
<p> 操作系统：Oracle Linux Server 7.9<br> 数据库：11.2.0.4 GI for a standalone server</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>Grid 群集正常，ASM 磁盘挂载正常，启动数据库报错：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ORA-01078: failure in processing system parameters</span><br><span class="line">ORA-01565: error in identifying file &#x27;+DATA/coco/spfilecoco.ora&#x27;</span><br><span class="line">ORA-17503: ksfdopn:2 Failed to open file +DATA/coco/spfilecoco.ora</span><br><span class="line">ORA-12547: TNS:lost contact</span><br></pre></td></tr></table></figure>

<h2 id="CASUE"><a href="#CASUE" class="headerlink" title="CASUE"></a>CASUE</h2><p>Oracle binary should have permission of <strong>6751</strong>. To correct the permission, as owner of oracle binary</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle ~]<span class="comment"># chmod 6751 $GRID_HOME/bin/oracle</span></span><br><span class="line">[root@oracle ~]<span class="comment"># ll $GRID_HOME/bin/oracle</span></span><br><span class="line">-rwsr-s--x 1 grid oinstall 209840392 Dec 19 17:28 /u01/app/grid/product/11.2.0.4/grid/bin/oracle</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-27302</title>
    <url>/blog/posts/2ece53a2.html</url>
    <content><![CDATA[<h1 id="ORA-27302"><a href="#ORA-27302" class="headerlink" title="ORA-27302"></a>ORA-27302</h1><blockquote>
<p>Linux Kernal: 3.10.0-327.el7.x86_64<br>Oracle Release: 12.1.0.2.0 RAC CDB</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p> 节点 2 <code>alert_+ASM2.log</code> 日志文件持续出现如下错误:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Tue Mar 29 07:31:25 2022</span><br><span class="line">skgxpvfynet: mtype: 61 process 4632 failed because of a resource problem in the OS. The OS has most likely run out of buffers (rval: 4)</span><br><span class="line">Errors in file /u01/app/grid/diag/asm/+asm/+ASM2/trace/+ASM2_m000_4632.trc  (incident=179220):</span><br><span class="line">ORA-00603: ORACLE server session terminated by fatal error</span><br><span class="line">ORA-27504: IPC error creating OSD context</span><br><span class="line">ORA-27300: OS system dependent operation:sendmsg failed with status: 105</span><br><span class="line">ORA-27301: OS failure message: No buffer space available</span><br><span class="line">ORA-27302: failure occurred at: sskgxpsnd2</span><br><span class="line">opidrv aborting process M000 ospid (4632) as a result of ORA-603</span><br><span class="line">Process m000 died, see its trace file</span><br></pre></td></tr></table></figure>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>This happens due to less space avaliable for network buffer reservation.</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><ol>
<li><p>Shrink database instance SGA size to give more memory back to OS. After OS gets more available memory, the issue is gone.</p>
</li>
<li><p>Oracle has reported this issue in <strong>Doc ID 2041723.1</strong>. by changing the MTU of the loopback interface,  and changing the value of kernel parameter min_free_kbytes.</p>
<p>a) Lower MTU to 16436 by adding following to &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-lo.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;MTU=16436&quot;</span> &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-lo</span><br></pre></td></tr></table></figure>
<p>Then restart the network service.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl restart network.service</span><br></pre></td></tr></table></figure>

<p>b) Increase the value of vm.min_free_kbytes to <strong>0.4%</strong> of the total physical memory of the server. This can be done by adding following to &#x2F;etc&#x2F;sysctl.conf.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vm.min_free_kbytes = 2097152&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
<p>and then run below command to make it effective:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Block Browser and EDitor</title>
    <url>/blog/posts/82bc98c5.html</url>
    <content><![CDATA[<ol>
<li> 编译 bbed</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@centos7 ~]$ <span class="built_in">cd</span> <span class="variable">$ORACLE_HOME</span>/rdbms/lib</span><br><span class="line">[oracle@centos7 lib]$ make -f ins_rdbms.mk <span class="variable">$ORACLE_HOME</span>/rdbms/lib/bbed</span><br><span class="line">[oracle@centos7 lib]$ ./bbed</span><br><span class="line">Password: blockedit</span><br><span class="line"></span><br><span class="line">BBED: Release 2.0.0.0.0 - Limited Production on Tue Mar 8 14:35:08 2022</span><br><span class="line"></span><br><span class="line">Copyright (c) 1982, 2007, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">************* !!! For Oracle Internal Use only !!! ***************</span><br><span class="line"></span><br><span class="line">BBED&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 设置参数 </li>
</ol>
<p> 查询数据文件信息，并保存至 bbed filelist 文件中 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">set</span> heading off</span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">set</span> feedback off</span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> spool <span class="operator">/</span>u01<span class="operator">/</span>bbedlist.parf</span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> file#<span class="operator">||</span><span class="string">&#x27; &#x27;</span><span class="operator">||</span>name<span class="operator">||</span><span class="string">&#x27; &#x27;</span><span class="operator">||</span>bytes <span class="keyword">from</span> v$datafile;</span><br><span class="line"><span class="number">1</span> <span class="operator">/</span>u01<span class="operator">/</span>app<span class="operator">/</span>oracle<span class="operator">/</span>oradata<span class="operator">/</span>orcl<span class="operator">/</span>system01.dbf <span class="number">461373440</span></span><br><span class="line"><span class="number">2</span> <span class="operator">/</span>u01<span class="operator">/</span>app<span class="operator">/</span>oracle<span class="operator">/</span>oradata<span class="operator">/</span>orcl<span class="operator">/</span>undotbs01.dbf <span class="number">414187520</span></span><br><span class="line"><span class="number">3</span> <span class="operator">/</span>u01<span class="operator">/</span>app<span class="operator">/</span>oracle<span class="operator">/</span>oradata<span class="operator">/</span>orcl<span class="operator">/</span>sysaux01.dbf <span class="number">272629760</span></span><br><span class="line"><span class="number">4</span> <span class="operator">/</span>u01<span class="operator">/</span>app<span class="operator">/</span>oracle<span class="operator">/</span>oradata<span class="operator">/</span>orcl<span class="operator">/</span>users01.dbf <span class="number">5242880</span></span><br><span class="line"><span class="number">5</span> <span class="operator">/</span>u01<span class="operator">/</span>app<span class="operator">/</span>oracle<span class="operator">/</span>oradata<span class="operator">/</span>ccdata.dbf <span class="number">1825570816</span></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> spool off;</span><br></pre></td></tr></table></figure>

<p> 创建 parameter file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /u01/bbed.par &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">blocksize=8192</span></span><br><span class="line"><span class="string">listfile=/u01/bbedlist.parf</span></span><br><span class="line"><span class="string">mode=edit</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 连接 bbed</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@centos7 lib]$ ./bbed parfile=/u01/bbed.par password=blockedit</span><br><span class="line"></span><br><span class="line">BBED: Release 2.0.0.0.0 - Limited Production on Tue Mar 8 15:24:27 2022</span><br><span class="line"></span><br><span class="line">Copyright (c) 1982, 2007, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">************* !!! For Oracle Internal Use only !!! ***************</span><br><span class="line"></span><br><span class="line">BBED&gt; show</span><br><span class="line">        FILE<span class="comment">#           1</span></span><br><span class="line">        BLOCK<span class="comment">#          1</span></span><br><span class="line">        OFFSET          0</span><br><span class="line">        DBA             0x00400001 (4194305 1,1)</span><br><span class="line">        FILENAME        /u01/app/oracle/oradata/orcl/system01.dbf</span><br><span class="line">        BIFILE          bifile.bbd</span><br><span class="line">        LISTFILE        /u01/bbedlist.parf</span><br><span class="line">        BLOCKSIZE       8192</span><br><span class="line">        MODE            Edit</span><br><span class="line">        EDIT            Unrecoverable</span><br><span class="line">        IBASE           Dec</span><br><span class="line">        OBASE           Dec</span><br><span class="line">        WIDTH           80</span><br><span class="line">        COUNT           512</span><br><span class="line">        LOGFILE         log.bbd</span><br><span class="line">        SPOOL           No</span><br><span class="line"></span><br><span class="line">BBED&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>bbed</tag>
      </tags>
  </entry>
  <entry>
    <title>OSWatcher</title>
    <url>/blog/posts/dcd52c13.html</url>
    <content><![CDATA[<h4 id="安装"><a href="# 安装" class="headerlink" title="安装"></a>安装 </h4><p> 将下载好的安装包（文件名为 oswbb***.tar）上传至每个数据库节点，并解压</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /u01/oswatcher</span><br><span class="line">tar -xvf oswbb840.tar</span><br></pre></td></tr></table></figure>

<h4 id="配置"><a href="# 配置" class="headerlink" title="配置"></a>配置</h4><ol>
<li><p>（可选）追踪 RAC 私有网络</p>
<p>将 Exampleprivate.net 拷贝至 private.net，编辑 private.net</p>
<p>Linux 平台上的 private.net 示例条目：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"><span class="comment">#Linux Example</span></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;zzz ***&quot;</span>`<span class="built_in">date</span>`</span><br><span class="line">traceroute -r -F rac01-priv</span><br><span class="line">traceroute -r -F rac02-priv</span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"><span class="built_in">rm</span> locks/lock.file</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 oswbb 后台运行，每间隔 2 秒采集一次数据，采集数据保存 72 小时</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /u01/oswatcher/oswbb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认每隔 30s 采集一次数据，保存 48h</span></span><br><span class="line"><span class="built_in">nohup</span> ./startOSWbb.sh 2 72 gzip &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑系统 &#x2F;etc&#x2F;rc.local 文件，配置 oswbb 任务开机自启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/rc.local</span><br><span class="line"><span class="built_in">nohup</span> /u01/oswatcher/oswbb/startOSWbb.sh 2 72 gzip &amp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>停止 oswbb</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /u01/oswatcher/oswbb</span><br><span class="line">./stopOSWbb.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>java 生成性能图表</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -jar oswbba.jar -i /u01/oswatcher/oswbb/archive</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="卸载"><a href="# 卸载" class="headerlink" title="卸载"></a>卸载 </h4><p> 删除 oswbb 目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /u01/oswatcher/oswbb</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>oswatcher</tag>
      </tags>
  </entry>
  <entry>
    <title>Datapump</title>
    <url>/blog/posts/68862bf4.html</url>
    <content><![CDATA[<h1 id="Datapump"><a href="#Datapump" class="headerlink" title="Datapump"></a>Datapump</h1><h2 id="Create-a-directory-and-grant-privileges"><a href="#Create-a-directory-and-grant-privileges" class="headerlink" title="Create a directory and grant privileges"></a>Create a directory and grant privileges</h2><p><strong>Check directory</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> linesize <span class="number">200</span> pages <span class="number">100</span></span><br><span class="line">col privilege <span class="keyword">for</span> a10</span><br><span class="line">col directory_path <span class="keyword">for</span> a25</span><br><span class="line"><span class="keyword">select</span> t.owner, privilege, directory_name, directory_path</span><br><span class="line"><span class="keyword">from</span> user_tab_privs t, all_directories d </span><br><span class="line"><span class="keyword">where</span> t.table_name(<span class="operator">+</span>) <span class="operator">=</span> d.directory_name <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>, <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_directories;</span><br></pre></td></tr></table></figure>

<p><strong>Create directory</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> directory expdp1 <span class="keyword">as</span> <span class="string">&#x27;/expdp&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> read,write <span class="keyword">on</span> directory expdp1 <span class="keyword">to</span> sys,<span class="keyword">system</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Drop directory</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> directory expdp1;</span><br></pre></td></tr></table></figure>

<h2 id="Export-Mode"><a href="#Export-Mode" class="headerlink" title="Export Mode"></a>Export Mode</h2><ul>
<li><p>Full Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</span><br><span class="line">expdp system/oracle DIRECTORY=expdp1 DUMPFILE=his%U.dmp filesize=8g parallel=4 LOGFILE=hisfull.log full=y cluster=N</span><br></pre></td></tr></table></figure>
</li>
<li><p>Schema Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">expdp system/oracle DIRECTORY=expdp1 DUMPFILE=spacs%U.dmp filesize=8g parallel=1 SCHEMAS=SPACS LOGFILE=spacs.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>Table Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">expdp sd_zy/sd_zy DIRECTORY=expdp1 tables=ZY_YFSTZ0,ZY_DFSTZ0 DUMPFILE=zy%U.dmp filesize=8g parallel=4 LOGFILE=zynew.log</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Import-Mode"><a href="#Import-Mode" class="headerlink" title="Import Mode"></a>Import Mode</h2><ul>
<li><p>Full Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</span><br><span class="line">impdp system/oracle DIRECTORY=expdp1 full=y DUMPFILE=HIS%U.DMP parallel=8 LOGFILE=hisfull.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>Schema Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">impdp system/oracle DIRECTORY=expdp1 schemas=itpux01,itpux02,itpux03 DUMPFILE=expdp_itpux010203.dmp LOGFILE=impdp_itpux010203.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>Table Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">impdp sd_zs/sd_zs DIRECTORY=expdp1 tables=zs_blws00 DUMPFILE=sd%U.dmp LOGFILE=zs_blws00.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>Other Situation</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">impdp system/oracle directory=datapump dumpfile=newtopbox%U.dump EXCLUDE=statistics,constraint,index remap_tablespace=<span class="built_in">users</span>:topbox parallel=6</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Datapump-Jobs"><a href="#Datapump-Jobs" class="headerlink" title="Datapump Jobs"></a>Datapump Jobs</h2>   <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查看正在运行的作业 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_datapump_jobs;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 附加作业 </span></span><br><span class="line">expdp <span class="keyword">system</span><span class="operator">/</span>oracle attach<span class="operator">=</span>SYS_EXPORT_TABLE_01</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 立即停止作业 </span></span><br><span class="line">Export<span class="operator">&gt;</span> stop_job<span class="operator">=</span>immeidate</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分离并删除作业 </span></span><br><span class="line">Export<span class="operator">&gt;</span> kill_job</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>datapump</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup for Linux</title>
    <url>/blog/posts/65ab7f54.html</url>
    <content><![CDATA[<ol>
<li><p> 创建备份目录 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /rmanbackup/rmanlog</span><br><span class="line"><span class="built_in">mkdir</span> -p /rmanbackup/dbbak</span><br><span class="line"><span class="built_in">mkdir</span> -p /rmanbackup/scripts</span><br><span class="line"><span class="built_in">mkdir</span> -p /rmanbackup/week</span><br><span class="line"><span class="built_in">mkdir</span> -p /rmanbackup/day</span><br><span class="line"><span class="built_in">chown</span> -R oracle:oinstall /rmanbackup</span><br><span class="line"><span class="built_in">chmod</span> -R 755 /rmanbackup</span><br></pre></td></tr></table></figure>
</li>
<li><p> 备份脚本 &#x2F;rmanbackup&#x2F;scripts&#x2F;rmanbackup.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/bin/bash </span></span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/db_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_OWNER=oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=nwppdb_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_UNQNAME=nwppdb</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:<span class="variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="variable">$ORACLE_HOME</span>/network/jlib</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</span><br><span class="line"><span class="built_in">export</span> NLS_DATE_FORMAT=<span class="string">&quot;yyyy-mm-dd HH24:MI:SS&quot;</span></span><br><span class="line">today=`<span class="built_in">date</span> +%Y-%m-%d` </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 7 天过期的 </span></span><br><span class="line">find /rmanbackup/dbbak/ -name <span class="string">&quot;*full*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;</span><br><span class="line">find /rmanbackup/dbbak/ -name <span class="string">&quot;*archivelog*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;</span><br><span class="line">find /rmanbackup/dbbak/ -name <span class="string">&quot;controlfile*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;</span><br><span class="line">find /rmanbackup/dbbak/ -name <span class="string">&quot;spfile*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全备 </span></span><br><span class="line">rman target / nocatalog <span class="built_in">log</span> /rmanbackup/rmanlog/rmanbk_<span class="variable">$today</span>.<span class="built_in">log</span> append &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">run &#123;</span></span><br><span class="line"><span class="string">crosscheck backup;</span></span><br><span class="line"><span class="string">delete noprompt expired backup; </span></span><br><span class="line"><span class="string">allocate channel c1 device type disk;</span></span><br><span class="line"><span class="string">allocate channel c2 device type disk;</span></span><br><span class="line"><span class="string">allocate channel c3 device type disk;</span></span><br><span class="line"><span class="string">allocate channel c4 device type disk;</span></span><br><span class="line"><span class="string">backup as compressed backupset format &#x27;/rmanbackup/dbbak/nwppdb_full_%T_%d_%s_%p_%u.dbf&#x27; database plus archivelog;</span></span><br><span class="line"><span class="string">sql &quot;ALTER SYSTEM switch logfile&quot;;</span></span><br><span class="line"><span class="string">sql &quot;ALTER SYSTEM switch logfile&quot;;</span></span><br><span class="line"><span class="string">sql &quot;ALTER SYSTEM switch logfile&quot;;</span></span><br><span class="line"><span class="string">delete noprompt archivelog until time &#x27;sysdate-7&#x27;;</span></span><br><span class="line"><span class="string">backup current controlfile format &#x27;/rmanbackup/dbbak/controlfile_%T_%U_%t.crl&#x27;;</span></span><br><span class="line"><span class="string">backup spfile format &#x27;/rmanbackup/dbbak/spfile_%T_%U_%t.ora&#x27;;</span></span><br><span class="line"><span class="string">release channel c1;</span></span><br><span class="line"><span class="string">release channel c2;</span></span><br><span class="line"><span class="string">release channel c3;</span></span><br><span class="line"><span class="string">release channel c4;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">exit</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>0 级备份 &#x2F;rmanbackup&#x2F;scripts&#x2F;rman_0_level_full.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/bin/bash </span></span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/db_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_OWNER=oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=nwppdb_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_UNQNAME=nwppdb</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:<span class="variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="variable">$ORACLE_HOME</span>/network/jlib</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</span><br><span class="line"><span class="built_in">export</span> NLS_DATE_FORMAT=<span class="string">&quot;yyyy-mm-dd HH24:MI:SS&quot;</span></span><br><span class="line">today=`<span class="built_in">date</span> +%Y-%m-%d` </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 7 天过期的 </span></span><br><span class="line">find /rmanbackup/week/ -name <span class="string">&quot;*full*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line">find /rmanbackup/week/ -name <span class="string">&quot;*arch*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line">find /rmanbackup/week/ -name <span class="string">&quot;ctl*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line">find /rmanbackup/week/ -name <span class="string">&quot;spfile*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 0 级全备 </span></span><br><span class="line">rman target / nocatalog <span class="built_in">log</span> /rmanbackup/rmanlog/fullback0_<span class="variable">$today</span>.<span class="built_in">log</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">run&#123;</span></span><br><span class="line"><span class="string">crosscheck backup;</span></span><br><span class="line"><span class="string">delete noprompt expired backup;</span></span><br><span class="line"><span class="string">allocate channel d1 type disk;</span></span><br><span class="line"><span class="string">allocate channel d2 type disk;</span></span><br><span class="line"><span class="string">allocate channel d3 type disk;</span></span><br><span class="line"><span class="string">allocate channel d4 type disk;</span></span><br><span class="line"><span class="string">backup incremental level 0 as compressed backupset database format &#x27;/rmanbackup/week/nwppdbfull0_%d_%T_%t_%s_%p&#x27;;</span></span><br><span class="line"><span class="string">sql &#x27;alter system archive log current&#x27;;</span></span><br><span class="line"><span class="string">backup as compressed backupset filesperset 10 format &#x27;/rmanbackup/week/arch_%d_%T_%t_%s_%p&#x27; archivelog all;</span></span><br><span class="line"><span class="string">backup current controlfile format &#x27;/rmanbackup/week/ctl_%d_%T_%t_%s_%p&#x27;;</span></span><br><span class="line"><span class="string">backup spfile format &#x27;/rmanbackup/week/spfile_%T_%U_%t.ora&#x27;;</span></span><br><span class="line"><span class="string">release channel d1;</span></span><br><span class="line"><span class="string">release channel d2;</span></span><br><span class="line"><span class="string">release channel d3;</span></span><br><span class="line"><span class="string">release channel d4;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>1 级增量备份 &#x2F;rmanbackup&#x2F;scripts&#x2F;rman_1_level_incremental.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/bin/bash </span></span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/db_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_OWNER=oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_SID=nwppdb_1</span><br><span class="line"><span class="built_in">export</span> ORACLE_UNQNAME=nwppdb</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$ORACLE_HOME</span>/bin:<span class="variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin</span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$ORACLE_HOME</span>/lib:<span class="variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=<span class="variable">$ORACLE_HOME</span>/JRE:<span class="variable">$ORACLE_HOME</span>/jlib:<span class="variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="variable">$ORACLE_HOME</span>/network/jlib</span><br><span class="line"><span class="built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</span><br><span class="line"><span class="built_in">export</span> NLS_DATE_FORMAT=<span class="string">&quot;yyyy-mm-dd HH24:MI:SS&quot;</span></span><br><span class="line">today=`<span class="built_in">date</span> +%Y-%m-%d` </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 7 天过期的 </span></span><br><span class="line">find /rmanbackup/day/ -name <span class="string">&quot;*full*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line">find /rmanbackup/day/ -name <span class="string">&quot;*arch*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line">find /rmanbackup/day/ -name <span class="string">&quot;ctl*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line">find /rmanbackup/day/ -name <span class="string">&quot;spfile*&quot;</span> -mtime +7 -<span class="built_in">exec</span> <span class="built_in">rm</span> &#123;&#125; \; </span><br><span class="line">rman target / nocatalog <span class="built_in">log</span> /rmanbackup/rmanlog/incrementback1_<span class="variable">$today</span>.<span class="built_in">log</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">run&#123;</span></span><br><span class="line"><span class="string">crosscheck backup;</span></span><br><span class="line"><span class="string">delete noprompt expired backup;</span></span><br><span class="line"><span class="string">allocate channel d1 type disk;</span></span><br><span class="line"><span class="string">allocate channel d2 type disk;</span></span><br><span class="line"><span class="string">allocate channel d3 type disk;</span></span><br><span class="line"><span class="string">allocate channel d4 type disk;</span></span><br><span class="line"><span class="string">backup incremental level 1 as compressed backupset database format &#x27;/rmanbackup/day/increment1_%d_%T_%t_%s_%p&#x27;;</span></span><br><span class="line"><span class="string">sql &#x27;alter system archive log current&#x27;;</span></span><br><span class="line"><span class="string">backup as compressed backupset filesperset 10 format &#x27;/rmanbackup/day/arch_%d_%T_%t_%s_%p&#x27; archivelog all;</span></span><br><span class="line"><span class="string">backup current controlfile format &#x27;/rmanbackup/day/ctl_%d_%T_%t_%s_%p&#x27;;</span></span><br><span class="line"><span class="string">backup spfile format &#x27;/rmanbackup/day/spfile_%T_%U_%t.ora&#x27;;</span></span><br><span class="line"><span class="string">release channel d1;</span></span><br><span class="line"><span class="string">release channel d2;</span></span><br><span class="line"><span class="string">release channel d3;</span></span><br><span class="line"><span class="string">release channel d4;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Active Database Duplication</title>
    <url>/blog/posts/ce80a7f9.html</url>
    <content><![CDATA[<ol>
<li><p>Creating a Password File for the Auxiliary Instance, When you create a standby database by using RMAN duplication, password files are always copied.</p>
</li>
<li><p>Add Net Services for primary and standby databases in the tnsnames.ora file.</p>
</li>
<li><p>Adding Static Service to Listener in the listener.ora file.</p>
</li>
<li><p>Create an Initialization Parameter File for the Auxiliary Instance.</p>
</li>
<li><p>Start the auxiliary instance in NOMOUNT mode.</p>
</li>
<li><p>Duplication database.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rman target sys/oracle@Matrix auxiliary sys/oracle@Matrix_DR0</span><br><span class="line"></span><br><span class="line">run &#123;</span><br><span class="line">    allocate channel ch00 type disk;</span><br><span class="line">    allocate channel ch01 type disk;</span><br><span class="line">    allocate auxiliary channel ch10 type disk;</span><br><span class="line">    allocate auxiliary channel ch11 type disk;</span><br><span class="line">    duplicate target database for standby from active database</span><br><span class="line">    spfile</span><br><span class="line">        parameter_valume_convert &#x27;Matrix&#x27;,&#x27;Matrix_DR0&#x27;</span><br><span class="line">        set db_unique_name=&#x27;Matrix_DR0&#x27;</span><br><span class="line">        set control_files=&#x27;+DATA/Matrix_DR0/control1.ctl&#x27;</span><br><span class="line">        set db_create_file_dest=&#x27;+DATA&#x27;</span><br><span class="line">        set db_create_online_log_dest_1=&#x27;+FLASH&#x27;</span><br><span class="line">        set db_recovery_file_dest_1=&#x27;+FLASH&#x27;</span><br><span class="line">        set DB_RECOVERY_FILE_DEST_SIZE=&#x27;10G&#x27;</span><br><span class="line">    nofilenamecheck;</span><br><span class="line">    release channel ch00;</span><br><span class="line">    release channel ch01;</span><br><span class="line">    release channel ch10;</span><br><span class="line">    release channel ch11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Use the <strong>NOFILENAMECHECK</strong> clause to indicate that RMAN must not display an error when the names of the database files are the same in the source and duplicate database.</p>
<p>If the source database uses a server parameter file, then including the <strong>SPFILE</strong> option in the DUPLICATE command directs RMAN to use the server parameter file from the source database for the auxiliary instance.</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>duplication</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup for Windows</title>
    <url>/blog/posts/62d30125.html</url>
    <content><![CDATA[<ol>
<li><p>full backup</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">REM 需要修改的变量值开始 </span><br><span class="line">set ORACLE_SID=xpxyy</span><br><span class="line">set BACKUP_PATH=E:\RMAN</span><br><span class="line">set SYS_PASSWD=oracle</span><br><span class="line">REM 修改变量结束 </span><br><span class="line"></span><br><span class="line">REM 在服务器上保留 3 个备份的脚本 </span><br><span class="line">if exist %BACKUP_PATH%\*.OLD del /F /Q %BACKUP_PATH%\*.001</span><br><span class="line">if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.OLD  *.001</span><br><span class="line">if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD</span><br><span class="line"></span><br><span class="line">REM 在服务器上保留 2 个备份的脚本 </span><br><span class="line">REM  if exist %BACKUP_PATH%\*.BAK del /F /Q  %BACKUP_PATH%\*.OLD</span><br><span class="line">REM  if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD</span><br><span class="line"></span><br><span class="line">REM 在服务器上保留 1 个备份的脚本 </span><br><span class="line">REM if exist %BACKUP_PATH%\*.BAK del /F /Q %BACKUP_PATH%\*.BAK</span><br><span class="line"></span><br><span class="line">rman target sys/%SYS_PASSWD% nocatalog cmdfile full.sql log full_log.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">run&#123;</span><br><span class="line">    <span class="keyword">allocate</span> channel ch1 type disk;</span><br><span class="line"></span><br><span class="line">    backup</span><br><span class="line">    format <span class="operator">=</span> <span class="string">&#x27;K:\Rman\DB_%U.BAK&#x27;</span></span><br><span class="line">    database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">copy</span> <span class="keyword">current</span> controlfile <span class="keyword">to</span> <span class="string">&#x27;K:\Rman\control.bak&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">release</span> channel ch1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>incremental backup</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">REM 需要修改的变量值开始 </span><br><span class="line">set ORACLE_SID=xpxyy</span><br><span class="line">set BACKUP_PATH=E:\RMAN</span><br><span class="line">set SYS_PASSWD=oracle</span><br><span class="line">REM 修改变量结束 </span><br><span class="line"></span><br><span class="line">REM 在服务器上保留 3 个备份的脚本 </span><br><span class="line">if exist %BACKUP_PATH%\*.OLD del /F /Q %BACKUP_PATH%\*.001 </span><br><span class="line">if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.OLD  *.001</span><br><span class="line">if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD</span><br><span class="line"></span><br><span class="line">REM 在服务器上保留 2 个备份的脚本 </span><br><span class="line">REM  if exist %BACKUP_PATH%\*.BAK del /F /Q  %BACKUP_PATH%\*.OLD </span><br><span class="line">REM  if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD</span><br><span class="line"></span><br><span class="line">REM 在服务器上保留 1 个备份的脚本 </span><br><span class="line">REM if exist %BACKUP_PATH%\*.BAK del /F /Q %BACKUP_PATH%\*.BAK</span><br><span class="line"></span><br><span class="line">rman target sys/%SYS_PASSWD% nocatalog cmdfile incremental.sql log incremental_log.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">run&#123;</span><br><span class="line">    <span class="keyword">allocate</span> channel ch01 type disk;</span><br><span class="line"></span><br><span class="line">    backup incremental level <span class="number">1</span></span><br><span class="line">    format <span class="operator">=</span> <span class="string">&#x27;K:\Rman\DB_%U.BAK&#x27;</span></span><br><span class="line">    database;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">release</span> channel ch1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Delete ArchiveLog</title>
    <url>/blog/posts/b39ef565.html</url>
    <content><![CDATA[<h1 id="Delete-ArchiveLog"><a href="#Delete-ArchiveLog" class="headerlink" title="Delete ArchiveLog"></a>Delete ArchiveLog</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ORACLE_SID=coco</span><br><span class="line"><span class="built_in">export</span> ORACLE_BASE=/u01/app/oracle</span><br><span class="line"><span class="built_in">export</span> ORACLE_HOME=<span class="variable">$ORACLE_BASE</span>/product/11.2.0.4/db_1</span><br><span class="line"><span class="variable">$ORACLE_HOME</span>/bin/rman <span class="built_in">log</span>=/home/oracle/rmarch.log &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">connect target /</span></span><br><span class="line"><span class="string">run&#123;</span></span><br><span class="line"><span class="string">crosscheck archivelog all;</span></span><br><span class="line"><span class="string">delete noprompt expired archivelog all;</span></span><br><span class="line"><span class="string">delete noprompt archivelog all completed before &#x27;sysdate - 1&#x27;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">exit;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>archivelog</tag>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Restore</title>
    <url>/blog/posts/486a1663.html</url>
    <content><![CDATA[<p><strong>Restore parameter file</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">rman target <span class="operator">/</span> nocatalog</span><br><span class="line"></span><br><span class="line">RUN &#123;</span><br><span class="line"> <span class="keyword">ALLOCATE</span> CHANNEL ch00 TYPE DISK;</span><br><span class="line"> RESTORE SPFILE <span class="keyword">FROM</span> <span class="string">&#x27;/BACKUP/SPFILE_01UUF10M_1_1.BAK&#x27;</span> <span class="keyword">TO</span> PFILE <span class="string">&#x27;/tmp/initTEMP.ora&#x27;</span>;</span><br><span class="line"> <span class="keyword">RELEASE</span> CHANNEL ch00;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">STARTUP FORCE PFILE<span class="operator">=</span><span class="string">&#x27;/tmp/initTEMP.ora&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Restore control file</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">rman target <span class="operator">/</span> nocatalog</span><br><span class="line"></span><br><span class="line">startup nomount;</span><br><span class="line"><span class="keyword">set</span> dbid <span class="number">320066378</span>;</span><br><span class="line"></span><br><span class="line">run &#123;</span><br><span class="line"> <span class="keyword">allocate</span> channel ch00 type disk;</span><br><span class="line"> restore controlfile <span class="keyword">from</span> <span class="string">&#x27;/backup/cntrl_46_1_730733685&#x27;</span>;</span><br><span class="line"> <span class="keyword">release</span> channel ch00;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Restore database file</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">rman target <span class="operator">/</span> nocatalog</span><br><span class="line"></span><br><span class="line"><span class="keyword">sql</span> <span class="string">&#x27;alter database mount&#x27;</span>;</span><br><span class="line">catalog <span class="keyword">start</span> <span class="keyword">with</span> <span class="string">&#x27;/backup/&#x27;</span>; <span class="comment">-- 将备份集信息重新导入到当前控制文件中</span></span><br><span class="line"></span><br><span class="line">run &#123;</span><br><span class="line"> <span class="keyword">allocate</span> channel ch00 type disk;</span><br><span class="line"> <span class="keyword">allocate</span> channel ch01 type disk;</span><br><span class="line"> <span class="comment">-- specify the new location for each datafile</span></span><br><span class="line"> <span class="keyword">set</span> newname <span class="keyword">for</span> database <span class="keyword">to</span> <span class="string">&#x27;/datafile/%U.dbf&#x27;</span>;</span><br><span class="line"> <span class="comment">-- set newname for datafile 1 to &#x27;/oracle/oradata/datafile01.dbf&#x27;;</span></span><br><span class="line"> <span class="comment">-- set newname for tempfile 1 to &#x27;/oracle/oradata/tempfile01.dbf&#x27;;</span></span><br><span class="line"> restore database;</span><br><span class="line"> switch datafile <span class="keyword">all</span>; <span class="comment">-- update control file with new filenames</span></span><br><span class="line"> switch tempfile <span class="keyword">all</span>;</span><br><span class="line"> <span class="comment">-- recover database;</span></span><br><span class="line"> <span class="keyword">release</span> channel ch00;</span><br><span class="line"> <span class="keyword">release</span> channel ch01;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Restore tablespace</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">RUN</span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">SQL</span> <span class="string">&#x27;ALTER TABLESPACE users OFFLINE IMMEDIATE&#x27;</span>;</span><br><span class="line"> <span class="keyword">SQL</span> <span class="string">&#x27;ALTER TABLESPACE tools OFFLINE IMMEDIATE&#x27;</span>;</span><br><span class="line"> <span class="comment">-- specify the new location for each datafile</span></span><br><span class="line"> <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> DATAFILE <span class="string">&#x27;/olddisk/users01.dbf&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;/newdisk/users01.dbf&#x27;</span>;</span><br><span class="line"> <span class="keyword">SET</span> NEWNAME <span class="keyword">FOR</span> DATAFILE <span class="string">&#x27;/olddisk/tools01.dbf&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;/newdisk/tools01.dbf&#x27;</span>;</span><br><span class="line"> <span class="comment">-- to restore to an ASM disk group named dgroup, use:</span></span><br><span class="line"> <span class="comment">-- SET NEWNAME FOR DATAFILE &#x27;/olddisk/trgt/tools01.dbf&#x27; TO &#x27;+dgroup&#x27;;</span></span><br><span class="line"> RESTORE TABLESPACE users, tools;</span><br><span class="line"> SWITCH DATAFILE <span class="keyword">ALL</span>; <span class="comment">-- update control file with new filenames</span></span><br><span class="line"> RECOVER TABLESPACE users, tools;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span> <span class="string">&#x27;ALTER TABLESPACE users ONLINE&#x27;</span>;</span><br><span class="line"><span class="keyword">SQL</span> <span class="string">&#x27;ALTER TABLESPACE tools ONLINE&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Recover archivelog</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">rman target <span class="operator">/</span> nocatalog</span><br><span class="line"></span><br><span class="line">run &#123;</span><br><span class="line"> <span class="keyword">allocate</span> channel ch00 type disk;</span><br><span class="line"> <span class="keyword">set</span> archivelog destination <span class="keyword">to</span> <span class="string">&#x27;/backup/arch/&#x27;</span>;</span><br><span class="line"> <span class="comment">-- restore archivelog from logseq 10 until logseq 14 thread 1;</span></span><br><span class="line"> <span class="comment">-- restore archivelog from logseq 10 until logseq 14 thread 2;</span></span><br><span class="line"> recover database;</span><br><span class="line"> <span class="keyword">release</span> channel ch00;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Recover database using backup controlfile until time</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sqlplus &quot;/as sysdba&quot;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> log_archive_dest<span class="operator">=</span><span class="string">&#x27;/oracle/arch/&#x27;</span>;</span><br><span class="line">recover database <span class="keyword">using</span> backup controlfile until <span class="type">time</span> <span class="string">&#x27;JUN 29 2011 21:30:00&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Recover database using backup controlfile</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> recover database <span class="keyword">using</span> backup controlfile;</span><br><span class="line">ORA<span class="number">-00279</span>: change <span class="number">2085526</span> generated <span class="keyword">at</span> <span class="number">03</span><span class="operator">/</span><span class="number">24</span><span class="operator">/</span><span class="number">2021</span> <span class="number">08</span>:<span class="number">20</span>:<span class="number">48</span> needed <span class="keyword">for</span> thread <span class="number">1</span></span><br><span class="line">ORA<span class="number">-00289</span>: suggestion : <span class="operator">/</span>archive<span class="operator">/</span><span class="number">1</span>_15_1067527310.dbf</span><br><span class="line">ORA<span class="number">-00280</span>: change <span class="number">2085526</span> <span class="keyword">for</span> thread <span class="number">1</span> <span class="keyword">is</span> <span class="keyword">in</span> sequence #<span class="number">15</span></span><br><span class="line"></span><br><span class="line">Specify log:</span><br><span class="line">&#123;<span class="operator">&lt;</span>RET<span class="operator">&gt;=</span>suggested <span class="operator">|</span> filename <span class="operator">|</span> AUTO <span class="operator">|</span> CANCEL&#125;</span><br><span class="line"><span class="operator">/</span>datafile<span class="operator">/</span>racdb<span class="operator">/</span>redo03.log</span><br></pre></td></tr></table></figure>

<p><strong>Rename online redo</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;alter database rename file &#x27;&#x27;&#x27;</span> <span class="operator">||</span> <span class="keyword">member</span> <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="operator">||</span> substr(<span class="keyword">member</span>, instr(<span class="keyword">member</span>, <span class="string">&#x27;/&#x27;</span>, <span class="number">-1</span>) <span class="operator">+</span> <span class="number">1</span>) <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="keyword">from</span> v$logfile;</span><br></pre></td></tr></table></figure>

<p><strong>Rename datafile and tempfile</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;alter database rename file &#x27;&#x27;&#x27;</span> <span class="operator">||</span> <span class="keyword">member</span> <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="operator">||</span> substr(<span class="keyword">member</span>, instr(<span class="keyword">member</span>, <span class="string">&#x27;/&#x27;</span>, <span class="number">-1</span>) <span class="operator">+</span> <span class="number">1</span>) <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="keyword">from</span> v$datafile;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;alter database rename file &#x27;&#x27;&#x27;</span> <span class="operator">||</span> <span class="keyword">member</span> <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="operator">||</span> substr(<span class="keyword">member</span>, instr(<span class="keyword">member</span>, <span class="string">&#x27;/&#x27;</span>, <span class="number">-1</span>) <span class="operator">+</span> <span class="number">1</span>) <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="keyword">from</span> v$tempfile;</span><br></pre></td></tr></table></figure>

<p><strong>Rename datafile and tempfile on rman script</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;set newname for datafile &#x27;&#x27;&#x27;</span> <span class="operator">||</span> name<span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="operator">||</span> substr(name, instr(name, <span class="string">&#x27;/&#x27;</span>, <span class="number">-1</span>) <span class="operator">+</span> <span class="number">1</span>) <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="keyword">from</span> v$datafile <span class="keyword">order</span> <span class="keyword">by</span> file#;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;set newname for tempfile &#x27;&#x27;&#x27;</span> <span class="operator">||</span> name <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="operator">||</span> substr(name, instr(name, <span class="string">&#x27;/&#x27;</span>, <span class="number">-1</span>) <span class="operator">+</span> <span class="number">1</span>) <span class="operator">||</span> <span class="string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="keyword">from</span> v$tempfile <span class="keyword">order</span> <span class="keyword">by</span> file#;</span><br></pre></td></tr></table></figure>

<p><strong>Open database with resetlogs</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sqlplus &quot;/as sysdba&quot;</span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">alter</span> database <span class="keyword">open</span> resetlogs;</span><br></pre></td></tr></table></figure>

<p><strong>Troubleshooting</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">open</span> resetlogs 出现 <span class="keyword">system</span> 表空间没有从一个完整的旧备份中还原错误，解决方法参考 onenote 笔记 ORA<span class="number">-01152</span></span><br><span class="line"></span><br><span class="line">RMAN<span class="operator">&gt;</span> <span class="keyword">alter</span> database <span class="keyword">open</span> resetlogs;</span><br><span class="line">RMAN<span class="number">-00571</span>: <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">RMAN<span class="number">-00569</span>: <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span> ERROR MESSAGE STACK FOLLOWS <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">RMAN<span class="number">-00571</span>: <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">RMAN<span class="number">-03002</span>: failure <span class="keyword">of</span> <span class="keyword">alter</span> db command <span class="keyword">at</span> <span class="number">03</span><span class="operator">/</span><span class="number">05</span><span class="operator">/</span><span class="number">2013</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">37</span></span><br><span class="line">ORA<span class="number">-01152</span>: file <span class="number">1</span> was <span class="keyword">not</span> restored <span class="keyword">from</span> a sufficiently <span class="keyword">old</span> backup</span><br><span class="line">ORA<span class="number">-01110</span>: data file <span class="number">1</span>: <span class="string">&#x27;/oracle/u01/app/oracle/oradata/orcl/system01.dbf&#x27;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 20299014_10205</title>
    <url>/blog/posts/4fc711ab.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 20299014 - Database Patch Set Update 10.2.0.5.19 (Includes CPUJul2015)</p>
</blockquote>
<h1 id="p20299014-10205-Linux-x86-64"><a href="#p20299014-10205-Linux-x86-64" class="headerlink" title="p20299014_10205_Linux-x86-64"></a>p20299014_10205_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p20299014_10205_Linux-x86-64_README.html">p20299014_10205_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><blockquote>
<p> 操作系统版本 : CentOS Linux release 7.9.2009 (Core)<br> 数据库版本 : Oracle 10.2.0.5.0 simple instance<br>OPatch : p6880880_102000_Linux-x86-64.zip<br>DB PSU : p20299014_10205_Linux-x86-64.zip<br> 说明：p20299014 补丁包无 CRS 的补丁修复，所以直接打数据库 PSU 即可 </p>
</blockquote>
<ol>
<li><p>Update OPatch</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># chmod 775 /soft/p6880880_102000_Linux-x86-64-opatch.zip</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># chown /soft/oracle:oinstall p6880880_102000_Linux-x86-64-opatch.zip</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># su - oracle</span></span><br><span class="line">[oracle@centos7 ~]$ <span class="built_in">mv</span> /u01/app/oracle/product/10.2.0/db_1/OPatch /tmp/OPatch_bak</span><br><span class="line">[oracle@centos7 ~]$ unzip /soft/p6880880_102000_Linux-x86-64-opatch.zip -d <span class="variable">$ORACLE_HOME</span></span><br><span class="line"></span><br><span class="line">[oracle@centos7 ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch version</span><br><span class="line">Invoking OPatch 10.2.0.5.1</span><br><span class="line">OPatch Version: 10.2.0.5.1</span><br><span class="line">OPatch succeeded.</span><br></pre></td></tr></table></figure>
</li>
<li><p>Patch p20299014</p>
<p> 解压补丁包 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># chmod 775 PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># chown oracle:oinstall PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># su - oracle</span></span><br><span class="line">[oracle@centos7 soft]$ unzip PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip</span><br></pre></td></tr></table></figure>

<p> 补丁包兼容性检查 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@centos7 soft]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/20299014 -oh <span class="variable">$ORACLE_HOME</span></span><br><span class="line">Invoking OPatch 10.2.0.5.1</span><br><span class="line"></span><br><span class="line">Oracle Interim Patch Installer version 10.2.0.5.1</span><br><span class="line">Copyright (c) 2010, Oracle Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">PREREQ session</span><br><span class="line"></span><br><span class="line">Oracle Home       : /u01/app/oracle/product/10.2.0/db_1</span><br><span class="line">Central Inventory : /u01/app/oracle/oraInventory</span><br><span class="line">   from           : /etc/oraInst.loc</span><br><span class="line">OPatch version    : 10.2.0.5.1</span><br><span class="line">OUI version       : 10.2.0.5.0</span><br><span class="line">OUI location      : /u01/app/oracle/product/10.2.0/db_1/oui</span><br><span class="line">Log file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_08-50-38AM.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">Patch <span class="built_in">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt</span><br><span class="line"></span><br><span class="line">Invoking prereq <span class="string">&quot;checkconflictagainstohwithdetail&quot;</span></span><br><span class="line"></span><br><span class="line">Prereq <span class="string">&quot;checkConflictAgainstOHWithDetail&quot;</span> passed.</span><br><span class="line"></span><br><span class="line">OPatch succeeded.</span><br></pre></td></tr></table></figure>

<p> 查看该补丁能否采用 rolling 方式升级 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@centos7 ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch query -all /soft/20299014/ | grep rolling</span><br><span class="line"> Patch is a rolling patch: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p> 关闭数据库和监听 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sqlplus / as sysdba</span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">shutdown immediate</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lsnrctl stop</span></span><br></pre></td></tr></table></figure>

<p>Patch Apply</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@centos7 ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch apply /soft/20299014/</span><br><span class="line">Invoking OPatch 10.2.0.5.1</span><br><span class="line"></span><br><span class="line">Oracle Interim Patch Installer version 10.2.0.5.1</span><br><span class="line">Copyright (c) 2010, Oracle Corporation.  All rights reserved.</span><br><span class="line">Oracle Home : /u01/app/oracle/product/10.2.0/db_1</span><br><span class="line"> Central Inventory : /u01/app/oracle/oraInventory</span><br><span class="line"> from : /etc/oraInst.loc</span><br><span class="line"> OPatch version : 10.2.0.5.1</span><br><span class="line"> OUI version : 10.2.0.5.0</span><br><span class="line"> OUI location : /u01/app/oracle/product/10.2.0/db_1/oui</span><br><span class="line"> Log file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_09-27-57AM.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">Patch <span class="built_in">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt</span><br><span class="line"></span><br><span class="line">ApplySession applying interim patch <span class="string">&#x27;20299014&#x27;</span> to OH <span class="string">&#x27;/u01/app/oracle/product/10.2.0/db_1&#x27;</span></span><br><span class="line"></span><br><span class="line">Running prerequisite checks...</span><br><span class="line"> Patch 20299014: Optional component(s) missing : [oracle.rdbms.dv, 10.2.0.5.0] , [oracle.rdbms.dv.oc4j, 10.2.0.5.0] , [oracle .network.cman, 10.2.0.5.0] , [oracle.javavm.companion, 10.2.0.5.0] , [oracle.ordim.companion, 10.2.0.5.0] , [oracle.sqlj, 1 0.2.0.5.0] , [oracle.java.sqlj, 10.2.0.5.0]</span><br><span class="line"> Provide your email address to be informed of security issues, install and</span><br><span class="line"> initiate Oracle Configuration Manager. Easier <span class="keyword">for</span> you <span class="keyword">if</span> you use your My</span><br><span class="line"> Oracle Support Email address/User Name.</span><br><span class="line"> Visit http://www.oracle.com/support/policies.html <span class="keyword">for</span> details.</span><br><span class="line"> Email address/User Name:</span><br><span class="line"></span><br><span class="line">You have not provided an email address <span class="keyword">for</span> notification of security issues.</span><br><span class="line"> Do you wish to remain uninformed of security issues ([Y]es, [N]o) [N]: Y</span><br><span class="line"></span><br><span class="line">OPatch detected non-cluster Oracle Home from the inventory and will patch the <span class="built_in">local</span> system only.</span><br><span class="line"></span><br><span class="line">Please shutdown Oracle instances running out of this ORACLE_HOME on the <span class="built_in">local</span> system.</span><br><span class="line"> (Oracle Home = <span class="string">&#x27;/u01/app/oracle/product/10.2.0/db_1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">Is the <span class="built_in">local</span> system ready <span class="keyword">for</span> patching? [y|n]</span><br><span class="line"> y</span><br><span class="line"> User Responded with: Y</span><br><span class="line"> Backing up files and inventory (not <span class="keyword">for</span> auto-rollback) <span class="keyword">for</span> the Oracle Home</span><br><span class="line"> Backing up files affected by the patch <span class="string">&#x27;20299014&#x27;</span> <span class="keyword">for</span> restore. This might take a <span class="keyword">while</span>...</span><br><span class="line"> Backing up files affected by the patch <span class="string">&#x27;20299014&#x27;</span> <span class="keyword">for</span> rollback. This might take a <span class="keyword">while</span>...</span><br><span class="line"> Execution of <span class="string">&#x27;sh /soft/20299014/custom/scripts/pre -apply 20299014 &#x27;</span>:</span><br><span class="line"></span><br><span class="line">Return Code = 0</span><br><span class="line"></span><br><span class="line">Patching component oracle.rdbms, 10.2.0.5.0...</span><br><span class="line"></span><br><span class="line">... 中间过程省略...</span><br><span class="line"></span><br><span class="line">ApplySession adding interim patch <span class="string">&#x27;20299014&#x27;</span> to inventory</span><br><span class="line"></span><br><span class="line">Verifying the update...</span><br><span class="line"> Inventory check OK: Patch ID 20299014 is registered <span class="keyword">in</span> Oracle Home inventory with proper meta-data.</span><br><span class="line"> Files check OK: Files from Patch ID 20299014 are present <span class="keyword">in</span> Oracle Home.</span><br><span class="line"> Execution of <span class="string">&#x27;sh /soft/20299014/custom/scripts/post -apply 20299014 &#x27;</span>:</span><br><span class="line"></span><br><span class="line">Return Code = 0</span><br><span class="line"></span><br><span class="line">The <span class="built_in">local</span> system has been patched and can be restarted.</span><br><span class="line"></span><br><span class="line">OPatch succeeded.</span><br></pre></td></tr></table></figure>

<p> 检查升级情况 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@centos7 ~] ORACLE_HOME/OPatch/opatch lsinv</span><br><span class="line">Invoking OPatch 10.2.0.5.1 </span><br><span class="line">Oracle Interim Patch Installer version 10.2.0.5.1</span><br><span class="line">Copyright (c) 2010, Oracle Corporation. All rights reserved. </span><br><span class="line">Oracle Home : /u01/app/oracle/product/10.2.0/db_1</span><br><span class="line">Central Inventory : /u01/app/oracle/oraInventory</span><br><span class="line"> from : /etc/oraInst.loc</span><br><span class="line">OPatch version : 10.2.0.5.1</span><br><span class="line">OUI version : 10.2.0.5.0</span><br><span class="line">OUI location : /u01/app/oracle/product/10.2.0/db_1/oui</span><br><span class="line">Log file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_09-36-48AM.<span class="built_in">log</span> </span><br><span class="line">Patch <span class="built_in">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt </span><br><span class="line">Lsinventory Output file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/lsinv/lsinventory2022-02-14_09-36-48AM.txt</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Installed Top-level Products (2): </span><br><span class="line">Oracle Database 10g 10.2.0.1.0</span><br><span class="line">Oracle Database 10g Release 2 Patch Set 4 10.2.0.5.0</span><br><span class="line">There are 2 products installed <span class="keyword">in</span> this Oracle Home. </span><br><span class="line">Interim patches (1) : </span><br><span class="line">Patch 20299014 : applied on Mon Feb 14 09:31:13 CST 2022</span><br><span class="line">Unique Patch ID: 19074368</span><br><span class="line"> Created on 24 Jun 2015, 02:35:37 hrs PST8PDT</span><br><span class="line"> Bugs fixed:</span><br><span class="line"> 20074391, 13596521, 17088068, 8865718, 17201047, 13489660, 9020537</span><br><span class="line"> 8664189, 10091698, 14275629, 19909862, 17832122, 17832123, 17832124</span><br><span class="line"> 17832125, 16619894, 8822531, 10139235, 20299014, 8350262, 7119382</span><br><span class="line"> 19274521, 13632738, 11724962, 20331945, 19274523, 9320130, 16961614</span><br><span class="line"> 16961615, 13775862, 16961616, 16961617, 19006757, 16961618, 16961619</span><br><span class="line"> 18221699, 9399589, 14841459, 9672816, 9499302, 20299021, 9659614, 13632743</span><br><span class="line"> 9949948, 14220725, 8882576, 7612454, 7111619, 9711859, 9714832, 12780098</span><br><span class="line"> 13561951, 14665116, 11066597, 16703112, 19231857, 17721717, 9713537</span><br><span class="line"> 14459552, 19458377, 13737773, 13737775, 16212405, 18096714, 16338983</span><br><span class="line"> 14390396, 10249537, 19006849, 7115910, 8354642, 7602341, 14076510</span><br><span class="line"> 12565867, 15987029, 16462834, 18641419, 11693109, 14023636, 9024850</span><br><span class="line"> 8394351, 8224558, 17082365, 14149782, 9109487, 14841558, 9171933</span><br><span class="line"> 10173237, 16817117, 10068982, 10306945, 8666117, 11725006, 10214450</span><br><span class="line"> 14205448, 17082371, 9767674, 16306019, 9323583, 9726739, 16279211</span><br><span class="line"> 8412426, 10326338, 10165083, 6651220, 9145204, 13554409, 11076894</span><br><span class="line"> 19854436, 11893577, 17865671, 16746190, 14492313, 14492314, 11814891</span><br><span class="line"> 14492315, 14492316, 16742123, 21048089, 16864562, 14546638, 12419258</span><br><span class="line"> 16056270, 10010310, 18139709, 9689310, 9390484, 21048090, 21048091</span><br><span class="line"> 9963497, 12551700, 16362358, 12551701, 17465584, 12551702, 12551703</span><br><span class="line"> 12551704, 10076669, 12551705, 16270946, 12551706, 12551707, 6076890</span><br><span class="line"> 9308296, 12551708, 14258925, 12880299, 17381900, 18641451, 17381901</span><br><span class="line"> 17381902, 11790175, 12796518, 9772888, 8650138, 17056813, 14469008</span><br><span class="line"> 12551710, 10092858, 7519406, 9821321, 8771916, 13349665, 7509714</span><br><span class="line"> 10159846, 13257247, 18031728, 18641461, 16372203, 11792865, 19007266</span><br><span class="line"> 19309466, 16309604, 16309605, 16309606, 18522511, 8966823, 11674645</span><br><span class="line"> 17551414, 15877957, 15877958, 7026523, 15877959, 17716305, 13503598</span><br><span class="line"> 18767250, 9150282, 9448311, 10327179, 14774730, 19153980, 9735237</span><br><span class="line"> 9952230, 15877960, 15877961, 15877962, 15877963, 8660422, 18221700</span><br><span class="line"> 18221701, 16279401, 14546673, 14105702, 14105703, 14105704, 13483152</span><br><span class="line"> 14269955, 17285560, 12925532, 12748240, 9694101, 12862186, 12862187</span><br><span class="line"> 14727319, 8211733, 9586877, 9548269, 6694396, 7710224, 9337325, 11856395</span><br><span class="line"> 10157402, 15950541, 19699191, 6402302, 10327190, 10269717, 13015379</span><br><span class="line"> 10017048, 8546356, 13561750, 8821114, 9770451, 9360157, 8488233, 10132870</span><br><span class="line"> 4180770, 9532911, 7361418, 6157713, 9184754, 8544696, 17850678, 8277300</span><br><span class="line"> 13343467, 16382448, 13791364, 12419392, 10208905, 20236416, 20236417</span><br><span class="line"> 20236418, 20236419, 7450366, 8970313, 6690853, 6011045, 10162036, 10248542</span><br><span class="line"> 9469117, 13359623, 9952270, 13343471, 9842573, 17381899, 12710774</span><br><span class="line"> 20558005, 10324526, 9322219, 8636407, 12828105, 19289642, 13736501</span><br><span class="line"> 9824435, 13736502, 18681879, 13736503, 13736504, 13736505, 13736506</span><br><span class="line"> 9032322, 13736507, 14035825, 19769505, 11858315, 14040433, 13916709</span><br><span class="line"> 12827745, 14038805, 19567242, 16721594, 13923855, 19567243, 8528171</span><br><span class="line"> 9072105, 19567244, 11737047</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">OPatch succeeded.</span><br></pre></td></tr></table></figure>
</li>
<li><p> 升级数据库字典 </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd $ORACLE_HOME/rdbms/admin</span><br><span class="line"></span><br><span class="line">sqlplus / as sysdba</span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">startup</span></span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">@catbundle.sql psu apply</span></span><br><span class="line"></span><br><span class="line">-- Execute the next statement only if this is the first PSU applied for 10.2.0.5 or this is the first PSU applied since 10.2.0.5.3.</span><br><span class="line"><span class="meta prompt_">SQL&gt; </span><span class="language-bash">@utlrp.sql</span></span><br></pre></td></tr></table></figure>

<p> 升级后检查 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> line <span class="number">200</span></span><br><span class="line">col ACTION_TIME <span class="keyword">for</span> a30</span><br><span class="line">col ACTION <span class="keyword">for</span> a20</span><br><span class="line">col NAMESPACE <span class="keyword">for</span> a10</span><br><span class="line">col VERSION <span class="keyword">for</span> a20</span><br><span class="line">col BUNDLE_SERIES <span class="keyword">for</span> a5</span><br><span class="line">col COMMENTS <span class="keyword">for</span> a25</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_registry_history;</span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line">ACTION_TIME                    ACTION               NAMESPACE  VERSION                      ID BUNDL COMMENTS</span><br><span class="line"><span class="comment">------------------------------ -------------------- ---------- -------------------- ---------- ----- -------------------------</span></span><br><span class="line"><span class="number">14</span><span class="operator">-</span>FEB<span class="number">-22</span> <span class="number">09.51</span><span class="number">.58</span><span class="number">.594897</span> AM   jvmpsu.sql           SERVER     <span class="number">10.2</span><span class="number">.0</span><span class="number">.5</span><span class="number">.2</span>OJVMBP              <span class="number">0</span>       RAN jvmpsu.sql</span><br><span class="line"><span class="number">14</span><span class="operator">-</span>FEB<span class="number">-22</span> <span class="number">09.52</span><span class="number">.08</span><span class="number">.639503</span> AM   jvmpsu.sql           SERVER     <span class="number">10.2</span><span class="number">.0</span><span class="number">.5</span><span class="number">.2</span>OJVMBP              <span class="number">0</span>       RAN jvmpsu.sql</span><br><span class="line"><span class="number">14</span><span class="operator">-</span>FEB<span class="number">-22</span> <span class="number">09.55</span><span class="number">.41</span><span class="number">.608731</span> AM   APPLY                SERVER     <span class="number">10.2</span><span class="number">.0</span><span class="number">.5</span>                     <span class="number">19</span> PSU   PSU <span class="number">10.2</span><span class="number">.0</span><span class="number">.5</span><span class="number">.19</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> selected.</span><br><span class="line"><span class="comment">---</span></span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 31718723_112040</title>
    <url>/blog/posts/4d1d7773.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 31718723 - Oracle Grid Infrastructure Patch Set Update 11.2.0.4.201020</p>
</blockquote>
<h1 id="p31718723-112040-Linux-x86-64"><a href="#p31718723-112040-Linux-x86-64" class="headerlink" title="p31718723_112040_Linux-x86-64"></a>p31718723_112040_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p31718723_112040_Linux-x86-64_README.html">p31718723_112040_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 32226239_190000</title>
    <url>/blog/posts/7442eb0a.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 32226239 - GI Release Update 19.10.0.0.210119</p>
</blockquote>
<h1 id="p32226239-190000-Linux-x86-64"><a href="#p32226239-190000-Linux-x86-64" class="headerlink" title="p32226239_190000_Linux-x86-64"></a>p32226239_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p32226239_190000_Linux-x86-64_README.html">p32226239_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 18370031_112040</title>
    <url>/blog/posts/b99fec6c.html</url>
    <content><![CDATA[<h1 id="p18370031-112040-Linux-x86-64"><a href="#p18370031-112040-Linux-x86-64" class="headerlink" title="p18370031_112040_Linux-x86-64"></a>p18370031_112040_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p18370031_112040_Linux-x86-64_README.html">p18370031_112040_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><p>You must use the OPatch utility version 11.2.0.3.0 or later to apply this patch.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ &lt;ORACLE_HOME&gt;/OPatch/opatch version</span><br></pre></td></tr></table></figure>

<p>if not, patch p6880880.</p>
<h3 id="Validation-of-Oracle-Inventory"><a href="#Validation-of-Oracle-Inventory" class="headerlink" title="Validation of Oracle Inventory"></a>Validation of Oracle Inventory</h3><p>Before beginning patch application, check the consistency of inventory information for GI home and each database home to be patched. Run the following command as respective Oracle home owner to check the consistency.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ &lt;ORACLE_HOME&gt;/OPatch/opatch lsinventory -detail -oh &lt;ORACLE_HOME&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Unzipping-the-Patch"><a href="#Unzipping-the-Patch" class="headerlink" title="Unzipping the Patch"></a>Unzipping the Patch</h3><p>Do not unzip the patch in the top level &#x2F;tmp directory.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> &lt;UNZIPPED_PATCH_LOCATION&gt;</span><br><span class="line">$ unzip p18370031_112040_Linux-x86-64.zip</span><br></pre></td></tr></table></figure>

<h2 id="OPatch-Automation-for-GI"><a href="#OPatch-Automation-for-GI" class="headerlink" title="OPatch Automation for GI"></a>OPatch Automation for GI</h2><p><strong>Case 1: Patching Oracle RAC Database Homes and the GI Home Together</strong></p>
<p>Follow the instructions in this section if you would like to patch all the Oracle RAC database homes of release version 11.2.0.4.0 and the 11.2.0.4.0 GI home.</p>
<p><strong>Case 1.1: GI Home Is Not Shared</strong></p>
<p><strong>Case 1.1.1: ACFS File System Is Not Configured and Database Homes Are Not Shared</strong></p>
<p>Follow these instructions in this section if the GI home is not shared and none of the Oracle database homes is shared.</p>
<p>As root user execute the following command on each node of the cluster:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># &lt;GI_HOME&gt;/OPatch/opatch auto &lt;UNZIPPED_PATCH_LOCATION&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 34086870_190000</title>
    <url>/blog/posts/3f8c172e.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 34086870 - Oracle JavaVM Component Release Update 19.16.0.0.220719</p>
</blockquote>
<h1 id="p34086870-190000-Linux-x86-64"><a href="#p34086870-190000-Linux-x86-64" class="headerlink" title="p34086870_190000_Linux-x86-64"></a>p34086870_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p34086870_190000_Linux-x86-64_README.html">p34086870_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 34133642_190000</title>
    <url>/blog/posts/4422928f.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 34133642 - Database Release Update 19.16.0.0.220719</p>
</blockquote>
<h1 id="p34133642-190000-Linux-x86-64"><a href="#p34133642-190000-Linux-x86-64" class="headerlink" title="p34133642_190000_Linux-x86-64"></a>p34133642_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p34133642_190000_Linux-x86-64_README.html">p34133642_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 34130714_190000</title>
    <url>/blog/posts/c3410626.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 34130714 - GI Release Update 19.16.0.0.220719</p>
</blockquote>
<h1 id="p34130714-190000-Linux-x86-64"><a href="#p34130714-190000-Linux-x86-64" class="headerlink" title="p34130714_190000_Linux-x86-64"></a>p34130714_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p34130714_190000_Linux-x86-64_README.html">p34130714_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><blockquote>
<p>System Operation: RHEL 8.7<br>Database Software: 19.3.0.0.0 RAC with 3 nodes</p>
</blockquote>
<ol>
<li><p>Update OPatch utility version to <code>12.2.0.1.30</code> or later.</p>
<ul>
<li><a href="/blog/posts/8631a84d.html">Patch 6880880_190000 - record 1</a></li>
</ul>
</li>
<li><p>Validation of Oracle Inventory on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch lsinventory -detail -oh <span class="variable">$ORACLE_HOME</span></span><br><span class="line">[oracle@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch lsinventory -detail -oh <span class="variable">$ORACLE_HOME</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Download and Unzip the Patch on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># chown grid:oinstall /soft/p34130714_190000_Linux-x86-64.zip</span></span><br><span class="line">[grid@oracle19crac ~]$ unzip -q /soft/p34130714_190000_Linux-x86-64.zip -d /soft</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run OPatch Conflict Check on each node.</p>
<ul>
<li>As the Grid home user:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/34130714/34133642</span><br><span class="line">[grid@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/34130714/34160635</span><br><span class="line">[grid@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/34130714/34139601</span><br><span class="line">[grid@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/34130714/34318175</span><br><span class="line">[grid@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/34130714/33575402</span><br></pre></td></tr></table></figure>

<ul>
<li>For Oracle home, as home user:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/34130714/34133642</span><br><span class="line">[oracle@oracle19crac ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/34130714/34160635</span><br></pre></td></tr></table></figure>
</li>
<li><p>Run OPatch System Space Check on each node.</p>
<ul>
<li><p>For Grid Infrastructure home, as home user:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@oracle19crac ~]$ <span class="built_in">cat</span> &gt; /tmp/patch_list_gihome.txt &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">/soft/34130714/34133642</span></span><br><span class="line"><span class="string">/soft/34130714/34160635</span></span><br><span class="line"><span class="string">/soft/34130714/34139601</span></span><br><span class="line"><span class="string">/soft/34130714/34318175</span></span><br><span class="line"><span class="string">/soft/34130714/33575402</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckSystemSpace -phBaseFile /tmp/patch_list_gihome.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>For Oracle home, as home user:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@oracle19crac ~]$ <span class="built_in">cat</span> &gt; /tmp/patch_list_dbhome.txt &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">/soft/34130714/34133642</span></span><br><span class="line"><span class="string">/soft/34130714/34160635</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckSystemSpace -phBaseFile /tmp/patch_list_dbhome.txt</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>One-off Patch Conflict Detection and Resolution on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/3413071</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Patch Installation Checks on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@oracle19crac ~]$ cluvfy stage -pre patch</span><br></pre></td></tr></table></figure>
</li>
<li><p>Patch Installation</p>
<ul>
<li>Case 1: Oracle RAC, where the Grid home and the Oracle homes are not shared and Oracle ACFS file system is not configured<br>As root user, execute the following command on each node of the cluster:<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/34130714</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Patch Post Installation Instructions<br>After applying the patch, the sanity of the patching operation can be verified by issuing the <code>cluvfy stage -post patch</code> command from any of the cluster nodes upon completion of the patch application process.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@oracle19crac ~]$ cluvfy stage -post patch</span><br></pre></td></tr></table></figure>

<p>List opatch patches.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[grid@oracle19crac01 ~]$ <span class="variable">$ORACLE_HOME</span>/OPatch/opatch lspatches</span><br><span class="line">34318175;TOMCAT RELEASE UPDATE 19.0.0.0.0 (34318175)</span><br><span class="line">34160635;OCW RELEASE UPDATE 19.16.0.0.0 (34160635)</span><br><span class="line">34139601;ACFS RELEASE UPDATE 19.16.0.0.0 (34139601)</span><br><span class="line">34133642;Database Release Update : 19.16.0.0.220719 (34133642)</span><br><span class="line">33575402;DBWLM RELEASE UPDATE 19.0.0.0.0 (33575402)</span><br><span class="line">OPatch succeeded.</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 35037840_190000</title>
    <url>/blog/posts/2b12b153.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 35037840 - GI Release Update 19.19.0.0.230418</p>
</blockquote>
<h1 id="p35037840-190000-Linux-x86-64"><a href="#p35037840-190000-Linux-x86-64" class="headerlink" title="p35037840_190000_Linux-x86-64"></a>p35037840_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p35037840_190000_Linux-x86-64_README.html">p35037840_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 35042068_190000</title>
    <url>/blog/posts/c0198759.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 35042068 - Database Release Update 19.19.0.0.230418</p>
</blockquote>
<h1 id="p35042068-190000-Linux-x86-64"><a href="#p35042068-190000-Linux-x86-64" class="headerlink" title="p35042068_190000_Linux-x86-64"></a>p35042068_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p35042068_190000_Linux-x86-64_README.html">p35042068_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 35050341_190000</title>
    <url>/blog/posts/d95efa59.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 35050341 - Oracle JavaVM Component Release Update 19.19.0.0.230418</p>
</blockquote>
<h1 id="p35050341-190000-Linux-x86-64"><a href="#p35050341-190000-Linux-x86-64" class="headerlink" title="p35050341_190000_Linux-x86-64"></a>p35050341_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p35050341_190000_Linux-x86-64_README.html">p35050341_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><p> 检查 OJVM 是否安装及使用，未安装或未使用时，不进行 OJVM 补丁更新。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> version, status <span class="keyword">FROM</span> dba_registry <span class="keyword">WHERE</span> comp_id<span class="operator">=</span><span class="string">&#x27;JAVAVM&#x27;</span>;</span><br><span class="line"></span><br><span class="line">VERSION                        STATUS</span><br><span class="line"><span class="comment">------------------------------ --------------------------------------------</span></span><br><span class="line"><span class="number">19.0</span><span class="number">.0</span><span class="number">.0</span><span class="number">.0</span>                     VALID</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> x$kglob <span class="keyword">where</span> KGLOBTYP <span class="operator">=</span> <span class="number">29</span> <span class="keyword">OR</span> KGLOBTYP <span class="operator">=</span> <span class="number">56</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line">         <span class="number">0</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 4547809_92080</title>
    <url>/blog/posts/3b32a604.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 4547809 - Release 2 (9.2.0.8) Patch Set 7</p>
</blockquote>
<h1 id="p4547809-92080-Linux-x86-64"><a href="#p4547809-92080-Linux-x86-64" class="headerlink" title="p4547809_92080_Linux-x86-64"></a>p4547809_92080_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p4547809_92080_Linux-x86-64_README.html">p4547809_92080_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><h1 id="p4547809-92080-Linux-x86"><a href="#p4547809-92080-Linux-x86" class="headerlink" title="p4547809_92080_Linux-x86"></a>p4547809_92080_Linux-x86</h1><ul>
<li><a href="/blog/assets/html/p4547809_92080_Linux-x86_README.html">p4547809_92080_Linux-x86_README</a></li>
</ul>
<h2 id="Record-1"><a href="#Record-1" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 6880880_190000</title>
    <url>/blog/posts/8631a84d.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 6880880 - OPatch for DB 19.0.0.0.0</p>
</blockquote>
<h1 id="p6880880-190000-Linux-x86-64"><a href="#p6880880-190000-Linux-x86-64" class="headerlink" title="p6880880_190000_Linux-x86-64"></a>p6880880_190000_Linux-x86-64</h1><h2 id="Update-OPatch-Utility"><a href="#Update-OPatch-Utility" class="headerlink" title="Update OPatch Utility"></a>Update OPatch Utility</h2><p>To update Opatch, use the following instructions:</p>
<ol>
<li>Download the OPatch utility to a temporary directory.</li>
<li>For each Oracle RAC database home and the GI home that are being patched, run the following commands as the home owner to extract the OPatch utility.<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">unzip &lt;OPATCH-ZIP&gt; -d &lt;ORACLE_HOME&gt;</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/OPatch/opatch version</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Record-1-Update-OPatch-utility-version-to-12-2-0-1-30"><a href="#Record-1-Update-OPatch-utility-version-to-12-2-0-1-30" class="headerlink" title="Record 1: Update OPatch utility version to 12.2.0.1.30"></a>Record 1: Update OPatch utility version to 12.2.0.1.30</h2><p>Check the current opatch version on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># /u01/app/19.0.0/grid/OPatch/opatch version</span></span><br><span class="line">OPatch Version: 12.2.0.1.17</span><br><span class="line">OPatch succeeded.</span><br><span class="line">[root@oracle19crac ~]<span class="comment"># /u01/app/oracle/product/19.0.0/dbhome_1/OPatch/opatch version</span></span><br><span class="line">OPatch Version: 12.2.0.1.17</span><br><span class="line">OPatch succeeded.</span><br></pre></td></tr></table></figure>

<p>Take a backup of <code>ORACLE_HOME/OPatch</code> on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># mv /u01/app/19.0.0/grid/OPatch&#123;,.bak.`date +%m%d`&#125;</span></span><br><span class="line">[root@oracle19crac ~]<span class="comment"># mv /u01/app/oracle/product/19.0.0/dbhome_1/OPatch&#123;,.bak.`date +%m%d`&#125;</span></span><br></pre></td></tr></table></figure>

<p>Unzip the OPatch downloaded zip into <code>ORACLE_HOME</code> directory on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># unzip -q /soft/p6880880_190000_Linux-x86-64.zip -d /u01/app/19.0.0/grid/</span></span><br><span class="line">[root@oracle19crac ~]<span class="comment"># chown -R grid:oinstall /u01/app/19.0.0/grid/OPatch</span></span><br><span class="line">[root@oracle19crac ~]<span class="comment"># unzip -q /soft/p6880880_190000_Linux-x86-64.zip -d /u01/app/oracle/product/19.0.0/dbhome_1/</span></span><br><span class="line">[root@oracle19crac ~]<span class="comment"># chown -R oracle:oinstall /u01/app/oracle/product/19.0.0/dbhome_1/OPatch</span></span><br></pre></td></tr></table></figure>

<p>Check the version of the opatch utility on each node.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@oracle19crac ~]<span class="comment"># ls -ld /u01/app/19.0.0/grid/OPatch</span></span><br><span class="line">drwxr-x--- 15 grid oinstall 4096 Jul  4  2022 /u01/app/19.0.0/grid/OPatch</span><br><span class="line">[root@oracle19crac ~]<span class="comment"># ls -ld /u01/app/oracle/product/19.0.0/dbhome_1/OPatch</span></span><br><span class="line">drwxr-x--- 15 oracle oinstall 4096 Jul  4  2022 /u01/app/oracle/product/19.0.0/dbhome_1/OPatch</span><br><span class="line">[root@oracle19crac ~]<span class="comment">#</span></span><br><span class="line">[root@oracle19crac ~]<span class="comment"># /u01/app/19.0.0/grid/OPatch/opatch version</span></span><br><span class="line">OPatch Version: 12.2.0.1.32</span><br><span class="line">OPatch succeeded.</span><br><span class="line">[root@oracle19crac ~]<span class="comment"># /u01/app/oracle/product/19.0.0/dbhome_1/OPatch/opatch version</span></span><br><span class="line">OPatch Version: 12.2.0.1.32</span><br><span class="line">OPatch succeeded.</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Prerequisites</title>
    <url>/blog/posts/8037a8c2.html</url>
    <content><![CDATA[<ol>
<li><p> 平台字节序和字符集，不支持 Windows 平台，源端与目标端的字符集需相同 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 查询平台和字节序 </span></span><br><span class="line">col PLATFORM_NAME format a30</span><br><span class="line"><span class="keyword">SELECT</span> d.PLATFORM_ID,d.PLATFORM_NAME, tp.ENDIAN_FORMAT</span><br><span class="line"> <span class="keyword">FROM</span> V$TRANSPORTABLE_PLATFORM tp, V$DATABASE d</span><br><span class="line"> <span class="keyword">WHERE</span> tp.PLATFORM_NAME <span class="operator">=</span> d.PLATFORM_NAME;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询字符集 </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> nls_database_parameters <span class="keyword">where</span> <span class="keyword">parameter</span> <span class="keyword">like</span> <span class="string">&#x27;%CHARACTERSET%&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> userenv(<span class="string">&#x27;language&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 数据库时区，源端与目标端的时区需相同 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> dbtimezone <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 数据库版本及补丁，源端 ≥10.2.0.3 企业版，目标端 ≥11.2.0.4 企业版 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$version;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dba_registry_history;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 数据库组件，目标端需要包含源端的所有组件 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> comp_id,comp_name,version,status <span class="keyword">from</span> dba_registry;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 归档模式，源端需开启归档模式 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">archive log list;</span><br></pre></td></tr></table></figure>
</li>
<li><p>compatible 参数和 db_files 参数，源端 compatible 参数需要设置为 ≥10.2.0，目标端 compatible 参数和 db_files 参数要 ≥ 源端 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> compatible;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> db_files;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 需要迁移的表空间和用户 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> TABLESPACE_NAME,BLOCK_SIZE,CONTENTS,STATUS</span><br><span class="line"> <span class="keyword">from</span> dba_tablespaces</span><br><span class="line"> <span class="keyword">where</span> tablespace_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;EXAMPLE&#x27;</span>,<span class="string">&#x27;SCOTT&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> owner,tablespace_name,<span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"> <span class="keyword">from</span> dba_segments </span><br><span class="line"> <span class="keyword">where</span> tablespace_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;EXAMPLE&#x27;</span>,<span class="string">&#x27;SCOTT&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner,tablespace_name <span class="keyword">order</span> <span class="keyword">by</span> tablespace_name;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 确保需要迁移的表空间处于联机可读写模式 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> tablespace_name,status <span class="keyword">from</span> dba_tablespaces</span><br><span class="line"> <span class="keyword">where</span> tablespace_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;EXAMPLE&#x27;</span>,<span class="string">&#x27;SCOTT&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p> 表空间自包含检查 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 自包含检查 </span></span><br><span class="line"><span class="keyword">execute</span> dbms_tts.transport_set_check(<span class="string">&#x27;TBS_COCO,ITPUX01,ITPUX02,ITPUX03&#x27;</span>,<span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看结果，结果为空，表示自包含 </span></span><br><span class="line">col violations <span class="keyword">for</span> a70</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys.transport_set_violations;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 获取用户及其权限的 SQL</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> LONG <span class="number">9999</span></span><br><span class="line"><span class="keyword">SELECT</span> DBMS_METADATA.GET_DDL(<span class="string">&#x27;USER&#x27;</span>, USERNAME) <span class="operator">||</span> <span class="string">&#x27;;&#x27;</span> DDL_SQL</span><br><span class="line"> <span class="keyword">FROM</span> DBA_USERS <span class="keyword">WHERE</span> USERNAME</span><br><span class="line"> <span class="keyword">IN</span> (<span class="keyword">select</span> owner  <span class="keyword">from</span> dba_segments <span class="keyword">where</span> tablespace_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;EXAMPLE&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner,tablespace_name) <span class="keyword">AND</span> USERNAME <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;SCOTT&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DBMS_METADATA.GET_GRANTED_DDL(<span class="string">&#x27;SYSTEM_GRANT&#x27;</span>, USERNAME) <span class="operator">||</span> <span class="string">&#x27;;&#x27;</span> DDL_SQL</span><br><span class="line"> <span class="keyword">FROM</span> DBA_USERS <span class="keyword">WHERE</span> USERNAME</span><br><span class="line"> <span class="keyword">IN</span> (<span class="keyword">select</span> owner  <span class="keyword">from</span> dba_segments <span class="keyword">where</span>  tablespace_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;EXAMPLE&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner,tablespace_name) <span class="keyword">AND</span> USERNAME <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;SCOTT&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DBMS_METADATA.GET_GRANTED_DDL(<span class="string">&#x27;ROLE_GRANT&#x27;</span>, USERNAME) <span class="operator">||</span> <span class="string">&#x27;;&#x27;</span> DDL_SQL</span><br><span class="line"> <span class="keyword">FROM</span> DBA_USERS <span class="keyword">WHERE</span> USERNAME</span><br><span class="line"> <span class="keyword">IN</span> (<span class="keyword">select</span> owner  <span class="keyword">from</span> dba_segments <span class="keyword">where</span>  tablespace_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;EXAMPLE&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner,tablespace_name) <span class="keyword">AND</span> USERNAME <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;SCOTT&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> DBMS_METADATA.GET_GRANTED_DDL(<span class="string">&#x27;OBJECT_GRANT&#x27;</span>, USERNAME) <span class="operator">||</span> <span class="string">&#x27;;&#x27;</span> DDL_SQL</span><br><span class="line"> <span class="keyword">FROM</span> DBA_USERS <span class="keyword">WHERE</span> USERNAME</span><br><span class="line"> <span class="keyword">IN</span> (<span class="keyword">select</span> owner  <span class="keyword">from</span> dba_segments <span class="keyword">where</span>  tablespace_name <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;EXAMPLE&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner,tablespace_name) <span class="keyword">AND</span> USERNAME <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;SCOTT&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p> 对象数量统计 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 需要迁移的对象和数量 </span></span><br><span class="line"><span class="keyword">select</span> owner, object_type, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"> <span class="keyword">from</span> dba_objects</span><br><span class="line"> <span class="keyword">where</span> object_name <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;BIN%&#x27;</span></span><br><span class="line"> <span class="keyword">and</span> owner <span class="keyword">in</span> (<span class="string">&#x27;COCO&#x27;</span>,<span class="string">&#x27;ITPUX01&#x27;</span>,<span class="string">&#x27;ITPUX02&#x27;</span>,<span class="string">&#x27;ITPUX03&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner, object_type</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 无效对象 </span></span><br><span class="line"><span class="keyword">select</span> owner, object_type, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"> <span class="keyword">from</span> dba_objects</span><br><span class="line"><span class="keyword">where</span> status <span class="operator">&lt;&gt;</span> <span class="string">&#x27;VALID&#x27;</span></span><br><span class="line"> <span class="keyword">and</span> owner <span class="keyword">in</span> (<span class="string">&#x27;COCO&#x27;</span>,<span class="string">&#x27;ITPUX01&#x27;</span>,<span class="string">&#x27;ITPUX02&#x27;</span>,<span class="string">&#x27;ITPUX03&#x27;</span>)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> owner, object_type</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>, <span class="number">2</span> <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 非业务用户下是否有业务数据 </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"> <span class="keyword">FROM</span> dba_objects d</span><br><span class="line"> <span class="keyword">where</span> d.created <span class="operator">&gt;=</span> sysdate <span class="operator">-</span> <span class="number">10</span></span><br><span class="line"> <span class="keyword">and</span> d.object_name <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;WR%&#x27;</span></span><br><span class="line"> <span class="keyword">and</span> d.owner <span class="keyword">IN</span> (<span class="string">&#x27;SYS&#x27;</span>,<span class="string">&#x27;SYSTEM&#x27;</span>)</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> d.created <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 开启块跟踪 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$block_change_tracking;</span><br><span class="line"><span class="keyword">alter</span> database enable block change tracking <span class="keyword">using</span> file <span class="string">&#x27;+DATA&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p> 目标端调整 job 参数，防止 job 调度任务，修改迁移后的数据 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> job_queue_processes<span class="operator">=</span><span class="number">0</span> sid<span class="operator">=</span><span class="string">&#x27;*&#x27;</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
        <tag>prerequisites</tag>
      </tags>
  </entry>
  <entry>
    <title>Using dbms_file_transfer</title>
    <url>/blog/posts/356a1bee.html</url>
    <content><![CDATA[<p>All steps in this procedure are run as the <strong>oracle user</strong> that is a member of the OSDBA group. OS authentication is used to connect to both the source and destination databases.</p>
<ol>
<li><p>Initial Setup</p>
<p>1.1 创建 xtts 目录，解压 rman_xttconvert_v3.zip 软件包 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /home/oracle/xtts/backup</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/oracle/xtts/backup_incr</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/oracle/xtts/scripts</span><br><span class="line"><span class="built_in">cd</span> /home/oracle/xtts</span><br><span class="line">unzip rman_xttconvert_v3.zip</span><br></pre></td></tr></table></figure>

<p>1.2 配置 xtt.properties 参数 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; xtt.properties &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03</span><br><span class="line">platformid=13</span><br><span class="line">srcdir=SOURCEDIR</span><br><span class="line">dstdir=DESTDIR</span><br><span class="line">srclink=ttslink</span><br><span class="line"><span class="comment"># dfcopydir=/home/oracle/xtts/backup</span></span><br><span class="line">backupformat=/home/oracle/xtts/backup_incr</span><br><span class="line">stageondest=/home/oracle/xtts/backup</span><br><span class="line">storageondest=+DATA/coco/pdb</span><br><span class="line">backupondest=/home/oracle/xtts/backup_incr</span><br><span class="line">asm_home=/u01/app/19.0.0/grid</span><br><span class="line">asm_sid=+ASM</span><br><span class="line">parallel=3</span><br><span class="line">rollparallel=2</span><br><span class="line">getfileparallel=4</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>1.3 （可选）目标端配置临时实例用于增量备份恢复，目标端 11.2.0.4 及以上跳过此步骤 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ORACLE_SID=xtts</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; $ORACLE_HOME/dbs/init$ORACLE_SID.ora</span></span><br><span class="line"><span class="string">db_name=xtts</span></span><br><span class="line"><span class="string">compatible=19.0.0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sqlplus / as sysdba</span><br><span class="line">SQL&gt; startup nomount</span><br></pre></td></tr></table></figure>

<p>1.4 目标端创建连接源端的 dblink</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> public database link ttslink <span class="keyword">connect</span> <span class="keyword">to</span> <span class="keyword">system</span> identified <span class="keyword">by</span> oracle</span><br><span class="line"> <span class="keyword">using</span> <span class="string">&#x27;(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.184.145)(PORT = 1521))  ) (CONNECT_DATA = (SERVICE_NAME = coco) ) )&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>1.5 创建数据库目录 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 源端创建 SOURCEDIR</span></span><br><span class="line"><span class="keyword">create</span> directory SOURCEDIR <span class="keyword">as</span> <span class="string">&#x27;+DATA/coco&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> directory SOURCEDIR <span class="keyword">to</span> public;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 目标端创建 DESTDIR</span></span><br><span class="line"><span class="keyword">create</span> directory DESTDIR <span class="keyword">as</span> <span class="string">&#x27;+DATA/coco/pdb&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> directory DESTDIR <span class="keyword">to</span> public;</span><br></pre></td></tr></table></figure>

<p>1.6 源端和目标端设置临时目录 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@<span class="built_in">source</span>]$ <span class="built_in">export</span> TMPDIR=/home/oracle/xtts/scripts</span><br><span class="line">[oracle@dest]$ <span class="built_in">export</span> TMPDIR=/home/oracle/xtts/scripts</span><br></pre></td></tr></table></figure>
</li>
<li><p>Prepare Phase for dbms_file_transfer Method</p>
<p>2.1 源端执行以下命令，创建 getfile.sql 和 xttnewdatafiles.txt 文件 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -S</span><br></pre></td></tr></table></figure>

<p>2.2 拷贝 getfile.sql 和 xttnewdatafiles.txt 文件文件至目标端 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp <span class="variable">$TMPDIR</span>/getfile.sql oracle@dest:<span class="variable">$TMPDIR</span></span><br><span class="line">scp <span class="variable">$TMPDIR</span>/xttnewdatafiles.txt oracle@dest:<span class="variable">$TMPDIR</span></span><br></pre></td></tr></table></figure>

<p>2.3 目标端进行数据文件拷贝 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -G</span><br></pre></td></tr></table></figure>
</li>
<li><p>Roll Forward Phase</p>
<p>3.1 源端生成增量备份文件至 <code>backupformat</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i</span><br></pre></td></tr></table></figure>

<p>3.2 拷贝增量备份文件、xttplan、tsbkupmap 至目标端 <code>stageondest</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp `<span class="built_in">cat</span> <span class="variable">$TMPDIR</span>/incrbackups.txt` oracle@dest:/home/oracle/xtts/backup</span><br><span class="line">scp <span class="variable">$TMPDIR</span>/xttplan.txt oracle@des:<span class="variable">$TMPDIR</span></span><br><span class="line">scp <span class="variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="variable">$TMPDIR</span></span><br></pre></td></tr></table></figure>

<p>3.3 目标端做增量前滚 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r</span><br></pre></td></tr></table></figure>

<p>3.4 源端确定下一个增量备份的 FROM_SCN</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -s</span><br></pre></td></tr></table></figure>

<p>3.5 Repeat the Roll Forward Phase (Phase 3)</p>
</li>
<li><p>Transport Phase</p>
<p>4.1 源端将表空间置为只读模式 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;ALTER TABLESPACE &#x27;</span><span class="operator">||</span>name<span class="operator">||</span><span class="string">&#x27; READ ONLY;&#x27;</span> exec_sql</span><br><span class="line"> <span class="keyword">from</span> v$tablespace <span class="keyword">where</span> NAME <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;USERS&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tablespace_name,status <span class="keyword">from</span> dba_tablespaces;</span><br></pre></td></tr></table></figure>

<p>4.2 重复步骤 3.1 - 3.3，做最后一次增量前滚 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@<span class="built_in">source</span>]$ <span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i</span><br><span class="line"></span><br><span class="line">[oracle@<span class="built_in">source</span>]$ scp `<span class="built_in">cat</span> <span class="variable">$TMPDIR</span>/incrbackups.txt` oracle@dest:/home/oracle/xtts/backup</span><br><span class="line"></span><br><span class="line">[oracle@<span class="built_in">source</span>]$ scp <span class="variable">$TMPDIR</span>/xttplan.txt oracle@dest:<span class="variable">$TMPDIR</span></span><br><span class="line">[oracle@<span class="built_in">source</span>]$ scp <span class="variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="variable">$TMPDIR</span></span><br><span class="line"></span><br><span class="line">[oracle@dest]$ <span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r</span><br></pre></td></tr></table></figure>
</li>
<li><p>Import Object Metadata into Destination Database</p>
<p>5.1 目标端创建业务用户 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;ITPUX01&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:98BB089CD1A16CBD4803C404C3279A570D607F667DD6E5EB7A19735B7FA6;358208C73FF2939C&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;COCO&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:37AB55E527FC21D62DEA2949499DD9D9F7EC2A5C97C9140A23ADEBB365BD;96B138098030A3C8&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;ITPUX02&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:21BC086145990A7CC133F01E0D80B7548EA49DB694F44E972CEC33685168;499779BC208401AE&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;ITPUX03&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:4C2C70077865FBFE627E08288E24FC9307DAF72DAC9C36EA9D31AE332263;CE4FDA4704D50F9C&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;ITPUX01&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;COCO&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;ITPUX02&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;ITPUX03&quot;;</span><br></pre></td></tr></table></figure>

<p>5.2 目标端生成 Data Pump TTS 命令 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -e</span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$TMPDIR</span>/xttplugin.txt</span><br></pre></td></tr></table></figure>

<p>5.3 迁移表空间元数据 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">impdp system/oracle@pdb directory=DATA_PUMP_DIR logfile=tts_imp.log \</span><br><span class="line">network_link=ttslink transport_full_check=no \</span><br><span class="line">exclude=statistics \</span><br><span class="line">transport_tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03 \</span><br><span class="line">transport_datafiles=<span class="string">&#x27;+DATA/coco/pdb/tbs_coco01.dbf&#x27;</span>,<span class="string">&#x27;+DATA/coco/pdb/itpux01.dbf&#x27;</span>,<span class="string">&#x27;+DATA/coco/pdb/itpux02.dbf&#x27;</span>,<span class="string">&#x27;+DATA/coco/pdb/itpux03.dbf&#x27;</span></span><br></pre></td></tr></table></figure>

<p>5.4 迁移存储过程、触发器、函数、包、视图、序列 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">impdp system/oracle@pdb directory=DATA_PUMP_DIR \</span><br><span class="line">network_link=ttslink schemas=COCO,ITPUX01,ITPUX02,ITPUX03 content=metadata_only exclude=index,table parallel=8</span><br></pre></td></tr></table></figure>

<p>5.5 导入同义词、dblink 和其他对象 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-- 导入公共同义词 </span><br><span class="line"><span class="built_in">set</span> long 9999</span><br><span class="line">select dbms_metadata.get_ddl(<span class="string">&#x27;SYNONYM&#x27;</span>,SYNONYM_NAME,OWNER)</span><br><span class="line"> FROM dba_synonyms <span class="built_in">where</span> owner=<span class="string">&#x27;PUBLIC&#x27;</span> and table_owner <span class="keyword">in</span>  (<span class="string">&#x27;COCO&#x27;</span>,<span class="string">&#x27;ITPUX01&#x27;</span>,<span class="string">&#x27;ITPUX02&#x27;</span>,<span class="string">&#x27;ITPUX03&#x27;</span>);</span><br><span class="line"></span><br><span class="line">-- 导入 dblink</span><br><span class="line"><span class="built_in">set</span> long 9999</span><br><span class="line">select dbms_metadata.get_ddl(<span class="string">&#x27;DB_LINK&#x27;</span>,DB_LINK,OWNER) FROM DBA_DB_LINKS;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Post-migration</p>
<p>6.1 检查数据库一致性 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> owner, object_type, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"> <span class="keyword">from</span> dba_objects</span><br><span class="line"> <span class="keyword">where</span> object_name <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;BIN%&#x27;</span></span><br><span class="line"> <span class="keyword">and</span> owner <span class="keyword">in</span> (<span class="string">&#x27;COCO&#x27;</span>,<span class="string">&#x27;ITPUX01&#x27;</span>,<span class="string">&#x27;ITPUX02&#x27;</span>,<span class="string">&#x27;ITPUX03&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner, object_type</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p>6.2 业务用户修改权限和默认表空间 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;ITPUX01&quot; <span class="keyword">DEFAULT</span> TABLESPACE &quot;ITPUX01&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;ITPUX02&quot; <span class="keyword">DEFAULT</span> TABLESPACE &quot;ITPUX02&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;ITPUX03&quot; EFAULT TABLESPACE &quot;ITPUX03&quot;;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;COCO&quot; <span class="keyword">DEFAULT</span> TABLESPACE &quot;TBS_COCO&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> UNLIMITED TABLESPACE <span class="keyword">TO</span> &quot;ITPUX01&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> UNLIMITED TABLESPACE <span class="keyword">TO</span> &quot;COCO&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> UNLIMITED TABLESPACE <span class="keyword">TO</span> &quot;ITPUX02&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> JOB <span class="keyword">TO</span> &quot;COCO&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> &quot;COCO&quot;.&quot;TESTTABLE&quot; <span class="keyword">TO</span> &quot;ITPUX01&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> &quot;SYS&quot;.&quot;DBA_USERS&quot; <span class="keyword">TO</span> &quot;COCO&quot;;</span><br></pre></td></tr></table></figure>

<p>6.3 表空间置为读写模式 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;ALTER TABLESPACE &#x27;</span><span class="operator">||</span>name<span class="operator">||</span><span class="string">&#x27; READ WRITE;&#x27;</span> exec_sql <span class="keyword">from</span> v$tablespace</span><br><span class="line"> <span class="keyword">where</span> NAME <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;USERS&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>6.4 校验数据文件完整性 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">RMAN<span class="operator">&gt;</span> validate tablespace COCO,ITPUX01,ITPUX02,ITPUX03 <span class="keyword">check</span> logical;</span><br></pre></td></tr></table></figure>

<p>6.5 收集统计信息 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">exec</span> dbms_stats.gather_database_stats(degree <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">8</span>);</span><br><span class="line"><span class="keyword">exec</span> dbms_stats.gather_dictionary_stats(degree <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">8</span>);</span><br><span class="line"><span class="keyword">exec</span> dbms_stats.gather_fixed_objects_stats();</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Recovery Manager</title>
    <url>/blog/posts/21719ab3.html</url>
    <content><![CDATA[<p>All steps in this procedure are run as the <strong>oracle user</strong> that is a member of the OSDBA group. OS authentication is used to connect to both the source and destination databases.</p>
<ol>
<li><p>Initial Setup</p>
<p>1.1 创建 xtts 目录，解压 rman_xttconvert_v3.zip 软件包 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /home/oracle/xtts/backup</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/oracle/xtts/backup_incr</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/oracle/xtts/scripts</span><br><span class="line"><span class="built_in">cd</span> /home/oracle/xtts</span><br><span class="line">unzip rman_xttconvert_v3.zip</span><br></pre></td></tr></table></figure>

<p>1.2 配置 xtt.properties 参数 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; xtt.properties &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03</span><br><span class="line">platformid=13</span><br><span class="line">dfcopydir=/home/oracle/xtts/backup</span><br><span class="line">backupformat=/home/oracle/xtts/backup_incr</span><br><span class="line">stageondest=/home/oracle/xtts/backup</span><br><span class="line">storageondest=+DATA/coco/pdb</span><br><span class="line">backupondest=/home/oracle/xtts/backup_incr</span><br><span class="line">asm_home=/u01/app/19.0.0/grid</span><br><span class="line">asm_sid=+ASM</span><br><span class="line">parallel=3</span><br><span class="line">rollparallel=2</span><br><span class="line">getfileparallel=4</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>1.3 （可选）目标端配置临时实例用于增量备份恢复 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> ORACLE_SID=xtts</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; $ORACLE_HOME/dbs/init$ORACLE_SID.ora</span></span><br><span class="line"><span class="string">db_name=xtts</span></span><br><span class="line"><span class="string">compatible=19.0.0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sqlplus / as sysdba</span><br><span class="line">SQL&gt; startup nomount</span><br></pre></td></tr></table></figure>

<p>1.4 目标端创建连接源端的 dblink</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> public database link ttslink <span class="keyword">connect</span> <span class="keyword">to</span> <span class="keyword">system</span> identified <span class="keyword">by</span> oracle</span><br><span class="line"> <span class="keyword">using</span> <span class="string">&#x27;(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.184.145)(PORT = 1521))  ) (CONNECT_DATA = (SERVICE_NAME = coco) ) )&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>1.5 源端和目标端设置临时目录 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@<span class="built_in">source</span>]$ <span class="built_in">export</span> TMPDIR=/home/oracle/xtts/scripts</span><br><span class="line">[oracle@dest]$ <span class="built_in">export</span> TMPDIR=/home/oracle/xtts/scripts</span><br></pre></td></tr></table></figure>
</li>
<li><p>Prepare Phase for RMAN Backup Method</p>
<p>2.1 源端生成数据文件副本至 <code>dfcopydir</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -p</span><br></pre></td></tr></table></figure>

<p>2.2 拷贝数据文件副本和 rmanconvert.cmd 文件至目标端 <code>stageondest</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp /home/oracle/xtts/backup/* oracle@dest:/home/oracle/xtts/backup</span><br><span class="line">scp <span class="variable">$TMPDIR</span>/rmanconvert.cmd oracle@dest:<span class="variable">$TMPDIR</span></span><br></pre></td></tr></table></figure>

<p>2.3 目标端进行数据文件字节序转换 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -c</span><br></pre></td></tr></table></figure>
</li>
<li><p>Roll Forward Phase</p>
<p>3.1 源端生成增量备份文件至 <code>backupformat</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i</span><br></pre></td></tr></table></figure>

<p>3.2 拷贝增量备份文件、xttplan、tsbkupmap 至目标端 <code>stageondest</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp `<span class="built_in">cat</span> <span class="variable">$TMPDIR</span>/incrbackups.txt` oracle@dest:/home/oracle/xtts/backup</span><br><span class="line">scp <span class="variable">$TMPDIR</span>/xttplan.txt oracle@des:<span class="variable">$TMPDIR</span></span><br><span class="line">scp <span class="variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="variable">$TMPDIR</span></span><br></pre></td></tr></table></figure>

<p>3.3 目标端做增量前滚 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r</span><br></pre></td></tr></table></figure>

<p>3.4 源端确定下一个增量备份的 FROM_SCN</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -s</span><br></pre></td></tr></table></figure>

<p>3.5 Repeat the Roll Forward Phase (Phase 3)</p>
</li>
<li><p>Transport Phase</p>
<p>4.1 源端将表空间置为只读模式 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;ALTER TABLESPACE &#x27;</span><span class="operator">||</span>name<span class="operator">||</span><span class="string">&#x27; READ ONLY;&#x27;</span> exec_sql</span><br><span class="line"> <span class="keyword">from</span> v$tablespace <span class="keyword">where</span> NAME <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;USERS&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tablespace_name,status <span class="keyword">from</span> dba_tablespaces;</span><br></pre></td></tr></table></figure>

<p>4.2 重复步骤 3.1 - 3.3，做最后一次增量前滚 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[oracle@<span class="built_in">source</span>]$ <span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i</span><br><span class="line"></span><br><span class="line">[oracle@<span class="built_in">source</span>]$ scp `<span class="built_in">cat</span> incrbackups.txt` oracle@dest:/home/oracle/xtts/backup</span><br><span class="line"></span><br><span class="line">[oracle@<span class="built_in">source</span>]$ scp <span class="variable">$TMPDIR</span>/xttplan.txt oracle@dest:<span class="variable">$TMPDIR</span></span><br><span class="line">[oracle@<span class="built_in">source</span>]$ scp <span class="variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="variable">$TMPDIR</span></span><br><span class="line"></span><br><span class="line">[oracle@dest]$ <span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r</span><br></pre></td></tr></table></figure>
</li>
<li><p>Import Object Metadata into Destination Database</p>
<p>5.1 目标端创建业务用户 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;ITPUX01&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:98BB089CD1A16CBD4803C404C3279A570D607F667DD6E5EB7A19735B7FA6;358208C73FF2939C&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;COCO&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:37AB55E527FC21D62DEA2949499DD9D9F7EC2A5C97C9140A23ADEBB365BD;96B138098030A3C8&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;ITPUX02&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:21BC086145990A7CC133F01E0D80B7548EA49DB694F44E972CEC33685168;499779BC208401AE&#x27;</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> &quot;ITPUX03&quot; IDENTIFIED <span class="keyword">BY</span> <span class="keyword">VALUES</span> <span class="string">&#x27;S:4C2C70077865FBFE627E08288E24FC9307DAF72DAC9C36EA9D31AE332263;CE4FDA4704D5UX00F9C&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;ITPUX01&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;COCO&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;ITPUX02&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> &quot;DBA&quot; <span class="keyword">TO</span> &quot;ITPUX03&quot;;</span><br></pre></td></tr></table></figure>

<p>5.2 目标端生成 Data Pump TTS 命令 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -e</span><br><span class="line"><span class="built_in">cat</span> /home/oracle/xtts/scripts/xttplugin.txt</span><br></pre></td></tr></table></figure>

<p>5.3 迁移表空间元数据 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">impdp system/oracle@pdb directory=DATA_PUMP_DIR logfile=tts_imp.log \</span><br><span class="line">network_link=ttslink transport_full_check=no \</span><br><span class="line">exclude=statistics \</span><br><span class="line">transport_tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03 \</span><br><span class="line">transport_datafiles=<span class="string">&#x27;+DATA/tbs_coco_8.dbf&#x27;</span>,<span class="string">&#x27;+DATA/itpux01_5.dbf&#x27;</span>,<span class="string">&#x27;+DATA/itpux02_6.dbf&#x27;</span>,<span class="string">&#x27;+DATA/itpux03_7.dbf&#x27;</span></span><br></pre></td></tr></table></figure>

<p>5.4 迁移存储过程、触发器、函数、包、视图、序列 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">impdp system/oracle@pdb directory=DATA_PUMP_DIR \</span><br><span class="line">network_link=ttslink schemas=COCO,ITPUX01,ITPUX02,ITPUX03 content=metadata_only exclude=index,table parallel=8</span><br></pre></td></tr></table></figure>

<p>5.5 导入同义词、dblink 和其他对象 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 导入公共同义词 </span></span><br><span class="line"><span class="keyword">set</span> long <span class="number">9999</span></span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_ddl(<span class="string">&#x27;SYNONYM&#x27;</span>,SYNONYM_NAME,OWNER)</span><br><span class="line"> <span class="keyword">FROM</span> dba_synonyms <span class="keyword">where</span> owner<span class="operator">=</span><span class="string">&#x27;PUBLIC&#x27;</span> <span class="keyword">and</span> table_owner <span class="keyword">in</span>  (<span class="string">&#x27;COCO&#x27;</span>,<span class="string">&#x27;ITPUX01&#x27;</span>,<span class="string">&#x27;ITPUX02&#x27;</span>,<span class="string">&#x27;ITPUX03&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 导入 dblink</span></span><br><span class="line"><span class="keyword">set</span> long <span class="number">9999</span></span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_ddl(<span class="string">&#x27;DB_LINK&#x27;</span>,DB_LINK,OWNER) <span class="keyword">FROM</span> DBA_DB_LINKS;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Post-migration</p>
<p>6.1 检查数据库一致性 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> owner, object_type, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"> <span class="keyword">from</span> dba_objects</span><br><span class="line"> <span class="keyword">where</span> object_name <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;BIN%&#x27;</span></span><br><span class="line"> <span class="keyword">and</span> owner <span class="keyword">in</span> (<span class="string">&#x27;COCO&#x27;</span>,<span class="string">&#x27;ITPUX01&#x27;</span>,<span class="string">&#x27;ITPUX02&#x27;</span>,<span class="string">&#x27;ITPUX03&#x27;</span>)</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> owner, object_type</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p>6.2 业务用户修改权限和默认表空间 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;ITPUX01&quot; <span class="keyword">DEFAULT</span> TABLESPACE &quot;ITPUX01&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;ITPUX02&quot; <span class="keyword">DEFAULT</span> TABLESPACE &quot;ITPUX02&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;ITPUX03&quot; EFAULT TABLESPACE &quot;ITPUX03&quot;;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> &quot;COCO&quot; <span class="keyword">DEFAULT</span> TABLESPACE &quot;TBS_COCO&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> UNLIMITED TABLESPACE <span class="keyword">TO</span> &quot;ITPUX01&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> UNLIMITED TABLESPACE <span class="keyword">TO</span> &quot;COCO&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> UNLIMITED TABLESPACE <span class="keyword">TO</span> &quot;ITPUX02&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">CREATE</span> JOB <span class="keyword">TO</span> &quot;COCO&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> &quot;COCO&quot;.&quot;TESTTABLE&quot; <span class="keyword">TO</span> &quot;ITPUX01&quot;;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> &quot;SYS&quot;.&quot;DBA_USERS&quot; <span class="keyword">TO</span> &quot;COCO&quot;;</span><br></pre></td></tr></table></figure>

<p>6.3 表空间置为读写模式 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;ALTER TABLESPACE &#x27;</span><span class="operator">||</span>name<span class="operator">||</span><span class="string">&#x27; READ WRITE;&#x27;</span> exec_sql <span class="keyword">from</span> v$tablespace</span><br><span class="line"> <span class="keyword">where</span> NAME <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;SYSTEM&#x27;</span>,<span class="string">&#x27;SYSAUX&#x27;</span>,<span class="string">&#x27;UNDOTBS1&#x27;</span>,<span class="string">&#x27;TEMP&#x27;</span>,<span class="string">&#x27;USERS&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>6.4 校验数据文件完整性 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">RMAN<span class="operator">&gt;</span> validate tablespace COCO,ITPUX01,ITPUX02,ITPUX03 <span class="keyword">check</span> logical;</span><br></pre></td></tr></table></figure>

<p>6.5 收集统计信息 </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">exec</span> dbms_stats.gather_database_stats(degree <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">8</span>);</span><br><span class="line"><span class="keyword">exec</span> dbms_stats.gather_dictionary_stats(degree <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">8</span>);</span><br><span class="line"><span class="keyword">exec</span> dbms_stats.gather_fixed_objects_stats();</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>Overview</title>
    <url>/blog/posts/1eb5b3ed.html</url>
    <content><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>XTTS(Cross Platform Transportable Tablespaces)属于跨平台迁移表空间，它是从 Oracle 8i 开始就引入的一种基于表空间传输的物理迁移方法，命名为 TTS，经历各个版本的不断演进，从 11gR2 开始，在相对停机时间要求日益减少的情况，为了应对越来越大的数据量跨平台迁移，Oracle 推出了新的解决方案—加强版 TTS（以下简称 XTTS），XTTS 使用增量备份的方式实现跨平台的数据迁移，从真正意义上大大缩短停机时间。在 U2L 如火如荼的今天，通过 XTTS 快捷、高效、平稳、安全的将 Oracle 数据库“小型机 + 集中式存储”环境迁移至“X86 架构平台 + 分布式存储”已然成为一大神技。</p>
<p>XTTS 的发展历史：</p>
<ul>
<li>从 8i，tts 技术的诞生，引入了相同平台相同块大小之间的表空间传输。到了 9i，tts 开始支持同平台中，不同块大小的表空间传输。</li>
<li>10g 时代，不仅引入了跨平台的表空间传输方案，也就是我们说的 xtts；10gR2 开始支持传输整个数据库。</li>
<li>11gR1 开始，可以传输表空间中的某个特定分区。</li>
<li>在 11.2.0.4 开始，为了应对越来越大的数据量，而停机时间甚至还在减少的情况，出现了新的解决方案—使用增量备份方式的 xtts。</li>
</ul>
<p>XTTS 各版本的功能比对如下：<br><img src="https://s2.loli.net/2022/04/13/jlKP71yr3BCNovk.png"></p>
<p>在 Oracle11gR2（推荐使用 11.2.0.4 及之后版本）以后，Oracle 推出了通过前滚数据文件，拷贝数据后再进行多次增量备份的 XTTS 来完成迁移过程，在这个过程中通过开启块跟踪特性，根据 SCN 号来执行一系列的增量备份，并且通过对块跟踪文件的扫描，来完成增量数据的增量备份应用，最后在通过一定的停机时间，在源库 read only 的状态下进行最后一次增量备份转换应用，使得整个迁移过程的停机时间同源库数据块的变化率成正比。这样大大的缩短了停机时间。</p>
<p>为了减少正式的停机时间，oracle 在 xtts 中引入了 rman 的增量备份前滚功能。通过一次又一次的增量备份，使停应用的时间主要包含四个方面：将表空间置为只读，最后进行一次增量前滚，元数据导入，数据文件校验。和传统的表空间传输相比，通过减少数据文件的传输时间，而大大减少了整体停机时间。</p>
<h2 id="全量迁移方式"><a href="# 全量迁移方式" class="headerlink" title="全量迁移方式"></a>全量迁移方式 </h2><p> 对于 XTTS 的全量操作，Oracle 提供了 2 种方式来进行，分别如下：<br><strong>1）dbms_file_transfer(DFT)</strong> – (using xttdriver.pl -S and -G options)</p>
<p>DBMS_FILE_TRANSFER 包是 Oracle 提供的一个用于复制二进制数据库文件或在数据库之间传输二进制文件的程序包，在 XTTS 迁移中，利用不同的参数进行数据文件传输转换完成迁移。</p>
<p><strong>要求：</strong> 目标端数据库版本必须是 11.2.0.4 以及更新的版本。如果数据库版本低于 11.2.0.4(大于 Oracle10R1)，那么目标端环境，仍然需要安装 11.2.0.4 以及更新版本的临时环境，因为 XTTS 增量的核心脚本功能必须是基于 11.2.0.4(+)版本。</p>
<p>如果准备使用 DDBMS_FILE_TRANSFER 作为全量迁移方法，那么必须创建三个数据库对象：</p>
<ol>
<li>源数据库中的数据库目录对象。</li>
<li>目标数据库中的数据库目录对象，放置数据文件的位置。</li>
<li>在目标数据库中创建指向源库的数据库链接。</li>
</ol>
<p><strong>2）Recovery Manager(RMAN)</strong> – (using xttdriver.pl -p and -c options)</p>
<p>通过使用 rman-xttconvert 包提供的参数，对数据库进行基于表空间的备份，将备份产生的备份集写到本地或者 NFS 盘上，然后再通过 rman-xttconvert 包中包含的不同平台之间数据文件格式转换的包对进行数据文件格式转换，最后通过记录的表空间 FILE_ID 号生产元数据的导入脚本，通过 db_link 执行完成。</p>
<h2 id="xttdriver-pl-opation"><a href="#xttdriver-pl-opation" class="headerlink" title="xttdriver.pl opation"></a>xttdriver.pl opation</h2><p><img src="https://s2.loli.net/2022/04/13/lKSgkRhO9c3TQzI.png"></p>
<h2 id="xtt-properties-parameters"><a href="#xtt-properties-parameters" class="headerlink" title="xtt.properties parameters"></a>xtt.properties parameters</h2><p><img src="https://s2.loli.net/2022/04/13/A4IHuRxsqa8TNGv.png"></p>
<h2 id="file-description"><a href="#file-description" class="headerlink" title="file description"></a>file description</h2><ul>
<li><strong>xttplan.txt</strong> - containing the tablespace names, their current SCNs and their datafile numbers</li>
<li><strong>xttnewdatafiles.txt</strong> - containing the tablespace names, datafile numbers, the destination directory object name and the source filenames</li>
<li><strong>getfile.sql</strong> - The PL&#x2F;SQL script(formatting ours) that will be used at the destination to get the datafilesfrom the source</li>
<li><strong>xttpreparesrc.sql</strong> - the PL&#x2F;SQL scriptused to create the files in this step</li>
<li><strong>xttprepareNaNd</strong> - the command</li>
<li><strong>tsbkupmap.txt</strong> - containing the tablespace names, datafile numbers and the incremental backup pieces</li>
<li><strong>incrbackups.txt</strong> - containing the actual location of the incremental backup pieces</li>
<li><strong>rmanincrNaNd</strong> - containing the RMAN scripts used to create the incremental backups.</li>
<li><strong>xttdetnewfromscnsrc.sql</strong> - the PL&#x2F;SQLscript used to create the files in this step</li>
<li><strong>xttplan.txt.new</strong>- after the first run of’xttdriver.pl -i’ this is just a copy of the xttplan.txt</li>
</ul>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>overview</tag>
        <tag>xtts</tag>
      </tags>
  </entry>
</search>
