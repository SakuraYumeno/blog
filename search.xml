<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Butterfly主题美化配置</title>
    <url>/blog/posts/5537.html</url>
    <content><![CDATA[<h1 id="Butterfly主题美化配置"><a href="#Butterfly主题美化配置" class="headerlink" title="Butterfly主题美化配置"></a>Butterfly主题美化配置</h1><h2 id="自定义文件结构"><a href="#自定义文件结构" class="headerlink" title="自定义文件结构"></a>自定义文件结构</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs plaintext">+--- css<br>|   +--- index_custom.styl<br>|   +--- _custom<br>|   |   +--- background.css<br>|   |   +--- font.css<br>+--- font<br>|   +--- CascadiaMono.woff2<br>|   +--- ZhuZiAWan.woff2<br>+--- img<br>|   +--- avatar.jpg<br>+--- js<br></code></pre></td></tr></table></figure>

<p>在<code>/blog_root/source</code>中创建<code>css/font/js</code>目录，在css目录中创建_custom用于存放自定义css文件。<br>创建index_custom.styl文件，添加如下内容:</p>
<figure class="highlight styl"><table><tr><td class="code"><pre><code class="hljs styl"><span class="hljs-keyword">@import</span> <span class="hljs-string">&#x27;_custom/*.css&#x27;</span><br></code></pre></td></tr></table></figure>

<p>修改主题配置文件，添加inject参数</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Inject</span><br><span class="hljs-comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span><br><span class="hljs-comment"># 插入代码到头部 &lt;/head&gt; 之前 和 底部 &lt;/body&gt; 之前</span><br><span class="hljs-attr">inject:</span><br>  <span class="hljs-attr">head:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&lt;link</span> <span class="hljs-string">rel=&quot;stylesheet&quot;</span> <span class="hljs-string">href=&quot;/blog/css/index_custom.css&quot;</span> <span class="hljs-string">media=&quot;defer&quot;</span> <span class="hljs-string">onload=&quot;this.media=&#x27;all&#x27;&quot;&gt;</span><br>  <span class="hljs-attr">bottom:</span><br>    <span class="hljs-comment"># - &lt;script src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span><br></code></pre></td></tr></table></figure>

<h2 id="设置主题背景"><a href="#设置主题背景" class="headerlink" title="设置主题背景"></a>设置主题背景</h2>]]></content>
  </entry>
  <entry>
    <title>Cloudflare</title>
    <url>/blog/posts/24517.html</url>
    <content><![CDATA[<h1 id="Cloudflare"><a href="#Cloudflare" class="headerlink" title="Cloudflare"></a>Cloudflare</h1><h2 id="Native-Terminal"><a href="#Native-Terminal" class="headerlink" title="Native Terminal"></a>Native Terminal</h2><ol>
<li><p>Install cloudflared on the client machine.</p>
</li>
<li><p>Make a one-time change to your SSH configuration file:</p>
<p> <code>vim ~/.ssh/config</code></p>
</li>
<li><p>Input the following values; replacing ssh.example.com with the hostname you created.</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">Host ssh.example.com<br>ProxyCommand /usr/local/bin/cloudflared access ssh --hostname %h<br></code></pre></td></tr></table></figure>

<p> The cloudflared path may be different depending on your OS and package manager. For example, if you installed cloudflared on macOS with Homebrew, the path is &#x2F;opt&#x2F;homebrew&#x2F;bin&#x2F;cloudflared.</p>
</li>
<li><p>You can now test the connection by running a command to reach the service:</p>
<p> <code>ssh &lt;username&gt;@ssh.example.com</code></p>
<p> When the command is run, cloudflared will launch a browser window to prompt you to authenticate with your identity provider before establishing the connection from your terminal.</p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>Git</title>
    <url>/blog/posts/25246.html</url>
    <content><![CDATA[<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">git config --global user.name  &quot;username&quot;  <br>git config --global user.email  &quot;email&quot;<br></code></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/blog/posts/16107.html</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>Qemu</title>
    <url>/blog/posts/38125.html</url>
    <content><![CDATA[<h1 id="Qemu"><a href="#Qemu" class="headerlink" title="Qemu"></a>Qemu</h1><h2 id="AIX-7-2"><a href="#AIX-7-2" class="headerlink" title="AIX 7.2"></a>AIX 7.2</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">qemu-img create -f qcow2 hdisk0.qcow2 20G<br><br>qemu-system-ppc64 -cpu POWER8 -machine pseries -m 4096 -serial stdio \<br>-drive file=hdisk0.qcow2,<span class="hljs-keyword">if</span>=none,<span class="hljs-built_in">id</span>=drive-virtio-disk0 -device virtio-scsi-pci,<span class="hljs-built_in">id</span>=scsi \<br>-device scsi-hd,drive=drive-virtio-disk0 -cdrom AIX_v7.2_Install_7200-03-03-1913_DVD_1_of_2_052019.iso \<br>-prom-env <span class="hljs-string">&quot;boot-command=boot cdrom:&quot;</span><br><br>qemu-system-ppc64 -cpu POWER8 -machine pseries -m 4096 -serial stdio \<br>-drive file=hdisk0.qcow2,<span class="hljs-keyword">if</span>=none,<span class="hljs-built_in">id</span>=drive-virtio-disk0 -device virtio-scsi-pci,<span class="hljs-built_in">id</span>=scsi \<br>-device scsi-hd,drive=drive-virtio-disk0 -cdrom AIX_v7.2_Install_7200-03-03-1913_DVD_1_of_2_052019.iso \<br>-prom-env <span class="hljs-string">&quot;boot-command=boot disk:&quot;</span><br></code></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>qemu</tag>
      </tags>
  </entry>
  <entry>
    <title>Commands</title>
    <url>/blog/posts/21355.html</url>
    <content><![CDATA[<h1 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h1><h2 id="docker-logs"><a href="#docker-logs" class="headerlink" title="docker logs"></a>docker logs</h2><p>查看日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker logs &lt;container&gt;<br>docker logs -f &lt;container&gt;<br></code></pre></td></tr></table></figure>

<p>查看某段时间的日志</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker logs -f -t --since=&quot;2022-08-12&quot; --tail=100 &lt;container&gt;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>cmd</tag>
      </tags>
  </entry>
  <entry>
    <title>WSL</title>
    <url>/blog/posts/54668.html</url>
    <content><![CDATA[<h1 id="WSL"><a href="#WSL" class="headerlink" title="WSL"></a>WSL</h1><h2 id="Systemd-support"><a href="#Systemd-support" class="headerlink" title="Systemd support"></a>Systemd support</h2><p>To enable systemd, open your <code>wsl.conf</code> file in a text editor using <code>sudo</code> for admin permissions and add these lines to the <code>/etc/wsl.conf</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;[boot]\nsystemd=true&quot;</span> | sudo <span class="hljs-built_in">tee</span> -a /etc/wsl.conf<br></code></pre></td></tr></table></figure>

<h2 id="Open-file-with-explorer-exe"><a href="#Open-file-with-explorer-exe" class="headerlink" title="Open file with explorer.exe"></a>Open file with explorer.exe</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-function"><span class="hljs-title">open</span></span> ()<br>&#123;<br>    wp=$(wslpath -w <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span>);<br>    explorer.exe <span class="hljs-string">&quot;<span class="hljs-variable">$wp</span>&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>wsl</tag>
      </tags>
  </entry>
  <entry>
    <title>Configuration</title>
    <url>/blog/posts/28215.html</url>
    <content><![CDATA[<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><h2 id="Restart-Policy"><a href="#Restart-Policy" class="headerlink" title="Restart Policy"></a>Restart Policy</h2><p>To configure the restart policy for a container, use the <code>--restart</code> flag when using the <code>docker run</code> command. The value of the <code>--restart</code> flag can be any of the following:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>no</code></td>
<td>Do not automatically restart the container. (the default)</td>
</tr>
<tr>
<td><code>on-failure[:max-retries]</code></td>
<td>Restart the container if it exits due to an error, which manifests as a non-zero exit code. Optionally, limit the number of times the Docker daemon attempts to restart the container using the <code>:max-retries</code> option.</td>
</tr>
<tr>
<td><code>always</code></td>
<td>Always restart the container if it stops. If it is manually stopped, it is restarted only when Docker daemon restarts or the container itself is manually restarted. (See the second bullet listed in <a href="https://docs.docker.com/config/containers/start-containers-automatically/#restart-policy-details">restart policy details</a>)</td>
</tr>
<tr>
<td><code>unless-stopped</code></td>
<td>Similar to <code>always</code>, except that when the container is stopped (manually or otherwise), it is not restarted even after Docker daemon restarts.</td>
</tr>
</tbody></table>
<p>The following example starts a Redis container and configures it to always restart unless it is explicitly stopped or Docker is restarted.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">docker run -d --restart unless-stopped redis<br></code></pre></td></tr></table></figure>

<p>This command changes the restart policy for an already running container named <code>redis</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">docker update --restart unless-stopped redis<br></code></pre></td></tr></table></figure>

<p>And this command will ensure all currently running containers will be restarted unless stopped.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">docker update --restart unless-stopped $(docker ps -q)<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>config</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle Image Overview</title>
    <url>/blog/posts/25826.html</url>
    <content><![CDATA[<h4 id="Default-setting"><a href="#Default-setting" class="headerlink" title="Default setting"></a>Default setting</h4><p>Database located in <code>/u01/app/oracle</code> folder</p>
<p><strong>OS users:</strong><br>root&#x2F;welcome<br>oracle&#x2F;oracle</p>
<p><strong>DB users:</strong><br>sys&#x2F;oacle<br>system&#x2F;oracle</p>
<p><strong>ENV:</strong><br>ORACLE_SID&#x3D;orcl<br>CHARACTERSET&#x3D;ZHS16GBK</p>
<h4 id="Start-a-oracle-server-instance"><a href="#Start-a-oracle-server-instance" class="headerlink" title="Start a oracle server instance"></a>Start a <code>oracle</code> server instance</h4><p>Starting a Oracle 11g instance is simple:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker run --privileged --name oracle-11g -p 15210:1521 -v /unzipped-database-folder:/install oracle:tag<br></code></pre></td></tr></table></figure>

<h4 id="Using-database-datapump"><a href="#Using-database-datapump" class="headerlink" title="Using database datapump"></a>Using database datapump</h4><p>Optionally you can map dpdump folder to easy upload dumps:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker run --privileged --name oracle-11g -p 15210:1521 -v /unzipped-database-folder:/install -v /datapump-folder:/datapump oracle:tag<br></code></pre></td></tr></table></figure>

<p>To execute expdp&#x2F;impdp just use docker exec command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker exec -i oracle-11g expdp ...<br></code></pre></td></tr></table></figure>

<p>For more information, please visit <a href="https://github.com/Jove-2761781/docker-images/tree/main/oracle/11.2.0.4">Quick reference</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
        <tag>ref</tag>
      </tags>
  </entry>
  <entry>
    <title>OSI</title>
    <url>/blog/posts/53708.html</url>
    <content><![CDATA[<h1 id="OSI-参考模型"><a href="#OSI-参考模型" class="headerlink" title="OSI 参考模型"></a>OSI 参考模型</h1><p><img src="https://pic2.zhimg.com/v2-1dd6e1ed2f348db47ce0cde38d545ae9_r.jpg"></p>
<blockquote>
<p><strong>传输层</strong>: 源端口号2字节，目的端口号2字节，SYN和ACK各1比特<br><strong>网络层</strong>: 源IP地址4字节，目的IP地址4字节，PROTOCOL字段1字节<br><strong>PROTOCOL字段</strong>: 1(ICMP), 6(TCP), 17(UDP), 88(EIGRP), 89(OSPF)<br><strong>数据链路层</strong>: 源MAC地址6字节，目的MAC地址6字节，TYPE字段2字节<br><strong>TYPE字段</strong>: 0x0800(IPv4), 0x0806(ARP), 0x08dd(IPv6)</p>
</blockquote>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>osi</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Image Overview</title>
    <url>/blog/posts/59956.html</url>
    <content><![CDATA[<h4 id="Start-a-mysql-server-instance"><a href="#Start-a-mysql-server-instance" class="headerlink" title="Start a mysql server instance"></a>Start a <code>mysql</code> server instance</h4><p>Starting a MySQL instance is simple:</p>
<figure class="highlight console"><table><tr><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run --name some-mysql -p33060:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br></code></pre></td></tr></table></figure>

<p>where <code>some-mysql</code> is the name you want to assign to your container, <code>my-secret-pw</code> is the password to be set for the MySQL root user and <code>tag</code> is the tag specifying the MySQL version you want. See the list above for relevant tags.</p>
<h4 id="Using-a-custom-MySQL-configuration-file"><a href="#Using-a-custom-MySQL-configuration-file" class="headerlink" title="Using a custom MySQL configuration file"></a>Using a custom MySQL configuration file</h4><p>The default configuration for MySQL can be found in <code>/etc/mysql/my.cnf</code>, which may <code>!includedir</code> additional directories such as <code>/etc/mysql/conf.d</code> or <code>/etc/mysql/mysql.conf.d</code>. Please inspect the relevant files and directories within the <code>mysql</code> image itself for more details.</p>
<p>If <code>/my/custom/config-file.cnf</code> is the path and name of your custom configuration file, you can start your <code>mysql</code> container like this (note that only the directory path of the custom config file is used in this command):</p>
<figure class="highlight console"><table><tr><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br></code></pre></td></tr></table></figure>

<p>This will start a new container <code>some-mysql</code> where the MySQL instance uses the combined startup settings from <code>/etc/mysql/my.cnf</code> and <code>/etc/mysql/conf.d/config-file.cnf</code>, with settings from the latter taking precedence.</p>
<h4 id="Creating-database-dumps"><a href="#Creating-database-dumps" class="headerlink" title="Creating database dumps"></a>Creating database dumps</h4><p>Most of the normal tools will work, although their usage might be a little convoluted in some cases to ensure they have access to the <code>mysqld</code> server. A simple way to ensure this is to use <code>docker exec</code> and run the tool from the same container, similar to the following:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker exec some-mysql sh -c &#x27;exec mysqldump --all-databases -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#x27; &gt; /some/path/on/your/host/all-databases.sql<br></code></pre></td></tr></table></figure>

<h4 id="Restoring-data-from-dump-files"><a href="#Restoring-data-from-dump-files" class="headerlink" title="Restoring data from dump files"></a>Restoring data from dump files</h4><p>For restoring data. You can use <code>docker exec</code> command with <code>-i</code> flag, similar to the following:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker exec -i some-mysql sh -c &#x27;exec mysql -uroot -p&quot;$MYSQL_ROOT_PASSWORD&quot;&#x27; &lt; /some/path/on/your/host/all-databases.sql<br></code></pre></td></tr></table></figure>

<p>For more information, please visit <a href="https://hub.docker.com/_/mysql">Quick reference</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
        <tag>ref</tag>
      </tags>
  </entry>
  <entry>
    <title>alwayson database can not shrink log file</title>
    <url>/blog/posts/24855.html</url>
    <content><![CDATA[<h1 id="alwayson-database-can-not-shrink-log-file"><a href="#alwayson-database-can-not-shrink-log-file" class="headerlink" title="alwayson database can not shrink log file"></a>alwayson database can not shrink log file</h1><p>AlwaysOn database 事务日志截断后，日志文件无法收缩，导致日志文件占用磁盘空间大。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>If you have scheduled T-Log Backup on alwaysOn Database, After completion of T-Log Backup check the <strong>log_reuse_wait_desc</strong> of database using query</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name,log_reuse_wait_desc <span class="hljs-keyword">from</span> sys.databases <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;Name Of Database&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>If column log_reuse_wait_desc returns value “<strong>NOTHING</strong>“, Immediately execute <strong>DBCC SHRINKFILE</strong> Command and shrink Log File without Error.</p>
]]></content>
      <categories>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Preconfig</title>
    <url>/blog/posts/12033.html</url>
    <content><![CDATA[<h1 id="Preconfig"><a href="#Preconfig" class="headerlink" title="Preconfig"></a>Preconfig</h1><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">enable<br>configure terminal<br>line console 0<br>no exec-timeout<br>logging synchronous<br>no ip domain lookup<br>hostname<br></code></pre></td></tr></table></figure>

<p><strong>save config</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">copy running-config startup-config</span><br><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">write</span><br></code></pre></td></tr></table></figure>

<p><strong>erase config</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">erase startup-config</span><br><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">erase nvram:</span><br><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">write erase</span><br></code></pre></td></tr></table></figure>

<p><strong>filter strings</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">show running-config | include 0/0</span><br><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">show running-config | section 0/0</span><br></code></pre></td></tr></table></figure>

<p><strong>telnet mode</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">SW1# </span><span class="language-bash">conf t</span><br><span class="hljs-meta prompt_">SW1(config)# </span><span class="language-bash">line vty 0 4</span><br><span class="hljs-meta prompt_">SW1(config-line)# </span><span class="language-bash">transport input telnet</span><br><span class="hljs-meta prompt_">SW1(config-line)# </span><span class="language-bash">password welcome</span><br><span class="hljs-meta prompt_">SW1(config-line)# </span><span class="language-bash">login</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>config</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup &amp; Restore</title>
    <url>/blog/posts/52495.html</url>
    <content><![CDATA[<h1 id="Backup-amp-Restore"><a href="#Backup-amp-Restore" class="headerlink" title="Backup &amp; Restore"></a>Backup &amp; Restore</h1><ol>
<li>Full Backup</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">BACKUP DATABASE [zsyydb] <span class="hljs-keyword">TO</span> DISK<span class="hljs-operator">=</span>N<span class="hljs-string">&#x27;\\192.0.33.222\Backup\zsyydb.bak&#x27;</span><br><span class="hljs-keyword">WITH</span> NOFORMAT,NOINIT,NAME<span class="hljs-operator">=</span>N<span class="hljs-string">&#x27;zsyydb-full&#x27;</span>,<span class="hljs-keyword">SKIP</span>,NOREWIND,NOUNLOAD,STATS<span class="hljs-operator">=</span><span class="hljs-number">5</span><br>GO<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>Full Restore</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">RESTORE DATABASE [zsyydb] <span class="hljs-keyword">FROM</span> DISK<span class="hljs-operator">=</span>N<span class="hljs-string">&#x27;D:\backup\zsyydb.bak&#x27;</span> <span class="hljs-keyword">WITH</span> FILE<span class="hljs-operator">=</span><span class="hljs-number">1</span>,REPLACE,<br>MOVE N<span class="hljs-string">&#x27;zsyydb&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\zsyydb.mdf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;HistoryData&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\HistoryData.ndf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;UnConfirm2013&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\UnConfirm2013.ndf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;zsyylog&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb.ldf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;zsyylog_1&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb1.ldf&#x27;</span>,<br>NORECOVERY,NOUNLOAD,STATS<span class="hljs-operator">=</span> <span class="hljs-number">5</span><br>GO<br></code></pre></td></tr></table></figure>

<ol>
<li>Diff Backup</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">BACKUP DATABASE [zsyydb] <span class="hljs-keyword">TO</span> DISK<span class="hljs-operator">=</span>N<span class="hljs-string">&#x27;\\192.0.33.222\Backup\zsyydb01.bak&#x27;</span><br><span class="hljs-keyword">WITH</span> DIFFERENTIAL,NOFORMAT,NOINIT,NAME<span class="hljs-operator">=</span>N<span class="hljs-string">&#x27;zsyydb-差异数据库备份&#x27;</span>,<span class="hljs-keyword">SKIP</span>,NOREWIND,NOUNLOAD,STATS<span class="hljs-operator">=</span><span class="hljs-number">5</span><br>GO<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>Diff Restore</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">RESTORE DATABASE [zsyydb] <span class="hljs-keyword">FROM</span> DISK<span class="hljs-operator">=</span>N<span class="hljs-string">&#x27;D:\backup\zsyydb01.bak&#x27;</span> <span class="hljs-keyword">WITH</span> FILE<span class="hljs-operator">=</span> <span class="hljs-number">1</span>,REPLACE,<br>MOVE N<span class="hljs-string">&#x27;zsyydb&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\zsyydb.mdf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;HistoryData&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\HistoryData.ndf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;UnConfirm2013&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\UnConfirm2013.ndf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;zsyylog&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb.ldf&#x27;</span>,<br>MOVE N<span class="hljs-string">&#x27;zsyylog_1&#x27;</span><span class="hljs-keyword">TO</span> N<span class="hljs-string">&#x27;T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb1.ldf&#x27;</span>,<br>NOUNLOAD,STATS<span class="hljs-operator">=</span><span class="hljs-number">5</span><br>GO<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>backup</tag>
        <tag>restore</tag>
      </tags>
  </entry>
  <entry>
    <title>orphaned users</title>
    <url>/blog/posts/48882.html</url>
    <content><![CDATA[<h1 id="orphaned-users"><a href="#orphaned-users" class="headerlink" title="orphaned users"></a>orphaned users</h1><p>Step 1:  检测、查看对应的孤立账号</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">USE <span class="hljs-operator">&lt;</span>DatabaseName<span class="hljs-operator">&gt;</span>;<br>GO<br><span class="hljs-keyword">EXEC</span> sp_change_users_login <span class="hljs-variable">@Action</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;Report&#x27;</span>;<br>GO<br></code></pre></td></tr></table></figure>

<p>Step 2: 新建对应的登录名，例如上面检测到Test账号为孤立账号</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">USE [master]<br>GO<br><span class="hljs-keyword">CREATE</span> LOGIN [Test] <span class="hljs-keyword">WITH</span> PASSWORD<span class="hljs-operator">=</span>N<span class="hljs-string">&#x27;Pa@#456&#x27;</span> MUST_CHANGE, DEFAULT_DATABASE<span class="hljs-operator">=</span>[xxxx], CHECK_EXPIRATION<span class="hljs-operator">=</span><span class="hljs-keyword">ON</span>, CHECK_POLICY<span class="hljs-operator">=</span><span class="hljs-keyword">ON</span><br>GO<br></code></pre></td></tr></table></figure>

<p>Step 3:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">USE EASN_EAP;<br>GO<br><span class="hljs-keyword">EXEC</span> sp_change_users_login <span class="hljs-variable">@Action</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;Update_one&#x27;</span>,<span class="hljs-variable">@UserNamePattern</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;xxxx&#x27;</span>,<span class="hljs-variable">@LoginName</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;xxxx&#x27;</span>;<br>GO<br></code></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>sp_help_revlogin</title>
    <url>/blog/posts/20493.html</url>
    <content><![CDATA[<h1 id="sp-help-revlogin"><a href="#sp-help-revlogin" class="headerlink" title="sp_help_revlogin"></a>sp_help_revlogin</h1><figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">USE master<br>GO<br>IF OBJECT_ID (<span class="hljs-string">&#x27;sp_hexadecimal&#x27;</span>) <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>  <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> sp_hexadecimal<br>GO<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> sp_hexadecimal<br>    <span class="hljs-variable">@binvalue</span> <span class="hljs-type">varbinary</span>(<span class="hljs-number">256</span>),<br>    <span class="hljs-variable">@hexvalue</span> <span class="hljs-type">varchar</span> (<span class="hljs-number">514</span>) OUTPUT<br><span class="hljs-keyword">AS</span><br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@charvalue</span> <span class="hljs-type">varchar</span> (<span class="hljs-number">514</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@i</span> <span class="hljs-type">int</span><br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@length</span> <span class="hljs-type">int</span><br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@hexstring</span> <span class="hljs-type">char</span>(<span class="hljs-number">16</span>)<br><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@charvalue</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0x&#x27;</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@length</span> <span class="hljs-operator">=</span> DATALENGTH (<span class="hljs-variable">@binvalue</span>)<br><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@hexstring</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0123456789ABCDEF&#x27;</span><br>WHILE (<span class="hljs-variable">@i</span> <span class="hljs-operator">&lt;=</span> <span class="hljs-variable">@length</span>)<br><span class="hljs-keyword">BEGIN</span><br>  <span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@tempint</span> <span class="hljs-type">int</span><br>  <span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@firstint</span> <span class="hljs-type">int</span><br>  <span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@secondint</span> <span class="hljs-type">int</span><br>  <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@tempint</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">CONVERT</span>(<span class="hljs-type">int</span>, <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@binvalue</span>,<span class="hljs-variable">@i</span>,<span class="hljs-number">1</span>))<br>  <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@firstint</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">FLOOR</span>(<span class="hljs-variable">@tempint</span><span class="hljs-operator">/</span><span class="hljs-number">16</span>)<br>  <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@secondint</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@tempint</span> <span class="hljs-operator">-</span> (<span class="hljs-variable">@firstint</span><span class="hljs-operator">*</span><span class="hljs-number">16</span>)<br>  <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@charvalue</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@charvalue</span> <span class="hljs-operator">+</span><br>    <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@hexstring</span>, <span class="hljs-variable">@firstint</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>, <span class="hljs-number">1</span>) <span class="hljs-operator">+</span><br>    <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@hexstring</span>, <span class="hljs-variable">@secondint</span><span class="hljs-operator">+</span><span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>  <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@i</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@i</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">END</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@hexvalue</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@charvalue</span><br>GO<br>IF OBJECT_ID (<span class="hljs-string">&#x27;sp_help_revlogin&#x27;</span>) <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>  <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PROCEDURE</span> sp_help_revlogin<br>GO<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> sp_help_revlogin <span class="hljs-variable">@login</span>_name sysname <span class="hljs-operator">=</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">AS</span><br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@name</span> sysname<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@type</span> <span class="hljs-type">varchar</span> (<span class="hljs-number">1</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@hasaccess</span> <span class="hljs-type">int</span><br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@denylogin</span> <span class="hljs-type">int</span><br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@is</span>_disabled <span class="hljs-type">int</span><br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@PWD</span>_varbinary  <span class="hljs-type">varbinary</span> (<span class="hljs-number">256</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@PWD</span>_string  <span class="hljs-type">varchar</span> (<span class="hljs-number">514</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@SID</span>_varbinary <span class="hljs-type">varbinary</span> (<span class="hljs-number">85</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@SID</span>_string <span class="hljs-type">varchar</span> (<span class="hljs-number">514</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@tmpstr</span>  <span class="hljs-type">varchar</span> (<span class="hljs-number">1024</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@is</span>_policy_checked <span class="hljs-type">varchar</span> (<span class="hljs-number">3</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@is</span>_expiration_checked <span class="hljs-type">varchar</span> (<span class="hljs-number">3</span>)<br><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@defaultdb</span> sysname<br>IF (<span class="hljs-variable">@login</span>_name <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>)<br>  <span class="hljs-keyword">DECLARE</span> login_curs <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span><br>      <span class="hljs-keyword">SELECT</span> p.sid, p.name, p.type, p.is_disabled, p.default_database_name, l.hasaccess, l.denylogin <span class="hljs-keyword">FROM</span> <br>sys.server_principals p <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> sys.syslogins l<br>      <span class="hljs-keyword">ON</span> ( l.name <span class="hljs-operator">=</span> p.name ) <span class="hljs-keyword">WHERE</span> p.type <span class="hljs-keyword">IN</span> ( <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span> ) <span class="hljs-keyword">AND</span> p.name <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">&#x27;sa&#x27;</span><br><span class="hljs-keyword">ELSE</span><br>  <span class="hljs-keyword">DECLARE</span> login_curs <span class="hljs-keyword">CURSOR</span> <span class="hljs-keyword">FOR</span><br><br>      <span class="hljs-keyword">SELECT</span> p.sid, p.name, p.type, p.is_disabled, p.default_database_name, l.hasaccess, l.denylogin <span class="hljs-keyword">FROM</span> <br>sys.server_principals p <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> sys.syslogins l<br>      <span class="hljs-keyword">ON</span> ( l.name <span class="hljs-operator">=</span> p.name ) <span class="hljs-keyword">WHERE</span> p.type <span class="hljs-keyword">IN</span> ( <span class="hljs-string">&#x27;S&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span> ) <span class="hljs-keyword">AND</span> p.name <span class="hljs-operator">=</span> <span class="hljs-variable">@login</span>_name<br><span class="hljs-keyword">OPEN</span> login_curs<br><span class="hljs-keyword">FETCH</span> NEXT <span class="hljs-keyword">FROM</span> login_curs <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@SID</span>_varbinary, <span class="hljs-variable">@name</span>, <span class="hljs-variable">@type</span>, <span class="hljs-variable">@is</span>_disabled, <span class="hljs-variable">@defaultdb</span>, <span class="hljs-variable">@hasaccess</span>, <span class="hljs-variable">@denylogin</span><br>IF (@<span class="hljs-variable">@fetch</span>_status <span class="hljs-operator">=</span> <span class="hljs-number">-1</span>)<br><span class="hljs-keyword">BEGIN</span><br>  PRINT <span class="hljs-string">&#x27;No login(s) found.&#x27;</span><br>  <span class="hljs-keyword">CLOSE</span> login_curs<br>  <span class="hljs-keyword">DEALLOCATE</span> login_curs<br>  <span class="hljs-keyword">RETURN</span> <span class="hljs-number">-1</span><br><span class="hljs-keyword">END</span><br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;/* sp_help_revlogin script &#x27;</span><br>PRINT <span class="hljs-variable">@tmpstr</span><br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;** Generated &#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-keyword">CONVERT</span> (<span class="hljs-type">varchar</span>, GETDATE()) <span class="hljs-operator">+</span> <span class="hljs-string">&#x27; on &#x27;</span> <span class="hljs-operator">+</span> @<span class="hljs-variable">@SERVERNAME</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27; */&#x27;</span><br>PRINT <span class="hljs-variable">@tmpstr</span><br>PRINT <span class="hljs-string">&#x27;&#x27;</span><br>WHILE (@<span class="hljs-variable">@fetch</span>_status <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">-1</span>)<br><span class="hljs-keyword">BEGIN</span><br>  IF (@<span class="hljs-variable">@fetch</span>_status <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">-2</span>)<br>  <span class="hljs-keyword">BEGIN</span><br>    PRINT <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;-- Login: &#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@name</span><br>    PRINT <span class="hljs-variable">@tmpstr</span><br>    IF (<span class="hljs-variable">@type</span> <span class="hljs-keyword">IN</span> ( <span class="hljs-string">&#x27;G&#x27;</span>, <span class="hljs-string">&#x27;U&#x27;</span>))<br>    <span class="hljs-keyword">BEGIN</span> <span class="hljs-comment">-- NT authenticated account/group</span><br>      <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CREATE LOGIN &#x27;</span> <span class="hljs-operator">+</span> QUOTENAME( <span class="hljs-variable">@name</span> ) <span class="hljs-operator">+</span> <span class="hljs-string">&#x27; FROM WINDOWS WITH DEFAULT_DATABASE = [&#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@defaultdb</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;]&#x27;</span><br>    <span class="hljs-keyword">END</span><br>    <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">BEGIN</span> <span class="hljs-comment">-- SQL Server authentication</span><br>        <span class="hljs-comment">-- obtain password and sid</span><br>            <span class="hljs-keyword">SET</span> <span class="hljs-variable">@PWD</span>_varbinary <span class="hljs-operator">=</span> <span class="hljs-built_in">CAST</span>( LOGINPROPERTY( <span class="hljs-variable">@name</span>, <span class="hljs-string">&#x27;PasswordHash&#x27;</span> ) <span class="hljs-keyword">AS</span> <span class="hljs-type">varbinary</span> (<span class="hljs-number">256</span>) )<br>        <span class="hljs-keyword">EXEC</span> sp_hexadecimal <span class="hljs-variable">@PWD</span>_varbinary, <span class="hljs-variable">@PWD</span>_string <span class="hljs-keyword">OUT</span><br>        <span class="hljs-keyword">EXEC</span> sp_hexadecimal <span class="hljs-variable">@SID</span>_varbinary,<span class="hljs-variable">@SID</span>_string <span class="hljs-keyword">OUT</span><br>        <span class="hljs-comment">-- obtain password policy state</span><br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@is</span>_policy_checked <span class="hljs-operator">=</span> <span class="hljs-keyword">CASE</span> is_policy_checked <span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;ON&#x27;</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;OFF&#x27;</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">FROM</span> sys.sql_logins <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-variable">@name</span><br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@is</span>_expiration_checked <span class="hljs-operator">=</span> <span class="hljs-keyword">CASE</span> is_expiration_checked <span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;ON&#x27;</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;OFF&#x27;</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">FROM</span> sys.sql_logins <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-variable">@name</span><br>            <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;CREATE LOGIN &#x27;</span> <span class="hljs-operator">+</span> QUOTENAME( <span class="hljs-variable">@name</span> ) <span class="hljs-operator">+</span> <span class="hljs-string">&#x27; WITH PASSWORD = &#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@PWD</span>_string <span class="hljs-operator">+</span> <span class="hljs-string">&#x27; HASHED, SID = &#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@SID</span>_string <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;, DEFAULT_DATABASE = [&#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@defaultdb</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;]&#x27;</span><br>        IF ( <span class="hljs-variable">@is</span>_policy_checked <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> )<br>        <span class="hljs-keyword">BEGIN</span><br>          <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;, CHECK_POLICY = &#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@is</span>_policy_checked<br>        <span class="hljs-keyword">END</span><br>        IF ( <span class="hljs-variable">@is</span>_expiration_checked <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> )<br>        <span class="hljs-keyword">BEGIN</span><br>          <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;, CHECK_EXPIRATION = &#x27;</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@is</span>_expiration_checked<br>        <span class="hljs-keyword">END</span><br>    <span class="hljs-keyword">END</span><br>    IF (<span class="hljs-variable">@denylogin</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">BEGIN</span> <span class="hljs-comment">-- login is denied access</span><br>      <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;; DENY CONNECT SQL TO &#x27;</span> <span class="hljs-operator">+</span> QUOTENAME( <span class="hljs-variable">@name</span> )<br>    <span class="hljs-keyword">END</span><br>    <span class="hljs-keyword">ELSE</span> IF (<span class="hljs-variable">@hasaccess</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">BEGIN</span> <span class="hljs-comment">-- login exists but does not have access</span><br>      <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;; REVOKE CONNECT SQL TO &#x27;</span> <span class="hljs-operator">+</span> QUOTENAME( <span class="hljs-variable">@name</span> )<br>    <span class="hljs-keyword">END</span><br>    IF (<span class="hljs-variable">@is</span>_disabled <span class="hljs-operator">=</span> <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">BEGIN</span> <span class="hljs-comment">-- login is disabled</span><br>      <span class="hljs-keyword">SET</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@tmpstr</span> <span class="hljs-operator">+</span> <span class="hljs-string">&#x27;; ALTER LOGIN &#x27;</span> <span class="hljs-operator">+</span> QUOTENAME( <span class="hljs-variable">@name</span> ) <span class="hljs-operator">+</span> <span class="hljs-string">&#x27; DISABLE&#x27;</span><br>    <span class="hljs-keyword">END</span><br>    PRINT <span class="hljs-variable">@tmpstr</span><br>  <span class="hljs-keyword">END</span><br>  <span class="hljs-keyword">FETCH</span> NEXT <span class="hljs-keyword">FROM</span> login_curs <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@SID</span>_varbinary, <span class="hljs-variable">@name</span>, <span class="hljs-variable">@type</span>, <span class="hljs-variable">@is</span>_disabled, <span class="hljs-variable">@defaultdb</span>, <span class="hljs-variable">@hasaccess</span>, <span class="hljs-variable">@denylogin</span><br>   <span class="hljs-keyword">END</span><br><span class="hljs-keyword">CLOSE</span> login_curs<br><span class="hljs-keyword">DEALLOCATE</span> login_curs<br><span class="hljs-keyword">RETURN</span> <span class="hljs-number">0</span><br>GO<br></code></pre></td></tr></table></figure>

<p>存储过程创建完成后执行</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">EXEC</span> sp_help_revlogin<br></code></pre></td></tr></table></figure>

<p>自动生成登录名权限脚本。</p>
]]></content>
      <categories>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Setting Shared Disks for Oracle RAC</title>
    <url>/blog/posts/47372.html</url>
    <content><![CDATA[<h1 id="Setting-Shared-Disks-for-Oracle-RAC"><a href="#Setting-Shared-Disks-for-Oracle-RAC" class="headerlink" title="Setting Shared Disks for Oracle RAC"></a>Setting Shared Disks for Oracle RAC</h1><ol>
<li>Create Disks</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">vmkfstools -c 1G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk<br>vmkfstools -c 1G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk<br>vmkfstools -c 1G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk<br>vmkfstools -c 30G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-MGMT01-30GB.vmdk<br>vmkfstools -c 10G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-ARCH01-10GB.vmdk<br>vmkfstools -c 20G -d eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-DATA01-20GB.vmdk<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>Adding a storage controller to Oracle RAC VMs</li>
</ol>
<p>Leave the Bus Sharing mode as <strong>None</strong>, and choose the desired type (LSI Parallel or LSI SAS or <strong>Paravirtual</strong>).</p>
<div class="note info simple"><p>Note: The Paravirtual controller type is generally recommended for RAC shared disks.</p>
</div>

<p><img src="https://s2.loli.net/2023/04/17/AspxLyVKXjZnHbQ.png"></p>
<ol start="3">
<li>Adding shared disks to Oracle RAC VMs</li>
</ol>
<p>Select <strong>Thick provision eager zeroed</strong> option in the Disk Provisioning dropdown menu.<br>In the Sharing dropdown menu, select the <strong>Multi-writer</strong> option.<br>Change the Disk Mode to <strong>Independent-Persistent</strong>.</p>
<div class="note info simple"><p>Note: While Independent-Persistent disk mode is not a hard requirement to enable Multi-writer option, the default Dependent disk mode would cause the cannot snapshot shared disk error when a virtual machine snapshot is taken. Use of Independent-Persistent disk mode would allow taking a snapshot of the OS disk while the shared disk would need to be backed up separately by a third-party vendor software.</p>
</div>

<p><img src="https://s2.loli.net/2023/04/17/khMxL3giPZR87Ob.png"></p>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>share</tag>
      </tags>
  </entry>
  <entry>
    <title>Architecture</title>
    <url>/blog/posts/61360.html</url>
    <content><![CDATA[<h4 id="Physical-Architecture"><a href="#Physical-Architecture" class="headerlink" title="Physical Architecture"></a>Physical Architecture</h4><p><img src="https://s2.loli.net/2022/04/26/nLNcJ5qkIbFCDWU.png"></p>
<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p>1区 -&gt; 2区 -&gt; 3区<br>1区 -&gt; 3区</p>
<h4 id="PGA"><a href="#PGA" class="headerlink" title="PGA"></a>PGA</h4><ol>
<li>保存用户的连接信息，如会话属性、绑定变量、用户权限等重要信息。</li>
<li>硬解析首次执行的SQL指令，生成唯一指令HASH值。</li>
<li>当发起的SQL指令需要排序时，如果内存空间充足，则在PGA中完成，如果不足，超出部分在临时表空间完成排序。</li>
</ol>
<h4 id="SGA"><a href="#SGA" class="headerlink" title="SGA"></a>SGA</h4><ol>
<li><strong>Shared Pool - Library Cache</strong> 保存硬解析生成唯一SQL指令HASH值，保留了语法语意检查及执行计划等解析动作的劳动成功，下次执行该SQL指令时，直接拿来主义。</li>
<li>如果SQL指令需要的数据不在 <strong>Database Buffer Cache</strong>，则从硬盘中获取数据到数据缓存区。</li>
<li><strong>Redo Log Buffer</strong> 保存数据库相关操作日志。</li>
</ol>
<h4 id="Background-Processes"><a href="#Background-Processes" class="headerlink" title="Background Processes"></a>Background Processes</h4><p><strong>DBWR</strong>: 将数据缓存区的数据批量写入（提高数据库写性能）磁盘数据文件中，需等待LGWR先完成。<br><strong>CKPT</strong>: Check Point，由Oracle的FAST_SMART_MTTR_TARGET参数控制，用于触发DBWR将数据缓存区的数据中写入磁盘。<br><strong>LGWR</strong>: 将日志缓存区的数据写入磁盘的联机日志文件，记录所有从数据缓存区写入磁盘数据文件的动作。为了顺序记录日志，因此LGWR采用单线程。</p>
<ul>
<li>每隔3秒，LGWR运行一次</li>
<li>任何COMMIT，触发LGWR运行一次</li>
<li>DBWR要把数据从数据缓存区写入磁盘，触发LGWR运行一次</li>
<li>日志缓存区满三分之一或记满1MB，触发LGWR运行一次</li>
<li>联机日志文件切换，触发LGWR运行一次<br><strong>PMON</strong>: Processes Monitor，进程监视器。在执行某些更新语句，未提交时进程崩溃了，这时候PMON会自动回滚该操作。除此之外还可以干预后台进程，比如RECO一次失败，会重启RECO进程，遇到LGWR进程失败，会中止实例，用于防止数据错乱。<br><strong>SMON</strong>: System Mointor，系统监视器。重点工作在于Instance Recovery，还有清理临时表空间、清理回滚段表空间、合并空闲空间等。<br><strong>LCKn</strong>: 仅使用于RAC数据库，最多可有10个进程（LCK0 - LCK9），用于实例间的封锁。<br><strong>RECO</strong>: Distributed Database Recovery，用于分布式数据库的恢复。<br><strong>ARCH</strong>: 在LGWR写联机日志写到需要覆盖重写时，触发ARCH进程复制联机日志，生成归档日志文件。</li>
</ul>
<h4 id="Undo-Segment"><a href="#Undo-Segment" class="headerlink" title="Undo Segment"></a>Undo Segment</h4><figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">parameter</span> undo<br>NAME                                 TYPE        <span class="hljs-keyword">VALUE</span><br><span class="hljs-comment">------------------------------------ ----------- ------------------------------</span><br>undo_management                      string      AUTO<br>undo_retention                       <span class="hljs-type">integer</span>     <span class="hljs-number">900</span><br>undo_tablespace                      string      UNDOTBS1<br></code></pre></td></tr></table></figure>

<p>UNDO_MANAGEMENT&#x3D;AUTO，表示自动回滚段管理，空间不足时自动扩展；<br>UNDO_RETENTION&#x3D;900，表示回滚段需要900秒后才能覆盖标记为重新使用的空间。</p>
<h4 id="Logical-Architecture"><a href="#Logical-Architecture" class="headerlink" title="Logical Architecture"></a>Logical Architecture</h4><p><img src="https://s2.loli.net/2022/04/27/MRSTPdmfuiKwhsF.png"></p>
<p>数据库组成：<strong>DATABASE &lt;- Tablespace &lt;- Segment &lt;- Extent &lt;- Block</strong><br>Extent 是数据库分配空间的最小单位<br>Block 是数据库的最小逻辑单位</p>
<h4 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h4><p><img src="https://s2.loli.net/2022/04/27/Wjvg9KdH7zL8bU2.png"></p>
<p>数据库组成：</p>
<blockquote>
<ol>
<li>数据块头(Common and Variable Header) 包含了数据块的概要信息，例如块地址及此数据块所属的段的类型</li>
<li>表目录(Table Directory) 存储行数据所在的表的信息</li>
<li>行目录(Row Directory) 存储插入的行的地址</li>
<li>可用空间区(Free Space) 块中的空余空间，由PCTFREE参数设置。如果是表或索引块，该区域还会存储事务条目，大概有23字节开销</li>
<li>行数据区(Row Data) 存储具体的行的信息或者索引的信息，这部分占用了数据块绝大部分的空间<br>数据块头、表目录、行目录为管理开销，平均在84-107字节之间。</li>
</ol>
</blockquote>
<h4 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h4><p>全局临时表：一种是基于会话的全局临时表（commit preserve rows），一种是基于事务的全局临时表（commit delete rows）。</p>
]]></content>
      <categories>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Docker on Fedora</title>
    <url>/blog/posts/6946.html</url>
    <content><![CDATA[<h1 id="Install-Docker-on-Fedora"><a href="#Install-Docker-on-Fedora" class="headerlink" title="Install Docker on Fedora"></a>Install Docker on Fedora</h1><h2 id="Uninstall-old-versions"><a href="#Uninstall-old-versions" class="headerlink" title="Uninstall old versions"></a>Uninstall old versions</h2><p>Older versions of Docker were called <code>docker</code> or <code>docker-engine</code>. If these are installed, uninstall them, along with associated dependencies.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo dnf remove docker \<br>                  docker-client \<br>                  docker-client-latest \<br>                  docker-common \<br>                  docker-latest \<br>                  docker-latest-logrotate \<br>                  docker-logrotate \<br>                  docker-selinux \<br>                  docker-engine-selinux \<br>                  docker-engine<br></code></pre></td></tr></table></figure>

<h2 id="Set-up-the-repository"><a href="#Set-up-the-repository" class="headerlink" title="Set up the repository"></a>Set up the repository</h2><p>Install the <code>dnf-plugins-core</code> package (which provides the commands to manage your DNF repositories) and set up the repository.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo dnf -y install dnf-plugins-core<br><br>$ sudo dnf config-manager \<br>    --add-repo \<br>    https://download.docker.com/linux/fedora/docker-ce.repo<br></code></pre></td></tr></table></figure>

<h2 id="Install-Docker-Engine"><a href="#Install-Docker-Engine" class="headerlink" title="Install Docker Engine"></a>Install Docker Engine</h2><ol>
<li><p>Install the <em>latest version</em> of Docker Engine, containerd, and Docker Compose or go to the next step to install a specific version:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo dnf install docker-ce docker-ce-cli containerd.io docker-compose-plugin<br></code></pre></td></tr></table></figure>

<p>If prompted to accept the GPG key, verify that the fingerprint matches <code>060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35</code>, and if so, accept it.</p>
<p>This command installs Docker, but it doesn’t start Docker. It also creates a <code>docker</code> group, however, it doesn’t add any users to the group by default.</p>
</li>
<li><p>To install a <em>specific version</em> of Docker Engine, list the available versions in the repo, then select and install:</p>
<p>a. List and sort the versions available in your repo. This example sorts results by version number, highest to lowest, and is truncated:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ dnf list docker-ce  --showduplicates | <span class="hljs-built_in">sort</span> -r<br><br>docker-ce.x86_64  3:18.09.1-3.fc28                 docker-ce-stabledocker-ce.x86_64  3:18.09.0-3.fc28                 docker-ce-stabledocker-ce.x86_64  18.06.1.ce-3.fc28                docker-ce-stabledocker-ce.x86_64  18.06.0.ce-3.fc28                docker-ce-stable<br></code></pre></td></tr></table></figure>

<p>The list returned depends on which repositories are enabled, and is specific to your version of Fedora (indicated by the <code>.fc28</code> suffix in this example).</p>
<p>b. Install a specific version by its fully qualified package name, which is the package name (<code>docker-ce</code>) plus the version string (2nd column) up to the first hyphen, separated by a hyphen (<code>-</code>), for example, <code>docker-ce-3:18.09.1</code>.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo dnf -y install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-compose-plugin<br></code></pre></td></tr></table></figure>

<p>This command installs Docker, but it doesn’t start Docker. It also creates a <code>docker</code> group, however, it doesn’t add any users to the group by default.</p>
</li>
<li><p>Start Docker.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo systemctl start docker<br></code></pre></td></tr></table></figure>
</li>
<li><p>Verify that Docker Engine is installed correctly by running the <code>hello-world</code> image.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo docker run hello-world<br></code></pre></td></tr></table></figure>

<p>This command downloads a test image and runs it in a container. When the container runs, it prints a message and exits.</p>
</li>
</ol>
<p>This installs and runs Docker Engine. Use <code>sudo</code> to run Docker commands. Continue to <a href="https://docs.docker.com/engine/install/linux-postinstall/">Linux postinstall</a> to allow non-privileged users to run Docker commands and for other optional configuration steps.</p>
<h2 id="Uninstall-Docker-Engine"><a href="#Uninstall-Docker-Engine" class="headerlink" title="Uninstall Docker Engine"></a>Uninstall Docker Engine</h2><ol>
<li><p>Uninstall the Docker Engine, CLI, Containerd, and Docker Compose packages:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo dnf remove docker-ce docker-ce-cli containerd.io docker-compose-plugin<br></code></pre></td></tr></table></figure>
</li>
<li><p>Images, containers, volumes, or customized configuration files on your host are not automatically removed. To delete all images, containers, and volumes:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ sudo <span class="hljs-built_in">rm</span> -rf /var/lib/docker<br>$ sudo <span class="hljs-built_in">rm</span> -rf /var/lib/containerd<br></code></pre></td></tr></table></figure></li>
</ol>
<p>You must delete any edited configuration files manually.</p>
]]></content>
      <categories>
        <category>Docker</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating a Yum Repository</title>
    <url>/blog/posts/47209.html</url>
    <content><![CDATA[<h1 id="Creating-a-Yum-Repository"><a href="#Creating-a-Yum-Repository" class="headerlink" title="Creating a Yum Repository"></a>Creating a Yum Repository</h1><p>To set up a yum repository:</p>
<ol>
<li><p>Install the createrepo package:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">yum install createrepo<br></code></pre></td></tr></table></figure>
</li>
<li><p>Copy all packages for your new repository into one directory, such as &#x2F;tmp&#x2F;local_repo&#x2F;:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /your/packages/*.rpm /tmp/local_repo/<br></code></pre></td></tr></table></figure>
</li>
<li><p>To create the repository run:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">createrepo /tmp/local_repo/<br></code></pre></td></tr></table></figure>

<p>This creates the necessary metadata for the yum repository and places metadata in a newly created subdirectory repodata.</p>
</li>
</ol>
<p>The repository is now ready to be consumed by yum. This repository can be shared over the HTTP or FTP protocol, or refered directly from the local machine.</p>
<hr>
<p><font color=notice>NOTE: When constructing the URL for a repository, refer to the &#x2F;mnt&#x2F;local_repo not to &#x2F;mnt&#x2F;local_repo&#x2F;repodata, as this directory contains only metadata. Actual yum packages are in &#x2F;mnt&#x2F;local_repo.</font></p>
<hr>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>yum</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating a second instance of the sshd service</title>
    <url>/blog/posts/41331.html</url>
    <content><![CDATA[<h1 id="Creating-a-second-instance-of-the-sshd-service"><a href="#Creating-a-second-instance-of-the-sshd-service" class="headerlink" title="Creating a second instance of the sshd service"></a>Creating a second instance of the sshd service</h1><p>System Administrators often need to configure and run multiple instances of a service. This is done by creating copies of the original service configuration files and modifying certain parameters to avoid conflicts with the primary instance of the service. The following procedure shows how to create a second instance of the sshd service:</p>
<ol>
<li><p>Create a copy of the sshd_config file that will be used by the second daemon:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># cp /etc/ssh/sshd&#123;,-second&#125;_config</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Edit the sshd-second_config file created in the previous step to assign a different port number and PID file to the second daemon:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">Port 22220<br>PidFile /var/run/sshd-second.pid<br></code></pre></td></tr></table></figure>

<p> See the sshd_config(5) manual page for more information on Port and PidFile options. Make sure the port you choose is not in use by any other service. The PID file does not have to exist before running the service, it is generated automatically on service start.</p>
</li>
<li><p>Create a copy of the systemd unit file for the sshd service:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># cp /usr/lib/systemd/system/sshd.service /etc/systemd/system/sshd-second.service</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Alter the sshd-second.service created in the previous step as follows:<br> a. Modify the Description option:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">Description=OpenSSH server second instance daemon<br></code></pre></td></tr></table></figure>

<p> b. Add sshd.service to services specified in the After option, so that the second instance starts only after the first one has already started:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">After=syslog.target network.target auditd.service sshd.service<br></code></pre></td></tr></table></figure>

<p> c. The first instance of sshd includes key generation, therefore remove the <code>ExecStartPre=/usr/sbin/sshd-keygen</code> line.</p>
<p> d. Add the -f &#x2F;etc&#x2F;ssh&#x2F;sshd-second_config parameter to the sshd command, so that the alternative configuration file is used:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">ExecStart=/usr/sbin/sshd -D -f /etc/ssh/sshd-second_config <span class="hljs-variable">$OPTIONS</span><br></code></pre></td></tr></table></figure>

<p> e. After the above modifications, the sshd-second.service should look as follows:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[Unit]<br>Description=OpenSSH server second instance daemon<br>After=syslog.target network.target auditd.service sshd.service<br>[Service]<br>EnvironmentFile=/etc/sysconfig/sshd<br>ExecStart=/usr/sbin/sshd -D -f /etc/ssh/sshd-second_config <span class="hljs-variable">$OPTIONS</span><br>ExecReload=/bin/kill -HUP <span class="hljs-variable">$MAINPID</span><br>KillMode=process<br>Restart=on-failure<br>RestartSec=42s<br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>
</li>
<li><p>If using SELinux, add the port for the second instance of sshd to SSH ports, otherwise the second instance of sshd will be rejected to bind to the port:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># semanage port -a -t ssh_port_t -p tcp 22220</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Enable sshd-second.service, so that it starts automatically upon boot:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># systemctl enable sshd-second.service</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Verify if the sshd-second.service is running by using the systemctl status command. Also, verify if the port is enabled correctly by connecting to the service:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]$ ssh -p 22220 user@server<br></code></pre></td></tr></table></figure>
</li>
<li><p>If the firewall is in use, make sure that it is configured appropriately in order to allow connections to the second instance of sshd.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># firewall-cmd --add-port=22220/tcp</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>sshd</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating Custom Unit Files</title>
    <url>/blog/posts/25014.html</url>
    <content><![CDATA[<h1 id="Creating-Custom-Unit-Files"><a href="#Creating-Custom-Unit-Files" class="headerlink" title="Creating Custom Unit Files"></a>Creating Custom Unit Files</h1><ol>
<li><p>Prepare the executable file with the custom service. This can be a custom-created script, or an executable delivered by a software provider. If required, prepare a PID file to hold a constant PID for the main process of the custom service. It is also possible to include environment files to store shell variables for the service. Make sure the source script is executable (by executing the <strong>chmod a+x</strong>) and is not interactive.</p>
</li>
<li><p>Create a unit file in the &#x2F;etc&#x2F;systemd&#x2F;system&#x2F; directory and make sure it has correct file permissions. Execute as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> /etc/systemd/system/name.service<br><span class="hljs-built_in">chmod</span> 664 /etc/systemd/system/name.service<br></code></pre></td></tr></table></figure>

<p>Replace name with a name of the service to be created. Note that file does not need to be executable.</p>
</li>
<li><p>Open the name.service file created in the previous step, and add the service configuration options. There is a variety of options that can be used depending on the type of service you wish to create, The following is an example unit configuration for a network-related service:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[Unit]<br>Description=service_description<br>After=network.target<br>[Service]<br>ExecStart=path_to_executable<br>Type=forking<br>PIDFile=path_to_pidfile<br>[Install]<br>WantedBy=default.target<br></code></pre></td></tr></table></figure>

<p>Where:</p>
<ul>
<li><em>service_description</em> is an informative description that is displayed in journal log files and in the output of the <strong>systemctl status</strong> command.</li>
<li>the <strong>After</strong> setting ensures that the service is started only after the network is running. Add a space-separated list of other relevant services or targets.</li>
<li><em>path_to_executable</em> stands for the path to the actual service executable.</li>
<li><strong>WantedBy</strong> states the target or targets that the service should be started under. Think of these targets as of a replacement of the older concept of runlevels.</li>
<li><strong>Type&#x3D;forking</strong> is used for daemons that make the fork system call. The main process of the service is created with - the PID specified in path_to_pidfile.</li>
</ul>
</li>
<li><p>Notify systemd that a new name.service file exists by executing the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">systemctl daemon-reload<br>systemctl start name.service<br></code></pre></td></tr></table></figure></li>
</ol>
<p>:::warning<br>Always run the systemctl daemon-reload command after creating new unit files or modifying existing unit files. Otherwise, the systemctl start or systemctl enable commands could fail due to a mismatch between states<br>of systemd and actual service unit files on disk.</font><br>:::</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>Found Duplicate PV</title>
    <url>/blog/posts/15808.html</url>
    <content><![CDATA[<p>存储LUN做LVM时，出现如下报错：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[root@localhost ~]# pvs<br>Found duplicate PV gdJ3qQtqoOjwZs2dtFw9vP0zIpz0HQhj: using /dev/sdba not /dev/emcpowerai<br>Found duplicate PV 8jLc3hNNwiSnGz4fEEasw8PQwthrGBpO: using /dev/sdbq not /dev/emcpowers<br>Found duplicate PV BY29XsIxW1I4LUOcoqAepnG7eGUcPxZl: using /dev/emcpoweru not /dev/sdbo<br></code></pre></td></tr></table></figure>

<p>在默认配置下，LVM对所有磁盘进行扫描，以确定哪一块上面包含PV。如果使用了 device-mapper-multipath 或其他多路径软件如 EMC PowerPath 或 Hitachi Dynamic Link Manager (HDLM)，那么对于每一个LUN的每一条路径就注册成为一个不同的SCSI设备。如&#x2F;dev&#x2F;sdb，&#x2F;dev&#x2F;sdc，等等。多路径软件之后会创建一个新的设备映射到这些路径如：&#x2F;dev&#x2F;mapper&#x2F;mpath1 (device-mapper-multipath)，&#x2F;dev&#x2F;emcpowerb (EMC PowerPath)，或 &#x2F;dev&#x2F;sddlmab (HDLM)。由于每一个设备都指向同一个LUN，所以它们都包含相同的LVM元数据，因此在扫描时显示为duplicate。运行任何LVM命令，都会出现重复PV告警。<br>所以要确保LVM只扫描想要的多路径设备而不是单条路径，需要在<code>/etc/lvm/lvm.conf</code>文件中加上过滤条件，格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">Example</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Accept every block device:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">filter = [ <span class="hljs-string">&quot;a|.*|&quot;</span> ]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Reject the cdrom drive:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">filter = [ <span class="hljs-string">&quot;r|/dev/cdrom|&quot;</span> ]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Work with just loopback devices, e.g. <span class="hljs-keyword">for</span> testing:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">filter = [ <span class="hljs-string">&quot;a|loop|&quot;</span>, <span class="hljs-string">&quot;r|.*|&quot;</span> ]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Accept all loop devices and ide drives except hdc:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">filter = [ <span class="hljs-string">&quot;a|loop|&quot;</span>, <span class="hljs-string">&quot;r|/dev/hdc|&quot;</span>, <span class="hljs-string">&quot;a|/dev/ide|&quot;</span>, <span class="hljs-string">&quot;r|.*|&quot;</span> ]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Use anchors to be very specific:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">filter = [ <span class="hljs-string">&quot;a|^/dev/hda8$|&quot;</span>, <span class="hljs-string">&quot;r|.*|&quot;</span> ]</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># This configuration option has an automatic default value.</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">filter = [ <span class="hljs-string">&quot;a|.*|&quot;</span> ]</span><br></code></pre></td></tr></table></figure>

<p>过滤语法接收多重条件。形式如 “a” (add) or “r” (remove)，中间以逗号为间隔。所有符合add条件的设备都会被扫描，同时忽略所有符合remove条件的设备。<br>注意：如果本地存储设备包含物理卷，确保除了多路径设备外，这些设备也包含在过滤条件中。<br>比如，只扫描device-mapper-multipath设备：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">filter = [ &quot;a|/dev/mapper/mpath.*|&quot;, &quot;r|.*|&quot; ]<br></code></pre></td></tr></table></figure>

<p>只扫描 EMC PowerPath 设备:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">filter = [ &quot;a|/dev/emcpower.*|&quot;, &quot;r|.*|&quot; ]<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>lvm</tag>
      </tags>
  </entry>
  <entry>
    <title>Scan Disk Online</title>
    <url>/blog/posts/11883.html</url>
    <content><![CDATA[<h2 id="在线扫描新添加的硬盘："><a href="#在线扫描新添加的硬盘：" class="headerlink" title="在线扫描新添加的硬盘："></a>在线扫描新添加的硬盘：</h2><p>添加一块SCSI类型的硬盘，执行下面命令扫描磁盘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> /sys/class/scsi_host/`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;- - -&quot;</span> &gt; /sys/class/scsi_host/<span class="hljs-variable">$&#123;i&#125;</span>/scan; <span class="hljs-keyword">done</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> /sys/class/scsi_device/`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> 1 &gt; /sys/class/scsi_device/<span class="hljs-variable">$i</span>/device/rescan; <span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># /usr/bin/scsi-rescan -s</span><br></code></pre></td></tr></table></figure>

<h2 id="EMC-PowerPath-环境中增加LUN："><a href="#EMC-PowerPath-环境中增加LUN：" class="headerlink" title="EMC PowerPath 环境中增加LUN："></a>EMC PowerPath 环境中增加LUN：</h2><ol>
<li><p>确保存储端已配置好LUN并映射给Linux主机，通过 powermt 命令获得HBA卡列表，并扫描列表中所有的HBA卡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> host <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> /sys/class/scsi_host/`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;- - -&quot;</span> &gt; /sys/class/scsi_host/<span class="hljs-variable">$&#123;host&#125;</span>/scan; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>运行 <code>powermt config</code> 配置新认到的磁盘，生成虚拟设备</p>
</li>
<li><p>运行 <code>powermt display</code> 检查新识别到的LUN及设备路径</p>
</li>
<li><p>运行 <code>powermt save</code> 保存</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>disk</tag>
      </tags>
  </entry>
  <entry>
    <title>Changing and Resetting the Root Password</title>
    <url>/blog/posts/50964.html</url>
    <content><![CDATA[<h1 id="Changing-and-Resetting-the-Root-Password"><a href="#Changing-and-Resetting-the-Root-Password" class="headerlink" title="Changing and Resetting the Root Password"></a>Changing and Resetting the Root Password</h1><p>Setting up the root password is a mandatory part of the Red Hat Enterprise Linux 7 installation. If you forget or lose the root password it is possible to reset it, however users who are members of the wheel group can change the root password as follows:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]$ </span><span class="language-bash">sudo passwd root</span><br></code></pre></td></tr></table></figure>

<p>Note that in GRUB 2, resetting the password is no longer performed in single-user mode as it was in GRUB included in Red Hat Enterprise Linux 6. The root password is now required to operate in singleuser mode as well as in emergency mode.</p>
<h2 id="1-Resetting-the-Root-Password-Using-an-Installation-Disk"><a href="#1-Resetting-the-Root-Password-Using-an-Installation-Disk" class="headerlink" title="1 Resetting the Root Password Using an Installation Disk"></a>1 Resetting the Root Password Using an Installation Disk</h2><ol>
<li><p>Start the system and when BIOS information is displayed, select the option for a boot menu and<br>select to boot from the installation disk.</p>
</li>
<li><p>Choose <strong>Troubleshooting</strong>.</p>
</li>
<li><p>Choose <strong>Rescue a Red Hat Enterprise Linux System</strong>.</p>
</li>
<li><p>Choose Continue which is the default option. At this point you will be promoted for a passphrase if an encrypted file system is found.</p>
</li>
<li><p>Press <strong>OK</strong> to acknowledge the information displayed until the shell prompt appears.</p>
</li>
<li><p>Change the file system root as follows:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sh-4.2# chroot /mnt/sysimage<br></code></pre></td></tr></table></figure>
</li>
<li><p>Enter the passwd command and follow the instructions displayed on the command line to change the root password.</p>
</li>
<li><p>Remove the autorelable file to prevent a time consuming SELinux relabel of the disk:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sh-4.2# rm -f /.autorelabel<br></code></pre></td></tr></table></figure>
</li>
<li><p>Enter the <strong>exit</strong> command to exit the chroot environment.</p>
</li>
<li><p>Enter the <strong>exit</strong> command again to resume the initialization and finish the system boot.</p>
</li>
</ol>
<h2 id="2-Resetting-the-Root-Password-Using-rd-break"><a href="#2-Resetting-the-Root-Password-Using-rd-break" class="headerlink" title="2 Resetting the Root Password Using rd.break"></a>2 Resetting the Root Password Using rd.break</h2><ol>
<li><p>Start the system and, on the GRUB 2 boot screen, press the <strong>e</strong> key for edit.</p>
</li>
<li><p>Remove the <strong>rhgb</strong> and <strong>quiet</strong> parameters from the end, or near the end, of the linux16 line, or linuxefi on UEFI systems.<br>Press Ctrl+a and Ctrl+e to jump to the start and end of the line, respectively. On some systems, Home and End might also work.</p>
<hr>
<p><font color=important> IMPORTANT: The rhgb and quiet parameters must be removed in order to enable system messages. </font></p>
<hr>
</li>
<li><p>Add the following parameters at the end of the <strong>linux</strong> line on 64-Bit IBM Power Series, the <strong>linux16</strong> line on x86-64 BIOS-based systems, or the <strong>linuxefi</strong> line on UEFI systems:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">rd.break enforcing=0<br></code></pre></td></tr></table></figure>

<p>Adding the <strong>enforcing&#x3D;0</strong> option enables omitting the time consuming SELinux relabeling process.</p>
<p>The initramfs will stop before passing control to the Linux kernel, enabling you to work with the root file system.<br>Note that the initramfs prompt will appear on the last console specified on the Linux line.</p>
</li>
<li><p>Press <strong>Ctrl+x</strong> to boot the system with the changed parameters.<br>With an encrypted file system, a password is required at this point. However the password prompt might not appear as it is obscured by logging messages. You can press the Backspace key to see the prompt. Release the key and enter the password for the encrypted file system, while ignoring the logging messages. The initramfs switch_root prompt appears.</p>
</li>
<li><p>The file system is mounted read-only on &#x2F;sysroot&#x2F;. You will not be allowed to change the password if the file system is not writable.<br>Remount the file system as writable:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">switch_root:/# mount -o remount,rw /sysroot<br></code></pre></td></tr></table></figure>
</li>
<li><p>The file system is remounted with write enabled.<br>Change the file system’s root as follows:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">switch_root:/# chroot /sysroot<br></code></pre></td></tr></table></figure>

<p>The prompt changes to sh-4.2#.</p>
</li>
<li><p>Enter the passwd command and follow the instructions displayed on the command line to change the root password.<br>Note that if the system is not writable, the passwd tool fails with the following error:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Authentication token manipulation error<br></code></pre></td></tr></table></figure>
</li>
<li><p>Updating the password file results in a file with the incorrect SELinux security context. To relabel all files on next system boot, enter the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sh-4.2# touch /.autorelabel<br></code></pre></td></tr></table></figure>

<p>Alternatively, to save the time it takes to relabel a large disk, you can omit this step provided you included the enforcing&#x3D;0 option in step 3.</p>
</li>
<li><p>Remount the file system as read only:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sh-4.2# mount -o remount,ro /<br></code></pre></td></tr></table></figure>
</li>
<li><p>Enter the <strong>exit</strong> command to exit the chroot environment.</p>
</li>
<li><p>Enter the <strong>exit</strong> command again to resume the initialization and finish the system boot.<br>With an encrypted file system, a pass word or phrase is required at this point. However the password prompt might not appear as it is obscured by logging messages. You can press and hold the Backspace key to see the prompt. Release the key and enter the password for the encrypted file system, while ignoring the logging messages.</p>
<hr>
<p><font color=notice>NOTE: The SELinux relabeling process can take a long time. A system reboot<br>will occur automatically when the process is complete.</font></p>
<hr>
</li>
<li><p>If you added the enforcing&#x3D;0 option in step 3 and omitted the touch &#x2F;.autorelabel command in step 8, enter the following command to restore the &#x2F;etc&#x2F;shadow file’s SELinux security context:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">restorecon /etc/shadow</span><br></code></pre></td></tr></table></figure>

<p>Enter the following commands to turn SELinux policy enforcement back on and verify that it is on:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">setenforce 1</span><br><span class="hljs-meta prompt_">~]# </span><span class="language-bash">getenforce</span><br>Enforcing<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Shrinking XFS root partition</title>
    <url>/blog/posts/33655.html</url>
    <content><![CDATA[<ol>
<li><p><strong>Reboot the system in Rescue Mode by booting Installation Media</strong></p>
<p>Select <strong>Rescue a Oracle Linux system</strong>.</p>
<p><img src="https://s2.loli.net/2022/06/01/ma2ZBpIdWszn4ev.png"></p>
<p>Select option <strong>3 - Skip to shell</strong>.</p>
<p><img src="https://s2.loli.net/2022/06/01/YDpByUNX738jhzT.png"></p>
</li>
<li><p><strong>Preparing a backup by xfs_dump</strong></p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@localhost ~]<span class="hljs-comment"># lvs --segments -o +devices</span><br>  LV      VG      Attr       <span class="hljs-comment">#Str Type   SSize  Devices</span><br>  data_lv data_vg -wi-------    1 linear 10.00g /dev/sdb1(0)<br>  log_lv  log_vg  -wi-------    1 linear  4.99g /dev/sdc1(0)<br>  home    rhel    -wi-a-----    1 linear 26.99g /dev/sda2(512)<br>  root    rhel    -wi-a-----    1 linear 50.00g /dev/sda2(7422)<br>  root    rhel    -wi-a-----    1 linear &lt;5.00g /dev/sdd1(0)<br>  swap    rhel    -wi-a-----    1 linear  2.00g /dev/sda2(0)<br><br>[root@localhost ~]<span class="hljs-comment"># vgchange -a y rhel</span><br>  3 logical volume(s) <span class="hljs-keyword">in</span> volume group <span class="hljs-string">&quot;rhel&quot;</span> now active<br><br>[root@localhost ~]<span class="hljs-comment"># mkdir /mnt/root</span><br>[root@localhost ~]<span class="hljs-comment"># mkdir /mnt/home</span><br>[root@localhost ~]<span class="hljs-comment"># mount /dev/rhel/root /mnt/root/</span><br>[root@localhost ~]<span class="hljs-comment"># mount /dev/rhel/home /mnt/home/</span><br><br>[root@localhost ~]<span class="hljs-comment"># xfsdump -f /mnt/home/root.dmp /mnt/root</span><br>xfsdump: using file dump (drive_simple) strategy<br>xfsdump: version 3.1.7 (dump format 3.0) - <span class="hljs-built_in">type</span> ^C <span class="hljs-keyword">for</span> status and control<br><br> ============================= dump label dialog ==============================<br><br>please enter label <span class="hljs-keyword">for</span> this dump session (<span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> 300 sec)<br> -&gt; root<br>session label entered: <span class="hljs-string">&quot;root&quot;</span><br><br> --------------------------------- end dialog ---------------------------------<br><br>xfsdump: level 0 dump of localhost.localdomain:/mnt/root<br>xfsdump: dump <span class="hljs-built_in">date</span>: Wed Mar  9 03:16:07 2022<br>xfsdump: session <span class="hljs-built_in">id</span>: 8075cffa-e01e-4fd9-a177-23a056ce8be8<br>xfsdump: session label: <span class="hljs-string">&quot;root&quot;</span><br>xfsdump: ino map phase 1: constructing initial dump list<br>xfsdump: ino map phase 2: skipping (no pruning necessary)<br>xfsdump: ino map phase 3: skipping (only one dump stream)<br>xfsdump: ino map construction complete<br>xfsdump: estimated dump size: 10083792512 bytes<br>xfsdump: /var/lib/xfsdump/inventory created<br><br> ============================= media label dialog =============================<br><br>please enter label <span class="hljs-keyword">for</span> media <span class="hljs-keyword">in</span> drive 0 (<span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> 300 sec)<br> -&gt; root<br>media label entered: <span class="hljs-string">&quot;root&quot;</span><br><br> --------------------------------- end dialog ---------------------------------<br><br>xfsdump: creating dump session media file 0 (media 0, file 0)<br>xfsdump: dumping ino map<br>xfsdump: dumping directories<br>xfsdump: dumping non-directory files<br>xfsdump: ending media file<br>xfsdump: media file size 9977044328 bytes<br>xfsdump: dump size (non-dir files) : 9919957304 bytes<br>xfsdump: dump complete: 436 seconds elapsed<br>xfsdump: Dump Summary:<br>xfsdump:   stream 0 /mnt/home/root.dmp OK (success)<br>xfsdump: Dump Status: SUCCESS<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><strong>reduce and format root logical volume, restore the root content</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@localhost ~]<span class="hljs-comment"># umount /mnt/root</span><br><br>[root@localhost ~]<span class="hljs-comment"># lvreduce -L -5G /dev/rhel/root</span><br>  WARNING: Reducing active and open logical volume to 50.00 GiB.<br>  THIS MAY DESTROY YOUR DATA (filesystem etc.)<br>Do you really want to reduce rhel/root? [y/n]: y<br>  Size of logical volume rhel/root changed from 55.00 GiB (14080 extents) to 50.00 GiB (12800 extents).<br>  Logical volume rhel/root successfully resized.<br>[root@localhost ~]<span class="hljs-comment"># vgreduce rhel /dev/sdd1</span><br>  Removed <span class="hljs-string">&quot;/dev/sdd1&quot;</span> from volume group <span class="hljs-string">&quot;rhel&quot;</span><br>[root@localhost ~]<span class="hljs-comment"># pvremove /dev/sdd1</span><br>  Labels on physical volume <span class="hljs-string">&quot;/dev/sdd1&quot;</span> successfully wiped.<br><br>[root@localhost ~]<span class="hljs-comment"># mkfs.xfs -L root -f /dev/rhel/root</span><br>meta-data=/dev/rhel/root         isize=512    agcount=4, agsize=3276800 blks<br>         =                       sectsz=512   attr=2, projid32bit=1<br>         =                       crc=1        finobt=0, sparse=0<br>data     =                       bsize=4096   blocks=13107200, imaxpct=25<br>         =                       sunit=0      swidth=0 blks<br>naming   =version 2              bsize=4096   ascii-ci=0 ftype=1<br><span class="hljs-built_in">log</span>      =internal <span class="hljs-built_in">log</span>           bsize=4096   blocks=6400, version=2<br>         =                       sectsz=512   sunit=0 blks, lazy-count=1<br>realtime =none                   extsz=4096   blocks=0, rtextents=0<br><br>[root@localhost ~]<span class="hljs-comment"># mount /dev/rhel/root /mnt/root/</span><br>[root@localhost ~]<span class="hljs-comment"># xfsrestore -f /mnt/home/root.dmp /mnt/root</span><br>xfsrestore: using file dump (drive_simple) strategy<br>xfsrestore: version 3.1.7 (dump format 3.0) - <span class="hljs-built_in">type</span> ^C <span class="hljs-keyword">for</span> status and control<br>xfsrestore: searching media <span class="hljs-keyword">for</span> dump<br>xfsrestore: examining media file 0<br>xfsrestore: dump description:<br>xfsrestore: hostname: localhost.localdomain<br>xfsrestore: mount point: /mnt/root<br>xfsrestore: volume: /dev/mapper/rhel-root<br>xfsrestore: session time: Wed Mar  9 03:16:07 2022<br>xfsrestore: level: 0<br>xfsrestore: session label: <span class="hljs-string">&quot;root&quot;</span><br>xfsrestore: media label: <span class="hljs-string">&quot;root&quot;</span><br>xfsrestore: file system <span class="hljs-built_in">id</span>: 82d461cb-002a-4bd3-9f33-0870656b154a<br>xfsrestore: session <span class="hljs-built_in">id</span>: 8075cffa-e01e-4fd9-a177-23a056ce8be8<br>xfsrestore: media <span class="hljs-built_in">id</span>: 1cf8a3f9-de8d-4125-a3c1-c7305a5b0668<br>xfsrestore: using online session inventory<br>xfsrestore: searching media <span class="hljs-keyword">for</span> directory dump<br>xfsrestore: reading directories<br>xfsrestore: 12396 directories and 94871 entries processed<br>xfsrestore: directory post-processing<br>xfsrestore: restoring non-directory files<br>xfsrestore: restore complete: 316 seconds elapsed<br>xfsrestore: Restore Summary:<br>xfsrestore:   stream 0 /mnt/home/root.dmp OK (success)<br>xfsrestore: Restore Status: SUCCESS<br><br>[root@localhost ~]<span class="hljs-comment"># lsblk -o name,size,mountpoint,uuid</span><br>[root@localhost ~]<span class="hljs-comment"># cat /mnt/root/etc/fstab</span><br><br>[root@localhost ~]<span class="hljs-comment"># umount /mnt/root</span><br>[root@localhost ~]<span class="hljs-comment"># umount /mnt/home</span><br>[root@localhost ~]<span class="hljs-comment"># init 6</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>xfs</tag>
      </tags>
  </entry>
  <entry>
    <title>iSCSI Share 磁盘共享管理</title>
    <url>/blog/posts/9543.html</url>
    <content><![CDATA[<h1 id="iSCSI-Share-磁盘共享管理"><a href="#iSCSI-Share-磁盘共享管理" class="headerlink" title="iSCSI Share 磁盘共享管理"></a>iSCSI Share 磁盘共享管理</h1><h2 id="iSCSI目录介绍"><a href="#iSCSI目录介绍" class="headerlink" title="iSCSI目录介绍"></a>iSCSI目录介绍</h2><ul>
<li><code>/backstores/block</code> 存放本地共享设备的位置</li>
<li><code>/iscsi/&lt;target&gt;/tpg1/luns</code> 存放加入到target的共享资源设备</li>
<li><code>/iscsi/&lt;target&gt;/tpg1/acls</code> 用于存放能够访问共享存储资源的客户端名称</li>
<li><code>/iscsi/&lt;target&gt;/tpg1/portals</code> 用于指定客户端可被访问的监听IP地址及端口</li>
</ul>
<h2 id="iSCSI-服务端配置"><a href="#iSCSI-服务端配置" class="headerlink" title="iSCSI 服务端配置"></a>iSCSI 服务端配置</h2><ol>
<li><p>安装iSCSI，启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">yum -y install targetcli<br>systemctl enable target --now<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建虚拟设备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">dd if=/dev/zero of=/sharedisk/disk-1 bs=1M seek=1024 count=0<br>losetup /dev/loop0 /sharedisk/disk-1<br></code></pre></td></tr></table></figure>
</li>
<li><p>定义后端存储</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">targetcli<br><span class="hljs-meta prompt_">/&gt; </span><span class="language-bash">/backstores/block create lun1 /dev/loop0</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>创建target iqn对象</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">/&gt; </span><span class="language-bash">/iscsi create</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>绑定后端存储</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">/&gt; </span><span class="language-bash">/iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/luns create /backstores/block/lun1</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>设置访问控制</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">/&gt; </span><span class="language-bash">/iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/acls create iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61:xsk</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>绑定服务监听的地址，重启服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">/&gt; </span><span class="language-bash">/iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/portals create</span><br><span class="hljs-meta prompt_">/&gt; </span><span class="language-bash">saveconfig</span><br><br>systemctl restart target<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="iSCSI-客户端配置"><a href="#iSCSI-客户端配置" class="headerlink" title="iSCSI 客户端配置"></a>iSCSI 客户端配置</h2><ol>
<li><p>安装客户端软件，设置开机自启</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">yum install iscsi-initiator-utils<br>systemctl enable iscsid --now<br></code></pre></td></tr></table></figure>
</li>
<li><p>将服务端访问控制表中的共享名称加入到客户端配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt;/etc/iscsi/initiatorname.iscsi &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">InitiatorName=iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61:xsk</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>重启客户端</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">systemctl restart iscsid<br></code></pre></td></tr></table></figure>
</li>
<li><p>扫描iSCSI共享存储设备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">iscsiadm -m discovery -t st -p 192.168.184.129<br></code></pre></td></tr></table></figure>
</li>
<li><p>登录iSCSI共享服务端</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">iscsiadm -m node -T iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61 -p 192.168.184.129 --login<br></code></pre></td></tr></table></figure>
</li>
<li><p>查看已挂载的存储设备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">fdisk -l<br>...<br>Disk /dev/sdb: 5368 MB, 5368709120 bytes, 10485760 sectors<br>Units = sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 126976 bytes<br>Disk label type: dos<br>Disk identifier: 0x401b1c76<br>...<br></code></pre></td></tr></table></figure>
</li>
<li><p>删除共享服务端</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">iscsiadm -m node -T iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61 -u<br><br><span class="hljs-built_in">rm</span> -rf /var/lib/iscsi/nodes/*<br><span class="hljs-built_in">rm</span> -rf /var/lib/iscsi/send_targets/*<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>iscsi</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible 配置文件</title>
    <url>/blog/posts/48659.html</url>
    <content><![CDATA[<p>Ansible按照如下位置和顺序来查找ansible.cfg文件：</p>
<ol>
<li>ANSIBLE_CONFIG环境变量所指定的文件</li>
<li>当前目录下的ansible.cfg文件</li>
<li>Home目录下的的.ansible.cfg文件</li>
<li>&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[defaults]<br>inventory = ./inventory<br>remote_user = normaluser<br>ask_pass = <span class="hljs-literal">false</span><br><br>[privilege_escalation]<br>become = <span class="hljs-literal">true</span><br>become_method = sudo<br>become_user = root<br>become_ask_pass = <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>

<p><strong>ask_pass &#x3D; false</strong> 需要配置ssh免密登录；<br><strong>become_ask_pass &#x3D; false</strong> 需要在sudoers配置免密提权。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>Introduction to grub 2</title>
    <url>/blog/posts/11028.html</url>
    <content><![CDATA[<h1 id="Introduction-to-grub-2"><a href="#Introduction-to-grub-2" class="headerlink" title="Introduction to grub 2"></a>Introduction to grub 2</h1><p><strong>GRUB 2 配置文件的路径：</strong></p>
<p>​    <strong>BIOS-based</strong></p>
<p>​    <code>/boot/grub2/grub.cfg</code></p>
<p>​    <strong>UEFI</strong></p>
<p>​    <code>/boot/efi/EFI/redhat/grub.cfg</code></p>
<p><strong>Menu Entries in grub.cfg</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">menuentry &#x27;Red Hat Enterprise Linux Server&#x27; --class red --class gnu-linux --class gnu --class os<br><span class="hljs-meta prompt_">$</span><span class="language-bash">menuentry_id_option <span class="hljs-string">&#x27;gnulinux-simple-c60731dc-9046-4000-9182-64bdcce08616&#x27;</span> &#123;</span><br>    load_video<br>    set gfxpayload=keep<br>    insmod gzio<br>    insmod part_msdos<br>    insmod xfs<br>    set root=&#x27;hd0,msdos1&#x27;<br>    if [ x$feature_platform_search_hint = xy ]; then<br>        search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hintbaremetal=ahci0,msdos1 --hint=&#x27;hd0,msdos1&#x27; 19d9e294-65f8-4e37-8e73-d41d6daa6e58<br>    else<br>        search --no-floppy --fs-uuid --set=root 19d9e294-65f8-4e37-8e73-d41d6daa6e58<br>    fi<br>    echo &#x27;Loading Linux 3.8.0-0.40.el7.x86_64 ...&#x27;<br>    linux16 /vmlinuz-3.8.0-0.40.el7.x86_64 root=/dev/mapper/rhel-root ro rd.md=0 rd.dm=0<br>rd.lvm.lv=rhel/swap crashkernel=auto rd.luks=0 vconsole.keymap=us rd.lvm.lv=rhel/root rhgb quiet<br>    echo &#x27;Loading initial ramdisk ...&#x27;<br>    initrd /initramfs-3.8.0-0.40.el7.x86_64.img<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>linux</strong> on 64-bit IBM POWERSeries, <strong>linux16</strong> on x86_64 BIOS-based systems, and <strong>linuxefi</strong> on UEFI-based systems.   </p>
<p>The <strong>initrd</strong> directives followed by the path to the kernel and the <strong>initramfs</strong> image respectively.  </p>
<h5 id="Configuring-GRUB-2-to-Require-a-Password-only-for-Modifying-Entries"><a href="#Configuring-GRUB-2-to-Require-a-Password-only-for-Modifying-Entries" class="headerlink" title="Configuring GRUB 2 to Require a Password only for Modifying Entries"></a>Configuring GRUB 2 to Require a Password only for Modifying Entries</h5><ol>
<li><p>Run the grub2-setpassword command as root:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">grub2-setpassword</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Enter and confirm the password:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">Enter password:<br>Confirm password:  <br></code></pre></td></tr></table></figure></li>
</ol>
<p>Following this procedure creates a <strong>&#x2F;boot&#x2F;grub2&#x2F;user.cfg</strong> file that contains the hash of the password. The user for this password, <strong>root</strong>, is defined in the <strong>&#x2F;boot&#x2F;grub2&#x2F;grub.cfg</strong> file. With this change, modifying a boot entry during booting requires you to specify the <strong>root</strong> user name and your password.  </p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="Changing-the-Default-Boot-Entry"><a href="#Changing-the-Default-Boot-Entry" class="headerlink" title="Changing the Default Boot Entry"></a>Changing the Default Boot Entry</h4><p>GRUB 2 supports using a numeric value as the key for the saved_entry directive to change the default order in which the operating systems are loaded. To specify which operating system should be loaded first, pass its number to the grub2-set-default command. For example:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># grub2-set-default 2</span><br></code></pre></td></tr></table></figure>

<p>To force a system to always use a particular menu entry, use the menu entry name as the key to the GRUB_DEFAULT directive in the &#x2F;etc&#x2F;default&#x2F;grub file. To list the available menu entries, run the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># awk -F\&#x27; &#x27;$1==&quot;menuentry &quot; &#123;print $2&#125;&#x27; /etc/grub2.cfg</span><br></code></pre></td></tr></table></figure>

<h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><h4 id="Rebuilding-the-grub-cfg-file"><a href="#Rebuilding-the-grub-cfg-file" class="headerlink" title="Rebuilding the grub.cfg file"></a>Rebuilding the grub.cfg file</h4><p>Changes to &#x2F;etc&#x2F;default&#x2F;grub require rebuilding the grub.cfg file as follows:<br>On BIOS-based machines, issue the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></code></pre></td></tr></table></figure>

<p>On UEFI-based machines, issue the following command as root:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">~]<span class="hljs-comment"># grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>grub2</tag>
      </tags>
  </entry>
  <entry>
    <title>RELAX-AND-RECOVER (REAR)</title>
    <url>/blog/posts/57235.html</url>
    <content><![CDATA[<p><strong>Installing  ReaR</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">yum install rear genisoimage syslinux</span><br></code></pre></td></tr></table></figure>

<p><strong>Configuring ReaR</strong></p>
<p>ReaR is configured in the <code>/etc/rear/local.conf</code> file.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">OUTPUT=ISO<br>OUTPUT_URL=file:///mnt/rescue_system/<br>BACKUP=NETFS<br>BACKUP_URL=file:///srv/backup/<br></code></pre></td></tr></table></figure>

<p>BACKUP_URL的挂载点不能是“&#x2F;”，可以用以下命令检查</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash"><span class="hljs-built_in">df</span> -P /srv/backup/ | awk <span class="hljs-string">&#x27;&#123;print $6&#125;&#x27;</span> | <span class="hljs-built_in">tail</span> -1</span><br></code></pre></td></tr></table></figure>

<p><strong>Creating a Rescue System</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">rear -v mkrescue</span><br><span class="hljs-meta prompt_">~]# </span><span class="language-bash"><span class="hljs-built_in">ls</span> -lh /mnt/rescue_system/rhel7/</span><br>total 124M<br>-rw-------. 1 root root 202 Jun 10 15:27 README<br>-rw-------. 1 root root 166K Jun 10 15:27 rear.log<br>-rw-------. 1 root root 124M Jun 10 15:27 rear-rhel7.iso<br>-rw-------. 1 root root 274 Jun 10 15:27 VERSION<br></code></pre></td></tr></table></figure>

<p><strong>Scheduling ReaR</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">contab -e</span><br>0 22 * * 1-5 root /usr/sbin/rear mkrescue<br></code></pre></td></tr></table></figure>

<p><strong>Creating a Backup Using the Internal Backup Method</strong></p>
<p>With <strong>BACKUP&#x3D;NETFS</strong> set, ReaR can create either a rescue system, a backup file, or both. To create a rescue system only , run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">rear mkrescue<br></code></pre></td></tr></table></figure>

<p>To create a backup only , run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">rear mkbackuponly<br></code></pre></td></tr></table></figure>

<p>To create a rescue system and a backup , run:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">rear mkbackup<br></code></pre></td></tr></table></figure>

<p>Note that triggering backup with ReaR is only possible if using the NETFS method. ReaR cannot trigger other backup methods.  </p>
<p><strong>Performing a System Rescue</strong></p>
<p>To perform a restore or migration:</p>
<ol>
<li><p>Boot the rescue system on the new hardware. For example, burn the ISO image to a DVD and boot from the DVD.</p>
</li>
<li><p>In the console interface, select the “Recover” option:  </p>
<p><img src="https://s2.loli.net/2022/06/01/vxCj49WLuQUFyKg.png"></p>
</li>
<li><p>You are taken to the prompt: </p>
<p><img src="https://s2.loli.net/2022/06/01/uLfHGoKIm1zZvXr.png"></p>
</li>
<li><p>Run the <strong>rear recover</strong> command to perform the restore or migration. The rescue system then recreates the partition layout and filesystems: </p>
<p><img src="https://s2.loli.net/2022/06/01/qnkZHoQ2sVgp75T.png"></p>
</li>
<li><p>Restore user and system files from the backup into the &#x2F;mnt&#x2F;local&#x2F; directory. </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash">scp root@192.168.122.7:/srv/backup/rhel7/backup.tar.gz /mnt/local/</span><br><span class="hljs-meta prompt_">~]# </span><span class="language-bash">tar xf /mnt/local/backup.tar.gz -C /mnt/local/</span><br><span class="hljs-meta prompt_">~]# </span><span class="language-bash"><span class="hljs-built_in">rm</span> -f /mnt/local/backup.tar.gz</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Verify that the files have been restored: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash"><span class="hljs-built_in">ls</span> /mnt/local/</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Ensure that SELinux relabels the files on the next boot: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">~]# </span><span class="language-bash"><span class="hljs-built_in">touch</span> /mnt/local/.autorelabel</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Finish the recovery by entering <strong>exit</strong>. ReaR will then reinstall the boot loader. After that, <strong>reboot</strong> the system:</p>
<p><img src="https://s2.loli.net/2022/06/01/cCnZqQL18UiRgNJ.png"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Backup</category>
      </categories>
      <tags>
        <tag>rear</tag>
      </tags>
  </entry>
  <entry>
    <title>Installation</title>
    <url>/blog/posts/23242.html</url>
    <content><![CDATA[<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><h2 id="CLUSTER-SOFTWARE-INSTALLATION"><a href="#CLUSTER-SOFTWARE-INSTALLATION" class="headerlink" title="CLUSTER SOFTWARE INSTALLATION"></a>CLUSTER SOFTWARE INSTALLATION</h2><ol>
<li><p>On each node in the cluster, install the Red Hat High Availability Add-On software packages along with all available fence agents from the High Availability channel.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">yum install pcs pacemaker fence-agents-all<br></code></pre></td></tr></table></figure>
</li>
<li><p>If you are running the firewalld daemon, execute the following commands to enable the ports that are required by the Red Hat High Availability Add-On.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">firewall-cmd --permanent --add-service=high-availability<br>firewall-cmd --add-service=high-availability<br></code></pre></td></tr></table></figure>
</li>
<li><p>In order to use pcs to configure the cluster and communicate among the nodes, you must set a password on each node for the user ID hacluster, which is the pcs administration account. It is recommended that the password for user hacluster be the same on each node.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">passwd hacluster<br></code></pre></td></tr></table></figure>
</li>
<li><p>Before the cluster can be configured, the pcsd daemon must be started and enabled to boot on startup on each node. This daemon works with the pcs command to manage configuration across the nodes in the cluster.<br>On each node in the cluster, execute the following commands to start the pcsd service and to enable pcsd at system start.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">systemctl start pcsd.service<br>systemctl enable pcsd.service<br></code></pre></td></tr></table></figure>
</li>
<li><p>Authenticate the pcs user hacluster for each node in the cluster on the node from which you will be running pcs.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">pcs cluster auth z1.example.com z2.example.com<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="CLUSTER-CREATION"><a href="#CLUSTER-CREATION" class="headerlink" title="CLUSTER CREATION"></a>CLUSTER CREATION</h2><ol>
<li><p>Execute the following command from z1.example.com to create the two-node cluster my_cluster that consists of nodes z1.example.com and z2.example.com. This will propagate the cluster configuration files to both nodes in the cluster. This command includes the –start option, which will start the cluster services on both nodes in the cluster.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">pcs cluster setup --start --name my_cluster z1.example.com z2.example.com<br></code></pre></td></tr></table></figure>
</li>
<li><p>Enable the cluster services to run on each node in the cluster when the node is booted.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">pcs cluster enable --all<br></code></pre></td></tr></table></figure>
</li>
<li><p>You can display the current status of the cluster with the pcs cluster status command. Because there may be a slight delay before the cluster is up and running when you start the cluster services with the –start option of the pcs cluster setup command, you should ensure that the cluster is up and running before performing any subsequent actions on the cluster and its configuration.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">pcs cluster status<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Maintenance</title>
    <url>/blog/posts/8507.html</url>
    <content><![CDATA[<h1 id="Maintenance"><a href="#Maintenance" class="headerlink" title="Maintenance"></a>Maintenance</h1><p>待机模式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs node standby &lt;node&gt;<br>pcs node unstandby &lt;node&gt;<br></code></pre></td></tr></table></figure>

<p>维护模式</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs node maintenance &lt;node&gt;<br>pcs node unmaintenance &lt;node&gt;<br></code></pre></td></tr></table></figure>

<p>清除群集资源故障状态信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs cluster cleanup<br></code></pre></td></tr></table></figure>

<p>移动群集资源</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs resource move &lt;resource&gt; &lt;node&gt;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle database in Pacemaker</title>
    <url>/blog/posts/12039.html</url>
    <content><![CDATA[<h1 id="Oracle-database-in-Pacemaker"><a href="#Oracle-database-in-Pacemaker" class="headerlink" title="Oracle database in Pacemaker"></a>Oracle database in Pacemaker</h1><h4 id="1-CONFIGURING-AN-LVM-VOLUME-WITH-AN-EXT4-FILE-SYSTEM"><a href="#1-CONFIGURING-AN-LVM-VOLUME-WITH-AN-EXT4-FILE-SYSTEM" class="headerlink" title="1. CONFIGURING AN LVM VOLUME WITH AN EXT4 FILE SYSTEM"></a>1. CONFIGURING AN LVM VOLUME WITH AN EXT4 FILE SYSTEM</h4><ol>
<li><p>Create an LVM physical volume</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pvcreate /dev/sdb1<br>pvcreate /dev/sdc1<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create the volume group</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">vgcreate data_vg /dev/sdb1<br>vgcreate arch_vg /dev/sdc1<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create a logical volume</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">lvcreate -l +100%FREE -n data_lv data_vg<br>lvcreate -l +100%FREE -n arch_lv arch_vg<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create an ext4 file system</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">mkfs.ext4 /dev/data_vg/data_lv<br>mkfs.ext4 /dev/arch_vg/arch_lv<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="2-EXCLUSIVE-ACTIVATION-OF-A-VOLUME-GROUP-IN-A-CLUSTER"><a href="#2-EXCLUSIVE-ACTIVATION-OF-A-VOLUME-GROUP-IN-A-CLUSTER" class="headerlink" title="2. EXCLUSIVE ACTIVATION OF A VOLUME GROUP IN A CLUSTER"></a>2. EXCLUSIVE ACTIVATION OF A VOLUME GROUP IN A CLUSTER</h4><ol>
<li><p>Execute the following command to ensure that <strong>locking_type</strong> is set to 1 and that <strong>use_lvmetad</strong> is set to 0 in the <strong>&#x2F;etc&#x2F;lvm&#x2F;lvm.conf</strong> file. This command also disables and stops any lvmetad processes immediately.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">lvmconf --enable-halvm --services --startstopservices<br></code></pre></td></tr></table></figure>
</li>
<li><p>Determine which volume groups are currently configured on your local storage with the following command.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vgs --noheadings -o vg_name</span><br>  arch_vg<br>  data_vg<br>  rhel<br></code></pre></td></tr></table></figure>
</li>
<li><p>Add the volume groups other than <strong>data_vg&#x2F;arch_vg</strong> (the volume group you have just defined for the cluster) as entries to <strong>volume_list</strong> in the &#x2F;etc&#x2F;lvm&#x2F;lvm.conf configuration file.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">volume_list = [ <span class="hljs-string">&quot;rhel&quot;</span> ]<br></code></pre></td></tr></table></figure>
</li>
<li><p>Rebuild the <strong>initramfs</strong> boot image to guarantee that the boot image will not try to activate avolume group controlled by the cluster. Update the <strong>initramfs</strong> device with the following command. This command may take up to a minute to complete.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">dracut -H -f /boot/initramfs-$(<span class="hljs-built_in">uname</span> -r).img $(<span class="hljs-built_in">uname</span> -r)<br></code></pre></td></tr></table></figure>
</li>
<li><p>Reboot the node.</p>
</li>
<li><p>Start clusterservices on each of the nodes with the following command.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs cluster start --all<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-CREATING-THE-RESOURCES-AND-RESOURCE-GROUPS"><a href="#3-CREATING-THE-RESOURCES-AND-RESOURCE-GROUPS" class="headerlink" title="3. CREATING THE RESOURCES AND RESOURCE GROUPS"></a>3. CREATING THE RESOURCES AND RESOURCE GROUPS</h4><ol>
<li><p>Create LVM resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs resource create data_lvm LVM volgrpname=data_vg exclusive=<span class="hljs-literal">true</span> --group coco_inst_grp<br>pcs resource create arch_lvm LVM volgrpname=arch_vg exclusive=<span class="hljs-literal">true</span> --group coco_inst_grp<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create Filesystem resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs resource create data_fs Filesystem \<br>device=<span class="hljs-string">&quot;/dev/data_vg/data_lv&quot;</span> directory=<span class="hljs-string">&quot;/database/datafile&quot;</span> fstype=<span class="hljs-string">&quot;ext4&quot;</span> --group coco_inst_grp<br>pcs resource create arch_fs Filesystem \<br>device=<span class="hljs-string">&quot;/dev/arch_vg/arch_lv&quot;</span> directory=<span class="hljs-string">&quot;/database/archive&quot;</span> fstype=<span class="hljs-string">&quot;ext4&quot;</span> --group coco_inst_grp<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create VirtualIP resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs resource create VirtualIP IPaddr2 ip=192.168.184.149 \<br>cidr_netmask=24 nic=ens32 --group coco_inst_grp<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create Oracle Database Listener resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs resource create coco_lsnr oralsnr \<br>sid=<span class="hljs-string">&quot;coco&quot;</span> home=<span class="hljs-string">&quot;/u01/app/oracle/product/11.2.0/db_1&quot;</span> user=<span class="hljs-string">&quot;oracle&quot;</span> \<br>listener=<span class="hljs-string">&quot;LISTENER&quot;</span> tns_admin=<span class="hljs-string">&quot;/u01/app/oracle/product/11.2.0/db_1/network/admin&quot;</span> --group coco_inst_grp<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create Oracle Database resource</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">pcs resource create coco_inst oracle \<br>sid=<span class="hljs-string">&quot;coco&quot;</span> home=<span class="hljs-string">&quot;/u01/app/oracle/product/11.2.0/db_1&quot;</span> user=<span class="hljs-string">&quot;oracle&quot;</span> --group coco_inst_grp<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Ports</title>
    <url>/blog/posts/58907.html</url>
    <content><![CDATA[<h1 id="Ports"><a href="#Ports" class="headerlink" title="Ports"></a>Ports</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># firewall-cmd --permanent --add-service=high-availability</span><br><span class="hljs-comment"># firewall-cmd --add-service=high-availability</span><br></code></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Port</th>
<th>When Required</th>
</tr>
</thead>
<tbody><tr>
<td>TCP 2224</td>
<td>Required on all nodes (needed by the <code>pcsd</code> Web UI and required for node-to-node communication)<br><br>It is crucial to open port 2224 in such a way that <code>pcs</code> from any node can talk to all nodes in the cluster, including itself. When using the Booth cluster ticket manager or a quorum device you must open port 2224 on all related hosts, such as Booth arbiters or the quorum device host.</td>
</tr>
<tr>
<td>TCP 3121</td>
<td>Required on all nodes if the cluster has any Pacemaker Remote nodes<br><br>Pacemaker’s <code>crmd</code> daemon on the full cluster nodes will contact the <code>pacemaker_remoted</code> daemon on Pacemaker Remote nodes at port 3121. If a separate interface is used for cluster communication, the port only needs to be open on that interface. At a minimum, the port should open on Pacemaker Remote nodes to full cluster nodes. Because users may convert a host between a full node and a remote node, or run a remote node inside a container using the host’s network, it can be useful to open the port to all nodes. It is not necessary to open the port to any hosts other than nodes.</td>
</tr>
<tr>
<td>TCP 5403</td>
<td>Required on the quorum device host when using a quorum device with <code>corosync-qnetd</code>. The default value can be changed with the <code>-p</code> option of the <code>corosync-qnetd</code> command.</td>
</tr>
<tr>
<td>UDP 5404</td>
<td>Required on corosync nodes if <code>corosync</code> is configured for multicast UDP</td>
</tr>
<tr>
<td>UDP 5405</td>
<td>Required on all corosync nodes (needed by <code>corosync</code>)</td>
</tr>
<tr>
<td>TCP 21064</td>
<td>Required on all nodes if the cluster contains any resources requiring DLM (such as <code>clvm</code> or <code>GFS2</code>)</td>
</tr>
<tr>
<td>TCP 9929, UDP 9929</td>
<td>Required to be open on all cluster nodes and booth arbitrator nodes to connections from any of those same nodes when the Booth ticket manager is used to establish a multi-site cluster.</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>PXE for BIOS</title>
    <url>/blog/posts/5699.html</url>
    <content><![CDATA[<h1 id="PXE-for-BIOS"><a href="#PXE-for-BIOS" class="headerlink" title="PXE for BIOS"></a>PXE for BIOS</h1><p>为使用 BIOS 的 AMD64 和 Intel 64 客户端配置 PXE 服务器</p>
<ol>
<li><p>安装 tftp 软件包。请作为 root 运行以下命令完成此步骤：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># yum install tftp-server</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 &#x2F;etc&#x2F;xinet.d&#x2F;tftp 配置文件中，将 disabled 参数从 yes 改为 no。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># vim /etc/xinetd.d/tftp</span><br><span class="hljs-comment"># default: off</span><br><span class="hljs-comment"># description: The tftp server serves files using the trivial file transfer \</span><br><span class="hljs-comment">#       protocol.  The tftp protocol is often used to boot diskless \</span><br><span class="hljs-comment">#       workstations, download configuration files to network-aware printers, \</span><br><span class="hljs-comment">#       and to start the installation process for some operating systems.</span><br>service tftp<br>&#123;<br>        socket_type             = dgram<br>        protocol                = udp<br>        <span class="hljs-built_in">wait</span>                    = <span class="hljs-built_in">yes</span><br>        user                    = root<br>        server                  = /usr/sbin/in.tftpd<br>        server_args             = -s /var/lib/tftpboot<br>        <span class="hljs-built_in">disable</span>                 = no<br>        per_source              = 11<br>        cps                     = 100 2<br>        flags                   = IPv4<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个配置文件中还有其他控制 tftp 服务器行为的选项。可用选项请查看 xinetd.conf(5) 手册页。</p>
</li>
<li><p>在防火墙中允许 tftp 服务的进入连接：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># firewall-cmd --add-service=tftp</span><br>[root@rhel-7 ~]<span class="hljs-comment"># firewall-cmd --add-service=tftp --permanent</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>安装配置DHCP服务器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># yum install dhcp</span><br>[root@rhel-7 ~]<span class="hljs-comment"># vim /etc/dhcp/dhcpd.conf</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># DHCP Server Configuration file.</span><br><span class="hljs-comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span><br><span class="hljs-comment">#   see dhcpd.conf(5) man page</span><br><span class="hljs-comment">#</span><br><br>option space pxelinux;<br>option pxelinux.magic code 208 = string;<br>option pxelinux.configfile code 209 = text;<br>option pxelinux.pathprefix code 210 = text;<br>option pxelinux.reboottime code 211 = unsigned <span class="hljs-built_in">integer</span> 32;<br>option architecture-type code 93 = unsigned <span class="hljs-built_in">integer</span> 16;<br>subnet 192.168.184.0 netmask 255.255.255.0 &#123;<br>  option routers 192.168.184.254;<br>  range 192.168.184.2 192.168.184.253;<br>  class <span class="hljs-string">&quot;pxeclients&quot;</span> &#123;<br>    match <span class="hljs-keyword">if</span> substring (option vendor-class-identifier, 0, 9) = <span class="hljs-string">&quot;PXEClient&quot;</span>;<br>    next-server 192.168.184.129;<br>    <span class="hljs-keyword">if</span> option architecture-type = 00:07 &#123;<br>      filename <span class="hljs-string">&quot;uefi/shim.efi&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      filename <span class="hljs-string">&quot;pxelinux/pxelinux.0&quot;</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>现在需要完整安装 DVD 的 ISO 映像文件中 SYSLINUX 软件包中的 pxelinux.0 文件。要访问该文件，请作为 root 运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># mount -t iso9660 /path_to_image/name_of_image.iso /mount_point -o loop,ro</span><br>[root@rhel-7 ~]<span class="hljs-comment"># cp -pr /mount_point/Packages/syslinux-version-architecture.rpm /publicly_available_directory</span><br>[root@rhel-7 ~]<span class="hljs-comment"># umount /mount_point</span><br></code></pre></td></tr></table></figure>

<p>提取软件包：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># rpm2cpio syslinux-version-architecture.rpm | cpio -dimv</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 tftpboot 中创建 pxelinux 目录，并将 pxelinux.0 复制到该目录中：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># mkdir /var/lib/tftpboot/pxelinux</span><br>[root@rhel-7 ~]<span class="hljs-comment"># cp publicly_available_directory/usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/pxelinux</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 pxelinux&#x2F; 目录中创建目录 pxelinux.cfg&#x2F;：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># mkdir /var/lib/tftpboot/pxelinux/pxelinux.cfg</span><br></code></pre></td></tr></table></figure>

<p>在 pxelinux.cfg&#x2F; 目录中添加名为 default 的配置文件。<br><code>/var/lib/tftpboot/pxelinux/pxelinux.cfg/default</code>中的示例配置文件类似如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">default vesamenu.c32<br>prompt 1<br><span class="hljs-built_in">timeout</span> 600<br><br>display boot.msg<br><br>label linux<br>  menu label ^Install system<br>  menu default<br>  kernel vmlinuz<br>  append initrd=initrd.img ip=dhcp inst.repo=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/os/<br>label vesa<br>  menu label Install system with ^basic video driver<br>  kernel vmlinuz<br>  append initrd=initrd.img ip=dhcp inst.xdriver=vesa nomodeset inst.repo=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/os/<br>label rescue<br>  menu label ^Rescue installed system<br>  kernel vmlinuz<br>  append initrd=initrd.img rescue<br>label <span class="hljs-built_in">local</span><br>  menu label Boot from ^<span class="hljs-built_in">local</span> drive<br>  localboot 0xffff<br></code></pre></td></tr></table></figure>
</li>
<li><p>将引导映象复制到您的 tftp&#x2F; root 目录中：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># cp /path/to/x86_64/os/images/pxeboot/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/pxelinux/</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>最后，如果没有运行 xinetd 和 dhcp 服务，则需要启动该服务；如果该服务已运行，则需重新载入tftp、xinetd 和 dhcp。</p>
<p>如果这些服务之前没有运行，则需启动这些服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># systemctl start xinetd.service dhcpd.service</span><br></code></pre></td></tr></table></figure>

<p>如果要永久启用这些服务以便每次系统重启后自动启动，则还需要执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># systemctl enable xinetd.service dhcpd.service  </span><br></code></pre></td></tr></table></figure>

<p>要重新载入已运行服务的配置，请使用 <code>systemctl reload</code> 命令。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>pxe</tag>
      </tags>
  </entry>
  <entry>
    <title>Kickstart</title>
    <url>/blog/posts/3764.html</url>
    <content><![CDATA[<h1 id="Kickstart"><a href="#Kickstart" class="headerlink" title="Kickstart"></a>Kickstart</h1><p>通过编辑引导装载程序配置启动 Kickstart 安装</p>
<ol>
<li><p>打开 PXE 服务器中的引导装载程序配置文件，并在合适的行中添加 inst.ks&#x3D; 引导选项。该文件的名称及句法取决于您系统的架构和硬件：<br>在使用 BIOS 的 AMD64 和 Intel 64 系统中，该文件名称可以是 default，也可以是根据您的系统IP 地址命名。因此，请在安装条目的 append 行中添加 inst.ks&#x3D; 选项。该配置文件中 append行示例类似如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">append initrd=initrd.img inst.ks=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/kickstarts/ks.cfg<br></code></pre></td></tr></table></figure>
</li>
<li><p>在使用 GRUB2 引导装载程序（使用 UEFI 的 AMD64 和 Intel 64 系统，以及 IBM Power Systems Server）中，该文件名可能是 grub.cfg。在这个文件安装条目的 kernel 行添加 inst.ks&#x3D; 选项。该配置文件 kernel 行示例如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">kernel vmlinuz inst.ks=http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/kickstarts/ks.cfg<br></code></pre></td></tr></table></figure></li>
</ol>
<h2 id="语法参考"><a href="#语法参考" class="headerlink" title="语法参考"></a>语法参考</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">version=DEVEL</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">System authorization information</span><br>auth --enableshadow --passalgo=sha512<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Use CDROM installation media</span><br>cdrom<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Use graphical install</span><br>graphical<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Run the Setup Agent on first boot</span><br>firstboot --enable<br>ignoredisk --only-use=sda<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Keyboard layouts</span><br>keyboard --vckeymap=us --xlayouts=&#x27;us&#x27;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">System language</span><br>lang en_US.UTF-8<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Network information</span><br>network  --bootproto=static --device=ens33 --gateway=192.168.184.2 --ip=192.168.184.139 --nameserver=192.168.184.2 --netmask=255.255.255.0 --ipv6=auto --activate<br>network  --hostname=rhel7.localdomain<br><br>repo --name=&quot;Server-HighAvailability&quot; --baseurl=file:///run/install/repo/addons/HighAvailability<br>repo --name=&quot;Server-ResilientStorage&quot; --baseurl=file:///run/install/repo/addons/ResilientStorage<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Root password</span><br>rootpw --iscrypted $6$40.EhuRQPJ6OltGD$tYEcqbMNDwOmIMMpXhGMyVax5Sw9vyl7znesBaWr/H/pWkmG5qHXCmMHfT9VZSWtHCqinkE5ibO8ZVOzqpmvI0<br><span class="hljs-meta prompt_"># </span><span class="language-bash">System services</span><br>services --disabled=&quot;chronyd&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">System timezone</span><br>timezone Asia/Shanghai --isUtc --nontp<br><span class="hljs-meta prompt_"># </span><span class="language-bash">System bootloader configuration</span><br>bootloader --location=mbr --boot-drive=sda<br>autopart --type=lvm<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Partition clearing information</span><br>clearpart --none --initlabel<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">packages</span><br>@^minimal<br>@core<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">end</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">addon com_redhat_kdump --<span class="hljs-built_in">disable</span> --reserve-mb=<span class="hljs-string">&#x27;auto&#x27;</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">end</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">%</span><span class="language-bash">anaconda</span><br>pwpolicy root --minlen=6 --minquality=1 --notstrict --nochanges --notempty<br>pwpolicy user --minlen=6 --minquality=1 --notstrict --nochanges --emptyok<br>pwpolicy luks --minlen=6 --minquality=1 --notstrict --nochanges --notempty<br><span class="hljs-meta prompt_">%</span><span class="language-bash">end</span><br></code></pre></td></tr></table></figure>

<p>**rootpw –iscrypted **的加密密码可由python生成</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># python -c &#x27;import crypt; print(crypt.crypt(&quot;My Password&quot;))&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="验证Kickstart文件"><a href="#验证Kickstart文件" class="headerlink" title="验证Kickstart文件"></a>验证Kickstart文件</h2><p>生成定制 kickstart 文件时，请在使用该文件进行安装前确认其是否有效。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># yum install pykickstart</span><br></code></pre></td></tr></table></figure>

<p>安装该软件包后，可以很使用以下命令验证 Kickstart 文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ ksvalidator /path/to/kickstart.ks<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>kickstart</tag>
      </tags>
  </entry>
  <entry>
    <title>echo_color</title>
    <url>/blog/posts/44943.html</url>
    <content><![CDATA[<h1 id="echo-color"><a href="#echo-color" class="headerlink" title="echo_color"></a>echo_color</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env bash</span><br><br>ecred=<span class="hljs-string">&#x27;\033[0;31m&#x27;</span><br>ecyellow=<span class="hljs-string">&#x27;\033[0;33m&#x27;</span><br>ecgreen=<span class="hljs-string">&#x27;\033[32m&#x27;</span><br>ecend=<span class="hljs-string">&#x27;\033[0m&#x27;</span><br><br><span class="hljs-function"><span class="hljs-title">echo_red</span></span>() &#123;<br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ecred&#125;</span>$@<span class="hljs-variable">$&#123;ecend&#125;</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">echo_yellow</span></span>() &#123;<br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ecyellow&#125;</span>$@<span class="hljs-variable">$&#123;ecend&#125;</span>&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">echo_green</span></span>() &#123;<br><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;ecgreen&#125;</span>$@<span class="hljs-variable">$&#123;ecend&#125;</span>&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>格式解析</strong></p>
<p>@<a href="https://s2.loli.net/2022/07/08/LqJ8Dch6GHlQjYt.png"></a></p>
<p><strong>Colors Reference</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">字颜色：30—–37<br>　　<span class="hljs-built_in">echo</span> -e “\033[30m 黑色字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[31m 红色字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[32m 绿色字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[33m 黄色字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[34m 蓝色字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[35m 紫色字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[36m 天蓝字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[37m 白色字 \033[0m”<br><br>字背景颜色范围：40—–47<br>　　<span class="hljs-built_in">echo</span> -e “\033[40;37m 黑底白字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[41;37m 红底白字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[42;37m 绿底白字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[43;37m 黄底白字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[44;37m 蓝底白字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[45;37m 紫底白字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[46;37m 天蓝底白字 \033[0m”<br>　　<span class="hljs-built_in">echo</span> -e “\033[47;30m 白底黑字 \033[0m”<br><br>最后面控制选项说明<br>　　\33[0m 关闭所有属性<br>　　\33[1m 设置高亮度<br>　　\33[4m 下划线<br>　　\33[5m 闪烁<br>　　\33[7m 反显<br>　　\33[8m 消隐<br>　　\33[30m — \33[37m 设置前景色<br>　　\33[40m — \33[47m 设置背景色<br>　　\33[nA 光标上移n行<br>　　\33[nB 光标下移n行<br>　　\33[nC 光标右移n行<br>　　\33[nD 光标左移n行<br>　　\33[y;xH设置光标位置<br>　　\33[2J 清屏<br>　　\33[K 清除从光标到行尾的内容<br>　　\33[s 保存光标位置<br>　　\33[u 恢复光标位置<br>　　\33[?25l 隐藏光标<br>　　\33[?25h 显示光标<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Commands</title>
    <url>/blog/posts/21356.html</url>
    <content><![CDATA[<h1 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h1><p>Repalce <code>CRLF</code> to <code>LF</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sed -i <span class="hljs-string">&#x27;s/\r//g&#x27;</span> filename<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>File Archive</title>
    <url>/blog/posts/34874.html</url>
    <content><![CDATA[<h1 id="File-Archive"><a href="#File-Archive" class="headerlink" title="File Archive"></a>File Archive</h1><p>归档1天前的文件，并将原文件删除。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>find /log/ -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&#x27;file_*&#x27;</span> -atime -1 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">mv</span> &#123;&#125; /log/bak/ \;<br>tar -zcf /log/bak_`<span class="hljs-built_in">date</span> +%H%M%S`.tar.gz -P /log/bak/<br><br><span class="hljs-built_in">rm</span> -f /l/bak/*<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>PXE for UEFI</title>
    <url>/blog/posts/14849.html</url>
    <content><![CDATA[<h1 id="PXE-for-UEFI"><a href="#PXE-for-UEFI" class="headerlink" title="PXE for UEFI"></a>PXE for UEFI</h1><p>为使用 UEFI 的 AMD64 和 Intel 64 客户端配置 PXE 服务器</p>
<ol>
<li><p>安装 tftp 软件包。请作为 root 运行以下命令完成此步骤：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># yum install tftp-server</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 &#x2F;etc&#x2F;xinet.d&#x2F;tftp 配置文件中，将 disabled 参数从 yes 改为 no。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># vim /etc/xinetd.d/tftp</span><br><span class="hljs-comment"># default: off</span><br><span class="hljs-comment"># description: The tftp server serves files using the trivial file transfer \</span><br><span class="hljs-comment">#       protocol.  The tftp protocol is often used to boot diskless \</span><br><span class="hljs-comment">#       workstations, download configuration files to network-aware printers, \</span><br><span class="hljs-comment">#       and to start the installation process for some operating systems.</span><br>service tftp<br>&#123;<br>        socket_type             = dgram<br>        protocol                = udp<br>        <span class="hljs-built_in">wait</span>                    = <span class="hljs-built_in">yes</span><br>        user                    = root<br>        server                  = /usr/sbin/in.tftpd<br>        server_args             = -s /var/lib/tftpboot<br>        <span class="hljs-built_in">disable</span>                 = no<br>        per_source              = 11<br>        cps                     = 100 2<br>        flags                   = IPv4<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个配置文件中还有其他控制 tftp 服务器行为的选项。可用选项请查看 xinetd.conf(5) 手册页。</p>
</li>
<li><p>在防火墙中允许 tftp 服务的进入连接：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># firewall-cmd --add-service=tftp</span><br>[root@rhel-7 ~]<span class="hljs-comment"># firewall-cmd --add-service=tftp --permanent</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>安装配置DHCP服务器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># yum install dhcp</span><br>[root@rhel-7 ~]<span class="hljs-comment"># vim /etc/dhcp/dhcpd.conf</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># DHCP Server Configuration file.</span><br><span class="hljs-comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span><br><span class="hljs-comment">#   see dhcpd.conf(5) man page</span><br><span class="hljs-comment">#</span><br><br>option space pxelinux;<br>option pxelinux.magic code 208 = string;<br>option pxelinux.configfile code 209 = text;<br>option pxelinux.pathprefix code 210 = text;<br>option pxelinux.reboottime code 211 = unsigned <span class="hljs-built_in">integer</span> 32;<br>option architecture-type code 93 = unsigned <span class="hljs-built_in">integer</span> 16;<br>subnet 192.168.184.0 netmask 255.255.255.0 &#123;<br>  option routers 192.168.184.254;<br>  range 192.168.184.2 192.168.184.253;<br>  class <span class="hljs-string">&quot;pxeclients&quot;</span> &#123;<br>    match <span class="hljs-keyword">if</span> substring (option vendor-class-identifier, 0, 9) = <span class="hljs-string">&quot;PXEClient&quot;</span>;<br>    next-server 192.168.184.129;<br>    <span class="hljs-keyword">if</span> option architecture-type = 00:07 &#123;<br>      filename <span class="hljs-string">&quot;uefi/shim.efi&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      filename <span class="hljs-string">&quot;pxelinux/pxelinux.0&quot;</span>;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>现在您需要 shim 软件包中的 shim.efi 文件，以及 ISO 映像文件中 grub2-efi 软件包的grubx64.efi 文件。要访问该文件，请作为 root 运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># mount -t iso9660 /path_to_image/name_of_image.iso /mount_point -o loop,ro</span><br>[root@rhel-7 ~]<span class="hljs-comment"># cp -pr /mount_point/Packages/shim-version-architecture.rpm /publicly_available_directory</span><br>[root@rhel-7 ~]<span class="hljs-comment"># cp -pr /mount_point/Packages/grub2-efi-version-architecture.rpm /publicly_available_directory</span><br>[root@rhel-7 ~]<span class="hljs-comment"># umount /mount_point</span><br></code></pre></td></tr></table></figure>

<p>提取软件包：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># rpm2cpio shim-version-architecture.rpm | cpio -dimv</span><br>[root@rhel-7 ~]<span class="hljs-comment"># rpm2cpio grub2-efi-version-architecture.rpm | cpio -dimv</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 tftpboot&#x2F; 目录中为 EFI 引导映像创建名为 uefi&#x2F; 的目录，并从您的 boot 目录复制它们：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># mkdir /var/lib/tftpboot/uefi</span><br>[root@rhel-7 ~]<span class="hljs-comment"># cp publicly_available_directory/boot/efi/EFI/redhat/shim.efi /var/lib/tftpboot/uefi/</span><br>[root@rhel-7 ~]<span class="hljs-comment"># cp publicly_available_directory/boot/efi/EFI/redhat/grubx64.efi /var/lib/tftpboot/uefi/</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>在 uefi&#x2F; 目录中添加名为 grub.cfg 的配置文件。<code>/var/lib/tftpboot/uefi/grub.cfg</code> 配置文件示例类似如下：  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> <span class="hljs-built_in">timeout</span>=60<br>menuentry <span class="hljs-string">&#x27;RHEL 7&#x27;</span> &#123;<br>  linuxefi uefi/vmlinuz ip=dhcp inst.repo=http://192.168.184.129/mnt/archive/RHEL-7/7.1/Server/x86_64/os/<br>  initrdefi uefi/initrd.img<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>将引导映像复制到您的 uefi&#x2F; 目录下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment">#  cp /path/to/x86_64/os/images/pxeboot/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/uefi/</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>最后，如果没有运行 xinetd 和 dhcp 服务，则需要启动该服务；如果该服务已运行，则需重新载入tftp、xinetd 和 dhcp。</p>
<p>如果这些服务之前没有运行，则需启动这些服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># systemctl start xinetd.service dhcpd.service</span><br></code></pre></td></tr></table></figure>

<p>如果要永久启用这些服务以便每次系统重启后自动启动，则还需要执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rhel-7 ~]<span class="hljs-comment"># systemctl enable xinetd.service dhcpd.service  </span><br></code></pre></td></tr></table></figure>

<p>要重新载入已运行服务的配置，请使用 <code>systemctl reload</code> 命令。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>pxe</tag>
      </tags>
  </entry>
  <entry>
    <title>lsb_functions</title>
    <url>/blog/posts/15393.html</url>
    <content><![CDATA[<h1 id="lsb-functions"><a href="#lsb-functions" class="headerlink" title="lsb_functions"></a>lsb_functions</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use LSB init script functions for printing messages, if possible</span><br><span class="hljs-comment">#</span><br>lsb_functions=<span class="hljs-string">&quot;/lib/lsb/init-functions&quot;</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f <span class="hljs-variable">$lsb_functions</span> ; <span class="hljs-keyword">then</span><br>  . <span class="hljs-variable">$lsb_functions</span><br><span class="hljs-keyword">else</span><br>  <span class="hljs-comment"># Include non-LSB Redhat init functions to make systemctl redirect work</span><br>  init_functions=<span class="hljs-string">&quot;/etc/init.d/functions&quot;</span><br>  <span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f <span class="hljs-variable">$init_functions</span>; <span class="hljs-keyword">then</span><br>    . <span class="hljs-variable">$init_functions</span><br>  <span class="hljs-keyword">fi</span><br>  <span class="hljs-function"><span class="hljs-title">log_success_msg</span></span>()<br>  &#123;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; SUCCESS! <span class="hljs-variable">$@</span>&quot;</span><br>  &#125;<br>  <span class="hljs-function"><span class="hljs-title">log_failure_msg</span></span>()<br>  &#123;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; ERROR! <span class="hljs-variable">$@</span>&quot;</span><br>  &#125;<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>oracle_11g_setup</title>
    <url>/blog/posts/24266.html</url>
    <content><![CDATA[<h1 id="oracle-11g-setup"><a href="#oracle-11g-setup" class="headerlink" title="oracle_11g_setup"></a>oracle_11g_setup</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#! /usr/bin/env bash</span><br><span class="hljs-comment"># set -e  Exit immediately if a command exits with a non-zero status.</span><br><span class="hljs-built_in">set</span> -e<br><br><span class="hljs-built_in">source</span> /assets/colorecho<br><span class="hljs-built_in">trap</span> <span class="hljs-string">&quot;echo_red &#x27;******* ERROR: Something went wrong.&#x27;; exit 1&quot;</span> SIGTERM<br><span class="hljs-built_in">trap</span> <span class="hljs-string">&quot;echo_red &#x27;******* Caught SIGINT signal. Stopping...&#x27;; exit 2&quot;</span> SIGINT<br><br><span class="hljs-comment">#Install prerequisites directly without virtual package</span><br><span class="hljs-function"><span class="hljs-title">deps</span></span> () &#123;<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Installing dependencies&quot;</span><br>  yum -y install binutils compat-libstdc++-33 compat-libstdc++-33.i686 \<br>  ksh elfutils-libelf elfutils-libelf-devel glibc glibc-common glibc-devel \<br>  gcc gcc-c++ libaio libaio.i686 libaio-devel libaio-devel.i686 libgcc libstdc++ \<br>  libstdc++.i686 libstdc++-devel libstdc++-devel.i686 make sysstat unixODBC unixODBC-devel<br>  yum clean all<br>  <span class="hljs-built_in">rm</span> -rf /var/lib/&#123;cache,<span class="hljs-built_in">log</span>&#125; /var/log/lastlog<br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">create_users</span></span> () &#123;<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Configuring users&quot;</span><br>  groupadd -g 500 oinstall<br>  groupadd -g 501 dba<br>  useradd -u 500 -g oinstall -G dba oracle<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;oracle:oracle&quot;</span> | chpasswd<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;root:welcome&quot;</span> | chpasswd<br>  <span class="hljs-built_in">mkdir</span> -p -m 755 /u01/app/oracle<br>  <span class="hljs-built_in">mkdir</span> -p -m 755 /u01/app/oraInventory<br>  <span class="hljs-built_in">mkdir</span> -p -m 755 /u01/app/dpdump<br>  <span class="hljs-built_in">chown</span> -R oracle:oinstall /u01/app<br>  sed -i <span class="hljs-string">&quot;s/pam_namespace.so/pam_namespace.so\nsession    required     pam_limits.so/g&quot;</span> /etc/pam.d/login<br>  <span class="hljs-built_in">cat</span> /assets/profile &gt;&gt; ~oracle/.bash_profile<br>  <span class="hljs-built_in">cat</span> /assets/profile &gt;&gt; ~oracle/.bashrc<br>&#125;<br><br><span class="hljs-function"><span class="hljs-title">sysctl_and_limits</span></span> () &#123;<br>  <span class="hljs-built_in">cat</span> /assets/sysctl.conf &gt;&gt; /etc/sysctl.conf<br>  <span class="hljs-built_in">cat</span> /assets/limits.conf &gt;&gt; /etc/security/limits.conf<br>&#125;<br><br>deps<br>create_users<br>sysctl_and_limits<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ping</title>
    <url>/blog/posts/22183.html</url>
    <content><![CDATA[<p>检测某个网段的IP地址是否可达。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..254&#125;<br><span class="hljs-keyword">do</span><br>&#123;<br> ping -c 1 192.168.0.<span class="hljs-variable">$&#123;i&#125;</span> &amp;&gt; /dev/null &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.0.<span class="hljs-variable">$&#123;i&#125;</span> is alive&quot;</span> || <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.0.<span class="hljs-variable">$&#123;i&#125;</span> is down&quot;</span><br>&#125; &amp;<br><span class="hljs-keyword">done</span><br><span class="hljs-built_in">wait</span><br></code></pre></td></tr></table></figure>

<p><code>wait</code> - Wait for job completion and return exit status.</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Configure systemd for MySQL</title>
    <url>/blog/posts/39791.html</url>
    <content><![CDATA[<ol>
<li><p>Add a systemd service unit configuration file with details about the MySQL service</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$&gt; <span class="hljs-built_in">cd</span> /usr/lib/systemd/system<br>$&gt; <span class="hljs-built_in">touch</span> mysqld.service<br>$&gt; <span class="hljs-built_in">chmod</span> 644 mysqld.service<br></code></pre></td></tr></table></figure>

<p>Add this configuration information to the mysqld.service file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[Unit]<br>Description=MySQL Server<br>Documentation=man:mysqld(7)<br>Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html<br>After=network.target<br>After=syslog.target<br>[Install]<br>WantedBy=multi-user.target<br>[Service]<br>User=mysql<br>Group=mysql<br>Type=forking<br>PIDFile=/usr/local/mysql/data/mysqld.pid<br><br><span class="hljs-comment"># Disable service start and stop timeout logic of systemd for mysqld service.</span><br>TimeoutSec=0<br><br><span class="hljs-comment"># Start main service</span><br>ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf --daemonize --pid-file=/usr/local/mysql/data/mysqld.pid <span class="hljs-variable">$MYSQLD_OPTS</span><br><br><span class="hljs-comment"># Use this to switch malloc implementation</span><br>EnvironmentFile=-/etc/sysconfig/mysql<br><br><span class="hljs-comment"># Sets open_files_limit</span><br>LimitNOFILE = 5000<br>Restart=on-failure<br>RestartPreventExitStatus=1<br>PrivateTmp=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Add a configuration file for the systemd tmpfiles feature</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$&gt; <span class="hljs-built_in">cd</span> /usr/lib/tmpfiles.d<br>$&gt; <span class="hljs-built_in">touch</span> mysql.conf<br>$&gt; <span class="hljs-built_in">chmod</span> 644 mysql.conf<br></code></pre></td></tr></table></figure>

<p>Add this configuration information to the mysql.conf file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">d /usr/local/mysql/data 0750 mysql mysql -<br></code></pre></td></tr></table></figure>
</li>
<li><p>Enable the mysqld service to automatically start at reboot</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> mysqld.service --now<br>systemctl status mysqld<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>MySQL</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>Install MySQL on Linux</title>
    <url>/blog/posts/47968.html</url>
    <content><![CDATA[<h4 id="Using-the-MySQL-Yum-Repository"><a href="#Using-the-MySQL-Yum-Repository" class="headerlink" title="Using the MySQL Yum Repository"></a>Using the MySQL Yum Repository</h4><ol>
<li><p>Adding the MySQL Yum Repository</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sudo yum localinstall mysql57-community-release-el7-&#123;version-number&#125;.noarch.rpm<br>sudo yum-config-manager --<span class="hljs-built_in">enable</span> mysql57-community<br></code></pre></td></tr></table></figure>
</li>
<li><p>Disabling the Default MySQL Module</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sudo yum module <span class="hljs-built_in">disable</span> mysql<br></code></pre></td></tr></table></figure>
</li>
<li><p>Installing MySQL</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sudo yum install mysql-community-server<br></code></pre></td></tr></table></figure>
</li>
<li><p>Starting the MySQL Server</p>
<p>Start the MySQL server</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sudo systemctl <span class="hljs-built_in">enable</span> mysqld --now<br></code></pre></td></tr></table></figure>

<p>Get root temporary password in the error log file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sudo grep <span class="hljs-string">&#x27;temporary password&#x27;</span> /var/log/mysqld.log<br></code></pre></td></tr></table></figure>

<p>Change the root password</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;MyNewPass4!&#x27;</span>;<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="Using-Generic-Binaries"><a href="#Using-Generic-Binaries" class="headerlink" title="Using Generic Binaries"></a>Using Generic Binaries</h4><ol>
<li><p>Create a mysql User and Group</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">groupadd mysql<br>useradd -r -g mysql -s /bin/false mysql<br></code></pre></td></tr></table></figure>
</li>
<li><p>Obtain and Unpack the Distribution</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/local<br>tar zxvf /path/to/mysql-VERSION-OS.tar.gz<br><span class="hljs-built_in">ln</span> -s full-path-to-mysql-VERSION-OS mysql<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;export PATH=<span class="hljs-variable">$PATH</span>:/usr/local/mysql/bin&quot;</span> &gt;&gt; /etc/profile<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create directories and grant permissions</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> mysql<br><span class="hljs-built_in">mkdir</span> mysql-files<br><span class="hljs-built_in">chmod</span> 750 mysql-files<br><span class="hljs-built_in">chown</span> mysql:mysql mysql-files<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create my.cnf configuration file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> -a /etc/my.cnf /etc/my.cnf_`<span class="hljs-built_in">date</span> +%F`<br><span class="hljs-built_in">cat</span> &gt; /etc/my.cnf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[mysqld]</span><br><span class="hljs-string">basedir=/usr/local/mysql</span><br><span class="hljs-string">datadir=/usr/local/mysql/data</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Starting the MySQL Server</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data<br>bin/mysql_ssl_rsa_setup<br>bin/mysqld_safe --user=mysql &amp;<br><br><span class="hljs-comment"># Next command is optional</span><br><span class="hljs-comment"># cp support-files/mysql.server /etc/init.d/mysql.server</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="Using-Source"><a href="#Using-Source" class="headerlink" title="Using Source"></a>Using Source</h4><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Preconfiguration setup</span><br>$&gt; groupadd mysql<br>$&gt; useradd -r -g mysql -s /bin/false mysql<br><span class="hljs-comment"># Beginning of source-build specific instructions</span><br>$&gt; tar zxvf mysql-VERSION.tar.gz<br>$&gt; <span class="hljs-built_in">cd</span> mysql-VERSION<br>$&gt; <span class="hljs-built_in">mkdir</span> bld<br>$&gt; <span class="hljs-built_in">cd</span> bld<br>$&gt; cmake ..<br>$&gt; make<br>$&gt; make install<br><span class="hljs-comment"># End of source-build specific instructions</span><br><span class="hljs-comment"># Postinstallation setup</span><br>$&gt; <span class="hljs-built_in">cd</span> /usr/local/mysql<br>$&gt; <span class="hljs-built_in">mkdir</span> mysql-files<br>$&gt; <span class="hljs-built_in">chown</span> mysql:mysql mysql-files<br>$&gt; <span class="hljs-built_in">chmod</span> 750 mysql-files<br>$&gt; bin/mysqld --initialize --user=mysql<br>$&gt; bin/mysql_ssl_rsa_setup<br>$&gt; bin/mysqld_safe --user=mysql &amp;<br><span class="hljs-comment"># Next command is optional</span><br>$&gt; <span class="hljs-built_in">cp</span> support-files/mysql.server /etc/init.d/mysql.server<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>MySQL</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Reset Root Password</title>
    <url>/blog/posts/36095.html</url>
    <content><![CDATA[<h4 id="MySQL-5-7-6-and-later"><a href="#MySQL-5-7-6-and-later" class="headerlink" title="MySQL 5.7.6 and later"></a>MySQL 5.7.6 and later</h4><ol>
<li><p>Modify my.cnf, append <code>skip-grant-tables</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/my.cnf<br>[mysqld]<br>....<br>skip-grant-tables<br></code></pre></td></tr></table></figure>
</li>
<li><p>Restart mysql server, update root password</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host,authentication_string <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> authentication_string<span class="hljs-operator">=</span>password(<span class="hljs-string">&#x27;Jove!123&#x27;</span>) <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span>;<br>flush privileges;<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="MySQL-5-7-5-and-earlier"><a href="#MySQL-5-7-5-and-earlier" class="headerlink" title="MySQL 5.7.5 and earlier"></a>MySQL 5.7.5 and earlier</h4><ol>
<li><p>Modify my.cnf, append <code>skip-grant-tables</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/my.cnf<br>[mysqld]<br>....<br>skip-grant-tables<br></code></pre></td></tr></table></figure>
</li>
<li><p>Restart mysql server, update root password</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host,password <span class="hljs-keyword">from</span> mysql.user;<br><span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> password<span class="hljs-operator">=</span>password(<span class="hljs-string">&#x27;Jove!123&#x27;</span>) <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span> <span class="hljs-keyword">and</span> host<span class="hljs-operator">=</span><span class="hljs-string">&#x27;localhost&#x27;</span>;<br>flush privileges;<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>MySQL</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Brocade Configuration</title>
    <url>/blog/posts/30872.html</url>
    <content><![CDATA[<h1 id="Brocade-Configuration"><a href="#Brocade-Configuration" class="headerlink" title="Brocade Configuration"></a>Brocade Configuration</h1><h4 id="默认IP密码"><a href="#默认IP密码" class="headerlink" title="默认IP密码"></a>默认IP密码</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">初始默认IP: 10.77.77.77<br>用户密码: admin/password    root/fibranne<br></code></pre></td></tr></table></figure>

<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">porterrshow     # 查看端口计数<br>portstatsclear  # 清除全部端口计数<br><br>sfpshow         # 查看光衰<br><br>portperfshow    # 查看端口流量<br><br>fabricshow      # 查看与当前交换机级联的交换机<br></code></pre></td></tr></table></figure>

<h4 id="初始化配置"><a href="#初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">switchname SW1<br>tstimezone Asia/Shanghai<br>date &quot;0101235922&quot;<br>tsclockserver &quot;192.168.2.1&quot;<br>ipaddrset<br>ipaddrshow<br></code></pre></td></tr></table></figure>

<h4 id="ZONE配置"><a href="#ZONE配置" class="headerlink" title="ZONE配置"></a>ZONE配置</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建<span class="hljs-built_in">alias</span>/zone/cfg</span><br>alicreate &quot;Esxi168_HBA0&quot;,&quot;10:00:00:00:c9:60:15:2a&quot;<br>zonecreate &quot;Esxi168_HBA0_VNX5200_01_SPA01&quot;,&quot;Esxi168_HBA0;VNX5200_01_SPA01&quot;<br>cfgadd &quot;HIS_CONFIG&quot;,&quot;Esxi168_HBA0_VNX5200_01_SPA01&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">移除cfg/zone/alias</span><br>cfgremove &quot;HIS_CONFIG&quot;, &quot;bcmz1_zone3;bcmz1_zone4&quot;<br>zonedelete &quot;bcmz1_zone3&quot;<br>alidelete &quot;bcmz1_x3650_m3_p4&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">保存</span><br>cfgenable HIS_CONFIG<br>cfgsave<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">删除清空cfg</span><br>cfgdisable &quot;HIS_CONFIG&quot;<br>cfgclear<br>cfgsave<br></code></pre></td></tr></table></figure>

<h4 id="配置级联"><a href="#配置级联" class="headerlink" title="配置级联"></a>配置级联</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">查看级联许可</span><br>switch:admin&gt; licenseshow<br>ddedcHQyRSeefet: <br>Fabric license <br>Enhanced Group Management license <br>gBFMmPLMYJGKfDgf?3Rg9DKa3gDNE9JBJGAM: <br>8 Gig FC license]<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">添加许可</span><br>switch:admin&gt; licenseadd &lt;许可字符串&gt;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">激活端口</span><br>switch:admin&gt; licenseport --reserve 0-15<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">更改Domain-ID，级联的光交Domain-ID不能相同</span><br>switch:admin&gt; fabricshow<br>switch:admin&gt; switchdisable<br>switch:admin&gt; configure<br>Configure...<br>Fabric<br>Parameters (yes, y, no, n): [no] y<br>Domain<br>(1...239): [1] 2<br>…<br>&lt;ctrl+D&gt;<br>switch:admin&gt; switchenable<br></code></pre></td></tr></table></figure>

<h4 id="开启端口NPIV功能"><a href="#开启端口NPIV功能" class="headerlink" title="开启端口NPIV功能"></a>开启端口NPIV功能</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">开启指定端口的npiv功能</span><br>DS:root&gt;portcfgnpivport --enable [slot/]port<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">关闭指定端口的npiv功能</span><br>DS:root&gt;portcfgnpivport --disable [slot/]port<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看端口npiv功能状态</span><br>DS:root&gt; portcfgshow<br></code></pre></td></tr></table></figure>

<h4 id="FOS升级"><a href="#FOS升级" class="headerlink" title="FOS升级"></a>FOS升级</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">switch:admin&gt; firmwareshow<br>switch:admin&gt; firmwaredownload<br>switch:admin&gt; firmwareactivate<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Network</category>
        <category>SANSwitch</category>
      </categories>
      <tags>
        <tag>config</tag>
        <tag>sanswitch</tag>
      </tags>
  </entry>
  <entry>
    <title>Upgrade Brocade Switch Firmware</title>
    <url>/blog/posts/60709.html</url>
    <content><![CDATA[<h1 id="Upgrade-Brocade-Switch-Firmware"><a href="#Upgrade-Brocade-Switch-Firmware" class="headerlink" title="Upgrade Brocade Switch Firmware"></a>Upgrade Brocade Switch Firmware</h1><p>we use the <strong>firmwareshow</strong> command to see which firmware version is currently installed on the switch.</p>
<p><img src="https://s2.loli.net/2023/02/15/uQXwEkDJboZyvRC.png"></p>
<p>Next, we are going to initiate a <strong>firmwaredownload</strong> command and put in all the required options.</p>
<p><img src="https://s2.loli.net/2023/02/15/XT9LSvAfOF6DlPw.png"></p>
<p>The Server name or IP Address is the IP address of your workstation that hosts the FTP server.</p>
<p>The Username is the FTP user. The filename is the folder where the firmware is residing in and for Network Protocol, choose FTP. Lastly, put in the password for the user. Then the system is going to do a check of the firmware and if everything is good, it will start installing the upgrade.</p>
<p><img src="https://s2.loli.net/2023/02/15/c3zJUQAxVPWBgeH.png"></p>
<p>Please note that this is a <strong>disruptive</strong> upgrade, which means the switch will be restarted.</p>
]]></content>
      <categories>
        <category>Network</category>
        <category>SANSwitch</category>
      </categories>
      <tags>
        <tag>sanswitch</tag>
        <tag>upgrade</tag>
      </tags>
  </entry>
  <entry>
    <title>ASMLib</title>
    <url>/blog/posts/8178.html</url>
    <content><![CDATA[<ol>
<li><p>Install</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># ll /soft/</span><br>total 3664732<br>-r-xr-x---. 1 root root         304920 Apr 30 20:50 kmod-oracleasm-2.0.8-28.0.1.el7.x86_64.rpm<br>-r-xr-x---. 1 root root          19360 Apr 30 20:50 oracleasmlib-2.0.12-1.el7.x86_64.rpm<br>-r-xr-x---. 1 root root          86908 Apr 30 20:51 oracleasm-support-2.1.11-2.el7.x86_64.rpm<br><br>[root@rac1 ~]<span class="hljs-comment"># yum -y localinstall /soft/*</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Configure</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># oracleasm configure -i</span><br>Configuring the Oracle ASM library driver.<br><br>This will configure the on-boot properties of the Oracle ASM library<br>driver.  The following questions will determine whether the driver is<br>loaded on boot and what permissions it will have.  The current values<br>will be shown <span class="hljs-keyword">in</span> brackets (<span class="hljs-string">&#x27;[]&#x27;</span>).  Hitting &lt;ENTER&gt; without typing an<br>answer will keep that current value.  Ctrl-C will abort.<br><br>Default user to own the driver interface []: grid<br>Default group to own the driver interface []: asmadmin<br>Start Oracle ASM library driver on boot (y/n) [n]: y<br>Scan <span class="hljs-keyword">for</span> Oracle ASM disks on boot (y/n) [y]: y<br>Writing Oracle ASM library driver configuration: <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>View ASMLib driver configuration file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># cat /etc/sysconfig/oracleasm</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># This is a configuration file for automatic loading of the Oracle</span><br><span class="hljs-comment"># Automatic Storage Management library kernel driver.  It is generated</span><br><span class="hljs-comment"># By running /etc/init.d/oracleasm configure.  Please use that method</span><br><span class="hljs-comment"># to modify this file</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># ORACLEASM_ENABLED: &#x27;true&#x27; means to load the driver on boot.</span><br>ORACLEASM_ENABLED=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># ORACLEASM_UID: Default user owning the /dev/oracleasm mount point.</span><br>ORACLEASM_UID=grid<br><br><span class="hljs-comment"># ORACLEASM_GID: Default group owning the /dev/oracleasm mount point.</span><br>ORACLEASM_GID=asmadmin<br><br><span class="hljs-comment"># ORACLEASM_SCANBOOT: &#x27;true&#x27; means scan for ASM disks on boot.</span><br>ORACLEASM_SCANBOOT=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># ORACLEASM_SCANORDER: Matching patterns to order disk scanning</span><br>ORACLEASM_SCANORDER=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># ORACLEASM_SCANEXCLUDE: Matching patterns to exclude disks from scan</span><br>ORACLEASM_SCANEXCLUDE=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># ORACLEASM_SCAN_DIRECTORIES: Scan disks under these directories</span><br>ORACLEASM_SCAN_DIRECTORIES=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># ORACLEASM_USE_LOGICAL_BLOCK_SIZE: &#x27;true&#x27; means use the logical block size</span><br><span class="hljs-comment"># reported by the underlying disk instead of the physical. The default</span><br><span class="hljs-comment"># is &#x27;false&#x27;</span><br>ORACLEASM_USE_LOGICAL_BLOCK_SIZE=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Load and initialize the ASMLib driver</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># oracleasm init</span><br>Creating /dev/oracleasm mount point: /dev/oracleasm<br>Loading module <span class="hljs-string">&quot;oracleasm&quot;</span>: oracleasm<br>Configuring <span class="hljs-string">&quot;oracleasm&quot;</span> to use device physical block size<br>Mounting ASMlib driver filesystem: /dev/oracleasm<br>[root@rac1 ~]<span class="hljs-comment">#</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm status</span><br>Checking <span class="hljs-keyword">if</span> ASM is loaded: <span class="hljs-built_in">yes</span><br>Checking <span class="hljs-keyword">if</span> /dev/oracleasm is mounted: <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Create disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># oracleasm createdisk OCR_VOTE1 /dev/sdb1</span><br>Writing disk header: <span class="hljs-keyword">done</span><br>Instantiating disk: <span class="hljs-keyword">done</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm createdisk OCR_VOTE2 /dev/sdc1</span><br>Writing disk header: <span class="hljs-keyword">done</span><br>Instantiating disk: <span class="hljs-keyword">done</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm createdisk OCR_VOTE3 /dev/sdd1</span><br>Writing disk header: <span class="hljs-keyword">done</span><br>Instantiating disk: <span class="hljs-keyword">done</span><br>[root@rac1 ~]<span class="hljs-comment">#</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm listdisks</span><br>OCR_VOTE1<br>OCR_VOTE2<br>OCR_VOTE3<br></code></pre></td></tr></table></figure>
</li>
<li><p>Scan disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac2 ~]<span class="hljs-comment"># oracleasm scandisks</span><br>Reloading disk partitions: <span class="hljs-keyword">done</span><br>Cleaning any stale ASM disks...<br>Scanning system <span class="hljs-keyword">for</span> ASM disks...<br>Instantiating disk <span class="hljs-string">&quot;OCR_VOTE1&quot;</span><br>Instantiating disk <span class="hljs-string">&quot;OCR_VOTE2&quot;</span><br>Instantiating disk <span class="hljs-string">&quot;OCR_VOTE3&quot;</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>asmlib</tag>
      </tags>
  </entry>
  <entry>
    <title>Migrate ASM Diskgroup to Another SAN</title>
    <url>/blog/posts/56816.html</url>
    <content><![CDATA[<h1 id="Migrate-ASM-Diskgroup-to-Another-SAN"><a href="#Migrate-ASM-Diskgroup-to-Another-SAN" class="headerlink" title="Migrate ASM Diskgroup to Another SAN"></a>Migrate ASM Diskgroup to Another SAN</h1><ol>
<li><p>if necessary, modify asm_diskstring</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">set</span> asm_diskstring <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;/dev/emcpowerc*&#x27;</span>,<span class="hljs-string">&#x27;/dev/emcpowerh*&#x27;</span> <span class="hljs-keyword">scope</span><span class="hljs-operator">=</span><span class="hljs-keyword">both</span>;<br><br><span class="hljs-keyword">select</span> path <span class="hljs-keyword">from</span> v$asm_disk;<br></code></pre></td></tr></table></figure>
</li>
<li><p>query the fail groups</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">col path <span class="hljs-keyword">for</span> a20<br>col state <span class="hljs-keyword">for</span> a10<br>col failgroup <span class="hljs-keyword">for</span> a15<br>col name <span class="hljs-keyword">for</span> a15<br><span class="hljs-keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state <br><span class="hljs-keyword">from</span> v$asm_diskgroup dg, v$asm_disk d<br><span class="hljs-keyword">where</span> dg.group_number<span class="hljs-operator">=</span>d.group_number <span class="hljs-keyword">and</span> dg.name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;DATA&#x27;</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> dg.name,d.disk_number;<br><br>NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE<br><span class="hljs-comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span><br>DATA            MOUNTED    EXTERN           <span class="hljs-number">0</span> ORCL:DATA1           CACHED  DATA1           DATA1           NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">1</span> ORCL:DATA2           CACHED  DATA2           DATA2           NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">2</span> ORCL:DATA3           CACHED  DATA3           DATA3           NORMAL<br></code></pre></td></tr></table></figure>
</li>
<li><p>create new disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># oracleasm createdisk NEW_DATA1 /dev/sdl1</span><br>Writing disk header: <span class="hljs-keyword">done</span><br>Instantiating disk: <span class="hljs-keyword">done</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm createdisk NEW_DATA2 /dev/sdm1</span><br>Writing disk header: <span class="hljs-keyword">done</span><br>Instantiating disk: <span class="hljs-keyword">done</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm createdisk NEW_DATA3 /dev/sdn1</span><br>Writing disk header: <span class="hljs-keyword">done</span><br>Instantiating disk: <span class="hljs-keyword">done</span><br><br>[root@rac2 ~]<span class="hljs-comment"># oracleasm scandisks</span><br>Reloading disk partitions: <span class="hljs-keyword">done</span><br>Cleaning any stale ASM disks...<br>Scanning system <span class="hljs-keyword">for</span> ASM disks...<br>Instantiating disk <span class="hljs-string">&quot;NEW_DATA1&quot;</span><br>Instantiating disk <span class="hljs-string">&quot;NEW_DATA2&quot;</span><br>Instantiating disk <span class="hljs-string">&quot;NEW_DATA3&quot;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>from node1 add each disk to a fail group</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">sqlplus &quot; / as sysasm&quot;<br><br><span class="hljs-comment">-- external type not need to specify a fail group</span><br><span class="hljs-keyword">ALTER</span> DISKGROUP DATA <span class="hljs-keyword">ADD</span> DISK<br><span class="hljs-string">&#x27;ORCL:NEW_DATA1&#x27;</span>,<br><span class="hljs-string">&#x27;ORCL:NEW_DATA2&#x27;</span>,<br><span class="hljs-string">&#x27;ORCL:NEW_DATA3&#x27;</span><br>REBALANCE POWER <span class="hljs-number">8</span>;<br><br><span class="hljs-comment">-- chanage rebalance power. compatiable.asm &gt;= 11.2.0.2, power range is 0 to 1024; if &lt; 11.2.0.2, power range is 0 to 11.</span><br><span class="hljs-keyword">alter</span> diskgroup DATA rebalance power <span class="hljs-number">8</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> gv$asm_operation;<br><span class="hljs-keyword">no</span> <span class="hljs-keyword">rows</span> selected<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> col path <span class="hljs-keyword">for</span> a20<br>col state <span class="hljs-keyword">for</span> a10<br>col failgroup <span class="hljs-keyword">for</span> a15<br>col name <span class="hljs-keyword">for</span> a15<br><span class="hljs-keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state<br><span class="hljs-keyword">from</span> v$asm_diskgroup dg, v$asm_disk d<br><span class="hljs-keyword">where</span> dg.group_number<span class="hljs-operator">=</span>d.group_number <span class="hljs-keyword">and</span> dg.name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;DATA&#x27;</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> dg.name,d.disk_number;<br><br>NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE<br><span class="hljs-comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span><br>DATA            MOUNTED    EXTERN           <span class="hljs-number">0</span> ORCL:DATA1           CACHED  DATA1           DATA1           NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">1</span> ORCL:DATA2           CACHED  DATA2           DATA2           NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">2</span> ORCL:DATA3           CACHED  DATA3           DATA3           NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">3</span> ORCL:NEW_DATA1       CACHED  NEW_DATA1       NEW_DATA1       NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">4</span> ORCL:NEW_DATA2       CACHED  NEW_DATA2       NEW_DATA2       NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">5</span> ORCL:NEW_DATA3       CACHED  NEW_DATA3       NEW_DATA3       NORMAL<br></code></pre></td></tr></table></figure>
</li>
<li><p>drop old disks</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> DISKGROUP DATA <span class="hljs-keyword">DROP</span> DISK<br><span class="hljs-string">&#x27;DATA1&#x27;</span>,<br><span class="hljs-string">&#x27;DATA2&#x27;</span>,<br><span class="hljs-string">&#x27;DATA3&#x27;</span><br>REBALANCE POWER <span class="hljs-number">8</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> gv$asm_operation;<br><span class="hljs-keyword">no</span> <span class="hljs-keyword">rows</span> selected<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> col path <span class="hljs-keyword">for</span> a20<br>col state <span class="hljs-keyword">for</span> a10<br>col failgroup <span class="hljs-keyword">for</span> a15<br>col name <span class="hljs-keyword">for</span> a15<br><span class="hljs-keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state<br><span class="hljs-keyword">from</span> v$asm_diskgroup dg, v$asm_disk d<br><span class="hljs-keyword">where</span> dg.group_number<span class="hljs-operator">=</span>d.group_number <span class="hljs-keyword">and</span> dg.name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;DATA&#x27;</span><br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> dg.name,d.disk_number;<br><br>NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE<br><span class="hljs-comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span><br>DATA            MOUNTED    EXTERN           <span class="hljs-number">3</span> ORCL:NEW_DATA1       CACHED  NEW_DATA1       NEW_DATA1       NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">4</span> ORCL:NEW_DATA2       CACHED  NEW_DATA2       NEW_DATA2       NORMAL<br>DATA            MOUNTED    EXTERN           <span class="hljs-number">5</span> ORCL:NEW_DATA3       CACHED  NEW_DATA3       NEW_DATA3       NORMAL<br></code></pre></td></tr></table></figure>
</li>
<li><p>note: add and drop disks in one command, only one rebalancing operation will occur</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> DISKGROUP DATA <span class="hljs-keyword">ADD</span> DISK<br><span class="hljs-string">&#x27;ORCL:NEW_DATA1&#x27;</span>,<br><span class="hljs-string">&#x27;ORCL:NEW_DATA2&#x27;</span>,<br><span class="hljs-string">&#x27;ORCL:NEW_DATA3&#x27;</span><br><span class="hljs-keyword">DROP</span> DISK<br><span class="hljs-string">&#x27;DATA1&#x27;</span>,<br><span class="hljs-string">&#x27;DATA2&#x27;</span>,<br><span class="hljs-string">&#x27;DATA3&#x27;</span><br>REBALANCE POWER <span class="hljs-number">8</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>delete old disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># oracleasm deletedisk DATA1</span><br>Clearing disk header: <span class="hljs-keyword">done</span><br>Dropping disk: <span class="hljs-keyword">done</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm deletedisk DATA2</span><br>Clearing disk header: <span class="hljs-keyword">done</span><br>Dropping disk: <span class="hljs-keyword">done</span><br>[root@rac1 ~]<span class="hljs-comment"># oracleasm deletedisk DATA3</span><br>Clearing disk header: <span class="hljs-keyword">done</span><br>Dropping disk: <span class="hljs-keyword">done</span><br><br>[root@rac2 ~]<span class="hljs-comment"># oracleasm scandisks</span><br>Reloading disk partitions: <span class="hljs-keyword">done</span><br>Cleaning any stale ASM disks...<br>Cleaning disk <span class="hljs-string">&quot;DATA1&quot;</span><br>Cleaning disk <span class="hljs-string">&quot;DATA2&quot;</span><br>Cleaning disk <span class="hljs-string">&quot;DATA3&quot;</span><br>Scanning system <span class="hljs-keyword">for</span> ASM disks...<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>migrate</tag>
      </tags>
  </entry>
  <entry>
    <title>Maintenance</title>
    <url>/blog/posts/8508.html</url>
    <content><![CDATA[<h4 id="Creating-Disk-Groups"><a href="#Creating-Disk-Groups" class="headerlink" title="Creating Disk Groups"></a>Creating Disk Groups</h4><p><img src="https://docs.oracle.com/cd/B19306_01/server.102/b14200/img/create_diskgroup.gif"><br><img src="https://docs.oracle.com/cd/B19306_01/server.102/b14200/img/qualified_disk_clause.gif"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DISKGROUP data NORMAL REDUNDANCY<br>  FAILGROUP controller1 DISK<br>    <span class="hljs-string">&#x27;/devices/diska1&#x27;</span> NAME diska1,<br>    <span class="hljs-string">&#x27;/devices/diska2&#x27;</span> NAME diska2,<br>    <span class="hljs-string">&#x27;/devices/diska3&#x27;</span> NAME diska3,<br>    <span class="hljs-string">&#x27;/devices/diska4&#x27;</span> NAME diska4<br>  FAILGROUP controller2 DISK<br>    <span class="hljs-string">&#x27;/devices/diskb1&#x27;</span> NAME diskb1,<br>    <span class="hljs-string">&#x27;/devices/diskb2&#x27;</span> NAME diskb2,<br>    <span class="hljs-string">&#x27;/devices/diskb3&#x27;</span> NAME diskb3,<br>    <span class="hljs-string">&#x27;/devices/diskb4&#x27;</span> NAME diskb4<br>  ATTRIBUTE <span class="hljs-string">&#x27;au_size&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;4M&#x27;</span>,<br>    <span class="hljs-string">&#x27;compatible.asm&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>, <br>    <span class="hljs-string">&#x27;compatible.rdbms&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>,<br>    <span class="hljs-string">&#x27;compatible.advm&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DISKGROUP DATA <span class="hljs-keyword">EXTERNAL</span> REDUNDANCY<br>  DISK <span class="hljs-string">&#x27;ORCL:DATA1&#x27;</span>,<span class="hljs-string">&#x27;ORCL:DATA2&#x27;</span>,<span class="hljs-string">&#x27;ORCL:DATA3&#x27;</span><br>  ATTRIBUTE <span class="hljs-string">&#x27;COMPATIBLE.ASM&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="Dropping-Disk-Groups"><a href="#Dropping-Disk-Groups" class="headerlink" title="Dropping Disk Groups"></a>Dropping Disk Groups</h4><p>The default is <code>EXCLUDING CONTENTS</code>, which provides syntactic consistency and prevents you from dropping the disk group if it has any contents.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> diskgroup DATA;<br></code></pre></td></tr></table></figure>

<p>You can specify the <code>INCLUDING CONTENTS</code> clause if you also want to delete all files that are contained in the disk group.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> diskgroup DATA including contents;<br></code></pre></td></tr></table></figure>

<p>If you cannot mount a disk group but must drop it, you can use the <code>FORCE</code> option of the <code>DROP DISKGROUP</code> statement.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> diskgroup DATA force;<br></code></pre></td></tr></table></figure>

<h4 id="Disk-Group-Compatibility"><a href="#Disk-Group-Compatibility" class="headerlink" title="Disk Group Compatibility"></a>Disk Group Compatibility</h4><p>Valid Combinations of Compatibility Attribute Settings for 11g</p>
<table>
<thead>
<tr>
<th>COMPATIBLE.ASM</th>
<th>COMPATIBLE.RDBMS</th>
<th>COMPATIBLE.ADVM</th>
<th>ASM Instance Version</th>
<th>COMPATIBLE Setting for RDBMS Instance</th>
</tr>
</thead>
<tbody><tr>
<td>10.1</td>
<td>10.1</td>
<td>n&#x2F;a</td>
<td>&gt;&#x3D; 10.1</td>
<td>&gt;&#x3D; 10.1</td>
</tr>
<tr>
<td>11.1</td>
<td>10.1</td>
<td>n&#x2F;a</td>
<td>&gt;&#x3D; 11.1</td>
<td>&gt;&#x3D; 10.1</td>
</tr>
<tr>
<td>11.2</td>
<td>11.1</td>
<td>11.2</td>
<td>&gt;&#x3D; 11.2</td>
<td>&gt;&#x3D; 11.1</td>
</tr>
<tr>
<td>11.2</td>
<td>11.2</td>
<td>11.2</td>
<td>&gt;&#x3D; 11.2</td>
<td>&gt;&#x3D; 11.2</td>
</tr>
</tbody></table>
<p>Using <code>ALTER DISKGROUP</code> with Compatibility Attributes</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> DISKGROUP DATA <span class="hljs-keyword">SET</span> ATTRIBUTE <span class="hljs-string">&#x27;compatible.asm&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>;<br><span class="hljs-keyword">ALTER</span> DISKGROUP DATA <span class="hljs-keyword">SET</span> ATTRIBUTE <span class="hljs-string">&#x27;compatible.rdbms&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>;<br><span class="hljs-keyword">ALTER</span> DISKGROUP DATA <span class="hljs-keyword">SET</span> ATTRIBUTE <span class="hljs-string">&#x27;compatible.advm&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>maintenance</tag>
      </tags>
  </entry>
  <entry>
    <title>Replace OCR and Voting disks</title>
    <url>/blog/posts/62201.html</url>
    <content><![CDATA[<h4 id="OCR"><a href="#OCR" class="headerlink" title="OCR"></a>OCR</h4><ol>
<li><p>Perform ocr backup</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 bin]<span class="hljs-comment"># ./ocrconfig -manualbackup</span><br>rac2     2022/05/06 09:21:54     /u01/app/11.2.0/grid/cdata/rac-cluster/backup_20220506_092154.ocr<br><br>[root@rac1 bin]<span class="hljs-comment"># ./ocrconfig -showbackup</span><br>PROT-24: Auto backups <span class="hljs-keyword">for</span> the Oracle Cluster Registry are not available<br>rac2     2022/05/06 09:21:54     /u01/app/11.2.0/grid/cdata/rac-cluster/backup_20220506_092154.ocr<br></code></pre></td></tr></table></figure>
</li>
<li><p>Perform ocrcheck</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 bin]<span class="hljs-comment"># ./ocrcheck</span><br>Status of Oracle Cluster Registry is as follows :<br>         Version                  :          3<br>         Total space (kbytes)     :     262120<br>         Used space (kbytes)      :       3012<br>         Available space (kbytes) :     259108<br>         ID                       :  354983601<br>         Device/File Name         :  +OCR_VOTE<br>                                    Device/File integrity check succeeded<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>         Cluster registry integrity check succeeded<br><br>         Logical corruption check succeeded<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create a new NEW_OCRVOTE diskgroup</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DISKGROUP NEW_OCRVOTE NORMAL REDUNDANCY<br>FAILGROUP F1 DISK<br><span class="hljs-string">&#x27;ORCL:NEW_OCRVOTE1&#x27;</span>,<span class="hljs-string">&#x27;ORCL:NEW_OCRVOTE2&#x27;</span><br>FAILGROUP F2 DISK<br><span class="hljs-string">&#x27;ORCL:NEW_OCRVOTE3&#x27;</span>,<span class="hljs-string">&#x27;ORCL:NEW_OCRVOTE4&#x27;</span><br>ATTRIBUTE <span class="hljs-string">&#x27;COMPATIBLE.ASM&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;11.2&#x27;</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Add new ocrmirror</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 bin]<span class="hljs-comment"># ./ocrconfig -add +NEW_OCRVOTE</span><br>[root@rac1 bin]<span class="hljs-comment"># ./ocrcheck</span><br>Status of Oracle Cluster Registry is as follows :<br>         Version                  :          3<br>         Total space (kbytes)     :     262120<br>         Used space (kbytes)      :       3012<br>         Available space (kbytes) :     259108<br>         ID                       :  354983601<br>         Device/File Name         :  +OCR_VOTE<br>                                    Device/File integrity check succeeded<br><br>         Device/File Name         :  +NEW_OCRVOTE<br>                                    Device/File integrity check succeeded<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>         Cluster registry integrity check succeeded<br><br>         Logical corruption check succeeded<br></code></pre></td></tr></table></figure>
</li>
<li><p>Delete old ocr device</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 bin]<span class="hljs-comment"># ./ocrconfig -delete +OCR_VOTE</span><br>[root@rac1 bin]<span class="hljs-comment"># ./ocrcheck</span><br>Status of Oracle Cluster Registry is as follows :<br>         Version                  :          3<br>         Total space (kbytes)     :     262120<br>         Used space (kbytes)      :       3012<br>         Available space (kbytes) :     259108<br>         ID                       :  354983601<br>         Device/File Name         :  +NEW_OCRVOTE<br>                                    Device/File integrity check succeeded<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>                                    Device/File not configured<br><br>         Cluster registry integrity check succeeded<br><br>         Logical corruption check succeeded<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="Voting-Disks"><a href="#Voting-Disks" class="headerlink" title="Voting Disks"></a>Voting Disks</h4><ol>
<li><p>Query css votedisk</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[grid@rac1 ~]$ crsctl query css votedisk<br><span class="hljs-comment">##  STATE    File Universal Id                File Name Disk group</span><br>--  -----    -----------------                --------- ---------<br> 1. ONLINE   adbb58e65c384ff0bf5fc171cba469a4 (ORCL:OCR_VOTE1) [OCR_VOTE]<br>Located 1 voting disk(s).<br></code></pre></td></tr></table></figure>
</li>
<li><p>Replace votedisk</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[grid@rac1 ~]$ crsctl replace votedisk +NEW_OCRVOTE<br><br>[grid@rac1 ~]$ crsctl query css votedisk<br><span class="hljs-comment">##  STATE    File Universal Id                File Name Disk group</span><br>--  -----    -----------------                --------- ---------<br> 1. ONLINE   adbb58e65c384ff0bf5fc171cba469a4 (ORCL:NEW_OCRVOTE1) [NEW_OCRVOTE]<br> 2. ONLINE   07d2464674ac4fabbf27f3132d8448b0 (ORCL:NEW_OCRVOTE2) [NEW_OCRVOTE]<br> 3. ONLINE   9761ccf221524f66bff0766ad5721239 (ORCL:NEW_OCRVOTE3) [NEW_OCRVOTE]<br>Located 3 voting disk(s).<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="ASM-spfile"><a href="#ASM-spfile" class="headerlink" title="ASM spfile"></a>ASM spfile</h4><ol>
<li><p>Replace asm spfile to new diskgroup</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">parameter</span> spfile;<br>NAME                                TYPE        <span class="hljs-keyword">VALUE</span><br><span class="hljs-comment">------------------------------------ ----------- ------------------------------</span><br>spfile                               string      <span class="hljs-operator">+</span>OCR_VOTE<span class="hljs-operator">/</span>rac<span class="hljs-operator">-</span>cluster<span class="hljs-operator">/</span>asmparame<br>                                                 terfile<span class="hljs-operator">/</span>registry<span class="hljs-number">.253</span><span class="hljs-number">.946671547</span><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> pfile<span class="hljs-operator">=</span><span class="hljs-string">&#x27;/u01/app/grid/asmpfile.ora&#x27;</span> <span class="hljs-keyword">from</span> spfile;<br>File created.<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> spfile<span class="hljs-operator">=</span><span class="hljs-string">&#x27;+NEW_OCRVOTE&#x27;</span> <span class="hljs-keyword">from</span> pfile<span class="hljs-operator">=</span><span class="hljs-string">&#x27;/u01/app/grid/asmpfile.ora&#x27;</span>;<br>File created.<br></code></pre></td></tr></table></figure>
</li>
<li><p>Restart cluster</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 bin]<span class="hljs-comment"># ./crsctl stop cluster -all</span><br>[root@rac1 bin]<span class="hljs-comment"># ./crsctl start cluster -all</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>ocr</tag>
        <tag>voting</tag>
        <tag>replace</tag>
      </tags>
  </entry>
  <entry>
    <title>Swap Voting Disks Across Storage</title>
    <url>/blog/posts/38665.html</url>
    <content><![CDATA[<h4 id="Swap-Voting-Disks-Across-Storage"><a href="#Swap-Voting-Disks-Across-Storage" class="headerlink" title="Swap Voting Disks Across Storage"></a>Swap Voting Disks Across Storage</h4><ol>
<li><p>Query css votedisk</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">crsctl query css votedisk;<br><br><span class="hljs-comment">##  STATE    File Universal Id                File Name Disk group</span><br>--  -----    -----------------                --------- ---------<br>1. ONLINE   73e1c48069d64fefbfc44cd8e65107d8 (ORCL:OCR_VOTE1) [OCR_VOTE]<br>Located 1 voting disk(s).<br></code></pre></td></tr></table></figure>
</li>
<li><p>Query the fail groups</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">col path <span class="hljs-keyword">for</span> a20<br>col state <span class="hljs-keyword">for</span> a10<br>col failgroup <span class="hljs-keyword">for</span> a15<br>col name <span class="hljs-keyword">for</span> a15<br><span class="hljs-keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state <br> <span class="hljs-keyword">from</span> v$asm_diskgroup dg, v$asm_disk d<br> <span class="hljs-keyword">where</span> dg.group_number<span class="hljs-operator">=</span>d.group_number <span class="hljs-keyword">and</span> dg.name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;OCR_VOTE&#x27;</span><br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> dg.name,d.disk_number;<br><br>NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE<br><span class="hljs-comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span><br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">0</span> ORCL:OCR_VOTE1       CACHED  OCR_VOTE1       OCR_VOTE1       NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">1</span> ORCL:OCR_VOTE2       CACHED  OCR_VOTE2       OCR_VOTE2       NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">2</span> ORCL:OCR_VOTE3       CACHED  OCR_VOTE3       OCR_VOTE3       NORMAL<br></code></pre></td></tr></table></figure>
</li>
<li><p>Create new disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">oracleasm createdisk NEW_OCR_VOTE1 /dev/sdi1<br>oracleasm createdisk NEW_OCR_VOTE2 /dev/sdj1<br>oracleasm createdisk NEW_OCR_VOTE3 /dev/sdk1<br></code></pre></td></tr></table></figure>
</li>
<li><p>From node1 add each disk to a fail group</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">sqlplus &quot; / as sysasm&quot;<br><br><span class="hljs-comment">-- external type not need to specify a fail group</span><br><span class="hljs-keyword">ALTER</span> DISKGROUP OCR_VOTE <span class="hljs-keyword">ADD</span> DISK<br><span class="hljs-string">&#x27;ORCL:NEW_OCR_VOTE1&#x27;</span>,<br><span class="hljs-string">&#x27;ORCL:NEW_OCR_VOTE2&#x27;</span>,<br><span class="hljs-string">&#x27;ORCL:NEW_OCR_VOTE3&#x27;</span><br>REBALANCE POWER <span class="hljs-number">8</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> gv$asm_operation;<br><span class="hljs-keyword">no</span> <span class="hljs-keyword">rows</span> selected<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> col path <span class="hljs-keyword">for</span> a20<br>col state <span class="hljs-keyword">for</span> a10<br>col failgroup <span class="hljs-keyword">for</span> a15<br>col name <span class="hljs-keyword">for</span> a15<br><span class="hljs-keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state<br> <span class="hljs-keyword">from</span> v$asm_diskgroup dg, v$asm_disk d<br> <span class="hljs-keyword">where</span> dg.group_number<span class="hljs-operator">=</span>d.group_number <span class="hljs-keyword">and</span> dg.name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;OCR_VOTE&#x27;</span><br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> dg.name,d.disk_number;<br><br>NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE<br><span class="hljs-comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span><br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">0</span> ORCL:OCR_VOTE1       CACHED  OCR_VOTE1       OCR_VOTE1       NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">1</span> ORCL:OCR_VOTE2       CACHED  OCR_VOTE2       OCR_VOTE2       NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">2</span> ORCL:OCR_VOTE3       CACHED  OCR_VOTE3       OCR_VOTE3       NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">3</span> ORCL:NEW_OCR_VOTE1   CACHED  NEW_OCR_VOTE1   NEW_OCR_VOTE1   NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">4</span> ORCL:NEW_OCR_VOTE2   CACHED  NEW_OCR_VOTE2   NEW_OCR_VOTE2   NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">5</span> ORCL:NEW_OCR_VOTE3   CACHED  NEW_OCR_VOTE3   NEW_OCR_VOTE3   NORMAL<br></code></pre></td></tr></table></figure>
</li>
<li><p>Drop old disks</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> DISKGROUP OCR_VOTE <span class="hljs-keyword">DROP</span> DISK<br><span class="hljs-string">&#x27;OCR_VOTE1&#x27;</span>,<br><span class="hljs-string">&#x27;OCR_VOTE2&#x27;</span>,<br><span class="hljs-string">&#x27;OCR_VOTE3&#x27;</span><br>REBALANCE POWER <span class="hljs-number">8</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Check gv$asm_operation till it returns no rows</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> gv$asm_operation;<br> <span class="hljs-keyword">no</span> <span class="hljs-keyword">rows</span> selected<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> col path <span class="hljs-keyword">for</span> a20<br>col state <span class="hljs-keyword">for</span> a10<br>col failgroup <span class="hljs-keyword">for</span> a15<br>col name <span class="hljs-keyword">for</span> a15<br><span class="hljs-keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state<br> <span class="hljs-keyword">from</span> v$asm_diskgroup dg, v$asm_disk d<br> <span class="hljs-keyword">where</span> dg.group_number<span class="hljs-operator">=</span>d.group_number <span class="hljs-keyword">and</span> dg.name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;OCR_VOTE&#x27;</span><br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> dg.name,d.disk_number;<br><br>NAME            STATE      TYPE   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE<br><span class="hljs-comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span><br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">3</span> ORCL:NEW_OCR_VOTE1   CACHED  NEW_OCR_VOTE1   NEW_OCR_VOTE1   NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">4</span> ORCL:NEW_OCR_VOTE2   CACHED  NEW_OCR_VOTE2   NEW_OCR_VOTE2   NORMAL<br>OCR_VOTE        MOUNTED    EXTERN           <span class="hljs-number">5</span> ORCL:NEW_OCR_VOTE3   CACHED  NEW_OCR_VOTE3   NEW_OCR_VOTE3   NORMAL<br></code></pre></td></tr></table></figure>
</li>
<li><p>Delete old disks</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">oracleasm deletedisk OCR_VOTE1<br>oracleasm deletedisk OCR_VOTE2<br>oracleasm deletedisk OCR_VOTE3<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>voting</tag>
        <tag>swap</tag>
      </tags>
  </entry>
  <entry>
    <title>UDEV SCSI Rules</title>
    <url>/blog/posts/11781.html</url>
    <content><![CDATA[<h1 id="UDEV-SCSI-Rules-Configuration-In-Oracle-Linux-5-8"><a href="#UDEV-SCSI-Rules-Configuration-In-Oracle-Linux-5-8" class="headerlink" title="UDEV SCSI Rules Configuration In Oracle Linux 5-8"></a>UDEV SCSI Rules Configuration In Oracle Linux 5-8</h1><p>For Oracle Automatic Storage Manager (ASM) to use disks, it needs to be able to identify the devices consistently and for them to have the correct ownership and permissions. In Linux you can use ASMLib to manage these tasks, but it is seen as an additional layer of complexity and has never really gained any popularity. Instead, many people use the Linux device manager “udev” to perform these tasks. This article presents a brief overview of setting up udev rules with respect to disks for use with ASM in Oracle 11g. The examples are all done using Oracle Linux 5, 6, 7 and 8 so they will be consistent with RHEL and CentOS 5, 6, 7 and 8.</p>
<ul>
<li>Identify the Disks (&#x2F;sbin&#x2F;scsi_id)</li>
<li>Make SCSI Devices Trusted</li>
<li>Create UDEV Rules File</li>
<li>Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)</li>
<li>Test Rules (udevtest)</li>
<li>Restart UDEV Service</li>
<li>Check Ownership and Permissions</li>
</ul>
<h2 id="Identify-the-Disks-x2F-sbin-x2F-scsi-id"><a href="#Identify-the-Disks-x2F-sbin-x2F-scsi-id" class="headerlink" title="Identify the Disks (&#x2F;sbin&#x2F;scsi_id)"></a>Identify the Disks (&#x2F;sbin&#x2F;scsi_id)</h2><p>We are going to write device-specific rules, so we need to be able to identify each device consistently, irrespective of the order in which Linux discovers it.<br>To do this we are going to use the SCSI ID for each disk (not the partition), which we get using the scsi_id command. The “-s” option makes the paths relative to the “&#x2F;sys” directory. </p>
<p>For <strong>Oracle Linux 5</strong>, use the following command.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/scsi_id -g -u -s /block/sdb</span><br>SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_<br></code></pre></td></tr></table></figure>

<p>The “-s” is not available in <strong>Oracle Linux 6</strong>, so you must use the following syntax.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/scsi_id -g -u -d /dev/sdb</span><br>SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_<br></code></pre></td></tr></table></figure>

<p>The location of the scsi_id command has changed in <strong>Oracle Linux 7 and 8</strong>, so you must use the following syntax.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/usr/lib/udev/scsi_id -g -u -d /dev/sdb</span><br>SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_<br></code></pre></td></tr></table></figure>

<h2 id="Make-SCSI-Devices-Trusted"><a href="#Make-SCSI-Devices-Trusted" class="headerlink" title="Make SCSI Devices Trusted"></a>Make SCSI Devices Trusted</h2><p>Add the <code>options=-g</code> to the “&#x2F;etc&#x2F;scsi_id.config” file to configure SCSI devices as trusted. Create the file if it doesn’t already exist.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cat &gt;&gt; /etc/scsi_id.config &lt;&lt; EOF<br>options=-g<br>EOF<br></code></pre></td></tr></table></figure>

<h2 id="Create-UDEV-Rules-File"><a href="#Create-UDEV-Rules-File" class="headerlink" title="Create UDEV Rules File"></a>Create UDEV Rules File</h2><p>Create the “&#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;99-oracle-asmdevices.rules” file.<br>The file should contain the following lines for <strong>Oracle Linux 5</strong>. The PROGRAM parameter must match the command you used to retrieve the SCSI ID, and the RESULT parameter must match the value returned from your disks.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a b c<br><span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;KERNEL==\&quot;sd*\&quot;, BUS==\&quot;scsi\&quot;, PROGRAM==\&quot;/sbin/scsi_id -g -u -s /block/<span class="hljs-variable">$parent</span>&quot;</span>, RESULT==\&quot;`/sbin/scsi_id -g -u -s /block/sd<span class="hljs-variable">$i</span>`\&quot;, NAME=\&quot;asm-disk<span class="hljs-variable">$i</span>\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;<span class="hljs-string">&quot; &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules</span><br><span class="hljs-string">done</span><br><span class="hljs-string"></span><br><span class="hljs-string"># <span class="hljs-variable">$parent</span> is used if the device is partitioned, <span class="hljs-variable">$name</span> is used if the device is not partitioned.</span><br></code></pre></td></tr></table></figure>

<p>The equivalent for <strong>Oracle Linux 6</strong> is shown below.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a b c<br><span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;KERNEL==\&quot;sd*\&quot;, BUS==\&quot;scsi\&quot;, PROGRAM==\&quot;/sbin/scsi_id -g -u -d /dev/\$parent\&quot;, RESULT==\&quot;`/sbin/scsi_id -g -u -d /dev/sd<span class="hljs-variable">$i</span>`\&quot;, NAME=\&quot;asm-disk<span class="hljs-variable">$i</span>\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;&quot;</span> &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules<br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># $parent is used if the device is partitioned, $name is used if the device is not partitioned.</span><br></code></pre></td></tr></table></figure>

<p>The equivalent for <strong>Oracle Linux 7 and 8</strong> is shown below.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a b c<br><span class="hljs-keyword">do</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;KERNEL==\&quot;sd?1\&quot;, SUBSYSTEM==\&quot;block\&quot;, PROGRAM==\&quot;/usr/lib/udev/scsi_id -g -u -d /dev/\$parent\&quot;, RESULT==\&quot;`/usr/lib/udev/scsi_id -g -u -d /dev/sd<span class="hljs-variable">$i</span>`\&quot;, SYMLINK+=\&quot;asm-disk<span class="hljs-variable">$i</span>\&quot;, OWNER=\&quot;grid\&quot;, GROUP=\&quot;asmadmin\&quot;, MODE=\&quot;0660\&quot;&quot;</span> &gt;&gt; /etc/udev/rules.d/99-oracle-asmdevices.rules<br><span class="hljs-keyword">done</span><br><br><span class="hljs-comment"># $parent is used if the device is partitioned, $name is used if the device is not partitioned.</span><br></code></pre></td></tr></table></figure>

<h2 id="Load-Updated-Block-Device-Partitions-x2F-sbin-x2F-partprobe"><a href="#Load-Updated-Block-Device-Partitions-x2F-sbin-x2F-partprobe" class="headerlink" title="Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)"></a>Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)</h2><p>Load updated block device partition tables.<br>For OL5, OL6 and OL7</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/partprobe /dev/sdb1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/partprobe /dev/sdc1</span><br></code></pre></td></tr></table></figure>

<p>For OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/partx -u /dev/sbc1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/partx -u /dev/sdc1</span><br></code></pre></td></tr></table></figure>

<h2 id="Test-Rules-udevtest"><a href="#Test-Rules-udevtest" class="headerlink" title="Test Rules (udevtest)"></a>Test Rules (udevtest)</h2><p>Test the rules are working as expected.<br>For OL5</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">udevtest /block/sdb/sdb1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">udevtest /block/sdc/sdc1</span><br></code></pre></td></tr></table></figure>

<p>For OL6, OL7 and OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">udevadm <span class="hljs-built_in">test</span> /block/sdb/sdb1</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">udevadm <span class="hljs-built_in">test</span> /block/sdc/sdc1</span><br></code></pre></td></tr></table></figure>

<p>The output from the first disk should look something like this.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">udevtest /block/sdb/sdb1</span><br>main: looking at device &#x27;/block/sdb/sdb1&#x27; from subsystem &#x27;block&#x27;<br>udev_rules_get_name: add symlink &#x27;disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1&#x27;<br>udev_rules_get_name: add symlink &#x27;disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1&#x27;<br>run_program: &#x27;/lib/udev/vol_id --export /dev/.tmp-8-17&#x27;<br>run_program: &#x27;/lib/udev/vol_id&#x27; returned with status 4<br>run_program: &#x27;/sbin/scsi_id -g -u -s /block/sdb/sdb1&#x27;<br>run_program: &#x27;/sbin/scsi_id&#x27; (stdout) &#x27;SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_&#x27;<br>run_program: &#x27;/sbin/scsi_id&#x27; returned with status 0<br>udev_rules_get_name: rule applied, &#x27;sdb1&#x27; becomes &#x27;asm-disk1&#x27;<br>udev_device_event: device &#x27;/block/sdb/sdb1&#x27; already in database, validate currently present symlinks<br>udev_node_add: creating device node &#x27;/dev/asm-disk1&#x27;, major = &#x27;8&#x27;, minor = &#x27;17&#x27;, mode = &#x27;0660&#x27;, uid = &#x27;1100&#x27;, gid = &#x27;1200&#x27;<br>udev_node_add: creating symlink &#x27;/dev/disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1&#x27; to &#x27;../../asm-disk1&#x27;<br>udev_node_add: creating symlink &#x27;/dev/disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1&#x27; to &#x27;../../asm-disk1&#x27;<br>main: run: &#x27;socket:/org/kernel/dm/multipath_event&#x27;<br>main: run: &#x27;socket:/org/kernel/udev/monitor&#x27;<br>main: run: &#x27;/lib/udev/udev_run_devd&#x27;<br>main: run: &#x27;socket:/org/freedesktop/hal/udev_event&#x27;<br>main: run: &#x27;/sbin/pam_console_apply /dev/asm-disk1 /dev/disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1 /dev/disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1&#x27;<br></code></pre></td></tr></table></figure>

<h2 id="Restart-UDEV-Service"><a href="#Restart-UDEV-Service" class="headerlink" title="Restart UDEV Service"></a>Restart UDEV Service</h2><p>Restart the UDEV service.<br>For OL5</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/udevcontrol reload_rules</span><br></code></pre></td></tr></table></figure>

<p>For OL5 and OL6 : Not needed for OL7 and OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/start_udev</span><br></code></pre></td></tr></table></figure>

<p>For OL6, OL7 and OL8</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/udevadm control --reload-rules</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">/sbin/udevadm trigger</span><br></code></pre></td></tr></table></figure>

<h2 id="Check-Ownership-and-Permissions"><a href="#Check-Ownership-and-Permissions" class="headerlink" title="Check Ownership and Permissions"></a>Check Ownership and Permissions</h2><p>Check the disks are now available with the “asm-disk*” alias and the correct ownership and permissions.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">ls</span> -al /dev/asm-disk*</span><br>brw-rw---- 1 oracle dba 8, 17 Apr 8 22:47 asm-disk1<br>brw-rw---- 1 oracle dba 8, 33 Apr 8 22:47 asm-disk2<br>brw-rw---- 1 oracle dba 8, 49 Apr 8 22:47 asm-disk3<br>brw-rw---- 1 oracle dba 8, 65 Apr 8 22:47 asm-disk4<br></code></pre></td></tr></table></figure>

<p>So the ASM_DISKSTRING initialization parameter in the ASM instance can be set to ‘&#x2F;dev&#x2F;asm-disk*’ to identify the ASM disks.</p>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>udev</tag>
      </tags>
  </entry>
  <entry>
    <title>PreCheck</title>
    <url>/blog/posts/24958.html</url>
    <content><![CDATA[<h4 id="PreCheck"><a href="#PreCheck" class="headerlink" title="PreCheck"></a>PreCheck</h4><ol>
<li><p>System info</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 系统版本</span><br><span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">cat</span> /etc/os-release<br><br><span class="hljs-comment"># ASM磁盘创建方式：udev or asmlib</span><br><span class="hljs-comment"># udev:</span><br><span class="hljs-built_in">cat</span> /etc/udev/rules.d/99-oracle-asmdevices.rules<br><br><span class="hljs-comment"># asmlib:</span><br><span class="hljs-built_in">cat</span> /etc/sysconfig/oracleasm<br>/etc/init.d/oracleasm listdisks<br></code></pre></td></tr></table></figure>
</li>
<li><p>GI info</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># grid用户查询，群集资源状态，版本，ocr信息，votedisk信息</span><br>crsctl <span class="hljs-built_in">stat</span> res -t<br>asmcmd lsdg<br>ocrcheck<br>crsctl query crs activeversion<br>crsctl query css votedisk<br></code></pre></td></tr></table></figure>
</li>
<li><p>ASM DiskGroup info</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 数据库版本</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> v$version;<br><br><span class="hljs-comment">-- 磁盘组信息</span><br><span class="hljs-keyword">set</span> lines <span class="hljs-number">200</span> pages <span class="hljs-number">100</span><br><span class="hljs-keyword">select</span> d.name group_name,f.type,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) cnt <span class="hljs-keyword">from</span> v$asm_file f <br> <span class="hljs-keyword">join</span> v$asm_diskgroup d <span class="hljs-keyword">on</span> f.group_number<span class="hljs-operator">=</span>d.group_number <br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">rollup</span> (d.name,f.type);<br><br><span class="hljs-comment">-- 磁盘组成员，故障组</span><br>col path <span class="hljs-keyword">for</span> a20<br>col state <span class="hljs-keyword">for</span> a10<br>col failgroup <span class="hljs-keyword">for</span> a15<br>col name <span class="hljs-keyword">for</span> a20<br><span class="hljs-keyword">select</span> dg.name,dg.state,dg.type,d.disk_number,d.path,d.mount_status,d.failgroup,d.name,d.state <br> <span class="hljs-keyword">from</span> v$asm_diskgroup dg, v$asm_disk d<br> <span class="hljs-keyword">where</span> dg.group_number<span class="hljs-operator">=</span>d.group_number<br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> dg.name,d.disk_number;<br><br><span class="hljs-comment">-- 磁盘组兼容版本</span><br>col COMPATIBILITY form a10<br>col DATABASE_COMPATIBILITY form a10<br>col NAME form a20<br><span class="hljs-keyword">select</span> group_number, name, compatibility, database_compatibility <span class="hljs-keyword">from</span> v$asm_diskgroup;<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>precheck</tag>
      </tags>
  </entry>
  <entry>
    <title>Overview</title>
    <url>/blog/posts/27587.html</url>
    <content><![CDATA[<h4 id="Change-ASM-DiskGroup-compatibility"><a href="#Change-ASM-DiskGroup-compatibility" class="headerlink" title="Change ASM DiskGroup compatibility"></a>Change ASM DiskGroup compatibility</h4><figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> diskgroup dg2 <span class="hljs-keyword">set</span> attribute <span class="hljs-string">&#x27;compatible.asm&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;11.1&#x27;</span>;<br><span class="hljs-keyword">alter</span> diskgroup dg2 <span class="hljs-keyword">set</span> attribute <span class="hljs-string">&#x27;compatible.rdbms&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;11.1&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="REDUNDANCY"><a href="#REDUNDANCY" class="headerlink" title="REDUNDANCY"></a>REDUNDANCY</h4><p>指的是一个diskgroup内同一份数据的保护级别，通过failgroup的冗余来保证数据的冗余，有三个取值，external，normal，high。</p>
<h4 id="FAILGROUP"><a href="#FAILGROUP" class="headerlink" title="FAILGROUP"></a>FAILGROUP</h4><p>一个或多个磁盘构成的整体，它是磁盘组的一部分，Oracle保证每一个extent和它对应的镜像不会保存在相同的failure group中，从而确保了当Failure group中的某一个或多个磁盘，甚至整个failure group全部丢失时也不会有数据丢失，并实现了数据的镜像。如果在创建磁盘组时指定了failure group，数据就以AU为单位在failure group之间实现镜像，如果创建磁盘组时没有指定failure group，那么每一块磁盘就作为一个failure group，以AU为单位对数据进行镜像。</p>
<blockquote>
<p><strong>external redundancy</strong><br>冗余级别为external时，ASM不保证数据的冗余，完全依赖于存储的冗余，不能指定failgroup，但是默认会为每一个disk分配一个failgroup，同一份数据只能存在一个failgroup中。<br><strong>normal redundancy</strong><br>冗余级别为normal时，ASM要求至少2个failgroup，可以大于2个，每一份数据会存储两份，分别位于两个不同的failgroup中<br><strong>high redundancy</strong><br>冗余级别为high时，ASM要求至少3个failgroup，可以大于3个，每一份数据会存储三份，分别位于三个不同的failgroup中</p>
</blockquote>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>overview</tag>
      </tags>
  </entry>
  <entry>
    <title>ArchiveLog Mode</title>
    <url>/blog/posts/44140.html</url>
    <content><![CDATA[<h1 id="Enabling-ArchiveLog-Mode"><a href="#Enabling-ArchiveLog-Mode" class="headerlink" title="Enabling ArchiveLog Mode"></a>Enabling ArchiveLog Mode</h1><h2 id="Single-Instance"><a href="#Single-Instance" class="headerlink" title="Single Instance"></a>Single Instance</h2><p><strong>Oracle 10g and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL> ":1-6)</span></figcaption><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">set</span> log_archive_dest_1<span class="hljs-operator">=</span><span class="hljs-string">&#x27;location=/archivelog&#x27;</span> <span class="hljs-keyword">scope</span><span class="hljs-operator">=</span>spfile;<br>shutdown immediate<br>startup mount<br><span class="hljs-keyword">alter</span> database archivelog;<br><span class="hljs-keyword">alter</span> database <span class="hljs-keyword">open</span>;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> switch logfile;  <span class="hljs-comment">-- 切换归档</span><br></code></pre></td></tr></table></figure>

<h2 id="Real-Application-Clusters"><a href="#Real-Application-Clusters" class="headerlink" title="Real Application Clusters"></a>Real Application Clusters</h2><p><strong>Oracle 10gR2 and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL> ":1,4-5,7||"[grid@rac1 ~]$ ":2-3,6)</span></figcaption><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">set</span> log_archive_dest_1<span class="hljs-operator">=</span><span class="hljs-string">&#x27;location=+ARCHDG&#x27;</span> sid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;*&#x27;</span> <span class="hljs-keyword">scope</span><span class="hljs-operator">=</span>spfile;<br>srvctl stop database <span class="hljs-operator">-</span>d coco<br>srvctl <span class="hljs-keyword">start</span> instance <span class="hljs-operator">-</span>d coco <span class="hljs-operator">-</span>i coco1 <span class="hljs-operator">-</span>o mount<br><span class="hljs-keyword">alter</span> database archivelog;<br><span class="hljs-keyword">alter</span> database <span class="hljs-keyword">open</span>;<br>srvctl <span class="hljs-keyword">start</span> database <span class="hljs-operator">-</span>d coco<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> archive log <span class="hljs-keyword">current</span>;  <span class="hljs-comment">-- 切换归档</span><br></code></pre></td></tr></table></figure>

<h1 id="Disabling-ArchiveLog-Mode"><a href="#Disabling-ArchiveLog-Mode" class="headerlink" title="Disabling ArchiveLog Mode"></a>Disabling ArchiveLog Mode</h1><h2 id="Single-Instance-1"><a href="#Single-Instance-1" class="headerlink" title="Single Instance"></a>Single Instance</h2><p><strong>Oracle 10g and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL> ":1-4)</span></figcaption><table><tr><td class="code"><pre><code class="hljs sql">shutdown immediate<br>startup mount<br><span class="hljs-keyword">alter</span> database noarchivelog;<br><span class="hljs-keyword">alter</span> database <span class="hljs-keyword">open</span>;<br></code></pre></td></tr></table></figure>

<h2 id="Real-Application-Clusters-1"><a href="#Real-Application-Clusters-1" class="headerlink" title="Real Application Clusters"></a>Real Application Clusters</h2><p><strong>Oracle 10gR2 and Latest</strong></p>
<figure class="highlight sql"><figcaption><span>command:("SQL> ":3-4||"[grid@rac1 ~]$ ":1-2,5)</span></figcaption><table><tr><td class="code"><pre><code class="hljs sql">srvctl stop database <span class="hljs-operator">-</span>d coco<br>srvctl <span class="hljs-keyword">start</span> instance <span class="hljs-operator">-</span>d coco <span class="hljs-operator">-</span>i coco1 <span class="hljs-operator">-</span>o mount<br><span class="hljs-keyword">alter</span> database noarchivelog;<br><span class="hljs-keyword">alter</span> database <span class="hljs-keyword">open</span>;<br>srvctl <span class="hljs-keyword">start</span> database <span class="hljs-operator">-</span>d coco<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>archivelog</tag>
      </tags>
  </entry>
  <entry>
    <title>Automatic Optimizer Statistics Collection</title>
    <url>/blog/posts/44054.html</url>
    <content><![CDATA[<h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>   在Oracle 10g之前并没有自动收集统计信息的机制，从Oracle 10g开始引入了自动收集统计信息的功能，这个功能在Oracle 10g中被称为自动统计信息收集（Automatic Statistics Gathering）<br>   在Oracle 11g中被称为自动优化器统计信息收集（Automatic Optimizer Statistics Collection）。自动统计信息收集作业能够每天收集普通对象和数据字典的统计信息，但不会收集X$系列表的内部对象统计信息。</p>
<p>  Oracle的初始化参数STATISTICS_LEVEL控制收集统计信息的级别，有三个参数值：<br>  1、 BASIC：收集基本的统计信息<br>  2、 TYPICAL：收集大部分统计信息（数据库的默认设置）<br>  3、 ALL：收集全部统计信息<br>  当使用Oracle自动收集统计信息时，必须要确保Oracle的参数STATISTICS_LEVEL的值为TYPICAL或者ALL。默认值为TYPICAL，该值可以确保数据库自我管理功能所需求的所有主要统计信息的正确收集，及提供最好的综合性能。这个默认值可以能胜任大多数的环境，并且Oracle不推荐去修改该值。</p>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>statistics</tag>
      </tags>
  </entry>
  <entry>
    <title>Index</title>
    <url>/blog/posts/35755.html</url>
    <content><![CDATA[<p><img src="https://images.cnblogs.com/cnblogs_com/liuning8023/201211/201211172345262843.jpg"></p>
<p>访问索引列的数据一般需要3次IO，Root-Branch-Leaf。<br>访问索引列外的数据需要4次IO，Root-Branch-Leaf-回表(TABLE ACCESS BY INDEX ROWID)。<br>索引对DML操作的影响，INSERT &gt; DELETE &gt; UPDATE</p>
<p>[创建索引会引发排序及全表索，排序会非常消耗CPU性能，全表锁会阻止DML操作]{.red}</p>
<p><strong>索引的三大特点</strong></p>
<ul>
<li>索引树的高度一般比较低。</li>
<li>索引由索引列存储的值及ROWID组成。</li>
<li>索引本身是有序的。</li>
</ul>
<p><strong>分区表索引</strong></p>
<ul>
<li>分为全局索引和分区索引。</li>
<li>分区索引，要有使用分区字段条件的场景，否则建议使用全局索引。</li>
</ul>
<p><strong>count(*)优化</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--NULL和NOT NULL不等价，排除NULL值，执行计划由TABLE ACCESS FULL变为INDEX FAST FULL SCAN</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><br><span class="hljs-comment">--或将列设置NOT NULL，执行计划为INDEX FAST FULL SCAN</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t modify id <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> t;<br></code></pre></td></tr></table></figure>

<p><strong>MAX&#x2F;MIN优化</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--NULL和NOT NULL等价，执行计划为INDEX FULL SCAN (MIN/MAX)，MIN一定位于左边的叶子块，MAX一定位于最右边的叶子块</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) <span class="hljs-keyword">from</span> t;<br><br><span class="hljs-comment">--Oracle无法同时在左边和最右边读取，执行计划为TABLE ACCESS FULL</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id),<span class="hljs-built_in">min</span>(id) <span class="hljs-keyword">from</span> t;<br><br><span class="hljs-comment">--分开查询，执行计划为INDEX FULL SCAN (MIN/MAX)</span><br><span class="hljs-keyword">select</span> min,max <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> mix(id) min <span class="hljs-keyword">from</span> t) a, (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) max <span class="hljs-keyword">from</span> t) b;<br></code></pre></td></tr></table></figure>

<p><strong>回表优化</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--查看索引列以外的数据，会出现回表，执行计划TABLE ACCESS BY INDEX ROWID</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure>

<p><strong>索引全扫与索引快速全扫</strong></p>
<ul>
<li>INDEX FAST FULL SCAN 一次读取多个索引块，INDEX FULL SCAN 一次只读取一个索引块。</li>
<li>INDEX FAST FULL SCAN 一次读取多个索引块不容易保持有序，而 INDEX FULL SCAN 一次读取一个索引块可以保持有序，因此在有排序的场合，INDEX FULL SCAN 的顺序读可以消除排序，INDEX FAST FULL SCAN 虽然减少了逻辑读，但是无法消除排序。</li>
</ul>
<p><strong>UNION合并优化</strong></p>
<p>UNION 合并会去除重复记录，UNION ALL 则是简单的合并，在 UNION 中索引一般无法消除排序，最常见的优化是将 UNION 改为 UNION ALL。</p>
<p><strong>联合索引</strong></p>
<p>联合索引不宜超过3个字段，否则不仅影响定位数据，更严重影响更新性能。可以用类似如下方式测试联合字段返回的记录是否比单个字段记录少得多。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> a<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> b<span class="hljs-operator">=</span><span class="hljs-number">2</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> a<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> b<span class="hljs-operator">=</span><span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>在两列都是等值查询的情况下，组合索引的列无论哪一列在前，性能都一样;</p>
<p>在一列是范围查询，一列是等值查询的情况下，等值查询列在前，范围查询列在后，这样索引才最高效；</p>
<p>单列的查询列和联合索引的前置列一样，那单列可以不建索引，直接利用联合索引来进行检索数据。</p>
</blockquote>
<p><strong>位图索引</strong></p>
<p>位图索引的适用场景要满足两个条件：一，位图索引列大量重复；二，该表极少更新。</p>
<p><strong>函数索引</strong></p>
<p>对索引列进行运算会导致索引无法使用，在无法避免列运算时，可以创建函数索引加以优化。</p>
<h4 id="分析是否需要重建索引"><a href="#分析是否需要重建索引" class="headerlink" title="分析是否需要重建索引"></a>分析是否需要重建索引</h4><p>分析索引的数据块是否有坏块，以及根据分析得到的数据（存放在index_stats）來判断索引是否需要重新建立。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> analyze index AATD_IDX1 validate structure; <br></code></pre></td></tr></table></figure>

<blockquote>
<p>validate structure有两种模式：<br>online ：（默认）会对表加一个4级別的锁（表共享），对run系統可能造成一定的影响。<br>offline ：没有表lock的影响，但当以online模式分析时， 在视图index_stats没有统计信息。</p>
</blockquote>
<p>从9i开始，Oracle以建议使用dbms_stats package代替 analyze 了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">exec</span> dbms_stats.gather_table_stats(‘用户名’,‘表名’,cascade<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure>

<p>下面视图只支持：analyze index 命令</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> height,DEL_LF_ROWS<span class="hljs-operator">/</span>LF_ROWS <span class="hljs-keyword">from</span> index_stats;<br>HEIGHT DEL_LF_ROWS<span class="hljs-operator">/</span>LF_ROWS<br><span class="hljs-comment">---------- -------------------</span><br>    <span class="hljs-number">1</span>                   <span class="hljs-number">0</span><br>Executed <span class="hljs-keyword">in</span> <span class="hljs-number">0.381</span> seconds<br></code></pre></td></tr></table></figure>

<p>当查询出来的 height&gt;&#x3D;4，或者 DEL_LF_ROWS&#x2F;LF_ROWS&gt;0.2 的场合,该索引考虑重建。</p>
<h4 id="重建索引"><a href="#重建索引" class="headerlink" title="重建索引"></a>重建索引</h4><ol>
<li><p>删除创建索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> index idx_id_t1;<br><span class="hljs-keyword">create</span> index idx_id_t1 <span class="hljs-keyword">on</span> t1(id);<br></code></pre></td></tr></table></figure>

<p>说明：此方式耗时间，无法在24*7环境中实现，不建议使用。</p>
</li>
<li><p>重建索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> index idx_id_t1 rebuild;<br><span class="hljs-keyword">alter</span> index idx_id_t1 rebuild online;<br></code></pre></td></tr></table></figure>

<p>说明：此方式比较快，可以在24*7环境中实现，建议使用此方式。</p>
<blockquote>
<p>rebuild 与 rebuild online 的区别</p>
<ol>
<li><p>rebuild 根据统计信息的cost采用 index fast full scan 或者 table full scan 方式读取原索引中的数据来构建一个新的索引，有排序的操作; rebuild online 执行表扫描获取数据，有排序的操作。</p>
</li>
<li><p>rebuild 会阻塞 dml 操作，rebuild online 不会阻塞 dml 操作。rebuild online 时系统会产生一个 SYS_JOURNAL_xxx 的 IOT 类型的系统临时日志表,所有 rebuild online 时索引的变化都记录在这个表中，当新的索引创建完成后，把这个表的记录维护到新的索引中去，然后 drop 掉旧的索引，rebuild online 就完成了。</p>
</li>
</ol>
</blockquote>
</li>
</ol>
<p>注意点：</p>
<ol>
<li>执行rebuild操作时，需要检查表空间是否足够</li>
<li>虽然说rebuild online操作允许dml操作，但是还是建议在业务不繁忙时间段进行rebuild操作会产生大量redo log</li>
</ol>
<h4 id="重建分区索引"><a href="#重建分区索引" class="headerlink" title="重建分区索引"></a>重建分区索引</h4><ol>
<li>重建分区表上的分区索引:</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> index indexname rebuild <span class="hljs-keyword">partition</span> PARTITION_NAME tablespace tablespacename;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;alter index &#x27;</span><span class="hljs-operator">||</span> index_name <span class="hljs-operator">||</span> <span class="hljs-string">&#x27; rebuild partition &#x27;</span><span class="hljs-operator">||</span> partition_name <span class="hljs-operator">||</span> <span class="hljs-string">&#x27; online;&#x27;</span> <span class="hljs-keyword">from</span> user_ind_partitions <span class="hljs-keyword">where</span> index_name <span class="hljs-operator">=</span><span class="hljs-string">&#x27;索引&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>子分区索引重建：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> index indexname rebuild subpartition PARTITION_NAME tablespace tablespacename;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;alter index &#x27;</span><span class="hljs-operator">||</span> index_name <span class="hljs-operator">||</span> <span class="hljs-string">&#x27; rebuild subpartition &#x27;</span><span class="hljs-operator">||</span> subpartition_name <span class="hljs-operator">||</span> <span class="hljs-string">&#x27; online;&#x27;</span> <span class="hljs-keyword">from</span> user_ind_subpartitions;<br></code></pre></td></tr></table></figure>

<p>注：这里的PARTITION_NAME指USER_IND_PARTITIONS中的PARTITION_NAME(索引分区中的索引分区名)</p>
<ol start="3">
<li>查询分区表索引所在的分区</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> PI.TABLE_NAME,<br>IP.INDEX_NAME,<br>IP.PARTITION_NAME,<br>IP.STATUS,<br>IP.GLOBAL_STATS<br><span class="hljs-keyword">FROM</span> USER_PART_INDEXES PI, USER_IND_PARTITIONS IP<br><span class="hljs-keyword">WHERE</span> PI.INDEX_NAME <span class="hljs-operator">=</span> IP.INDEX_NAME <span class="hljs-keyword">AND</span> PI.TABLE_NAME <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;表名&#x27;</span>;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>index</tag>
      </tags>
  </entry>
  <entry>
    <title>Job Schedule</title>
    <url>/blog/posts/35165.html</url>
    <content><![CDATA[<ol>
<li><p>运行job</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span><br>  DBMS_JOB.RUN(<span class="hljs-number">43</span>); <span class="hljs-comment">/* job id */</span><br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>禁用&#x2F;启用job</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span><br>  dbms_job.broken(<span class="hljs-number">43</span>,<span class="hljs-literal">true</span>);<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br><br><span class="hljs-keyword">begin</span><br>  dbms_job.broken(<span class="hljs-number">43</span>,<span class="hljs-literal">false</span>);<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>删除job</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span><br>  dbms_job.remove(<span class="hljs-number">43</span>);<br><span class="hljs-keyword">end</span>;<br><span class="hljs-operator">/</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>job</tag>
      </tags>
  </entry>
  <entry>
    <title>Table</title>
    <url>/blog/posts/50530.html</url>
    <content><![CDATA[<p><strong>DBA_TABLES &gt;&#x3D; ALL_TABLES &gt;&#x3D; USER_TABLES</strong></p>
<ul>
<li>DBA_TABLES：DBA拥有的或者可以访问的所有关系表</li>
<li>ALL_TABLES：某一用户所拥有的或者可以访问的所有关系表</li>
<li>USER_TABLES：某一用户所拥有的所有关系表</li>
</ul>
<p>查看表属于哪个用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> owner <span class="hljs-keyword">from</span> dba_tables <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-built_in">upper</span>(<span class="hljs-string">&#x27;table_name&#x27;</span>);<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>table</tag>
      </tags>
  </entry>
  <entry>
    <title>Password Expired Limited</title>
    <url>/blog/posts/53381.html</url>
    <content><![CDATA[<h1 id="Oracle密码过期，取消密码180天限制"><a href="#Oracle密码过期，取消密码180天限制" class="headerlink" title="Oracle密码过期，取消密码180天限制"></a>Oracle密码过期，取消密码180天限制</h1><ol>
<li>查看用户的profile</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> username, profile <span class="hljs-keyword">FROM</span> dba_users <span class="hljs-keyword">WHERE</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;EXFSYS&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>查看profile的密码有效期设置</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> dba_profiles s <span class="hljs-keyword">WHERE</span> s.profile<span class="hljs-operator">=</span><span class="hljs-string">&#x27;DEFAULT&#x27;</span> <span class="hljs-keyword">AND</span> resource_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;PASSWORD%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>将密码有效期由默认的180天修改成“无限制”，修改之后不需要重启动数据库，会立即生效</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> PROFILE <span class="hljs-keyword">DEFAULT</span> LIMIT PASSWORD_LIFE_TIME UNLIMITED;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>用户再改一次密码</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> exfsys identified <span class="hljs-keyword">by</span> abc123;<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>用户解锁</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> exfsys account unlock;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>user_privs</title>
    <url>/blog/posts/39958.html</url>
    <content><![CDATA[<h1 id="user-privs"><a href="#user-privs" class="headerlink" title="user_privs"></a>user_privs</h1><figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询系统权限，角色</span><br><span class="hljs-keyword">select</span> grantee,privilege <span class="hljs-keyword">as</span> privs_or_roles,admin_option <span class="hljs-keyword">from</span> dba_sys_privs <span class="hljs-keyword">where</span> grantee<span class="hljs-operator">=</span><span class="hljs-string">&#x27;JOVE&#x27;</span><br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> grantee,granted_role,admin_option <span class="hljs-keyword">from</span> dba_role_privs <span class="hljs-keyword">where</span> grantee<span class="hljs-operator">=</span><span class="hljs-string">&#x27;JOVE&#x27;</span>;<br><br><span class="hljs-comment">-- 查询对象权限</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dba_tab_privs <span class="hljs-keyword">where</span> grantee<span class="hljs-operator">=</span><span class="hljs-string">&#x27;JOVE&#x27;</span>;<br><br><span class="hljs-comment">-- 查询角色 / 角色权限</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dba_roles;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role_sys_privs <span class="hljs-keyword">where</span> role<span class="hljs-operator">=</span><span class="hljs-string">&#x27;DBA&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> role_tab_privs <span class="hljs-keyword">where</span> role<span class="hljs-operator">=</span><span class="hljs-string">&#x27;DBA&#x27;</span>;<br><br><span class="hljs-comment">-- 数据库提供的系统权限 / 对象权限</span><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> sys.system_privilege_map;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> table_privilege_map;<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>privs</tag>
      </tags>
  </entry>
  <entry>
    <title>Exadata Virtual Machine</title>
    <url>/blog/posts/31100.html</url>
    <content><![CDATA[<h4 id="Cell-Node"><a href="#Cell-Node" class="headerlink" title="Cell Node:"></a>Cell Node:</h4><ol>
<li><p>软件包下载</p>
<p>可到 <a href="https://edelivery.oracle.com/">https://edelivery.oracle.com/</a> 下载 V46145-01.zip，V27570-01.zip。<br>V46145-01.zip 为 Exadata Cell 11.2.3.2 介质；<br>V27570-01.zip 为 OracleLinux-R5-U7-Server-x86_64-dvd.iso；<br>Oracle安装包：p10404530_112030_Linux-x86-64_1of7.zip; p10404530_112030_Linux-x86-64_2of7.zip<br>Grid安装包：p10404530_112030_Linux-x86-64_3of7.zip</p>
</li>
<li><p>配置hosts，修改启动内核</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.184.160 db01.localdomain db01&quot;</span> &gt;&gt; /etc/hosts<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.184.160 cell01.localdomain cell01&quot;</span> &gt;&gt; /etc/hosts<br><br>sed -i <span class="hljs-string">&#x27;s/^default.*/default=1/&#x27;</span> /etc/grub.conf<br><br>reboot<br></code></pre></td></tr></table></figure>
</li>
<li><p>修改资源限制</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;fs.file-max = 65536&quot;</span> &gt;&gt; /etc/sysctl.conf<br>sysctl -p<br><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">* soft nofile 65536</span><br><span class="hljs-string">* hard nofile 65536</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>安装oracle-vaildated</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">yum install -y oracle-validated<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建日志文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /var/log/oracle<br><span class="hljs-built_in">chmod</span> -R 775 /var/log/oracle<br></code></pre></td></tr></table></figure>
</li>
<li><p>安装Cell软件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">unzip V46145-01.zip<br>tar -xvf cellImageMaker_11.2.3.3.1_LINUX.X64_140708-1.x86_64.tar<br><span class="hljs-built_in">cd</span> dl180/boot/cellbits<br>unzip cell.bin<br>tar -xvf cellrpms.tbz jdk-1.7.0_55-fcs.x86_64.rpm<br>rpm -ivh jdk-1.7.0_55-fcs.x86_64.rpm<br>rpm -ivh cell-11.2.3.3.1_LINUX.X64_140708-1.x86_64.rpm<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建虚拟磁盘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; disk.sh &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk01 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk02 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk03 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk04 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk05 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk06 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk07 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk08 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk09 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk10 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk11 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk12 bs=1M count=5120</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH01 bs=1M count=1024</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH02 bs=1M count=1024</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH03 bs=1M count=1024</span><br><span class="hljs-string">dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH04 bs=1M count=1024</span><br><span class="hljs-string">EOF</span><br><br>sh disk.sh<br><span class="hljs-built_in">chmod</span> 660 /opt/oracle/cell/disks/raw/*<br></code></pre></td></tr></table></figure>
</li>
<li><p>启动cell服务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">su - celladmin<br><br>cellcli -e create cell cell01 interconnect1=eth0<br>cellcli -e alter cell restart services all<br></code></pre></td></tr></table></figure>
</li>
<li><p>创建磁盘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">cellcli -e create celldisk all<br>cellcli -e create flashcache all size=2G<br>cellcli -e create flashlog all<br>cellcli -e create griddisk all harddisk prefix=data,size=4G<br>cellcli -e create griddisk all harddisk prefix=reco<br>cellcli -e list griddisk<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="DB-Node"><a href="#DB-Node" class="headerlink" title="DB Node:"></a>DB Node:</h4><ol>
<li><p>创建Exadata配置文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /etc/oracle/cell/network-config<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ipaddress1=192.168.184.160/24&quot;</span> &gt; /etc/oracle/cell/network-config/cellinit.ora<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cell=\&quot;192.168.184.170\&quot;&quot;</span> &gt; /etc/oracle/cell/network-config/cellip.ora<br><span class="hljs-built_in">chown</span> -R grid:oinstall /etc/oracle/cell/network-config<br><span class="hljs-built_in">chmod</span> -R 775 /etc/oracle/cell/network-config<br></code></pre></td></tr></table></figure>
</li>
<li><p>安装完Grid后，创建磁盘组</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DISKGROUP DATA NORMAL REDUNDANCY<br>FAILGROUP CELL01_DATA_F1 DISK<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk01_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk02_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk03_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk04_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk05_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk06_cell01&#x27;</span><br>FAILGROUP CELL01_DATA_F2 DISK<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk07_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk08_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk09_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk10_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk11_cell01&#x27;</span>,<br><span class="hljs-string">&#x27;o/192.168.184.170/data_CD_disk12_cell01&#x27;</span><br>ATTRIBUTE <span class="hljs-string">&#x27;compatible.asm&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;11.2.0.0.0&#x27;</span>,<span class="hljs-string">&#x27;compatible.rdbms&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;11.1.0.7.0&#x27;</span>,<span class="hljs-string">&#x27;au_size&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;4M&#x27;</span>,<span class="hljs-string">&#x27;cell.smart_scan_capable&#x27;</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;TRUE&#x27;</span>;<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Exadata</category>
      </categories>
      <tags>
        <tag>exadata</tag>
      </tags>
  </entry>
  <entry>
    <title>endian_format</title>
    <url>/blog/posts/48175.html</url>
    <content><![CDATA[<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> v$transportable_platform <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> platform_id;<br><br>PLATFORM_ID PLATFORM_NAME                            ENDIAN_FORMAT<br><span class="hljs-comment">----------- ---------------------------------------- --------------</span><br>          <span class="hljs-number">1</span> Solaris[tm] OE (<span class="hljs-number">32</span><span class="hljs-operator">-</span>bit)                  Big<br>          <span class="hljs-number">2</span> Solaris[tm] OE (<span class="hljs-number">64</span><span class="hljs-operator">-</span>bit)                  Big<br>          <span class="hljs-number">3</span> HP<span class="hljs-operator">-</span>UX (<span class="hljs-number">64</span><span class="hljs-operator">-</span>bit)                           Big<br>          <span class="hljs-number">4</span> HP<span class="hljs-operator">-</span>UX IA (<span class="hljs-number">64</span><span class="hljs-operator">-</span>bit)                        Big<br>          <span class="hljs-number">5</span> HP Tru64 UNIX                            Little<br>          <span class="hljs-number">6</span> AIX<span class="hljs-operator">-</span>Based Systems (<span class="hljs-number">64</span><span class="hljs-operator">-</span>bit)               Big<br>          <span class="hljs-number">7</span> Microsoft Windows IA (<span class="hljs-number">32</span><span class="hljs-operator">-</span>bit)            Little<br>          <span class="hljs-number">8</span> Microsoft Windows IA (<span class="hljs-number">64</span><span class="hljs-operator">-</span>bit)            Little<br>          <span class="hljs-number">9</span> IBM zSeries Based Linux                  Big<br>         <span class="hljs-number">10</span> Linux IA (<span class="hljs-number">32</span><span class="hljs-operator">-</span>bit)                        Little<br>         <span class="hljs-number">11</span> Linux IA (<span class="hljs-number">64</span><span class="hljs-operator">-</span>bit)                        Little<br>         <span class="hljs-number">12</span> Microsoft Windows x86 <span class="hljs-number">64</span><span class="hljs-operator">-</span>bit             Little<br>         <span class="hljs-number">13</span> Linux x86 <span class="hljs-number">64</span><span class="hljs-operator">-</span>bit                         Little<br>         <span class="hljs-number">15</span> HP <span class="hljs-keyword">Open</span> VMS                              Little<br>         <span class="hljs-number">16</span> Apple Mac OS                             Big<br>         <span class="hljs-number">17</span> Solaris Operating <span class="hljs-keyword">System</span> (x86)           Little<br>         <span class="hljs-number">18</span> IBM Power Based Linux                    Big<br>         <span class="hljs-number">19</span> HP IA <span class="hljs-keyword">Open</span> VMS                           Little<br>         <span class="hljs-number">20</span> Solaris Operating <span class="hljs-keyword">System</span> (x86<span class="hljs-number">-64</span>)        Little<br>         <span class="hljs-number">21</span> Apple Mac OS (x86<span class="hljs-number">-64</span>)                    Little<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>endian</tag>
      </tags>
  </entry>
  <entry>
    <title>exp 9i - 11g</title>
    <url>/blog/posts/44040.html</url>
    <content><![CDATA[<ol>
<li>检查 segment 大小、对象个数、job、所有表的记录数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">spool check_object_source<span class="hljs-operator">/</span>target.log<br><span class="hljs-keyword">set</span> pagesize <span class="hljs-number">10000</span><br>prompt <span class="hljs-comment">---------------segments_bytes_G</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(bytes)<span class="hljs-operator">/</span><span class="hljs-number">1024</span><span class="hljs-operator">/</span><span class="hljs-number">1024</span><span class="hljs-operator">/</span><span class="hljs-number">1024</span> <span class="hljs-keyword">from</span> dba_segments <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br>prompt <span class="hljs-comment">---------------object total amounts</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br>prompt <span class="hljs-comment">---------------object type amounts</span><br><span class="hljs-keyword">select</span> owner,object_type,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner,object_type <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>;<br>prompt<span class="hljs-comment">-----------------job amounts</span><br><span class="hljs-keyword">select</span> job,what,broken <span class="hljs-keyword">from</span> dba_jobs <span class="hljs-keyword">where</span> log_user<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br>prompt <span class="hljs-comment">---------------table records</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> XXXX.<span class="hljs-operator">*</span>;<br>spool off<br>exit;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>创建表空间</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span>space XX datafile <span class="hljs-string">&#x27;/xxx/xxx1.dbf&#x27;</span> size <span class="hljs-number">30</span>g;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span>space XX <span class="hljs-keyword">add</span> datafile <span class="hljs-string">&#x27;/xxx/xxx2.dbf&#x27;</span> size <span class="hljs-number">30</span>g;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span>space XX <span class="hljs-keyword">add</span> datafile <span class="hljs-string">&#x27;/xxx/xxx3.dbf&#x27;</span> size <span class="hljs-number">30</span>g;<br></code></pre></td></tr></table></figure>

<ol start="3">
<li>创建用户</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> dbms_metadata.get_ddl(<span class="hljs-string">&#x27;USER&#x27;</span>,<span class="hljs-string">&#x27;XXXX&#x27;</span>) <span class="hljs-keyword">from</span> dba_users;<br></code></pre></td></tr></table></figure>

<ol start="4">
<li>迁移用户权限</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--表空间配额</span><br><span class="hljs-keyword">select</span> dbms_metadata.get_granted_ddl(<span class="hljs-string">&#x27;TABLESPACE_QUOTA&#x27;</span>,username) <span class="hljs-keyword">from</span> dba_users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXXX&#x27;</span>;<br><span class="hljs-comment">--角色</span><br><span class="hljs-keyword">select</span> dbms_metadata.get_granted_ddl(<span class="hljs-string">&#x27;ROLE_GRANT&#x27;</span>,username) <span class="hljs-keyword">from</span> dba_users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXXX&#x27;</span>;<br><span class="hljs-comment">--系统权限</span><br><span class="hljs-keyword">select</span> dbms_metadata.get_granted_ddl(<span class="hljs-string">&#x27;SYSTEM_GRANT&#x27;</span>, username) <span class="hljs-keyword">from</span> dba_users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXXX&#x27;</span>;<br><span class="hljs-comment">--对象权限，最后导入完后执行</span><br><span class="hljs-keyword">select</span> dbms_metadata.get_granted_ddl(<span class="hljs-string">&#x27;OBJECT_GRANT&#x27;</span>, username) <span class="hljs-keyword">from</span> dba_users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXXX&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>清空回收站</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dba_recyclebin;<br>purge recyclebin;<br></code></pre></td></tr></table></figure>

<ol start="6">
<li>检查失效对象</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> owner,object_name,object_type <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> status<span class="hljs-operator">=</span><span class="hljs-string">&#x27;INVALID&#x27;</span> <span class="hljs-keyword">and</span> OWNER<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br></code></pre></td></tr></table></figure>

<ol start="7">
<li>记录JOB，并禁用</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> job,what,broken <span class="hljs-keyword">from</span> dba_jobs <span class="hljs-keyword">where</span> log_user<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;exec dbms_ijob.broken(&#x27;</span><span class="hljs-operator">||</span>job<span class="hljs-operator">||</span><span class="hljs-string">&#x27;,true);&#x27;</span> <span class="hljs-keyword">from</span> dba_jobs <span class="hljs-keyword">where</span> log_user<span class="hljs-operator">=</span>’XXXX’;<br></code></pre></td></tr></table></figure>

<ol start="8">
<li>锁定用户</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> XXXX account lock;<br></code></pre></td></tr></table></figure>

<ol start="9">
<li>导出</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> ORACLE_SID=XXX<br><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK<br>exp system/oracle full=y FILE=/expdata/exp_full_date.dmp <span class="hljs-built_in">log</span>=/expdata/exp_full_date.log<br></code></pre></td></tr></table></figure>

<ol start="10">
<li>关闭归档</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">shutdown immediate<br>startup mount<br><span class="hljs-keyword">alter</span> database noarchivelog;<br><span class="hljs-keyword">alter</span> database <span class="hljs-keyword">open</span>;<br></code></pre></td></tr></table></figure>

<ol start="11">
<li>导入</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> ORACLE_SID=XXX<br><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK<br>imp system/oracle file=/expdata/exp_full_date.dmp <span class="hljs-built_in">log</span>=/expdata/imp_username_date.log fromuser=XXXX touser=XXXX commit=y buffer=819200000 ignore=y<br></code></pre></td></tr></table></figure>

<ol start="12">
<li>检查导入的对象</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">spool check_object_source<span class="hljs-operator">/</span>target.log<br><span class="hljs-keyword">set</span> pagesize <span class="hljs-number">10000</span><br>prompt <span class="hljs-comment">---------------segments_bytes_G</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(byetes)<span class="hljs-operator">/</span><span class="hljs-number">1024</span><span class="hljs-operator">/</span><span class="hljs-number">1024</span><span class="hljs-operator">/</span><span class="hljs-number">1024</span> <span class="hljs-keyword">from</span> dba_segments <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br>prompt <span class="hljs-comment">---------------object total amounts</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br>prompt <span class="hljs-comment">---------------object type amounts</span><br><span class="hljs-keyword">select</span> owner,object_type,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner,object_type <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>;<br>prompt<span class="hljs-comment">-----------------job amounts</span><br><span class="hljs-keyword">select</span> job,what,broken <span class="hljs-keyword">from</span> dba_jobs <span class="hljs-keyword">where</span> log_user<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXX&#x27;</span>;<br>prompt <span class="hljs-comment">---------------table records</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> XXXX.<span class="hljs-operator">*</span>;<br>spool off<br>exit;<br></code></pre></td></tr></table></figure>

<ol start="13">
<li>检查失效对象</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> owner,object_name,object_type <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;INVALID&#x27;</span> <span class="hljs-keyword">and</span> OWNER<span class="hljs-operator">=</span><span class="hljs-string">&#x27;XXXXX&#x27;</span>;<br><br>@?<span class="hljs-operator">/</span>rdbms<span class="hljs-operator">/</span>admin<span class="hljs-operator">/</span>utlrp.sql<br></code></pre></td></tr></table></figure>

<ol start="14">
<li>重新收集用户统计信息</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 用户统计信息收集</span><br><span class="hljs-keyword">exec</span> DBMS_STATS.GATHER_SCHEMA_STATS(ownname<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;SCOTT&#x27;</span>,degree<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-number">4</span>);<br><br><span class="hljs-comment">-- 全库统计信息收集</span><br><span class="hljs-keyword">exec</span> DBMS_STATS.GATHER_DATABASE_STATS(degree<span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>exp</tag>
        <tag>imp</tag>
      </tags>
  </entry>
  <entry>
    <title>Migration Method Comparison</title>
    <url>/blog/posts/15239.html</url>
    <content><![CDATA[<p>数据库平台迁移，常用工具优缺点对比：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody><tr>
<td>RMAN</td>
<td>操作简单</td>
<td>不适用于不同字节序之间的平台迁移</td>
</tr>
<tr>
<td>数据泵</td>
<td>操作简单</td>
<td>数据量大时需要的停机时间很长</td>
</tr>
<tr>
<td>OGG</td>
<td>对源端目标端平台无要求</td>
<td>操作较复杂，维护成本高</td>
</tr>
<tr>
<td>XTTS</td>
<td>源端与目标端字节序可以不同，停机时间短</td>
<td>被移动的表空间不能包含offline的数据文件</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>migration</tag>
      </tags>
  </entry>
  <entry>
    <title>db_install_11g.rsp</title>
    <url>/blog/posts/38270.html</url>
    <content><![CDATA[<h1 id="db-install-11g-rsp"><a href="#db-install-11g-rsp" class="headerlink" title="db_install_11g.rsp"></a>db_install_11g.rsp</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">####################################################################</span><br><span class="hljs-comment">## Copyright(c) Oracle Corporation 1998,2013. All rights reserved.##</span><br><span class="hljs-comment">##                                                                ##</span><br><span class="hljs-comment">## Specify values for the variables listed below to customize     ##</span><br><span class="hljs-comment">## your installation.                                             ##</span><br><span class="hljs-comment">##                                                                ##</span><br><span class="hljs-comment">## Each variable is associated with a comment. The comment        ##</span><br><span class="hljs-comment">## can help to populate the variables with the appropriate        ##</span><br><span class="hljs-comment">## values.                                                        ##</span><br><span class="hljs-comment">##                                                                ##</span><br><span class="hljs-comment">## IMPORTANT <span class="hljs-doctag">NOTE:</span> This file contains plain text passwords and    ##</span><br><span class="hljs-comment">## should be secured to have read permission only by oracle user  ##</span><br><span class="hljs-comment">## or db administrator who owns this installation.                ##</span><br><span class="hljs-comment">##                                                                ##</span><br><span class="hljs-comment">####################################################################</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Do not change the following system generated value.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the installation option.</span><br><span class="hljs-comment"># It can be one of the following:</span><br><span class="hljs-comment">#   - INSTALL_DB_SWONLY</span><br><span class="hljs-comment">#   - INSTALL_DB_AND_CONFIG</span><br><span class="hljs-comment">#   - UPGRADE_DB</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.option=INSTALL_DB_SWONLY<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the hostname of the system as set during the install. It can be used</span><br><span class="hljs-comment"># to force the installation to use an alternative hostname rather than using the</span><br><span class="hljs-comment"># first hostname found on the system. (e.g., for systems with multiple hostnames</span><br><span class="hljs-comment"># and network interfaces)</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>ORACLE_HOSTNAME=localhost<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the Unix group to be set for the inventory directory.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>UNIX_GROUP_NAME=oinstall<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the location which holds the inventory files.</span><br><span class="hljs-comment"># This is an optional parameter if installing on</span><br><span class="hljs-comment"># Windows based Operating System.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>INVENTORY_LOCATION=/u01/app/oraInventory<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the languages in which the components will be installed.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># en   : English                  ja   : Japanese</span><br><span class="hljs-comment"># fr   : French                   ko   : Korean</span><br><span class="hljs-comment"># ar   : Arabic                   es   : Latin American Spanish</span><br><span class="hljs-comment"># bn   : Bengali                  lv   : Latvian</span><br><span class="hljs-comment"># pt_BR: Brazilian Portuguese     lt   : Lithuanian</span><br><span class="hljs-comment"># bg   : Bulgarian                ms   : Malay</span><br><span class="hljs-comment"># fr_CA: Canadian French          es_MX: Mexican Spanish</span><br><span class="hljs-comment"># ca   : Catalan                  no   : Norwegian</span><br><span class="hljs-comment"># hr   : Croatian                 pl   : Polish</span><br><span class="hljs-comment"># cs   : Czech                    pt   : Portuguese</span><br><span class="hljs-comment"># da   : Danish                   ro   : Romanian</span><br><span class="hljs-comment"># nl   : Dutch                    ru   : Russian</span><br><span class="hljs-comment"># ar_EG: Egyptian                 zh_CN: Simplified Chinese</span><br><span class="hljs-comment"># en_GB: English (Great Britain)  sk   : Slovak</span><br><span class="hljs-comment"># et   : Estonian                 sl   : Slovenian</span><br><span class="hljs-comment"># fi   : Finnish                  es_ES: Spanish</span><br><span class="hljs-comment"># de   : German                   sv   : Swedish</span><br><span class="hljs-comment"># el   : Greek                    th   : Thai</span><br><span class="hljs-comment"># iw   : Hebrew                   zh_TW: Traditional Chinese</span><br><span class="hljs-comment"># hu   : Hungarian                tr   : Turkish</span><br><span class="hljs-comment"># is   : Icelandic                uk   : Ukrainian</span><br><span class="hljs-comment"># in   : Indonesian               vi   : Vietnamese</span><br><span class="hljs-comment"># it   : Italian</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># all_langs   : All languages</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Specify value as the following to select any of the languages.</span><br><span class="hljs-comment"># Example : SELECTED_LANGUAGES=en,fr,ja</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Specify value as the following to select all the languages.</span><br><span class="hljs-comment"># Example : SELECTED_LANGUAGES=all_langs</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>SELECTED_LANGUAGES=en,zh_CN<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the complete path of the Oracle Home.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the complete path of the Oracle Base.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>ORACLE_BASE=/u01/app/oracle<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the installation edition of the component.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The value should contain only one of these choices.</span><br><span class="hljs-comment">#   - EE     : Enterprise Edition</span><br><span class="hljs-comment">#   - SE     : Standard Edition</span><br><span class="hljs-comment">#   - SEONE  : Standard Edition One</span><br><span class="hljs-comment">#   - PE     : Personal Edition (WINDOWS ONLY)</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.InstallEdition=EE<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable is used to enable or disable custom install and is considered</span><br><span class="hljs-comment"># only if InstallEdition is EE.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># true  : Components mentioned as part of &#x27;optionalComponents&#x27; property</span><br><span class="hljs-comment">#         are considered for install.</span><br><span class="hljs-comment"># false : Value for &#x27;optionalComponents&#x27; is not considered.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.EEOptionsSelection=<span class="hljs-literal">false</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable is considered only if &#x27;EEOptionsSelection&#x27; is set to true.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Description: List of Enterprise Edition Options you would like to enable.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#              The following choices are available. You may specify any</span><br><span class="hljs-comment">#              combination of these choices.  The components you choose should</span><br><span class="hljs-comment">#              be specified in the form &quot;internal-component-name:version&quot;</span><br><span class="hljs-comment">#              Below is a list of components you may specify to enable.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#              oracle.oraolap:11.2.0.4.0 - Oracle OLAP</span><br><span class="hljs-comment">#              oracle.rdbms.dm:11.2.0.4.0 - Oracle Data Mining</span><br><span class="hljs-comment">#              oracle.rdbms.dv:11.2.0.4.0 - Oracle Database Vault</span><br><span class="hljs-comment">#              oracle.rdbms.lbac:11.2.0.4.0 - Oracle Label Security</span><br><span class="hljs-comment">#              oracle.rdbms.partitioning:11.2.0.4.0 - Oracle Partitioning</span><br><span class="hljs-comment">#              oracle.rdbms.rat:11.2.0.4.0 - Oracle Real Application Testing</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.optionalComponents=oracle.rdbms.partitioning:11.2.0.4.0,oracle.oraolap:11.2.0.4.0,oracle.rdbms.dm:11.2.0.4.0,oracle.rdbms.dv:11.2.0.4.0,oracle.rdbms.lbac:11.2.0.4.0,oracle.rdbms.rat:11.2.0.4.0<br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment"># PRIVILEGED OPERATING SYSTEM GROUPS                                          #</span><br><span class="hljs-comment"># ------------------------------------------                                  #</span><br><span class="hljs-comment"># Provide values for the OS groups to which OSDBA and OSOPER privileges       #</span><br><span class="hljs-comment"># needs to be granted. If the install is being performed as a member of the   #</span><br><span class="hljs-comment"># group &quot;dba&quot;, then that will be used unless specified otherwise below.       #</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment"># The value to be specified for OSDBA and OSOPER group is only for UNIX based #</span><br><span class="hljs-comment"># Operating System.                                                           #</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment">###############################################################################</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># The DBA_GROUP is the OS group which is to be granted OSDBA privileges.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.DBA_GROUP=dba<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># The OPER_GROUP is the OS group which is to be granted OSOPER privileges.</span><br><span class="hljs-comment"># The value to be specified for OSOPER group is optional.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.OPER_GROUP=dba<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the cluster node names selected during the installation.</span><br><span class="hljs-comment"># Example : oracle.install.db.CLUSTER_NODES=node1,node2</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.CLUSTER_NODES=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable is used to enable or disable RAC One Node install.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   - true  : Value of RAC One Node service name is used.</span><br><span class="hljs-comment">#   - false : Value of RAC One Node service name is not used.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If left blank, it will be assumed to be false</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.isRACOneInstall=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the name for RAC One Node Service.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.racOneServiceName=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the type of database to create.</span><br><span class="hljs-comment"># It can be one of the following:</span><br><span class="hljs-comment">#   - GENERAL_PURPOSE/TRANSACTION_PROCESSING</span><br><span class="hljs-comment">#   - DATA_WAREHOUSE</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.type=GENERAL_PURPOSE<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the Starter Database Global Database Name.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.globalDBName=orcl<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the Starter Database SID.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.SID=orcl<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the Starter Database character set.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># It can be one of the following:</span><br><span class="hljs-comment"># AL32UTF8, WE8ISO8859P15, WE8MSWIN1252, EE8ISO8859P2,</span><br><span class="hljs-comment"># EE8MSWIN1250, NE8ISO8859P10, NEE8ISO8859P4, BLT8MSWIN1257,</span><br><span class="hljs-comment"># BLT8ISO8859P13, CL8ISO8859P5, CL8MSWIN1251, AR8ISO8859P6,</span><br><span class="hljs-comment"># AR8MSWIN1256, EL8ISO8859P7, EL8MSWIN1253, IW8ISO8859P8,</span><br><span class="hljs-comment"># IW8MSWIN1255, JA16EUC, JA16EUCTILDE, JA16SJIS, JA16SJISTILDE,</span><br><span class="hljs-comment"># KO16MSWIN949, ZHS16GBK, TH8TISASCII, ZHT32EUC, ZHT16MSWIN950,</span><br><span class="hljs-comment"># ZHT16HKSCS, WE8ISO8859P9, TR8MSWIN1254, VN8MSWIN1258</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.characterSet=AL32UTF8<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable should be set to true if Automatic Memory Management</span><br><span class="hljs-comment"># in Database is desired.</span><br><span class="hljs-comment"># If Automatic Memory Management is not desired, and memory allocation</span><br><span class="hljs-comment"># is to be done manually, then set it to false.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.memoryOption=<span class="hljs-literal">true</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the total memory allocation for the database. Value(in MB) should be</span><br><span class="hljs-comment"># at least 256 MB, and should not exceed the total physical memory available</span><br><span class="hljs-comment"># on the system.</span><br><span class="hljs-comment"># Example: oracle.install.db.config.starterdb.memoryLimit=512</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.memoryLimit=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable controls whether to load Example Schemas onto</span><br><span class="hljs-comment"># the starter database or not.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.installExampleSchemas=<span class="hljs-literal">false</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable includes enabling audit settings, configuring password profiles</span><br><span class="hljs-comment"># and revoking some grants to public. These settings are provided by default.</span><br><span class="hljs-comment"># These settings may also be disabled.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.enableSecuritySettings=<span class="hljs-literal">true</span><br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment"># Passwords can be supplied for the following four schemas in the             #</span><br><span class="hljs-comment"># starter database:                                                           #</span><br><span class="hljs-comment">#   SYS                                                                       #</span><br><span class="hljs-comment">#   SYSTEM                                                                    #</span><br><span class="hljs-comment">#   SYSMAN (used by Enterprise Manager)                                       #</span><br><span class="hljs-comment">#   DBSNMP (used by Enterprise Manager)                                       #</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment"># Same password can be used for all accounts (not recommended)                #</span><br><span class="hljs-comment"># or different passwords for each account can be provided (recommended)       #</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment">###############################################################################</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable holds the password that is to be used for all schemas in the</span><br><span class="hljs-comment"># starter database.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.password.ALL=oracle<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the SYS password for the starter database.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.password.SYS=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the SYSTEM password for the starter database.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.password.SYSTEM=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the SYSMAN password for the starter database.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.password.SYSMAN=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the DBSNMP password for the starter database.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.password.DBSNMP=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the management option to be selected for the starter database.</span><br><span class="hljs-comment"># It can be one of the following:</span><br><span class="hljs-comment">#   - GRID_CONTROL</span><br><span class="hljs-comment">#   - DB_CONTROL</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.control=DB_CONTROL<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the Management Service to use if Grid Control is selected to manage</span><br><span class="hljs-comment"># the database.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.gridcontrol.gridControlServiceURL=<br><br><span class="hljs-comment">###############################################################################</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment"># SPECIFY BACKUP AND RECOVERY OPTIONS                                         #</span><br><span class="hljs-comment"># ------------------------------------                                        #</span><br><span class="hljs-comment"># Out-of-box backup and recovery options for the database can be mentioned    #</span><br><span class="hljs-comment"># using the entries below.                                                    #</span><br><span class="hljs-comment">#                                                                             #</span><br><span class="hljs-comment">###############################################################################</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># This variable is to be set to false if automated backup is not required. Else</span><br><span class="hljs-comment"># this can be set to true.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.automatedBackup.<span class="hljs-built_in">enable</span>=<span class="hljs-literal">false</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Regardless of the type of storage that is chosen for backup and recovery, if</span><br><span class="hljs-comment"># automated backups are enabled, a job will be scheduled to run daily to backup</span><br><span class="hljs-comment"># the database. This job will run as the operating system user that is</span><br><span class="hljs-comment"># specified in this variable.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.automatedBackup.osuid=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Regardless of the type of storage that is chosen for backup and recovery, if</span><br><span class="hljs-comment"># automated backups are enabled, a job will be scheduled to run daily to backup</span><br><span class="hljs-comment"># the database. This job will run as the operating system user specified by the</span><br><span class="hljs-comment"># above entry. The following entry stores the password for the above operating</span><br><span class="hljs-comment"># system user.</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.automatedBackup.ospwd=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the type of storage to use for the database.</span><br><span class="hljs-comment"># It can be one of the following:</span><br><span class="hljs-comment">#   - FILE_SYSTEM_STORAGE</span><br><span class="hljs-comment">#   - ASM_STORAGE</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.storageType=FILE_SYSTEM_STORAGE<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the database file location which is a directory for datafiles, control</span><br><span class="hljs-comment"># files, redo logs.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Applicable only when oracle.install.db.config.starterdb.storage=FILE_SYSTEM_STORAGE</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the backup and recovery location.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Applicable only when oracle.install.db.config.starterdb.storage=FILE_SYSTEM_STORAGE</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the existing ASM disk groups to be used for storage.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Applicable only when oracle.install.db.config.starterdb.storage=ASM_STORAGE</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.asm.diskGroup=<br><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the password for ASMSNMP user of the ASM instance.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Applicable only when oracle.install.db.config.starterdb.storage=ASM_STORAGE</span><br><span class="hljs-comment">#-------------------------------------------------------------------------------</span><br>oracle.install.db.config.asm.ASMSNMPPassword=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the My Oracle Support Account Username.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#  Example   : MYORACLESUPPORT_USERNAME=abc@oracle.com</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>MYORACLESUPPORT_USERNAME=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the My Oracle Support Account Username password.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : MYORACLESUPPORT_PASSWORD=password</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>MYORACLESUPPORT_PASSWORD=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify whether to enable the user to set the password for</span><br><span class="hljs-comment"># My Oracle Support credentials. The value can be either true or false.</span><br><span class="hljs-comment"># If left blank it will be assumed to be false.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : SECURITY_UPDATES_VIA_MYORACLESUPPORT=true</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>SECURITY_UPDATES_VIA_MYORACLESUPPORT=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify whether user doesn&#x27;t want to configure Security Updates.</span><br><span class="hljs-comment"># The value for this variable should be true if you don&#x27;t want to configure</span><br><span class="hljs-comment"># Security Updates, false otherwise.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># The value can be either true or false. If left blank it will be assumed</span><br><span class="hljs-comment"># to be false.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : DECLINE_SECURITY_UPDATES=false</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>DECLINE_SECURITY_UPDATES=<span class="hljs-literal">true</span><br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the Proxy server name. Length should be greater than zero.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : PROXY_HOST=proxy.domain.com</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>PROXY_HOST=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the proxy port number. Should be Numeric and at least 2 chars.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : PROXY_PORT=25</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>PROXY_PORT=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the proxy user name. Leave PROXY_USER and PROXY_PWD</span><br><span class="hljs-comment"># blank if your proxy server requires no authentication.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : PROXY_USER=username</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>PROXY_USER=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the proxy password. Leave PROXY_USER and PROXY_PWD</span><br><span class="hljs-comment"># blank if your proxy server requires no authentication.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : PROXY_PWD=password</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>PROXY_PWD=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the proxy realm. This value is used if auto-updates option is selected.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : PROXY_REALM=metalink</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>PROXY_REALM=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the Oracle Support Hub URL.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : COLLECTOR_SUPPORTHUB_URL=https://orasupporthub.company.com:8080/</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>COLLECTOR_SUPPORTHUB_URL=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the auto-updates option. It can be one of the following:</span><br><span class="hljs-comment">#   - MYORACLESUPPORT_DOWNLOAD</span><br><span class="hljs-comment">#   - OFFLINE_UPDATES</span><br><span class="hljs-comment">#   - SKIP_UPDATES</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.installer.autoupdates.option=<br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># In case MYORACLESUPPORT_DOWNLOAD option is chosen, specify the location where</span><br><span class="hljs-comment"># the updates are to be downloaded.</span><br><span class="hljs-comment"># In case OFFLINE_UPDATES option is chosen, specify the location where the updates</span><br><span class="hljs-comment"># are present.</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>oracle.installer.autoupdates.downloadUpdatesLoc=<br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the My Oracle Support Account Username which has the patches download privileges</span><br><span class="hljs-comment"># to be used for software updates.</span><br><span class="hljs-comment">#  Example   : AUTOUPDATES_MYORACLESUPPORT_USERNAME=abc@oracle.com</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>AUTOUPDATES_MYORACLESUPPORT_USERNAME=<br><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Specify the My Oracle Support Account Username password which has the patches download privileges</span><br><span class="hljs-comment"># to be used for software updates.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example    : AUTOUPDATES_MYORACLESUPPORT_PASSWORD=password</span><br><span class="hljs-comment">#------------------------------------------------------------------------------</span><br>AUTOUPDATES_MYORACLESUPPORT_PASSWORD=<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>rsp</tag>
      </tags>
  </entry>
  <entry>
    <title>dbca_11g.rsp</title>
    <url>/blog/posts/25611.html</url>
    <content><![CDATA[<h1 id="dbca-rsp"><a href="#dbca-rsp" class="headerlink" title="dbca.rsp"></a>dbca.rsp</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">##############################################################################</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">##                            DBCA response file                            ##</span><br><span class="hljs-comment">##                            ------------------                            ##</span><br><span class="hljs-comment">## Copyright   1998, 2014, Oracle Corporation. All Rights Reserved.         ##</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">## Specify values for the variables listed below to customize Oracle        ##</span><br><span class="hljs-comment">## Database Configuration installation.                                     ##</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">## Each variable is associated with a comment. The comment identifies the   ##</span><br><span class="hljs-comment">## variable type.                                                           ##</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">## Please specify the values in the following format :                      ##</span><br><span class="hljs-comment">##          Type       :  Example                                           ##</span><br><span class="hljs-comment">##          String     :  &quot;&lt;value&gt;&quot;                                         ##</span><br><span class="hljs-comment">##          Boolean    :  True or False                                     ##</span><br><span class="hljs-comment">##          Number     :  &lt;numeric value&gt;                                   ##</span><br><span class="hljs-comment">##          StringList :  &#123;&quot;&lt;value1&gt;&quot;,&quot;&lt;value2&gt;&quot;&#125;                           ##</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">## Examples :                                                               ##</span><br><span class="hljs-comment">##     1. dbca -progress_only -responseFile &lt;response file&gt;                 ##</span><br><span class="hljs-comment">##        Display a progress bar depicting progress of database creation    ##</span><br><span class="hljs-comment">##        process.                                                          ##</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">##     2. dbca -silent -responseFile &lt;response file&gt;                        ##</span><br><span class="hljs-comment">##        Creates database silently. No user interface is displayed.        ##</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">##     3. dbca -silent -createDatabase -cloneTemplate                       ##</span><br><span class="hljs-comment">##             -responseFile &lt;response file&gt;                      ##</span><br><span class="hljs-comment">##        Creates database silently with clone template. The template in    ##</span><br><span class="hljs-comment">##      responsefile is a clone template.                         ##</span><br><span class="hljs-comment">##                                                                          ##</span><br><span class="hljs-comment">##     4. dbca -silent -deleteDatabase -responseFile &lt;response file&gt;        ##</span><br><span class="hljs-comment">##        Deletes database silently.                                        ##</span><br><span class="hljs-comment">##############################################################################</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># GENERAL section is required for all types of database creations.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[GENERAL]<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : RESPONSEFILE_VERSION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Version of the database to create</span><br><span class="hljs-comment"># Valid values  : &quot;11.2.0&quot;</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>RESPONSEFILE_VERSION = <span class="hljs-string">&quot;11.2.0&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OPERATION_TYPE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Type of operation</span><br><span class="hljs-comment"># Valid values  : &quot;createDatabase&quot; \ &quot;createTemplateFromDB&quot; \ &quot;createCloneTemplate&quot; \ &quot;deleteDatabase&quot; \ &quot;configureDatabase&quot; \ &quot;addInstance&quot; (RAC-only) \ &quot;deleteInstance&quot; (RAC-only) \ &quot;createPluggableDatabase&quot; \ &quot;unplugDatabase&quot; \ &quot;deletePluggableDatabase&quot; \ &quot;configurePluggableDatabase&quot;</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>OPERATION_TYPE = <span class="hljs-string">&quot;createDatabase&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of GENERAL section ***------------------------</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># CREATEDATABASE section is used when OPERATION_TYPE is defined as &quot;createDatabase&quot;.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[CREATEDATABASE]<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : GDBNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Global database name of the database</span><br><span class="hljs-comment"># Valid values  : &lt;db_name&gt;.&lt;db_domain&gt; - when database domain isn&#x27;t NULL</span><br><span class="hljs-comment">#                 &lt;db_name&gt;             - when database domain is NULL</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>GDBNAME = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DATABASECONFTYPE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : database conf type as Single Instance, Real Application Cluster or Real Application Cluster One Nodes database</span><br><span class="hljs-comment"># Valid values  : SI\RAC\RACONENODE</span><br><span class="hljs-comment"># Default value : SI</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>DATABASECONFTYPE  = <span class="hljs-string">&quot;SI&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : RACONENODESERVICENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Service is required by application to connect to RAC One</span><br><span class="hljs-comment">#          Node Database</span><br><span class="hljs-comment"># Valid values  : Service Name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No [required in case DATABASECONFTYPE is set to RACONENODE ]</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#RACONENODESERVICENAME =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : POLICYMANAGED</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Set to true if Database is policy managed and</span><br><span class="hljs-comment">#          set to false if  Database is admin managed</span><br><span class="hljs-comment"># Valid values  : TRUE\FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#POLICYMANAGED = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CREATESERVERPOOL</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Set to true if new server pool need to be created for database</span><br><span class="hljs-comment">#          if this option is specified then the newly created database</span><br><span class="hljs-comment">#          will use this newly created serverpool.</span><br><span class="hljs-comment">#          Multiple serverpoolname can not be specified for database</span><br><span class="hljs-comment"># Valid values  : TRUE\FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#CREATESERVERPOOL = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SERVERPOOLNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Only one serverpool name need to be specified</span><br><span class="hljs-comment">#           if Create Server Pool option is specified.</span><br><span class="hljs-comment">#           Comma-separated list of Serverpool names if db need to use</span><br><span class="hljs-comment">#           multiple Server pool</span><br><span class="hljs-comment"># Valid values  : ServerPool name</span><br><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No [required in case of RAC service centric database]</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SERVERPOOLNAME =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CARDINALITY</span><br><span class="hljs-comment"># Datatype      : Number</span><br><span class="hljs-comment"># Description   : Specify Cardinality for create server pool operation</span><br><br><span class="hljs-comment"># Valid values  : any positive Integer value</span><br><span class="hljs-comment"># Default value : Number of qualified nodes on cluster</span><br><span class="hljs-comment"># Mandatory     : No [Required when a new serverpool need to be created]</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#CARDINALITY =</span><br><br><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : FORCE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Set to true if new server pool need to be created by force</span><br><span class="hljs-comment">#          if this option is specified then the newly created serverpool</span><br><span class="hljs-comment">#          will be assigned server even if no free servers are available.</span><br><span class="hljs-comment">#          This may affect already running database.</span><br><span class="hljs-comment">#          This flag can be specified for Admin managed as well as policy managed db.</span><br><span class="hljs-comment"># Valid values  : TRUE\FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#FORCE = &quot;false&quot;</span><br><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PQPOOLNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Only one serverpool name needs to be specified</span><br><span class="hljs-comment">#           if create server pool option is specified.</span><br><span class="hljs-comment">#           Comma-separated list of serverpool names if use</span><br><span class="hljs-comment">#           server pool. This is required to</span><br><span class="hljs-comment">#                  create Parallel Query (PQ) database. Applicable to Big Cluster</span><br><span class="hljs-comment"># Valid values  :  Parallel Query (PQ) pool name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No [required in case of RAC service centric database]</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#PQPOOLNAME =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PQCARDINALITY</span><br><span class="hljs-comment"># Datatype      : Number</span><br><span class="hljs-comment"># Description   : Specify Cardinality for create server pool operation.</span><br><span class="hljs-comment">#                 Applicable to Big Cluster</span><br><span class="hljs-comment"># Valid values  : any positive Integer value</span><br><span class="hljs-comment"># Default value : Number of qualified nodes on cluster</span><br><span class="hljs-comment"># Mandatory     : No [Required when a new serverpool need to be created]</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#PQCARDINALITY =</span><br><br><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SID</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : System identifier (SID) of the database</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : &lt;db_name&gt; specified in GDBNAME</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SID = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CREATEASCONTAINERDATABASE</span><br><span class="hljs-comment"># Datatype      : boolean</span><br><span class="hljs-comment"># Description   : flag to create database as container database</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : false</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#CREATEASCONTAINERDATABASE =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : NUMBEROFPDBS</span><br><span class="hljs-comment"># Datatype      : Number</span><br><span class="hljs-comment"># Description   : Specify the number of pdb to be created</span><br><span class="hljs-comment"># Valid values  : 0 to 252</span><br><span class="hljs-comment"># Default value : 0</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#NUMBEROFPDBS =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specify the pdbname/pdbanme prefix if one or more pdb need to be created</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#PDBNAME =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBADMINPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : PDB Administrator user password</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBADMINPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : NODELIST</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Comma-separated list of cluster nodes</span><br><span class="hljs-comment"># Valid values  : Cluster node names</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No (Yes for RAC database-centric database )</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#NODELIST=</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : TEMPLATENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Name of the template</span><br><span class="hljs-comment"># Valid values  : Template file name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>TEMPLATENAME = <span class="hljs-string">&quot;General_Purpose.dbc&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OBFUSCATEDPASSWORDS</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Set to true if passwords are encrypted</span><br><span class="hljs-comment"># Valid values  : TRUE\FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OBFUSCATEDPASSWORDS = FALSE</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for SYS user</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SYSPASSWORD = <span class="hljs-string">&quot;oracle&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSTEMPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for SYSTEM user</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SYSTEMPASSWORD = <span class="hljs-string">&quot;oracle&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SERVICEUSERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for Windows Service user</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : If Oracle home is installed with windows service user</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SERVICEUSERPASSWORD = &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Enterprise Manager Configuration Type</span><br><span class="hljs-comment"># Valid values  : CENTRAL|DBEXPRESS|ALL|NONE</span><br><span class="hljs-comment"># Default value : NONE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMCONFIGURATION = &quot;NONE&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMEXPRESSPORT</span><br><span class="hljs-comment"># Datatype      : Number</span><br><span class="hljs-comment"># Description   : Enterprise Manager Configuration Type</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : NONE</span><br><span class="hljs-comment"># Mandatory     : No, will be picked up from DBEXPRESS_HTTPS_PORT env variable</span><br><span class="hljs-comment">#                 or auto generates a free port between 5500 and 5599</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMEXPRESSPORT = &quot;&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : RUNCVUCHECKS</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify whether to run Cluster Verification Utility checks</span><br><span class="hljs-comment">#                 periodically in Cluster environment</span><br><span class="hljs-comment"># Valid values  : TRUE\FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#RUNCVUCHECKS = FALSE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DBSNMPPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for DBSNMP user</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if EMCONFIGURATION is specified or</span><br><span class="hljs-comment">#                 the value of RUNCVUCHECKS is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DBSNMPPASSWORD = &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OMSHOST</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : EM management server host name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OMSHOST =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OMSPORT</span><br><span class="hljs-comment"># Datatype      : Number</span><br><span class="hljs-comment"># Description   : EM management server port number</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OMSPORT =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMUSER</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : EM Admin username to add or modify targets</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMUSER =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : EM Admin user password</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMPASSWORD=</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span><br><span class="hljs-comment"># Valid values  : True/False</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVCONFIGURATION = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for  DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OLSCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Label Security</span><br><span class="hljs-comment"># Valid values  : True/False</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OLSCONFIGURATION = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DATAFILEJARLOCATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Location of the data file jar</span><br><span class="hljs-comment"># Valid values  : Directory containing compressed datafile jar</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DATAFILEJARLOCATION =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DATAFILEDESTINATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Location of the data file&#x27;s</span><br><span class="hljs-comment"># Valid values  : Directory for all the database files</span><br><span class="hljs-comment"># Default value : $ORACLE_BASE/oradata</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>DATAFILEDESTINATION=/u01/app/oracle/oradata<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : RECOVERYAREADESTINATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Location of the data file&#x27;s</span><br><span class="hljs-comment"># Valid values  : Recovery Area location</span><br><span class="hljs-comment"># Default value : $ORACLE_BASE/flash_recovery_area</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>RECOVERYAREADESTINATION=/u01/app/oracle/oradata<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : STORAGETYPE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the storage on which the database is to be created</span><br><span class="hljs-comment"># Valid values  : FS (CFS for RAC), ASM</span><br><span class="hljs-comment"># Default value : FS</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>STORAGETYPE=FS<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DISKGROUPNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the disk group name for the storage</span><br><span class="hljs-comment"># Default value : DATA</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DISKGROUPNAME=DATA</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : ASMSNMP_PASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for ASM Monitoring</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#ASMSNMP_PASSWORD=&quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : RECOVERYGROUPNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the disk group name for the recovery area</span><br><span class="hljs-comment"># Default value : RECOVERY</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#RECOVERYGROUPNAME=RECOVERY</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CHARACTERSET</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Character set of the database</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c National Language Support Guide</span><br><span class="hljs-comment"># Default value : &quot;US7ASCII&quot;</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>CHARACTERSET=<span class="hljs-string">&quot;AL32UTF8&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : NATIONALCHARACTERSET</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : National Character set of the database</span><br><span class="hljs-comment"># Valid values  : &quot;UTF8&quot; or &quot;AL16UTF16&quot;. For details, check Oracle12c National Language Support Guide</span><br><span class="hljs-comment"># Default value : &quot;AL16UTF16&quot;</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#NATIONALCHARACTERSET= &quot;UTF8&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : REGISTERWITHDIRSERVICE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether to register with Directory Service.</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#REGISTERWITHDIRSERVICE= TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the name of the directory service user</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the directory service user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : WALLETPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password for wallet to created or modified.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#WALLETPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : LISTENERS</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies list of listeners to register the database with.</span><br><span class="hljs-comment">#          By default the database is configured for all the listeners specified in the</span><br><span class="hljs-comment">#          $ORACLE_HOME/network/admin/listener.ora</span><br><span class="hljs-comment"># Valid values  : The list should be comma separated like &quot;listener1,listener2&quot;.</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#LISTENERS = &quot;listener1,listener2&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : VARIABLESFILE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Location of the file containing variable value pair</span><br><span class="hljs-comment"># Valid values  : A valid file-system file. The variable value pair format in this file</span><br><span class="hljs-comment">#          is &lt;variable&gt;=&lt;value&gt;. Each pair should be in a new line.</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#VARIABLESFILE=</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : VARIABLES</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : comma separated list of name=value pairs. Overrides variables defined in variablefile and templates</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#VARIABLES=</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : INITPARAMS</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : comma separated list of name=value pairs. Overrides initialization parameters defined in templates</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>INITPARAMS=<span class="hljs-string">&quot;memory_target=0,sga_target=500,pga_aggregate_target=100,java_jit_enabled=false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SAMPLESCHEMA</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether or not to add the Sample Schemas to your database</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FASLE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SAMPLESCHEMA=TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : MEMORYPERCENTAGE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : percentage of physical memory for Oracle</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#MEMORYPERCENTAGE = &quot;40&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DATABASETYPE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : used for memory distribution when MEMORYPERCENTAGE specified</span><br><span class="hljs-comment"># Valid values  : MULTIPURPOSE|DATA_WAREHOUSING|OLTP</span><br><span class="hljs-comment"># Default value : MULTIPURPOSE</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DATABASETYPE = &quot;MULTIPURPOSE&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : AUTOMATICMEMORYMANAGEMENT</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : flag to indicate Automatic Memory Management is used</span><br><span class="hljs-comment"># Valid values  : TRUE/FALSE</span><br><span class="hljs-comment"># Default value : TRUE</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>AUTOMATICMEMORYMANAGEMENT=<span class="hljs-string">&quot;False&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : TOTALMEMORY</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : total memory in MB to allocate to Oracle</span><br><span class="hljs-comment"># Valid values  :</span><br><span class="hljs-comment"># Default value :</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#TOTALMEMORY = &quot;800&quot;</span><br><br><br><span class="hljs-comment">#-----------------------*** End of CREATEDATABASE section ***------------------------</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># createTemplateFromDB section is used when OPERATION_TYPE is defined as &quot;createTemplateFromDB&quot;.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[createTemplateFromDB]<br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database from which to create the template</span><br><span class="hljs-comment"># Valid values  : The format is &lt;host&gt;:&lt;port&gt;:&lt;sid&gt;</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SOURCEDB = <span class="hljs-string">&quot;myhost:1521:orcl&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : A user with DBA role.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SYSDBAUSERNAME = <span class="hljs-string">&quot;system&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the DBA user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAPASSWORD = &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : TEMPLATENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Name for the new template.</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>TEMPLATENAME = <span class="hljs-string">&quot;My Copy TEMPLATE&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of createTemplateFromDB section ***------------------------</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># createCloneTemplate section is used when OPERATION_TYPE is defined as &quot;createCloneTemplate&quot;.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[createCloneTemplate]<br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database is the SID from which to create the template.</span><br><span class="hljs-comment">#          This database must be local and on the same ORACLE_HOME.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SOURCEDB = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : A user with DBA role.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES, if no OS authentication</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAUSERNAME = &quot;sys&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the DBA user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAPASSWORD = &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : TEMPLATENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Name for the new template.</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>TEMPLATENAME = <span class="hljs-string">&quot;My Clone TEMPLATE&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DATAFILEJARLOCATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Location of the data file jar</span><br><span class="hljs-comment"># Valid values  : Directory where the new compressed datafile jar will be placed</span><br><span class="hljs-comment"># Default value : $ORACLE_HOME/assistants/dbca/templates</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DATAFILEJARLOCATION =</span><br><br><span class="hljs-comment">#-----------------------*** End of createCloneTemplate section ***------------------------</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># DELETEDATABASE section is used when DELETE_TYPE is defined as &quot;deleteDatabase&quot;.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[DELETEDATABASE]<br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database is the SID</span><br><span class="hljs-comment">#          This database must be local and on the same ORACLE_HOME.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SOURCEDB = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : A user with DBA role.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES, if no OS authentication</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAUSERNAME = &quot;sys&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the DBA user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES, if no OS authentication</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAPASSWORD = &quot;password&quot;</span><br><span class="hljs-comment">#-----------------------*** End of deleteDatabase section ***------------------------</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># GENERATESCRIPTS section</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[generateScripts]<br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : TEMPLATENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Name of the template</span><br><span class="hljs-comment"># Valid values  : Template name as seen in DBCA</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>TEMPLATENAME = <span class="hljs-string">&quot;New Database&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : GDBNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Global database name of the database</span><br><span class="hljs-comment"># Valid values  : &lt;db_name&gt;.&lt;db_domain&gt; - when database domain isn&#x27;t NULL</span><br><span class="hljs-comment">#                 &lt;db_name&gt;             - when database domain is NULL</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>GDBNAME = <span class="hljs-string">&quot;orcl11.us.oracle.com&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SCRIPTDESTINATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Location of the scripts</span><br><span class="hljs-comment"># Valid values  : Directory for all the scripts</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SCRIPTDESTINATION =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Enterprise Manager Configuration Type</span><br><span class="hljs-comment"># Valid values  : CENTRAL</span><br><span class="hljs-comment"># Default value : NONE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMCONFIGURATION = &quot;NONE&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OMSHOST</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : EM management server host name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OMSHOST =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OMSPORT</span><br><span class="hljs-comment"># Datatype      : Number</span><br><span class="hljs-comment"># Description   : EM management server port number</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OMSPORT =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMUSER</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : EM Admin username to add or modify targets</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMUSER =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : EM Admin user password</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMPASSWORD=</span><br><br><span class="hljs-comment">#-----------------------*** End of deleteDatabase section ***------------------------</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># CONFIGUREDATABASE section is used when OPERATION_TYPE is defined as &quot;configureDatabase&quot;.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[CONFIGUREDATABASE]<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database is the SID</span><br><span class="hljs-comment">#          This database must be local and on the same ORACLE_HOME.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SOURCEDB = &quot;orcl&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : A user with DBA role.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES, if no OS authentication</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAUSERNAME = &quot;sys&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the DBA user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES, if no OS authentication</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAPASSWORD =</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : REGISTERWITHDIRSERVICE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether to register with Directory Service.</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#REGISTERWITHDIRSERVICE= TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : UNREGISTERWITHDIRSERVICE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether to unregister with Directory Service.</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#UNREGISTERWITHDIRSERVICE= TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : REGENERATEDBPASSWORD</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether regenerate database password in OID/Wallet</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#REGENERATEDBPASSWORD= TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the name of the directory service user</span><br><span class="hljs-comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the directory service user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : WALLETPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password for wallet to created or modified.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#WALLETPASSWORD= &quot;password&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : ENABLESECURITYCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Database Security Settings</span><br><span class="hljs-comment"># Valid values  : true|false</span><br><span class="hljs-comment"># Default value : true</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#ENABLESECURITYCONFIGURATION = &quot;true&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DBSNMPPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for DBSNMP user</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if EMCONFIGURATION is specified</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DBSNMPPASSWORD = &quot;password&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span><br><span class="hljs-comment"># Valid values  : True/False</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVCONFIGURATION = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for  DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of CONFIGUREDATABASE section ***------------------------</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># ADDINSTANCE section is used when OPERATION_TYPE is defined as &quot;addInstance&quot;.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[ADDINSTANCE]<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DB_UNIQUE_NAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DB Unique Name of the RAC database</span><br><span class="hljs-comment"># Valid values  : &lt;db_unique_name&gt;</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>DB_UNIQUE_NAME = <span class="hljs-string">&quot;orcl11c.us.oracle.com&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : INSTANCENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : RAC instance name to be added</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : &lt;sid_prefix&gt;+&lt;highest_current_thread+1&gt;</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#INSTANCENAME = &quot;orcl1&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : NODENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Node on which to add new instance</span><br><span class="hljs-comment">#                 (in 10gR2, instance addition is supported on 1 node at a time)</span><br><span class="hljs-comment"># Valid values  : Cluster node name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>NODENAME=<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OBFUSCATEDPASSWORDS</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Set to true if passwords are encrypted</span><br><span class="hljs-comment"># Valid values  : TRUE\FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OBFUSCATEDPASSWORDS = FALSE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : A user with DBA role.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SYSDBAUSERNAME = <span class="hljs-string">&quot;sys&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the DBA user.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAPASSWORD = &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SERVICEUSERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for Windows Service user</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : If Oracle home is installed with windows service user</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SERVICEUSERPASSWORD = &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of ADDINSTANCE section ***------------------------</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># DELETEINSTANCE section is used when OPERATION_TYPE is defined as &quot;deleteInstance&quot;.</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>[DELETEINSTANCE]<br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DB_UNIQUE_NAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DB Unique Name of the RAC database</span><br><span class="hljs-comment"># Valid values  : &lt;db_unique_name&gt;</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>DB_UNIQUE_NAME = <span class="hljs-string">&quot;orcl11c.us.oracle.com&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : INSTANCENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : RAC instance name to be deleted</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>INSTANCENAME = <span class="hljs-string">&quot;orcl11g&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : NODENAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Node on which instance to be deleted (SID) is located</span><br><span class="hljs-comment"># Valid values  : Cluster node name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#NODENAME=</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OBFUSCATEDPASSWORDS</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Set to true if passwords are encrypted</span><br><span class="hljs-comment"># Valid values  : TRUE\FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OBFUSCATEDPASSWORDS = FALSE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : A user with DBA role.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SYSDBAUSERNAME = <span class="hljs-string">&quot;sys&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SYSDBAPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the DBA user.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#SYSDBAPASSWORD = &quot;password&quot;</span><br><br><br><span class="hljs-comment">#-----------------------*** End of DELETEINSTANCE section ***------------------------</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># CREATEPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as &quot;createPluggableDatabase&quot;.</span><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br>[CREATEPLUGGABLEDATABASE]<br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database is the SID</span><br><span class="hljs-comment">#          This database must be local and on the same ORACLE_HOME.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SOURCEDB = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The name of new pluggable database</span><br><span class="hljs-comment">#          This pdb name must not be same as sourcedb name.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>PDBNAME = <span class="hljs-string">&quot;PDB1&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CREATEASCLONE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : specify true or false for PDB to be create as Clone.</span><br><span class="hljs-comment">#               : When &quot;true&quot; is passed a new PDB GUID is generated for the plugged in PDB</span><br><span class="hljs-comment"># Default value : true</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># CREATEASCLONE = &quot;TRUE&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CREATEPDBFROM</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : specify the source of pdb to be plugged</span><br><span class="hljs-comment"># Valid values  : DEFAULT | FILEARCHIVE | RMANBACKUP | USINGXML</span><br><span class="hljs-comment"># Default value : DEFAULT</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># CREATEPDBFROM = &quot;DEFAULT&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBARCHIVEFILE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Full path and name for pdbArchive file</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Mandatory when creating new PDB using FILEARCHIVE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBARCHIVEFILE = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBBACKUPFILE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Full path and name for pdb back up file</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Mandatory when creating new PDB using RMANBACKUP</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBBACKUPFILE = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBMETADATAFILE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Full path and name for pdb metadata file</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Mandatory when creating new PDB using RMANBACKUP or USINGXML</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBMETADATAFILE = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBUSEMULTIPLEBACKUP</span><br><span class="hljs-comment"># Datatype      : boolean</span><br><span class="hljs-comment"># Description   : Flag that can used to create PDB from single or multiple backupsets</span><br><span class="hljs-comment"># Default value : true</span><br><span class="hljs-comment"># Mandatory     : Optional when creating new PDB using RMANBACKUP or USINGXML</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBUSEMULTIPLEBACKUP =</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBADMINUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : PDB Administrator user name</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Mandatory only when creating new DEFAULT PDB</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBADMINUSERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBADMINPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : PDB Administrator user password</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Mandatory only when creating new DEFAULT PDB</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBADMINPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CREATENEWPDBADMINUSER</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : When Plugging a pdb from FILEARCHIVE or RMANBACKUP</span><br><span class="hljs-comment">#          a new PDB Administrator user can be created using this option</span><br><span class="hljs-comment">#          This option should be given along with pdbadmin username and password</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># CREATENEWPDBADMINUSER = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEFILENAMECONVERT</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : This clause specifies how to locate files listed in an XML file</span><br><span class="hljs-comment">#          describing a Pluggable Database if they reside in a location different</span><br><span class="hljs-comment">#          from that specified in the XML file.</span><br><span class="hljs-comment">#          This clause is valid when creating Pluggable database in USINGXML option</span><br><span class="hljs-comment"># Valid values  : (&lt;filename_pattern&gt;, &lt;replacement_filename_pattern&gt;,....)</span><br><span class="hljs-comment"># Default value : &quot;NONE&quot;</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># SOURCEFILENAMECONVERT = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : FILENAMECONVERT</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : This clause specifies how to generate names of files</span><br><span class="hljs-comment">#          for the Pluggable Database being created using names of existing files</span><br><span class="hljs-comment">#          This clause is valid when creating Pluggable database in USINGXML option</span><br><span class="hljs-comment"># Valid values  : (&lt;filename_pattern&gt;, &lt;replacement_filename_pattern&gt;,....)</span><br><span class="hljs-comment"># Default value : &quot;NONE&quot;</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># FILENAMECONVERT = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : COPYPDBFILES</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : If COPY is specified, it will indicate that datafiles need to be copied.</span><br><span class="hljs-comment">#        : This option can be true only when FILENAMECONVERT is specified or</span><br><span class="hljs-comment">#           CDB files are Oracle Managed Files(OMF)</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># COPYPDBFILES = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBDATAFILEDESTINATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : common location for PDB datafile area</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBDATAFILEDESTINATION = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : USEMETADATAFILELOCATION</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify true if datafile path defined in Meta datafile within PDB</span><br><span class="hljs-comment">#          archive file is to be used to un-archive datafile.</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># USEMETADATAFILELOCATION = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : REGISTERWITHDIRSERVICE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether to register with Directory Service.</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#REGISTERWITHDIRSERVICE= TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the name of the directory service user</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the directory service user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : WALLETPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password for wallet to created or modified.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#WALLETPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : LBACSYSPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for LBACSYS user</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService are TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#LBACSYSPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : CREATEUSERTABLESPACE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify true if a default user tablespace need to be created in new PDB</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : TRUE</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># CREATEUSERTABLESPACE = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span><br><span class="hljs-comment"># Valid values  : True/False</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVCONFIGURATION = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for  DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of createPluggableDatabase section ***------------------------</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># UNPLUGDATABASE section is used when OPERATION_TYPE is defined as &quot;unplugDatabase&quot;.</span><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br>[UNPLUGDATABASE]<br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database is the SID</span><br><span class="hljs-comment">#          This database must be local and on the same ORACLE_HOME.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SOURCEDB = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The name of new pluggable database</span><br><span class="hljs-comment">#          This pdb name must not be same as sourcedb name.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>PDBNAME = <span class="hljs-string">&quot;PDB1&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : ARCHIVETYPE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The unplugged database datafile backup will in tar.gz or rman backup</span><br><span class="hljs-comment">#          This pdb name must not be same as sourcedb name.</span><br><span class="hljs-comment"># Valid values  : TAR | RMAN</span><br><span class="hljs-comment"># Default value : TAR</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>ARCHIVETYPE = <span class="hljs-string">&quot;TAR&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBARCHIVEFILE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Full path and name for pdbArchive file</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : NO</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBARCHIVEFILE = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBBACKUPFILE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Full path and name for pdb back up file</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBBACKUPFILE = &quot;&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBMETADATAFILE</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Full path and name for pdb metadata file</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># PDBMETADATAFILE = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : UNREGISTERWITHDIRSERVICE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether to unregister with Directory Service.</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#UNREGISTERWITHDIRSERVICE= TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the name of the directory service user</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the directory service user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : WALLETPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password for wallet to created or modified.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#WALLETPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of unplugDatabase section ***------------------------</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># DELETEPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as &quot;deletePluggableDatabase&quot;.</span><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br>[DELETEPLUGGABLEDATABASE]<br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database is the SID</span><br><span class="hljs-comment">#          This database must be local and on the same ORACLE_HOME.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SOURCEDB = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The name of new pluggable database</span><br><span class="hljs-comment">#          This pdb name must not be same as sourcedb name.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>PDBNAME = <span class="hljs-string">&quot;PDB1&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of deletePluggableDatabase section ***------------------------</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># CONFIGUREPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as &quot;configurePluggableDatabase&quot;.</span><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br>[CONFIGUREPLUGGABLEDATABASE]<br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : SOURCEDB</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The source database is the SID</span><br><span class="hljs-comment">#          This database must be local and on the same ORACLE_HOME.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>SOURCEDB = <span class="hljs-string">&quot;orcl&quot;</span><br><br><span class="hljs-comment">#----------------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : PDBNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The name of new pluggable database</span><br><span class="hljs-comment">#          This pdb name must not be same as sourcedb name.</span><br><span class="hljs-comment"># Default value : none</span><br><span class="hljs-comment"># Mandatory     : YES</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br>PDBNAME = <span class="hljs-string">&quot;PDB1&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Database vault</span><br><span class="hljs-comment"># Valid values  : True/False</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVCONFIGURATION = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVOWNERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for DataVault Owner</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : Yes, if DataVault option is chosen</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVOWNERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERNAME = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DVACCOUNTMANAGERPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for  DataVault Account Manager</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : None</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DVACCOUNTMANAGERPASSWORD = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : OLSCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specify &quot;True&quot; to configure and enable Oracle Label Security</span><br><span class="hljs-comment"># Valid values  : True/False</span><br><span class="hljs-comment"># Default value : False</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#OLSCONFIGURATION = &quot;false&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : REGISTERWITHDIRSERVICE</span><br><span class="hljs-comment"># Datatype      : Boolean</span><br><span class="hljs-comment"># Description   : Specifies whether to register with Directory Service.</span><br><span class="hljs-comment"># Valid values  : TRUE \ FALSE</span><br><span class="hljs-comment"># Default value : FALSE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#REGISTERWITHDIRSERVICE= TRUE</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEUSERNAME</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Specifies the name of the directory service user</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEUSERNAME= &quot;name&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : DIRSERVICEPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password of the directory service user.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#DIRSERVICEPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : WALLETPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : The password for wallet to created or modified.</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#WALLETPASSWORD= &quot;password&quot;</span><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : LBACSYSPASSWORD</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Password for LBACSYS user</span><br><span class="hljs-comment">#          You can also specify the password at the command prompt instead of here.</span><br><span class="hljs-comment"># Mandatory     : YES, if the value of olsConfiguration and registerWithDirService are TRUE</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#LBACSYSPASSWORD= &quot;password&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMCONFIGURATION</span><br><span class="hljs-comment"># Datatype      : String</span><br><span class="hljs-comment"># Description   : Enterprise Manager Configuration Type</span><br><span class="hljs-comment"># Valid values  : DBEXPRESS|NONE</span><br><span class="hljs-comment"># Default value : NONE</span><br><span class="hljs-comment"># Mandatory     : No</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMCONFIGURATION = &quot;NONE&quot;</span><br><br><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment"># Name          : EMEXPRESSPORT</span><br><span class="hljs-comment"># Datatype      : Number</span><br><span class="hljs-comment"># Description   : Enterprise Manager Configuration Type</span><br><span class="hljs-comment"># Valid values  : Check Oracle12c Administrator&#x27;s Guide</span><br><span class="hljs-comment"># Default value : NONE</span><br><span class="hljs-comment"># Mandatory     : No, will be picked up from DBEXPRESS_HTTPS_PORT env variable</span><br><span class="hljs-comment">#                 or auto generates a free port between 5500 and 5599</span><br><span class="hljs-comment">#-----------------------------------------------------------------------------</span><br><span class="hljs-comment">#EMEXPRESSPORT = &quot;&quot;</span><br><br><span class="hljs-comment">#-----------------------*** End of configurePluggableDatabase section ***------------------------</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>rsp</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 11g for Oracle Standalone Clusters</title>
    <url>/blog/posts/52773.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-11g-for-Oracle-Standalone-Clusters"><a href="#Install-Oracle-11g-for-Oracle-Standalone-Clusters" class="headerlink" title="Install Oracle 11g for Oracle Standalone Clusters"></a>Install Oracle 11g for Oracle Standalone Clusters</h1><blockquote>
<p>Operation System:<br>Database Software:<br>Database Patches: </p>
</blockquote>
<h2 id="Oracle-Standalone-Cluster-Requirements"><a href="#Oracle-Standalone-Cluster-Requirements" class="headerlink" title="Oracle Standalone Cluster Requirements"></a>Oracle Standalone Cluster Requirements</h2><h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Setting YUM Repository</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">mount /dev/sr0 /mnt<br><span class="hljs-built_in">cat</span> &gt; /etc/yum.repos.d/media.repo &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[InstallMedia_BaseOS]</span><br><span class="hljs-string">name=Red Hat Enterprise Linux 8.7.0 BaseOS</span><br><span class="hljs-string">baseurl=file:///mnt/BaseOS</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string"></span><br><span class="hljs-string">[InstallMedia_AppStream]</span><br><span class="hljs-string">name=Red Hat Enterprise Linux 8.7.0 AppStream</span><br><span class="hljs-string">baseurl=file:///mnt/AppStream</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">EOF</span><br><br>yum clean all &amp;&amp; yum makecache<br></code></pre></td></tr></table></figure>

<p><strong>Checking Package Requirements</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">rpm -q --qf <span class="hljs-string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n&#x27;</span> \<br>bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \<br>glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \<br>libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \<br>libxcb libibverbs make smartmontools sysstat<br></code></pre></td></tr></table></figure>

<p><strong>Installing Packages</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">yum -y install bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \<br>glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \<br>libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \<br>libxcb libibverbs make smartmontools sysstat<br></code></pre></td></tr></table></figure>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Setting hosts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">192.168.3.101   oracle19crac01</span><br><span class="hljs-string">192.168.3.102   oracle19crac02</span><br><span class="hljs-string">192.168.3.103   oracle19crac01-vip</span><br><span class="hljs-string">192.168.3.104   oracle19crac02-vip</span><br><span class="hljs-string">192.168.3.105   oracle19crac-scan</span><br><span class="hljs-string">100.100.100.101 oracle19crac01-priv</span><br><span class="hljs-string">100.100.100.102 oracle19crac02-priv</span><br></code></pre></td></tr></table></figure>

<p><strong>Disable Firewall and SElinux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">disable</span> firewalld --now<br>sed -i <span class="hljs-string">&#x27;/SELINUX=/&#123;s/enforcing/disabled/&#125;&#x27;</span> /etc/selinux/config<br></code></pre></td></tr></table></figure>

<p><strong>Creating Oracle User Accounts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">groupadd -g 1000 oinstall<br>groupadd -g 1200 asmadmin<br>groupadd -g 1201 asmdba<br>groupadd -g 1202 asmoper<br>groupadd -g 1300 dba<br>groupadd -g 1301 oper<br>useradd -c <span class="hljs-string">&quot;Oracle software owner&quot;</span> -u 1100 -g oinstall -G asmadmin,asmdba,asmoper grid<br>useradd -c <span class="hljs-string">&quot;Grid software owner&quot;</span> -u 1101 -g oinstall -G dba,oper,asmdba oracle<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;oracle&quot;</span> | passwd --stdin oracle<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;grid&quot;</span> | passwd --stdin grid<br></code></pre></td></tr></table></figure>

<p><strong>Creating Oracle Directories</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /u01/app/11.2.0/grid<br><span class="hljs-built_in">mkdir</span> -p /u01/app/grid<br><span class="hljs-built_in">mkdir</span> -p /u01/app/oraInventory<br><span class="hljs-built_in">mkdir</span> -p /u01/app/oracle/product/11.2.0/db_1<br><span class="hljs-built_in">chown</span> -R grid:oinstall /u01<br><span class="hljs-built_in">chown</span> -R oracle:oinstall /u01/app/oracle<br><span class="hljs-built_in">chmod</span> -R 775 /u01/<br></code></pre></td></tr></table></figure>

<p><strong>Setting Oracle Environment Variables</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-built_in">export</span> ORACLE_SID=coco1<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/11.2.0/db_1<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib<br><span class="hljs-built_in">alias</span> sqlplus=<span class="hljs-string">&#x27;rlwrap sqlplus&#x27;</span><br><span class="hljs-built_in">alias</span> rman=<span class="hljs-string">&#x27;rlwrap rman&#x27;</span><br>EOF<br>su - oracle -c <span class="hljs-string">&#x27;source ~/.bash_profile&#x27;</span><br><br><span class="hljs-built_in">cat</span> &gt;&gt; /home/grid/.bash_profile &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-built_in">export</span> ORACLE_SID=+ASM1<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/grid<br><span class="hljs-built_in">export</span> ORACLE_HOME=/u01/app/11.2.0/grid<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib<br><span class="hljs-built_in">alias</span> sqlplus=<span class="hljs-string">&#x27;rlwrap sqlplus&#x27;</span><br>EOF<br>su - grid -c <span class="hljs-string">&#x27;source ~/.bash_profile&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Setting kernel parameters</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; /etc/sysctl.d/99-oracle-database-preinstall-11g-sysctl.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">fs.file-max = 6815744</span><br><span class="hljs-string">kernel.sem = 250 32000 100 128</span><br><span class="hljs-string">kernel.shmmni = 4096</span><br><span class="hljs-string">kernel.shmall = 1073741824</span><br><span class="hljs-string">kernel.shmmax = 4398046511104</span><br><span class="hljs-string">kernel.panic_on_oops = 1</span><br><span class="hljs-string">net.core.rmem_default = 262144</span><br><span class="hljs-string">net.core.rmem_max = 4194304</span><br><span class="hljs-string">net.core.wmem_default = 262144</span><br><span class="hljs-string">net.core.wmem_max = 1048576</span><br><span class="hljs-string">net.ipv4.conf.all.rp_filter = 2</span><br><span class="hljs-string">net.ipv4.conf.default.rp_filter = 2</span><br><span class="hljs-string">fs.aio-max-nr = 1048576</span><br><span class="hljs-string">net.ipv4.ip_local_port_range = 9000 65500</span><br></code></pre></td></tr></table></figure>

<p><strong>Setting shell limits</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; /etc/security/limits.d/oracle-database-preinstall-11g.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">oracle   soft   nofile    1024</span><br><span class="hljs-string">oracle   hard   nofile    65536</span><br><span class="hljs-string">oracle   soft   nproc    16384</span><br><span class="hljs-string">oracle   hard   nproc    16384</span><br><span class="hljs-string">oracle   soft   stack    10240</span><br><span class="hljs-string">oracle   hard   stack    32768</span><br><span class="hljs-string">oracle   hard   memlock    134217728</span><br><span class="hljs-string">oracle   soft   memlock    134217728</span><br><span class="hljs-string">grid   soft   nofile    1024</span><br><span class="hljs-string">grid   hard   nofile    65536</span><br><span class="hljs-string">grid   soft   nproc    16384</span><br><span class="hljs-string">grid   hard   nproc    16384</span><br><span class="hljs-string">grid   soft   stack    10240</span><br><span class="hljs-string">grid   hard   stack    32768</span><br><span class="hljs-string">grid   hard   memlock    134217728</span><br><span class="hljs-string">grid   soft   memlock    134217728</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-SSH-Manually-on-All-Cluster-Nodes"><a href="#Configuring-SSH-Manually-on-All-Cluster-Nodes" class="headerlink" title="Configuring SSH Manually on All Cluster Nodes"></a>Configuring SSH Manually on All Cluster Nodes</h3><h3 id="Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB"><a href="#Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB" class="headerlink" title="Configuring Storage Device Path Persistence Using Oracle ASMLIB"></a>Configuring Storage Device Path Persistence Using Oracle ASMLIB</h3><h2 id="Installing-the-cvuqdisk-RPM-for-Linux"><a href="#Installing-the-cvuqdisk-RPM-for-Linux" class="headerlink" title="Installing the cvuqdisk RPM for Linux"></a>Installing the cvuqdisk RPM for Linux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">CVUQDISK_GRP=oinstall; <span class="hljs-built_in">export</span> CVUQDISK_GRP<br>rpm -iv /u01/app/19.0.0/grid/cv/rpm/cvuqdisk-1.0.10-1.rpm<br></code></pre></td></tr></table></figure>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R grid:oinstall /soft/LINUX.X64_193000_grid_home.zip<br><br><span class="hljs-comment"># Login as grid user</span><br>unzip -q /soft/LINUX.X64_193000_grid_home.zip -d /u01/app/19.0.0/grid/<br>/u01/app/19.0.0/grid/gridSetup.sh<br></code></pre></td></tr></table></figure>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R oracle:oinstall /soft/LINUX.X64_193000_db_home.zip<br><br><span class="hljs-comment"># Login as oracle user</span><br>unzip -q /soft/LINUX.X64_193000_db_home.zip -d /u01/app/oracle/product/19.0.0/db_1/<br>/u01/app/oracle/product/19.0.0/db_1/runInstaller<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 10g</title>
    <url>/blog/posts/48576.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-10g"><a href="#Install-Oracle-10g" class="headerlink" title="Install Oracle 10g"></a>Install Oracle 10g</h1><blockquote>
<p>Operation System: CentOS Linux release 7.9.2009 (Core)<br>Database Software: 10201_database_linux_x86_64.cpio<br>Database Patches: p8202632_10205_Linux-x86-64.zip</p>
</blockquote>
<h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Checking Package Requirements</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">rpm -q --qf <span class="hljs-string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n&#x27;</span> \<br>make gcc glibc glibc-devel compat-db compat-gcc compat-gcc-c++ \<br>compat-libstdc++ compat-libstdc++-devel gnome-libs openmotif21 setarch \<br>libaio libaio-devel<br></code></pre></td></tr></table></figure>

<p><strong>Installing Packages</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">yum -y install binutils compat-libstdc++-33 compat-libstdc++-33.i686 \<br>elfutils-libelf elfutils-libelf-devel gcc gcc-c++ glibc glibc.i686 glibc-common \<br>glibc-devel glibc-devel.i686 glibc-headers ksh libaio libaio.i686 libaio-devel \<br>libaio-devel.i686 libgcc libgcc.i686 libstdc++ libstdc++.i686 libstdc++-devel make sysstat<br></code></pre></td></tr></table></figure>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Disable Firewall and SElinux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.184.150 `hostname`&quot;</span> &gt;&gt; /etc/hosts<br>systemctl <span class="hljs-built_in">disable</span> firewalld --now<br>sed -i <span class="hljs-string">&#x27;/SELINUX=/&#123;s/enforcing/disabled/&#125;&#x27;</span> /etc/selinux/config<br></code></pre></td></tr></table></figure>

<p><strong>Creating Oracle User Accounts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">groupadd oinstall<br>groupadd dba<br>useradd -c <span class="hljs-string">&quot;Oracle software owner&quot;</span> -g oinstall -G dba oracle<br><span class="hljs-built_in">echo</span> oracle | passwd --stdin oracle<br></code></pre></td></tr></table></figure>

<p><strong>Creating Oracle Directories</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /u01/app<br><span class="hljs-built_in">chown</span> -R oracle.oinstall /u01<br><span class="hljs-built_in">chmod</span> 775 -R /u01<br></code></pre></td></tr></table></figure>

<p><strong>Setting Oracle Environment Variables</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br><span class="hljs-built_in">export</span> ORACLE_SID=orcl<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/10.2.0/db_1<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:<span class="hljs-variable">$ORACLE_HOME</span>/lib32<br>EOF<br></code></pre></td></tr></table></figure>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Changing system release</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sed -i -e <span class="hljs-string">&#x27;s/CentOS/# CentOS/&#x27;</span> -e <span class="hljs-string">&#x27;1i redhat 4&#x27;</span> /etc/redhat-release<br></code></pre></td></tr></table></figure>

<p><strong>Setting kernel parameters</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">kernel.shmall = 4294967296</span><br><span class="hljs-string">kernel.shmmax = 68719476736</span><br><span class="hljs-string">kernel.shmmni = 4096</span><br><span class="hljs-string">kernel.sem = 250 32000 100 128</span><br><span class="hljs-string">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class="hljs-string">net.core.rmem_default = 4194304</span><br><span class="hljs-string">net.core.rmem_max = 4194304</span><br><span class="hljs-string">net.core.wmem_default = 262144</span><br><span class="hljs-string">net.core.wmem_max = 262144</span><br><span class="hljs-string"># hugetlb_shm_group is dba group id</span><br><span class="hljs-string">vm.hugetlb_shm_group = 1001</span><br><span class="hljs-string">EOF</span><br><br>sysctl -p<br></code></pre></td></tr></table></figure>

<p><strong>Setting shell limits</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">oracle soft nproc 2047</span><br><span class="hljs-string">oracle hard nproc 16384</span><br><span class="hljs-string">oracle soft nofile 1024</span><br><span class="hljs-string">oracle hard nofile 65536</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<p><strong>Setting pam login</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/pam.d/login &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">session required /lib64/security/pam_limits.so</span><br><span class="hljs-string">session required pam_limits.so</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<h2 id="Unpacking-the-Installation-Files-and-starting-runInstaller"><a href="#Unpacking-the-Installation-Files-and-starting-runInstaller" class="headerlink" title="Unpacking the Installation Files and starting runInstaller"></a>Unpacking the Installation Files and starting runInstaller</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><br><span class="hljs-built_in">chown</span> -R oracle.oinstall /soft<br><span class="hljs-built_in">chmod</span> -R 775 /soft<br><br><span class="hljs-comment"># Login as oracle user</span><br><span class="hljs-built_in">cd</span> /soft<br>gunzip 10201_database_linux_x86_64.cpio.gz<br>cpio -idmv &lt; 10201_database_linux_x86_64.cpio<br>database/runInstaller<br></code></pre></td></tr></table></figure>

<h2 id="Patching-Oracle-10g-to-10-2-0-5-19"><a href="#Patching-Oracle-10g-to-10-2-0-5-19" class="headerlink" title="Patching Oracle 10g to 10.2.0.5.19"></a>Patching Oracle 10g to 10.2.0.5.19</h2><p><strong>Patching to 10.2.0.5.0</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Login as oracle user</span><br>unzip p8202632_10205_Linux-x86-64.zip<br>/soft/Disk1/runInstaller<br></code></pre></td></tr></table></figure>

<p><strong>Patching to 10.2.0.5.19</strong></p>
<p><a href="https://jove-2761781.github.io/hexo_blog/database/oracle/upgrade/patch%20p20299014/">patch p20299014</a></p>
<h2 id="Oracle-Post-Installation-Tasks"><a href="#Oracle-Post-Installation-Tasks" class="headerlink" title="Oracle Post Installation Tasks"></a>Oracle Post Installation Tasks</h2><p><strong>Setting automatic restart</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sed -i <span class="hljs-string">&#x27;s/N$/Y/&#x27;</span> /etc/oratab<br><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/rc.d/rc.local &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">su oracle -lc &quot;/u01/app/oracle/product/10.2.0/db_1/bin/lsnrctl start&quot;</span><br><span class="hljs-string">su oracle -lc &quot;/u01/app/oracle/product/10.2.0/db_1/bin/dbstart&quot;</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">chmod</span> +x /etc/rc.d/rc.local<br></code></pre></td></tr></table></figure>

<p><strong>Setting EM</strong></p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">emca -repos recreate<br>emca -config dbcontrol db -repos create<br>emca -deconfig dbcontrol db -repos drop<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Deinstall for RAC</title>
    <url>/blog/posts/10622.html</url>
    <content><![CDATA[<h1 id="Deinstall-for-rac-11g-and-latest"><a href="#Deinstall-for-rac-11g-and-latest" class="headerlink" title="Deinstall for rac 11g and latest"></a>Deinstall for rac 11g and latest</h1><p>执行如下操作(所有的目录以实际为准)：<br>关闭数据库，如果数据库关闭不了强行杀进程，关闭监听。<br>清除GRID家目录(视版本而定)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf /u01/app/grid/*<br><span class="hljs-built_in">rm</span> -rf /u01/app/11.2.0/*<br></code></pre></td></tr></table></figure>

<p>清除ORACLE家目录(视版本而定)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf /u01/app/oraInventory/*<br><span class="hljs-built_in">rm</span> -rf /u01/app/oracle/*<br></code></pre></td></tr></table></figure>

<p>清除相关文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf /tmp/.oracle<br><span class="hljs-built_in">rm</span> -rf /var/tmp/.oracle<br><span class="hljs-built_in">rm</span> -rf /etc/init/oracle-ohasd.conf<br><span class="hljs-built_in">rm</span> -rf /etc/init.d/ohasd<br><span class="hljs-built_in">rm</span> -rf /etc/init.d/init.ohasd<br><span class="hljs-built_in">rm</span> -rf /etc/oraInst.loc<br><span class="hljs-built_in">rm</span> -rf /etc/oratab<br><span class="hljs-built_in">rm</span> -rf /etc/oracle<br></code></pre></td></tr></table></figure>

<p>清除ASM磁盘信息(根据真实情况而定)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sdb bs=8192 count=128000<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sdc bs=8192 count=128000<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sdd bs=8192 count=128000<br></code></pre></td></tr></table></figure>

<h1 id="Deinstall-for-rac-10g"><a href="#Deinstall-for-rac-10g" class="headerlink" title="Deinstall for rac 10g"></a>Deinstall for rac 10g</h1><p>删除Oracle database db sofetware:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf /u01/app/oracle/product/10.2.0/db_1<br></code></pre></td></tr></table></figure>

<p>删除Oracle database clustware sofetware:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf /u01/app/oracle/product/10.2.0/crs_1<br><span class="hljs-built_in">rm</span> -rf /u01/app/oracle/oraInventory<br></code></pre></td></tr></table></figure>

<p>清除相关文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf /etc/rc.d/rc5.d/S96init.crs<br><span class="hljs-built_in">rm</span> -rf /etc/rc.d/init.d/init.crs<br><span class="hljs-built_in">rm</span> -rf /etc/rc.d/rc4.d/K96init.crs<br><span class="hljs-built_in">rm</span> -rf /etc/rc.d/rc6.d/K96init.crs<br><span class="hljs-built_in">rm</span> -rf /etc/rc.d/rc1.d/K96init.crs<br><span class="hljs-built_in">rm</span> -rf /etc/rc.d/rc0.d/K96init.crs<br><span class="hljs-built_in">rm</span> -rf /etc/rc.d/rc2.d/K96init.crs<br><span class="hljs-built_in">rm</span> -rf /etc/rc.d/rc3.d/S96init.crs<br><br><span class="hljs-built_in">rm</span> -rf /etc/oracle/*<br><span class="hljs-built_in">rm</span> -rf /etc/oraInst.loc<br><span class="hljs-built_in">rm</span> -rf /etc/oratab<br><br><span class="hljs-built_in">rm</span> -rf /usr/local/bin/coraenv<br><span class="hljs-built_in">rm</span> -rf /usr/local/bin/dbhome<br><span class="hljs-built_in">rm</span> -rf /usr/local/bin/oraenv<br><br><span class="hljs-built_in">rm</span> -f /etc/init.d/init.cssd<br><span class="hljs-built_in">rm</span> -f /etc/init.d/init.crs<br><span class="hljs-built_in">rm</span> -f /etc/init.d/init.crsd<br><span class="hljs-built_in">rm</span> -f /etc/init.d/init.evmd<br><br><span class="hljs-built_in">rm</span> -f /etc/rc2.d/K96init.crs<br><span class="hljs-built_in">rm</span> -f /etc/rc2.d/S96init.crs<br><span class="hljs-built_in">rm</span> -f /etc/rc3.d/K96init.crs<br><span class="hljs-built_in">rm</span> -f /etc/rc3.d/S96init.crs<br><span class="hljs-built_in">rm</span> -f /etc/rc5.d/K96init.crs<br><span class="hljs-built_in">rm</span> -f /etc/rc5.d/S96init.crs<br><br><span class="hljs-built_in">rm</span> -f /etc/inittab.crs<br><br><span class="hljs-comment"># restore inittab</span><br><span class="hljs-built_in">mv</span> /etc/inittab /etc/inittab_bak<br><span class="hljs-built_in">cp</span> /etc/inittab.orig /etc/inittab<br></code></pre></td></tr></table></figure>

<p>清理裸设备：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/raw/raw1 bs=1M count=300<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/raw/raw2 bs=1M count=300<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/raw/raw3 bs=1M count=300<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>deinstall</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 19c for Oracle Standalone Clusters</title>
    <url>/blog/posts/15686.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-19c-for-Oracle-Standalone-Clusters"><a href="#Install-Oracle-19c-for-Oracle-Standalone-Clusters" class="headerlink" title="Install Oracle 19c for Oracle Standalone Clusters"></a>Install Oracle 19c for Oracle Standalone Clusters</h1><blockquote>
<p>Operation System: Linux 4.18.0-425.3.1.el8.x86_64<br>Database Software: LINUX.X64_193000_grid_home.zip, LINUX.X64_193000_db_home.zip<br>Database Patches: </p>
</blockquote>
<h2 id="Oracle-Standalone-Cluster-Requirements"><a href="#Oracle-Standalone-Cluster-Requirements" class="headerlink" title="Oracle Standalone Cluster Requirements"></a>Oracle Standalone Cluster Requirements</h2><p>Minimum Available Space Requirements for Oracle Standalone Cluster With GIMR Configuration</p>
<table>
<thead>
<tr>
<th>Redundancy Level</th>
<th>DATA Disk Group</th>
<th>MGMT Disk Group</th>
<th>Oracle Fleet Patching and Provisioning</th>
<th>Total Storage</th>
</tr>
</thead>
<tbody><tr>
<td>External</td>
<td>1 GB</td>
<td>28 GB Each node beyond four: 5 GB</td>
<td>1 GB</td>
<td>30 GB</td>
</tr>
<tr>
<td>Normal</td>
<td>2 GB</td>
<td>56 GB Each node beyond four: 5 GB</td>
<td>2 GB</td>
<td>60 GB</td>
</tr>
<tr>
<td>High&#x2F;Flex&#x2F;Extended</td>
<td>3 GB</td>
<td>84 GB Each node beyond four: 5 GB</td>
<td>3 GB</td>
<td>90 GB</td>
</tr>
</tbody></table>
<p>:::info<br>a. The DATA disk group stores OCR and voting files, and the MGMT disk group stores GIMR and Oracle Clusterware backup files.<br>b. Starting with Oracle Grid Infrastructure 19c, configuring GIMR is optional for Oracle Standalone Cluster deployments.<br>:::</p>
<h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Setting YUM Repository</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">mount /dev/sr0 /mnt<br><span class="hljs-built_in">cat</span> &gt; /etc/yum.repos.d/media.repo &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">[InstallMedia_BaseOS]</span><br><span class="hljs-string">name=Red Hat Enterprise Linux 8.7.0 BaseOS</span><br><span class="hljs-string">baseurl=file:///mnt/BaseOS</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string"></span><br><span class="hljs-string">[InstallMedia_AppStream]</span><br><span class="hljs-string">name=Red Hat Enterprise Linux 8.7.0 AppStream</span><br><span class="hljs-string">baseurl=file:///mnt/AppStream</span><br><span class="hljs-string">gpgcheck=0</span><br><span class="hljs-string">enabled=1</span><br><span class="hljs-string">EOF</span><br><br>yum clean all &amp;&amp; yum makecache<br></code></pre></td></tr></table></figure>

<p><strong>Checking Package Requirements</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">rpm -q --qf <span class="hljs-string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n&#x27;</span> \<br>bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \<br>glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \<br>libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \<br>libxcb libibverbs make smartmontools sysstat<br></code></pre></td></tr></table></figure>

<p><strong>Installing Packages</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">yum -y install bc binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel \<br>glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau \<br>libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel \<br>libxcb libibverbs make smartmontools sysstat<br></code></pre></td></tr></table></figure>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Setting hosts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">192.168.3.101   oracle19crac01</span><br><span class="hljs-string">192.168.3.102   oracle19crac02</span><br><span class="hljs-string">192.168.3.103   oracle19crac01-vip</span><br><span class="hljs-string">192.168.3.104   oracle19crac02-vip</span><br><span class="hljs-string">192.168.3.105   oracle19crac-scan</span><br><span class="hljs-string">100.100.100.101 oracle19crac01-priv</span><br><span class="hljs-string">100.100.100.102 oracle19crac02-priv</span><br></code></pre></td></tr></table></figure>

<p><strong>Disable Firewall and SElinux</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">disable</span> firewalld --now<br>sed -i <span class="hljs-string">&#x27;/SELINUX=/&#123;s/enforcing/disabled/&#125;&#x27;</span> /etc/selinux/config<br></code></pre></td></tr></table></figure>

<p><strong>Creating Oracle User Accounts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">groupadd -g 54321 oinstall<br>groupadd -g 54322 dba<br>groupadd -g 54323 oper<br>groupadd -g 54324 backupdba<br>groupadd -g 54325 dgdba<br>groupadd -g 54326 kmdba<br>groupadd -g 54327 asmdba<br>groupadd -g 54328 asmoper<br>groupadd -g 54329 asmadmin<br>groupadd -g 54330 racdba<br>useradd -c <span class="hljs-string">&quot;Oracle software owner&quot;</span> -u 54321 -g oinstall -G dba,oper,backupdba,dgdba,kmdba,asmdba,racdba oracle<br>useradd -c <span class="hljs-string">&quot;Grid software owner&quot;</span> -u 54331 -g oinstall -G dba,asmdba,asmoper,asmadmin,racdba grid<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;oracle&quot;</span> | passwd --stdin oracle <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;grid&quot;</span> | passwd --stdin grid<br></code></pre></td></tr></table></figure>

<p><strong>Creating Oracle Directories</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /u01/app/19.0.0/grid<br><span class="hljs-built_in">mkdir</span> -p /u01/app/grid<br><span class="hljs-built_in">mkdir</span> -p /u01/app/oracle/product/19.0.0/db_1<br><span class="hljs-built_in">chown</span> -R grid:oinstall /u01<br><span class="hljs-built_in">chown</span> -R oracle:oinstall /u01/app/oracle<br><span class="hljs-built_in">chmod</span> -R 775 /u01/<br></code></pre></td></tr></table></figure>

<p><strong>Setting Oracle Environment Variables</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-built_in">export</span> ORACLE_SID=coco1<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/19.0.0/db_1<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib<br><span class="hljs-built_in">alias</span> sqlplus=<span class="hljs-string">&#x27;rlwrap sqlplus&#x27;</span><br><span class="hljs-built_in">alias</span> rman=<span class="hljs-string">&#x27;rlwrap rman&#x27;</span><br>EOF<br>su - oracle -c <span class="hljs-string">&#x27;source ~/.bash_profile&#x27;</span><br><br><span class="hljs-built_in">cat</span> &gt;&gt; /home/grid/.bash_profile &lt;&lt; <span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-built_in">export</span> ORACLE_SID=+ASM1<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/grid<br><span class="hljs-built_in">export</span> ORACLE_HOME=/u01/app/19.0.0/grid<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib<br><span class="hljs-built_in">alias</span> sqlplus=<span class="hljs-string">&#x27;rlwrap sqlplus&#x27;</span><br>EOF<br>su - grid -c <span class="hljs-string">&#x27;source ~/.bash_profile&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Setting kernel parameters</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; /etc/sysctl.d/99-oracle-database-preinstall-19c-sysctl.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">fs.file-max = 6815744</span><br><span class="hljs-string">kernel.sem = 250 32000 100 128</span><br><span class="hljs-string">kernel.shmmni = 4096</span><br><span class="hljs-string">kernel.shmall = 1073741824</span><br><span class="hljs-string">kernel.shmmax = 4398046511104</span><br><span class="hljs-string">kernel.panic_on_oops = 1</span><br><span class="hljs-string">net.core.rmem_default = 262144</span><br><span class="hljs-string">net.core.rmem_max = 4194304</span><br><span class="hljs-string">net.core.wmem_default = 262144</span><br><span class="hljs-string">net.core.wmem_max = 1048576</span><br><span class="hljs-string">net.ipv4.conf.all.rp_filter = 2</span><br><span class="hljs-string">net.ipv4.conf.default.rp_filter = 2</span><br><span class="hljs-string">fs.aio-max-nr = 1048576</span><br><span class="hljs-string">net.ipv4.ip_local_port_range = 9000 65500</span><br></code></pre></td></tr></table></figure>

<p><strong>Setting shell limits</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; /etc/security/limits.d/oracle-database-preinstall-19c.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">oracle soft nofile  1024</span><br><span class="hljs-string">oracle hard nofile  65536</span><br><span class="hljs-string">oracle soft nproc  16384</span><br><span class="hljs-string">oracle hard nproc  16384</span><br><span class="hljs-string">oracle soft stack  10240</span><br><span class="hljs-string">oracle hard stack  32768</span><br><span class="hljs-string">oracle hard memlock  134217728</span><br><span class="hljs-string">oracle soft memlock  134217728</span><br><span class="hljs-string">oracle soft data  unlimited</span><br><span class="hljs-string">oracle hard data  unlimited</span><br><span class="hljs-string">grid   soft   nofile    1024</span><br><span class="hljs-string">grid   hard   nofile    65536</span><br><span class="hljs-string">grid   soft   nproc    16384</span><br><span class="hljs-string">grid   hard   nproc    16384</span><br><span class="hljs-string">grid   soft   stack    10240</span><br><span class="hljs-string">grid   hard   stack    32768</span><br><span class="hljs-string">grid   hard   memlock    134217728</span><br><span class="hljs-string">grid   soft   memlock    134217728</span><br><span class="hljs-string">grid   soft   data    unlimited</span><br><span class="hljs-string">grid   hard   data    unlimited</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-SSH-Manually-on-All-Cluster-Nodes"><a href="#Configuring-SSH-Manually-on-All-Cluster-Nodes" class="headerlink" title="Configuring SSH Manually on All Cluster Nodes"></a>Configuring SSH Manually on All Cluster Nodes</h3><h3 id="Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB"><a href="#Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB" class="headerlink" title="Configuring Storage Device Path Persistence Using Oracle ASMLIB"></a>Configuring Storage Device Path Persistence Using Oracle ASMLIB</h3><h2 id="Installing-the-cvuqdisk-RPM-for-Linux"><a href="#Installing-the-cvuqdisk-RPM-for-Linux" class="headerlink" title="Installing the cvuqdisk RPM for Linux"></a>Installing the cvuqdisk RPM for Linux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">CVUQDISK_GRP=oinstall; <span class="hljs-built_in">export</span> CVUQDISK_GRP<br>rpm -iv /u01/app/19.0.0/grid/cv/rpm/cvuqdisk-1.0.10-1.rpm<br></code></pre></td></tr></table></figure>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R grid:oinstall /soft/LINUX.X64_193000_grid_home.zip<br><br><span class="hljs-comment"># Login as grid user</span><br>unzip -q /soft/LINUX.X64_193000_grid_home.zip -d /u01/app/19.0.0/grid/<br>/u01/app/19.0.0/grid/gridSetup.sh<br></code></pre></td></tr></table></figure>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R oracle:oinstall /soft/LINUX.X64_193000_db_home.zip<br><br><span class="hljs-comment"># Login as oracle user</span><br>unzip -q /soft/LINUX.X64_193000_db_home.zip -d /u01/app/oracle/product/19.0.0/db_1/<br>/u01/app/oracle/product/19.0.0/db_1/runInstaller<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Oracle 9i</title>
    <url>/blog/posts/64269.html</url>
    <content><![CDATA[<h1 id="Install-Oracle-9i"><a href="#Install-Oracle-9i" class="headerlink" title="Install Oracle 9i"></a>Install Oracle 9i</h1><blockquote>
<p>Operation System: Red Hat Enterprise Linux AS release 4 (Nahant Update 8) Linux 2.6.9-89.ELsmp<br>Database Software: amd64_db_9204_Disk{1..3}.cpio.gz<br>Database Patches: p4547809_92080_Linux-x86-64.zip</p>
</blockquote>
<h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Checking Package Requirements</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">rpm -q --qf <span class="hljs-string">&#x27;%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125; (%&#123;ARCH&#125;)\n&#x27;</span> \binutils compat-db compat-libstdc++-296 \<br>control-center gcc gcc-c++ glibc glibc-common gnome-libs libstdc++ libstdc++-devel make pdksh \<br>setarch glibc glibc-devel libaio compat-gcc-32 compat-gcc-32-c++- glibc-devel.i386<br></code></pre></td></tr></table></figure>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Creating Oracle User Accounts</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">groupadd dba<br>groupadd oinstall<br>useradd -c <span class="hljs-string">&quot;Oracle software owner&quot;</span> -g oinstall -G dba oracle<br><span class="hljs-built_in">echo</span> oracle | passwd --stdin oracle<br></code></pre></td></tr></table></figure>

<p><strong>Creating Oracle Directories</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /u01/app/oracle/product/9.2.0<br><span class="hljs-built_in">chown</span> -R oracle.oinstall /u01<br><span class="hljs-built_in">chmod</span> -R 775 /u01<br></code></pre></td></tr></table></figure>

<p><strong>Setting Oracle Environment Variables</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /home/oracle/.bash_profile &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br><span class="hljs-comment"># The following is added for oracle 9i</span><br><span class="hljs-comment"># export LD_ASSUME_KERNEL=2.4.1    # for Red Hat Enterprise Linux 3</span><br><span class="hljs-built_in">export</span> LD_ASSUME_KERNEL=2.4.19   <span class="hljs-comment"># for Red Hat Enterprise Linux 4</span><br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/9.2.0<br><span class="hljs-built_in">export</span> ORACLE_SID=orcl<br><span class="hljs-built_in">export</span> ORACLE_TERM=xterm<br><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN;<br><span class="hljs-built_in">export</span> ORA_NLS33=<span class="hljs-variable">$ORACLE_HOME</span>/ocommon/nls/admin/data<br>LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib<br>LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:/usr/local/lib<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ORACLE_HOME</span>/bin<br>EOF<br></code></pre></td></tr></table></figure>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Setting kernel parameters</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/sysctl.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"># The following is added for oracle 9i</span><br><span class="hljs-string">kernel.sem=250 32000 100 128</span><br><span class="hljs-string">kernel.shmmax=4294967295</span><br><span class="hljs-string">kernel.shmmni=128</span><br><span class="hljs-string">kernel.shmall=2097152</span><br><span class="hljs-string">kernel.msgmnb=65536</span><br><span class="hljs-string">kernel.msgmni=2878</span><br><span class="hljs-string">fs.file-max=65536</span><br><span class="hljs-string">net.ipv4.ip_local_port_range=1024 65000</span><br><span class="hljs-string">EOF</span><br><br>sysctl -p<br></code></pre></td></tr></table></figure>

<p><strong>Setting shell limits</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/security/limits.conf &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"># The following is added for oracle 9i</span><br><span class="hljs-string">oracle  soft    nofile  65536</span><br><span class="hljs-string">oracle  hard    nofile  65536</span><br><span class="hljs-string">oracle  soft    nproc   16384</span><br><span class="hljs-string">oracle  hard    nproc   16384</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<h2 id="Unpacking-the-Installation-Files-and-starting-runInstaller"><a href="#Unpacking-the-Installation-Files-and-starting-runInstaller" class="headerlink" title="Unpacking the Installation Files and starting runInstaller"></a>Unpacking the Installation Files and starting runInstaller</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chown</span> -R oracle.dba /soft<br><span class="hljs-built_in">chmod</span> -R 775 /soft<br><br><span class="hljs-comment"># login as oracle user</span><br><span class="hljs-built_in">cd</span> /soft<br>zcat amd64_db_9204_Disk1.cpio.gz | cpio -idmv<br>zcat amd64_db_9204_Disk2.cpio.gz | cpio -idmv<br>zcat amd64_db_9204_Disk3.cpio.gz | cpio -idmv<br>Disk1/runInstaller<br></code></pre></td></tr></table></figure>

<p>Use <code>netca</code> create a listener, <code>dbca</code> create a instance.</p>
<h2 id="Patching-Oracle-9i-to-9-2-0-8-0"><a href="#Patching-Oracle-9i-to-9-2-0-8-0" class="headerlink" title="Patching Oracle 9i to 9.2.0.8.0"></a>Patching Oracle 9i to 9.2.0.8.0</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /soft<br>unzip p4547809_92080_Linux-x86-64.zip -d p4547809<br>p4547809/Disk1/runInstaller<br></code></pre></td></tr></table></figure>

<h2 id="Oracle-Post-Installation-Tasks"><a href="#Oracle-Post-Installation-Tasks" class="headerlink" title="Oracle Post Installation Tasks"></a>Oracle Post Installation Tasks</h2><p><strong>Setting automatic startup</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sed -i <span class="hljs-string">&#x27;/orcl/s/:N/:Y/&#x27;</span> /etc/oratab<br><br><span class="hljs-built_in">cat</span> &gt;&gt; /etc/rc.local &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"># The following is added for oracle 9i</span><br><span class="hljs-string">su - oracle -c &quot;lsnrctl start&quot;</span><br><span class="hljs-string">su - oracle -c &quot;dbstart&quot;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<h2 id="Oracle-Installation-Errors"><a href="#Oracle-Installation-Errors" class="headerlink" title="Oracle Installation Errors"></a>Oracle Installation Errors</h2><p>[Error in invoking target install of makefile ins_sqlplus.mk].{red}.<br>You may see the following errors in <code>$ORACLE_HOME/install/make.log</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs log">/usr/bin/ld: crt1.o: No such file: No such file or directory<br>collect2: ld returned 1 exit status<br>make[1]: *** [installisqlplus32] Error 1<br>make[1]: Leaving directory `/u01/app/oracle/product/9.2.0/sqlplus/lib&#x27;<br>make: *** [isqlplus] Error 2<br></code></pre></td></tr></table></figure>

<p>glibc-devel.i386 (32 bit) missing on this system and degrade gcc version to 3.2.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">rpm -ivh glibc-devel-2.3.4-2.43.i386.rpm<br><br><span class="hljs-built_in">mv</span> /usr/bin/gcc /usr/bin/gcc34<br><span class="hljs-built_in">mv</span> /usr/bin/g++ /usr/bin/g++34<br><span class="hljs-built_in">ln</span> -s /usr/bin/gcc32 /usr/bin/gcc<br><span class="hljs-built_in">ln</span> -s /usr/bin/g++32 /usr/bin/g++<br></code></pre></td></tr></table></figure>

<p>After that hit <strong>[Retry]</strong> in the error pop-up.</p>
<h1 id="Deinstall-Oracle-9i"><a href="#Deinstall-Oracle-9i" class="headerlink" title="Deinstall Oracle 9i"></a>Deinstall Oracle 9i</h1>   <figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -f /etc/oraInst.loc<br><span class="hljs-built_in">rm</span> -f /etc/oratab<br><span class="hljs-built_in">rm</span> -f /usr/local/bin/dbhome<br><span class="hljs-built_in">rm</span> -f /usr/local/bin/oraenv<br><span class="hljs-built_in">rm</span> -f /usr/local/bin/coraenv<br><span class="hljs-built_in">rm</span> -rf /u01<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle-database-preinstall-11g</title>
    <url>/blog/posts/35418.html</url>
    <content><![CDATA[<h1 id="Oracle-database-preinstall-11g"><a href="#Oracle-database-preinstall-11g" class="headerlink" title="Oracle-database-preinstall-11g"></a>Oracle-database-preinstall-11g</h1><h2 id="Installing-the-Oracle-Preinstallation-RPM"><a href="#Installing-the-Oracle-Preinstallation-RPM" class="headerlink" title="Installing the Oracle Preinstallation RPM"></a>Installing the Oracle Preinstallation RPM</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac-1 ~]<span class="hljs-comment"># yum -y install oracle-rdbms-server-11gR2-preinstall.x86_64</span><br>[root@rac-1 ~]<span class="hljs-comment"># cat /var/log/oracle-rdbms-server-11gR2-preinstall/results/orakernel.log</span><br>Adding group oinstall with gid 54321<br>Adding group dba<br>Adding user oracle with user <span class="hljs-built_in">id</span> 54321, initial login group oinstall, supplementary group dba and  home directory /home/oracle<br>Changing ownership of /home/oracle to oracle:oinstall<br>Please <span class="hljs-built_in">set</span> password <span class="hljs-keyword">for</span> oracle user<br>uid=54321(oracle) gid=54321(oinstall) <span class="hljs-built_in">groups</span>=54321(oinstall),54322(dba)<br>Creating oracle user passed<br><br>Saving a copy of the initial sysctl.conf<br>Verifying  kernel parameters as per Oracle recommendations...<br>Adding fs.file-max = 6815744<br>Adding kernel.sem = 250 32000 100 128<br>Adding kernel.shmmni = 4096<br>Adding kernel.shmall = 1073741824<br>Adding kernel.shmmax = 4398046511104<br>Adding kernel.panic_on_oops = 1<br>Adding net.core.rmem_default = 262144<br>Adding net.core.rmem_max = 4194304<br>Adding net.core.wmem_default = 262144<br>Adding net.core.wmem_max = 1048576<br>Adding net.ipv4.conf.all.rp_filter = 2<br>Adding net.ipv4.conf.default.rp_filter = 2<br>Adding fs.aio-max-nr = 1048576<br>Adding net.ipv4.ip_local_port_range = 9000 65500<br>Setting kernel parameters as per oracle recommendations...<br>Altered file /etc/sysctl.conf<br>Saved a copy of the current file <span class="hljs-keyword">in</span> /etc/sysctl.d/99-oracle-rdbms-server-11gR2-preinstall-sysctl.conf<br>Check /etc/sysctl.d <span class="hljs-keyword">for</span> backups<br>Verifying &amp; setting of kernel parameters passed<br><br>Setting user limits using /etc/security/limits.conf<br><br>Verifying oracle user OS limits as per Oracle recommendations...<br>Adding oracle soft nofile  1024<br>Adding oracle hard nofile  65536<br>Adding oracle soft <span class="hljs-built_in">nproc</span>  16384<br>Adding oracle hard <span class="hljs-built_in">nproc</span>  16384<br>Adding oracle soft stack  10240<br>Adding oracle hard stack  32768<br>Adding oracle hard memlock  134217728<br>Adding oracle soft memlock  134217728<br>Setting oracle user OS limits as per Oracle recommendations...<br>Altered file /etc/security/limits.conf<br>Original file backed up at /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00<br>Verifying &amp; setting of user limits passed<br><br>Saving a copy of /etc/default/grub file <span class="hljs-keyword">in</span> /etc/default/grub-initial.orabackup<br>Saving a copy of /etc/default/grub <span class="hljs-keyword">in</span> /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00...<br>Verifying kernel boot parameters as per Oracle recommendations...<br>old boot params: <span class="hljs-string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet&quot;</span><br>new boot params: <span class="hljs-string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span><br><br>old boot params: <span class="hljs-string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span><br>new boot params: <span class="hljs-string">&quot;rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never&quot;</span><br><br>Setting kernel boot parameters as per Oracle recommendations...<br>G_DIR=/boot/grub2<br>Default kernel is -&gt;  5.4.17-2011.6.2.el7uek.x86_64<br>Default saved_entry is -&gt; Oracle Linux Server (5.4.17-2011.6.2.el7uek.x86_64 with Unbreakable Enterprise Kernel) 7.9<br>Default saved_entry_line is -&gt;  linux16 /vmlinuz-5.4.17-2011.6.2.el7uek.x86_64<br>Saving a copy of grubenv... <span class="hljs-keyword">in</span> /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00<br>Generating grub configuration file ...<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15821: /usr/sbin/grub2-probe<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15821: /usr/sbin/grub2-probe<br>Found linux image: /boot/vmlinuz-5.4.17-2011.6.2.el7uek.x86_64<br>Found initrd image: /boot/initramfs-5.4.17-2011.6.2.el7uek.x86_64.img<br>Found linux image: /boot/vmlinuz-3.10.0-1160.el7.x86_64<br>Found initrd image: /boot/initramfs-3.10.0-1160.el7.x86_64.img<br>Found linux image: /boot/vmlinuz-0-rescue-1d1dab430dc147b6bd12cb0ed4a8e0cb<br>Found initrd image: /boot/initramfs-0-rescue-1d1dab430dc147b6bd12cb0ed4a8e0cb.img<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 16117: /usr/sbin/grub2-probe<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 16117: /usr/sbin/grub2-probe<br><span class="hljs-keyword">done</span><br>The saved kernel 5.4.17-2011.6.2.el7uek.x86_64 is now at position - 0<br>Boot parameters will be effected on next reboot<br>Altered file /etc/default/grub<br>Copy of the changed file is <span class="hljs-keyword">in</span> - /etc/default/grub-oracle-rdbms-server-11gR2-preinstall.orabackup<br>Copy of the original file is <span class="hljs-keyword">in</span> - /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00<br>Verifying &amp; setting of boot parameters passed<br><br>Trying to add NOZEROCONF parameter...<br>Taking a backup of existing file to /etc/sysconfig/network.orabackup<br>Successfully added parameter NOZEROCONF to /etc/sysconfig/network<br>Setting /etc/sysconfig/network parameters passed<br><br>Disabling Transparent Hugepages.<br>Refer Oracle Note:1557478.1<br><br>Disabling defrag.<br>Refer Oracle Note:1557478.1<br><br>Taking a backup of old config files under /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00<br></code></pre></td></tr></table></figure>

<h2 id="Creating-Owner-User"><a href="#Creating-Owner-User" class="headerlink" title="Creating Owner User"></a>Creating Owner User</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">groupadd -g 1000 oinstall<br>groupadd -g 1200 asmadmin<br>groupadd -g 1201 asmdba<br>groupadd -g 1202 asmoper<br>groupadd -g 1300 dba<br>groupadd -g 1301 oper<br>useradd -u 1100 -g oinstall -G asmadmin,asmdba,asmoper grid<br>useradd -u 1101 -g oinstall -G dba,oper,asmdba oracle<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;oracle&quot;</span> | passwd --stdin oracle <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;grid&quot;</span> | passwd --stdin grid<br></code></pre></td></tr></table></figure>

<h2 id="Creating-the-Oracle-Home-and-Oracle-Base-Directory"><a href="#Creating-the-Oracle-Home-and-Oracle-Base-Directory" class="headerlink" title="Creating the Oracle Home and Oracle Base Directory"></a>Creating the Oracle Home and Oracle Base Directory</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /u01/app/11.2.0/grid<br><span class="hljs-built_in">mkdir</span> -p /u01/app/grid<br><span class="hljs-built_in">mkdir</span> -p /u01/app/oraInventory<br><span class="hljs-built_in">mkdir</span> -p /u01/app/oracle/product/11.2.0/db_1<br><span class="hljs-built_in">chown</span> -R grid:oinstall /u01<br><span class="hljs-built_in">chown</span> -R oracle:oinstall /u01/app/oracle<br><span class="hljs-built_in">chmod</span> -R 775 /u01/<br></code></pre></td></tr></table></figure>

<h2 id="Configuring-Owner-User-Environments"><a href="#Configuring-Owner-User-Environments" class="headerlink" title="Configuring Owner User Environments"></a>Configuring Owner User Environments</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt;/home/oracle/.bash_profile &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-built_in">export</span> ORACLE_SID=coco1<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/11.2.0/db_1<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib<br><span class="hljs-built_in">alias</span> sqlplus=<span class="hljs-string">&#x27;rlwrap sqlplus&#x27;</span><br><span class="hljs-built_in">alias</span> rman=<span class="hljs-string">&#x27;rlwrap rman&#x27;</span><br>EOF<br>su - oracle -c <span class="hljs-string">&#x27;source ~/.bash_profile&#x27;</span><br><br><span class="hljs-built_in">cat</span> &gt;&gt;/home/grid/.bash_profile &lt;&lt;<span class="hljs-string">&quot;EOF&quot;</span><br><span class="hljs-built_in">export</span> ORACLE_SID=+ASM1<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/grid<br><span class="hljs-built_in">export</span> ORACLE_HOME=/u01/app/11.2.0/grid<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib<br><span class="hljs-built_in">alias</span> sqlplus=<span class="hljs-string">&#x27;rlwrap sqlplus&#x27;</span><br>EOF<br>su - grid -c <span class="hljs-string">&#x27;source ~/.bash_profile&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="Checking-Resource-Limits"><a href="#Checking-Resource-Limits" class="headerlink" title="Checking Resource Limits"></a>Checking Resource Limits</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac-1 ~]<span class="hljs-comment"># grep ^oracle /etc/security/limits.conf | sed &#x27;s/oracle/grid/&#x27; &gt;&gt; /etc/security/limits.conf</span><br>[root@rac-1 ~]<span class="hljs-comment"># grep -E &#x27;^oracle|^grid&#x27; /etc/security/limits.conf</span><br>oracle   soft   nofile    1024<br>oracle   hard   nofile    65536<br>oracle   soft   <span class="hljs-built_in">nproc</span>    16384<br>oracle   hard   <span class="hljs-built_in">nproc</span>    16384<br>oracle   soft   stack    10240<br>oracle   hard   stack    32768<br>oracle   hard   memlock    134217728<br>oracle   soft   memlock    134217728<br>grid   soft   nofile    1024<br>grid   hard   nofile    65536<br>grid   soft   <span class="hljs-built_in">nproc</span>    16384<br>grid   hard   <span class="hljs-built_in">nproc</span>    16384<br>grid   soft   stack    10240<br>grid   hard   stack    32768<br>grid   hard   memlock    134217728<br>grid   soft   memlock    134217728<br></code></pre></td></tr></table></figure>

<h2 id="Installing-the-cvuqdisk-RPM-for-Linux"><a href="#Installing-the-cvuqdisk-RPM-for-Linux" class="headerlink" title="Installing the cvuqdisk RPM for Linux"></a>Installing the cvuqdisk RPM for Linux</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">CVUQDISK_GRP=oinstall; <span class="hljs-built_in">export</span> CVUQDISK_GRP<br>rpm -iv /soft/grid/rpm/cvuqdisk-1.0.9-1.rpm<br></code></pre></td></tr></table></figure>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">unzip /soft/p13390677_112040_Linux-x86-64_3of7.zip<br><span class="hljs-built_in">chmod</span> -R 775 /soft/grid<br><span class="hljs-built_in">chown</span> -R grid:oinstall /soft/grid<br><br><span class="hljs-comment"># login oracle user</span><br><span class="hljs-built_in">cd</span> /soft/grid<br>./runInstaller<br></code></pre></td></tr></table></figure>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">unzip p13390677_112040_Linux-x86-64_1of7.zip; unzip p13390677_112040_Linux-x86-64_2of7.zip<br><span class="hljs-built_in">chmod</span> -R 775 /soft/database<br><span class="hljs-built_in">chown</span> -R oracle:oinstall /soft/database<br><br><span class="hljs-comment"># login oracle user</span><br><span class="hljs-built_in">cd</span> /soft/database<br>./runInstaller<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle-database-preinstall-19c</title>
    <url>/blog/posts/35164.html</url>
    <content><![CDATA[<h1 id="Oracle-database-preinstall-19c"><a href="#Oracle-database-preinstall-19c" class="headerlink" title="Oracle-database-preinstall-19c"></a>Oracle-database-preinstall-19c</h1><h2 id="Installing-the-Oracle-Preinstallation-RPM"><a href="#Installing-the-Oracle-Preinstallation-RPM" class="headerlink" title="Installing the Oracle Preinstallation RPM"></a>Installing the Oracle Preinstallation RPM</h2><p>Use Oracle Preinstallation RPM to simplify operating system configuration in preparation for Oracle software installations.</p>
<ul>
<li><p>When installed, the Oracle Preinstallation RPM does the following:<br>Automatically downloads and installs any additional RPM packages needed forinstalling Oracle Grid Infrastructure and Oracle Database, and resolves anydependencies</p>
</li>
<li><p>Creates an oracle user, and creates the oraInventory (oinstall) and OSDBA (dba) groups for that user</p>
</li>
<li><p>As needed, sets sysctl.conf settings, system startup parameters, and driver parameters to values based on recommendations from the Oracle Preinstallation RPM program</p>
</li>
<li><p>Sets hard and soft resource limits</p>
</li>
<li><p>Sets other recommended parameters, depending on your kernel version</p>
</li>
<li><p>Sets numa&#x3D;off in the kernel for Linux x86_64 machines.</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@oracle19c ~]<span class="hljs-comment"># yum install -y oracle-database-preinstall-19c</span><br>[root@oracle19c ~]<span class="hljs-comment"># cat /var/log/oracle-database-preinstall-19c/results/orakernel.log</span><br>Adding group oinstall with gid 54321<br>Adding group dba with gid 54322<br>Adding group oper with gid 54323<br>Adding group backupdba with gid 54324<br>Adding group dgdba with gid 54325<br>Adding group kmdba with gid 54326<br>Adding group racdba with gid 54330<br>Adding user oracle with user <span class="hljs-built_in">id</span> 54321, initial login group oinstall, supplementary <span class="hljs-built_in">groups</span> oinstall,dba,oper,backupdba,dgdba,kmdba,racdba and  home directory /home/oracle<br>Changing ownership of /home/oracle to oracle:oinstall<br>Please <span class="hljs-built_in">set</span> password <span class="hljs-keyword">for</span> user - oracle<br>uid=54321(oracle) gid=54321(oinstall) <span class="hljs-built_in">groups</span>=54321(oinstall),54330(racdba),54322(dba),54323(oper),54324(backupdba),54325(dgdba),54326(kmdba)<br>User creation passed<br><br>Saving a copy of the initial sysctl.conf<br>Verifying  kernel parameters as per Oracle recommendations...<br>Adding fs.file-max = 6815744<br>Adding kernel.sem = 250 32000 100 128<br>Adding kernel.shmmni = 4096<br>Adding kernel.shmall = 1073741824<br>Adding kernel.shmmax = 4398046511104<br>Adding kernel.panic_on_oops = 1<br>Adding net.core.rmem_default = 262144<br>Adding net.core.rmem_max = 4194304<br>Adding net.core.wmem_default = 262144<br>Adding net.core.wmem_max = 1048576<br>Adding net.ipv4.conf.all.rp_filter = 2<br>Adding net.ipv4.conf.default.rp_filter = 2<br>Adding fs.aio-max-nr = 1048576<br>Adding net.ipv4.ip_local_port_range = 9000 65500<br>Setting kernel parameters as per oracle recommendations...<br>Altered file /etc/sysctl.conf<br>Saved a copy of the current file <span class="hljs-keyword">in</span> /etc/sysctl.d/99-oracle-database-preinstall-19c-sysctl.conf<br>Check /etc/sysctl.d <span class="hljs-keyword">for</span> backups<br>Verification &amp; setting of kernel parameters passed<br><br>Setting user limits using /etc/security/limits.d/oracle-database-preinstall-19c.conf<br><br>Verifying oracle user OS limits as per Oracle recommendations...<br>Adding oracle soft nofile  1024<br>Adding oracle hard nofile  65536<br>Adding oracle soft <span class="hljs-built_in">nproc</span>  16384<br>Adding oracle hard <span class="hljs-built_in">nproc</span>  16384<br>Adding oracle soft stack  10240<br>Adding oracle hard stack  32768<br>Adding oracle hard memlock  134217728<br>Adding oracle soft memlock  134217728<br>Adding oracle soft data  unlimited<br>Adding oracle hard data  unlimited<br>Setting oracle user OS limits as per Oracle recommendations...<br>Altered file /etc/security/limits.d/oracle-database-preinstall-19c.conf<br>Original file backed up at /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53<br>Verification &amp; setting of user limits passed<br><br>Saving a copy of /etc/default/grub file <span class="hljs-keyword">in</span> /etc/default/grub-initial.orabackup<br>Saving a copy of /etc/default/grub <span class="hljs-keyword">in</span> /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53...<br>Verifying kernel boot parameters as per Oracle recommendations...<br>old boot params: <span class="hljs-string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet&quot;</span><br>new boot params: <span class="hljs-string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span><br><br>Setting boot params - Checking <span class="hljs-keyword">for</span> blscfg<br>GRUB_ENABLE_BLSCFG=<span class="hljs-literal">true</span><br>options <span class="hljs-variable">$kernelopts</span> <span class="hljs-variable">$tuned_params</span><br>options <span class="hljs-variable">$kernelopts</span> <span class="hljs-variable">$tuned_params</span><br>options <span class="hljs-variable">$kernelopts</span> <span class="hljs-variable">$tuned_params</span><br>old boot params: <span class="hljs-string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off&quot;</span><br>new boot params: <span class="hljs-string">&quot;resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never&quot;</span><br><br>Setting boot params - Checking <span class="hljs-keyword">for</span> blscfg<br>GRUB_ENABLE_BLSCFG=<span class="hljs-literal">true</span><br>options <span class="hljs-variable">$kernelopts</span> <span class="hljs-variable">$tuned_params</span><br>options <span class="hljs-variable">$kernelopts</span> <span class="hljs-variable">$tuned_params</span><br>options <span class="hljs-variable">$kernelopts</span> <span class="hljs-variable">$tuned_params</span><br>Setting kernel boot parameters as per Oracle recommendations...<br>G_DIR=/boot/grub2<br>Checking <span class="hljs-keyword">for</span> blscfg<br>GRUB_ENABLE_BLSCFG=<span class="hljs-literal">true</span><br>Saved Entry = 63e2e66b7eb349e4b44eded7924c6643-5.4.17-2136.300.7.el8uek.x86_64<br>Running grub2-mkconfig<br>Generating grub configuration file ...<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15020: /usr/sbin/grub2-probe<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15020: /usr/sbin/grub2-probe<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15195: /usr/sbin/grub2-probe<br>File descriptor 199 (/run/lock/subsys/oracle-preinstall.lock) leaked on vgs invocation. Parent PID 15195: /usr/sbin/grub2-probe<br><span class="hljs-keyword">done</span><br>Restore default<br>Boot parameters will be effected on next reboot<br>Altered file /etc/default/grub<br>Copy of the changed file is <span class="hljs-keyword">in</span> - /etc/default/grub-oracle-database-preinstall-19c.orabackup<br>Copy of the original file is <span class="hljs-keyword">in</span> - /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53<br>Verification &amp; setting of boot parameters passed<br><br>Trying to add NOZEROCONF parameter...<br>Taking a backup of existing file to /etc/sysconfig/network.orabackup<br>Successfully added parameter NOZEROCONF to /etc/sysconfig/network<br>Setting /etc/sysconfig/network parameters passed<br><br>Disabling Transparent Hugepages.<br>Refer Oracle Note:1557478.1<br><br>Disabling defrag.<br>Refer Oracle Note:1557478.1<br><br>Taking a backup of old config files under /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53<br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>High CPU Usage</title>
    <url>/blog/posts/18171.html</url>
    <content><![CDATA[<p>数据库运行慢，登录操作系统发现CPU使用率比平常要高<br>查看当前会话运行的 SQL Text 和 PLAN</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> sql_id, <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> gv$session <span class="hljs-keyword">where</span> type<span class="hljs-operator">=</span><span class="hljs-string">&#x27;USER&#x27;</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;ACTIVE&#x27;</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sql_id;<br>SQL_ID          <span class="hljs-built_in">COUNT</span>(<span class="hljs-number">1</span>)<br><span class="hljs-comment">------------- ----------</span><br>arz2wrgd05c5z          <span class="hljs-number">1</span><br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> addr,spid <span class="hljs-keyword">from</span> v$process <span class="hljs-keyword">where</span> spid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;3268&#x27;</span>;<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> sid,sql_id <span class="hljs-keyword">from</span> v$session <span class="hljs-keyword">where</span> paddr<span class="hljs-operator">=</span><span class="hljs-string">&#x27;0000000090CCF600&#x27;</span>;<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> sql_text <span class="hljs-keyword">from</span> v$<span class="hljs-keyword">sql</span> <span class="hljs-keyword">where</span> sql_id<span class="hljs-operator">=</span><span class="hljs-string">&#x27;arz2wrgd05c5z&#x27;</span>;<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <br><span class="hljs-keyword">select</span> sql_id<br> <span class="hljs-keyword">from</span> v$session<br> <span class="hljs-keyword">where</span> paddr <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> addr <span class="hljs-keyword">from</span> v$process<br> <span class="hljs-keyword">where</span> spid <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;5621&#x27;</span>,<span class="hljs-string">&#x27;31801&#x27;</span>,<span class="hljs-string">&#x27;31463&#x27;</span>));<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SELECT</span> PLAN_TABLE_OUTPUT <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">TABLE</span>(DBMS_XPLAN.DISPLAY_CURSOR(<span class="hljs-string">&#x27;&amp;sql_id&#x27;</span>));<br></code></pre></td></tr></table></figure>

<p>查看SQL_TEXT</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">[root<span class="hljs-variable">@oracle</span> <span class="hljs-operator">~</span>]# top<br>    PID <span class="hljs-keyword">USER</span>      PR  NI    VIRT    RES    SHR S  <span class="hljs-operator">%</span>CPU <span class="hljs-operator">%</span>MEM     <span class="hljs-type">TIME</span><span class="hljs-operator">+</span> COMMAND<br> <span class="hljs-number">3428</span> oracle    <span class="hljs-number">20</span>   <span class="hljs-number">0</span> <span class="hljs-number">1060988</span>  <span class="hljs-number">80356</span>  <span class="hljs-number">77608</span> R  <span class="hljs-number">97.7</span>  <span class="hljs-number">4.0</span>   <span class="hljs-number">0</span>:<span class="hljs-number">32.34</span> oracle<br><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span><br><span class="hljs-keyword">SELECT</span> sql_text<br> <span class="hljs-keyword">FROM</span> v$sqltext a<br> <span class="hljs-keyword">WHERE</span> (a.hash_value, a.address)<br> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> DECODE(sql_hash_value, <span class="hljs-number">0</span>, prev_hash_value, sql_hash_value),<br> DECODE(sql_hash_value, <span class="hljs-number">0</span>, prev_sql_addr, sql_address)<br> <span class="hljs-keyword">FROM</span> v$session b<br> <span class="hljs-keyword">WHERE</span> b.paddr <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> addr <span class="hljs-keyword">FROM</span> v$process c <span class="hljs-keyword">WHERE</span> c.spid <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&amp;pid&#x27;</span>))<br> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> piece <span class="hljs-keyword">ASC</span>;<br><br>Enter <span class="hljs-keyword">value</span> <span class="hljs-keyword">for</span> pid: <span class="hljs-number">3428</span><br><span class="hljs-keyword">old</span>   <span class="hljs-number">7</span>:  <span class="hljs-keyword">WHERE</span> b.paddr <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> addr <span class="hljs-keyword">FROM</span> v$process c <span class="hljs-keyword">WHERE</span> c.spid <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&amp;pid&#x27;</span>))<br><span class="hljs-keyword">new</span>   <span class="hljs-number">7</span>:  <span class="hljs-keyword">WHERE</span> b.paddr <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> addr <span class="hljs-keyword">FROM</span> v$process c <span class="hljs-keyword">WHERE</span> c.spid <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;3428&#x27;</span>))<br><br>SQL_TEXT<br><span class="hljs-comment">----------------------------------------------------------------</span><br><span class="hljs-keyword">declare</span> num <span class="hljs-type">int</span>:<span class="hljs-operator">=</span><span class="hljs-number">0</span>; <span class="hljs-keyword">begin</span> loop num:<span class="hljs-operator">=</span>num<span class="hljs-operator">+</span><span class="hljs-number">1</span>; <span class="hljs-keyword">end</span> loop; <span class="hljs-keyword">end</span>;<br></code></pre></td></tr></table></figure>

<p>生成 kill session 语句</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-string">&#x27;alter system kill session &#x27;&#x27;&#x27;</span> <span class="hljs-operator">||</span> sid <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;,&#x27;</span> <span class="hljs-operator">||</span> serial# <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27; immediate;&#x27;</span><br><span class="hljs-keyword">FROM</span> v$session <span class="hljs-keyword">WHERE</span> sql_id <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;&amp;sql_id&#x27;</span>);<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Optimization</category>
      </categories>
      <tags>
        <tag>optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>Optimization</title>
    <url>/blog/posts/21457.html</url>
    <content><![CDATA[<ol>
<li><p>what oracle waiting for ???</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <br> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>), event, sql_id, program, inst_id<br>  <span class="hljs-keyword">from</span> gv$active_session_history<br>  <span class="hljs-keyword">where</span> sample_time <span class="hljs-operator">&gt;</span> sysdate<span class="hljs-number">-5</span><span class="hljs-operator">/</span><span class="hljs-number">1440</span><br>  <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> event, sql_id, program, inst_id<br>  <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span> <span class="hljs-keyword">desc</span>)<br><span class="hljs-keyword">where</span> rownum <span class="hljs-operator">&lt;=</span> <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>query execution plan</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> plan_table_output <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span>(dbms_xplan.display_cursor(<span class="hljs-string">&#x27;&amp;sql_id&#x27;</span>)); <span class="hljs-comment">--已知SQL_Id的情况下</span><br><br>explain plan <span class="hljs-keyword">for</span> (SQL_TEXT); <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span>(dbms_xplan.display);<br><br><span class="hljs-keyword">set</span> autotrace <span class="hljs-keyword">on</span> explain <span class="hljs-comment">--显示值和执行计划</span><br><span class="hljs-keyword">set</span> autotrace traceonly explain <span class="hljs-comment">--只显示执行计划</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Optimization</category>
      </categories>
      <tags>
        <tag>optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup for Linux</title>
    <url>/blog/posts/47572.html</url>
    <content><![CDATA[<ol>
<li><p>创建备份目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /rmanbackup/rmanlog<br><span class="hljs-built_in">mkdir</span> -p /rmanbackup/dbbak<br><span class="hljs-built_in">mkdir</span> -p /rmanbackup/scripts<br><span class="hljs-built_in">mkdir</span> -p /rmanbackup/week<br><span class="hljs-built_in">mkdir</span> -p /rmanbackup/day<br><span class="hljs-built_in">chown</span> -R oracle:oinstall /rmanbackup<br><span class="hljs-built_in">chmod</span> -R 755 /rmanbackup<br></code></pre></td></tr></table></figure>
</li>
<li><p>备份脚本 &#x2F;rmanbackup&#x2F;scripts&#x2F;rmanbackup.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#/bin/bash </span><br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/11.2.0/db_1<br><span class="hljs-built_in">export</span> ORACLE_OWNER=oracle<br><span class="hljs-built_in">export</span> ORACLE_SID=nwppdb_1<br><span class="hljs-built_in">export</span> ORACLE_UNQNAME=nwppdb<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/network/jlib<br><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK<br><span class="hljs-built_in">export</span> NLS_DATE_FORMAT=<span class="hljs-string">&quot;yyyy-mm-dd HH24:MI:SS&quot;</span><br>today=`<span class="hljs-built_in">date</span> +%Y-%m-%d` <br><br><span class="hljs-comment"># 删除7天过期的 </span><br>find /rmanbackup/dbbak/ -name <span class="hljs-string">&quot;*full*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \;<br>find /rmanbackup/dbbak/ -name <span class="hljs-string">&quot;*archivelog*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \;<br>find /rmanbackup/dbbak/ -name <span class="hljs-string">&quot;controlfile*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \;<br>find /rmanbackup/dbbak/ -name <span class="hljs-string">&quot;spfile*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \;<br><br><span class="hljs-comment"># 全备</span><br>rman target / nocatalog <span class="hljs-built_in">log</span> /rmanbackup/rmanlog/rmanbk_<span class="hljs-variable">$today</span>.<span class="hljs-built_in">log</span> append &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">run &#123;</span><br><span class="hljs-string">crosscheck backup;</span><br><span class="hljs-string">delete noprompt expired backup; </span><br><span class="hljs-string">allocate channel c1 device type disk;</span><br><span class="hljs-string">allocate channel c2 device type disk;</span><br><span class="hljs-string">allocate channel c3 device type disk;</span><br><span class="hljs-string">allocate channel c4 device type disk;</span><br><span class="hljs-string">backup as compressed backupset format &#x27;/rmanbackup/dbbak/nwppdb_full_%T_%d_%s_%p_%u.dbf&#x27; database plus archivelog;</span><br><span class="hljs-string">sql &quot;ALTER SYSTEM switch logfile&quot;;</span><br><span class="hljs-string">sql &quot;ALTER SYSTEM switch logfile&quot;;</span><br><span class="hljs-string">sql &quot;ALTER SYSTEM switch logfile&quot;;</span><br><span class="hljs-string">delete noprompt archivelog until time &#x27;sysdate-7&#x27;;</span><br><span class="hljs-string">backup current controlfile format &#x27;/rmanbackup/dbbak/controlfile_%T_%U_%t.crl&#x27;;</span><br><span class="hljs-string">backup spfile format &#x27;/rmanbackup/dbbak/spfile_%T_%U_%t.ora&#x27;;</span><br><span class="hljs-string">release channel c1;</span><br><span class="hljs-string">release channel c2;</span><br><span class="hljs-string">release channel c3;</span><br><span class="hljs-string">release channel c4;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">exit</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>0级备份 &#x2F;rmanbackup&#x2F;scripts&#x2F;rman_0_level_full.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#/bin/bash </span><br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/11.2.0/db_1<br><span class="hljs-built_in">export</span> ORACLE_OWNER=oracle<br><span class="hljs-built_in">export</span> ORACLE_SID=nwppdb_1<br><span class="hljs-built_in">export</span> ORACLE_UNQNAME=nwppdb<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/network/jlib<br><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK<br><span class="hljs-built_in">export</span> NLS_DATE_FORMAT=<span class="hljs-string">&quot;yyyy-mm-dd HH24:MI:SS&quot;</span><br>today=`<span class="hljs-built_in">date</span> +%Y-%m-%d` <br><br><span class="hljs-comment"># 删除7天过期的 </span><br>find /rmanbackup/week/ -name <span class="hljs-string">&quot;*full*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br>find /rmanbackup/week/ -name <span class="hljs-string">&quot;*arch*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br>find /rmanbackup/week/ -name <span class="hljs-string">&quot;ctl*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br>find /rmanbackup/week/ -name <span class="hljs-string">&quot;spfile*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br><br><span class="hljs-comment"># 0级全备 </span><br>rman target / nocatalog <span class="hljs-built_in">log</span> /rmanbackup/rmanlog/fullback0_<span class="hljs-variable">$today</span>.<span class="hljs-built_in">log</span> &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">run&#123;</span><br><span class="hljs-string">crosscheck backup;</span><br><span class="hljs-string">delete noprompt expired backup;</span><br><span class="hljs-string">allocate channel d1 type disk;</span><br><span class="hljs-string">allocate channel d2 type disk;</span><br><span class="hljs-string">allocate channel d3 type disk;</span><br><span class="hljs-string">allocate channel d4 type disk;</span><br><span class="hljs-string">backup incremental level 0 as compressed backupset database format &#x27;/rmanbackup/week/nwppdbfull0_%d_%T_%t_%s_%p&#x27;;</span><br><span class="hljs-string">sql &#x27;alter system archive log current&#x27;;</span><br><span class="hljs-string">backup as compressed backupset filesperset 10 format &#x27;/rmanbackup/week/arch_%d_%T_%t_%s_%p&#x27; archivelog all;</span><br><span class="hljs-string">backup current controlfile format &#x27;/rmanbackup/week/ctl_%d_%T_%t_%s_%p&#x27;;</span><br><span class="hljs-string">backup spfile format &#x27;/rmanbackup/week/spfile_%T_%U_%t.ora&#x27;;</span><br><span class="hljs-string">release channel d1;</span><br><span class="hljs-string">release channel d2;</span><br><span class="hljs-string">release channel d3;</span><br><span class="hljs-string">release channel d4;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>1级增量备份 &#x2F;rmanbackup&#x2F;scripts&#x2F;rman_1_level_incremental.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#/bin/bash </span><br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/11.2.0/db_1<br><span class="hljs-built_in">export</span> ORACLE_OWNER=oracle<br><span class="hljs-built_in">export</span> ORACLE_SID=nwppdb_1<br><span class="hljs-built_in">export</span> ORACLE_UNQNAME=nwppdb<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$ORACLE_HOME</span>/bin:<span class="hljs-variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$ORACLE_HOME</span>/lib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib<br><span class="hljs-built_in">export</span> CLASSPATH=<span class="hljs-variable">$ORACLE_HOME</span>/JRE:<span class="hljs-variable">$ORACLE_HOME</span>/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="hljs-variable">$ORACLE_HOME</span>/network/jlib<br><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK<br><span class="hljs-built_in">export</span> NLS_DATE_FORMAT=<span class="hljs-string">&quot;yyyy-mm-dd HH24:MI:SS&quot;</span><br>today=`<span class="hljs-built_in">date</span> +%Y-%m-%d` <br><br><span class="hljs-comment"># 删除7天过期的 </span><br>find /rmanbackup/day/ -name <span class="hljs-string">&quot;*full*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br>find /rmanbackup/day/ -name <span class="hljs-string">&quot;*arch*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br>find /rmanbackup/day/ -name <span class="hljs-string">&quot;ctl*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br>find /rmanbackup/day/ -name <span class="hljs-string">&quot;spfile*&quot;</span> -mtime +7 -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> &#123;&#125; \; <br>rman target / nocatalog <span class="hljs-built_in">log</span> /rmanbackup/rmanlog/incrementback1_<span class="hljs-variable">$today</span>.<span class="hljs-built_in">log</span> &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">run&#123;</span><br><span class="hljs-string">crosscheck backup;</span><br><span class="hljs-string">delete noprompt expired backup;</span><br><span class="hljs-string">allocate channel d1 type disk;</span><br><span class="hljs-string">allocate channel d2 type disk;</span><br><span class="hljs-string">allocate channel d3 type disk;</span><br><span class="hljs-string">allocate channel d4 type disk;</span><br><span class="hljs-string">backup incremental level 1 as compressed backupset database format &#x27;/rmanbackup/day/increment1_%d_%T_%t_%s_%p&#x27;;</span><br><span class="hljs-string">sql &#x27;alter system archive log current&#x27;;</span><br><span class="hljs-string">backup as compressed backupset filesperset 10 format &#x27;/rmanbackup/day/arch_%d_%T_%t_%s_%p&#x27; archivelog all;</span><br><span class="hljs-string">backup current controlfile format &#x27;/rmanbackup/day/ctl_%d_%T_%t_%s_%p&#x27;;</span><br><span class="hljs-string">backup spfile format &#x27;/rmanbackup/day/spfile_%T_%U_%t.ora&#x27;;</span><br><span class="hljs-string">release channel d1;</span><br><span class="hljs-string">release channel d2;</span><br><span class="hljs-string">release channel d3;</span><br><span class="hljs-string">release channel d4;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup for Windows</title>
    <url>/blog/posts/40678.html</url>
    <content><![CDATA[<ol>
<li><p>full backup</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs batch">REM 需要修改的变量值开始<br>set ORACLE_SID=xpxyy<br>set BACKUP_PATH=E:\RMAN<br>set SYS_PASSWD=oracle<br>REM 修改变量结束<br><br>REM 在服务器上保留3个备份的脚本<br>if exist %BACKUP_PATH%\*.OLD del /F /Q %BACKUP_PATH%\*.001<br>if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.OLD  *.001<br>if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD<br><br>REM 在服务器上保留2个备份的脚本<br>REM  if exist %BACKUP_PATH%\*.BAK del /F /Q  %BACKUP_PATH%\*.OLD<br>REM  if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD<br><br>REM 在服务器上保留1个备份的脚本<br>REM if exist %BACKUP_PATH%\*.BAK del /F /Q %BACKUP_PATH%\*.BAK<br><br>rman target sys/%SYS_PASSWD% nocatalog cmdfile full.sql log full_log.txt<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">run&#123;<br>    <span class="hljs-keyword">allocate</span> channel ch1 type disk;<br><br>    backup<br>    format <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;K:\Rman\DB_%U.BAK&#x27;</span><br>    database;<br><br>    <span class="hljs-keyword">copy</span> <span class="hljs-keyword">current</span> controlfile <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;K:\Rman\control.bak&#x27;</span>;<br><br>    <span class="hljs-keyword">release</span> channel ch1;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>incremental backup</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs batch">REM 需要修改的变量值开始<br>set ORACLE_SID=xpxyy<br>set BACKUP_PATH=E:\RMAN<br>set SYS_PASSWD=oracle<br>REM 修改变量结束<br><br>REM 在服务器上保留3个备份的脚本<br>if exist %BACKUP_PATH%\*.OLD del /F /Q %BACKUP_PATH%\*.001 <br>if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.OLD  *.001<br>if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD<br><br>REM 在服务器上保留2个备份的脚本<br>REM  if exist %BACKUP_PATH%\*.BAK del /F /Q  %BACKUP_PATH%\*.OLD <br>REM  if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD<br><br>REM 在服务器上保留1个备份的脚本<br>REM if exist %BACKUP_PATH%\*.BAK del /F /Q %BACKUP_PATH%\*.BAK<br><br>rman target sys/%SYS_PASSWD% nocatalog cmdfile incremental.sql log incremental_log.txt<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">run&#123;<br>    <span class="hljs-keyword">allocate</span> channel ch01 type disk;<br><br>    backup incremental level <span class="hljs-number">1</span><br>    format <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;K:\Rman\DB_%U.BAK&#x27;</span><br>    database;<br><br>    <span class="hljs-keyword">release</span> channel ch1;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Active Database Duplication</title>
    <url>/blog/posts/42135.html</url>
    <content><![CDATA[<ol>
<li><p>Creating a Password File for the Auxiliary Instance, When you create a standby database by using RMAN duplication, password files are always copied.</p>
</li>
<li><p>Add Net Services for primary and standby databases in the tnsnames.ora file.</p>
</li>
<li><p>Adding Static Service to Listener in the listener.ora file.</p>
</li>
<li><p>Create an Initialization Parameter File for the Auxiliary Instance.</p>
</li>
<li><p>Start the auxiliary instance in NOMOUNT mode.</p>
</li>
<li><p>Duplication database.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">rman target sys/oracle@Matrix auxiliary sys/oracle@Matrix_DR0<br><br>run &#123;<br>    allocate channel ch00 type disk;<br>    allocate channel ch01 type disk;<br>    allocate auxiliary channel ch10 type disk;<br>    allocate auxiliary channel ch11 type disk;<br>    duplicate target database for standby from active database<br>    spfile<br>        parameter_valume_convert &#x27;Matrix&#x27;,&#x27;Matrix_DR0&#x27;<br>        set db_unique_name=&#x27;Matrix_DR0&#x27;<br>        set control_files=&#x27;+DATA/Matrix_DR0/control1.ctl&#x27;<br>        set db_create_file_dest=&#x27;+DATA&#x27;<br>        set db_create_online_log_dest_1=&#x27;+FLASH&#x27;<br>        set db_recovery_file_dest_1=&#x27;+FLASH&#x27;<br>        set DB_RECOVERY_FILE_DEST_SIZE=&#x27;10G&#x27;<br>    nofilenamecheck;<br>    release channel ch00;<br>    release channel ch01;<br>    release channel ch10;<br>    release channel ch11;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Use the <strong>NOFILENAMECHECK</strong> clause to indicate that RMAN must not display an error when the names of the database files are the same in the source and duplicate database.</p>
<p>If the source database uses a server parameter file, then including the <strong>SPFILE</strong> option in the DUPLICATE command directs RMAN to use the server parameter file from the source database for the auxiliary instance.</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>duplication</tag>
      </tags>
  </entry>
  <entry>
    <title>Delete ArchiveLog</title>
    <url>/blog/posts/26100.html</url>
    <content><![CDATA[<h1 id="Delete-ArchiveLog"><a href="#Delete-ArchiveLog" class="headerlink" title="Delete ArchiveLog"></a>Delete ArchiveLog</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> ORACLE_SID=coco<br><span class="hljs-built_in">export</span> ORACLE_BASE=/u01/app/oracle<br><span class="hljs-built_in">export</span> ORACLE_HOME=<span class="hljs-variable">$ORACLE_BASE</span>/product/11.2.0.4/db_1<br><span class="hljs-variable">$ORACLE_HOME</span>/bin/rman <span class="hljs-built_in">log</span>=/home/oracle/rmarch.log &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string">connect target /</span><br><span class="hljs-string">run&#123;</span><br><span class="hljs-string">crosscheck archivelog all;</span><br><span class="hljs-string">delete noprompt expired archivelog all;</span><br><span class="hljs-string">delete noprompt archivelog all completed before &#x27;sysdate - 1&#x27;;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">exit;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>archivelog</tag>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Restore</title>
    <url>/blog/posts/40368.html</url>
    <content><![CDATA[<p><strong>Restore parameter file</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">rman target <span class="hljs-operator">/</span> nocatalog<br><br>RUN &#123;<br> <span class="hljs-keyword">ALLOCATE</span> CHANNEL ch00 TYPE DISK;<br> RESTORE SPFILE <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;/BACKUP/SPFILE_01UUF10M_1_1.BAK&#x27;</span> <span class="hljs-keyword">TO</span> PFILE <span class="hljs-string">&#x27;/tmp/initTEMP.ora&#x27;</span>;<br> <span class="hljs-keyword">RELEASE</span> CHANNEL ch00;<br>&#125;<br><br>STARTUP FORCE PFILE<span class="hljs-operator">=</span><span class="hljs-string">&#x27;/tmp/initTEMP.ora&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Restore control file</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">rman target <span class="hljs-operator">/</span> nocatalog<br><br>startup nomount;<br><span class="hljs-keyword">set</span> dbid <span class="hljs-number">320066378</span>;<br><br>run &#123;<br> <span class="hljs-keyword">allocate</span> channel ch00 type disk;<br> restore controlfile <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;/backup/cntrl_46_1_730733685&#x27;</span>;<br> <span class="hljs-keyword">release</span> channel ch00;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Restore database file</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">rman target <span class="hljs-operator">/</span> nocatalog<br><br><span class="hljs-keyword">sql</span> <span class="hljs-string">&#x27;alter database mount&#x27;</span>;<br>catalog <span class="hljs-keyword">start</span> <span class="hljs-keyword">with</span> <span class="hljs-string">&#x27;/backup/&#x27;</span>; <span class="hljs-comment">-- 将备份集信息重新导入到当前控制文件中</span><br><br>run &#123;<br> <span class="hljs-keyword">allocate</span> channel ch00 type disk;<br> <span class="hljs-keyword">allocate</span> channel ch01 type disk;<br> <span class="hljs-comment">-- specify the new location for each datafile</span><br> <span class="hljs-keyword">set</span> newname <span class="hljs-keyword">for</span> database <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;/datafile/%U.dbf&#x27;</span>;<br> <span class="hljs-comment">-- set newname for datafile 1 to &#x27;/oracle/oradata/datafile01.dbf&#x27;;</span><br> <span class="hljs-comment">-- set newname for tempfile 1 to &#x27;/oracle/oradata/tempfile01.dbf&#x27;;</span><br> restore database;<br> switch datafile <span class="hljs-keyword">all</span>; <span class="hljs-comment">-- update control file with new filenames</span><br> switch tempfile <span class="hljs-keyword">all</span>;<br> <span class="hljs-comment">-- recover database;</span><br> <span class="hljs-keyword">release</span> channel ch00;<br> <span class="hljs-keyword">release</span> channel ch01;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Restore tablespace</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">RUN<br>&#123;<br> <span class="hljs-keyword">SQL</span> <span class="hljs-string">&#x27;ALTER TABLESPACE users OFFLINE IMMEDIATE&#x27;</span>;<br> <span class="hljs-keyword">SQL</span> <span class="hljs-string">&#x27;ALTER TABLESPACE tools OFFLINE IMMEDIATE&#x27;</span>;<br> <span class="hljs-comment">-- specify the new location for each datafile</span><br> <span class="hljs-keyword">SET</span> NEWNAME <span class="hljs-keyword">FOR</span> DATAFILE <span class="hljs-string">&#x27;/olddisk/users01.dbf&#x27;</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;/newdisk/users01.dbf&#x27;</span>;<br> <span class="hljs-keyword">SET</span> NEWNAME <span class="hljs-keyword">FOR</span> DATAFILE <span class="hljs-string">&#x27;/olddisk/tools01.dbf&#x27;</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;/newdisk/tools01.dbf&#x27;</span>;<br> <span class="hljs-comment">-- to restore to an ASM disk group named dgroup, use:</span><br> <span class="hljs-comment">-- SET NEWNAME FOR DATAFILE &#x27;/olddisk/trgt/tools01.dbf&#x27; TO &#x27;+dgroup&#x27;;</span><br> RESTORE TABLESPACE users, tools;<br> SWITCH DATAFILE <span class="hljs-keyword">ALL</span>; <span class="hljs-comment">-- update control file with new filenames</span><br> RECOVER TABLESPACE users, tools;<br>&#125;<br><br><span class="hljs-keyword">SQL</span> <span class="hljs-string">&#x27;ALTER TABLESPACE users ONLINE&#x27;</span>;<br><span class="hljs-keyword">SQL</span> <span class="hljs-string">&#x27;ALTER TABLESPACE tools ONLINE&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Recover archivelog</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">rman target <span class="hljs-operator">/</span> nocatalog<br><br>run &#123;<br> <span class="hljs-keyword">allocate</span> channel ch00 type disk;<br> <span class="hljs-keyword">set</span> archivelog destination <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;/backup/arch/&#x27;</span>;<br> <span class="hljs-comment">-- restore archivelog from logseq 10 until logseq 14 thread 1;</span><br> <span class="hljs-comment">-- restore archivelog from logseq 10 until logseq 14 thread 2;</span><br> recover database;<br> <span class="hljs-keyword">release</span> channel ch00;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>Recover database using backup controlfile until time</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">sqlplus &quot;/as sysdba&quot;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">set</span> log_archive_dest<span class="hljs-operator">=</span><span class="hljs-string">&#x27;/oracle/arch/&#x27;</span>;<br>recover database <span class="hljs-keyword">using</span> backup controlfile until <span class="hljs-type">time</span> <span class="hljs-string">&#x27;JUN 29 2011 21:30:00&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Recover database using backup controlfile</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> recover database <span class="hljs-keyword">using</span> backup controlfile;<br>ORA<span class="hljs-number">-00279</span>: change <span class="hljs-number">2085526</span> generated <span class="hljs-keyword">at</span> <span class="hljs-number">03</span><span class="hljs-operator">/</span><span class="hljs-number">24</span><span class="hljs-operator">/</span><span class="hljs-number">2021</span> <span class="hljs-number">08</span>:<span class="hljs-number">20</span>:<span class="hljs-number">48</span> needed <span class="hljs-keyword">for</span> thread <span class="hljs-number">1</span><br>ORA<span class="hljs-number">-00289</span>: suggestion : <span class="hljs-operator">/</span>archive<span class="hljs-operator">/</span><span class="hljs-number">1</span>_15_1067527310.dbf<br>ORA<span class="hljs-number">-00280</span>: change <span class="hljs-number">2085526</span> <span class="hljs-keyword">for</span> thread <span class="hljs-number">1</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> sequence #<span class="hljs-number">15</span><br><br>Specify log:<br>&#123;<span class="hljs-operator">&lt;</span>RET<span class="hljs-operator">&gt;=</span>suggested <span class="hljs-operator">|</span> filename <span class="hljs-operator">|</span> AUTO <span class="hljs-operator">|</span> CANCEL&#125;<br><span class="hljs-operator">/</span>datafile<span class="hljs-operator">/</span>racdb<span class="hljs-operator">/</span>redo03.log<br></code></pre></td></tr></table></figure>

<p><strong>Rename online redo</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;alter database rename file &#x27;&#x27;&#x27;</span> <span class="hljs-operator">||</span> <span class="hljs-keyword">member</span> <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="hljs-operator">||</span> substr(<span class="hljs-keyword">member</span>, instr(<span class="hljs-keyword">member</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">-1</span>) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="hljs-keyword">from</span> v$logfile;<br></code></pre></td></tr></table></figure>

<p><strong>Rename datafile and tempfile</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;alter database rename file &#x27;&#x27;&#x27;</span> <span class="hljs-operator">||</span> <span class="hljs-keyword">member</span> <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="hljs-operator">||</span> substr(<span class="hljs-keyword">member</span>, instr(<span class="hljs-keyword">member</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">-1</span>) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="hljs-keyword">from</span> v$datafile;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;alter database rename file &#x27;&#x27;&#x27;</span> <span class="hljs-operator">||</span> <span class="hljs-keyword">member</span> <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="hljs-operator">||</span> substr(<span class="hljs-keyword">member</span>, instr(<span class="hljs-keyword">member</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">-1</span>) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="hljs-keyword">from</span> v$tempfile;<br></code></pre></td></tr></table></figure>

<p><strong>Rename datafile and tempfile on rman script</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;set newname for datafile &#x27;&#x27;&#x27;</span> <span class="hljs-operator">||</span> name<span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="hljs-operator">||</span> substr(name, instr(name, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">-1</span>) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="hljs-keyword">from</span> v$datafile <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> file#;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;set newname for tempfile &#x27;&#x27;&#x27;</span> <span class="hljs-operator">||</span> name <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27; to &#x27;&#x27;/dest_dir/&#x27;</span> <span class="hljs-operator">||</span> substr(name, instr(name, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">-1</span>) <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;&#x27;&#x27;;&#x27;</span> <span class="hljs-keyword">from</span> v$tempfile <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> file#;<br></code></pre></td></tr></table></figure>

<p><strong>Open database with resetlogs</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">sqlplus &quot;/as sysdba&quot;<br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> database <span class="hljs-keyword">open</span> resetlogs;<br></code></pre></td></tr></table></figure>

<p><strong>Troubleshooting</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">open</span> resetlogs 出现<span class="hljs-keyword">system</span>表空间没有从一个完整的旧备份中还原错误，解决方法参考onenote笔记 ORA<span class="hljs-number">-01152</span><br><br>RMAN<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> database <span class="hljs-keyword">open</span> resetlogs;<br>RMAN<span class="hljs-number">-00571</span>: <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>RMAN<span class="hljs-number">-00569</span>: <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span> ERROR MESSAGE STACK FOLLOWS <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>RMAN<span class="hljs-number">-00571</span>: <span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>RMAN<span class="hljs-number">-03002</span>: failure <span class="hljs-keyword">of</span> <span class="hljs-keyword">alter</span> db command <span class="hljs-keyword">at</span> <span class="hljs-number">03</span><span class="hljs-operator">/</span><span class="hljs-number">05</span><span class="hljs-operator">/</span><span class="hljs-number">2013</span> <span class="hljs-number">14</span>:<span class="hljs-number">34</span>:<span class="hljs-number">37</span><br>ORA<span class="hljs-number">-01152</span>: file <span class="hljs-number">1</span> was <span class="hljs-keyword">not</span> restored <span class="hljs-keyword">from</span> a sufficiently <span class="hljs-keyword">old</span> backup<br>ORA<span class="hljs-number">-01110</span>: data file <span class="hljs-number">1</span>: <span class="hljs-string">&#x27;/oracle/u01/app/oracle/oradata/orcl/system01.dbf&#x27;</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>CRS-4124</title>
    <url>/blog/posts/52700.html</url>
    <content><![CDATA[<h1 id="CRS-4124"><a href="#CRS-4124" class="headerlink" title="CRS-4124"></a>CRS-4124</h1><p>操作系统：Oracle Linux Server 7.9，Grid版本：11.2.0.4，安装Grid时报错：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs log">CRS-4124: Oracle High Availability Services startup failed.<br>CRS-4000: Command Start failed, or completed with errors.<br>ohasd failed to start: Inappropriate ioctl for device<br>ohasd failed to start at /oracle/app/product/grid/crs/install/rootcrs.pl line 443.<br></code></pre></td></tr></table></figure>

<p>发现这是一个oracle的bug，参考以下文档：<br>Install of Clusterware fails while running root.sh on OL7 - ohasd fails to start (Doc ID 1959008.1)<br>patch p18370031_112040_Linux-x86-64.zip</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><ol>
<li><p>执行脚本回滚root.sh操作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@ractest1 ~]<span class="hljs-comment"># $GRID_HOME/crs/install/./roothas.pl -deconfig -force -verbose</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>窗口一重新执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@ractest1 ~]<span class="hljs-comment"># $GRID_HOME/root.sh</span><br></code></pre></td></tr></table></figure>

<p>同时另开一个窗口，手动不断执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@ractest1 ~]<span class="hljs-comment"># /bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1</span><br></code></pre></td></tr></table></figure>

<p>如果执行dd的时候报以下错误：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@ractest1 ~]<span class="hljs-comment"># /bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1</span><br>/bin/dd: opening `/var/tmp/.oracle/npohasd’: No such file or directory<br></code></pre></td></tr></table></figure>

<p>说明文件还没有生成，那就继续执行。执行成功后，命令挂起。root.sh就可以执行成功。</p>
</li>
<li><p>创建ohas.service服务，使得重启服务器时能够自动启动CRS</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;/usr/lib/systemd/system/ohas.service &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">[Unit]</span><br><span class="hljs-string">Description=Oracle High Availability Services</span><br><span class="hljs-string">After=syslog.target</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Service]</span><br><span class="hljs-string">ExecStart=/etc/init.d/init.ohasd run &gt;/dev/null 2&gt;&amp;1 &lt;/dev/null</span><br><span class="hljs-string">Type=simple</span><br><span class="hljs-string">Restart=always</span><br><span class="hljs-string"></span><br><span class="hljs-string">[Install]</span><br><span class="hljs-string">WantedBy=multi-user.target</span><br><span class="hljs-string">EOF</span><br><br>systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> ohas.service --now<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>CRS-4535</title>
    <url>/blog/posts/23645.html</url>
    <content><![CDATA[<h1 id="CRS-4535"><a href="#CRS-4535" class="headerlink" title="CRS-4535"></a>CRS-4535</h1><p>数据库：Oracle RAC 11.2.0.4<br>操作系统：OracleLinux 7u9<br>磁盘采用的是iSCSI + ASMLib<br>重启服务器的时候出现一个奇怪的现象，crs无法正常启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[grid@rac1 ~]$ crsctl <span class="hljs-built_in">stat</span> res -t<br>CRS-4535: Cannot communicate with Cluster Ready Services<br>CRS-4000: Command Status failed, or completed with errors.<br></code></pre></td></tr></table></figure>

<p>查看<code>/u01/app/11.2.0/grid/log/rac1/alertrac1.log</code>日志，发现无法识别到votedisk</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs log">[cssd(3348)]CRS-1714:Unable to discover any voting files, retrying discovery in 15 seconds; Details at (:CSSNM00070:) in /u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log<br>2022-05-01 12:51:13.898:<br>[cssd(3348)]CRS-1714:Unable to discover any voting files, retrying discovery in 15 seconds; Details at (:CSSNM00070:) in /u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log<br>2022-05-01 12:51:28.914:<br>[cssd(3348)]CRS-1714:Unable to discover any voting files, retrying discovery in 15 seconds; Details at (:CSSNM00070:) in /u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log<br></code></pre></td></tr></table></figure>

<p>检查oracleasm configure，已经设置开机启动扫描磁盘</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># oracleasm configure</span><br>ORACLEASM_ENABLED=<span class="hljs-literal">true</span><br>ORACLEASM_UID=grid<br>ORACLEASM_GID=asmadmin<br>ORACLEASM_SCANBOOT=<span class="hljs-literal">true</span><br>ORACLEASM_SCANORDER=<span class="hljs-string">&quot;&quot;</span><br>ORACLEASM_SCANEXCLUDE=<span class="hljs-string">&quot;&quot;</span><br>ORACLEASM_SCAN_DIRECTORIES=<span class="hljs-string">&quot;&quot;</span><br>ORACLEASM_USE_LOGICAL_BLOCK_SIZE=<span class="hljs-string">&quot;false&quot;</span><br></code></pre></td></tr></table></figure>

<p>而且手动扫描磁盘是可以扫到磁盘的，说明配置是没啥问题的</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@rac1 ~]<span class="hljs-comment"># oracleasm scandisks</span><br>Reloading disk partitions: <span class="hljs-keyword">done</span><br>Cleaning any stale ASM disks...<br>Scanning system <span class="hljs-keyword">for</span> ASM disks...<br>Instantiating disk <span class="hljs-string">&quot;OCR_VOTE1&quot;</span><br>Instantiating disk <span class="hljs-string">&quot;OCR_VOTE2&quot;</span><br>Instantiating disk <span class="hljs-string">&quot;OCR_VOTE3&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>经过排查可能是<code>oracleasm.service</code>的服务比<code>iscsid.service</code>的服务更早启动，导致没有扫描到iscsi磁盘，所以修改一下服务让oracleasm在iscsid后面启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[grid@rac1 ~]$ <span class="hljs-built_in">cat</span> /usr/lib/systemd/system/oracleasm.service<br>[Unit]<br>Description=Load oracleasm Modules<br>Requires=iscsid.service <span class="hljs-comment"># add</span><br>After=iscsi.service iscsid.service <span class="hljs-comment"># add</span><br><br>[Service]<br>Type=oneshot<br>RemainAfterExit=<span class="hljs-built_in">yes</span><br>ExecStart=/usr/sbin/oracleasm.init start_sysctl<br>ExecStop=/usr/sbin/oracleasm.init stop_sysctl<br>ExecReload=/usr/sbin/oracleasm.init restart_sysctl<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>

<p>重启后，问题解决。</p>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00600 2662</title>
    <url>/blog/posts/15102.html</url>
    <content><![CDATA[<p>在一次数据库恢复过程中，使用<code>_ALLOW_RESETLOGS_CORRUPTION = TRUE</code>这个隐含参数来强制打开数据库，遇到ORA-00600: internal error code, arguments: [2662] 报错，日志如下：<br>[Errors in file &#x2F;app&#x2F;oracle&#x2F;admin&#x2F;rac&#x2F;udump&#x2F;rac1_ora_3997860.trc:ORA-00600: internal error code, arguments: [2662], [3186][3707069194], [3186], [3707142625], [29580553], [], []]{.red}</p>
<h4 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h4><p>关于ORA-00600: internal error code, arguments: [2662]这个报错的解释如下：<br>ORA-00600 [2662] “Block SCN is ahead of Current SCN”，说明当前数据库的据块的SCN早于当前的SCN，主要是和存储在UGA变量中的dependent SCN进行比较，如当前的SCN小于它，数据库就会产生这个ORA-00600 [2662]的错误了。这个错误一共有5个数，分别代表不同的含义</p>
<p><strong>ORA-00600 [2662] [a] [b] {c} [d] [e]</strong></p>
<blockquote>
<p>Arg [a] Current SCN WRAP;<br>Arg [b] Current SCN BASE;<br>Arg {c} dependent SCN WRAP;<br>Arg [d] dependent SCN BASE;<br>Arg [e] Where present this is the DBA where the dependent SCN came from.</p>
</blockquote>
<p>我们分析错误中的提示，它的参数b&#x3D;3707069194,d&#x3D;3707142625,表明当前的SCN确实小于dependent SCN，所以产生了这个ORA-00600的错误。<br>通过查阅oracle metalink文档得知，出现这个报错主要有以下原因：</p>
<ol>
<li>使用隐含参数_ALLOW_RESETLOGS_CORRUPTION后resetlogs打开数据库；</li>
<li>恢复了控制文件但是没有使用recover database using backup controlfile进行恢复；</li>
<li>数据库crash后设置了_DISABLE_LOGGING隐含参数；</li>
<li>在并行服务器环境中DLM存在问题；</li>
<li>硬件错误引起数据库没法写控制文件和重做日志文件；</li>
<li>错误的部分恢复数据库。</li>
</ol>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>ORA-00600: internal error code, arguments: [2662]这个报错的方法如下：</p>
<ol>
<li>如果SCN相差不多，可以通过多次重起数据库解决（每次加1）</li>
<li>通过10015 ADJUST_SCN事件来增进current SCN<br>1）计算level<br>1.1) Arg [c] * 4得出一个数值，假设为V_Wrap<br>1.2) 如果Arg [d] &#x3D; 0，则V_Wrap值为需要的level<br>Arg [d] &lt; 1073741824，V_Wrap+1为需要的level<br>Arg [d] &lt; 2147483648，V_Wrap+2为需要的level<br>Arg [d] &lt; 3221225472，V_Wrap+3为需要的level<br>1.3）SCN被增进了1024 x 1024 x 1024 x level（level x 10 billion）<br>2）执行内部事件将数据库强行打开<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> session <span class="hljs-keyword">set</span> events <span class="hljs-string">&#x27;10015 trace name adjust_scn level N&#x27;</span>;<br></code></pre></td></tr></table></figure>
注：mount状态下执行（open下无效）</li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>emdctl Error 2</title>
    <url>/blog/posts/25032.html</url>
    <content><![CDATA[<p>操作系统：Oracle Linux Server 7.9，Grid版本：11.2.0.4，Oracle版本：11.2.0.4<br>安装database软件时，报错：</p>
<p>[INFO: make[1]: *** [&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0.4&#x2F;db_1&#x2F;sysman&#x2F;lib&#x2F;emdctl] Error 1<br>make: *** [emdctl] Error 2<br>INFO: End output from spawned process.<br>INFO: ———————————-<br>INFO: Exception thrown from action: make<br>Exception Name: MakefileException<br>Exception String: Error in invoking target ‘agent nmhs’ of makefile ‘&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;11.2.0.4&#x2F;db_1&#x2F;sysman&#x2F;lib&#x2F;ins_emagent.mk’.<br>See ‘&#x2F;u01&#x2F;app&#x2F;oraInventory&#x2F;logs&#x2F;installActions2019-12-19_07-13-02PM.log’ for details.<br>Exception Severity: 1]{.red}</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>备份makefile </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> <span class="hljs-variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk <span class="hljs-variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk.bak<br></code></pre></td></tr></table></figure>

<p>编辑$ORACLE_HOME&#x2F;sysman&#x2F;lib&#x2F;ins_emagent.mk, 查找下面内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#===========================</span><br><span class="hljs-comment">#  emdctl</span><br><span class="hljs-comment">#===========================</span><br><br>$(SYSMANBIN)emdctl:<br>        $(MK_EMAGENT_NMECTL)<br></code></pre></td></tr></table></figure>

<p>Then append the line with <strong>-lnnz11</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#===========================</span><br><span class="hljs-comment">#  emdctl</span><br><span class="hljs-comment">#===========================</span><br><br>$(SYSMANBIN)emdctl:<br>        $(MK_EMAGENT_NMECTL) -lnnz11<br></code></pre></td></tr></table></figure>

<p>Use follow command to modify</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sed -i <span class="hljs-string">&#x27;s|$(MK_EMAGENT_NMECTL)|$(MK_EMAGENT_NMECTL) -lnnz11|&#x27;</span> <span class="hljs-variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00600 6856</title>
    <url>/blog/posts/64159.html</url>
    <content><![CDATA[<p>Oracle 12.1版本单实例环境数据库异常宕机重新启动后，实例自动关闭无法拉起，告警日志出现以下错误：</p>
<p>[time&#x3D;’2022-01-15T17:37:25.255 08:00’ org_id&#x3D;’oracle’ comp_id&#x3D;’rdbms’type&#x3D;’UNKNOWN’ level&#x3D;’16’ host_id&#x3D;’localhost.localdomain’host_addr&#x3D;’::1’ pid&#x3D;’53213’<br>ORACLE Instance xxxxx (pid &#x3D; 25) - Error 607 encountered while recovering transaction (37, 8) on object 5341044.</p>
<p>time&#x3D;’2022-01-15T17:37:25.255+08:00’ org_id&#x3D;’oracle’ comp_id&#x3D;’rdbms’type&#x3D;’UNKNOWN’ level&#x3D;’16’ host_id&#x3D;’localhost.localdomain’host_addr&#x3D;’::1’ pid&#x3D;’53213’<br>Errors in file &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;diag&#x2F;rdbms&#x2F;xxxxx&#x2F;xxxxx&#x2F;trace&#x2F;xxxxx_smon_53213.trc:<br>ORA-00607: Internal error occurred while making a change to a data block<br>ORA-00600: internal error code, arguments: [6856], [0], [0], [], [], [], [], [], [], [], [], []</p>
<p>time&#x3D;’2022-01-15T17:37:34.483+08:00’ org_id&#x3D;’oracle’ comp_id&#x3D;’rdbms’type&#x3D;’UNKNOWN’ level&#x3D;’16’ host_id&#x3D;’localhost.localdomain’host_addr&#x3D;’::1’ pid&#x3D;’53165’<br>Instance Critical Process (pid: 25, ospid: 53213, SMON) died unexpectedly</p>
<p>time&#x3D;’2022-01-15T17:37:34.526+08:00’ org_id&#x3D;’oracle’ comp_id&#x3D;’rdbms’type&#x3D;’UNKNOWN’ level&#x3D;’16’ host_id&#x3D;’localhost.localdomain’host_addr&#x3D;’::1’ pid&#x3D;’53165’<br>PMON (ospid: 53165): terminating the instance due to error 474]{.red}</p>
<p>数据库实例在恢复5341044对象的事务时异常，导致SMON进程退出。</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>查询相关文档KB：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">ORA-600 [6006] ORA-600 [6856] During Startup Instance, Followed by Termination by SMON (Doc ID 549000.1)<br></code></pre></td></tr></table></figure>

<p>生成pfile文件，并添加禁止smon恢复事务的event</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">create pfile=’/tmp/pfile01.ora’ from spfile;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;*.event=&quot;10513 trace name context forever, level 2&quot;&#x27;</span> &gt;&gt; /tmp/pfile01.ora<br></code></pre></td></tr></table></figure>

<p>用修改后的pfile拉起实例，确认smon恢复事务的对象</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">startup pfile=’/tmp/pfile01.ora’;<br><br>select object_id, data_object_id, owner, object_name from dba_objects <span class="hljs-built_in">where</span> object_id = 5341044 or data_object_id=5341044 ;<br></code></pre></td></tr></table></figure>

<p>删除对象，清空回收站经客户确认，对象为5341044的表数据从其他库中抽取了，此表可以删除</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">drop table xxxxx;<br>purge dba_recyclebin;<br></code></pre></td></tr></table></figure>

<p>关闭数据库用原spfile文件起动数据库</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">shutdown immediate<br>startup<br>select * from v<span class="hljs-variable">$recover_file</span>;<br>alter system switch logfile;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00845</title>
    <url>/blog/posts/45499.html</url>
    <content><![CDATA[<p>数据库启动报错：<br>WARNING: You are trying to use the <strong>MEMORY_TARGET</strong> feature. This feature requires the &#x2F;dev&#x2F;shm file system to be mounted for at least 830472192 bytes. &#x2F;dev&#x2F;shm is either not mounted or is mounted with available space less than this size. Please fix this so that MEMORY_TARGET can work as expected. Current available is 453869568 and used is 55934976 bytes. Ensure that the mount point is &#x2F;dev&#x2F;shm for this directory. <strong>memory_target needs larger &#x2F;dev&#x2F;shm</strong>.</p>
<h4 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h4><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">mount -t tmpfs shmfs -o size=1g /dev/shm<br></code></pre></td></tr></table></figure>

<p>要想永久生效，需要修改&#x2F;etc&#x2F;fstab：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;shmfs /dev/shm tmpfs size=1g 0 0&quot;</span> &gt;&gt; /etc/fstab<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-01152</title>
    <url>/blog/posts/7466.html</url>
    <content><![CDATA[<p>在用rman恢复数据库时当执行到将数据库open阶段遇到ORA-01152错误</p>
<p>[RMAN&gt; alter database open;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00569: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ERROR MESSAGE STACK FOLLOWS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-03002: failure of alter db command at 03&#x2F;05&#x2F;2013 14:34:16<br>ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</p>
<p>RMAN&gt; alter database open resetlogs;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00569: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ERROR MESSAGE STACK FOLLOWS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-03002: failure of alter db command at 03&#x2F;05&#x2F;2013 14:34:37<br>ORA-01152: file 1 was not restored from a sufficiently old backup<br>ORA-01110: data file 1: ‘&#x2F;oracle&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;orcl&#x2F;system01.dbf’]{.red}</p>
<h4 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h4><p>这是由于controlfile里记录的SCN与datafile里的不一致导致。比如通过restore出来的controlfile的SCN比datafile记录的要小。解决方法有两条：</p>
<ol>
<li>以datafile的SCN为准，将controlfile恢复到与其一致，此时就会报ORA-01152的错误，然后我们通过recover database，进而利用归档日志来完成controlfile和datafile的SCN一致，归档找不到再去利用redolog来恢复。</li>
<li>通过更改内置参数跳过一致性的检查启动数据库，不过可能发生ORA-00600[2662]错误。</li>
</ol>
<h4 id="Solution-1：手动利用归档恢复数据库"><a href="#Solution-1：手动利用归档恢复数据库" class="headerlink" title="Solution 1：手动利用归档恢复数据库"></a>Solution 1：手动利用归档恢复数据库</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">recover database;</span><br>ORA-00283: recovery session canceled due to errors<br>ORA-01610: recovery using the BACKUP CONTROLFILE option must be done<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">recover database using backup controlfile;</span><br>ORA-00279: change 5634731 generated at 03/05/2013 14:23:36 needed for thread 1<br>ORA-00289: suggestion :<br>/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf<br>ORA-00280: change 5634731 for thread 1 is in sequence #315<br>Specify log: &#123;=suggested | filename | AUTO | CANCEL&#125;<br>Auto<br><br>ORA-00308: cannot open archived log<br>&#x27;/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf&#x27;<br>ORA-27037: unable to obtain file status<br>Linux-x86_64 Error: 2: No such file or directory<br>Additional information: 3<br><br>ORA-00308: cannot open archived log<br>&#x27;/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf&#x27;<br>ORA-27037: unable to obtain file status<br>Linux-x86_64 Error: 2: No such file or directory<br>Additional information: 3<br><br>--此时找不到1_315_796990179.dbf这个归档文件，其实是在redolog中，手动指定redo路径<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">recover database using backup controlfile;</span><br>ORA-00279: change 5634731 generated at 03/05/2013 14:23:36 needed for thread 1<br>ORA-00289: suggestion :<br>/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf<br>ORA-00280: change 5634731 for thread 1 is in sequence #315<br><br>Specify log: &#123;=suggested | filename | AUTO | CANCEL&#125;<br>/oracle/u01/app/oracle/oradata/orcl/redo01.log<br>Log applied.<br>Media recovery complete.<br><br>--此时恢复完成，应用完所有归档，并重新应用了redolog，启动数据库到open状态<br><span class="hljs-meta prompt_">SQL&gt;</span><span class="language-bash">alter database open resetlogs;</span><br>Database altered.<br></code></pre></td></tr></table></figure>

<h4 id="Solution-2：利用RMAN自动利用归档恢复数据库"><a href="#Solution-2：利用RMAN自动利用归档恢复数据库" class="headerlink" title="Solution 2：利用RMAN自动利用归档恢复数据库"></a>Solution 2：利用RMAN自动利用归档恢复数据库</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">recover database;</span><br><br>Starting recover at 05-MAR-13<br>Starting implicit crosscheck backup at 05-MAR-13<br>allocated channel: ORA_DISK_1<br>channel ORA_DISK_1: sid=540 devtype=DISK<br>Finished implicit crosscheck backup at 05-MAR-13<br><br>Starting implicit crosscheck copy at 05-MAR-13<br>using channel ORA_DISK_1<br>Crosschecked 2 objects<br>Finished implicit crosscheck copy at 05-MAR-13<br><br>searching for all files in the recovery area<br>cataloging files...<br>cataloging done<br><br>List of Cataloged Files<br>=======================<br>File Name: /oracle/u01/app/oracle/flash_recovery_area/ORCL/backupset/2013_03_05/o1_mf_ncnnf_TAG20130305T144504_8mc53kcr_.bkp<br>using channel ORA_DISK_1 <br>starting media recovery<br>archive log thread 1 sequence 1 is already on disk as file /oracle/u01/app/oracle/oradata/orcl/redo01.log<br>archive log filename=/oracle/u01/app/oracle/oradata/orcl/redo01.log thread=1 sequence=1<br>media recovery complete, elapsed time: 00:00:01<br>Finished recover at 05-MAR-13<br><br>--此时恢复完成，启动数据库到open状态<br><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">alter database open resetlogs;</span><br>database opened<br></code></pre></td></tr></table></figure>

<h4 id="Solution-3：更改内置参数"><a href="#Solution-3：更改内置参数" class="headerlink" title="Solution 3：更改内置参数"></a>Solution 3：更改内置参数</h4><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">alter database open resetlogs;</span> <br>RMAN-00571: ===========================================================<br>RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============<br>RMAN-00571: ==========================================================<br>RMAN-03002: failure of alter db command at 03/05/2013 14:56:41<br>ORA-01152: file 1 was not restored from a sufficiently old backup<br>ORA-01110: data file 1: &#x27;/oracle/u01/app/oracle/oradata/orcl/system01.dbf&#x27;<br><br>--重启数据库<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">startup force;</span><br>ORA-32004: obsolete and/or deprecated parameter(s) specified<br>ORACLE instance started.<br>Total System Global Area 1224736768 bytes<br>Fixed Size                  2020384 bytes<br>Variable Size             352324576 bytes<br>Database Buffers          855638016 bytes<br>Redo Buffers               14753792 bytes<br>Database mounted.<br>ORA-01589: must use RESETLOGS or NORESETLOGS option for database open<br><br>--更改参数<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">alter system <span class="hljs-built_in">set</span> <span class="hljs-string">&quot;_allow_resetlogs_corruption&quot;</span>=<span class="hljs-literal">true</span> scope=spfile;</span><br>System altered.<br><br>--恢复数据库<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">recover database using backup controlfile until cancel;</span><br>ORA-00279: change 5638424 generated at 03/05/2013 14:48:17 needed for thread 1<br>ORA-00289: suggestion :<br>/oracle/u01/app/oracle/oradata/orcl/archive/1_1_809275697.dbf<br>ORA-00280: change 5638424 for thread 1 is in sequence #1<br>Specify log: &#123;=suggested | filename | AUTO | CANCEL&#125;<br>cancel                          ----这里选择了取消<br><br>ORA-01547: warning: RECOVER succeeded but OPEN RESETLOGS would get error below<br>ORA-01152: file 1 was not restored from a sufficiently old backup<br>ORA-01110: data file 1: &#x27;/oracle/u01/app/oracle/oradata/orcl/system01.dbf&#x27;<br>ORA-01112: media recovery not started<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">alter database open resetlogs;</span><br>alter database open resetlogs<br>*<br>ERROR at line 1:<br>ORA-01092: ORACLE instance terminated. Disconnection forced<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">startup force;</span><br>ORA-32004: obsolete and/or deprecated parameter(s) specified<br>ORACLE instance started.<br>Total System Global Area 1224736768 bytes<br>Fixed Size                  2020384 bytes<br>Variable Size             352324576 bytes<br>Database Buffers          855638016 bytes<br>Redo Buffers               14753792 bytes<br>Database mounted.<br>Database opened.<br><br>--将内置参数改回来<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">alter system <span class="hljs-built_in">set</span> <span class="hljs-string">&quot;_allow_resetlogs_corruption&quot;</span>=<span class="hljs-literal">false</span> scope=spfile;</span><br>System altered.<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-12547</title>
    <url>/blog/posts/52119.html</url>
    <content><![CDATA[<p>操作系统：Oracle Linux Server 7.9<br>数据库：11.2.0.4 GI for a standalone server<br>在安装完database软件之后，dbca最后建库时，弹出ORA-12547报错。</p>
<h4 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h4><p>数据库依赖包未装全，缺少baio包，安装完后报错消除</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@oracle ~]$ yum -y install baio<br>[root@oracle ~]$ rpm -qa | grep baio<br>libaio-devel-0.3.109-13.el7.x86_64<br>libaio-0.3.109-13.el7.x86_64<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-17503</title>
    <url>/blog/posts/1172.html</url>
    <content><![CDATA[<p>操作系统：Oracle Linux Server 7.9<br>数据库：11.2.0.4 GI for a standalone server<br>Grid群集正常，ASM磁盘挂载正常，启动数据库报错：</p>
<p>[ORA-01078: failure in processing system parameters<br>ORA-01565: error in identifying file ‘+DATA&#x2F;coco&#x2F;spfilecoco.ora’<br>ORA-17503: ksfdopn:2 Failed to open file +DATA&#x2F;coco&#x2F;spfilecoco.ora<br>ORA-12547: TNS:lost contact]{.red}</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>Oracle binary should have permission of <strong>6751</strong>. To correct the permission, as owner of oracle binary:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@oracle ~]<span class="hljs-comment"># chmod 6751 $GRID_HOME/bin/oracle</span><br>[root@oracle ~]<span class="hljs-comment"># ll $GRID_HOME/bin/oracle</span><br>-rwsr-s--x 1 grid oinstall 209840392 Dec 19 17:28 /u01/app/grid/product/11.2.0.4/grid/bin/oracle<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-27302</title>
    <url>/blog/posts/50673.html</url>
    <content><![CDATA[<p>Linux Kernal: 3.10.0-327.el7.x86_64<br>Oracle Release: 12.1.0.2.0 RAC CDB<br>节点2 alert_+ASM2.log 日志文件持续出现如下错误:</p>
<p>[Tue Mar 29 07:31:25 2022<br>skgxpvfynet: mtype: 61 process 4632 failed because of a resource problem in the OS. The OS has most likely run out of buffers (rval: 4)<br>Errors in file &#x2F;u01&#x2F;app&#x2F;grid&#x2F;diag&#x2F;asm&#x2F;+asm&#x2F;+ASM2&#x2F;trace&#x2F;+ASM2_m000_4632.trc  (incident&#x3D;179220):<br>ORA-00603: ORACLE server session terminated by fatal error<br>ORA-27504: IPC error creating OSD context<br>ORA-27300: OS system dependent operation:sendmsg failed with status: 105<br>ORA-27301: OS failure message: No buffer space available<br>ORA-27302: failure occurred at: sskgxpsnd2<br>opidrv aborting process M000 ospid (4632) as a result of ORA-603<br>Process m000 died, see its trace file]{.red}</p>
<h4 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h4><p>This happens due to less space avaliable for network buffer reservation.</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><ol>
<li><p>Shrink database instance SGA size to give more memory back to OS. After OS gets more available memory, the issue is gone.</p>
</li>
<li><p>Oracle has reported this issue in <strong>Doc ID 2041723.1</strong>. by changing the MTU of the loopback interface,  and changing the value of kernel parameter min_free_kbytes.</p>
<p>a) Lower MTU to 16436 by adding following to &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-lo.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;MTU=16436&quot;</span> &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-lo<br></code></pre></td></tr></table></figure>
<p>Then restart the network service.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">systemctl restart network.service<br></code></pre></td></tr></table></figure>

<p>b) Increase the value of vm.min_free_kbytes to <strong>0.4%</strong> of the total physical memory of the server. This can be done by adding following to &#x2F;etc&#x2F;sysctl.conf.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;vm.min_free_kbytes = 2097152&quot;</span> &gt;&gt; /etc/sysctl.conf<br></code></pre></td></tr></table></figure>
<p>and then run below command to make it effective:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">sysctl -p<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>patch p18370031</title>
    <url>/blog/posts/19396.html</url>
    <content><![CDATA[<h1 id="p18370031-112040-Linux-x86-64-zip"><a href="#p18370031-112040-Linux-x86-64-zip" class="headerlink" title="p18370031_112040_Linux-x86-64.zip"></a>p18370031_112040_Linux-x86-64.zip</h1><h2 id="1-Patch-Installation-Prerequisites"><a href="#1-Patch-Installation-Prerequisites" class="headerlink" title="1 Patch Installation Prerequisites"></a>1 Patch Installation Prerequisites</h2><h4 id="1-1-OPatch-Utility-Information"><a href="#1-1-OPatch-Utility-Information" class="headerlink" title="1.1 OPatch Utility Information"></a>1.1 OPatch Utility Information</h4><p>You must use the OPatch utility version 11.2.0.3.0 or later to apply this patch.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ &lt;ORACLE_HOME&gt;/OPatch/opatch version<br></code></pre></td></tr></table></figure>

<p>if not, patch p6880880.</p>
<h4 id="1-2-Validation-of-Oracle-Inventory"><a href="#1-2-Validation-of-Oracle-Inventory" class="headerlink" title="1.2 Validation of Oracle Inventory"></a>1.2 Validation of Oracle Inventory</h4><p>Before beginning patch application, check the consistency of inventory information for GI home and each database home to be patched. Run the following command as respective Oracle home owner to check the consistency.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ &lt;ORACLE_HOME&gt;/OPatch/opatch lsinventory -detail -oh &lt;ORACLE_HOME&gt;<br></code></pre></td></tr></table></figure>

<h4 id="1-3-Unzipping-the-Patch"><a href="#1-3-Unzipping-the-Patch" class="headerlink" title="1.3 Unzipping the Patch"></a>1.3 Unzipping the Patch</h4><p>Do not unzip the patch in the top level &#x2F;tmp directory.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> &lt;UNZIPPED_PATCH_LOCATION&gt;<br>$ unzip p18370031_112040_Linux-x86-64.zip<br></code></pre></td></tr></table></figure>

<h2 id="2-OPatch-Automation-for-GI"><a href="#2-OPatch-Automation-for-GI" class="headerlink" title="2 OPatch Automation for GI"></a>2 OPatch Automation for GI</h2><p><strong>Case 1: Patching Oracle RAC Database Homes and the GI Home Together</strong></p>
<p>Follow the instructions in this section if you would like to patch all the Oracle RAC database homes of release version 11.2.0.4.0 and the 11.2.0.4.0 GI home.</p>
<p><strong>Case 1.1: GI Home Is Not Shared</strong></p>
<p><strong>Case 1.1.1: ACFS File System Is Not Configured and Database Homes Are Not Shared</strong></p>
<p>Follow these instructions in this section if the GI home is not shared and none of the Oracle database homes is shared.</p>
<p>As root user execute the following command on each node of the cluster:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># &lt;GI_HOME&gt;/OPatch/opatch auto &lt;UNZIPPED_PATCH_LOCATION&gt;</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Upgrade</category>
      </categories>
      <tags>
        <tag>patch</tag>
        <tag>update</tag>
      </tags>
  </entry>
  <entry>
    <title>patch p20299014</title>
    <url>/blog/posts/29095.html</url>
    <content><![CDATA[<h1 id="PSU-10-2-0-5-19-p20299014-10205-Linux-x86-64"><a href="#PSU-10-2-0-5-19-p20299014-10205-Linux-x86-64" class="headerlink" title="PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64"></a>PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64</h1><p>操作系统版本 : CentOS Linux release 7.9.2009 (Core)<br>数据库版本 : Oracle 10.2.0.5.0 simple instance<br>OPatch : p6880880_102000_Linux-x86-64.zip<br>DB PSU : p20299014_10205_Linux-x86-64.zip<br>说明：p20299014补丁包无CRS的补丁修复，所以直接打数据库PSU即可</p>
<ol>
<li><p>Update OPatch</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment"># chmod 775 /soft/p6880880_102000_Linux-x86-64-opatch.zip</span><br>[root@centos7 ~]<span class="hljs-comment"># chown /soft/oracle:oinstall p6880880_102000_Linux-x86-64-opatch.zip</span><br><br>[root@centos7 ~]<span class="hljs-comment"># su - oracle</span><br>[oracle@centos7 ~]$ <span class="hljs-built_in">mv</span> /u01/app/oracle/product/10.2.0/db_1/OPatch /tmp/OPatch_bak<br>[oracle@centos7 ~]$ unzip /soft/p6880880_102000_Linux-x86-64-opatch.zip -d <span class="hljs-variable">$ORACLE_HOME</span><br><br>[oracle@centos7 ~]$ <span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch version<br>Invoking OPatch 10.2.0.5.1<br>OPatch Version: 10.2.0.5.1<br>OPatch succeeded.<br></code></pre></td></tr></table></figure>
</li>
<li><p>Patch p20299014</p>
<p>解压补丁包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[root@centos7 ~]<span class="hljs-comment"># chmod 775 PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip</span><br>[root@centos7 ~]<span class="hljs-comment"># chown oracle:oinstall PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip</span><br><br>[root@centos7 ~]<span class="hljs-comment"># su - oracle</span><br>[oracle@centos7 soft]$ unzip PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip<br></code></pre></td></tr></table></figure>

<p>补丁包兼容性检查</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@centos7 soft]$ <span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir /soft/20299014 -oh <span class="hljs-variable">$ORACLE_HOME</span><br>Invoking OPatch 10.2.0.5.1<br><br>Oracle Interim Patch Installer version 10.2.0.5.1<br>Copyright (c) 2010, Oracle Corporation.  All rights reserved.<br><br>PREREQ session<br><br>Oracle Home       : /u01/app/oracle/product/10.2.0/db_1<br>Central Inventory : /u01/app/oracle/oraInventory<br>   from           : /etc/oraInst.loc<br>OPatch version    : 10.2.0.5.1<br>OUI version       : 10.2.0.5.0<br>OUI location      : /u01/app/oracle/product/10.2.0/db_1/oui<br>Log file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_08-50-38AM.<span class="hljs-built_in">log</span><br><br>Patch <span class="hljs-built_in">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt<br><br>Invoking prereq <span class="hljs-string">&quot;checkconflictagainstohwithdetail&quot;</span><br><br>Prereq <span class="hljs-string">&quot;checkConflictAgainstOHWithDetail&quot;</span> passed.<br><br>OPatch succeeded.<br></code></pre></td></tr></table></figure>

<p>查看该补丁能否采用rolling方式升级</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@centos7 ~]$ <span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch query -all /soft/20299014/ | grep rolling<br> Patch is a rolling patch: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>

<p>关闭数据库和监听</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">sqlplus / as sysdba<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">shutdown immediate</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">lsnrctl stop</span><br></code></pre></td></tr></table></figure>

<p>Patch Apply</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@centos7 ~]$ <span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch apply /soft/20299014/<br>Invoking OPatch 10.2.0.5.1<br><br>Oracle Interim Patch Installer version 10.2.0.5.1<br>Copyright (c) 2010, Oracle Corporation.  All rights reserved.<br>Oracle Home : /u01/app/oracle/product/10.2.0/db_1<br> Central Inventory : /u01/app/oracle/oraInventory<br> from : /etc/oraInst.loc<br> OPatch version : 10.2.0.5.1<br> OUI version : 10.2.0.5.0<br> OUI location : /u01/app/oracle/product/10.2.0/db_1/oui<br> Log file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_09-27-57AM.<span class="hljs-built_in">log</span><br><br>Patch <span class="hljs-built_in">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt<br><br>ApplySession applying interim patch <span class="hljs-string">&#x27;20299014&#x27;</span> to OH <span class="hljs-string">&#x27;/u01/app/oracle/product/10.2.0/db_1&#x27;</span><br><br>Running prerequisite checks...<br> Patch 20299014: Optional component(s) missing : [ oracle.rdbms.dv, 10.2.0.5.0 ] , [ oracle.rdbms.dv.oc4j, 10.2.0.5.0 ] , [ oracle .network.cman, 10.2.0.5.0 ] , [ oracle.javavm.companion, 10.2.0.5.0 ] , [ oracle.ordim.companion, 10.2.0.5.0 ] , [ oracle.sqlj, 1 0.2.0.5.0 ] , [ oracle.java.sqlj, 10.2.0.5.0 ]<br> Provide your email address to be informed of security issues, install and<br> initiate Oracle Configuration Manager. Easier <span class="hljs-keyword">for</span> you <span class="hljs-keyword">if</span> you use your My<br> Oracle Support Email address/User Name.<br> Visit http://www.oracle.com/support/policies.html <span class="hljs-keyword">for</span> details.<br> Email address/User Name:<br><br>You have not provided an email address <span class="hljs-keyword">for</span> notification of security issues.<br> Do you wish to remain uninformed of security issues ([Y]es, [N]o) [N]: Y<br><br>OPatch detected non-cluster Oracle Home from the inventory and will patch the <span class="hljs-built_in">local</span> system only.<br><br>Please shutdown Oracle instances running out of this ORACLE_HOME on the <span class="hljs-built_in">local</span> system.<br> (Oracle Home = <span class="hljs-string">&#x27;/u01/app/oracle/product/10.2.0/db_1&#x27;</span>)<br><br>Is the <span class="hljs-built_in">local</span> system ready <span class="hljs-keyword">for</span> patching? [y|n]<br> y<br> User Responded with: Y<br> Backing up files and inventory (not <span class="hljs-keyword">for</span> auto-rollback) <span class="hljs-keyword">for</span> the Oracle Home<br> Backing up files affected by the patch <span class="hljs-string">&#x27;20299014&#x27;</span> <span class="hljs-keyword">for</span> restore. This might take a <span class="hljs-keyword">while</span>...<br> Backing up files affected by the patch <span class="hljs-string">&#x27;20299014&#x27;</span> <span class="hljs-keyword">for</span> rollback. This might take a <span class="hljs-keyword">while</span>...<br> Execution of <span class="hljs-string">&#x27;sh /soft/20299014/custom/scripts/pre -apply 20299014 &#x27;</span>:<br><br>Return Code = 0<br><br>Patching component oracle.rdbms, 10.2.0.5.0...<br><br>...中间过程省略...<br><br>ApplySession adding interim patch <span class="hljs-string">&#x27;20299014&#x27;</span> to inventory<br><br>Verifying the update...<br> Inventory check OK: Patch ID 20299014 is registered <span class="hljs-keyword">in</span> Oracle Home inventory with proper meta-data.<br> Files check OK: Files from Patch ID 20299014 are present <span class="hljs-keyword">in</span> Oracle Home.<br> Execution of <span class="hljs-string">&#x27;sh /soft/20299014/custom/scripts/post -apply 20299014 &#x27;</span>:<br><br>Return Code = 0<br><br>The <span class="hljs-built_in">local</span> system has been patched and can be restarted.<br><br>OPatch succeeded.<br></code></pre></td></tr></table></figure>

<p>检查升级情况</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@centos7 ~] ORACLE_HOME/OPatch/opatch lsinv<br>Invoking OPatch 10.2.0.5.1 <br>Oracle Interim Patch Installer version 10.2.0.5.1<br>Copyright (c) 2010, Oracle Corporation. All rights reserved. <br>Oracle Home : /u01/app/oracle/product/10.2.0/db_1<br>Central Inventory : /u01/app/oracle/oraInventory<br> from : /etc/oraInst.loc<br>OPatch version : 10.2.0.5.1<br>OUI version : 10.2.0.5.0<br>OUI location : /u01/app/oracle/product/10.2.0/db_1/oui<br>Log file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_09-36-48AM.<span class="hljs-built_in">log</span> <br>Patch <span class="hljs-built_in">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt <br>Lsinventory Output file location : /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/lsinv/lsinventory2022-02-14_09-36-48AM.txt<br><br>---<br><br>Installed Top-level Products (2): <br>Oracle Database 10g 10.2.0.1.0<br>Oracle Database 10g Release 2 Patch Set 4 10.2.0.5.0<br>There are 2 products installed <span class="hljs-keyword">in</span> this Oracle Home. <br>Interim patches (1) : <br>Patch 20299014 : applied on Mon Feb 14 09:31:13 CST 2022<br>Unique Patch ID: 19074368<br> Created on 24 Jun 2015, 02:35:37 hrs PST8PDT<br> Bugs fixed:<br> 20074391, 13596521, 17088068, 8865718, 17201047, 13489660, 9020537<br> 8664189, 10091698, 14275629, 19909862, 17832122, 17832123, 17832124<br> 17832125, 16619894, 8822531, 10139235, 20299014, 8350262, 7119382<br> 19274521, 13632738, 11724962, 20331945, 19274523, 9320130, 16961614<br> 16961615, 13775862, 16961616, 16961617, 19006757, 16961618, 16961619<br> 18221699, 9399589, 14841459, 9672816, 9499302, 20299021, 9659614, 13632743<br> 9949948, 14220725, 8882576, 7612454, 7111619, 9711859, 9714832, 12780098<br> 13561951, 14665116, 11066597, 16703112, 19231857, 17721717, 9713537<br> 14459552, 19458377, 13737773, 13737775, 16212405, 18096714, 16338983<br> 14390396, 10249537, 19006849, 7115910, 8354642, 7602341, 14076510<br> 12565867, 15987029, 16462834, 18641419, 11693109, 14023636, 9024850<br> 8394351, 8224558, 17082365, 14149782, 9109487, 14841558, 9171933<br> 10173237, 16817117, 10068982, 10306945, 8666117, 11725006, 10214450<br> 14205448, 17082371, 9767674, 16306019, 9323583, 9726739, 16279211<br> 8412426, 10326338, 10165083, 6651220, 9145204, 13554409, 11076894<br> 19854436, 11893577, 17865671, 16746190, 14492313, 14492314, 11814891<br> 14492315, 14492316, 16742123, 21048089, 16864562, 14546638, 12419258<br> 16056270, 10010310, 18139709, 9689310, 9390484, 21048090, 21048091<br> 9963497, 12551700, 16362358, 12551701, 17465584, 12551702, 12551703<br> 12551704, 10076669, 12551705, 16270946, 12551706, 12551707, 6076890<br> 9308296, 12551708, 14258925, 12880299, 17381900, 18641451, 17381901<br> 17381902, 11790175, 12796518, 9772888, 8650138, 17056813, 14469008<br> 12551710, 10092858, 7519406, 9821321, 8771916, 13349665, 7509714<br> 10159846, 13257247, 18031728, 18641461, 16372203, 11792865, 19007266<br> 19309466, 16309604, 16309605, 16309606, 18522511, 8966823, 11674645<br> 17551414, 15877957, 15877958, 7026523, 15877959, 17716305, 13503598<br> 18767250, 9150282, 9448311, 10327179, 14774730, 19153980, 9735237<br> 9952230, 15877960, 15877961, 15877962, 15877963, 8660422, 18221700<br> 18221701, 16279401, 14546673, 14105702, 14105703, 14105704, 13483152<br> 14269955, 17285560, 12925532, 12748240, 9694101, 12862186, 12862187<br> 14727319, 8211733, 9586877, 9548269, 6694396, 7710224, 9337325, 11856395<br> 10157402, 15950541, 19699191, 6402302, 10327190, 10269717, 13015379<br> 10017048, 8546356, 13561750, 8821114, 9770451, 9360157, 8488233, 10132870<br> 4180770, 9532911, 7361418, 6157713, 9184754, 8544696, 17850678, 8277300<br> 13343467, 16382448, 13791364, 12419392, 10208905, 20236416, 20236417<br> 20236418, 20236419, 7450366, 8970313, 6690853, 6011045, 10162036, 10248542<br> 9469117, 13359623, 9952270, 13343471, 9842573, 17381899, 12710774<br> 20558005, 10324526, 9322219, 8636407, 12828105, 19289642, 13736501<br> 9824435, 13736502, 18681879, 13736503, 13736504, 13736505, 13736506<br> 9032322, 13736507, 14035825, 19769505, 11858315, 14040433, 13916709<br> 12827745, 14038805, 19567242, 16721594, 13923855, 19567243, 8528171<br> 9072105, 19567244, 11737047<br><br>---<br><br>OPatch succeeded.<br></code></pre></td></tr></table></figure>
</li>
<li><p>升级数据库字典</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd $ORACLE_HOME/rdbms/admin<br><br>sqlplus / as sysdba<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">startup</span><br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">@catbundle.sql psu apply</span><br><br>-- Execute the next statement only if this is the first PSU applied for 10.2.0.5 or this is the first PSU applied since 10.2.0.5.3.<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">@utlrp.sql</span><br></code></pre></td></tr></table></figure>

<p>升级后检查</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> line <span class="hljs-number">200</span><br>col ACTION_TIME <span class="hljs-keyword">for</span> a30<br>col ACTION <span class="hljs-keyword">for</span> a20<br>col NAMESPACE <span class="hljs-keyword">for</span> a10<br>col VERSION <span class="hljs-keyword">for</span> a20<br>col BUNDLE_SERIES <span class="hljs-keyword">for</span> a5<br>col COMMENTS <span class="hljs-keyword">for</span> a25<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dba_registry_history;<br><br><span class="hljs-comment">---</span><br>ACTION_TIME                    ACTION               NAMESPACE  VERSION                      ID BUNDL COMMENTS<br><span class="hljs-comment">------------------------------ -------------------- ---------- -------------------- ---------- ----- -------------------------</span><br><span class="hljs-number">14</span><span class="hljs-operator">-</span>FEB<span class="hljs-number">-22</span> <span class="hljs-number">09.51</span><span class="hljs-number">.58</span><span class="hljs-number">.594897</span> AM   jvmpsu.sql           SERVER     <span class="hljs-number">10.2</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span><span class="hljs-number">.2</span>OJVMBP              <span class="hljs-number">0</span>       RAN jvmpsu.sql<br><span class="hljs-number">14</span><span class="hljs-operator">-</span>FEB<span class="hljs-number">-22</span> <span class="hljs-number">09.52</span><span class="hljs-number">.08</span><span class="hljs-number">.639503</span> AM   jvmpsu.sql           SERVER     <span class="hljs-number">10.2</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span><span class="hljs-number">.2</span>OJVMBP              <span class="hljs-number">0</span>       RAN jvmpsu.sql<br><span class="hljs-number">14</span><span class="hljs-operator">-</span>FEB<span class="hljs-number">-22</span> <span class="hljs-number">09.55</span><span class="hljs-number">.41</span><span class="hljs-number">.608731</span> AM   APPLY                SERVER     <span class="hljs-number">10.2</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span>                     <span class="hljs-number">19</span> PSU   PSU <span class="hljs-number">10.2</span><span class="hljs-number">.0</span><span class="hljs-number">.5</span><span class="hljs-number">.19</span><br><br><span class="hljs-number">3</span> <span class="hljs-keyword">rows</span> selected.<br><span class="hljs-comment">---</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Upgrade</category>
      </categories>
      <tags>
        <tag>patch</tag>
        <tag>update</tag>
      </tags>
  </entry>
  <entry>
    <title>patch p6880880</title>
    <url>/blog/posts/45761.html</url>
    <content><![CDATA[<h1 id="Update-OPatch-Utility"><a href="#Update-OPatch-Utility" class="headerlink" title="Update OPatch Utility"></a>Update OPatch Utility</h1><p>To update Opatch, use the following instructions:</p>
<ol>
<li>Download the OPatch utility to a temporary directory.</li>
<li>For each Oracle RAC database home and the GI home that are being patched, run the following commands as the home owner to extract the OPatch utility.<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">unzip &lt;OPATCH-ZIP&gt; -d &lt;ORACLE_HOME&gt;</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/OPatch/opatch version</span><br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Upgrade</category>
      </categories>
      <tags>
        <tag>patch</tag>
        <tag>update</tag>
      </tags>
  </entry>
  <entry>
    <title>patch p32226239</title>
    <url>/blog/posts/52610.html</url>
    <content><![CDATA[<h1 id="Patch-32226239-GI-Release-Update-19-10-0-0-210119"><a href="#Patch-32226239-GI-Release-Update-19-10-0-0-210119" class="headerlink" title="Patch 32226239 - GI Release Update 19.10.0.0.210119"></a>Patch 32226239 - GI Release Update 19.10.0.0.210119</h1><h2 id="1-Patch-Installation-Prerequisites"><a href="#1-Patch-Installation-Prerequisites" class="headerlink" title="1 Patch Installation Prerequisites"></a>1 Patch Installation Prerequisites</h2><h4 id="1-1-Update-OPatch-Utility"><a href="#1-1-Update-OPatch-Utility" class="headerlink" title="1.1 Update OPatch Utility"></a>1.1 Update OPatch Utility</h4><p>You must use the OPatch utility version 12.2.0.1.23 or later to apply this patch for all platforms.<br>To update Opatch, use the following instructions:</p>
<ol>
<li>Download the OPatch utility to a temporary directory.</li>
<li>For each Oracle RAC database home and the GI home that are being patched, run the following commands as the home owner to extract the OPatch utility.<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">unzip &lt;OPATCH-ZIP&gt; -d &lt;ORACLE_HOME&gt;</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/OPatch/opatch version</span><br></code></pre></td></tr></table></figure></li>
</ol>
<p>The version output of the previous command should be 12.2.0.1.23 or later.</p>
<h4 id="1-2-Validation-of-Oracle-Inventory"><a href="#1-2-Validation-of-Oracle-Inventory" class="headerlink" title="1.2 Validation of Oracle Inventory"></a>1.2 Validation of Oracle Inventory</h4><p>Before beginning patch application, check the consistency of inventory information for GI home and each database home to be patched. Run the following command as respective Oracle home owner to check the consistency.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/OPatch/opatch lsinventory -detail -oh &lt;ORACLE_HOME&gt;</span><br></code></pre></td></tr></table></figure>
<p>If this command succeeds, it lists the Oracle components that are installed in the home. Save the output so you have the status prior to the patch apply.<br>If this command fails, contact Oracle Support Services for assistance.</p>
<h4 id="1-3-Download-and-Unzip-the-Patch"><a href="#1-3-Download-and-Unzip-the-Patch" class="headerlink" title="1.3 Download and Unzip the Patch"></a>1.3 Download and Unzip the Patch</h4><p>To apply the patch, it must be accessible from all nodes in the Oracle cluster. Download the patch and unzip it to a shared location, this is called the <code>&lt;UNZIPPED_PATCH_LOCATION&gt;</code>. This directory must be empty and not be <code>/tmp</code>. Additionally, the directory should have read permission for the <code>ORA_INSTALL</code> group.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">unzip p32226239_190000_Linux-x86-64.zip</span><br></code></pre></td></tr></table></figure>

<h4 id="1-4-Run-OPatch-Conflict-Check"><a href="#1-4-Run-OPatch-Conflict-Check" class="headerlink" title="1.4 Run OPatch Conflict Check"></a>1.4 Run OPatch Conflict Check</h4><p>Determine whether any currently installed one-off patches conflict with this patch 32226239 as follows:</p>
<ul>
<li><p>For Grid Infrastructure Home, as home user:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32218454</span><br><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32222571</span><br><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32218663</span><br><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/29340594</span><br><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32240590</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>For Database home, as home user:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32218454</span><br><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32222571</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>The report will indicate the interim patches that conflict with the patch 32226239 and the interim patches for which patch 32226239 is a superset.</p>
<p><strong>Note:</strong></p>
<p>When OPatch starts, it validates the patch and ensures that there are no conflicts with the software already installed in the <code>ORACLE_HOME</code>. OPatch categorizes conflicts into the following types:</p>
<ul>
<li><p>Conflicts with a patch already applied to the <code>ORACLE_HOME</code>.</p>
<p>In this case, stop the patch installation and contact Oracle Support Services.</p>
</li>
<li><p>Conflicts with subset patch already applied to the <code>ORACLE_HOME</code>.</p>
<p>In this case, continue with the patch installation because as the new patch contains all the fixes from the existing patch in the <code>ORACLE_HOME</code>. And, in any case, the subset patch will automatically be rolled back prior to the installation of the new patch.</p>
</li>
</ul>
<h4 id="1-5-Run-OPatch-SystemSpace-Check"><a href="#1-5-Run-OPatch-SystemSpace-Check" class="headerlink" title="1.5 Run OPatch SystemSpace Check"></a>1.5 Run OPatch SystemSpace Check</h4><p>Check if enough free space is available on the <code>ORACLE_HOME</code> filesystem for the patches to be applied as given below:</p>
<ul>
<li><p>For Grid Infrastructure Home, as home user:</p>
<ol>
<li><p>Create file <code>/tmp/patch_list_gihome.txt</code> with the following content:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-built_in">cat</span> &gt; /tmp/patch_list_gihome.txt &lt;&lt; <span class="hljs-string">EOF</span></span><br>&lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32218454<br>&lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32222571<br>&lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32218663<br>&lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/29340594<br>&lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32240590<br>EOF<br></code></pre></td></tr></table></figure>
</li>
<li><p>Run the opatch command to check if enough free space is available in the Grid Infrastructure Home:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckSystemSpace -phBaseFile /tmp/patch_list_gihome.txt</span><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>For Database home, as home user:</p>
<ol>
<li><p>Create file <code>/tmp/patch_list_dbhome.txt</code> with the following content:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-built_in">cat</span> &gt; /tmp/patch_list_dbhome.txt &lt;&lt; <span class="hljs-string">EOF</span></span><br>&lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32218454<br>&lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32222571<br>EOF<br></code></pre></td></tr></table></figure>
</li>
<li><p>Run opatch command to check if enough free space is available in the Database Home:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">% </span><span class="language-bash"><span class="hljs-variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckSystemSpace -phBaseFile /tmp/patch_list_dbhome.txt</span><br></code></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<p>The command output reports pass and fail messages as per the system space availability:</p>
<ul>
<li>If OPatch reports <code>Prereq &quot;checkSystemSpace&quot; failed.</code>, then cleanup the system space as the required amount of space is not available.</li>
<li>If OPatch reports <code>Prereq &quot;checkSystemSpace&quot; passed.</code>, then no action is needed. Proceed with patch installation.</li>
</ul>
<h2 id="2-One-off-Patch-Conflict-Detection-and-Resolution"><a href="#2-One-off-Patch-Conflict-Detection-and-Resolution" class="headerlink" title="2 One-off Patch Conflict Detection and Resolution"></a>2 One-off Patch Conflict Detection and Resolution</h2><p>Manually determine whether any currently installed one-off patches conflict with the PSU patch as follows:</p>
<ul>
<li><p>In the unzipped directory as described in <a href="">Download and Unzip the Patch</a>.</p>
</li>
<li><p>The following commands check for conflicts in both the 12.1 GI home and the 12.1 DB homes.</p>
<ul>
<li><p>In case you are applying the patch, run this command as root:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">GRID_HOME/OPatch/opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -analyze</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>In case you are rolling back the patch, run this command as root:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">GRID_HOME/OPatch/opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -analyze</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>Note that Oracle proactively generates interim patches for common conflicts.</p>
<h2 id="3-opatchauto"><a href="#3-opatchauto" class="headerlink" title="3 opatchauto"></a>3 opatchauto</h2><p>The Opatch utility has automated the patch application for the Oracle Grid Infrastructure (GI) home and the Oracle RAC database homes. It operates by querying existing configurations and automating the steps required for patching each Oracle RAC database home of same version and the GI home.<br>The utility must be executed by an operating system (OS) user with <code>root</code> privileges, and it must be executed on each node in the cluster if the GI home or Oracle RAC database home is in non-shared storage. The utility should not be run in parallel on the cluster nodes.<br>Depending on command line options specified, one invocation of opatchauto can patch the GI home, Oracle RAC database homes, or both GI and Oracle RAC database homes of the same Oracle release version as the patch. You can also roll back the patch with the same selectivity.<br>Add the directory containing the opatchauto to the $PATH environment variable. For example:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:&lt;GI_HOME&gt;/OPatch</span><br></code></pre></td></tr></table></figure>

<p>To patch the GI home and all Oracle RAC database homes of the same version:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239</span><br></code></pre></td></tr></table></figure>

<p>To patch only the GI home:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;GI_HOME&gt;</span><br></code></pre></td></tr></table></figure>

<p>To patch one or more Oracle RAC database homes:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;oracle_home1_path&gt;,&lt;oracle_home2_path&gt;</span><br></code></pre></td></tr></table></figure>

<p>To roll back the patch from the GI home and each Oracle RAC database home:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239</span><br></code></pre></td></tr></table></figure>

<p>To roll back the patch from the GI home:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;path to GI home&gt;</span><br></code></pre></td></tr></table></figure>

<p>To roll back the patch from the Oracle RAC database home:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;oracle_home1_path&gt;,&lt;oracle_home2_path&gt;</span><br></code></pre></td></tr></table></figure>

<p>For more information about <code>opatchauto</code>, see <a href="http://docs.oracle.com/cd/E24628_01/doc.121/e39376/toc.htm">Oracle® OPatch User’s Guide</a>.</p>
<p>For detailed patch installation instructions, see <a href="">Patch Installation</a>.</p>
<h2 id="4-Patch-Installation"><a href="#4-Patch-Installation" class="headerlink" title="4 Patch Installation"></a>4 Patch Installation</h2><p>The patch instructions will differ based on the configuration of the Grid infrastructure and the Oracle RAC database homes. Patching instructions for Oracle RAC Database Homes and GI together are listed below.<br>The most common configurations are listed as follows:</p>
<ul>
<li>Case 1: Oracle RAC, where the GI Home and the Database Homes are not shared and ACFS file system is not configured</li>
<li>Case 2: Oracle RAC, where the GI Home is not shared, Database Home is shared, ACFS may be used</li>
<li>Case 3: Non-Oracle RAC Database homes</li>
</ul>
<p>For other configurations listed below, see My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1591616.1">1591616.1</a>:</p>
<ul>
<li>GI Home is not shared, the Database Home is not shared, ACFS may be used.</li>
<li>Patching Oracle RAC Database Homes.</li>
<li>Patching GI Home alone.</li>
<li>Patching Oracle Restart Home.</li>
<li>Patching a software only GI Home installation or before the GI Home is configured.</li>
</ul>
<p><strong>Patching Oracle RAC Database Homes and GI Together</strong></p>
<ul>
<li><p><strong>Case 1: Oracle RAC, where the GI Home and the Database Homes are not shared and ACFS file system is not configured.</strong></p>
<p>As root user, execute the following command on each node of the cluster:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239</span><br></code></pre></td></tr></table></figure>
</li>
<li><p><strong>Case 2: Oracle RAC, where the GI Home is not shared, Database Home is shared, ACFS may be used.</strong></p>
<p>Patching instructions:</p>
<ol>
<li><p>From the Oracle database home, make sure to stop the Oracle RAC databases running on all nodes. As the database home owner execute:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/bin/srvctl stop database –d &lt;db-unique-name&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>On the 1st node, unmount the ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for unmounting ACFS file systems.</p>
</li>
<li><p>On the 1st node, apply the patch to the GI Home using the <code>opatchauto</code> command. As root user, execute the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;GI_HOME&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>If the message, “A system reboot is recommended before using ACFS” is shown, then a reboot must be issued before continuing. Failure to do so will result in running with an unpatched ACFS\ADVM\OKS driver.</p>
</li>
<li><p>On the 1st node, remount ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for mounting ACFS file systems.</p>
</li>
<li><p>On the 1st node, apply the patch to the Database home using the <code>opatchauto</code> command. Since the Database home is shared, this operation will patch the Database home across the cluster. Note that a USM only patch cannot be applied to a database home. As root user, execute the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;ORACLE_HOME&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>On the 1st node only, restart the Oracle instance, which you have previously stopped in Step <a href="">1</a>. As the database home owner execute:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/bin/srvctl start instance –d &lt;db-unique-name&gt; -n &lt;nodename&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>On the 2nd (next) node, unmount the ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for unmounting ACFS file systems.</p>
</li>
<li><p>On the 2nd node, apply the patch to GI Home using the <code>opatchauto</code> command. As root user, execute the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto apply &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;GI_HOME&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>If the message, “A system reboot is recommended before using ACFS” is shown, then a reboot must be issued before continuing. Failure to do so will result in running with an unpatched ACFS\ADVM\OKS driver.</p>
</li>
<li><p>On the 2nd node, running the <code>opatchauto</code> command in Step <a href="#GUID-F8E80702-38F1-47A0-8625-3D86FB329019__CIHDDCGD">9</a> will restart the stack.</p>
</li>
<li><p>On the 2nd node, remount ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for mounting ACFS file systems.</p>
</li>
<li><p>On the 2nd node only, restart the Oracle instance, which you have previously stopped in Step <a href="#GUID-F8E80702-38F1-47A0-8625-3D86FB329019__CIHHDAFI">1</a>. As the database home owner execute:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/bin/srvctl start instance –d &lt;db-unique-name&gt; -n &lt;nodename&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Repeat Steps <a href="">8</a> through <a href="">13</a> for all remaining nodes of the cluster.</p>
</li>
</ol>
</li>
<li><p><strong>Case 3: Non-Oracle RAC Database homes.</strong></p>
<p>Follow these steps:</p>
<ol>
<li>If you are using a Data Guard Physical Standby database, you must install this patch on both the primary database and the physical standby database, as described by My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=278641.1">278641.1</a>.</li>
<li>If this is not an Oracle RAC environment, shut down all instances and listeners associated with the Oracle home that you are updating. For more information, see Oracle Database Administrator’s Guide.</li>
<li>Set your current directory to the directory where the patch is located and then run the OPatch utility by entering the following commands:<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239/32218454<br>opatch apply<br></code></pre></td></tr></table></figure></li>
<li>If there are errors, refer to <a href="">Known Issues</a>.</li>
</ol>
</li>
</ul>
<h2 id="5-Installing-patch-in-Standby-First-Mode"><a href="#5-Installing-patch-in-Standby-First-Mode" class="headerlink" title="5 Installing patch in Standby-First Mode"></a>5 Installing patch in Standby-First Mode</h2><p>For Data Guard Standby-First patching, see My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1265700.1">1265700.1</a>. For Standby-First patching for Oracle Database RU 12.2 and higher, the following points need to be considered:</p>
<ol>
<li>The Database RU subpatch 32218454 must be applied to the Data Guard standby using Opatch.</li>
<li>Datapatch must not be invoked on the Data Guard standby environment to apply post patch SQL actions for the Database RU. If datapatch is run on a standby, it will error while trying to call the <code>SYS.DBMS_QOPATCH</code> interface. For more details about this error, see My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1599479.1">1599479.1</a>.</li>
<li>Datapatch must be invoked on the primary database after all the databases, that is primary and Data Guard, are patched and patch deployment of the Database RU is complete for the setup.</li>
</ol>
<h2 id="6-Patch-Post-Installation-Instructions"><a href="#6-Patch-Post-Installation-Instructions" class="headerlink" title="6 Patch Post-Installation Instructions"></a>6 Patch Post-Installation Instructions</h2><p>After installing the patch, perform the following actions:</p>
<ol>
<li><p>Apply conflict resolution patches as explained in <a href="#GUID-EF9F3E01-8FBB-4ECE-BFFC-048EF4133C42">Applying Conflict Resolution Patches</a>.</p>
</li>
<li><p>If you are not using opatchauto, then load modified SQL files into the database, as explained in <a href="#GUID-05300C80-F0AB-4F7D-9F28-37738DDE3D50">Loading Modified SQL Files into the Database</a>.</p>
</li>
<li><p>Upgrade Oracle Recovery Manager Catalog, as explained in <a href="#UPOARENC">Upgrade Oracle Recovery Manager Catalog</a>.</p>
</li>
</ol>
<h4 id="6-1-Applying-Conflict-Resolution-Patches"><a href="#6-1-Applying-Conflict-Resolution-Patches" class="headerlink" title="6.1 Applying Conflict Resolution Patches"></a>6.1 Applying Conflict Resolution Patches</h4><p>Apply the patch conflict resolution interim patches that were determined to be needed when you performed the steps in <a href="#GUID-7EA5E77E-1938-4435-9346-C6139689A6F6">One-off Patch Conflict Detection and Resolution</a>.</p>
<h4 id="6-2-Loading-Modified-SQL-Files-into-the-Database"><a href="#6-2-Loading-Modified-SQL-Files-into-the-Database" class="headerlink" title="6.2 Loading Modified SQL Files into the Database"></a>6.2 Loading Modified SQL Files into the Database</h4><p>The following steps load modified SQL files into the database. For a RAC environment, perform these steps on only one node.</p>
<p>Datapatch is run to complete the post-install SQL deployment for the PSU. For further details about Datapatch, including Known Issues and workarounds to common problems, see: Database 12c Post Patch SQL Automation (Doc ID <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1585822.1">1585822.1</a>).</p>
<ol>
<li><p>For each separate database running on the same shared Oracle home being patched, run the <code>datapatch</code> utility as described in <a href="#GUID-05300C80-F0AB-4F7D-9F28-37738DDE3D50__CIHCFCAB" title="Steps to run datapatch script for single tenant versus multitenant (CDB/PDB).">Table 1-3</a>.</p>
<p>Table 1-3 Steps to Run the Datapatch Utility for Standalone DB Versus Single&#x2F;Multitenant (CDB&#x2F;PDB) DB</p>
<table>
<thead>
<tr>
<th>Steps</th>
<th>Standalone DB</th>
<th>Steps</th>
<th>Single&#x2F;Multitenant (CDB&#x2F;PDB) DB</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>% sqlplus /nolog</code></td>
<td>1</td>
<td><code>% sqlplus /nolog</code></td>
</tr>
<tr>
<td>2</td>
<td><code>SQL&gt; Connect / as sysdba</code></td>
<td>2</td>
<td><code>SQL&gt; Connect / as sysdba</code></td>
</tr>
<tr>
<td>3</td>
<td><code>SQL&gt; startup</code></td>
<td>3</td>
<td><code>SQL&gt; startup</code></td>
</tr>
<tr>
<td>4</td>
<td><code>SQL&gt; quit</code></td>
<td>4</td>
<td><code>SQL&gt; alter pluggable database all open``;</code><a href="#fn_1">Foot 1</a></td>
</tr>
<tr>
<td>5</td>
<td><code>% cd $ORACLE_HOME/OPatch</code></td>
<td>5</td>
<td><code>SQL&gt; quit</code></td>
</tr>
<tr>
<td>6</td>
<td><code>% ./datapatch -verbose</code></td>
<td>6</td>
<td><code>% cd $ORACLE_HOME/OPatch</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td>7</td>
<td><code>% ./datapatch -verbose</code></td>
</tr>
</tbody></table>
<p>Footnote 1</p>
<p>It is recommended the Post Install step be run on all pluggable databases; however, the following command (<code>SQL&gt; alter pluggable database</code> <code>PDB_NAME</code> <code>open</code> ) could be substituted to only open certain PDBs in the single&#x2F;multitenant database. Doing so will result in the Post Install step only being run on the CDB and opened PDB’s. To update a pluggable database at a later date (skipped or newly plugged in), open the database using the <code>alter pluggable database</code> command mentioned previously and rerun the datapatch utility. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1935365.1">1935365.1</a> Multitenant Unplug&#x2F;Plug Best Practices for more information about the procedure for unplugging&#x2F;plugging with different patch releases (in both directions).</p>
<p>The <code>datapatch</code> utility will then run the necessary apply scripts to load the modified SQL files into the database. An entry will be added to the <code>dba_registry_sqlpatch</code> view reflecting the patch application. In the <code>dba_registry_sqlpatch</code> view, verify the Status for the APPLY is “SUCCESS”. For any other status, refer to the following My Oracle Support note for additional information and actions: Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1609718.1">1609718.1</a> Datapatch Known Issues.</p>
</li>
<li><p>Check the following log files in <code>$ORACLE_BASE/cfgtoollogs/sqlpatch/32218454/&lt;unique patch ID&gt;</code> for errors:</p>
<p><code>32218454_apply_&lt;database SID&gt;&lt;CDB name&gt;&lt;timestamp&gt;.log</code></p>
<p>where <code>database SID</code> is the database SID, <code>CDB name</code> is the name of the multitenant container database, and <code>timestamp</code> is of the form YYYYMMMDD_HH_MM_SS.</p>
</li>
<li><p>Any databases that have invalid objects after the execution of datapatch should have utlrp.sql run to revalidate those objects.</p>
<p>For example:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd $ORACLE_HOME/rdbms/admin<br>sqlplus /nolog<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">CONNECT / AS SYSDBA</span><br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">@utlrp.sql</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="6-3-Upgrade-Oracle-Recovery-Manager-Catalog"><a href="#6-3-Upgrade-Oracle-Recovery-Manager-Catalog" class="headerlink" title="6.3 Upgrade Oracle Recovery Manager Catalog"></a>6.3 Upgrade Oracle Recovery Manager Catalog</h4><p>If you are using the Oracle Recovery Manager, the catalog needs to be upgraded. Enter the following command to upgrade it. The UPGRADE CATALOG command must be entered twice to confirm the upgrade.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rman catalog username/password@<span class="hljs-built_in">alias</span></span><br><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">UPGRADE CATALOG;</span><br><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">UPGRADE CATALOG;</span><br><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">EXIT;</span><br></code></pre></td></tr></table></figure>

<h2 id="7-Patch-Post-Installation-Instructions-for-Databases-Created-or-Upgraded-after-Installation-of-Patch-in-the-Oracle-Home"><a href="#7-Patch-Post-Installation-Instructions-for-Databases-Created-or-Upgraded-after-Installation-of-Patch-in-the-Oracle-Home" class="headerlink" title="7 Patch Post-Installation Instructions for Databases Created or Upgraded after Installation of Patch in the Oracle Home"></a>7 Patch Post-Installation Instructions for Databases Created or Upgraded after Installation of Patch in the Oracle Home</h2><p>You must execute the steps in <a href="">Loading Modified SQL Files into the Database</a> for any new or upgraded database.</p>
<h2 id="8-Patch-Deinstallation"><a href="#8-Patch-Deinstallation" class="headerlink" title="8 Patch Deinstallation"></a>8 Patch Deinstallation</h2><p>Datapatch is run to complete the post-deinstall SQL deployment for the Database subpatch. For further details about Datapatch, including Known Issues and workarounds to common problems, see: Database 12c Post Patch SQL Automation (Doc ID <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1585822.1">1585822.1</a>).<br>The patch rollback instructions will differ based on the configuration of the Grid infrastructure and the Oracle RAC database homes. Roll Back instructions for Oracle RAC Database Homes and GI are listed below.<br>The most common configurations are listed as follows:</p>
<ul>
<li>Case 1: Oracle RAC, where the GI Home and Database Homes are not shared and ACFS file system is not configured</li>
<li>Case 2: Oracle RAC, where the GI Home is not shared, Database Home is shared and ACFS may be used</li>
<li>Case 3: Non-Oracle RAC Database homes</li>
</ul>
<p>For other configurations listed below, see My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1591616.1">1591616.1</a>:</p>
<ul>
<li><p>GI Home is not shared, the Database Home is not shared, ACFS may be used.</p>
</li>
<li><p>Rolling back from Oracle RAC Database Homes.</p>
</li>
<li><p>Rolling back from GI Home alone.</p>
</li>
<li><p>Rolling back the patch from Oracle Restart Home.</p>
</li>
<li><p>Rolling back the patch from a software only GI Home installation or before the GI Home is configured.</p>
</li>
<li><p><strong>Roll Back the Oracle RAC Database Homes and GI Together</strong></p>
</li>
<li><p><strong>Case 1: Oracle RAC, where the GI Home and Database Homes are not shared and ACFS file system is not configured.</strong></p>
<p>As root user, execute the following command on each node of the cluster.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239</span><br></code></pre></td></tr></table></figure>

<p>If the message, “A system reboot is recommended before using ACFS” is shown, then a reboot must be issued before continuing. Failure to do so will result in running with an unpatched ACFS\ADVM\OKS driver.</p>
</li>
<li><p><strong>Case 2: Oracle RAC, where the GI Home is not shared, Database Home is shared and ACFS may be used.</strong></p>
<ol>
<li><p>From the Oracle database home, make sure to stop the Oracle RAC databases running on all nodes. As the database home owner execute:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/bin/srvctl stop database –d &lt;db-unique-name&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>On the 1st node, unmount the ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for unmounting ACFS file systems.</p>
</li>
<li><p>On the 1st node, roll back the patch from the GI Home using the <code>opatchauto</code> command. As root user, execute the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239 -oh &lt;GI_HOME&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>If the message, “A system reboot is recommended before using ACFS” is shown, then a reboot must be issued before continuing. Failure to do so will result in running with an unpatched ACFS\ADVM\OKS driver.</p>
</li>
<li><p>On the 1st node, remount ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for mounting ACFS file systems.</p>
</li>
<li><p>On the 1st node, roll back the patch to the Database home using the <code>opatchauto</code> command. This operation will rollback the patch to the Database home across the cluster given that it is a shared ACFS home. Note that a USM only patch cannot be applied to a Database home. As root user, execute the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>On the 1st node only, restart the Oracle instance, which you have previously stopped in Step <a href="#GUID-F8E80702-38F1-47A0-8625-3D86FB329019__CIHHDAFI">1</a>. As the database home owner execute:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/bin/srvctl start instance –d &lt;db-unique-name&gt; -n &lt;nodename&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>On the 2nd (next) node, unmount the ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for unmounting ACFS file systems.</p>
</li>
<li><p>On the 2nd node, roll back the patch to GI Home using the <code>opatchauto</code> command. As root user, execute the following command:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">&lt;GI_HOME&gt;/OPatch/opatchauto rollback &lt;UNZIPPED_PATCH_LOCATION&gt;/32226239</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>If the message, “A system reboot is recommended before using ACFS” is shown, then a reboot must be issued before continuing. Failure to do so will result in running with an unpatched ACFS\ADVM\OKS driver.</p>
</li>
<li><p>On the 2nd node, running the <code>opatchauto</code> command in Step <a href="#GUID-B37B005F-2294-4E60-B2A7-F73282FB2273__CIHCIGEG">9</a> will restart the stack.</p>
</li>
<li><p>On the 2nd node, remount ACFS file systems. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1494652.1">1494652.1</a> for mounting ACFS file systems.</p>
</li>
<li><p>On the 2nd node only, restart the Oracle instance, which you have previously stopped in Step <a href="#GUID-B37B005F-2294-4E60-B2A7-F73282FB2273__CIHCJAEF">1</a>. As the database home owner execute:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">&lt;ORACLE_HOME&gt;/bin/srvctl start instance –d &lt;db-unique-name&gt; -n &lt;nodename&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Repeat Steps <a href="#GUID-B37B005F-2294-4E60-B2A7-F73282FB2273__CIHBJCFI">8</a> through <a href="#GUID-B37B005F-2294-4E60-B2A7-F73282FB2273__CIHBIDHH">13</a> for all remaining nodes of the cluster.</p>
</li>
</ol>
</li>
<li><p><strong>Case 3: Non-Oracle RAC Database homes.</strong></p>
<p>Follow these steps:</p>
<ol>
<li><p>Shut down all instances and listeners associated with the Oracle home that you are updating. For more information, see Oracle Database Administrator’s Guide.</p>
</li>
<li><p>Run the OPatch utility specifying the <code>rollback</code> argument as follows.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">opatch rollback -id 32218454<br></code></pre></td></tr></table></figure>
</li>
<li><p>If there are errors, refer to <a href="#GUID-774FEA2B-9E36-4D19-989F-C42DE574915F">Known Issues</a>.</p>
</li>
</ol>
</li>
</ul>
<h3 id="9-Patch-Post-Deinstallation-Instructions"><a href="#9-Patch-Post-Deinstallation-Instructions" class="headerlink" title="9 Patch Post-Deinstallation Instructions"></a>9 Patch Post-Deinstallation Instructions</h3><p>After deinstalling the patch, perform the following actions.</p>
<ul>
<li><p><a href="">Run the datapatch Utility</a></p>
</li>
<li><p><a href="">Upgrade Oracle Recovery Manager Catalog</a></p>
</li>
</ul>
<h4 id="9-1-Run-the-datapatch-Utility"><a href="#9-1-Run-the-datapatch-Utility" class="headerlink" title="9.1 Run the datapatch Utility"></a>9.1 Run the datapatch Utility</h4><p>Perform the following steps:</p>
<ol>
<li><p>For each separate database running on the Oracle home being patched, run the <code>datapatch</code> utility as described in <a href="#GUID-682E2CCD-61C5-41F6-AA62-ED4314EE57DD__CIHJCEJE" title="Steps to run datapatch script for single tenant versus multitenant (CDB/PDB).">Table 1-4</a>. If this is Oracle RAC, run datapatch on only one instance.</p>
<p>Table 1-4 Steps to Run the datapatch Utility for Standalone DB Versus Single&#x2F;Multitenant (CDB&#x2F;PDB) DB</p>
<table>
<thead>
<tr>
<th>Steps</th>
<th>Standalone DB</th>
<th>Steps</th>
<th>Single&#x2F;Multitenant (CDB&#x2F;PDB) DB</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>% sqlplus /nolog</code></td>
<td>1</td>
<td><code>% sqlplus /nolog</code></td>
</tr>
<tr>
<td>2</td>
<td><code>SQL&gt; Connect / as sysdba</code></td>
<td>2</td>
<td><code>SQL&gt; Connect / as sysdba</code></td>
</tr>
<tr>
<td>3</td>
<td><code>SQL&gt; startup</code></td>
<td>3</td>
<td><code>SQL&gt; startup</code></td>
</tr>
<tr>
<td>4</td>
<td><code>SQL&gt; quit</code></td>
<td>4</td>
<td><code>SQL&gt; alter pluggable database all</code> <code>open``;</code><a href="#fn_1">Foot 1</a></td>
</tr>
<tr>
<td>5</td>
<td><code>% cd $ORACLE_HOME/OPatch</code></td>
<td>5</td>
<td><code>SQL&gt; quit</code></td>
</tr>
<tr>
<td>6</td>
<td><code>% ./datapatch -verbose</code></td>
<td>6</td>
<td><code>% cd $ORACLE_HOME/OPatch</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td>7</td>
<td><code>% ./datapatch -verbose</code></td>
</tr>
</tbody></table>
<p>Footnote 1</p>
<p>It is recommended the Post Install step be run on all pluggable databases; however, the following command (<code>SQL&gt; alter pluggable database</code> <code>PDB_NAME</code> <code>open</code> ) could be substituted to only open certain PDBs in the single&#x2F;multitenant database. Doing so will result in the Post Install step only being run on the CDB and opened PDB’s. To update a pluggable database at a later date (skipped or newly plugged in), open the database using the <code>alter pluggable database</code> command mentioned previously and rerun the datapatch utility. See My Oracle Support Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1935365.1">1935365.1</a> Multitenant Unplug&#x2F;Plug Best Practices for more information about the procedure for unplugging&#x2F;plugging with different patch releases (in both directions).</p>
<p>The <code>datapatch</code> utility will then run the necessary apply scripts to load the modified SQL files into the database. An entry will be added to the <code>dba_registry_sqlpatch</code> view reflecting the patch application. In the <code>dba_registry_sqlpatch</code> view, verify the Status for the APPLY is “SUCCESS”. For any other status, refer to the following My Oracle Support note for additional information and actions: Document <a href="https://support.oracle.com/CSP/main/article?cmd=show&type=NOT&id=1609718.1">1609718.1</a> Datapatch Known Issues.</p>
</li>
<li><p>Check the following log files in <code>$ORACLE_HOME/sqlpatch/32218454/</code> for errors:</p>
<p><code>32218454_rollback_&lt;database SID&gt;_&lt;CDB name&gt;_&lt;timestamp&gt;.log</code></p>
<p>where <code>database SID</code> is the database SID, <code>CDB name</code> is the name of the multitenant container database, and <code>timestamp</code> is of the form YYYYMMMDD_HH_MM_SS.</p>
</li>
<li><p>Any databases that have invalid objects after the execution of datapatch should have utlrp.sql run to revalidate those objects.</p>
<p>For example:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">cd $ORACLE_HOME/rdbms/admin<br>sqlplus /nolog<br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">CONNECT / AS SYSDBA</span><br><span class="hljs-meta prompt_">SQL&gt; </span><span class="language-bash">@utlrp.sql</span><br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="9-2-Upgrade-Oracle-Recovery-Manager-Catalog"><a href="#9-2-Upgrade-Oracle-Recovery-Manager-Catalog" class="headerlink" title="9.2 Upgrade Oracle Recovery Manager Catalog"></a>9.2 Upgrade Oracle Recovery Manager Catalog</h4><p>If you are using the Oracle Recovery Manager, the catalog needs to be upgraded. Enter the following command to upgrade it. The UPGRADE CATALOG command must be entered twice to confirm the upgrade.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rman catalog username/password@<span class="hljs-built_in">alias</span></span><br><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">UPGRADE CATALOG;</span><br><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">UPGRADE CATALOG;</span><br><span class="hljs-meta prompt_">RMAN&gt; </span><span class="language-bash">EXIT;</span><br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Upgrade</category>
      </categories>
      <tags>
        <tag>patch</tag>
        <tag>update</tag>
      </tags>
  </entry>
  <entry>
    <title>Block Browser and EDitor</title>
    <url>/blog/posts/42572.html</url>
    <content><![CDATA[<ol>
<li>编译bbed</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@centos7 ~]$ <span class="hljs-built_in">cd</span> <span class="hljs-variable">$ORACLE_HOME</span>/rdbms/lib<br>[oracle@centos7 lib]$ make -f ins_rdbms.mk <span class="hljs-variable">$ORACLE_HOME</span>/rdbms/lib/bbed<br>[oracle@centos7 lib]$ ./bbed<br>Password: blockedit<br><br>BBED: Release 2.0.0.0.0 - Limited Production on Tue Mar 8 14:35:08 2022<br><br>Copyright (c) 1982, 2007, Oracle.  All rights reserved.<br><br>************* !!! For Oracle Internal Use only !!! ***************<br><br>BBED&gt;<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>设置参数</li>
</ol>
<p>查询数据文件信息，并保存至bbed filelist文件中</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> heading off<br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> feedback off<br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> spool <span class="hljs-operator">/</span>u01<span class="hljs-operator">/</span>bbedlist.parf<br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> file#<span class="hljs-operator">||</span><span class="hljs-string">&#x27; &#x27;</span><span class="hljs-operator">||</span>name<span class="hljs-operator">||</span><span class="hljs-string">&#x27; &#x27;</span><span class="hljs-operator">||</span>bytes <span class="hljs-keyword">from</span> v$datafile;<br><span class="hljs-number">1</span> <span class="hljs-operator">/</span>u01<span class="hljs-operator">/</span>app<span class="hljs-operator">/</span>oracle<span class="hljs-operator">/</span>oradata<span class="hljs-operator">/</span>orcl<span class="hljs-operator">/</span>system01.dbf <span class="hljs-number">461373440</span><br><span class="hljs-number">2</span> <span class="hljs-operator">/</span>u01<span class="hljs-operator">/</span>app<span class="hljs-operator">/</span>oracle<span class="hljs-operator">/</span>oradata<span class="hljs-operator">/</span>orcl<span class="hljs-operator">/</span>undotbs01.dbf <span class="hljs-number">414187520</span><br><span class="hljs-number">3</span> <span class="hljs-operator">/</span>u01<span class="hljs-operator">/</span>app<span class="hljs-operator">/</span>oracle<span class="hljs-operator">/</span>oradata<span class="hljs-operator">/</span>orcl<span class="hljs-operator">/</span>sysaux01.dbf <span class="hljs-number">272629760</span><br><span class="hljs-number">4</span> <span class="hljs-operator">/</span>u01<span class="hljs-operator">/</span>app<span class="hljs-operator">/</span>oracle<span class="hljs-operator">/</span>oradata<span class="hljs-operator">/</span>orcl<span class="hljs-operator">/</span>users01.dbf <span class="hljs-number">5242880</span><br><span class="hljs-number">5</span> <span class="hljs-operator">/</span>u01<span class="hljs-operator">/</span>app<span class="hljs-operator">/</span>oracle<span class="hljs-operator">/</span>oradata<span class="hljs-operator">/</span>ccdata.dbf <span class="hljs-number">1825570816</span><br><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> spool off;<br></code></pre></td></tr></table></figure>

<p>创建parameter file</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /u01/bbed.par &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">blocksize=8192</span><br><span class="hljs-string">listfile=/u01/bbedlist.parf</span><br><span class="hljs-string">mode=edit</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>连接bbed</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@centos7 lib]$ ./bbed parfile=/u01/bbed.par password=blockedit<br><br>BBED: Release 2.0.0.0.0 - Limited Production on Tue Mar 8 15:24:27 2022<br><br>Copyright (c) 1982, 2007, Oracle.  All rights reserved.<br><br>************* !!! For Oracle Internal Use only !!! ***************<br><br>BBED&gt; show<br>        FILE<span class="hljs-comment">#           1</span><br>        BLOCK<span class="hljs-comment">#          1</span><br>        OFFSET          0<br>        DBA             0x00400001 (4194305 1,1)<br>        FILENAME        /u01/app/oracle/oradata/orcl/system01.dbf<br>        BIFILE          bifile.bbd<br>        LISTFILE        /u01/bbedlist.parf<br>        BLOCKSIZE       8192<br>        MODE            Edit<br>        EDIT            Unrecoverable<br>        IBASE           Dec<br>        OBASE           Dec<br>        WIDTH           80<br>        COUNT           512<br>        LOGFILE         log.bbd<br>        SPOOL           No<br><br>BBED&gt;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>bbed</tag>
      </tags>
  </entry>
  <entry>
    <title>Datapump</title>
    <url>/blog/posts/6116.html</url>
    <content><![CDATA[<h1 id="Datapump"><a href="#Datapump" class="headerlink" title="Datapump"></a>Datapump</h1><h2 id="Create-a-directory-and-grant-privileges"><a href="#Create-a-directory-and-grant-privileges" class="headerlink" title="Create a directory and grant privileges"></a>Create a directory and grant privileges</h2><p><strong>Check directory</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">set</span> linesize <span class="hljs-number">200</span> pages <span class="hljs-number">100</span><br>col privilege <span class="hljs-keyword">for</span> a10<br>col directory_path <span class="hljs-keyword">for</span> a25<br><span class="hljs-keyword">select</span> t.owner, privilege, directory_name, directory_path<br><span class="hljs-keyword">from</span> user_tab_privs t, all_directories d <br><span class="hljs-keyword">where</span> t.table_name(<span class="hljs-operator">+</span>) <span class="hljs-operator">=</span> d.directory_name <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>, <span class="hljs-number">2</span>;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dba_directories;<br></code></pre></td></tr></table></figure>

<p><strong>Create directory</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> directory expdp1 <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;/expdp&#x27;</span>;<br><span class="hljs-keyword">grant</span> read,write <span class="hljs-keyword">on</span> directory expdp1 <span class="hljs-keyword">to</span> sys,<span class="hljs-keyword">system</span>;<br></code></pre></td></tr></table></figure>

<p><strong>Drop directory</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> directory expdp1;<br></code></pre></td></tr></table></figure>

<h2 id="Export-Mode"><a href="#Export-Mode" class="headerlink" title="Export Mode"></a>Export Mode</h2><ul>
<li><p>Full Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK<br>expdp system/oracle DIRECTORY=expdp1 DUMPFILE=his%U.dmp filesize=8g parallel=4 LOGFILE=hisfull.log full=y cluster=N<br></code></pre></td></tr></table></figure>
</li>
<li><p>Schema Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">expdp system/oracle DIRECTORY=expdp1 DUMPFILE=spacs%U.dmp filesize=8g parallel=1 SCHEMAS=SPACS LOGFILE=spacs.log<br></code></pre></td></tr></table></figure>
</li>
<li><p>Table Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">expdp sd_zy/sd_zy DIRECTORY=expdp1 tables=ZY_YFSTZ0,ZY_DFSTZ0 DUMPFILE=zy%U.dmp filesize=8g parallel=4 LOGFILE=zynew.log<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Import-Mode"><a href="#Import-Mode" class="headerlink" title="Import Mode"></a>Import Mode</h2><ul>
<li><p>Full Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> NLS_LANG=AMERICAN_AMERICA.ZHS16GBK<br>impdp system/oracle DIRECTORY=expdp1 full=y DUMPFILE=HIS%U.DMP parallel=8 LOGFILE=hisfull.log<br></code></pre></td></tr></table></figure>
</li>
<li><p>Schema Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">impdp system/oracle DIRECTORY=expdp1 schemas=itpux01,itpux02,itpux03 DUMPFILE=expdp_itpux010203.dmp LOGFILE=impdp_itpux010203.log<br></code></pre></td></tr></table></figure>
</li>
<li><p>Table Mode</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">impdp sd_zs/sd_zs DIRECTORY=expdp1 tables=zs_blws00 DUMPFILE=sd%U.dmp LOGFILE=zs_blws00.log<br></code></pre></td></tr></table></figure>
</li>
<li><p>Other Situation</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">impdp system/oracle directory=datapump dumpfile=newtopbox%U.dump EXCLUDE=statistics,constraint,index remap_tablespace=<span class="hljs-built_in">users</span>:topbox parallel=6<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="Datapump-Jobs"><a href="#Datapump-Jobs" class="headerlink" title="Datapump Jobs"></a>Datapump Jobs</h2>   <figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看正在运行的作业</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dba_datapump_jobs;<br><br><span class="hljs-comment">-- 附加作业</span><br>expdp <span class="hljs-keyword">system</span><span class="hljs-operator">/</span>oracle attach<span class="hljs-operator">=</span>SYS_EXPORT_TABLE_01<br><br><span class="hljs-comment">-- 立即停止作业</span><br>Export<span class="hljs-operator">&gt;</span> stop_job<span class="hljs-operator">=</span>immeidate<br><br><span class="hljs-comment">-- 分离并删除作业</span><br>Export<span class="hljs-operator">&gt;</span> kill_job<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>datapump</tag>
      </tags>
  </entry>
  <entry>
    <title>OSWatcher</title>
    <url>/blog/posts/18591.html</url>
    <content><![CDATA[<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>将下载好的安装包（文件名为oswbb***.tar）上传至每个数据库节点，并解压</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /u01/oswatcher<br>tar -xvf oswbb840.tar<br></code></pre></td></tr></table></figure>

<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><ol>
<li><p>（可选）追踪RAC私有网络</p>
<p>将Exampleprivate.net拷贝至private.net，编辑private.net</p>
<p>Linux平台上的private.net示例条目：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">######################################################################</span><br><span class="hljs-comment">#Linux Example</span><br><span class="hljs-comment">######################################################################</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;zzz ***&quot;</span>`<span class="hljs-built_in">date</span>`<br>traceroute -r -F rac01-priv<br>traceroute -r -F rac02-priv<br><span class="hljs-comment">######################################################################</span><br><span class="hljs-built_in">rm</span> locks/lock.file<br></code></pre></td></tr></table></figure>
</li>
<li><p>配置oswbb后台运行，每间隔2秒采集一次数据，采集数据保存72小时</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /u01/oswatcher/oswbb<br><br><span class="hljs-comment"># 默认每隔30s采集一次数据，保存48h</span><br><span class="hljs-built_in">nohup</span> ./startOSWbb.sh 2 72 gzip &amp;<br></code></pre></td></tr></table></figure>
</li>
<li><p>编辑系统&#x2F;etc&#x2F;rc.local文件，配置oswbb任务开机自启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">vi /etc/rc.local<br><span class="hljs-built_in">nohup</span> /u01/oswatcher/oswbb/startOSWbb.sh 2 72 gzip &amp;<br></code></pre></td></tr></table></figure>
</li>
<li><p>停止oswbb</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /u01/oswatcher/oswbb<br>./stopOSWbb.sh<br></code></pre></td></tr></table></figure>
</li>
<li><p>java生成性能图表</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">java -jar oswbba.jar -i /u01/oswatcher/oswbb/archive<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h4><p>删除oswbb目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -rf /u01/oswatcher/oswbb<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>oswatcher</tag>
      </tags>
  </entry>
  <entry>
    <title>Overview</title>
    <url>/blog/posts/27588.html</url>
    <content><![CDATA[<p>XTTS(Cross Platform Transportable Tablespaces)属于跨平台迁移表空间，它是从Oracle 8i开始就引入的一种基于表空间传输的物理迁移方法，命名为TTS，经历各个版本的不断演进，从11gR2开始，在相对停机时间要求日益减少的情况，为了应对越来越大的数据量跨平台迁移，Oracle推出了新的解决方案—加强版TTS（以下简称XTTS），XTTS使用增量备份的方式实现跨平台的数据迁移，从真正意义上大大缩短停机时间。在U2L如火如荼的今天，通过XTTS快捷、高效、平稳、安全的将Oracle数据库“小型机+集中式存储”环境迁移至“X86架构平台+分布式存储”已然成为一大神技。</p>
<p>XTTS的发展历史：</p>
<ul>
<li>从8i，tts技术的诞生，引入了相同平台相同块大小之间的表空间传输。到了9i，tts开始支持同平台中，不同块大小的表空间传输。</li>
<li>10g时代，不仅引入了跨平台的表空间传输方案，也就是我们说的xtts；10gR2开始支持传输整个数据库。</li>
<li>11gR1开始，可以传输表空间中的某个特定分区。</li>
<li>在11.2.0.4开始，为了应对越来越大的数据量，而停机时间甚至还在减少的情况，出现了新的解决方案—使用增量备份方式的xtts。</li>
</ul>
<p>XTTS 各版本的功能比对如下：<br><img src="https://s2.loli.net/2022/04/13/jlKP71yr3BCNovk.png"></p>
<p>在 Oracle11gR2（推荐使用 11.2.0.4 及之后版本）以后，Oracle 推出了通过前滚数据文件，拷贝数据后再进行多次增量备份的 XTTS 来完成迁移过程，在这个过程中通过开启块跟踪特性，根据 SCN 号来执行一系列的增量备份，并且通过对块跟踪文件的扫描，来完成增量数据的增量备份应用，最后在通过一定的停机时间，在源库 read only 的状态下进行最后一次增量备份转换应用，使得整个迁移过程的停机时间同源库数据块的变化率成正比。这样大大的缩短了停机时间。</p>
<p>为了减少正式的停机时间，oracle在xtts中引入了rman的增量备份前滚功能。通过一次又一次的增量备份，使停应用的时间主要包含四个方面：将表空间置为只读，最后进行一次增量前滚，元数据导入，数据文件校验。和传统的表空间传输相比，通过减少数据文件的传输时间，而大大减少了整体停机时间。</p>
<h4 id="全量迁移方式"><a href="#全量迁移方式" class="headerlink" title="全量迁移方式"></a>全量迁移方式</h4><p>对于XTTS的全量操作，Oracle提供了2种方式来进行，分别如下：<br><strong>1）dbms_file_transfer(DFT)</strong> – (using xttdriver.pl -S and -G options)</p>
<p>DBMS_FILE_TRANSFER 包是 Oracle 提供的一个用于复制二进制数据库文件或在数据库之间传输二进制文件的程序包，在 XTTS 迁移中，利用不同的参数进行数据文件传输转换完成迁移。</p>
<p><strong>要求：</strong> 目标端数据库版本必须是11.2.0.4以及更新的版本。如果数据库版本低于11.2.0.4(大于Oracle10R1)，那么目标端环境，仍然需要安装11.2.0.4以及更新版本的临时环境，因为XTTS增量的核心脚本功能必须是基于11.2.0.4(+)版本。</p>
<p>如果准备使用 DDBMS_FILE_TRANSFER 作为全量迁移方法，那么必须创建三个数据库对象：</p>
<ol>
<li>源数据库中的数据库目录对象。</li>
<li>目标数据库中的数据库目录对象，放置数据文件的位置。</li>
<li>在目标数据库中创建指向源库的数据库链接。</li>
</ol>
<p><strong>2）Recovery Manager(RMAN)</strong> – (using xttdriver.pl -p and -c options)</p>
<p>通过使用 rman-xttconvert 包提供的参数，对数据库进行基于表空间的备份，将备份产生的备份集写到本地或者 NFS 盘上，然后再通过 rman-xttconvert 包中包含的不同平台之间数据文件格式转换的包对进行数据文件格式转换，最后通过记录的表空间 FILE_ID 号生产元数据的导入脚本，通过 db_link 执行完成。</p>
<h4 id="xttdriver-pl-opation"><a href="#xttdriver-pl-opation" class="headerlink" title="xttdriver.pl opation"></a>xttdriver.pl opation</h4><p><img src="https://s2.loli.net/2022/04/13/lKSgkRhO9c3TQzI.png"></p>
<h4 id="xtt-properties-parameters"><a href="#xtt-properties-parameters" class="headerlink" title="xtt.properties parameters"></a>xtt.properties parameters</h4><p><img src="https://s2.loli.net/2022/04/13/A4IHuRxsqa8TNGv.png"></p>
<h4 id="file-description"><a href="#file-description" class="headerlink" title="file description"></a>file description</h4><ul>
<li><strong>xttplan.txt</strong> - containing the tablespace names, their current SCNs and their datafile numbers</li>
<li><strong>xttnewdatafiles.txt</strong> - containing the tablespace names, datafile numbers, the destination directory object name and the source filenames</li>
<li><strong>getfile.sql</strong> - The PL&#x2F;SQL script(formatting ours) that will be used at the destination to get the datafilesfrom the source</li>
<li><strong>xttpreparesrc.sql</strong> - the PL&#x2F;SQL scriptused to create the files in this step</li>
<li><strong>xttprepareNaNd</strong> - the command</li>
<li><strong>tsbkupmap.txt</strong> - containing the tablespace names, datafile numbers and the incremental backup pieces</li>
<li><strong>incrbackups.txt</strong> - containing the actual location of the incremental backup pieces</li>
<li><strong>rmanincrNaNd</strong> - containing the RMAN scripts used to create the incremental backups.</li>
<li><strong>xttdetnewfromscnsrc.sql</strong> - the PL&#x2F;SQLscript used to create the files in this step</li>
<li><strong>xttplan.txt.new</strong>- after the first run of’xttdriver.pl -i’ this is just a copy of the xttplan.txt</li>
</ul>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>overview</tag>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>Prerequisites</title>
    <url>/blog/posts/30842.html</url>
    <content><![CDATA[<ol>
<li><p>平台字节序和字符集，不支持Windows平台，源端与目标端的字符集需相同</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查询平台和字节序</span><br>col PLATFORM_NAME format a30<br><span class="hljs-keyword">SELECT</span> d.PLATFORM_ID,d.PLATFORM_NAME, tp.ENDIAN_FORMAT<br> <span class="hljs-keyword">FROM</span> V$TRANSPORTABLE_PLATFORM tp, V$DATABASE d<br> <span class="hljs-keyword">WHERE</span> tp.PLATFORM_NAME <span class="hljs-operator">=</span> d.PLATFORM_NAME;<br><br><span class="hljs-comment">-- 查询字符集</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> nls_database_parameters <span class="hljs-keyword">where</span> <span class="hljs-keyword">parameter</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%CHARACTERSET%&#x27;</span>;<br><span class="hljs-keyword">select</span> userenv(<span class="hljs-string">&#x27;language&#x27;</span>) <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></figure>
</li>
<li><p>数据库时区，源端与目标端的时区需相同</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> dbtimezone <span class="hljs-keyword">from</span> dual;<br></code></pre></td></tr></table></figure>
</li>
<li><p>数据库版本及补丁，源端 ≥10.2.0.3 企业版，目标端 ≥11.2.0.4 企业版</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> v$version;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> dba_registry_history;<br></code></pre></td></tr></table></figure>
</li>
<li><p>数据库组件，目标端需要包含源端的所有组件</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> comp_id,comp_name,version,status <span class="hljs-keyword">from</span> dba_registry;<br></code></pre></td></tr></table></figure>
</li>
<li><p>归档模式，源端需开启归档模式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">archive log list;<br></code></pre></td></tr></table></figure>
</li>
<li><p>compatible参数和db_files参数，源端compatible参数需要设置为 ≥10.2.0，目标端compatible参数和db_files参数要 ≥ 源端</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">parameter</span> compatible;<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">parameter</span> db_files;<br></code></pre></td></tr></table></figure>
</li>
<li><p>需要迁移的表空间和用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> TABLESPACE_NAME,BLOCK_SIZE,CONTENTS,STATUS<br> <span class="hljs-keyword">from</span> dba_tablespaces<br> <span class="hljs-keyword">where</span> tablespace_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;EXAMPLE&#x27;</span>,<span class="hljs-string">&#x27;SCOTT&#x27;</span>);<br><br><span class="hljs-keyword">select</span> owner,tablespace_name,<span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<br> <span class="hljs-keyword">from</span> dba_segments <br> <span class="hljs-keyword">where</span> tablespace_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;EXAMPLE&#x27;</span>,<span class="hljs-string">&#x27;SCOTT&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner,tablespace_name <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> tablespace_name;<br></code></pre></td></tr></table></figure>
</li>
<li><p>确保需要迁移的表空间处于联机可读写模式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> tablespace_name,status <span class="hljs-keyword">from</span> dba_tablespaces<br> <span class="hljs-keyword">where</span> tablespace_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;EXAMPLE&#x27;</span>,<span class="hljs-string">&#x27;SCOTT&#x27;</span>);<br></code></pre></td></tr></table></figure>
</li>
<li><p>表空间自包含检查</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 自包含检查</span><br><span class="hljs-keyword">execute</span> dbms_tts.transport_set_check(<span class="hljs-string">&#x27;TBS_COCO,ITPUX01,ITPUX02,ITPUX03&#x27;</span>,<span class="hljs-literal">TRUE</span>);<br><br><span class="hljs-comment">-- 查看结果，结果为空，表示自包含</span><br>col violations <span class="hljs-keyword">for</span> a70<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> sys.transport_set_violations;<br></code></pre></td></tr></table></figure>
</li>
<li><p>获取用户及其权限的SQL</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> LONG <span class="hljs-number">9999</span><br><span class="hljs-keyword">SELECT</span> DBMS_METADATA.GET_DDL(<span class="hljs-string">&#x27;USER&#x27;</span>, USERNAME) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;;&#x27;</span> DDL_SQL<br> <span class="hljs-keyword">FROM</span> DBA_USERS <span class="hljs-keyword">WHERE</span> USERNAME<br> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">select</span> owner  <span class="hljs-keyword">from</span> dba_segments <span class="hljs-keyword">where</span> tablespace_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;EXAMPLE&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner,tablespace_name) <span class="hljs-keyword">AND</span> USERNAME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;SYS&#x27;</span>,<span class="hljs-string">&#x27;SCOTT&#x27;</span>);<br><br><span class="hljs-keyword">SELECT</span> DBMS_METADATA.GET_GRANTED_DDL(<span class="hljs-string">&#x27;SYSTEM_GRANT&#x27;</span>, USERNAME) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;;&#x27;</span> DDL_SQL<br> <span class="hljs-keyword">FROM</span> DBA_USERS <span class="hljs-keyword">WHERE</span> USERNAME<br> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">select</span> owner  <span class="hljs-keyword">from</span> dba_segments <span class="hljs-keyword">where</span>  tablespace_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;EXAMPLE&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner,tablespace_name) <span class="hljs-keyword">AND</span> USERNAME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;SYS&#x27;</span>,<span class="hljs-string">&#x27;SCOTT&#x27;</span>);<br><br><span class="hljs-keyword">SELECT</span> DBMS_METADATA.GET_GRANTED_DDL(<span class="hljs-string">&#x27;ROLE_GRANT&#x27;</span>, USERNAME) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;;&#x27;</span> DDL_SQL<br> <span class="hljs-keyword">FROM</span> DBA_USERS <span class="hljs-keyword">WHERE</span> USERNAME<br> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">select</span> owner  <span class="hljs-keyword">from</span> dba_segments <span class="hljs-keyword">where</span>  tablespace_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;EXAMPLE&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner,tablespace_name) <span class="hljs-keyword">AND</span> USERNAME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;SYS&#x27;</span>,<span class="hljs-string">&#x27;SCOTT&#x27;</span>);<br><br><span class="hljs-keyword">SELECT</span> DBMS_METADATA.GET_GRANTED_DDL(<span class="hljs-string">&#x27;OBJECT_GRANT&#x27;</span>, USERNAME) <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;;&#x27;</span> DDL_SQL<br> <span class="hljs-keyword">FROM</span> DBA_USERS <span class="hljs-keyword">WHERE</span> USERNAME<br> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">select</span> owner  <span class="hljs-keyword">from</span> dba_segments <span class="hljs-keyword">where</span>  tablespace_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;EXAMPLE&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner,tablespace_name) <span class="hljs-keyword">AND</span> USERNAME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;SYS&#x27;</span>,<span class="hljs-string">&#x27;SCOTT&#x27;</span>);<br></code></pre></td></tr></table></figure>
</li>
<li><p>对象数量统计</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 需要迁移的对象和数量</span><br><span class="hljs-keyword">select</span> owner, object_type, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<br> <span class="hljs-keyword">from</span> dba_objects<br> <span class="hljs-keyword">where</span> object_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;BIN%&#x27;</span><br> <span class="hljs-keyword">and</span> owner <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;COCO&#x27;</span>,<span class="hljs-string">&#x27;ITPUX01&#x27;</span>,<span class="hljs-string">&#x27;ITPUX02&#x27;</span>,<span class="hljs-string">&#x27;ITPUX03&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner, object_type<br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span> <span class="hljs-keyword">desc</span>;<br><br><span class="hljs-comment">-- 无效对象</span><br><span class="hljs-keyword">select</span> owner, object_type, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<br> <span class="hljs-keyword">from</span> dba_objects<br><span class="hljs-keyword">where</span> status <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">&#x27;VALID&#x27;</span><br> <span class="hljs-keyword">and</span> owner <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;COCO&#x27;</span>,<span class="hljs-string">&#x27;ITPUX01&#x27;</span>,<span class="hljs-string">&#x27;ITPUX02&#x27;</span>,<span class="hljs-string">&#x27;ITPUX03&#x27;</span>)<br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner, object_type<br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span> <span class="hljs-keyword">desc</span>;<br><br><span class="hljs-comment">-- 非业务用户下是否有业务数据</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br> <span class="hljs-keyword">FROM</span> dba_objects d<br> <span class="hljs-keyword">where</span> d.created <span class="hljs-operator">&gt;=</span> sysdate <span class="hljs-operator">-</span> <span class="hljs-number">10</span><br> <span class="hljs-keyword">and</span> d.object_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;WR%&#x27;</span><br> <span class="hljs-keyword">and</span> d.owner <span class="hljs-keyword">IN</span> (<span class="hljs-string">&#x27;SYS&#x27;</span>,<span class="hljs-string">&#x27;SYSTEM&#x27;</span>)<br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> d.created <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>开启块跟踪</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> v$block_change_tracking;<br><span class="hljs-keyword">alter</span> database enable block change tracking <span class="hljs-keyword">using</span> file <span class="hljs-string">&#x27;+DATA&#x27;</span>;<br></code></pre></td></tr></table></figure>
</li>
<li><p>目标端调整job参数，防止job调度任务，修改迁移后的数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">system</span> <span class="hljs-keyword">set</span> job_queue_processes<span class="hljs-operator">=</span><span class="hljs-number">0</span> sid<span class="hljs-operator">=</span><span class="hljs-string">&#x27;*&#x27;</span>;<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
        <tag>prerequisites</tag>
      </tags>
  </entry>
  <entry>
    <title>Using dbms_file_transfer</title>
    <url>/blog/posts/13088.html</url>
    <content><![CDATA[<p>All steps in this procedure are run as the <strong>oracle user</strong> that is a member of the OSDBA group. OS authentication is used to connect to both the source and destination databases.</p>
<ol>
<li><p>Initial Setup</p>
<p>1.1 创建xtts目录，解压rman_xttconvert_v3.zip软件包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /home/oracle/xtts/backup<br><span class="hljs-built_in">mkdir</span> -p /home/oracle/xtts/backup_incr<br><span class="hljs-built_in">mkdir</span> -p /home/oracle/xtts/scripts<br><span class="hljs-built_in">cd</span> /home/oracle/xtts<br>unzip rman_xttconvert_v3.zip<br></code></pre></td></tr></table></figure>

<p>1.2 配置xtt.properties参数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; xtt.properties &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br>tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03<br>platformid=13<br>srcdir=SOURCEDIR<br>dstdir=DESTDIR<br>srclink=ttslink<br><span class="hljs-comment"># dfcopydir=/home/oracle/xtts/backup</span><br>backupformat=/home/oracle/xtts/backup_incr<br>stageondest=/home/oracle/xtts/backup<br>storageondest=+DATA/coco/pdb<br>backupondest=/home/oracle/xtts/backup_incr<br>asm_home=/u01/app/19.0.0/grid<br>asm_sid=+ASM<br>parallel=3<br>rollparallel=2<br>getfileparallel=4<br>EOF<br></code></pre></td></tr></table></figure>

<p>1.3 （可选）目标端配置临时实例用于增量备份恢复，目标端11.2.0.4及以上跳过此步骤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> ORACLE_SID=xtts<br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; $ORACLE_HOME/dbs/init$ORACLE_SID.ora</span><br><span class="hljs-string">db_name=xtts</span><br><span class="hljs-string">compatible=19.0.0</span><br><span class="hljs-string">EOF</span><br><br>sqlplus / as sysdba<br>SQL&gt; startup nomount<br></code></pre></td></tr></table></figure>

<p>1.4 目标端创建连接源端的dblink</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> public database link ttslink <span class="hljs-keyword">connect</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">system</span> identified <span class="hljs-keyword">by</span> oracle<br> <span class="hljs-keyword">using</span> <span class="hljs-string">&#x27;(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.184.145 )(PORT = 1521))  ) (CONNECT_DATA = (SERVICE_NAME = coco) ) )&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>1.5 创建数据库目录</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 源端创建SOURCEDIR</span><br><span class="hljs-keyword">create</span> directory SOURCEDIR <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;+DATA/coco&#x27;</span>;<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> directory SOURCEDIR <span class="hljs-keyword">to</span> public;<br><br><span class="hljs-comment">-- 目标端创建DESTDIR</span><br><span class="hljs-keyword">create</span> directory DESTDIR <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;+DATA/coco/pdb&#x27;</span>;<br><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> directory DESTDIR <span class="hljs-keyword">to</span> public;<br></code></pre></td></tr></table></figure>

<p>1.6 源端和目标端设置临时目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@<span class="hljs-built_in">source</span>]$ <span class="hljs-built_in">export</span> TMPDIR=/home/oracle/xtts/scripts<br>[oracle@dest]$ <span class="hljs-built_in">export</span> TMPDIR=/home/oracle/xtts/scripts<br></code></pre></td></tr></table></figure>
</li>
<li><p>Prepare Phase for dbms_file_transfer Method</p>
<p>2.1 源端执行以下命令，创建getfile.sql和xttnewdatafiles.txt文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -S<br></code></pre></td></tr></table></figure>

<p>2.2 拷贝getfile.sql和xttnewdatafiles.txt文件文件至目标端</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">scp <span class="hljs-variable">$TMPDIR</span>/getfile.sql oracle@dest:<span class="hljs-variable">$TMPDIR</span><br>scp <span class="hljs-variable">$TMPDIR</span>/xttnewdatafiles.txt oracle@dest:<span class="hljs-variable">$TMPDIR</span><br></code></pre></td></tr></table></figure>

<p>2.3 目标端进行数据文件拷贝</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -G<br></code></pre></td></tr></table></figure>
</li>
<li><p>Roll Forward Phase</p>
<p>3.1 源端生成增量备份文件至<code>backupformat</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i<br></code></pre></td></tr></table></figure>

<p>3.2 拷贝增量备份文件、xttplan、tsbkupmap至目标端<code>stageondest</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">scp `<span class="hljs-built_in">cat</span> <span class="hljs-variable">$TMPDIR</span>/incrbackups.txt` oracle@dest:/home/oracle/xtts/backup<br>scp <span class="hljs-variable">$TMPDIR</span>/xttplan.txt oracle@des:<span class="hljs-variable">$TMPDIR</span><br>scp <span class="hljs-variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="hljs-variable">$TMPDIR</span><br></code></pre></td></tr></table></figure>

<p>3.3 目标端做增量前滚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r<br></code></pre></td></tr></table></figure>

<p>3.4 源端确定下一个增量备份的FROM_SCN</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -s<br></code></pre></td></tr></table></figure>

<p>3.5 Repeat the Roll Forward Phase (Phase 3)</p>
</li>
<li><p>Transport Phase</p>
<p>4.1 源端将表空间置为只读模式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;ALTER TABLESPACE &#x27;</span><span class="hljs-operator">||</span>name<span class="hljs-operator">||</span><span class="hljs-string">&#x27; READ ONLY;&#x27;</span> exec_sql<br> <span class="hljs-keyword">from</span> v$tablespace <span class="hljs-keyword">where</span> NAME <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;USERS&#x27;</span>);<br><br><span class="hljs-keyword">select</span> tablespace_name,status <span class="hljs-keyword">from</span> dba_tablespaces;<br></code></pre></td></tr></table></figure>

<p>4.2 重复步骤3.1 - 3.3，做最后一次增量前滚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@<span class="hljs-built_in">source</span>]$ <span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i<br><br>[oracle@<span class="hljs-built_in">source</span>]$ scp `<span class="hljs-built_in">cat</span> <span class="hljs-variable">$TMPDIR</span>/incrbackups.txt` oracle@dest:/home/oracle/xtts/backup<br><br>[oracle@<span class="hljs-built_in">source</span>]$ scp <span class="hljs-variable">$TMPDIR</span>/xttplan.txt oracle@dest:<span class="hljs-variable">$TMPDIR</span><br>[oracle@<span class="hljs-built_in">source</span>]$ scp <span class="hljs-variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="hljs-variable">$TMPDIR</span><br><br>[oracle@dest]$ <span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r<br></code></pre></td></tr></table></figure>
</li>
<li><p>Import Object Metadata into Destination Database</p>
<p>5.1 目标端创建业务用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;ITPUX01&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:98BB089CD1A16CBD4803C404C3279A570D607F667DD6E5EB7A19735B7FA6;358208C73FF2939C&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;COCO&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:37AB55E527FC21D62DEA2949499DD9D9F7EC2A5C97C9140A23ADEBB365BD;96B138098030A3C8&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;ITPUX02&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:21BC086145990A7CC133F01E0D80B7548EA49DB694F44E972CEC33685168;499779BC208401AE&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;ITPUX03&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:4C2C70077865FBFE627E08288E24FC9307DAF72DAC9C36EA9D31AE332263;CE4FDA4704D50F9C&#x27;</span>;<br><br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX01&quot;;<br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX02&quot;;<br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX03&quot;;<br></code></pre></td></tr></table></figure>

<p>5.2 目标端生成Data Pump TTS命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -e<br><span class="hljs-built_in">cat</span> <span class="hljs-variable">$TMPDIR</span>/xttplugin.txt<br></code></pre></td></tr></table></figure>

<p>5.3 迁移表空间元数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">impdp system/oracle@pdb directory=DATA_PUMP_DIR logfile=tts_imp.log \<br>network_link=ttslink transport_full_check=no \<br>exclude=statistics \<br>transport_tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03 \<br>transport_datafiles=<span class="hljs-string">&#x27;+DATA/coco/pdb/tbs_coco01.dbf&#x27;</span>,<span class="hljs-string">&#x27;+DATA/coco/pdb/itpux01.dbf&#x27;</span>,<span class="hljs-string">&#x27;+DATA/coco/pdb/itpux02.dbf&#x27;</span>,<span class="hljs-string">&#x27;+DATA/coco/pdb/itpux03.dbf&#x27;</span><br></code></pre></td></tr></table></figure>

<p>5.4 迁移存储过程、触发器、函数、包、视图、序列</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">impdp system/oracle@pdb directory=DATA_PUMP_DIR \<br>network_link=ttslink schemas=COCO,ITPUX01,ITPUX02,ITPUX03 content=metadata_only exclude=index,table parallel=8<br></code></pre></td></tr></table></figure>

<p>5.5 导入同义词、dblink和其他对象</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">-- 导入公共同义词<br><span class="hljs-built_in">set</span> long 9999<br>select dbms_metadata.get_ddl(<span class="hljs-string">&#x27;SYNONYM&#x27;</span>,SYNONYM_NAME,OWNER)<br> FROM dba_synonyms <span class="hljs-built_in">where</span> owner=<span class="hljs-string">&#x27;PUBLIC&#x27;</span> and table_owner <span class="hljs-keyword">in</span>  (<span class="hljs-string">&#x27;COCO&#x27;</span>,<span class="hljs-string">&#x27;ITPUX01&#x27;</span>,<span class="hljs-string">&#x27;ITPUX02&#x27;</span>,<span class="hljs-string">&#x27;ITPUX03&#x27;</span>);<br><br>-- 导入dblink<br><span class="hljs-built_in">set</span> long 9999<br>select dbms_metadata.get_ddl(<span class="hljs-string">&#x27;DB_LINK&#x27;</span>,DB_LINK,OWNER) FROM DBA_DB_LINKS;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Post-migration</p>
<p>6.1 检查数据库一致性</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> owner, object_type, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<br> <span class="hljs-keyword">from</span> dba_objects<br> <span class="hljs-keyword">where</span> object_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;BIN%&#x27;</span><br> <span class="hljs-keyword">and</span> owner <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;COCO&#x27;</span>,<span class="hljs-string">&#x27;ITPUX01&#x27;</span>,<span class="hljs-string">&#x27;ITPUX02&#x27;</span>,<span class="hljs-string">&#x27;ITPUX03&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner, object_type<br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span> <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>

<p>6.2 业务用户修改权限和默认表空间</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;ITPUX01&quot; <span class="hljs-keyword">DEFAULT</span> TABLESPACE &quot;ITPUX01&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;ITPUX02&quot; <span class="hljs-keyword">DEFAULT</span> TABLESPACE &quot;ITPUX02&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;ITPUX03&quot; EFAULT TABLESPACE &quot;ITPUX03&quot;;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;COCO&quot; <span class="hljs-keyword">DEFAULT</span> TABLESPACE &quot;TBS_COCO&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;<br><span class="hljs-keyword">GRANT</span> UNLIMITED TABLESPACE <span class="hljs-keyword">TO</span> &quot;ITPUX01&quot;;<br><span class="hljs-keyword">GRANT</span> UNLIMITED TABLESPACE <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br><span class="hljs-keyword">GRANT</span> UNLIMITED TABLESPACE <span class="hljs-keyword">TO</span> &quot;ITPUX02&quot;;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> JOB <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> &quot;COCO&quot;.&quot;TESTTABLE&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX01&quot;;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> &quot;SYS&quot;.&quot;DBA_USERS&quot; <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br></code></pre></td></tr></table></figure>

<p>6.3 表空间置为读写模式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;ALTER TABLESPACE &#x27;</span><span class="hljs-operator">||</span>name<span class="hljs-operator">||</span><span class="hljs-string">&#x27; READ WRITE;&#x27;</span> exec_sql <span class="hljs-keyword">from</span> v$tablespace<br> <span class="hljs-keyword">where</span> NAME <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;USERS&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>6.4 校验数据文件完整性</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">RMAN<span class="hljs-operator">&gt;</span> validate tablespace COCO,ITPUX01,ITPUX02,ITPUX03 <span class="hljs-keyword">check</span> logical;<br></code></pre></td></tr></table></figure>

<p>6.5 收集统计信息</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">exec</span> dbms_stats.gather_database_stats(degree <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>);<br><span class="hljs-keyword">exec</span> dbms_stats.gather_dictionary_stats(degree <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>);<br><span class="hljs-keyword">exec</span> dbms_stats.gather_fixed_objects_stats();<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Recovery Manager</title>
    <url>/blog/posts/62208.html</url>
    <content><![CDATA[<p>All steps in this procedure are run as the <strong>oracle user</strong> that is a member of the OSDBA group. OS authentication is used to connect to both the source and destination databases.</p>
<ol>
<li><p>Initial Setup</p>
<p>1.1 创建xtts目录，解压rman_xttconvert_v3.zip软件包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /home/oracle/xtts/backup<br><span class="hljs-built_in">mkdir</span> -p /home/oracle/xtts/backup_incr<br><span class="hljs-built_in">mkdir</span> -p /home/oracle/xtts/scripts<br><span class="hljs-built_in">cd</span> /home/oracle/xtts<br>unzip rman_xttconvert_v3.zip<br></code></pre></td></tr></table></figure>

<p>1.2 配置xtt.properties参数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; xtt.properties &lt;&lt; <span class="hljs-string">&#x27;EOF&#x27;</span><br>tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03<br>platformid=13<br>dfcopydir=/home/oracle/xtts/backup<br>backupformat=/home/oracle/xtts/backup_incr<br>stageondest=/home/oracle/xtts/backup<br>storageondest=+DATA/coco/pdb<br>backupondest=/home/oracle/xtts/backup_incr<br>asm_home=/u01/app/19.0.0/grid<br>asm_sid=+ASM<br>parallel=3<br>rollparallel=2<br>getfileparallel=4<br>EOF<br></code></pre></td></tr></table></figure>

<p>1.3 （可选）目标端配置临时实例用于增量备份恢复</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> ORACLE_SID=xtts<br><span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">EOF &gt; $ORACLE_HOME/dbs/init$ORACLE_SID.ora</span><br><span class="hljs-string">db_name=xtts</span><br><span class="hljs-string">compatible=19.0.0</span><br><span class="hljs-string">EOF</span><br><br>sqlplus / as sysdba<br>SQL&gt; startup nomount<br></code></pre></td></tr></table></figure>

<p>1.4 目标端创建连接源端的dblink</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> public database link ttslink <span class="hljs-keyword">connect</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">system</span> identified <span class="hljs-keyword">by</span> oracle<br> <span class="hljs-keyword">using</span> <span class="hljs-string">&#x27;(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.184.145 )(PORT = 1521))  ) (CONNECT_DATA = (SERVICE_NAME = coco) ) )&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>1.5 源端和目标端设置临时目录</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@<span class="hljs-built_in">source</span>]$ <span class="hljs-built_in">export</span> TMPDIR=/home/oracle/xtts/scripts<br>[oracle@dest]$ <span class="hljs-built_in">export</span> TMPDIR=/home/oracle/xtts/scripts<br></code></pre></td></tr></table></figure>
</li>
<li><p>Prepare Phase for RMAN Backup Method</p>
<p>2.1 源端生成数据文件副本至<code>dfcopydir</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -p<br></code></pre></td></tr></table></figure>

<p>2.2 拷贝数据文件副本和rmanconvert.cmd文件至目标端<code>stageondest</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">scp /home/oracle/xtts/backup/* oracle@dest:/home/oracle/xtts/backup<br>scp <span class="hljs-variable">$TMPDIR</span>/rmanconvert.cmd oracle@dest:<span class="hljs-variable">$TMPDIR</span><br></code></pre></td></tr></table></figure>

<p>2.3 目标端进行数据文件字节序转换</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -c<br></code></pre></td></tr></table></figure>
</li>
<li><p>Roll Forward Phase</p>
<p>3.1 源端生成增量备份文件至<code>backupformat</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i<br></code></pre></td></tr></table></figure>

<p>3.2 拷贝增量备份文件、xttplan、tsbkupmap至目标端<code>stageondest</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">scp `<span class="hljs-built_in">cat</span> <span class="hljs-variable">$TMPDIR</span>/incrbackups.txt` oracle@dest:/home/oracle/xtts/backup<br>scp <span class="hljs-variable">$TMPDIR</span>/xttplan.txt oracle@des:<span class="hljs-variable">$TMPDIR</span><br>scp <span class="hljs-variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="hljs-variable">$TMPDIR</span><br></code></pre></td></tr></table></figure>

<p>3.3 目标端做增量前滚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r<br></code></pre></td></tr></table></figure>

<p>3.4 源端确定下一个增量备份的FROM_SCN</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -s<br></code></pre></td></tr></table></figure>

<p>3.5 Repeat the Roll Forward Phase (Phase 3)</p>
</li>
<li><p>Transport Phase</p>
<p>4.1 源端将表空间置为只读模式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;ALTER TABLESPACE &#x27;</span><span class="hljs-operator">||</span>name<span class="hljs-operator">||</span><span class="hljs-string">&#x27; READ ONLY;&#x27;</span> exec_sql<br> <span class="hljs-keyword">from</span> v$tablespace <span class="hljs-keyword">where</span> NAME <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;USERS&#x27;</span>);<br><br><span class="hljs-keyword">select</span> tablespace_name,status <span class="hljs-keyword">from</span> dba_tablespaces;<br></code></pre></td></tr></table></figure>

<p>4.2 重复步骤3.1 - 3.3，做最后一次增量前滚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">[oracle@<span class="hljs-built_in">source</span>]$ <span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -i<br><br>[oracle@<span class="hljs-built_in">source</span>]$ scp `<span class="hljs-built_in">cat</span> incrbackups.txt` oracle@dest:/home/oracle/xtts/backup<br><br>[oracle@<span class="hljs-built_in">source</span>]$ scp <span class="hljs-variable">$TMPDIR</span>/xttplan.txt oracle@dest:<span class="hljs-variable">$TMPDIR</span><br>[oracle@<span class="hljs-built_in">source</span>]$ scp <span class="hljs-variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="hljs-variable">$TMPDIR</span><br><br>[oracle@dest]$ <span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -r<br></code></pre></td></tr></table></figure>
</li>
<li><p>Import Object Metadata into Destination Database</p>
<p>5.1 目标端创建业务用户</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;ITPUX01&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:98BB089CD1A16CBD4803C404C3279A570D607F667DD6E5EB7A19735B7FA6;358208C73FF2939C&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;COCO&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:37AB55E527FC21D62DEA2949499DD9D9F7EC2A5C97C9140A23ADEBB365BD;96B138098030A3C8&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;ITPUX02&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:21BC086145990A7CC133F01E0D80B7548EA49DB694F44E972CEC33685168;499779BC208401AE&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> &quot;ITPUX03&quot; IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-string">&#x27;S:4C2C70077865FBFE627E08288E24FC9307DAF72DAC9C36EA9D31AE332263;CE4FDA4704D5UX00F9C&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX01&quot;;<br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX02&quot;;<br><span class="hljs-keyword">GRANT</span> &quot;DBA&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX03&quot;;<br></code></pre></td></tr></table></figure>

<p>5.2 目标端生成Data Pump TTS命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl -e<br><span class="hljs-built_in">cat</span> /home/oracle/xtts/scripts/xttplugin.txt<br></code></pre></td></tr></table></figure>

<p>5.3 迁移表空间元数据</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">impdp system/oracle@pdb directory=DATA_PUMP_DIR logfile=tts_imp.log \<br>network_link=ttslink transport_full_check=no \<br>exclude=statistics \<br>transport_tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03 \<br>transport_datafiles=<span class="hljs-string">&#x27;+DATA/tbs_coco_8.dbf&#x27;</span>,<span class="hljs-string">&#x27;+DATA/itpux01_5.dbf&#x27;</span>,<span class="hljs-string">&#x27;+DATA/itpux02_6.dbf&#x27;</span>,<span class="hljs-string">&#x27;+DATA/itpux03_7.dbf&#x27;</span><br></code></pre></td></tr></table></figure>

<p>5.4 迁移存储过程、触发器、函数、包、视图、序列</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">impdp system/oracle@pdb directory=DATA_PUMP_DIR \<br>network_link=ttslink schemas=COCO,ITPUX01,ITPUX02,ITPUX03 content=metadata_only exclude=index,table parallel=8<br></code></pre></td></tr></table></figure>

<p>5.5 导入同义词、dblink和其他对象</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 导入公共同义词</span><br><span class="hljs-keyword">set</span> long <span class="hljs-number">9999</span><br><span class="hljs-keyword">select</span> dbms_metadata.get_ddl(<span class="hljs-string">&#x27;SYNONYM&#x27;</span>,SYNONYM_NAME,OWNER)<br> <span class="hljs-keyword">FROM</span> dba_synonyms <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">&#x27;PUBLIC&#x27;</span> <span class="hljs-keyword">and</span> table_owner <span class="hljs-keyword">in</span>  (<span class="hljs-string">&#x27;COCO&#x27;</span>,<span class="hljs-string">&#x27;ITPUX01&#x27;</span>,<span class="hljs-string">&#x27;ITPUX02&#x27;</span>,<span class="hljs-string">&#x27;ITPUX03&#x27;</span>);<br><br><span class="hljs-comment">-- 导入dblink</span><br><span class="hljs-keyword">set</span> long <span class="hljs-number">9999</span><br><span class="hljs-keyword">select</span> dbms_metadata.get_ddl(<span class="hljs-string">&#x27;DB_LINK&#x27;</span>,DB_LINK,OWNER) <span class="hljs-keyword">FROM</span> DBA_DB_LINKS;<br></code></pre></td></tr></table></figure>
</li>
<li><p>Post-migration</p>
<p>6.1 检查数据库一致性</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> owner, object_type, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>)<br> <span class="hljs-keyword">from</span> dba_objects<br> <span class="hljs-keyword">where</span> object_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;BIN%&#x27;</span><br> <span class="hljs-keyword">and</span> owner <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;COCO&#x27;</span>,<span class="hljs-string">&#x27;ITPUX01&#x27;</span>,<span class="hljs-string">&#x27;ITPUX02&#x27;</span>,<span class="hljs-string">&#x27;ITPUX03&#x27;</span>)<br> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> owner, object_type<br> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span> <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>

<p>6.2 业务用户修改权限和默认表空间</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;ITPUX01&quot; <span class="hljs-keyword">DEFAULT</span> TABLESPACE &quot;ITPUX01&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;ITPUX02&quot; <span class="hljs-keyword">DEFAULT</span> TABLESPACE &quot;ITPUX02&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;ITPUX03&quot; EFAULT TABLESPACE &quot;ITPUX03&quot;;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> &quot;COCO&quot; <span class="hljs-keyword">DEFAULT</span> TABLESPACE &quot;TBS_COCO&quot; TEMPORARY TABLESPACE &quot;TEMP&quot;;<br><span class="hljs-keyword">GRANT</span> UNLIMITED TABLESPACE <span class="hljs-keyword">TO</span> &quot;ITPUX01&quot;;<br><span class="hljs-keyword">GRANT</span> UNLIMITED TABLESPACE <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br><span class="hljs-keyword">GRANT</span> UNLIMITED TABLESPACE <span class="hljs-keyword">TO</span> &quot;ITPUX02&quot;;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> JOB <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> &quot;COCO&quot;.&quot;TESTTABLE&quot; <span class="hljs-keyword">TO</span> &quot;ITPUX01&quot;;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> &quot;SYS&quot;.&quot;DBA_USERS&quot; <span class="hljs-keyword">TO</span> &quot;COCO&quot;;<br></code></pre></td></tr></table></figure>

<p>6.3 表空间置为读写模式</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;ALTER TABLESPACE &#x27;</span><span class="hljs-operator">||</span>name<span class="hljs-operator">||</span><span class="hljs-string">&#x27; READ WRITE;&#x27;</span> exec_sql <span class="hljs-keyword">from</span> v$tablespace<br> <span class="hljs-keyword">where</span> NAME <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;SYSTEM&#x27;</span>,<span class="hljs-string">&#x27;SYSAUX&#x27;</span>,<span class="hljs-string">&#x27;UNDOTBS1&#x27;</span>,<span class="hljs-string">&#x27;TEMP&#x27;</span>,<span class="hljs-string">&#x27;USERS&#x27;</span>);<br></code></pre></td></tr></table></figure>

<p>6.4 校验数据文件完整性</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">RMAN<span class="hljs-operator">&gt;</span> validate tablespace COCO,ITPUX01,ITPUX02,ITPUX03 <span class="hljs-keyword">check</span> logical;<br></code></pre></td></tr></table></figure>

<p>6.5 收集统计信息</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">exec</span> dbms_stats.gather_database_stats(degree <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>);<br><span class="hljs-keyword">exec</span> dbms_stats.gather_dictionary_stats(degree <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">8</span>);<br><span class="hljs-keyword">exec</span> dbms_stats.gather_fixed_objects_stats();<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>hacmp extendvg</title>
    <url>/blog/posts/23410.html</url>
    <content><![CDATA[<h1 id="hacmp-extendvg"><a href="#hacmp-extendvg" class="headerlink" title="hacmp extendvg"></a>hacmp extendvg</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs ksh">smitty hacmp<br>-&gt; System Management (C-SPOC)<br>-&gt; Storage<br>-&gt; Logical Volumes<br>-&gt; Add a Logical Volume<br>-&gt; &lt;pacsdatavg&gt;<br></code></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Unix</category>
        <category>AIX</category>
      </categories>
      <tags>
        <tag>hacmp</tag>
      </tags>
  </entry>
  <entry>
    <title>Replace harddisk for rootvg</title>
    <url>/blog/posts/58987.html</url>
    <content><![CDATA[<h1 id="Replace-harddisk-for-rootvg"><a href="#Replace-harddisk-for-rootvg" class="headerlink" title="Replace harddisk for rootvg"></a>Replace harddisk for rootvg</h1><ol>
<li><p>查看系统故障日志，确定故障硬盘信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:taadm] /home/taadm&gt; errpt<br>IDENTIFIER TIMESTAMP  T C RESOURCE_NAME  DESCRIPTION<br>EAA3D429   1113051522 U S LVDD           PHYSICAL PARTITION MARKED STALE<br>E86653C3   1113051522 P H LVDD           I/O ERROR DETECTED BY LVM<br>B6267342   1113051522 P H hdisk0         DISK OPERATION ERROR<br><br>[TRDGMES1:taadm] /home/taadm&gt; errpt -aj B6267342<br>......<br>Diagnostic Analysis<br>Diagnostic Log sequence number: 2639<br>Resource tested:        hdisk0<br>Resource Description:   SAS Disk Drive<br>Location:               U78AA.001.WZSKPLU-P2-D1<br>SRN:                    2672-128<br>Description:            Error log analysis indicates a hardware failure.<br>Possible FRUs:<br>hdisk0      FRU: 00E6167      U78AA.001.WZSKPLU-P2-D1      SAS Disk Drive<br><br>[TRDGMES1:root]/#lscfg -vl hdisk0<br>hdisk0           U78AA.001.WZSKPLU-P2-D1  SAS Disk Drive (300000 MB)<br>Manufacturer................IBM     <br>Machine Type and Model......HUC109030CSS600 <br>FRU Number..................00E6167     <br>ROS Level and ID............45354336<br>Serial Number...............KFGK2XER<br>EC Level....................L37106    <br>Part Number.................74Y9268     <br>Device Specific.(Z0)........000006329F011002<br>Device Specific.(Z1)........CEIPE5C6    <br>Device Specific.(Z2)........00SS<br>Device Specific.(Z3)........14156<br>Device Specific.(Z4)........<br>Device Specific.(Z5)........22<br>Device Specific.(Z6)........L37510    <br>Hardware Location Code......U78AA.001.WZSKPLU-P2-D1<br></code></pre></td></tr></table></figure>
</li>
<li><p>查看系统启动逻辑卷</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#bootlist -m normal -o<br>hdisk0 blv=hd5 pathid=0<br>hdisk1 blv=hd5 pathid=0<br></code></pre></td></tr></table></figure>
</li>
<li><p>检查rootvg卷组状态信息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#lsvg rootvg<br>VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf<br>VG STATE:           active                   PP SIZE:        512 megabyte(s)<br>VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)<br>MAX LVs:            256                      FREE PPs:       520 (266240 megabytes)<br>LVs:                15                       USED PPs:       596 (305152 megabytes)<br>OPEN LVs:           14                       QUORUM:         1 (Disabled)<br>TOTAL PVs:          2                        VG DESCRIPTORS: 3<br>STALE PVs:          1                        STALE PPs:      1<br>ACTIVE PVs:         2                        AUTO ON:        yes<br>MAX PPs per VG:     32512                                     <br>MAX PPs per PV:     1016                     MAX PVs:        32<br>LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no<br>HOT SPARE:          no                       BB POLICY:      relocatable <br>PV RESTRICTION:     none                     INFINITE RETRY: no<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lsvg -p rootvg<br>rootvg:<br>PV_NAME           PV STATE          TOTAL PPs   FREE PPs    FREE DISTRIBUTION<br>hdisk0            active            558         250         111..00..00..27..112<br>hdisk1            active            558         270         111..00..00..47..112<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lsvg -l rootvg<br>rootvg:<br>LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT<br>hd5                 boot       1       2       2    closed/syncd  N/A<br>hd6                 paging     32      64      2    open/syncd    N/A<br>hd8                 jfs2log    1       2       2    open/syncd    N/A<br>hd4                 jfs2       20      40      2    open/syncd    /<br>hd2                 jfs2       30      60      2    open/syncd    /usr<br>hd9var              jfs2       20      40      2    open/syncd    /var<br>hd3                 jfs2       20      40      2    open/syncd    /tmp<br>hd1                 jfs2       120     240     2    open/stale    /home<br>hd10opt             jfs2       20      40      2    open/syncd    /opt<br>hd11admin           jfs2       1       2       2    open/syncd    /admin<br>lg_dumplv           sysdump    20      20      1    open/syncd    N/A<br>livedump            jfs2       1       2       2    open/syncd    /var/adm/ras/livedump<br>loglv00             jfslog     1       2       2    open/syncd    N/A<br>lv00                jfs        1       2       2    open/syncd    /var/adm/csd<br>fslv00              jfs2       20      40      2    open/syncd    /isc<br></code></pre></td></tr></table></figure>
<p>可以看到rootvg卷组中存在1个过期的STALE PPs。卷组的LPs:PPs为1:2处于镜像中。</p>
</li>
<li><p>查看卷组的物理卷状态</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#lspv hdisk0<br>PHYSICAL VOLUME:    hdisk0                   VOLUME GROUP:     rootvg<br>PV IDENTIFIER:      00f9838959802512 VG IDENTIFIER     00f9838900004c0000000149a2d111cf<br>PV STATE:           active                                     <br>STALE PARTITIONS:   1                        ALLOCATABLE:      yes<br>PP SIZE:            512 megabyte(s)          LOGICAL VOLUMES:  15<br>TOTAL PPs:          558 (285696 megabytes)   VG DESCRIPTORS:   2<br>FREE PPs:           250 (128000 megabytes)   HOT SPARE:        no<br>USED PPs:           308 (157696 megabytes)   MAX REQUEST:      1 megabyte<br>FREE DISTRIBUTION:  111..00..00..27..112                       <br>USED DISTRIBUTION:  01..112..111..84..00                       <br>MIRROR POOL:        None                                       <br>[TRDGMES1:root]/#  <br>[TRDGMES1:root]/#lspv hdisk1<br>PHYSICAL VOLUME:    hdisk1                   VOLUME GROUP:     rootvg<br>PV IDENTIFIER:      00f98389cb6fdbfe VG IDENTIFIER     00f9838900004c0000000149a2d111cf<br>PV STATE:           active                                     <br>STALE PARTITIONS:   0                        ALLOCATABLE:      yes<br>PP SIZE:            512 megabyte(s)          LOGICAL VOLUMES:  14<br>TOTAL PPs:          558 (285696 megabytes)   VG DESCRIPTORS:   1<br>FREE PPs:           270 (138240 megabytes)   HOT SPARE:        no<br>USED PPs:           288 (147456 megabytes)   MAX REQUEST:      1 megabyte<br>FREE DISTRIBUTION:  111..00..00..47..112                       <br>USED DISTRIBUTION:  01..112..111..64..00                       <br>MIRROR POOL:        None                                       <br></code></pre></td></tr></table></figure>
<p>过期的STALE PPs位于物理卷hdisk0，即故障盘hdisk0，因此无需处理。否则需要执行物理卷同步命令<code>syncvg –p hdisk0 hdisk1</code></p>
</li>
<li><p>迁移sysdump设备</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#lspv -l hdisk0<br>hdisk0:<br>LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT<br>hd10opt               20      20      00..00..20..00..00    /opt<br>hd2                   30      30      00..10..20..00..00    /usr<br>hd9var                20      20      00..00..20..00..00    /var<br>hd3                   20      20      00..00..20..00..00    /tmp<br>hd1                   120     120     00..27..09..84..00    /home<br>hd5                   1       1       01..00..00..00..00    N/A<br>hd6                   32      32      00..32..00..00..00    N/A<br>hd8                   1       1       00..00..01..00..00    N/A<br>hd4                   20      20      00..00..20..00..00    /<br>hd11admin             1       1       00..00..01..00..00    /admin<br>lg_dumplv             20      20      00..20..00..00..00    N/A<br>livedump              1       1       00..01..00..00..00    /var/adm/ras/livedump<br>loglv00               1       1       00..01..00..00..00    N/A<br>lv00                  1       1       00..01..00..00..00    /var/adm/csd<br>fslv00                20      20      00..20..00..00..00    /isc<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#migratepv -l lg_dumplv hdisk0 hdisk1<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lspv -l hdisk1<br>hdisk1:<br>LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT<br>hd10opt               20      20      00..20..00..00..00    /opt<br>hd2                   30      30      00..01..29..00..00    /usr<br>hd9var                20      20      00..00..20..00..00    /var<br>hd3                   20      20      00..00..20..00..00    /tmp<br>hd1                   120     120     00..36..20..64..00    /home<br>hd5                   1       1       01..00..00..00..00    N/A<br>hd6                   32      32      00..32..00..00..00    N/A<br>hd8                   1       1       00..00..01..00..00    N/A<br>hd4                   20      20      00..00..20..00..00    /<br>hd11admin             1       1       00..00..01..00..00    /admin<br>lg_dumplv             20      20      20..00..00..00..00    N/A<br>livedump              1       1       00..01..00..00..00    /var/adm/ras/livedump<br>loglv00               1       1       00..01..00..00..00    N/A<br>lv00                  1       1       00..01..00..00..00    /var/adm/csd<br>fslv00                20      20      00..20..00..00..00    /isc<br></code></pre></td></tr></table></figure>
</li>
<li><p>取消卷组rootvg镜像，移除物理卷hdisk0</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#unmirrorvg rootvg hdisk0<br>0516-1246 rmlvcopy: If hd5 is the boot logical volume, please run &#x27;chpv -c &lt;diskname&gt;&#x27;<br>     as root user to clear the boot record and avoid a potential boot<br>     off an old boot image that may reside on the disk from which this<br>     logical volume is moved/removed.<br>0516-1804 chvg: The quorum change takes effect immediately.<br>0516-1144 unmirrorvg: rootvg successfully unmirrored, user should perform<br>     bosboot of system to reinitialize boot records.  Then, user must modify<br>     bootlist to just include:  hdisk1.<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lsvg rootvg<br>VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf<br>VG STATE:           active                   PP SIZE:        512 megabyte(s)<br>VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)<br>MAX LVs:            256                      FREE PPs:       808 (413696 megabytes)<br>LVs:                15                       USED PPs:       308 (157696 megabytes)<br>OPEN LVs:           14                       QUORUM:         2 (Enabled)<br>TOTAL PVs:          2                        VG DESCRIPTORS: 3<br>STALE PVs:          0                        STALE PPs:      0<br>ACTIVE PVs:         2                        AUTO ON:        yes<br>MAX PPs per VG:     32512                                     <br>MAX PPs per PV:     1016                     MAX PVs:        32<br>LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no<br>HOT SPARE:          no                       BB POLICY:      relocatable <br>PV RESTRICTION:     none                     INFINITE RETRY: no<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lsvg -l rootvg<br>rootvg:<br>LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT<br>hd5                 boot       1       1       1    closed/syncd  N/A<br>hd6                 paging     32      32      1    open/syncd    N/A<br>hd8                 jfs2log    1       1       1    open/syncd    N/A<br>hd4                 jfs2       20      20      1    open/syncd    /<br>hd2                 jfs2       30      30      1    open/syncd    /usr<br>hd9var              jfs2       20      20      1    open/syncd    /var<br>hd3                 jfs2       20      20      1    open/syncd    /tmp<br>hd1                 jfs2       120     120     1    open/syncd    /home<br>hd10opt             jfs2       20      20      1    open/syncd    /opt<br>hd11admin           jfs2       1       1       1    open/syncd    /admin<br>lg_dumplv           sysdump    20      20      1    open/syncd    N/A<br>livedump            jfs2       1       1       1    open/syncd    /var/adm/ras/livedump<br>loglv00             jfslog     1       1       1    open/syncd    N/A<br>lv00                jfs        1       1       1    open/syncd    /var/adm/csd<br>fslv00              jfs2       20      20      1    open/syncd    /isc<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#reducevg rootvg hdisk0<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#chpv -c hdisk0<br></code></pre></td></tr></table></figure>
</li>
<li><p>使用<code>diag</code>命令进行硬盘热拔插更换，或使用<code>rmdev -dl hdisk0</code>删除硬盘。<br>参考链接：<a href="https://www.ibm.com/docs/en/power6?topic=rdd-replacing-disk-drive-aix-system-logical-partition-powered">Replacing a disk drive with the AIX system or logical partition powered on</a></p>
<p>更换时可能遇到进程占用导致磁盘忙问题，可根据实际情况杀掉占用进程。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#fuser /dev/hdisk0<br>/dev/hdisk0:  22282522<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#proctree 22282522<br>22282522    /usr/bin/topas_nmon  -f -d -T -^ -J -s 300 -c 288 -youtput_dir=/KIC/LOG/NMON/TR<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#kill -9 22282522<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#fuser /dev/hdisk0<br>/dev/hdisk0: <br></code></pre></td></tr></table></figure>
</li>
<li><p>重新配置卷组rootvg镜像</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#cfgmgr -v<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lspv<br>hdisk0          none                                None                        <br>hdisk1          00f98389cb6fdbfe                    rootvg          active      <br>hdisk2          00f98389ad9cf4af                    None                        <br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#chdev -l hdisk0 -a pv=yes<br>hdisk0 changed <br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#extendvg rootvg hdisk0<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lspv<br>hdisk0          00f983897ac05ab6                    rootvg          active      <br>hdisk1          00f98389cb6fdbfe                    rootvg          active      <br>hdisk2          00f98389ad9cf4af                    None              <br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#mirrorvg -S rootvg hdisk0<br>0516-1804 chvg: The quorum change takes effect immediately.<br>0516-1126 mirrorvg: rootvg successfully mirrored, user should perform<br>        bosboot of system to initialize boot records.  Then, user must modify<br>        bootlist to include:  hdisk0 hdisk1.<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lsvg rootvg<br>VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf<br>VG STATE:           active                   PP SIZE:        512 megabyte(s)<br>VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)<br>MAX LVs:            256                      FREE PPs:       520 (266240 megabytes)<br>LVs:                15                       USED PPs:       596 (305152 megabytes)<br>OPEN LVs:           15                       QUORUM:         1 (Disabled)<br>TOTAL PVs:          2                        VG DESCRIPTORS: 3<br>STALE PVs:          1                        STALE PPs:      288<br>ACTIVE PVs:         2                        AUTO ON:        yes<br>MAX PPs per VG:     32512                                     <br>MAX PPs per PV:     1016                     MAX PVs:        32<br>LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no<br>HOT SPARE:          no                       BB POLICY:      relocatable <br>PV RESTRICTION:     none                     INFINITE RETRY: no<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lsvg -l rootvg<br>rootvg:<br>LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT<br>hd5                 boot       1       2       2    closed/syncd  N/A<br>hd6                 paging     32      64      2    open/stale    N/A<br>hd8                 jfs2log    1       2       2    open/stale    N/A<br>hd4                 jfs2       20      40      2    open/stale    /<br>hd2                 jfs2       30      60      2    open/stale    /usr<br>hd9var              jfs2       20      40      2    open/stale    /var<br>hd3                 jfs2       20      40      2    open/stale    /tmp<br>hd1                 jfs2       120     240     2    open/stale    /home<br>hd10opt             jfs2       20      40      2    open/stale    /opt<br>hd11admin           jfs2       1       2       2    open/stale    /admin<br>lg_dumplv           sysdump    20      20      1    open/syncd    N/A<br>livedump            jfs2       1       2       2    open/stale    /var/adm/ras/livedump<br>loglv00             jfslog     1       2       2    open/stale    N/A<br>lv00                jfs        1       2       2    open/stale    /var/adm/csd<br>fslv00              jfs2       20      40      2    open/stale    /isc<br></code></pre></td></tr></table></figure>
</li>
<li><p>等待镜像同步完成，LV STATE由stale变为syncd。</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#lsvg -l rootvg<br>rootvg:<br>LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT<br>hd5                 boot       1       2       2    closed/syncd  N/A<br>hd6                 paging     32      64      2    open/syncd    N/A<br>hd8                 jfs2log    1       2       2    open/syncd    N/A<br>hd4                 jfs2       20      40      2    open/syncd    /<br>hd2                 jfs2       30      60      2    open/syncd    /usr<br>hd9var              jfs2       20      40      2    open/syncd    /var<br>hd3                 jfs2       20      40      2    open/syncd    /tmp<br>hd1                 jfs2       120     240     2    open/syncd    /home<br>hd10opt             jfs2       20      40      2    open/syncd    /opt<br>hd11admin           jfs2       1       2       2    open/syncd    /admin<br>lg_dumplv           sysdump    20      20      1    open/syncd    N/A<br>livedump            jfs2       1       2       2    open/syncd    /var/adm/ras/livedump<br>loglv00             jfslog     1       2       2    open/syncd    N/A<br>lv00                jfs        1       2       2    open/syncd    /var/adm/csd<br>fslv00              jfs2       20      40      2    open/syncd    /isc<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#lsvg rootvg<br>VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf<br>VG STATE:           active                   PP SIZE:        512 megabyte(s)<br>VG PERMISSION:      read/write               TOTAL PPs:      1116 (571392 megabytes)<br>MAX LVs:            256                      FREE PPs:       520 (266240 megabytes)<br>LVs:                15                       USED PPs:       596 (305152 megabytes)<br>OPEN LVs:           14                       QUORUM:         1 (Disabled)<br>TOTAL PVs:          2                        VG DESCRIPTORS: 3<br>STALE PVs:          0                        STALE PPs:      0<br>ACTIVE PVs:         2                        AUTO ON:        yes<br>MAX PPs per VG:     32512                                     <br>MAX PPs per PV:     1016                     MAX PVs:        32<br>LTG size (Dynamic): 1024 kilobyte(s)         AUTO SYNC:      no<br>HOT SPARE:          no                       BB POLICY:      relocatable <br>PV RESTRICTION:     none                     INFINITE RETRY: no<br></code></pre></td></tr></table></figure>
</li>
<li><p>配置系统启动逻辑卷</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[TRDGMES1:root]/#bootlist -m normal -o<br>hdisk0 pathid=0<br>hdisk1 blv=hd5 pathid=0<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#bosboot -ad hdisk0<br>bosboot: Boot image is 55324 512 byte blocks.<br>[TRDGMES1:root]/#<br>[TRDGMES1:root]/#bootlist -m normal -o<br>hdisk0 blv=hd5 pathid=0<br>hdisk1 blv=hd5 pathid=0<br></code></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Unix</category>
        <category>AIX</category>
      </categories>
      <tags>
        <tag>rootvg</tag>
      </tags>
  </entry>
</search>
