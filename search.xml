<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Configuration</title>
    <url>/blog/posts/169cee22.html</url>
    <content><![CDATA[<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><h2 id="Restart-Policy"><a href="#Restart-Policy" class="headerlink" title="Restart Policy"></a>Restart Policy</h2><p>To configure the restart policy for a container, use the <code>--restart</code> flag when using the <code>docker run</code> command. The value of the <code>--restart</code> flag can be any of the following:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>no</code></td>
<td>Do not automatically restart the container. (the default)</td>
</tr>
<tr>
<td><code>on-failure[:max-retries]</code></td>
<td>Restart the container if it exits due to an error, which manifests as a non-zero exit code. Optionally, limit the number of times the Docker daemon attempts to restart the container using the <code>:max-retries</code> option.</td>
</tr>
<tr>
<td><code>always</code></td>
<td>Always restart the container if it stops. If it is manually stopped, it is restarted only when Docker daemon restarts or the container itself is manually restarted. (See the second bullet listed in <a href="https://docs.docker.com/config/containers/start-containers-automatically/#restart-policy-details">restart policy details</a>)</td>
</tr>
<tr>
<td><code>unless-stopped</code></td>
<td>Similar to <code>always</code>, except that when the container is stopped (manually or otherwise), it is not restarted even after Docker daemon restarts.</td>
</tr>
</tbody></table>
<p>The following example starts a Redis container and configures it to always restart unless it is explicitly stopped or Docker is restarted.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span> unless-stopped redis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>This command changes the restart policy for an already running container named <code>redis</code>.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> update <span class="token parameter variable">--restart</span> unless-stopped redis<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>And this command will ensure all currently running containers will be restarted unless stopped.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> update <span class="token parameter variable">--restart</span> unless-stopped <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>config</tag>
      </tags>
  </entry>
  <entry>
    <title>Docker Commands</title>
    <url>/blog/posts/f0401bdf.html</url>
    <content><![CDATA[<h1 id="Docker-Commands"><a href="#Docker-Commands" class="headerlink" title="Docker Commands"></a>Docker Commands</h1><h2 id="docker-logs"><a href="#docker-logs" class="headerlink" title="docker logs"></a>docker logs</h2><p> 查看日志 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> logs <span class="token operator">&lt;</span>container<span class="token operator">></span>
<span class="token function">docker</span> logs <span class="token parameter variable">-f</span> <span class="token operator">&lt;</span>container<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 查看某段时间的日志 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">--since</span><span class="token operator">=</span><span class="token string">"2022-08-12"</span> <span class="token parameter variable">--tail</span><span class="token operator">=</span><span class="token number">100</span> <span class="token operator">&lt;</span>container<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>cmd</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQL Image Overview</title>
    <url>/blog/posts/3af1ecff.html</url>
    <content><![CDATA[<h1 id="MySQL-Image-Overview"><a href="#MySQL-Image-Overview" class="headerlink" title="MySQL Image Overview"></a>MySQL Image Overview</h1><h2 id="Start-a-mysql-server-instance"><a href="#Start-a-mysql-server-instance" class="headerlink" title="Start a mysql server instance"></a>Start a <code>mysql</code> server instance</h2><p>Starting a MySQL instance is simple:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> some-mysql <span class="token parameter variable">-p</span> <span class="token number">33060</span>:3306 <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw <span class="token parameter variable">-d</span> mysql:tag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>where <code>some-mysql</code> is the name you want to assign to your container, <code>my-secret-pw</code> is the password to be set for the MySQL root user and <code>tag</code> is the tag specifying the MySQL version you want. See the list above for relevant tags.</p>
<h2 id="Using-a-custom-MySQL-configuration-file"><a href="#Using-a-custom-MySQL-configuration-file" class="headerlink" title="Using a custom MySQL configuration file"></a>Using a custom MySQL configuration file</h2><p>The default configuration for MySQL can be found in <code>/etc/mysql/my.cnf</code>, which may <code>!includedir</code> additional directories such as <code>/etc/mysql/conf.d</code> or <code>/etc/mysql/mysql.conf.d</code>. Please inspect the relevant files and directories within the <code>mysql</code> image itself for more details.</p>
<p>If <code>/my/custom/config-file.cnf</code> is the path and name of your custom configuration file, you can start your <code>mysql</code> container like this (note that only the directory path of the custom config file is used in this command):</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">docker</span> run <span class="token parameter variable">--name</span> some-mysql <span class="token parameter variable">-v</span> /my/custom:/etc/mysql/conf.d <span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>my-secret-pw <span class="token parameter variable">-d</span> mysql:tag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>This will start a new container <code>some-mysql</code> where the MySQL instance uses the combined startup settings from <code>/etc/mysql/my.cnf</code> and <code>/etc/mysql/conf.d/config-file.cnf</code>, with settings from the latter taking precedence.</p>
<h2 id="Creating-database-dumps"><a href="#Creating-database-dumps" class="headerlink" title="Creating database dumps"></a>Creating database dumps</h2><p>Most of the normal tools will work, although their usage might be a little convoluted in some cases to ensure they have access to the <code>mysqld</code> server. A simple way to ensure this is to use <code>docker exec</code> and run the tool from the same container, similar to the following:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> some-mysql <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'exec mysqldump --all-databases -uroot -p"$MYSQL_ROOT_PASSWORD"'</span> <span class="token operator">></span> /some/path/on/your/host/all-databases.sql<span aria-hidden="true"class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Restoring-data-from-dump-files"><a href="#Restoring-data-from-dump-files" class="headerlink" title="Restoring data from dump files"></a>Restoring data from dump files</h2><p>For restoring data. You can use <code>docker exec</code> command with <code>-i</code> flag, similar to the following:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> some-mysql <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'exec mysql -uroot -p"$MYSQL_ROOT_PASSWORD"'</span> <span class="token operator">&lt;</span> /some/path/on/your/host/all-databases.sql<span aria-hidden="true"class="line-numbers-rows"><span></span></span></code></pre>

<p>For more information, please visit <a href="https://hub.docker.com/_/mysql">Quick reference</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
        <tag>ref</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle Image Overview</title>
    <url>/blog/posts/c27f44b8.html</url>
    <content><![CDATA[<h1 id="Oracle-Image-Overview"><a href="#Oracle-Image-Overview" class="headerlink" title="Oracle Image Overview"></a>Oracle Image Overview</h1><h2 id="Default-Setting"><a href="#Default-Setting" class="headerlink" title="Default Setting"></a>Default Setting</h2><p>Database located in <code>/u01/app/oracle</code> folder</p>
<p><strong>OS users:</strong><br>root&#x2F;welcome<br>oracle&#x2F;oracle</p>
<p><strong>DB users:</strong><br>sys&#x2F;oacle<br>system&#x2F;oracle</p>
<p><strong>ENV:</strong><br>ORACLE_SID&#x3D;orcl<br>CHARACTERSET&#x3D;ZHS16GBK</p>
<h4 id="Start-a-oracle-server-instance"><a href="#Start-a-oracle-server-instance" class="headerlink" title="Start a oracle server instance"></a>Start a <code>oracle</code> server instance</h4><p>Starting a Oracle 11g instance is simple:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">--name</span> oracle-11g <span class="token parameter variable">-p</span> <span class="token number">15210</span>:1521 <span class="token parameter variable">-v</span> /unzipped-database-folder:/install oracle:tag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Using-database-datapump"><a href="#Using-database-datapump" class="headerlink" title="Using database datapump"></a>Using database datapump</h4><p>Optionally you can map dpdump folder to easy upload dumps:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">--name</span> oracle-11g <span class="token parameter variable">-p</span> <span class="token number">15210</span>:1521 <span class="token parameter variable">-v</span> /unzipped-database-folder:/install <span class="token parameter variable">-v</span> /datapump-folder:/datapump oracle:tag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>To execute expdp&#x2F;impdp just use docker exec command:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> oracle-11g expdp <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>For more information, please visit <a href="https://github.com/sakurayumeno/docker-images/tree/main/oracle/11.2.0.4">Quick reference</a></p>
]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>image</tag>
        <tag>ref</tag>
      </tags>
  </entry>
  <entry>
    <title>OSI</title>
    <url>/blog/posts/1a11e44c.html</url>
    <content><![CDATA[<h1 id="OSI- 参考模型"><a href="#OSI- 参考模型" class="headerlink" title="OSI 参考模型"></a>OSI 参考模型</h1><p><img src="https://pic2.zhimg.com/v2-1dd6e1ed2f348db47ce0cde38d545ae9_r.jpg"></p>
<blockquote>
<p><strong>传输层 </strong>: 源端口号 2 字节，目的端口号 2 字节，SYN 和 ACK 各 1 比特<br><strong> 网络层 </strong>: 源 IP 地址 4 字节，目的 IP 地址 4 字节，PROTOCOL 字段 1 字节<br><strong>PROTOCOL 字段</strong>: 1(ICMP), 6(TCP), 17(UDP), 88(EIGRP), 89(OSPF)<br><strong> 数据链路层</strong>: 源 MAC 地址 6 字节，目的 MAC 地址 6 字节，TYPE 字段 2 字节<br><strong>TYPE 字段</strong>: 0x0800(IPv4), 0x0806(ARP), 0x08dd(IPv6)</p>
</blockquote>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>osi</tag>
      </tags>
  </entry>
  <entry>
    <title>Preconfig</title>
    <url>/blog/posts/c6e82ea8.html</url>
    <content><![CDATA[<h1 id="Preconfig"><a href="#Preconfig" class="headerlink" title="Preconfig"></a>Preconfig</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">enable</span>
configure terminal
line console <span class="token number">0</span>
no exec-timeout
logging synchronous
no <span class="token function">ip</span> domain lookup
<span class="token function">hostname</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>save config</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SW1<span class="token comment"># copy running-config startup-config</span>
SW1<span class="token comment"># write</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>erase config</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SW1<span class="token comment"># erase startup-config</span>
SW1<span class="token comment"># erase nvram:</span>
SW1<span class="token comment"># write erase</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>filter strings</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SW1<span class="token comment"># show running-config | include 0/0</span>
SW1<span class="token comment"># show running-config | section 0/0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>telnet mode</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SW1<span class="token comment"># conf t</span>
SW1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment"># line vty 0 4</span>
SW1<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment"># transport input telnet</span>
SW1<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment"># password welcome</span>
SW1<span class="token punctuation">(</span>config-line<span class="token punctuation">)</span><span class="token comment"># login</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Network</category>
      </categories>
      <tags>
        <tag>config</tag>
      </tags>
  </entry>
  <entry>
    <title>RedHat Developer Subscription</title>
    <url>/blog/posts/13a70f47.html</url>
    <content><![CDATA[<h1 id="RedHat-Developer-Subscription"><a href="#RedHat-Developer-Subscription" class="headerlink" title="RedHat Developer Subscription"></a>RedHat Developer Subscription</h1><p> 进入开发者社区，注册并填写相关信息。</p>
<p><a href="https://developers.redhat.com/">https://developers.redhat.com/</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>Default Management Information</title>
    <url>/blog/posts/864c4f.html</url>
    <content><![CDATA[<h1 id="Default-Management-Information"><a href="#Default-Management-Information" class="headerlink" title="Default Management Information"></a>Default Management Information</h1><h2 id="DELLEMC"><a href="#DELLEMC" class="headerlink" title="DELLEMC"></a>DELLEMC</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>VNX</td>
<td>Management<br>Maintenance</td>
<td>1.1.1.1-2&#x2F;24<br>128.221.1.250-251&#x2F;29</td>
<td>admin&#x2F;password</td>
</tr>
<tr>
<td>PowerEdge</td>
<td>Management</td>
<td>192.168.0.120&#x2F;24</td>
<td>root&#x2F;calvin</td>
</tr>
</tbody></table>
<h2 id="Hitachi"><a href="#Hitachi" class="headerlink" title="Hitachi"></a>Hitachi</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>HUS</td>
<td>Management<br>Maintenance</td>
<td>192.168.0.16-17&#x2F;24<br>10.0.0.16-17&#x2F;24</td>
<td>system&#x2F;manager</td>
</tr>
<tr>
<td>SVP</td>
<td>Management</td>
<td>10.0.0.100&#x2F;24</td>
<td>SVP-PC\SVP&#x2F;raid-login</td>
</tr>
<tr>
<td>VSP</td>
<td>Management</td>
<td>192.168.0.16-17&#x2F;24</td>
<td>maintenance&#x2F;raid-maintenance</td>
</tr>
</tbody></table>
<h2 id="HPE"><a href="#HPE" class="headerlink" title="HPE"></a>HPE</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>ProLiant</td>
<td>Management</td>
<td>192.168.1.2&#x2F;24</td>
<td>See server tag</td>
</tr>
<tr>
<td>MSA System</td>
<td>Management</td>
<td>10.0.0.2-3&#x2F;24</td>
<td>manage&#x2F;!manage</td>
</tr>
</tbody></table>
<h2 id="Lenovo"><a href="#Lenovo" class="headerlink" title="Lenovo"></a>Lenovo</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>System x</td>
<td>Management</td>
<td>192.168.70.125&#x2F;24</td>
<td>USERID&#x2F;PASSW0RD</td>
</tr>
</tbody></table>
<h2 id="IBM"><a href="#IBM" class="headerlink" title="IBM"></a>IBM</h2><table>
<thead>
<tr>
<th>Product</th>
<th>Type</th>
<th>IP</th>
<th>Username&#x2F;Password</th>
</tr>
</thead>
<tbody><tr>
<td>System x</td>
<td>Management</td>
<td>192.168.70.125&#x2F;24</td>
<td>USERID&#x2F;PASSW0RD</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Hardware</category>
      </categories>
  </entry>
  <entry>
    <title>Oracle ILOM</title>
    <url>/blog/posts/fc09a157.html</url>
    <content><![CDATA[<h1 id="Oracle-ILOM"><a href="#Oracle-ILOM" class="headerlink" title="Oracle ILOM"></a>Oracle ILOM</h1><h2 id="Assigning-a-Static-IP-Address-to-the-SP"><a href="#Assigning-a-Static-IP-Address-to-the-SP" class="headerlink" title="Assigning a Static IP Address to the SP"></a>Assigning a Static IP Address to the SP</h2><h3 id="Log-In-to-the-SP-SER-MGT-Port"><a href="#Log-In-to-the-SP-SER-MGT-Port" class="headerlink" title="Log In to the SP (SER MGT Port)"></a>Log In to the SP (SER MGT Port)</h3><div class="note info modern"><p>a. Configure a terminal or terminal emulator with these settings: <font color=info>9600 baud, 8 bits, No parity, 1 Stop bit, No handshake</font>.<br>b. Default user <code>root</code> and password <code>changeme</code>.</p>
</div>

<p>Use the <code>password</code> command to change the root password</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-<span class="token operator">></span> <span class="token builtin class-name">set</span> /SP/users/root password<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Assign-a-Static-IP-Address-to-the-NET-MGT-Port"><a href="#Assign-a-Static-IP-Address-to-the-NET-MGT-Port" class="headerlink" title="Assign a Static IP Address to the NET MGT Port"></a>Assign a Static IP Address to the NET MGT Port</h3><p>If you plan to connect to the SP through its NET MGT port, the SP must have a valid IP address.<br>By default, the server is configured to obtain an IP address from DHCP services in your network. If the network your server is connected to does not support DHCP for IP addressing, perform this procedure.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-<span class="token operator">></span> <span class="token builtin class-name">set</span> /SP/network <span class="token assign-left variable">pendingipdiscovery</span><span class="token operator">=</span>static
-<span class="token operator">></span> <span class="token builtin class-name">set</span> /SP/network <span class="token assign-left variable">pendingipaddress</span><span class="token operator">=</span><span class="token number">192.168</span>.10.100
-<span class="token operator">></span> <span class="token builtin class-name">set</span> /SP/network <span class="token assign-left variable">pendingipgateway</span><span class="token operator">=</span><span class="token number">192.168</span>.10.1
-<span class="token operator">></span> <span class="token builtin class-name">set</span> /SP/network <span class="token assign-left variable">pendingipnetmask</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
-<span class="token operator">></span> show /SP/network <span class="token parameter variable">-display</span> properties
-<span class="token operator">></span> <span class="token builtin class-name">set</span> /SP/network <span class="token assign-left variable">commitpending</span><span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Check-for-Faults"><a href="#Check-for-Faults" class="headerlink" title="Check for Faults"></a>Check for Faults</h2><h3 id="show-faulty-Command"><a href="#show-faulty-Command" class="headerlink" title="show faulty Command"></a><code>show faulty</code> Command</h3><p>At the Oracle ILOM prompt, type the show faulty command.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-<span class="token operator">></span> show faulty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="fmadm-faulty-Command"><a href="#fmadm-faulty-Command" class="headerlink" title="fmadm faulty Command"></a><code>fmadm faulty</code> Command</h3><ol>
<li><p>At the Oracle ILOM prompt, access the faultmgmt shell.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-<span class="token operator">></span> start /SP/faultmgmt/shell
Are you sure you want to start /SP/faultmgmt/shell <span class="token punctuation">(</span>y/n<span class="token punctuation">)</span>? y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>At the faultmgmtsp&gt; prompt, enter the fmadm faulty command.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">faultmgmtsp<span class="token operator">></span> fmadm faulty
faultmgmtsp<span class="token operator">></span> <span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Hardware</category>
      </categories>
      <tags>
        <tag>ilom</tag>
      </tags>
  </entry>
  <entry>
    <title>Butterfly 主题美化配置</title>
    <url>/blog/posts/584538d8.html</url>
    <content><![CDATA[<h1 id="Butterfly 主题美化配置"><a href="#Butterfly 主题美化配置" class="headerlink" title="Butterfly 主题美化配置"></a>Butterfly 主题美化配置 </h1><h2 id="自定义文件结构"><a href="# 自定义文件结构" class="headerlink" title="自定义文件结构"></a> 自定义文件结构</h2><pre class="line-numbers language-none"><code class="language-none">+--- css
|   +--- custom.styl
|   +--- _custom
|   |   +--- background.css
|   |   +--- font.css
+--- font
|   +--- CascadiaMono.woff2
|   +--- ZhuZiAWan.woff2
+--- img
|   +--- avatar.jpg
+--- js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在 <code>/blog_root/source</code> 中创建 <code>css/font/js</code> 目录，在 css 目录中创建 _custom 用于存放自定义 css 文件。<br>创建 custom.styl 文件，添加如下内容:</p>
<pre class="line-numbers language-styl" data-language="styl"><code class="language-styl">@import &#39;_custom&#x2F;*.css&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改主题配置文件，添加 inject 参数</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Inject</span>
<span class="token comment"># Insert the code to head (before '&lt;/head>' tag) and the bottom (before '&lt;/body>' tag)</span>
<span class="token comment"># 插入代码到头部 &lt;/head> 之前 和 底部 &lt;/body> 之前</span>
<span class="token key atrule">inject</span><span class="token punctuation">:</span>
  <span class="token key atrule">head</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> &lt;link rel="stylesheet" href="/blog/css/custom.css" media="defer" onload="this.media='all'"<span class="token punctuation">></span>
  <span class="token key atrule">bottom</span><span class="token punctuation">:</span>
    <span class="token comment"># - &lt;script src="xxxx">&lt;/script></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="设置主题背景"><a href="# 设置主题背景" class="headerlink" title="设置主题背景"></a>设置主题背景 </h2><h3 id="一图流"><a href="# 一图流" class="headerlink" title="一图流"></a> 一图流 </h3><p> 修改主题配置文件<code>_config.butterfly.yml</code></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">default_top_img</span><span class="token punctuation">:</span> transparent
<span class="token key atrule">background</span><span class="token punctuation">:</span> url(/blog/img/background.jpg)
<span class="token key atrule">footer_bg</span><span class="token punctuation">:</span> transparent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>创建自定义 <code>css</code> 文件</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 首页文章卡片 */</span>
<span class="token selector">#recent-posts > .recent-post-item</span><span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 首页侧栏卡片 */</span>
<span class="token selector">.card-widget</span><span class="token punctuation">&#123;</span>
<span class="token property">background</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 文章页面正文背景 */</span>
<span class="token selector">div#post</span><span class="token punctuation">&#123;</span>
<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 分页页面 */</span>
<span class="token selector">div#page</span><span class="token punctuation">&#123;</span>
<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 归档页面 */</span>
<span class="token selector">div#archive</span><span class="token punctuation">&#123;</span>
<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 标签页面 */</span>
<span class="token selector">div#tag</span><span class="token punctuation">&#123;</span>
<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 分类页面 */</span>
<span class="token selector">div#category</span><span class="token punctuation">&#123;</span>
<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* 页脚透明 */</span>
<span class="token selector">#footer</span><span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 头图透明 */</span>
<span class="token selector">#page-header</span><span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 白天模式伪类遮罩层透明 */</span>
<span class="token selector">[data-theme="light"]
  #footer::before</span><span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="light"]
  #page-header::before</span><span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token comment">/* 夜间模式伪类遮罩层透明 */</span>
<span class="token selector">[data-theme="dark"]
  #footer::before</span><span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]
  #page-header::before</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token important">!important</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

<span class="token comment">/* 夜间模式页面背景设置为半透明 */</span>
<span class="token selector">[data-theme="dark"]
  div.recent-post-item</span><span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]
  #aside-content .card-widget</span><span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]
  div#post</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]
  div#page</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]
  div#archive</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]
  div#tag</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]
  div#category</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  
<span class="token comment">/* 阅读模式 */</span>
<span class="token selector">.read-mode #aside-content .card-widget</span><span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>158<span class="token punctuation">,</span> 204<span class="token punctuation">,</span> 171<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token selector">.read-mode div#post</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>158<span class="token punctuation">,</span> 204<span class="token punctuation">,</span> 171<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token comment">/* 夜间阅读模式 */</span>
<span class="token selector">[data-theme="dark"]
  .read-mode #aside-content .card-widget</span><span class="token punctuation">&#123;</span>
        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #eeeeee<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
<span class="token selector">[data-theme="dark"]  
  .read-mode div#post</span><span class="token punctuation">&#123;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #eeeeee<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="渐变色"><a href="# 渐变色" class="headerlink" title="渐变色"></a>渐变色</h3><ol>
<li>修改主题配置文件<code>_config.butterfly.yml</code></li>
</ol>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">background</span><span class="token punctuation">:</span> <span class="token string">"#efefef"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>创建自定义 <code>css</code> 文件</li>
</ol>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 文章页背景 */</span>
<span class="token selector">.layout > div:first-child:not(.recent-posts)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* 以下代表白色透明度为 0.3 */</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 所有背景（包括首页卡片、文章页、页面页等） */</span>
<span class="token selector">#recent-posts > .recent-post-item,
.layout > div:first-child:not(.recent-posts),
.layout_post > #page,
.layout_post > #post,
.read-mode .layout_post > #post</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* 以下代表白色透明度为 0.3 */</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 侧栏卡片 */</span>
<span class="token selector">.card-widget</span><span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span><span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* 日间模式页脚字体颜色 */</span>
<span class="token selector">[data-theme="light"]</span><span class="token punctuation">&#123;</span>
  <span class="token selector">#footer</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token comment">/* 页脚 a 标签字体颜色 */</span>
    <span class="token selector">#footer-wrap</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #050505<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/*a 标签颜色 */</span>
    <span class="token selector">#footer-wrap a</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #050505<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/* 页脚自定义字段字体颜色 */</span>
    <span class="token selector">.footer_custom_text</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #050505<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* 夜间模式页脚字体颜色 */</span>
<span class="token selector">[data-theme="dark"]</span><span class="token punctuation">&#123;</span>
  <span class="token selector">#footer</span><span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token comment">/* 页脚 a 标签字体颜色 */</span>
    <span class="token selector">#footer-wrap</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #efefef<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/*a 标签颜色 */</span>
    <span class="token selector">#footer-wrap a</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #efefef<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/* 页脚自定义字段字体颜色 */</span>
    <span class="token selector">.footer_custom_text</span> <span class="token punctuation">&#123;</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #efefef<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">#web_bg</span> <span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>
    0deg<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>247<span class="token punctuation">,</span> 149<span class="token punctuation">,</span> 51<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 0<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>243<span class="token punctuation">,</span> 112<span class="token punctuation">,</span> 85<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 15%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 78<span class="token punctuation">,</span> 123<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 30%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>161<span class="token punctuation">,</span> 102<span class="token punctuation">,</span> 171<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 44%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>80<span class="token punctuation">,</span> 115<span class="token punctuation">,</span> 184<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 58%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>16<span class="token punctuation">,</span> 152<span class="token punctuation">,</span> 173<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 72%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>7<span class="token punctuation">,</span> 179<span class="token punctuation">,</span> 155<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 86%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>109<span class="token punctuation">,</span> 186<span class="token punctuation">,</span> 130<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 100%
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-moz-linear-gradient</span><span class="token punctuation">(</span>
    0deg<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>247<span class="token punctuation">,</span> 149<span class="token punctuation">,</span> 51<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 0<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>243<span class="token punctuation">,</span> 112<span class="token punctuation">,</span> 85<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 15%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 78<span class="token punctuation">,</span> 123<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 30%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>161<span class="token punctuation">,</span> 102<span class="token punctuation">,</span> 171<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 44%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>80<span class="token punctuation">,</span> 115<span class="token punctuation">,</span> 184<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 58%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>16<span class="token punctuation">,</span> 152<span class="token punctuation">,</span> 173<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 72%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>7<span class="token punctuation">,</span> 179<span class="token punctuation">,</span> 155<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 86%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>109<span class="token punctuation">,</span> 186<span class="token punctuation">,</span> 130<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 100%
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-o-linear-gradient</span><span class="token punctuation">(</span>
    0deg<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>247<span class="token punctuation">,</span> 149<span class="token punctuation">,</span> 51<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 0<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>243<span class="token punctuation">,</span> 112<span class="token punctuation">,</span> 85<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 15%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 78<span class="token punctuation">,</span> 123<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 30%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>161<span class="token punctuation">,</span> 102<span class="token punctuation">,</span> 171<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 44%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>80<span class="token punctuation">,</span> 115<span class="token punctuation">,</span> 184<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 58%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>16<span class="token punctuation">,</span> 152<span class="token punctuation">,</span> 173<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 72%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>7<span class="token punctuation">,</span> 179<span class="token punctuation">,</span> 155<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 86%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>109<span class="token punctuation">,</span> 186<span class="token punctuation">,</span> 130<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 100%
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-ms-linear-gradient</span><span class="token punctuation">(</span>
    0deg<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>247<span class="token punctuation">,</span> 149<span class="token punctuation">,</span> 51<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 0<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>243<span class="token punctuation">,</span> 112<span class="token punctuation">,</span> 85<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 15%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 78<span class="token punctuation">,</span> 123<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 30%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>161<span class="token punctuation">,</span> 102<span class="token punctuation">,</span> 171<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 44%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>80<span class="token punctuation">,</span> 115<span class="token punctuation">,</span> 184<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 58%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>16<span class="token punctuation">,</span> 152<span class="token punctuation">,</span> 173<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 72%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>7<span class="token punctuation">,</span> 179<span class="token punctuation">,</span> 155<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 86%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>109<span class="token punctuation">,</span> 186<span class="token punctuation">,</span> 130<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 100%
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>
    90deg<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>247<span class="token punctuation">,</span> 149<span class="token punctuation">,</span> 51<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 0<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>243<span class="token punctuation">,</span> 112<span class="token punctuation">,</span> 85<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 15%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>239<span class="token punctuation">,</span> 78<span class="token punctuation">,</span> 123<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 30%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>161<span class="token punctuation">,</span> 102<span class="token punctuation">,</span> 171<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 44%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>80<span class="token punctuation">,</span> 115<span class="token punctuation">,</span> 184<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 58%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>16<span class="token punctuation">,</span> 152<span class="token punctuation">,</span> 173<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 72%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>7<span class="token punctuation">,</span> 179<span class="token punctuation">,</span> 155<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 86%<span class="token punctuation">,</span>
    <span class="token function">rgba</span><span class="token punctuation">(</span>109<span class="token punctuation">,</span> 186<span class="token punctuation">,</span> 130<span class="token punctuation">,</span> 0.1<span class="token punctuation">)</span> 100%
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="中英文字符间加空格"><a href="# 中英文字符间加空格" class="headerlink" title="中英文字符间加空格"></a>中英文字符间加空格 </h2><p> 安装插件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-filter-auto-spacing <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置文件 <code>_config.yml</code> 添加参数</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># hexo 中英文之间自动加空格 </span>
<span class="token key atrule">auto_spacing</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>Qemu</title>
    <url>/blog/posts/ecd52e49.html</url>
    <content><![CDATA[<h1 id="Qemu"><a href="#Qemu" class="headerlink" title="Qemu"></a>Qemu</h1><h2 id="AIX-7-2"><a href="#AIX-7-2" class="headerlink" title="AIX 7.2"></a>AIX 7.2</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">qemu-img create <span class="token parameter variable">-f</span> qcow2 hdisk0.qcow2 20G

qemu-system-ppc64 <span class="token parameter variable">-cpu</span> POWER8 <span class="token parameter variable">-machine</span> pseries <span class="token parameter variable">-m</span> <span class="token number">4096</span> <span class="token parameter variable">-serial</span> stdio <span class="token punctuation">\</span>
<span class="token parameter variable">-drive</span> <span class="token assign-left variable">file</span><span class="token operator">=</span>hdisk0.qcow2,if<span class="token operator">=</span>none,id<span class="token operator">=</span>drive-virtio-disk0 <span class="token parameter variable">-device</span> virtio-scsi-pci,id<span class="token operator">=</span>scsi <span class="token punctuation">\</span>
<span class="token parameter variable">-device</span> scsi-hd,drive<span class="token operator">=</span>drive-virtio-disk0 <span class="token parameter variable">-cdrom</span> AIX_v7.2_Install_7200-03-03-1913_DVD_1_of_2_052019.iso <span class="token punctuation">\</span>
-prom-env <span class="token string">"boot-command=boot cdrom:"</span>

qemu-system-ppc64 <span class="token parameter variable">-cpu</span> POWER8 <span class="token parameter variable">-machine</span> pseries <span class="token parameter variable">-m</span> <span class="token number">4096</span> <span class="token parameter variable">-serial</span> stdio <span class="token punctuation">\</span>
<span class="token parameter variable">-drive</span> <span class="token assign-left variable">file</span><span class="token operator">=</span>hdisk0.qcow2,if<span class="token operator">=</span>none,id<span class="token operator">=</span>drive-virtio-disk0 <span class="token parameter variable">-device</span> virtio-scsi-pci,id<span class="token operator">=</span>scsi <span class="token punctuation">\</span>
<span class="token parameter variable">-device</span> scsi-hd,drive<span class="token operator">=</span>drive-virtio-disk0 <span class="token parameter variable">-cdrom</span> AIX_v7.2_Install_7200-03-03-1913_DVD_1_of_2_052019.iso <span class="token punctuation">\</span>
-prom-env <span class="token string">"boot-command=boot disk:"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
      <tags>
        <tag>qemu</tag>
      </tags>
  </entry>
  <entry>
    <title>Git</title>
    <url>/blog/posts/69c3279c.html</url>
    <content><![CDATA[<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name  <span class="token string">"username"</span>  
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email  <span class="token string">"email"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>Cloudflare</title>
    <url>/blog/posts/6e84350.html</url>
    <content><![CDATA[<h1 id="Cloudflare"><a href="#Cloudflare" class="headerlink" title="Cloudflare"></a>Cloudflare</h1><h2 id="Native-Terminal"><a href="#Native-Terminal" class="headerlink" title="Native Terminal"></a>Native Terminal</h2><ol>
<li><p>Install cloudflared on the client machine.</p>
</li>
<li><p>Make a one-time change to your SSH configuration file:</p>
<p> <code>vim ~/.ssh/config</code></p>
</li>
<li><p>Input the following values; replacing ssh.example.com with the hostname you created.</p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Host ssh.example.com
ProxyCommand /usr/local/bin/cloudflared access <span class="token function">ssh</span> <span class="token parameter variable">--hostname</span> %h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> The cloudflared path may be different depending on your OS and package manager. For example, if you installed cloudflared on macOS with Homebrew, the path is &#x2F;opt&#x2F;homebrew&#x2F;bin&#x2F;cloudflared.</p>
</li>
<li><p>You can now test the connection by running a command to reach the service:</p>
<p> <code>ssh &lt;username&gt;@ssh.example.com</code></p>
<p> When the command is run, cloudflared will launch a browser window to prompt you to authenticate with your identity provider before establishing the connection from your terminal.</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/blog/posts/4a17b156.html</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
  </entry>
  <entry>
    <title>WSL</title>
    <url>/blog/posts/784ee20b.html</url>
    <content><![CDATA[<h1 id="WSL"><a href="#WSL" class="headerlink" title="WSL"></a>WSL</h1><h2 id="Setting-hyper-v-launch-type"><a href="#Setting-hyper-v-launch-type" class="headerlink" title="Setting hyper-v launch type"></a>Setting hyper-v launch type</h2><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">bcdedit &#x2F;set hypervisorlaunchtype auto

bcdedit &#x2F;set hypervisorlaunchtype off<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="Systemd-support"><a href="#Systemd-support" class="headerlink" title="Systemd support"></a>Systemd support</h2><p>To enable systemd, open your <code>wsl.conf</code> file in a text editor using <code>sudo</code> for admin permissions and add these lines to the <code>/etc/wsl.conf</code>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"[boot]<span class="token entity"title="\n">\n</span>systemd=true"</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/wsl.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Open-file-with-explorer-exe"><a href="#Open-file-with-explorer-exe" class="headerlink" title="Open file with explorer.exe"></a>Open file with explorer.exe</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function-name function">open</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token assign-left variable">wp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>wslpath <span class="token parameter variable">-w</span> <span class="token string">"<span class="token variable">$1</span>"</span><span class="token variable">)</span></span><span class="token punctuation">;</span>
    explorer.exe <span class="token string">"<span class="token variable">$wp</span>"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Others</category>
      </categories>
      <tags>
        <tag>wsl</tag>
      </tags>
  </entry>
  <entry>
    <title>Resetting root password in VCSA</title>
    <url>/blog/posts/c343108e.html</url>
    <content><![CDATA[<h1 id="Resetting-root-password-in-VCSA"><a href="#Resetting-root-password-in-VCSA" class="headerlink" title="Resetting root password in VCSA"></a>Resetting root password in VCSA</h1><blockquote>
<p>The root account password of VMware vCenter Server Appliance fails<br>The root account of the vCenter Server Appliance 6.5 and above is locked or account is expired<br>The root account password has been lost or forgotten</p>
</blockquote>
<h2 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h2><p>For passwords that have expired, the default vCenter Server Appliance password expires after 90 days. For more information, see <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.vcsa.doc/GUID-C63C82F1-D430-4710-8B92-177A79D3DE65.html">Change the Password and Password Expiration Settings of the Root User</a></p>
<h2 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h2><h3 id="For-6-5-x2F-6-7-x2F-7-x"><a href="#For-6-5-x2F-6-7-x2F-7-x" class="headerlink" title="For 6.5 &#x2F; 6.7 &#x2F; 7.x"></a>For 6.5 &#x2F; 6.7 &#x2F; 7.x</h3><p><a href="https://kb.vmware.com/s/article/2147144?lang=en_US">Resetting root password in vCenter Server Appliance 6.5 &#x2F; 6.7 &#x2F; 7.x (2147144)</a></p>
<ol>
<li><p>Take a snapshot or backup of the vCenter Server Appliance before proceeding.<br><font color=caution>Caution: Do not skip this step</font></p>
<p>Note: If the vCenter Appliance is on the same ESXi hosts it manages. Connect directly to the ESXi host that it is located on to perform these steps.</p>
</li>
<li><p>Reboot the vCenter Server Appliance.</p>
</li>
<li><p>After the VCSA Photon OS starts, press the <code>e</code> key to enter the GNU GRUB Edit Menu.</p>
</li>
<li><p>Locate the line that begins with the word <code>Linux</code>.</p>
</li>
<li><p>Append these entries to the end of the line:<br><code>rw init=/bin/bash</code></p>
<p><img src="https://s2.loli.net/2023/05/05/FZAHkV36Rpj4O9c.png"></p>
</li>
<li><p>Press <code>F10</code> to continue booting.</p>
</li>
<li><p>Run the command<br><code>mount -o remount,rw /</code></p>
</li>
<li><p>In the Command prompt, enter the command passwd and provide a new root password (twice for confirmation):<br><code>passwd</code></p>
</li>
<li><p>Unmount the filesystem by running this command (yes, the unmount command is umount  -  it’s not a spelling error):<br><code>umount /</code></p>
</li>
<li><p>Reboot the vCenter Server Appliance by running this command:<br>   <code>reboot -f</code></p>
</li>
<li><p>Confirm that you can access the vCenter Server Appliance using the new root password.</p>
</li>
<li><p>Remove the snapshot taken in Step 1 if applicable.</p>
</li>
<li><p>You could set the Root password to never expire in order to prevent this issue by running command:<br>   <code>chage -I -1 -m 0 -M 99999 -E -1 root</code>  or at the VAMI  (https:&#x2F;&#x2F;<vcenter_fqdn>:5480)</p>
</li>
</ol>
<h3 id="For-6-7-U1-and-later"><a href="#For-6-7-U1-and-later" class="headerlink" title="For 6.7 U1 and later"></a>For 6.7 U1 and later</h3><p><a href="https://kb.vmware.com/s/article/75174?lang=en_US">How to reset the lost or forgotten root password in vCenter Server Appliance 6.7 U1 and later (75174)</a></p>
<div class="note info modern"><p>With the change within VCSA 6.7 U1, the SSO user who is part of <code>SystemConfiguration.BashShellAdministrator</code> group will be able to log in to Bash shell and can call any commands using sudo and without password. This aims at reducing the gap between the root and SSO administrator user. The user has to enable shell to log in to the bash shell. By default, the user will be logged into appliance shell.</p>
</div>

<ol>
<li><p>Connect SSH to VCSA 6.7 and login using <a href="mailto:&#x61;&#100;&#x6d;&#105;&#x6e;&#x69;&#x73;&#x74;&#114;&#x61;&#x74;&#x6f;&#114;&#64;&#x76;&#x73;&#112;&#104;&#101;&#114;&#x65;&#46;&#108;&#111;&#99;&#97;&#x6c;">&#x61;&#100;&#x6d;&#105;&#x6e;&#x69;&#x73;&#x74;&#114;&#x61;&#x74;&#x6f;&#114;&#64;&#x76;&#x73;&#112;&#104;&#101;&#114;&#x65;&#46;&#108;&#111;&#99;&#97;&#x6c;</a> where vsphere.local is your default SSO Domain.</p>
<ul>
<li>If disabled, enable SSH using the VAMI (https:&#x2F;&#x2F;<vcenter_fqdn>:5480 ).</li>
<li>Can login as <a href="mailto:&#97;&#100;&#109;&#105;&#x6e;&#x69;&#115;&#116;&#x72;&#x61;&#116;&#111;&#114;&#64;&#x76;&#112;&#104;&#101;&#x72;&#x65;&#x2e;&#x6c;&#x6f;&#x63;&#97;&#108;">&#97;&#100;&#109;&#105;&#x6e;&#x69;&#115;&#116;&#x72;&#x61;&#116;&#111;&#114;&#64;&#x76;&#112;&#104;&#101;&#x72;&#x65;&#x2e;&#x6c;&#x6f;&#x63;&#97;&#108;</a> or any other member of the SSO administrators group.</li>
<li>Enable or Disable SSH and Bash Shell Access.</li>
</ul>
</li>
<li><p>If first time logging in, enable shell then enter shell.</p>
<ul>
<li><code>shell.set --enable true</code></li>
<li><code>shell</code></li>
</ul>
<p><img src="https://s2.loli.net/2023/05/05/KSJcZVe5RaMLg1I.png"></p>
</li>
<li><p>Once in shell as sso-user, run the below command to change to root shell.</p>
<ul>
<li><code>sudo -i</code></li>
<li>Alternately, you could use the command: <code>sudo passwd root</code></li>
</ul>
</li>
<li><p>Then once in root shell, run passwd to change the root password.</p>
<ul>
<li><code>passwd</code></li>
</ul>
<p><img src="https://s2.loli.net/2023/05/05/hwtFZyJuiHAYpov.png"></p>
</li>
<li><p>Now you can exit the session by running the exit or logout command and then log in through a new SSH session using your root account with updated password. Alternatively, you could run the su command in order to be prompted for the root password and get access as root.</p>
</li>
</ol>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Setting VM Disk UUID</title>
    <url>/blog/posts/91e0e9b9.html</url>
    <content><![CDATA[<h1 id="Setting-VM-Disk-UUID"><a href="#Setting-VM-Disk-UUID" class="headerlink" title="Setting VM Disk UUID"></a>Setting VM Disk UUID</h1><p> 编辑虚拟机配置文件 <code>*.vmx</code>，添加以下参数 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">disk.EnableUUID <span class="token operator">=</span> <span class="token string">"TRUE"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>disk</tag>
      </tags>
  </entry>
  <entry>
    <title>VMware PowerCLI</title>
    <url>/blog/posts/65f9e0ae.html</url>
    <content><![CDATA[<h1 id="VMware-PowerCLI"><a href="#VMware-PowerCLI" class="headerlink" title="VMware PowerCLI"></a>VMware PowerCLI</h1><h2 id="Install-PowerShell"><a href="#Install-PowerShell" class="headerlink" title="Install PowerShell"></a>Install PowerShell</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Register the Microsoft RedHat repository</span>
<span class="token function">curl</span> https://packages.microsoft.com/config/rhel/8/prod.repo <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/yum.repos.d/microsoft.repo

<span class="token comment"># Install PowerShell</span>
<span class="token function">sudo</span> dnf <span class="token function">install</span> <span class="token parameter variable">--assumeyes</span> powershell

<span class="token comment"># Start PowerShell</span>
pwsh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Install-PowerCLI"><a href="#Install-PowerCLI" class="headerlink" title="Install PowerCLI"></a>Install PowerCLI</h2><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Install-Module</span> <span class="token operator">-</span>Name VMware<span class="token punctuation">.</span>PowerCLI<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Install-PowerCLI-Offline"><a href="#Install-PowerCLI-Offline" class="headerlink" title="Install PowerCLI Offline"></a>Install PowerCLI Offline</h2><ol>
<li><p>Download the PowerCLI ZIP file from the <a href="https://code.vmware.com/web/tool/vmware-powercli">PowerCLI home page</a> and transfer the ZIP file to your local machine.</p>
</li>
<li><p>To view the folder paths to which you can extract the PowerCLI ZIP file, run the command:</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token variable">$env</span>:PSModulePath<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Extract the contents of the PowerCLI ZIP file to one of the listed folders.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>PSModulePath<span class="token operator">></span> <span class="token operator">&lt;</span>PowerCLI ZIP file<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>For Windows, run the command to unblock the copied files.</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-ChildItem</span> <span class="token operator">-</span>Path <span class="token string">'folder_path'</span> <span class="token operator">-</span>Recurse <span class="token punctuation">|</span> <span class="token function">Unblock-File</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Verify that the VMware PowerCLI modules have installed successfully.</p>
<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Get-Module</span> VMware* <span class="token operator">-</span>ListAvailable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="Connectting-to-VCSA"><a href="#Connectting-to-VCSA" class="headerlink" title="Connectting to VCSA"></a>Connectting to VCSA</h2><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">Set-PowerCLIConfiguration</span> <span class="token operator">-</span>InvalidCertificateAction Ignore

<span class="token function">Connect-VIServer</span> <span class="token operator">-</span>Protocol https <span class="token operator">-</span>User <span class="token string">'administrator@vsphere.local'</span> <span class="token operator">-</span>Password <span class="token string">'Welcome@123'</span> <span class="token operator">-</span>Server 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>3<span class="token punctuation">.</span>199<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>powercli</tag>
      </tags>
  </entry>
  <entry>
    <title>Setting Shared Disks for Oracle RAC</title>
    <url>/blog/posts/a55fe6db.html</url>
    <content><![CDATA[<h1 id="Setting-Shared-Disks-for-Oracle-RAC"><a href="#Setting-Shared-Disks-for-Oracle-RAC" class="headerlink" title="Setting Shared Disks for Oracle RAC"></a>Setting Shared Disks for Oracle RAC</h1><ol>
<li>Create Disks</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vmkfstools <span class="token parameter variable">-c</span> 1G <span class="token parameter variable">-d</span> eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk
vmkfstools <span class="token parameter variable">-c</span> 1G <span class="token parameter variable">-d</span> eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk
vmkfstools <span class="token parameter variable">-c</span> 1G <span class="token parameter variable">-d</span> eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-OCR01-1GB.vmdk
vmkfstools <span class="token parameter variable">-c</span> 30G <span class="token parameter variable">-d</span> eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-MGMT01-30GB.vmdk
vmkfstools <span class="token parameter variable">-c</span> 10G <span class="token parameter variable">-d</span> eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-ARCH01-10GB.vmdk
vmkfstools <span class="token parameter variable">-c</span> 20G <span class="token parameter variable">-d</span> eagerzeroedthick /vmfs/volumes/datastore01/Oracle19c-RAC/Oracle19c-RAC-DATA01-20GB.vmdk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>Adding a storage controller to Oracle RAC VMs</li>
</ol>
<p>Leave the Bus Sharing mode as <strong>None</strong>, and choose the desired type (LSI Parallel or LSI SAS or <strong>Paravirtual</strong>).</p>
<div class="note info simple"><p>Note: The Paravirtual controller type is generally recommended for RAC shared disks.</p>
</div>

<p><img src="https://s2.loli.net/2023/04/17/AspxLyVKXjZnHbQ.png"></p>
<ol start="3">
<li>Adding shared disks to Oracle RAC VMs</li>
</ol>
<p>Select <strong>Thick provision eager zeroed</strong> option in the Disk Provisioning dropdown menu.<br>In the Sharing dropdown menu, select the <strong>Multi-writer</strong> option.<br>Change the Disk Mode to <strong>Independent-Persistent</strong>.</p>
<div class="note info simple"><p>Note: While Independent-Persistent disk mode is not a hard requirement to enable Multi-writer option, the default Dependent disk mode would cause the cannot snapshot shared disk error when a virtual machine snapshot is taken. Use of Independent-Persistent disk mode would allow taking a snapshot of the OS disk while the shared disk would need to be backed up separately by a third-party vendor software.</p>
</div>

<p><img src="https://s2.loli.net/2023/04/17/khMxL3giPZR87Ob.png"></p>
]]></content>
      <categories>
        <category>VMware</category>
      </categories>
      <tags>
        <tag>share</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup &amp; Restore</title>
    <url>/blog/posts/772b3e6d.html</url>
    <content><![CDATA[<h1 id="Backup-amp-Restore"><a href="#Backup-amp-Restore" class="headerlink" title="Backup &amp; Restore"></a>Backup &amp; Restore</h1><ol>
<li>Full Backup</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span>zsyydb<span class="token punctuation">]</span> <span class="token keyword">TO</span> <span class="token keyword">DISK</span><span class="token operator">=</span>N<span class="token string">'\\192.0.33.222\Backup\zsyydb.bak'</span>
<span class="token keyword">WITH</span> NOFORMAT<span class="token punctuation">,</span>NOINIT<span class="token punctuation">,</span>NAME<span class="token operator">=</span>N<span class="token string">'zsyydb-full'</span><span class="token punctuation">,</span>SKIP<span class="token punctuation">,</span>NOREWIND<span class="token punctuation">,</span>NOUNLOAD<span class="token punctuation">,</span>STATS<span class="token operator">=</span><span class="token number">5</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>Full Restore</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span>zsyydb<span class="token punctuation">]</span> <span class="token keyword">FROM</span> <span class="token keyword">DISK</span><span class="token operator">=</span>N<span class="token string">'D:\backup\zsyydb.bak'</span> <span class="token keyword">WITH</span> <span class="token keyword">FILE</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">REPLACE</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'zsyydb'</span><span class="token keyword">TO</span> N<span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\zsyydb.mdf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'HistoryData'</span><span class="token keyword">TO</span> N<span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\HistoryData.ndf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'UnConfirm2013'</span><span class="token keyword">TO</span> N<span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\UnConfirm2013.ndf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'zsyylog'</span><span class="token keyword">TO</span> N<span class="token string">'T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb.ldf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'zsyylog_1'</span><span class="token keyword">TO</span> N<span class="token string">'T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb1.ldf'</span><span class="token punctuation">,</span>
NORECOVERY<span class="token punctuation">,</span>NOUNLOAD<span class="token punctuation">,</span>STATS<span class="token operator">=</span> <span class="token number">5</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>Diff Backup</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span>zsyydb<span class="token punctuation">]</span> <span class="token keyword">TO</span> <span class="token keyword">DISK</span><span class="token operator">=</span>N<span class="token string">'\\192.0.33.222\Backup\zsyydb01.bak'</span>
<span class="token keyword">WITH</span> DIFFERENTIAL<span class="token punctuation">,</span>NOFORMAT<span class="token punctuation">,</span>NOINIT<span class="token punctuation">,</span>NAME<span class="token operator">=</span>N<span class="token string">'zsyydb- 差异数据库备份'</span><span class="token punctuation">,</span>SKIP<span class="token punctuation">,</span>NOREWIND<span class="token punctuation">,</span>NOUNLOAD<span class="token punctuation">,</span>STATS<span class="token operator">=</span><span class="token number">5</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="4">
<li>Diff Restore</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span>zsyydb<span class="token punctuation">]</span> <span class="token keyword">FROM</span> <span class="token keyword">DISK</span><span class="token operator">=</span>N<span class="token string">'D:\backup\zsyydb01.bak'</span> <span class="token keyword">WITH</span> <span class="token keyword">FILE</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">REPLACE</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'zsyydb'</span><span class="token keyword">TO</span> N<span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\zsyydb.mdf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'HistoryData'</span><span class="token keyword">TO</span> N<span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\HistoryData.ndf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'UnConfirm2013'</span><span class="token keyword">TO</span> N<span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\UnConfirm2013.ndf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'zsyylog'</span><span class="token keyword">TO</span> N<span class="token string">'T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb.ldf'</span><span class="token punctuation">,</span>
MOVE N<span class="token string">'zsyylog_1'</span><span class="token keyword">TO</span> N<span class="token string">'T:\MSSQL10_50.MSSQLSERVER\MSSQL\LOG\zsyydb1.ldf'</span><span class="token punctuation">,</span>
NOUNLOAD<span class="token punctuation">,</span>STATS<span class="token operator">=</span><span class="token number">5</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>backup</tag>
        <tag>restore</tag>
      </tags>
  </entry>
  <entry>
    <title>sp_help_revlogin</title>
    <url>/blog/posts/e11d3ec.html</url>
    <content><![CDATA[<h1 id="sp-help-revlogin"><a href="#sp-help-revlogin" class="headerlink" title="sp_help_revlogin"></a>sp_help_revlogin</h1><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">USE</span> master
GO
<span class="token keyword">IF</span> OBJECT_ID <span class="token punctuation">(</span><span class="token string">'sp_hexadecimal'</span><span class="token punctuation">)</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
  <span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> sp_hexadecimal
GO
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> sp_hexadecimal
    <span class="token variable">@binvalue</span> <span class="token keyword">varbinary</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token variable">@hexvalue</span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">514</span><span class="token punctuation">)</span> OUTPUT
<span class="token keyword">AS</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@charvalue</span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">514</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@i</span> <span class="token keyword">int</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@length</span> <span class="token keyword">int</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@hexstring</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token variable">@charvalue</span> <span class="token operator">=</span> <span class="token string">'0x'</span>
<span class="token keyword">SELECT</span> <span class="token variable">@i</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">SELECT</span> <span class="token variable">@length</span> <span class="token operator">=</span> DATALENGTH <span class="token punctuation">(</span><span class="token variable">@binvalue</span><span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token variable">@hexstring</span> <span class="token operator">=</span> <span class="token string">'0123456789ABCDEF'</span>
<span class="token keyword">WHILE</span> <span class="token punctuation">(</span><span class="token variable">@i</span> <span class="token operator">&lt;=</span> <span class="token variable">@length</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">DECLARE</span> <span class="token variable">@tempint</span> <span class="token keyword">int</span>
  <span class="token keyword">DECLARE</span> <span class="token variable">@firstint</span> <span class="token keyword">int</span>
  <span class="token keyword">DECLARE</span> <span class="token variable">@secondint</span> <span class="token keyword">int</span>
  <span class="token keyword">SELECT</span> <span class="token variable">@tempint</span> <span class="token operator">=</span> <span class="token keyword">CONVERT</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> SUBSTRING<span class="token punctuation">(</span><span class="token variable">@binvalue</span><span class="token punctuation">,</span><span class="token variable">@i</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">SELECT</span> <span class="token variable">@firstint</span> <span class="token operator">=</span> FLOOR<span class="token punctuation">(</span><span class="token variable">@tempint</span><span class="token operator">/</span><span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token keyword">SELECT</span> <span class="token variable">@secondint</span> <span class="token operator">=</span> <span class="token variable">@tempint</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token variable">@firstint</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span>
  <span class="token keyword">SELECT</span> <span class="token variable">@charvalue</span> <span class="token operator">=</span> <span class="token variable">@charvalue</span> <span class="token operator">+</span>
    SUBSTRING<span class="token punctuation">(</span><span class="token variable">@hexstring</span><span class="token punctuation">,</span> <span class="token variable">@firstint</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    SUBSTRING<span class="token punctuation">(</span><span class="token variable">@hexstring</span><span class="token punctuation">,</span> <span class="token variable">@secondint</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">SELECT</span> <span class="token variable">@i</span> <span class="token operator">=</span> <span class="token variable">@i</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">END</span>
<span class="token keyword">SELECT</span> <span class="token variable">@hexvalue</span> <span class="token operator">=</span> <span class="token variable">@charvalue</span>
GO
<span class="token keyword">IF</span> OBJECT_ID <span class="token punctuation">(</span><span class="token string">'sp_help_revlogin'</span><span class="token punctuation">)</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
  <span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> sp_help_revlogin
GO
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> sp_help_revlogin <span class="token variable">@login_name</span> sysname <span class="token operator">=</span> <span class="token boolean">NULL</span> <span class="token keyword">AS</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@name</span> sysname
<span class="token keyword">DECLARE</span> <span class="token variable">@type</span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@hasaccess</span> <span class="token keyword">int</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@denylogin</span> <span class="token keyword">int</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@is_disabled</span> <span class="token keyword">int</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@PWD_varbinary</span>  <span class="token keyword">varbinary</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@PWD_string</span>  <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">514</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@SID_varbinary</span> <span class="token keyword">varbinary</span> <span class="token punctuation">(</span><span class="token number">85</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@SID_string</span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">514</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@tmpstr</span>  <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@is_policy_checked</span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@is_expiration_checked</span> <span class="token keyword">varchar</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@defaultdb</span> sysname
<span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token variable">@login_name</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span>
  <span class="token keyword">DECLARE</span> login_curs <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>
      <span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>is_disabled<span class="token punctuation">,</span> p<span class="token punctuation">.</span>default_database_name<span class="token punctuation">,</span> l<span class="token punctuation">.</span>hasaccess<span class="token punctuation">,</span> l<span class="token punctuation">.</span>denylogin <span class="token keyword">FROM</span> 
sys<span class="token punctuation">.</span>server_principals p <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>syslogins l
      <span class="token keyword">ON</span> <span class="token punctuation">(</span> l<span class="token punctuation">.</span>name <span class="token operator">=</span> p<span class="token punctuation">.</span>name <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> p<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'U'</span> <span class="token punctuation">)</span> <span class="token operator">AND</span> p<span class="token punctuation">.</span>name <span class="token operator">&lt;></span> <span class="token string">'sa'</span>
<span class="token keyword">ELSE</span>
  <span class="token keyword">DECLARE</span> login_curs <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span>

      <span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> p<span class="token punctuation">.</span>name<span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>is_disabled<span class="token punctuation">,</span> p<span class="token punctuation">.</span>default_database_name<span class="token punctuation">,</span> l<span class="token punctuation">.</span>hasaccess<span class="token punctuation">,</span> l<span class="token punctuation">.</span>denylogin <span class="token keyword">FROM</span> 
sys<span class="token punctuation">.</span>server_principals p <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>syslogins l
      <span class="token keyword">ON</span> <span class="token punctuation">(</span> l<span class="token punctuation">.</span>name <span class="token operator">=</span> p<span class="token punctuation">.</span>name <span class="token punctuation">)</span> <span class="token keyword">WHERE</span> p<span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'U'</span> <span class="token punctuation">)</span> <span class="token operator">AND</span> p<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token variable">@login_name</span>
<span class="token keyword">OPEN</span> login_curs
<span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> login_curs <span class="token keyword">INTO</span> <span class="token variable">@SID_varbinary</span><span class="token punctuation">,</span> <span class="token variable">@name</span><span class="token punctuation">,</span> <span class="token variable">@type</span><span class="token punctuation">,</span> <span class="token variable">@is_disabled</span><span class="token punctuation">,</span> <span class="token variable">@defaultdb</span><span class="token punctuation">,</span> <span class="token variable">@hasaccess</span><span class="token punctuation">,</span> <span class="token variable">@denylogin</span>
<span class="token keyword">IF</span> <span class="token punctuation">(</span>@<span class="token variable">@fetch_status</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">PRINT</span> <span class="token string">'No login(s) found.'</span>
  <span class="token keyword">CLOSE</span> login_curs
  <span class="token keyword">DEALLOCATE</span> login_curs
  <span class="token keyword">RETURN</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token keyword">END</span>
<span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token string">'/* sp_help_revlogin script'</span>
<span class="token keyword">PRINT</span> <span class="token variable">@tmpstr</span>
<span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token string">'** Generated'</span> <span class="token operator">+</span> <span class="token keyword">CONVERT</span> <span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'on'</span> <span class="token operator">+</span> @<span class="token variable">@SERVERNAME</span> <span class="token operator">+</span> <span class="token string">'*/'</span>
<span class="token keyword">PRINT</span> <span class="token variable">@tmpstr</span>
<span class="token keyword">PRINT</span> <span class="token string">''</span>
<span class="token keyword">WHILE</span> <span class="token punctuation">(</span>@<span class="token variable">@fetch_status</span> <span class="token operator">&lt;></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">IF</span> <span class="token punctuation">(</span>@<span class="token variable">@fetch_status</span> <span class="token operator">&lt;></span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">BEGIN</span>
    <span class="token keyword">PRINT</span> <span class="token string">''</span>
    <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token string">'-- Login:'</span> <span class="token operator">+</span> <span class="token variable">@name</span>
    <span class="token keyword">PRINT</span> <span class="token variable">@tmpstr</span>
    <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token variable">@type</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'U'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">BEGIN</span> <span class="token comment">-- NT authenticated account/group</span>
      <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token string">'CREATE LOGIN'</span> <span class="token operator">+</span> QUOTENAME<span class="token punctuation">(</span> <span class="token variable">@name</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'FROM WINDOWS WITH DEFAULT_DATABASE = ['</span> <span class="token operator">+</span> <span class="token variable">@defaultdb</span> <span class="token operator">+</span> <span class="token string">']'</span>
    <span class="token keyword">END</span>
    <span class="token keyword">ELSE</span> <span class="token keyword">BEGIN</span> <span class="token comment">-- SQL Server authentication</span>
        <span class="token comment">-- obtain password and sid</span>
            <span class="token keyword">SET</span> <span class="token variable">@PWD_varbinary</span> <span class="token operator">=</span> CAST<span class="token punctuation">(</span> LOGINPROPERTY<span class="token punctuation">(</span> <span class="token variable">@name</span><span class="token punctuation">,</span> <span class="token string">'PasswordHash'</span> <span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">varbinary</span> <span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token keyword">EXEC</span> sp_hexadecimal <span class="token variable">@PWD_varbinary</span><span class="token punctuation">,</span> <span class="token variable">@PWD_string</span> <span class="token keyword">OUT</span>
        <span class="token keyword">EXEC</span> sp_hexadecimal <span class="token variable">@SID_varbinary</span><span class="token punctuation">,</span><span class="token variable">@SID_string</span> <span class="token keyword">OUT</span>
        <span class="token comment">-- obtain password policy state</span>
        <span class="token keyword">SELECT</span> <span class="token variable">@is_policy_checked</span> <span class="token operator">=</span> <span class="token keyword">CASE</span> is_policy_checked <span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token string">'ON'</span> <span class="token keyword">WHEN</span> <span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token string">'OFF'</span> <span class="token keyword">ELSE</span> <span class="token boolean">NULL</span> <span class="token keyword">END</span> <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>sql_logins <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token variable">@name</span>
        <span class="token keyword">SELECT</span> <span class="token variable">@is_expiration_checked</span> <span class="token operator">=</span> <span class="token keyword">CASE</span> is_expiration_checked <span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token string">'ON'</span> <span class="token keyword">WHEN</span> <span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token string">'OFF'</span> <span class="token keyword">ELSE</span> <span class="token boolean">NULL</span> <span class="token keyword">END</span> <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>sql_logins <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token variable">@name</span>
            <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token string">'CREATE LOGIN'</span> <span class="token operator">+</span> QUOTENAME<span class="token punctuation">(</span> <span class="token variable">@name</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'WITH PASSWORD ='</span> <span class="token operator">+</span> <span class="token variable">@PWD_string</span> <span class="token operator">+</span> <span class="token string">'HASHED, SID ='</span> <span class="token operator">+</span> <span class="token variable">@SID_string</span> <span class="token operator">+</span> <span class="token string">', DEFAULT_DATABASE = ['</span> <span class="token operator">+</span> <span class="token variable">@defaultdb</span> <span class="token operator">+</span> <span class="token string">']'</span>
        <span class="token keyword">IF</span> <span class="token punctuation">(</span> <span class="token variable">@is_policy_checked</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">)</span>
        <span class="token keyword">BEGIN</span>
          <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token variable">@tmpstr</span> <span class="token operator">+</span> <span class="token string">', CHECK_POLICY ='</span> <span class="token operator">+</span> <span class="token variable">@is_policy_checked</span>
        <span class="token keyword">END</span>
        <span class="token keyword">IF</span> <span class="token punctuation">(</span> <span class="token variable">@is_expiration_checked</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token punctuation">)</span>
        <span class="token keyword">BEGIN</span>
          <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token variable">@tmpstr</span> <span class="token operator">+</span> <span class="token string">', CHECK_EXPIRATION ='</span> <span class="token operator">+</span> <span class="token variable">@is_expiration_checked</span>
        <span class="token keyword">END</span>
    <span class="token keyword">END</span>
    <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token variable">@denylogin</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">BEGIN</span> <span class="token comment">-- login is denied access</span>
      <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token variable">@tmpstr</span> <span class="token operator">+</span> <span class="token string">'; DENY CONNECT SQL TO'</span> <span class="token operator">+</span> QUOTENAME<span class="token punctuation">(</span> <span class="token variable">@name</span> <span class="token punctuation">)</span>
    <span class="token keyword">END</span>
    <span class="token keyword">ELSE</span> <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token variable">@hasaccess</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">BEGIN</span> <span class="token comment">-- login exists but does not have access</span>
      <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token variable">@tmpstr</span> <span class="token operator">+</span> <span class="token string">'; REVOKE CONNECT SQL TO'</span> <span class="token operator">+</span> QUOTENAME<span class="token punctuation">(</span> <span class="token variable">@name</span> <span class="token punctuation">)</span>
    <span class="token keyword">END</span>
    <span class="token keyword">IF</span> <span class="token punctuation">(</span><span class="token variable">@is_disabled</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">BEGIN</span> <span class="token comment">-- login is disabled</span>
      <span class="token keyword">SET</span> <span class="token variable">@tmpstr</span> <span class="token operator">=</span> <span class="token variable">@tmpstr</span> <span class="token operator">+</span> <span class="token string">'; ALTER LOGIN'</span> <span class="token operator">+</span> QUOTENAME<span class="token punctuation">(</span> <span class="token variable">@name</span> <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'DISABLE'</span>
    <span class="token keyword">END</span>
    <span class="token keyword">PRINT</span> <span class="token variable">@tmpstr</span>
  <span class="token keyword">END</span>
  <span class="token keyword">FETCH</span> <span class="token keyword">NEXT</span> <span class="token keyword">FROM</span> login_curs <span class="token keyword">INTO</span> <span class="token variable">@SID_varbinary</span><span class="token punctuation">,</span> <span class="token variable">@name</span><span class="token punctuation">,</span> <span class="token variable">@type</span><span class="token punctuation">,</span> <span class="token variable">@is_disabled</span><span class="token punctuation">,</span> <span class="token variable">@defaultdb</span><span class="token punctuation">,</span> <span class="token variable">@hasaccess</span><span class="token punctuation">,</span> <span class="token variable">@denylogin</span>
   <span class="token keyword">END</span>
<span class="token keyword">CLOSE</span> login_curs
<span class="token keyword">DEALLOCATE</span> login_curs
<span class="token keyword">RETURN</span> <span class="token number">0</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 存储过程创建完成后执行 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">EXEC</span> sp_help_revlogin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 自动生成登录名权限脚本。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>orphaned users</title>
    <url>/blog/posts/877cd9cd.html</url>
    <content><![CDATA[<h1 id="orphaned-users"><a href="#orphaned-users" class="headerlink" title="orphaned users"></a>orphaned users</h1><p>Step 1:  检测、查看对应的孤立账号 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">USE</span> <span class="token operator">&lt;</span>DatabaseName<span class="token operator">></span><span class="token punctuation">;</span>
GO
<span class="token keyword">EXEC</span> sp_change_users_login <span class="token variable">@Action</span><span class="token operator">=</span><span class="token string">'Report'</span><span class="token punctuation">;</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Step 2: 新建对应的登录名，例如上面检测到 Test 账号为孤立账号 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">USE</span> <span class="token punctuation">[</span>master<span class="token punctuation">]</span>
GO
<span class="token keyword">CREATE</span> LOGIN <span class="token punctuation">[</span>Test<span class="token punctuation">]</span> <span class="token keyword">WITH</span> PASSWORD<span class="token operator">=</span>N<span class="token string">'Pa@#456'</span> MUST_CHANGE<span class="token punctuation">,</span> DEFAULT_DATABASE<span class="token operator">=</span><span class="token punctuation">[</span>xxxx<span class="token punctuation">]</span><span class="token punctuation">,</span> CHECK_EXPIRATION<span class="token operator">=</span><span class="token keyword">ON</span><span class="token punctuation">,</span> CHECK_POLICY<span class="token operator">=</span><span class="token keyword">ON</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Step 3:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">USE</span> EASN_EAP<span class="token punctuation">;</span>
GO
<span class="token keyword">EXEC</span> sp_change_users_login <span class="token variable">@Action</span><span class="token operator">=</span><span class="token string">'Update_one'</span><span class="token punctuation">,</span><span class="token variable">@UserNamePattern</span><span class="token operator">=</span><span class="token string">'xxxx'</span><span class="token punctuation">,</span><span class="token variable">@LoginName</span><span class="token operator">=</span><span class="token string">'xxxx'</span><span class="token punctuation">;</span>
GO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>alwayson database can not shrink log file</title>
    <url>/blog/posts/eb1952bb.html</url>
    <content><![CDATA[<h1 id="alwayson-database-can-not-shrink-log-file"><a href="#alwayson-database-can-not-shrink-log-file" class="headerlink" title="alwayson database can not shrink log file"></a>alwayson database can not shrink log file</h1><p>AlwaysOn database 事务日志截断后，日志文件无法收缩，导致日志文件占用磁盘空间大。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>If you have scheduled T-Log Backup on alwaysOn Database, After completion of T-Log Backup check the <strong>log_reuse_wait_desc</strong> of database using query</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> name<span class="token punctuation">,</span>log_reuse_wait_desc <span class="token keyword">from</span> sys<span class="token punctuation">.</span><span class="token keyword">databases</span> <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'Name Of Database'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>If column log_reuse_wait_desc returns value “<strong>NOTHING</strong>“, Immediately execute <strong>DBCC SHRINKFILE</strong> Command and shrink Log File without Error.</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>SQLServer</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Docker on Fedora</title>
    <url>/blog/posts/bd8fd50a.html</url>
    <content><![CDATA[<h1 id="Install-Docker-on-Fedora"><a href="#Install-Docker-on-Fedora" class="headerlink" title="Install Docker on Fedora"></a>Install Docker on Fedora</h1><h2 id="Uninstall-old-versions"><a href="#Uninstall-old-versions" class="headerlink" title="Uninstall old versions"></a>Uninstall old versions</h2><p>Older versions of Docker were called <code>docker</code> or <code>docker-engine</code>. If these are installed, uninstall them, along with associated dependencies.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> dnf remove <span class="token function">docker</span> <span class="token punctuation">\</span>
                  docker-client <span class="token punctuation">\</span>
                  docker-client-latest <span class="token punctuation">\</span>
                  docker-common <span class="token punctuation">\</span>
                  docker-latest <span class="token punctuation">\</span>
                  docker-latest-logrotate <span class="token punctuation">\</span>
                  docker-logrotate <span class="token punctuation">\</span>
                  docker-selinux <span class="token punctuation">\</span>
                  docker-engine-selinux <span class="token punctuation">\</span>
                  docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Set-up-the-repository"><a href="#Set-up-the-repository" class="headerlink" title="Set up the repository"></a>Set up the repository</h2><p>Install the <code>dnf-plugins-core</code> package (which provides the commands to manage your DNF repositories) and set up the repository.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> dnf <span class="token parameter variable">-y</span> <span class="token function">install</span> dnf-plugins-core

$ <span class="token function">sudo</span> dnf config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    https://download.docker.com/linux/fedora/docker-ce.repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Install-Docker-Engine"><a href="#Install-Docker-Engine" class="headerlink" title="Install Docker Engine"></a>Install Docker Engine</h2><ol>
<li><p>Install the <em>latest version</em> of Docker Engine, containerd, and Docker Compose or go to the next step to install a specific version:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> dnf <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>If prompted to accept the GPG key, verify that the fingerprint matches <code>060A 61C5 1B55 8A7F 742B 77AA C52F EB6B 621E 9F35</code>, and if so, accept it.</p>
<p>This command installs Docker, but it doesn’t start Docker. It also creates a <code>docker</code> group, however, it doesn’t add any users to the group by default.</p>
</li>
<li><p>To install a <em>specific version</em> of Docker Engine, list the available versions in the repo, then select and install:</p>
<p>a. List and sort the versions available in your repo. This example sorts results by version number, highest to lowest, and is truncated:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ dnf list docker-ce  <span class="token parameter variable">--showduplicates</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-r</span>

docker-ce.x86_64  <span class="token number">3</span>:18.09.1-3.fc28                 docker-ce-stabledocker-ce.x86_64  <span class="token number">3</span>:18.09.0-3.fc28                 docker-ce-stabledocker-ce.x86_64  <span class="token number">18.06</span>.1.ce-3.fc28                docker-ce-stabledocker-ce.x86_64  <span class="token number">18.06</span>.0.ce-3.fc28                docker-ce-stable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>The list returned depends on which repositories are enabled, and is specific to your version of Fedora (indicated by the <code>.fc28</code> suffix in this example).</p>
<p>b. Install a specific version by its fully qualified package name, which is the package name (<code>docker-ce</code>) plus the version string (2nd column) up to the first hyphen, separated by a hyphen (<code>-</code>), for example, <code>docker-ce-3:18.09.1</code>.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> dnf <span class="token parameter variable">-y</span> <span class="token function">install</span> docker-ce-<span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> docker-ce-cli-<span class="token operator">&lt;</span>VERSION_STRING<span class="token operator">></span> containerd.io docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>This command installs Docker, but it doesn’t start Docker. It also creates a <code>docker</code> group, however, it doesn’t add any users to the group by default.</p>
</li>
<li><p>Start Docker.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> systemctl start <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Verify that Docker Engine is installed correctly by running the <code>hello-world</code> image.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">docker</span> run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>This command downloads a test image and runs it in a container. When the container runs, it prints a message and exits.</p>
</li>
</ol>
<p>This installs and runs Docker Engine. Use <code>sudo</code> to run Docker commands. Continue to <a href="https://docs.docker.com/engine/install/linux-postinstall/">Linux postinstall</a> to allow non-privileged users to run Docker commands and for other optional configuration steps.</p>
<h2 id="Uninstall-Docker-Engine"><a href="#Uninstall-Docker-Engine" class="headerlink" title="Uninstall Docker Engine"></a>Uninstall Docker Engine</h2><ol>
<li><p>Uninstall the Docker Engine, CLI, Containerd, and Docker Compose packages:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> dnf remove docker-ce docker-ce-cli containerd.io docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Images, containers, volumes, or customized configuration files on your host are not automatically removed. To delete all images, containers, and volumes:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/docker
$ <span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/containerd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<p>You must delete any edited configuration files manually.</p>
]]></content>
      <categories>
        <category>Docker</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Brocade Configuration</title>
    <url>/blog/posts/cd75cb2e.html</url>
    <content><![CDATA[<h1 id="Brocade-Configuration"><a href="#Brocade-Configuration" class="headerlink" title="Brocade Configuration"></a>Brocade Configuration</h1><h2 id="默认 IP 密码"><a href="# 默认 IP 密码" class="headerlink" title="默认 IP 密码"></a>默认 IP 密码 </h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> 初始默认 IP: <span class="token number">10.77</span>.77.77
用户密码: admin/password    root/fibranne<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="常用命令"><a href="# 常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">porterrshow     <span class="token comment"># 查看端口计数</span>
portstatsclear  <span class="token comment"># 清除全部端口计数</span>

sfpshow         <span class="token comment"># 查看光衰</span>

portperfshow    <span class="token comment"># 查看端口流量</span>

fabricshow      <span class="token comment"># 查看与当前交换机级联的交换机</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="初始化配置"><a href="# 初始化配置" class="headerlink" title="初始化配置"></a>初始化配置</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">switchname SW1
tstimezone Asia/Shanghai
<span class="token function">date</span> <span class="token string">"0101235922"</span>
tsclockserver <span class="token string">"192.168.2.1"</span>
ipaddrset
ipaddrshow<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="ZONE 配置"><a href="#ZONE 配置" class="headerlink" title="ZONE 配置"></a>ZONE 配置</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建 alias/zone/cfg</span>
alicreate <span class="token string">"Esxi168_HBA0"</span>,<span class="token string">"10:00:00:00:c9:60:15:2a"</span>
zonecreate <span class="token string">"Esxi168_HBA0_VNX5200_01_SPA01"</span>,<span class="token string">"Esxi168_HBA0;VNX5200_01_SPA01"</span>
cfgadd <span class="token string">"HIS_CONFIG"</span>,<span class="token string">"Esxi168_HBA0_VNX5200_01_SPA01"</span>

<span class="token comment"># 移除 cfg/zone/alias</span>
cfgremove <span class="token string">"HIS_CONFIG"</span>, <span class="token string">"bcmz1_zone3;bcmz1_zone4"</span>
zonedelete <span class="token string">"bcmz1_zone3"</span>
alidelete <span class="token string">"bcmz1_x3650_m3_p4"</span>

<span class="token comment"># 保存</span>
cfgenable HIS_CONFIG
cfgsave

<span class="token comment"># 删除清空 cfg</span>
cfgdisable <span class="token string">"HIS_CONFIG"</span>
cfgclear
cfgsave<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="配置级联"><a href="# 配置级联" class="headerlink" title="配置级联"></a>配置级联</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 查看级联许可</span>
switch:admin<span class="token operator">></span> licenseshow
ddedcHQyRSeefet: 
Fabric license 
Enhanced Group Management license 
gBFMmPLMYJGKfDgf?3Rg9DKa3gDNE9JBJGAM: 
<span class="token number">8</span> Gig FC license<span class="token punctuation">]</span>

<span class="token comment"># 添加许可</span>
switch:admin<span class="token operator">></span> licenseadd <span class="token operator">&lt;</span>许可字符串<span class="token operator">></span>

<span class="token comment"># 激活端口</span>
switch:admin<span class="token operator">></span> licenseport <span class="token parameter variable">--reserve</span> <span class="token number">0</span>-15

<span class="token comment"># 更改 Domain-ID，级联的光交 Domain-ID 不能相同</span>
switch:admin<span class="token operator">></span> fabricshow
switch:admin<span class="token operator">></span> switchdisable
switch:admin<span class="token operator">></span> configure
Configure<span class="token punctuation">..</span>.
Fabric
Parameters <span class="token punctuation">(</span>yes, y, no, n<span class="token punctuation">)</span>: <span class="token punctuation">[</span>no<span class="token punctuation">]</span> y
Domain
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span>.239<span class="token punctuation">)</span>: <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">2</span>
…
<span class="token operator">&lt;</span>ctrl+D<span class="token operator">></span>
switch:admin<span class="token operator">></span> switchenable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="开启端口 NPIV 功能"><a href="# 开启端口 NPIV 功能" class="headerlink" title="开启端口 NPIV 功能"></a>开启端口 NPIV 功能</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 开启指定端口的 npiv 功能</span>
DS:root<span class="token operator">></span>portcfgnpivport <span class="token parameter variable">--enable</span> <span class="token punctuation">[</span>slot/<span class="token punctuation">]</span>port

<span class="token comment"># 关闭指定端口的 npiv 功能</span>
DS:root<span class="token operator">></span>portcfgnpivport <span class="token parameter variable">--disable</span> <span class="token punctuation">[</span>slot/<span class="token punctuation">]</span>port

<span class="token comment"># 查看端口 npiv 功能状态</span>
DS:root<span class="token operator">></span> portcfgshow<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="FOS 升级"><a href="#FOS 升级" class="headerlink" title="FOS 升级"></a>FOS 升级</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">switch:admin<span class="token operator">></span> firmwareshow
switch:admin<span class="token operator">></span> firmwaredownload
switch:admin<span class="token operator">></span> firmwareactivate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Network</category>
        <category>SANSwitch</category>
      </categories>
      <tags>
        <tag>config</tag>
        <tag>sanswitch</tag>
      </tags>
  </entry>
  <entry>
    <title>Architecture</title>
    <url>/blog/posts/6ca88502.html</url>
    <content><![CDATA[<h1 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h1><h2 id="Physical-Architecture"><a href="#Physical-Architecture" class="headerlink" title="Physical Architecture"></a>Physical Architecture</h2><p><img src="https://s2.loli.net/2022/04/26/nLNcJ5qkIbFCDWU.png"></p>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>1 区 -&gt; 2 区 -&gt; 3 区<br>1 区 -&gt; 3 区</p>
<h2 id="PGA"><a href="#PGA" class="headerlink" title="PGA"></a>PGA</h2><ol>
<li>保存用户的连接信息，如会话属性、绑定变量、用户权限等重要信息。</li>
<li>硬解析首次执行的 SQL 指令，生成唯一指令 HASH 值。</li>
<li>当发起的 SQL 指令需要排序时，如果内存空间充足，则在 PGA 中完成，如果不足，超出部分在临时表空间完成排序。</li>
</ol>
<h2 id="SGA"><a href="#SGA" class="headerlink" title="SGA"></a>SGA</h2><ol>
<li><strong>Shared Pool - Library Cache</strong> 保存硬解析生成唯一 SQL 指令 HASH 值，保留了语法语意检查及执行计划等解析动作的劳动成功，下次执行该 SQL 指令时，直接拿来主义。</li>
<li>如果 SQL 指令需要的数据不在 <strong>Database Buffer Cache</strong>，则从硬盘中获取数据到数据缓存区。</li>
<li><strong>Redo Log Buffer</strong> 保存数据库相关操作日志。</li>
</ol>
<h2 id="Background-Processes"><a href="#Background-Processes" class="headerlink" title="Background Processes"></a>Background Processes</h2><p><strong>DBWR</strong>: 将数据缓存区的数据批量写入（提高数据库写性能）磁盘数据文件中，需等待 LGWR 先完成。<br><strong>CKPT</strong>: Check Point，由 Oracle 的 FAST_SMART_MTTR_TARGET 参数控制，用于触发 DBWR 将数据缓存区的数据中写入磁盘。<br><strong>LGWR</strong>: 将日志缓存区的数据写入磁盘的联机日志文件，记录所有从数据缓存区写入磁盘数据文件的动作。为了顺序记录日志，因此 LGWR 采用单线程。</p>
<ul>
<li>每隔 3 秒，LGWR 运行一次</li>
<li>任何 COMMIT，触发 LGWR 运行一次</li>
<li>DBWR 要把数据从数据缓存区写入磁盘，触发 LGWR 运行一次</li>
<li>日志缓存区满三分之一或记满 1MB，触发 LGWR 运行一次</li>
<li>联机日志文件切换，触发 LGWR 运行一次<br><strong>PMON</strong>: Processes Monitor，进程监视器。在执行某些更新语句，未提交时进程崩溃了，这时候 PMON 会自动回滚该操作。除此之外还可以干预后台进程，比如 RECO 一次失败，会重启 RECO 进程，遇到 LGWR 进程失败，会中止实例，用于防止数据错乱。<br><strong>SMON</strong>: System Mointor，系统监视器。重点工作在于 Instance Recovery，还有清理临时表空间、清理回滚段表空间、合并空闲空间等。<br><strong>LCKn</strong>: 仅使用于 RAC 数据库，最多可有 10 个进程（LCK0 - LCK9），用于实例间的封锁。<br><strong>RECO</strong>: Distributed Database Recovery，用于分布式数据库的恢复。<br><strong>ARCH</strong>: 在 LGWR 写联机日志写到需要覆盖重写时，触发 ARCH 进程复制联机日志，生成归档日志文件。</li>
</ul>
<h2 id="Undo-Segment"><a href="#Undo-Segment" class="headerlink" title="Undo Segment"></a>Undo Segment</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">show</span> parameter undo
NAME                                 <span class="token keyword">TYPE</span>        <span class="token keyword">VALUE</span>
<span class="token comment">------------------------------------ ----------- ------------------------------</span>
undo_management                      string      AUTO
undo_retention                       <span class="token keyword">integer</span>     <span class="token number">900</span>
undo_tablespace                      string      UNDOTBS1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>UNDO_MANAGEMENT&#x3D;AUTO，表示自动回滚段管理，空间不足时自动扩展；<br>UNDO_RETENTION&#x3D;900，表示回滚段需要 900 秒后才能覆盖标记为重新使用的空间。</p>
<h2 id="Logical-Architecture"><a href="#Logical-Architecture" class="headerlink" title="Logical Architecture"></a>Logical Architecture</h2><p><img src="https://s2.loli.net/2022/04/27/MRSTPdmfuiKwhsF.png"></p>
<p>数据库组成：<strong>DATABASE &lt;- Tablespace &lt;- Segment &lt;- Extent &lt;- Block</strong><br>Extent 是数据库分配空间的最小单位<br>Block 是数据库的最小逻辑单位</p>
<h2 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h2><p><img src="https://s2.loli.net/2022/04/27/Wjvg9KdH7zL8bU2.png"></p>
<p>数据库组成：</p>
<blockquote>
<ol>
<li>数据块头(Common and Variable Header) 包含了数据块的概要信息，例如块地址及此数据块所属的段的类型</li>
<li>表目录(Table Directory) 存储行数据所在的表的信息</li>
<li>行目录(Row Directory) 存储插入的行的地址</li>
<li>可用空间区(Free Space) 块中的空余空间，由 PCTFREE 参数设置。如果是表或索引块，该区域还会存储事务条目，大概有 23 字节开销</li>
<li>行数据区 (Row Data) 存储具体的行的信息或者索引的信息，这部分占用了数据块绝大部分的空间<br> 数据块头、表目录、行目录为管理开销，平均在 84-107 字节之间。</li>
</ol>
</blockquote>
<h2 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h2><p>全局临时表：一种是基于会话的全局临时表（commit preserve rows），一种是基于事务的全局临时表（commit delete rows）。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
      </categories>
      <tags>
        <tag>architecture</tag>
      </tags>
  </entry>
  <entry>
    <title>Upgrade Brocade Switch Firmware</title>
    <url>/blog/posts/a37e949c.html</url>
    <content><![CDATA[<h1 id="Upgrade-Brocade-Switch-Firmware"><a href="#Upgrade-Brocade-Switch-Firmware" class="headerlink" title="Upgrade Brocade Switch Firmware"></a>Upgrade Brocade Switch Firmware</h1><p>we use the <strong>firmwareshow</strong> command to see which firmware version is currently installed on the switch.</p>
<p><img src="https://s2.loli.net/2023/02/15/uQXwEkDJboZyvRC.png"></p>
<p>Next, we are going to initiate a <strong>firmwaredownload</strong> command and put in all the required options.</p>
<p><img src="https://s2.loli.net/2023/02/15/XT9LSvAfOF6DlPw.png"></p>
<p>The Server name or IP Address is the IP address of your workstation that hosts the FTP server.</p>
<p>The Username is the FTP user. The filename is the folder where the firmware is residing in and for Network Protocol, choose FTP. Lastly, put in the password for the user. Then the system is going to do a check of the firmware and if everything is good, it will start installing the upgrade.</p>
<p><img src="https://s2.loli.net/2023/02/15/c3zJUQAxVPWBgeH.png"></p>
<p>Please note that this is a <strong>disruptive</strong> upgrade, which means the switch will be restarted.</p>
]]></content>
      <categories>
        <category>Network</category>
        <category>SANSwitch</category>
      </categories>
      <tags>
        <tag>sanswitch</tag>
        <tag>upgrade</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible 配置文件</title>
    <url>/blog/posts/3260e0b5.html</url>
    <content><![CDATA[<p>Ansible 按照如下位置和顺序来查找 ansible.cfg 文件：</p>
<ol>
<li>ANSIBLE_CONFIG 环境变量所指定的文件 </li>
<li> 当前目录下的 ansible.cfg 文件 </li>
<li>Home 目录下的的.ansible.cfg 文件 </li>
<li>&#x2F;etc&#x2F;ansible&#x2F;ansible.cfg 文件 </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>defaults<span class="token punctuation">]</span>
inventory <span class="token operator">=</span> ./inventory
remote_user <span class="token operator">=</span> normaluser
ask_pass <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token punctuation">[</span>privilege_escalation<span class="token punctuation">]</span>
become <span class="token operator">=</span> <span class="token boolean">true</span>
become_method <span class="token operator">=</span> <span class="token function">sudo</span>
become_user <span class="token operator">=</span> root
become_ask_pass <span class="token operator">=</span> <span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>ask_pass &#x3D; false</strong> 需要配置 ssh 免密登录；<br><strong>become_ask_pass &#x3D; false</strong> 需要在 sudoers 配置免密提权。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>RELAX-AND-RECOVER (REAR)</title>
    <url>/blog/posts/45f634ad.html</url>
    <content><![CDATA[<p><strong>Installing  ReaR</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># yum install rear genisoimage syslinux</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>Configuring ReaR</strong></p>
<p>ReaR is configured in the <code>/etc/rear/local.conf</code> file.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">OUTPUT</span><span class="token operator">=</span>ISO
<span class="token assign-left variable">OUTPUT_URL</span><span class="token operator">=</span>file:///mnt/rescue_system/
<span class="token assign-left variable">BACKUP</span><span class="token operator">=</span>NETFS
<span class="token assign-left variable">BACKUP_URL</span><span class="token operator">=</span>file:///srv/backup/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>BACKUP_URL 的挂载点不能是“&#x2F;”，可以用以下命令检查 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># df -P /srv/backup/ | awk '&#123;print $6&#125;' | tail -1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>Creating a Rescue System</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># rear -v mkrescue</span>
~<span class="token punctuation">]</span><span class="token comment"># ls -lh /mnt/rescue_system/rhel7/</span>
total 124M
-rw-------. <span class="token number">1</span> root root <span class="token number">202</span> Jun <span class="token number">10</span> <span class="token number">15</span>:27 README
-rw-------. <span class="token number">1</span> root root 166K Jun <span class="token number">10</span> <span class="token number">15</span>:27 rear.log
-rw-------. <span class="token number">1</span> root root 124M Jun <span class="token number">10</span> <span class="token number">15</span>:27 rear-rhel7.iso
-rw-------. <span class="token number">1</span> root root <span class="token number">274</span> Jun <span class="token number">10</span> <span class="token number">15</span>:27 VERSION<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Scheduling ReaR</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># contab -e</span>
<span class="token number">0</span> <span class="token number">22</span> * * <span class="token number">1</span>-5 root /usr/sbin/rear mkrescue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>Creating a Backup Using the Internal Backup Method</strong></p>
<p>With <strong>BACKUP&#x3D;NETFS</strong> set, ReaR can create either a rescue system, a backup file, or both. To create a rescue system only , run:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rear mkrescue<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>To create a backup only , run:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rear mkbackuponly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>To create a rescue system and a backup , run:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rear mkbackup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Note that triggering backup with ReaR is only possible if using the NETFS method. ReaR cannot trigger other backup methods.  </p>
<p><strong>Performing a System Rescue</strong></p>
<p>To perform a restore or migration:</p>
<ol>
<li><p>Boot the rescue system on the new hardware. For example, burn the ISO image to a DVD and boot from the DVD.</p>
</li>
<li><p>In the console interface, select the “Recover” option:  </p>
<p><img src="https://s2.loli.net/2022/06/01/vxCj49WLuQUFyKg.png"></p>
</li>
<li><p>You are taken to the prompt: </p>
<p><img src="https://s2.loli.net/2022/06/01/uLfHGoKIm1zZvXr.png"></p>
</li>
<li><p>Run the <strong>rear recover</strong> command to perform the restore or migration. The rescue system then recreates the partition layout and filesystems: </p>
<p><img src="https://s2.loli.net/2022/06/01/qnkZHoQ2sVgp75T.png"></p>
</li>
<li><p>Restore user and system files from the backup into the &#x2F;mnt&#x2F;local&#x2F; directory. </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># scp root@192.168.122.7:/srv/backup/rhel7/backup.tar.gz /mnt/local/</span>
~<span class="token punctuation">]</span><span class="token comment"># tar xf /mnt/local/backup.tar.gz -C /mnt/local/</span>
~<span class="token punctuation">]</span><span class="token comment"># rm -f /mnt/local/backup.tar.gz</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Verify that the files have been restored: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># ls /mnt/local/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Ensure that SELinux relabels the files on the next boot: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># touch /mnt/local/.autorelabel</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Finish the recovery by entering <strong>exit</strong>. ReaR will then reinstall the boot loader. After that, <strong>reboot</strong> the system:</p>
<p><img src="https://s2.loli.net/2022/06/01/cCnZqQL18UiRgNJ.png"></p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Backup</category>
      </categories>
      <tags>
        <tag>rear</tag>
      </tags>
  </entry>
  <entry>
    <title>About HugePages</title>
    <url>/blog/posts/564cfbab.html</url>
    <content><![CDATA[<h1 id="About-HugePages"><a href="#About-HugePages" class="headerlink" title="About HugePages"></a>About HugePages</h1><h2 id="简介"><a href="# 简介" class="headerlink" title="简介"></a>简介</h2><p>HugePages 是 Linux 内核的一个特性，它允许更大的页面管理内存，以替代 4KB 的页面大小。</p>
<p>操作系统把逻辑地址映射成物理地址时，需要把映射关系也存储到一块内存中，这部分内容就是页表（PageTables）。计算机内存是通过表映射（页表）的方式进行内存寻址。CPU 拥有内置的内存管理单元，包含这些页面的列表，每个页面通过页表条目引用。当内存越来越大的时候， CPU 需要管理这些内存页的成本也就越高，这样会对操作系统的性能产生影响。 在 64 位机器上，目前系统默认内存以 4KB 为一个页，作为内存寻址的最小单元，随着内存和进程数的不断增大，页表的大小将会不断增大。内存是以块即页的方式进行管理的，当前大部分系统默认的页大小为 4096 bytes 即 4K 。 1MB 内存等于 256 页； 1GB 内存等于 256000 页。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># getconf PAGESIZE</span>
<span class="token number">4096</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>在 Linux 操作系统中，即使是同一块共享内存，每个进程中的逻辑地址也是不相同的，因此不同进程中的映射表项也不相同。在 64 位的机器上，每个 4k 页需要占用大约 8 字节的内存，一台 48GB 内存的机器，如果分配了 24GB 的共享内存，则每个进程的页表大小为 24GB&#x2F;4K*8&#x3D;48MB；如果连接上 500 个进程，那么页表的大小将是 500*48MB&#x3D;24GB。这会立刻把机器上的所有内存吃光。当然，并不是每个新连接一连接上来就会分配 48MB，而是当进程需要建立逻辑地址和物理地址之间的映射关系时才会分配，所以，进程占用的页表空间是缓慢增加的，但最终还是会占用很大的页表内存。 页表是必须装在内存的，而且是在 CPU 内存，太大就会发生大量 miss，内存寻址性能就会下降。<br>要查看是否存在大页表的问题，可以使用如下的命令来检查页表的大小：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># grep PageTables /proc/meminfo</span>
PageTables:        <span class="token number">82588</span> kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果发现页表的大小不是几十兆，而是达到了 1GB 以上，就说明共享内存使用存在此问题。基于共享内存的多进程架构的程序都会存在此问题。<br>Huge Page 就是为了解决这个问题，它使用 2MB 的大页代替传统小页 4KB 来管理内存，这样页表大小就可以控制的很小，进而全部装在 CPU 内存，防止出现 miss。</p>
<blockquote>
<p>在 Linux 中，大页分为两种：一是静态大页面（Static Huge Pages，SHP）也称为标准大页，二是透明大页面（Transparent Huge Pages，THP）。从它们的名字就可以看出，SHP 是静态的，而 THP 是动态的。由于 THP 是在运行期做分配和管理，因此会有一定程度的延迟，对于内存密集型的应用（例如数据库类）十分不利，必须关闭它。</p>
</blockquote>
<h2 id="Static-HugePages（标准大页）"><a href="#Static-HugePages（标准大页）" class="headerlink" title="Static HugePages（标准大页）"></a>Static HugePages（标准大页）</h2><p>Huge pages 是从 Linux Kernel 2.6 后被引入的，目的是通过使用大页内存来取代传统的 4kb 内存页面，以适应越来越大的系统内存，让操作系统可以支持现代硬件架构的大页面容量功能。<br>Huge pages 有两种格式大小：2MB 和 1GB，2MB 页块大小适合用于 GB 大小的内存，1GB 页块大小适合用于 TB 级别的内存；2MB 是默认的页大小。</p>
<p>标准大页的页面大小：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle-rac1 ~<span class="token punctuation">]</span><span class="token comment"># grep Hugepagesize /proc/meminfo</span>
Hugepagesize:       <span class="token number">2048</span> kB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>使用 Huge Pages 优点</strong></p>
<ul>
<li>适合大内存或内存密集型应用（例如数据库）的调优。</li>
<li>减小页表尺寸（避免页表过大），降低查找缓存（TLB，Translation Lookaside Buffer)的 cache-miss，加速 VM 内存转换。</li>
<li>可以使花费在内存管理上的 CPU 时间更少，从而提高性能。</li>
</ul>
<p><strong>使用 Huge Pages 缺点</strong></p>
<ul>
<li>开启该功能需要进行额外设置，不同的数据库配置方法不同。</li>
<li>大页内存一旦设置，内存就实际分配出去了，也会一直驻留在内存中，不会被交换出去。若数据库没有使用这部分大页，那么相当于这部分大页内存是白白浪费掉的，因为它不会给文件系统缓存使用，也不能给其它不使用大页内存的程序使用。</li>
</ul>
<h2 id="Transparent-HugePages（透明大页）"><a href="#Transparent-HugePages（透明大页）" class="headerlink" title="Transparent HugePages（透明大页）"></a>Transparent HugePages（透明大页）</h2><p>Transparent Huge Pages 缩写 THP，这个是 <strong>RHEL 6</strong> 开始引入的一个功能，只支持 2M 页块，在 Linux 6 上透明大页是 <strong> 默认启用 </strong> 的。<br>由于 Huge pages 很难手动管理，而且通常需要对代码进行重大的更改才能有效的使用，因此 RHEL 6 开始引入了 Transparent Huge Pages（THP），THP 是一个抽象层，能够自动创建、管理和使用传统大页。THP 为系统管理员和开发人员减少了很多使用传统大页的复杂性，因为 THP 的目标是改进性能，因此其它开发人员（来自社区和红帽）已在各种系统、配置、应用程序和负载中对 THP 进行了测试和优化。这样可让 THP 的默认设置改进大多数系统配置性能。但是，<font color=recommand>不建议对数据库工作负载使用 THP （Oracle、MySQL、PostgreSQL、MongoDB 均建议关闭 THP）</font>，因为 THP 在运行时动态分配内存，而运行时的内存分配会有延迟，对于数据库的管理来说并不友好，会导致数据库性能抖动。</p>
<p><strong>如何关闭 THP？（禁用透明大页）</strong></p>
<p>检查当前的 transparent_hugepage 状态</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span>
always <span class="token punctuation">[</span>madvise<span class="token punctuation">]</span> never<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>never 关闭，不使用透明大页内存<br>always 尽量使用透明内存，扫描内存，有 512 个 4k 页面可以整合，就整合成一个 2M 的页面<br>madvise 避免改变内存占用，表示只在 MADV_HUGEPAGE 标志的 VMA 中使用 THP</p>
</blockquote>
<p><strong>运行时关闭：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> never <span class="token operator">></span> /sys/kernel/mm/transparent_hugepage/enabled<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>启动时关闭：</strong></p>
<p>GRUB 配置文件备份</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /etc/default/grub /etc/default/grub.<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>.bak
<span class="token function">cp</span> /boot/grub2/grub.cfg /boot/grub2/grub.cfg.<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>.bak<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>编辑 <code>/etc/default/grub</code> 文件，在 <code>GRUB_CMDLINE_LINUX</code> 那一行后面追加 <code>transparent_hugepage=never</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/default/grub</span>
<span class="token assign-left variable">GRUB_TIMEOUT</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">GRUB_DISTRIBUTOR</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">sed</span> <span class="token string">'s, release .*$,,g'</span> /etc/system-release<span class="token variable">)</span></span>"</span>
<span class="token assign-left variable">GRUB_DEFAULT</span><span class="token operator">=</span>saved
<span class="token assign-left variable">GRUB_DISABLE_SUBMENU</span><span class="token operator">=</span>true
<span class="token assign-left variable">GRUB_TERMINAL_OUTPUT</span><span class="token operator">=</span><span class="token string">"console"</span>
<span class="token assign-left variable">GRUB_CMDLINE_LINUX</span><span class="token operator">=</span><span class="token string">"rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never"</span>
<span class="token assign-left variable">GRUB_DISABLE_RECOVERY</span><span class="token operator">=</span><span class="token string">"true"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>使用 <code>grub2-mkconfig</code> 重新生成 <code>grub.cfg</code> 配置文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">grub2-mkconfig <span class="token parameter variable">-o</span> /boot/grub2/grub.cfg
<span class="token function">reboot</span>   <span class="token comment"># 重启后生效</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>重启后状态确认</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># cat /proc/cmdline </span>
<span class="token assign-left variable">BOOT_IMAGE</span><span class="token operator">=</span>/vmlinuz-3.10.0-1127.el7.x86_64 <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/mapper/rhel-root ro <span class="token assign-left variable">crashkernel</span><span class="token operator">=</span>auto <span class="token assign-left variable">rd.lvm.lv</span><span class="token operator">=</span>rhel/root <span class="token assign-left variable">rd.lvm.lv</span><span class="token operator">=</span>rhel/swap <span class="token assign-left variable">rd.lvm.lv</span><span class="token operator">=</span>rhel/usr rhgb quiet <span class="token assign-left variable">transparent_hugepage</span><span class="token operator">=</span>never

<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># cat /sys/kernel/mm/transparent_hugepage/enabled</span>
always madvise <span class="token punctuation">[</span>never<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果未成功关闭，可能是由于 <code>tuned</code> 和<code>ktune</code>造成的，请参考以下 KB</p>
<ul>
<li><a href="https://access.redhat.com/solutions/422283">Disabling transparent hugepages (THP) on Red Hat Enterprise Linux 6 is not taking effect</a></li>
<li><a href="https://access.redhat.com/solutions/4968001">Disable Transparent Huge Pages(THP) persistently not working on RHEL7</a></li>
</ul>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>hugepages</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating a second instance of the sshd service</title>
    <url>/blog/posts/622bfdea.html</url>
    <content><![CDATA[<h1 id="Creating-a-second-instance-of-the-sshd-service"><a href="#Creating-a-second-instance-of-the-sshd-service" class="headerlink" title="Creating a second instance of the sshd service"></a>Creating a second instance of the sshd service</h1><p>System Administrators often need to configure and run multiple instances of a service. This is done by creating copies of the original service configuration files and modifying certain parameters to avoid conflicts with the primary instance of the service. The following procedure shows how to create a second instance of the sshd service:</p>
<ol>
<li><p>Create a copy of the sshd_config file that will be used by the second daemon:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># cp /etc/ssh/sshd&#123;,-second&#125;_config</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Edit the sshd-second_config file created in the previous step to assign a different port number and PID file to the second daemon:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Port <span class="token number">22220</span>
PidFile /var/run/sshd-second.pid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> See the sshd_config(5) manual page for more information on Port and PidFile options. Make sure the port you choose is not in use by any other service. The PID file does not have to exist before running the service, it is generated automatically on service start.</p>
</li>
<li><p>Create a copy of the systemd unit file for the sshd service:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># cp /usr/lib/systemd/system/sshd.service /etc/systemd/system/sshd-second.service</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Alter the sshd-second.service created in the previous step as follows:<br> a. Modify the Description option:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">Description</span><span class="token operator">=</span>OpenSSH server second instance daemon<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> b. Add sshd.service to services specified in the After option, so that the second instance starts only after the first one has already started:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">After</span><span class="token operator">=</span>syslog.target network.target auditd.service sshd.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> c. The first instance of sshd includes key generation, therefore remove the <code>ExecStartPre=/usr/sbin/sshd-keygen</code> line.</p>
<p> d. Add the -f &#x2F;etc&#x2F;ssh&#x2F;sshd-second_config parameter to the sshd command, so that the alternative configuration file is used:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/sshd <span class="token parameter variable">-D</span> <span class="token parameter variable">-f</span> /etc/ssh/sshd-second_config <span class="token variable">$OPTIONS</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> e. After the above modifications, the sshd-second.service should look as follows:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>OpenSSH server second instance daemon
<span class="token assign-left variable">After</span><span class="token operator">=</span>syslog.target network.target auditd.service sshd.service
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">EnvironmentFile</span><span class="token operator">=</span>/etc/sysconfig/sshd
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/sshd <span class="token parameter variable">-D</span> <span class="token parameter variable">-f</span> /etc/ssh/sshd-second_config <span class="token variable">$OPTIONS</span>
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-HUP</span> <span class="token variable">$MAINPID</span>
<span class="token assign-left variable">KillMode</span><span class="token operator">=</span>process
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token assign-left variable">RestartSec</span><span class="token operator">=</span>42s
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>If using SELinux, add the port for the second instance of sshd to SSH ports, otherwise the second instance of sshd will be rejected to bind to the port:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># semanage port -a -t ssh_port_t -p tcp 22220</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Enable sshd-second.service, so that it starts automatically upon boot:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># systemctl enable sshd-second.service</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Verify if the sshd-second.service is running by using the systemctl status command. Also, verify if the port is enabled correctly by connecting to the service:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> <span class="token parameter variable">-p</span> <span class="token number">22220</span> user@server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>If the firewall is in use, make sure that it is configured appropriately in order to allow connections to the second instance of sshd.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-port=22220/tcp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>sshd</tag>
      </tags>
  </entry>
  <entry>
    <title>Changing and Resetting the Root Password</title>
    <url>/blog/posts/497a035.html</url>
    <content><![CDATA[<h1 id="Changing-and-Resetting-the-Root-Password"><a href="#Changing-and-Resetting-the-Root-Password" class="headerlink" title="Changing and Resetting the Root Password"></a>Changing and Resetting the Root Password</h1><p>Setting up the root password is a mandatory part of the Red Hat Enterprise Linux 7 installation. If you forget or lose the root password it is possible to reset it, however users who are members of the wheel group can change the root password as follows:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">passwd</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Note that in GRUB 2, resetting the password is no longer performed in single-user mode as it was in GRUB included in Red Hat Enterprise Linux 6. The root password is now required to operate in singleuser mode as well as in emergency mode.</p>
<h2 id="1-Resetting-the-Root-Password-Using-an-Installation-Disk"><a href="#1-Resetting-the-Root-Password-Using-an-Installation-Disk" class="headerlink" title="1 Resetting the Root Password Using an Installation Disk"></a>1 Resetting the Root Password Using an Installation Disk</h2><ol>
<li><p>Start the system and when BIOS information is displayed, select the option for a boot menu and<br>select to boot from the installation disk.</p>
</li>
<li><p>Choose <strong>Troubleshooting</strong>.</p>
</li>
<li><p>Choose <strong>Rescue a Red Hat Enterprise Linux System</strong>.</p>
</li>
<li><p>Choose Continue which is the default option. At this point you will be promoted for a passphrase if an encrypted file system is found.</p>
</li>
<li><p>Press <strong>OK</strong> to acknowledge the information displayed until the shell prompt appears.</p>
</li>
<li><p>Change the file system root as follows:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sh-4.2<span class="token comment"># chroot /mnt/sysimage</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Enter the passwd command and follow the instructions displayed on the command line to change the root password.</p>
</li>
<li><p>Remove the autorelable file to prevent a time consuming SELinux relabel of the disk:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sh-4.2<span class="token comment"># rm -f /.autorelabel</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Enter the <strong>exit</strong> command to exit the chroot environment.</p>
</li>
<li><p>Enter the <strong>exit</strong> command again to resume the initialization and finish the system boot.</p>
</li>
</ol>
<h2 id="2-Resetting-the-Root-Password-Using-rd-break"><a href="#2-Resetting-the-Root-Password-Using-rd-break" class="headerlink" title="2 Resetting the Root Password Using rd.break"></a>2 Resetting the Root Password Using rd.break</h2><ol>
<li><p>Start the system and, on the GRUB 2 boot screen, press the <strong>e</strong> key for edit.</p>
</li>
<li><p>Remove the <strong>rhgb</strong> and <strong>quiet</strong> parameters from the end, or near the end, of the linux16 line, or linuxefi on UEFI systems.<br>Press Ctrl+a and Ctrl+e to jump to the start and end of the line, respectively. On some systems, Home and End might also work.</p>
<div class="note info modern"><p>IMPORTANT: The rhgb and quiet parameters must be removed in order to enable system messages.</p>
</div>
</li>
<li><p>Add the following parameters at the end of the <strong>linux</strong> line on 64-Bit IBM Power Series, the <strong>linux16</strong> line on x86-64 BIOS-based systems, or the <strong>linuxefi</strong> line on UEFI systems:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rd.break <span class="token assign-left variable">enforcing</span><span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Adding the <strong>enforcing&#x3D;0</strong> option enables omitting the time consuming SELinux relabeling process.</p>
<p>The initramfs will stop before passing control to the Linux kernel, enabling you to work with the root file system.<br>Note that the initramfs prompt will appear on the last console specified on the Linux line.</p>
</li>
<li><p>Press <strong>Ctrl+x</strong> to boot the system with the changed parameters.<br>With an encrypted file system, a password is required at this point. However the password prompt might not appear as it is obscured by logging messages. You can press the Backspace key to see the prompt. Release the key and enter the password for the encrypted file system, while ignoring the logging messages. The initramfs switch_root prompt appears.</p>
</li>
<li><p>The file system is mounted read-only on &#x2F;sysroot&#x2F;. You will not be allowed to change the password if the file system is not writable.<br>Remount the file system as writable:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">switch_root:/<span class="token comment"># mount -o remount,rw /sysroot</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>The file system is remounted with write enabled.<br>Change the file system’s root as follows:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">switch_root:/<span class="token comment"># chroot /sysroot</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>The prompt changes to sh-4.2#.</p>
</li>
<li><p>Enter the passwd command and follow the instructions displayed on the command line to change the root password.<br>Note that if the system is not writable, the passwd tool fails with the following error:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Authentication token manipulation error<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Updating the password file results in a file with the incorrect SELinux security context. To relabel all files on next system boot, enter the following command:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sh-4.2<span class="token comment"># touch /.autorelabel</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Alternatively, to save the time it takes to relabel a large disk, you can omit this step provided you included the enforcing&#x3D;0 option in step 3.</p>
</li>
<li><p>Remount the file system as read only:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sh-4.2<span class="token comment"># mount -o remount,ro /</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Enter the <strong>exit</strong> command to exit the chroot environment.</p>
</li>
<li><p>Enter the <strong>exit</strong> command again to resume the initialization and finish the system boot.<br>With an encrypted file system, a pass word or phrase is required at this point. However the password prompt might not appear as it is obscured by logging messages. You can press and hold the Backspace key to see the prompt. Release the key and enter the password for the encrypted file system, while ignoring the logging messages.</p>
<hr>
<p><font color=notice>NOTE: The SELinux relabeling process can take a long time. A system reboot<br>will occur automatically when the process is complete.</font></p>
<hr>
</li>
<li><p>If you added the enforcing&#x3D;0 option in step 3 and omitted the touch &#x2F;.autorelabel command in step 8, enter the following command to restore the &#x2F;etc&#x2F;shadow file’s SELinux security context:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># restorecon /etc/shadow</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Enter the following commands to turn SELinux policy enforcement back on and verify that it is on:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># setenforce 1</span>
~<span class="token punctuation">]</span><span class="token comment"># getenforce</span>
Enforcing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating a Yum Repository</title>
    <url>/blog/posts/1bb50798.html</url>
    <content><![CDATA[<h1 id="Creating-a-Yum-Repository"><a href="#Creating-a-Yum-Repository" class="headerlink" title="Creating a Yum Repository"></a>Creating a Yum Repository</h1><p>To set up a yum repository:</p>
<ol>
<li><p>Install the createrepo package:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> createrepo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Copy all packages for your new repository into one directory, such as &#x2F;tmp&#x2F;local_repo&#x2F;:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /your/packages/*.rpm /tmp/local_repo/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>To create the repository run:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">createrepo /tmp/local_repo/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>This creates the necessary metadata for the yum repository and places metadata in a newly created subdirectory repodata.</p>
</li>
</ol>
<p>The repository is now ready to be consumed by yum. This repository can be shared over the HTTP or FTP protocol, or refered directly from the local machine.</p>
<hr>
<p><font color=notice>NOTE: When constructing the URL for a repository, refer to the &#x2F;mnt&#x2F;local_repo not to &#x2F;mnt&#x2F;local_repo&#x2F;repodata, as this directory contains only metadata. Actual yum packages are in &#x2F;mnt&#x2F;local_repo.</font></p>
<hr>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>yum</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating Custom Unit Files</title>
    <url>/blog/posts/9e6e8cc7.html</url>
    <content><![CDATA[<h1 id="Creating-Custom-Unit-Files"><a href="#Creating-Custom-Unit-Files" class="headerlink" title="Creating Custom Unit Files"></a>Creating Custom Unit Files</h1><ol>
<li><p>Prepare the executable file with the custom service. This can be a custom-created script, or an executable delivered by a software provider. If required, prepare a PID file to hold a constant PID for the main process of the custom service. It is also possible to include environment files to store shell variables for the service. Make sure the source script is executable (by executing the <strong>chmod a+x</strong>) and is not interactive.</p>
</li>
<li><p>Create a unit file in the &#x2F;etc&#x2F;systemd&#x2F;system&#x2F; directory and make sure it has correct file permissions. Execute as root:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> /etc/systemd/system/name.service
<span class="token function">chmod</span> <span class="token number">664</span> /etc/systemd/system/name.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Replace name with a name of the service to be created. Note that file does not need to be executable.</p>
</li>
<li><p>Open the name.service file created in the previous step, and add the service configuration options. There is a variety of options that can be used depending on the type of service you wish to create, The following is an example unit configuration for a network-related service:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>service_description
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>path_to_executable
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>path_to_pidfile
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>default.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Where:</p>
<ul>
<li><em>service_description</em> is an informative description that is displayed in journal log files and in the output of the <strong>systemctl status</strong> command.</li>
<li>the <strong>After</strong> setting ensures that the service is started only after the network is running. Add a space-separated list of other relevant services or targets.</li>
<li><em>path_to_executable</em> stands for the path to the actual service executable.</li>
<li><strong>WantedBy</strong> states the target or targets that the service should be started under. Think of these targets as of a replacement of the older concept of runlevels.</li>
<li><strong>Type&#x3D;forking</strong> is used for daemons that make the fork system call. The main process of the service is created with - the PID specified in path_to_pidfile.</li>
</ul>
</li>
<li><p>Notify systemd that a new name.service file exists by executing the following command as root:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl daemon-reload
systemctl start name.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<p>:::warning<br>Always run the systemctl daemon-reload command after creating new unit files or modifying existing unit files. Otherwise, the systemctl start or systemctl enable commands could fail due to a mismatch between states<br>of systemd and actual service unit files on disk.</font><br>:::</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>Introduction to grub 2</title>
    <url>/blog/posts/cc3df016.html</url>
    <content><![CDATA[<h1 id="Introduction-to-grub-2"><a href="#Introduction-to-grub-2" class="headerlink" title="Introduction to grub 2"></a>Introduction to grub 2</h1><p><strong>GRUB 2 配置文件的路径：</strong></p>
<p>​    <strong>BIOS-based</strong></p>
<p>​    <code>/boot/grub2/grub.cfg</code></p>
<p>​    <strong>UEFI</strong></p>
<p>​    <code>/boot/efi/EFI/redhat/grub.cfg</code></p>
<p><strong>Menu Entries in grub.cfg</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">menuentry <span class="token string">'Red Hat Enterprise Linux Server'</span> <span class="token parameter variable">--class</span> red <span class="token parameter variable">--class</span> gnu-linux <span class="token parameter variable">--class</span> gnu <span class="token parameter variable">--class</span> os
<span class="token variable">$menuentry_id_option</span> <span class="token string">'gnulinux-simple-c60731dc-9046-4000-9182-64bdcce08616'</span> <span class="token punctuation">&#123;</span>
    load_video
    <span class="token builtin class-name">set</span> <span class="token assign-left variable">gfxpayload</span><span class="token operator">=</span>keep
    insmod gzio
    insmod part_msdos
    insmod xfs
    <span class="token builtin class-name">set</span> <span class="token assign-left variable">root</span><span class="token operator">=</span><span class="token string">'hd0,msdos1'</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> x<span class="token variable">$feature_platform_search_hint</span> <span class="token operator">=</span> xy <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        search --no-floppy --fs-uuid <span class="token parameter variable">--set</span><span class="token operator">=</span>root --hint-bios<span class="token operator">=</span>hd0,msdos1 --hint-efi<span class="token operator">=</span>hd0,msdos1 <span class="token parameter variable">--hintbaremetal</span><span class="token operator">=</span>ahci0,msdos1 <span class="token parameter variable">--hint</span><span class="token operator">=</span><span class="token string">'hd0,msdos1'</span> 19d9e294-65f8-4e37-8e73-d41d6daa6e58
    <span class="token keyword">else</span>
        search --no-floppy --fs-uuid <span class="token parameter variable">--set</span><span class="token operator">=</span>root 19d9e294-65f8-4e37-8e73-d41d6daa6e58
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">echo</span> <span class="token string">'Loading Linux 3.8.0-0.40.el7.x86_64 ...'</span>
    linux16 /vmlinuz-3.8.0-0.40.el7.x86_64 <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/mapper/rhel-root ro <span class="token assign-left variable">rd.md</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">rd.dm</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">rd.lvm.lv</span><span class="token operator">=</span>rhel/swap <span class="token assign-left variable">crashkernel</span><span class="token operator">=</span>auto <span class="token assign-left variable">rd.luks</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">vconsole.keymap</span><span class="token operator">=</span>us <span class="token assign-left variable">rd.lvm.lv</span><span class="token operator">=</span>rhel/root rhgb quiet
    <span class="token builtin class-name">echo</span> <span class="token string">'Loading initial ramdisk ...'</span>
    initrd /initramfs-3.8.0-0.40.el7.x86_64.img
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>linux</strong> on 64-bit IBM POWER Series, <strong>linux16</strong> on x86_64 BIOS-based systems, and <strong>linuxefi</strong> on UEFI-based systems.</p>
<p>The <strong>initrd</strong> directives followed by the path to the kernel and the <strong>initramfs</strong> image respectively.</p>
<h2 id="Configuring-GRUB-2-to-Require-a-Password-only-for-Modifying-Entries"><a href="#Configuring-GRUB-2-to-Require-a-Password-only-for-Modifying-Entries" class="headerlink" title="Configuring GRUB 2 to Require a Password only for Modifying Entries"></a>Configuring GRUB 2 to Require a Password only for Modifying Entries</h2><ol>
<li><p>Run the grub2-setpassword command as root:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># grub2-setpassword</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Enter and confirm the password:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Enter password:
Confirm password:  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<p>Following this procedure creates a <strong>&#x2F;boot&#x2F;grub2&#x2F;user.cfg</strong> file that contains the hash of the password. The user for this password, <strong>root</strong>, is defined in the <strong>&#x2F;boot&#x2F;grub2&#x2F;grub.cfg</strong> file. With this change, modifying a boot entry during booting requires you to specify the <strong>root</strong> user name and your password.  </p>
<h2 id="Changing-the-Default-Boot-Entry"><a href="#Changing-the-Default-Boot-Entry" class="headerlink" title="Changing the Default Boot Entry"></a>Changing the Default Boot Entry</h2><p>GRUB 2 supports using a numeric value as the key for the saved entry directive to change the default order in which the operating systems are loaded. To specify which operating system should be loaded first, pass its number to the grub2-set-default command. For example:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># grub2-set-default 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>To force a system to always use a particular menu entry, use the menu entry name as the key to the GRUB_DEFAULT directive in the &#x2F;etc&#x2F;default&#x2F;grub file. To list the available menu entries, run the following command as root:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># awk -F\''$1=="menuentry "&#123;print $2&#125;' /etc/grub2.cfg</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Rebuilding-the-grub-cfg-file"><a href="#Rebuilding-the-grub-cfg-file" class="headerlink" title="Rebuilding the grub.cfg file"></a>Rebuilding the grub.cfg file</h2><p>Changes to &#x2F;etc&#x2F;default&#x2F;grub require rebuilding the grub.cfg file as follows:<br>On BIOS-based machines, issue the following command as root:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># grub2-mkconfig -o /boot/grub2/grub.cfg</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>On UEFI-based machines, issue the following command as root:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~<span class="token punctuation">]</span><span class="token comment"># grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>grub2</tag>
      </tags>
  </entry>
  <entry>
    <title>How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</title>
    <url>/blog/posts/ffa54a43.html</url>
    <content><![CDATA[<h1 id="How-to-disable-transparent-hugepages-THP-on-Red-Hat-Enterprise-Linux-7-8-and-9"><a href="#How-to-disable-transparent-hugepages-THP-on-Red-Hat-Enterprise-Linux-7-8-and-9" class="headerlink" title="How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9"></a>How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</h1><h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><ul>
<li>Red Hat Enterprise Linux 7</li>
<li>Red Hat Enterprise Linux 8</li>
<li>Red Hat Enterprise Linux 9</li>
<li>transparent hugepages (THP)</li>
<li>tuned</li>
</ul>
<h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><ul>
<li>How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</li>
<li>Disabling transparent hugepages (THP) on Red Hat Enterprise Linux 7 is not taking effect.</li>
</ul>
<h2 id="Resolution"><a href="#Resolution" class="headerlink" title="Resolution"></a>Resolution</h2><p>Follow the steps below</p>
<p>Add the “transparent_hugepage&#x3D;never” kernel parameter option to the grub2 configuration file.</p>
<p>Append or change the <code>transparent_hugepage=never</code> kernel parameter on the <strong>GRUB_CMDLINE_LINUX</strong> option in <code>/etc/default/grub</code> file. Only include the parameter once.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-p</span> /etc/default/grub<span class="token punctuation">&#123;</span>,.bak.<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%m%d<span class="token variable">`</span></span><span class="token punctuation">&#125;</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/GRUB_CMDLINE_LINUX/ s/"$/ transparent_hugepage=never"/'</span> /etc/default/grub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Verify the parameter is set correctly, like <strong>GRUB_CMDLINE_LINUX&#x3D;”rd.lvm.lv&#x3D;rhel&#x2F;root rd.lvm.lv&#x3D;rhel&#x2F;swap … transparent_hugepage&#x3D;never</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-n</span> <span class="token string">'/GRUB_CMDLINE_LINUX/p'</span> /etc/default/grub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Rebuild the &#x2F;boot&#x2F;grub2&#x2F;grub.cfg file by running the grub2-mkconfig -o command as follows:<br>Please ensure to take a backup of the existing &#x2F;boot&#x2F;grub2&#x2F;grub.cfg before rebuilding.<br>Detect whether Linux runs in UEFI or BIOS mode: <code>test -d /sys/firmware/efi &amp;&amp; echo UEFI || echo BIOS</code></p>
<ul>
<li>On BIOS-based machines: ~]# <code>grub2-mkconfig -o /boot/grub2/grub.cfg</code></li>
<li>On UEFI-based machines: ~]# <code>grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg</code></li>
</ul>
<p>Reboot the system and verify option has been added.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">shutdown</span> <span class="token parameter variable">-r</span> now<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Verify the parameter is set correctly</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /proc/cmdline<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h1 id="If-Transparent-Huge-Pages-THP-is-still-not-disabled-continue-and-use-one-of-the-options-below"><a href="#If-Transparent-Huge-Pages-THP-is-still-not-disabled-continue-and-use-one-of-the-options-below" class="headerlink" title="If Transparent Huge Pages (THP) is still not disabled, continue and use one of the options below."></a>If Transparent Huge Pages (THP) is still not disabled, continue and use one of the options below.</h1><h2 id="Option-1-Recommended-create-a-customized-tuned-profile-with-disabled-THP"><a href="#Option-1-Recommended-create-a-customized-tuned-profile-with-disabled-THP" class="headerlink" title="Option 1: (Recommended) create a customized tuned profile with disabled THP"></a>Option 1: (Recommended) create a customized tuned profile with disabled THP</h2><p>With this resolution we will create a customized version of the currently running profile. The customized version will disable THP.<br>Find out which profile is active, create a copy. In the following example we currently use the throughput-performance profile:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tuned-adm active<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Current active profile: throughput-performance<br>To create customized profile, create a new directory in &#x2F;etc&#x2F;tuned directory with desired profile name.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /etc/tuned/myprofile-nothp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Then create a new tuned.conf file for myprofile-nothp, and insert the new tuning info:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># cat /etc/tuned/myprofile-nothp/tuned.conf </span>
<span class="token punctuation">[</span>main<span class="token punctuation">]</span>
<span class="token assign-left variable">include</span><span class="token operator">=</span>throughput-performance

<span class="token punctuation">[</span>vm<span class="token punctuation">]</span>
<span class="token assign-left variable">transparent_hugepages</span><span class="token operator">=</span>never<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Make the script executable:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> +x /etc/tuned/myprofile-nothp/tuned.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Enable myprofile like so:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tuned-adm profile myprofile-nothp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>This change will immediately take effect and persist reboots.</p>
<p>To verify if THP are disabled or not, run below command:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /sys/kernel/mm/transparent_hugepage/enabled<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Option-2-Alternative-Disable-tuned-services"><a href="#Option-2-Alternative-Disable-tuned-services" class="headerlink" title="Option 2: (Alternative) Disable tuned services"></a>Option 2: (Alternative) Disable tuned services</h2><p>This resolution will disable the tuned services.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl stop tuned
systemctl disable tuned<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>OR</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tuned-adm off<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Now add “transparent_hugepage&#x3D;never” kernel parameter in grub2 configuration file as explained in steps 1-3 above.<br>Reboot the server for changes to take effect.</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>THP</tag>
      </tags>
  </entry>
  <entry>
    <title>iSCSI Share</title>
    <url>/blog/posts/275eae45.html</url>
    <content><![CDATA[<h1 id="iSCSI-Share"><a href="#iSCSI-Share" class="headerlink" title="iSCSI Share"></a>iSCSI Share</h1><h2 id="iSCSI 目录介绍"><a href="#iSCSI 目录介绍" class="headerlink" title="iSCSI 目录介绍"></a>iSCSI 目录介绍 </h2><ul>
<li><code>/backstores/block</code> 存放本地共享设备的位置 </li>
<li><code>/iscsi/&lt;target&gt;/tpg1/luns</code> 存放加入到 target 的共享资源设备 </li>
<li><code>/iscsi/&lt;target&gt;/tpg1/acls</code> 用于存放能够访问共享存储资源的客户端名称 </li>
<li><code>/iscsi/&lt;target&gt;/tpg1/portals</code> 用于指定客户端可被访问的监听 IP 地址及端口 </li>
</ul>
<h2 id="iSCSI- 服务端配置"><a href="#iSCSI- 服务端配置" class="headerlink" title="iSCSI 服务端配置"></a>iSCSI 服务端配置 </h2><ol>
<li><p> 安装 iSCSI，启动服务 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> targetcli
systemctl <span class="token builtin class-name">enable</span> target <span class="token parameter variable">--now</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 创建虚拟设备 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/sharedisk/disk-1 <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">seek</span><span class="token operator">=</span><span class="token number">1024</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">0</span>
losetup /dev/loop0 /sharedisk/disk-1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 定义后端存储 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">targetcli
/<span class="token operator">></span> /backstores/block create lun1 /dev/loop0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 创建 target iqn 对象 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/<span class="token operator">></span> /iscsi create<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 绑定后端存储 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/<span class="token operator">></span> /iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/luns create /backstores/block/lun1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 设置访问控制 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/<span class="token operator">></span> /iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/acls create iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61:xsk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 绑定服务监听的地址，重启服务 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/<span class="token operator">></span> /iscsi/iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61/tpg1/portals create
/<span class="token operator">></span> saveconfig

systemctl restart target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="iSCSI- 客户端配置"><a href="#iSCSI- 客户端配置" class="headerlink" title="iSCSI 客户端配置"></a>iSCSI 客户端配置 </h2><ol>
<li><p> 安装客户端软件，设置开机自启 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> iscsi-initiator-utils
systemctl <span class="token builtin class-name">enable</span> iscsid <span class="token parameter variable">--now</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 将服务端访问控制表中的共享名称加入到客户端配置文件 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span>/etc/iscsi/initiatorname.iscsi <span class="token operator">&lt;&lt;</span><span class="token string">EOF
InitiatorName=iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61:xsk
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 重启客户端 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart iscsid<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 扫描 iSCSI 共享存储设备 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iscsiadm <span class="token parameter variable">-m</span> discovery <span class="token parameter variable">-t</span> st <span class="token parameter variable">-p</span> <span class="token number">192.168</span>.184.129<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 登录 iSCSI 共享服务端 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iscsiadm <span class="token parameter variable">-m</span> <span class="token function">node</span> <span class="token parameter variable">-T</span> iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61 <span class="token parameter variable">-p</span> <span class="token number">192.168</span>.184.129 <span class="token parameter variable">--login</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 查看已挂载的存储设备 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">fdisk</span> <span class="token parameter variable">-l</span>
<span class="token punctuation">..</span>.
Disk /dev/sdb: <span class="token number">5368</span> MB, <span class="token number">5368709120</span> bytes, <span class="token number">10485760</span> sectors
Units <span class="token operator">=</span> sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">126976</span> bytes
Disk label type: dos
Disk identifier: 0x401b1c76
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 删除共享服务端 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iscsiadm <span class="token parameter variable">-m</span> <span class="token function">node</span> <span class="token parameter variable">-T</span> iqn.2003-01.org.linux-iscsi.rhel-7.x8664:sn.f732029a5d61 <span class="token parameter variable">-u</span>

<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/iscsi/nodes/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/iscsi/send_targets/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>iscsi</tag>
      </tags>
  </entry>
  <entry>
    <title>Scan Disk Online</title>
    <url>/blog/posts/4bb25ed9.html</url>
    <content><![CDATA[<h1 id="Scan-Disk-Online"><a href="#Scan-Disk-Online" class="headerlink" title="Scan Disk Online"></a>Scan Disk Online</h1><h2 id="在线扫描新添加的硬盘："><a href="# 在线扫描新添加的硬盘：" class="headerlink" title="在线扫描新添加的硬盘："></a> 在线扫描新添加的硬盘：</h2><p> 添加一块 SCSI 类型的硬盘，执行下面命令扫描磁盘 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ls</span> /sys/class/scsi_host/<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">"- - -"</span> <span class="token operator">></span> /sys/class/scsi_host/<span class="token variable">$&#123;i&#125;</span>/scan<span class="token punctuation">;</span> <span class="token keyword">done</span>
<span class="token comment"># for i in `ls /sys/class/scsi_device/`; do echo 1 > /sys/class/scsi_device/$&#123;i&#125;/device/rescan; done</span>

/usr/bin/scsi-rescan <span class="token parameter variable">-s</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="EMC-PowerPath- 环境中增加 LUN："><a href="#EMC-PowerPath- 环境中增加 LUN：" class="headerlink" title="EMC PowerPath 环境中增加 LUN："></a>EMC PowerPath 环境中增加 LUN：</h2><ol>
<li><p> 确保存储端已配置好 LUN 并映射给 Linux 主机，通过 powermt 命令获得 HBA 卡列表，并扫描列表中所有的 HBA 卡 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">host</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ls</span> /sys/class/scsi_host/<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token string">"- - -"</span> <span class="token operator">></span> /sys/class/scsi_host/<span class="token variable">$&#123;host&#125;</span>/scan<span class="token punctuation">;</span> <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 执行 <code>powermt config</code> 配置新认到的磁盘，生成虚拟设备 </p>
</li>
<li><p> 执行 <code>powermt display</code> 检查新识别到的 LUN 及设备路径 </p>
</li>
<li><p> 执行 <code>powermt save</code> 保存 </p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>disk</tag>
      </tags>
  </entry>
  <entry>
    <title>Shrinking XFS root partition</title>
    <url>/blog/posts/3008d1b6.html</url>
    <content><![CDATA[<h1 id="Shrinking-XFS-root-partition"><a href="#Shrinking-XFS-root-partition" class="headerlink" title="Shrinking XFS root partition"></a>Shrinking XFS root partition</h1><ol>
<li><p><strong>Reboot the system in Rescue Mode by booting Installation Media</strong></p>
<p>Select <strong>Rescue a Oracle Linux system</strong>.</p>
<p><img src="https://s2.loli.net/2022/06/01/ma2ZBpIdWszn4ev.png"></p>
<p>Select option <strong>3 - Skip to shell</strong>.</p>
<p><img src="https://s2.loli.net/2022/06/01/YDpByUNX738jhzT.png"></p>
</li>
<li><p><strong>Preparing a backup by xfs_dump</strong></p>
</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lvs --segments -o +devices</span>
  LV      VG      Attr       <span class="token comment">#Str Type   SSize  Devices</span>
  data_lv data_vg -wi-------    <span class="token number">1</span> linear <span class="token number">10</span>.00g /dev/sdb1<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  log_lv  log_vg  -wi-------    <span class="token number">1</span> linear  <span class="token number">4</span>.99g /dev/sdc1<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  home    rhel    -wi-a-----    <span class="token number">1</span> linear <span class="token number">26</span>.99g /dev/sda2<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
  root    rhel    -wi-a-----    <span class="token number">1</span> linear <span class="token number">50</span>.00g /dev/sda2<span class="token punctuation">(</span><span class="token number">7422</span><span class="token punctuation">)</span>
  root    rhel    -wi-a-----    <span class="token number">1</span> linear <span class="token operator">&lt;</span><span class="token number">5</span>.00g /dev/sdd1<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  swap    rhel    -wi-a-----    <span class="token number">1</span> linear  <span class="token number">2</span>.00g /dev/sda2<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vgchange -a y rhel</span>
  <span class="token number">3</span> logical volume<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">in</span> volume group <span class="token string">"rhel"</span> now active

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkdir /mnt/root</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkdir /mnt/home</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/rhel/root /mnt/root/</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/rhel/home /mnt/home/</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># xfsdump -f /mnt/home/root.dmp /mnt/root</span>
xfsdump: using <span class="token function">file</span> dump <span class="token punctuation">(</span>drive_simple<span class="token punctuation">)</span> strategy
xfsdump: version <span class="token number">3.1</span>.7 <span class="token punctuation">(</span>dump <span class="token function">format</span> <span class="token number">3.0</span><span class="token punctuation">)</span> - <span class="token builtin class-name">type</span> ^C <span class="token keyword">for</span> status and control

 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> dump label dialog <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

please enter label <span class="token keyword">for</span> this dump session <span class="token punctuation">(</span>timeout <span class="token keyword">in</span> <span class="token number">300</span> sec<span class="token punctuation">)</span>
 -<span class="token operator">></span> root
session label entered: <span class="token string">"root"</span>

 --------------------------------- end dialog ---------------------------------

xfsdump: level <span class="token number">0</span> dump of localhost.localdomain:/mnt/root
xfsdump: dump date: Wed Mar  <span class="token number">9</span> 03:16:07 <span class="token number">2022</span>
xfsdump: session id: 8075cffa-e01e-4fd9-a177-23a056ce8be8
xfsdump: session label: <span class="token string">"root"</span>
xfsdump: ino map phase <span class="token number">1</span>: constructing initial dump list
xfsdump: ino map phase <span class="token number">2</span>: skipping <span class="token punctuation">(</span>no pruning necessary<span class="token punctuation">)</span>
xfsdump: ino map phase <span class="token number">3</span>: skipping <span class="token punctuation">(</span>only one dump stream<span class="token punctuation">)</span>
xfsdump: ino map construction complete
xfsdump: estimated dump size: <span class="token number">10083792512</span> bytes
xfsdump: /var/lib/xfsdump/inventory created

 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> media label dialog <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

please enter label <span class="token keyword">for</span> <span class="token for-or-select variable">media</span> <span class="token keyword">in</span> drive <span class="token number">0</span> <span class="token punctuation">(</span>timeout <span class="token keyword">in</span> <span class="token number">300</span> sec<span class="token punctuation">)</span>
 -<span class="token operator">></span> root
media label entered: <span class="token string">"root"</span>

 --------------------------------- end dialog ---------------------------------

xfsdump: creating dump session media <span class="token function">file</span> <span class="token number">0</span> <span class="token punctuation">(</span>media <span class="token number">0</span>, <span class="token function">file</span> <span class="token number">0</span><span class="token punctuation">)</span>
xfsdump: dumping ino map
xfsdump: dumping directories
xfsdump: dumping non-directory files
xfsdump: ending media <span class="token function">file</span>
xfsdump: media <span class="token function">file</span> size <span class="token number">9977044328</span> bytes
xfsdump: dump size <span class="token punctuation">(</span>non-dir files<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token number">9919957304</span> bytes
xfsdump: dump complete: <span class="token number">436</span> seconds elapsed
xfsdump: Dump Summary:
xfsdump:   stream <span class="token number">0</span> /mnt/home/root.dmp OK <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
xfsdump: Dump Status: SUCCESS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li><strong>reduce and format root logical volume, restore the root content</strong></li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># umount /mnt/root</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lvreduce -L -5G /dev/rhel/root</span>
  WARNING: Reducing active and <span class="token function">open</span> logical volume to <span class="token number">50.00</span> GiB.
  THIS MAY DESTROY YOUR DATA <span class="token punctuation">(</span>filesystem etc.<span class="token punctuation">)</span>
Do you really want to reduce rhel/root? <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>: y
  Size of logical volume rhel/root changed from <span class="token number">55.00</span> GiB <span class="token punctuation">(</span><span class="token number">14080</span> extents<span class="token punctuation">)</span> to <span class="token number">50.00</span> GiB <span class="token punctuation">(</span><span class="token number">12800</span> extents<span class="token punctuation">)</span>.
  Logical volume rhel/root successfully resized.
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vgreduce rhel /dev/sdd1</span>
  Removed <span class="token string">"/dev/sdd1"</span> from volume group <span class="token string">"rhel"</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># pvremove /dev/sdd1</span>
  Labels on physical volume <span class="token string">"/dev/sdd1"</span> successfully wiped.

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkfs.xfs -L root -f /dev/rhel/root</span>
meta-data<span class="token operator">=</span>/dev/rhel/root         <span class="token assign-left variable">isize</span><span class="token operator">=</span><span class="token number">512</span>    <span class="token assign-left variable">agcount</span><span class="token operator">=</span><span class="token number">4</span>, <span class="token assign-left variable">agsize</span><span class="token operator">=</span><span class="token number">3276800</span> blks
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">attr</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token assign-left variable">projid32bit</span><span class="token operator">=</span><span class="token number">1</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">crc</span><span class="token operator">=</span><span class="token number">1</span>        <span class="token assign-left variable">finobt</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">sparse</span><span class="token operator">=</span><span class="token number">0</span>
data     <span class="token operator">=</span>                       <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">13107200</span>, <span class="token assign-left variable">imaxpct</span><span class="token operator">=</span><span class="token number">25</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span>      <span class="token assign-left variable">swidth</span><span class="token operator">=</span><span class="token number">0</span> blks
naming   <span class="token operator">=</span>version <span class="token number">2</span>              <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   ascii-ci<span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ftype</span><span class="token operator">=</span><span class="token number">1</span>
log      <span class="token operator">=</span>internal log           <span class="token assign-left variable">bsize</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">6400</span>, <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2</span>
         <span class="token operator">=</span>                       <span class="token assign-left variable">sectsz</span><span class="token operator">=</span><span class="token number">512</span>   <span class="token assign-left variable">sunit</span><span class="token operator">=</span><span class="token number">0</span> blks, lazy-count<span class="token operator">=</span><span class="token number">1</span>
realtime <span class="token operator">=</span>none                   <span class="token assign-left variable">extsz</span><span class="token operator">=</span><span class="token number">4096</span>   <span class="token assign-left variable">blocks</span><span class="token operator">=</span><span class="token number">0</span>, <span class="token assign-left variable">rtextents</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount /dev/rhel/root /mnt/root/</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># xfsrestore -f /mnt/home/root.dmp /mnt/root</span>
xfsrestore: using <span class="token function">file</span> dump <span class="token punctuation">(</span>drive_simple<span class="token punctuation">)</span> strategy
xfsrestore: version <span class="token number">3.1</span>.7 <span class="token punctuation">(</span>dump <span class="token function">format</span> <span class="token number">3.0</span><span class="token punctuation">)</span> - <span class="token builtin class-name">type</span> ^C <span class="token keyword">for</span> status and control
xfsrestore: searching media <span class="token keyword">for</span> dump
xfsrestore: examining media <span class="token function">file</span> <span class="token number">0</span>
xfsrestore: dump description:
xfsrestore: hostname: localhost.localdomain
xfsrestore: <span class="token function">mount</span> point: /mnt/root
xfsrestore: volume: /dev/mapper/rhel-root
xfsrestore: session time: Wed Mar  <span class="token number">9</span> 03:16:07 <span class="token number">2022</span>
xfsrestore: level: <span class="token number">0</span>
xfsrestore: session label: <span class="token string">"root"</span>
xfsrestore: media label: <span class="token string">"root"</span>
xfsrestore: <span class="token function">file</span> system id: 82d461cb-002a-4bd3-9f33-0870656b154a
xfsrestore: session id: 8075cffa-e01e-4fd9-a177-23a056ce8be8
xfsrestore: media id: 1cf8a3f9-de8d-4125-a3c1-c7305a5b0668
xfsrestore: using online session inventory
xfsrestore: searching media <span class="token keyword">for</span> directory dump
xfsrestore: reading directories
xfsrestore: <span class="token number">12396</span> directories and <span class="token number">94871</span> entries processed
xfsrestore: directory post-processing
xfsrestore: restoring non-directory files
xfsrestore: restore complete: <span class="token number">316</span> seconds elapsed
xfsrestore: Restore Summary:
xfsrestore:   stream <span class="token number">0</span> /mnt/home/root.dmp OK <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
xfsrestore: Restore Status: SUCCESS

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># lsblk -o name,size,mountpoint,uuid</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /mnt/root/etc/fstab</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># umount /mnt/root</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># umount /mnt/home</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># init 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>xfs</tag>
      </tags>
  </entry>
  <entry>
    <title>PXE for BIOS</title>
    <url>/blog/posts/58358dc6.html</url>
    <content><![CDATA[<h1 id="PXE-for-BIOS"><a href="#PXE-for-BIOS" class="headerlink" title="PXE for BIOS"></a>PXE for BIOS</h1><p> 为使用 BIOS 的 AMD64 和 Intel 64 客户端配置 PXE 服务器 </p>
<ol>
<li><p> 安装 tftp 软件包。请作为 root 运行以下命令完成此步骤：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># yum install tftp-server</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 在 &#x2F;etc&#x2F;xinet.d&#x2F;tftp 配置文件中，将 disabled 参数从 yes 改为 no。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/xinetd.d/tftp</span>
<span class="token comment"># default: off</span>
<span class="token comment"># description: The tftp server serves files using the trivial file transfer \</span>
<span class="token comment">#       protocol.  The tftp protocol is often used to boot diskless \</span>
<span class="token comment">#       workstations, download configuration files to network-aware printers, \</span>
<span class="token comment">#       and to start the installation process for some operating systems.</span>
<span class="token function">service</span> tftp
<span class="token punctuation">&#123;</span>
        socket_type             <span class="token operator">=</span> dgram
        protocol                <span class="token operator">=</span> udp
        <span class="token function">wait</span>                    <span class="token operator">=</span> <span class="token function">yes</span>
        user                    <span class="token operator">=</span> root
        server                  <span class="token operator">=</span> /usr/sbin/in.tftpd
        server_args             <span class="token operator">=</span> <span class="token parameter variable">-s</span> /var/lib/tftpboot
        disable                 <span class="token operator">=</span> no
        per_source              <span class="token operator">=</span> <span class="token number">11</span>
        cps                     <span class="token operator">=</span> <span class="token number">100</span> <span class="token number">2</span>
        flags                   <span class="token operator">=</span> IPv4
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 这个配置文件中还有其他控制 tftp 服务器行为的选项。可用选项请查看 xinetd.conf(5) 手册页。</p>
</li>
<li><p> 在防火墙中允许 tftp 服务的进入连接：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-service=tftp</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-service=tftp --permanent</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 安装配置 DHCP 服务器 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># yum install dhcp</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/dhcp/dhcpd.conf</span>
<span class="token comment">#</span>
<span class="token comment"># DHCP Server Configuration file.</span>
<span class="token comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span>
<span class="token comment">#   see dhcpd.conf(5) man page</span>
<span class="token comment">#</span>

option space pxelinux<span class="token punctuation">;</span>
option pxelinux.magic code <span class="token number">208</span> <span class="token operator">=</span> string<span class="token punctuation">;</span>
option pxelinux.configfile code <span class="token number">209</span> <span class="token operator">=</span> text<span class="token punctuation">;</span>
option pxelinux.pathprefix code <span class="token number">210</span> <span class="token operator">=</span> text<span class="token punctuation">;</span>
option pxelinux.reboottime code <span class="token number">211</span> <span class="token operator">=</span> unsigned integer <span class="token number">32</span><span class="token punctuation">;</span>
option architecture-type code <span class="token number">93</span> <span class="token operator">=</span> unsigned integer <span class="token number">16</span><span class="token punctuation">;</span>
subnet <span class="token number">192.168</span>.184.0 netmask <span class="token number">255.255</span>.255.0 <span class="token punctuation">&#123;</span>
  option routers <span class="token number">192.168</span>.184.254<span class="token punctuation">;</span>
  range <span class="token number">192.168</span>.184.2 <span class="token number">192.168</span>.184.253<span class="token punctuation">;</span>
  class <span class="token string">"pxeclients"</span> <span class="token punctuation">&#123;</span>
    match <span class="token keyword">if</span> substring <span class="token punctuation">(</span>option vendor-class-identifier, <span class="token number">0</span>, <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"PXEClient"</span><span class="token punctuation">;</span>
    next-server <span class="token number">192.168</span>.184.129<span class="token punctuation">;</span>
    <span class="token keyword">if</span> option architecture-type <span class="token operator">=</span> 00:07 <span class="token punctuation">&#123;</span>
      filename <span class="token string">"uefi/shim.efi"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      filename <span class="token string">"pxelinux/pxelinux.0"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 现在需要完整安装 DVD 的 ISO 映像文件中 SYSLINUX 软件包中的 pxelinux.0 文件。要访问该文件，请作为 root 运行以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># mount -t iso9660 /path_to_image/name_of_image.iso /mount_point -o loop,ro</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># cp -pr /mount_point/Packages/syslinux-version-architecture.rpm /publicly_available_directory</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># umount /mount_point</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p> 提取软件包：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># rpm2cpio syslinux-version-architecture.rpm | cpio -dimv</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 在 tftpboot 中创建 pxelinux 目录，并将 pxelinux.0 复制到该目录中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/lib/tftpboot/pxelinux</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># cp publicly_available_directory/usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/pxelinux</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 在 pxelinux&#x2F; 目录中创建目录 pxelinux.cfg&#x2F;：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/lib/tftpboot/pxelinux/pxelinux.cfg</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 在 pxelinux.cfg&#x2F; 目录中添加名为 default 的配置文件。<br><code>/var/lib/tftpboot/pxelinux/pxelinux.cfg/default</code> 中的示例配置文件类似如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">default vesamenu.c32
prompt <span class="token number">1</span>
<span class="token function">timeout</span> <span class="token number">600</span>

display boot.msg

label linux
  menu label ^Install system
  menu default
  kernel vmlinuz
  append <span class="token assign-left variable">initrd</span><span class="token operator">=</span>initrd.img <span class="token assign-left variable">ip</span><span class="token operator">=</span>dhcp <span class="token assign-left variable">inst.repo</span><span class="token operator">=</span>http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/os/
label vesa
  menu label Install system with ^basic video driver
  kernel vmlinuz
  append <span class="token assign-left variable">initrd</span><span class="token operator">=</span>initrd.img <span class="token assign-left variable">ip</span><span class="token operator">=</span>dhcp <span class="token assign-left variable">inst.xdriver</span><span class="token operator">=</span>vesa nomodeset <span class="token assign-left variable">inst.repo</span><span class="token operator">=</span>http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/os/
label rescue
  menu label ^Rescue installed system
  kernel vmlinuz
  append <span class="token assign-left variable">initrd</span><span class="token operator">=</span>initrd.img rescue
label <span class="token builtin class-name">local</span>
  menu label Boot from ^local drive
  localboot 0xffff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 将引导映象复制到您的 tftp&#x2F; root 目录中：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># cp /path/to/x86_64/os/images/pxeboot/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/pxelinux/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 最后，如果没有运行 xinetd 和 dhcp 服务，则需要启动该服务；如果该服务已运行，则需重新载入 tftp、xinetd 和 dhcp。</p>
<p> 如果这些服务之前没有运行，则需启动这些服务：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start xinetd.service dhcpd.service</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 如果要永久启用这些服务以便每次系统重启后自动启动，则还需要执行以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable xinetd.service dhcpd.service  </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 要重新载入已运行服务的配置，请使用 <code>systemctl reload</code> 命令。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>pxe</tag>
      </tags>
  </entry>
  <entry>
    <title>Kickstart</title>
    <url>/blog/posts/f45c3997.html</url>
    <content><![CDATA[<h1 id="Kickstart"><a href="#Kickstart" class="headerlink" title="Kickstart"></a>Kickstart</h1><p>通过编辑引导装载程序配置启动 Kickstart 安装</p>
<ol>
<li><p>打开 PXE 服务器中的引导装载程序配置文件，并在合适的行中添加 inst.ks&#x3D; 引导选项。该文件的名称及句法取决于您系统的架构和硬件：<br>在使用 BIOS 的 AMD64 和 Intel 64 系统中，该文件名称可以是 default，也可以是根据您的系统 IP 地址命名。因此，请在安装条目的 append 行中添加 inst.ks&#x3D; 选项。该配置文件中 append 行示例类似如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">append <span class="token assign-left variable">initrd</span><span class="token operator">=</span>initrd.img <span class="token assign-left variable">inst.ks</span><span class="token operator">=</span>http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/kickstarts/ks.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>在使用 GRUB2 引导装载程序（使用 UEFI 的 AMD64 和 Intel 64 系统，以及 IBM Power Systems Server）中，该文件名可能是 grub.cfg。在这个文件安装条目的 kernel 行添加 inst.ks&#x3D; 选项。该配置文件 kernel 行示例如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">kernel vmlinuz <span class="token assign-left variable">inst.ks</span><span class="token operator">=</span>http://192.168.184.129/mnt/archive/RHEL-7/7.x/Server/x86_64/kickstarts/ks.cfg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="语法参考"><a href="# 语法参考" class="headerlink" title="语法参考"></a>语法参考</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#version=DEVEL</span>
<span class="token comment"># System authorization information</span>
auth <span class="token parameter variable">--enableshadow</span> <span class="token parameter variable">--passalgo</span><span class="token operator">=</span>sha512
<span class="token comment"># Use CDROM installation media</span>
cdrom
<span class="token comment"># Use graphical install</span>
graphical
<span class="token comment"># Run the Setup Agent on first boot</span>
firstboot <span class="token parameter variable">--enable</span>
ignoredisk --only-use<span class="token operator">=</span>sda
<span class="token comment"># Keyboard layouts</span>
keyboard <span class="token parameter variable">--vckeymap</span><span class="token operator">=</span>us <span class="token parameter variable">--xlayouts</span><span class="token operator">=</span><span class="token string">'us'</span>
<span class="token comment"># System language</span>
lang en_US.UTF-8

<span class="token comment"># Network information</span>
network  <span class="token parameter variable">--bootproto</span><span class="token operator">=</span>static <span class="token parameter variable">--device</span><span class="token operator">=</span>ens33 <span class="token parameter variable">--gateway</span><span class="token operator">=</span><span class="token number">192.168</span>.184.2 <span class="token parameter variable">--ip</span><span class="token operator">=</span><span class="token number">192.168</span>.184.139 <span class="token parameter variable">--nameserver</span><span class="token operator">=</span><span class="token number">192.168</span>.184.2 <span class="token parameter variable">--netmask</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0 <span class="token parameter variable">--ipv6</span><span class="token operator">=</span>auto <span class="token parameter variable">--activate</span>
network  <span class="token parameter variable">--hostname</span><span class="token operator">=</span>rhel7.localdomain

repo <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">"Server-HighAvailability"</span> <span class="token parameter variable">--baseurl</span><span class="token operator">=</span>file:///run/install/repo/addons/HighAvailability
repo <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">"Server-ResilientStorage"</span> <span class="token parameter variable">--baseurl</span><span class="token operator">=</span>file:///run/install/repo/addons/ResilientStorage
<span class="token comment"># Root password</span>
rootpw <span class="token parameter variable">--iscrypted</span> <span class="token variable">$6</span><span class="token variable">$40</span>.EhuRQPJ6OltGD<span class="token variable">$tYEcqbMNDwOmIMMpXhGMyVax5Sw9vyl7znesBaWr</span>/H/pWkmG5qHXCmMHfT9VZSWtHCqinkE5ibO8ZVOzqpmvI0
<span class="token comment"># System services</span>
services <span class="token parameter variable">--disabled</span><span class="token operator">=</span><span class="token string">"chronyd"</span>
<span class="token comment"># System timezone</span>
timezone Asia/Shanghai <span class="token parameter variable">--isUtc</span> <span class="token parameter variable">--nontp</span>
<span class="token comment"># System bootloader configuration</span>
bootloader <span class="token parameter variable">--location</span><span class="token operator">=</span>mbr --boot-drive<span class="token operator">=</span>sda
autopart <span class="token parameter variable">--type</span><span class="token operator">=</span>lvm
<span class="token comment"># Partition clearing information</span>
clearpart <span class="token parameter variable">--none</span> <span class="token parameter variable">--initlabel</span>

%packages
@^minimal
@core

%end

%addon com_redhat_kdump <span class="token parameter variable">--disable</span> --reserve-mb<span class="token operator">=</span><span class="token string">'auto'</span>

%end

%anaconda
pwpolicy root <span class="token parameter variable">--minlen</span><span class="token operator">=</span><span class="token number">6</span> <span class="token parameter variable">--minquality</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--notstrict</span> <span class="token parameter variable">--nochanges</span> <span class="token parameter variable">--notempty</span>
pwpolicy user <span class="token parameter variable">--minlen</span><span class="token operator">=</span><span class="token number">6</span> <span class="token parameter variable">--minquality</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--notstrict</span> <span class="token parameter variable">--nochanges</span> <span class="token parameter variable">--emptyok</span>
pwpolicy luks <span class="token parameter variable">--minlen</span><span class="token operator">=</span><span class="token number">6</span> <span class="token parameter variable">--minquality</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--notstrict</span> <span class="token parameter variable">--nochanges</span> <span class="token parameter variable">--notempty</span>
%end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>**rootpw –iscrypted ** 的加密密码可由 python 生成</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># python -c 'import crypt; print(crypt.crypt("My Password"))'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="验证 Kickstart 文件"><a href="# 验证 Kickstart 文件" class="headerlink" title="验证 Kickstart 文件"></a>验证 Kickstart 文件 </h2><p> 生成定制 kickstart 文件时，请在使用该文件进行安装前确认其是否有效。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># yum install pykickstart</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>安装该软件包后，可以很使用以下命令验证 Kickstart 文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ ksvalidator /path/to/kickstart.ks<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>kickstart</tag>
      </tags>
  </entry>
  <entry>
    <title>Installation</title>
    <url>/blog/posts/48bb149.html</url>
    <content><![CDATA[<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><h2 id="CLUSTER-SOFTWARE-INSTALLATION"><a href="#CLUSTER-SOFTWARE-INSTALLATION" class="headerlink" title="CLUSTER SOFTWARE INSTALLATION"></a>CLUSTER SOFTWARE INSTALLATION</h2><ol>
<li><p>On each node in the cluster, install the Red Hat High Availability Add-On software packages along with all available fence agents from the High Availability channel.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> pcs pacemaker fence-agents-all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>If you are running the firewalld daemon, execute the following commands to enable the ports that are required by the Red Hat High Availability Add-On.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">firewall-cmd <span class="token parameter variable">--permanent</span> --add-service<span class="token operator">=</span>high-availability
firewall-cmd --add-service<span class="token operator">=</span>high-availability<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>In order to use pcs to configure the cluster and communicate among the nodes, you must set a password on each node for the user ID hacluster, which is the pcs administration account. It is recommended that the password for user hacluster be the same on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">passwd</span> hacluster<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Before the cluster can be configured, the pcsd daemon must be started and enabled to boot on startup on each node. This daemon works with the pcs command to manage configuration across the nodes in the cluster.<br>On each node in the cluster, execute the following commands to start the pcsd service and to enable pcsd at system start.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl start pcsd.service
systemctl <span class="token builtin class-name">enable</span> pcsd.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Authenticate the pcs user hacluster for each node in the cluster on the node from which you will be running pcs.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs cluster auth z1.example.com z2.example.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="CLUSTER-CREATION"><a href="#CLUSTER-CREATION" class="headerlink" title="CLUSTER CREATION"></a>CLUSTER CREATION</h2><ol>
<li><p>Execute the following command from z1.example.com to create the two-node cluster my_cluster that consists of nodes z1.example.com and z2.example.com. This will propagate the cluster configuration files to both nodes in the cluster. This command includes the –start option, which will start the cluster services on both nodes in the cluster.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs cluster setup <span class="token parameter variable">--start</span> <span class="token parameter variable">--name</span> my_cluster z1.example.com z2.example.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Enable the cluster services to run on each node in the cluster when the node is booted.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs cluster <span class="token builtin class-name">enable</span> <span class="token parameter variable">--all</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>You can display the current status of the cluster with the pcs cluster status command. Because there may be a slight delay before the cluster is up and running when you start the cluster services with the –start option of the pcs cluster setup command, you should ensure that the cluster is up and running before performing any subsequent actions on the cluster and its configuration.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs cluster status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>PXE for UEFI</title>
    <url>/blog/posts/b04159b7.html</url>
    <content><![CDATA[<h1 id="PXE-for-UEFI"><a href="#PXE-for-UEFI" class="headerlink" title="PXE for UEFI"></a>PXE for UEFI</h1><p> 为使用 UEFI 的 AMD64 和 Intel 64 客户端配置 PXE 服务器 </p>
<ol>
<li><p> 安装 tftp 软件包。请作为 root 运行以下命令完成此步骤：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># yum install tftp-server</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 在 &#x2F;etc&#x2F;xinet.d&#x2F;tftp 配置文件中，将 disabled 参数从 yes 改为 no。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/xinetd.d/tftp</span>
<span class="token comment"># default: off</span>
<span class="token comment"># description: The tftp server serves files using the trivial file transfer \</span>
<span class="token comment">#       protocol.  The tftp protocol is often used to boot diskless \</span>
<span class="token comment">#       workstations, download configuration files to network-aware printers, \</span>
<span class="token comment">#       and to start the installation process for some operating systems.</span>
<span class="token function">service</span> tftp
<span class="token punctuation">&#123;</span>
        socket_type             <span class="token operator">=</span> dgram
        protocol                <span class="token operator">=</span> udp
        <span class="token function">wait</span>                    <span class="token operator">=</span> <span class="token function">yes</span>
        user                    <span class="token operator">=</span> root
        server                  <span class="token operator">=</span> /usr/sbin/in.tftpd
        server_args             <span class="token operator">=</span> <span class="token parameter variable">-s</span> /var/lib/tftpboot
        disable                 <span class="token operator">=</span> no
        per_source              <span class="token operator">=</span> <span class="token number">11</span>
        cps                     <span class="token operator">=</span> <span class="token number">100</span> <span class="token number">2</span>
        flags                   <span class="token operator">=</span> IPv4
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 这个配置文件中还有其他控制 tftp 服务器行为的选项。可用选项请查看 xinetd.conf(5) 手册页。</p>
</li>
<li><p> 在防火墙中允许 tftp 服务的进入连接：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-service=tftp</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-service=tftp --permanent</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 安装配置 DHCP 服务器 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># yum install dhcp</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/dhcp/dhcpd.conf</span>
<span class="token comment">#</span>
<span class="token comment"># DHCP Server Configuration file.</span>
<span class="token comment">#   see /usr/share/doc/dhcp*/dhcpd.conf.example</span>
<span class="token comment">#   see dhcpd.conf(5) man page</span>
<span class="token comment">#</span>

option space pxelinux<span class="token punctuation">;</span>
option pxelinux.magic code <span class="token number">208</span> <span class="token operator">=</span> string<span class="token punctuation">;</span>
option pxelinux.configfile code <span class="token number">209</span> <span class="token operator">=</span> text<span class="token punctuation">;</span>
option pxelinux.pathprefix code <span class="token number">210</span> <span class="token operator">=</span> text<span class="token punctuation">;</span>
option pxelinux.reboottime code <span class="token number">211</span> <span class="token operator">=</span> unsigned integer <span class="token number">32</span><span class="token punctuation">;</span>
option architecture-type code <span class="token number">93</span> <span class="token operator">=</span> unsigned integer <span class="token number">16</span><span class="token punctuation">;</span>
subnet <span class="token number">192.168</span>.184.0 netmask <span class="token number">255.255</span>.255.0 <span class="token punctuation">&#123;</span>
  option routers <span class="token number">192.168</span>.184.254<span class="token punctuation">;</span>
  range <span class="token number">192.168</span>.184.2 <span class="token number">192.168</span>.184.253<span class="token punctuation">;</span>
  class <span class="token string">"pxeclients"</span> <span class="token punctuation">&#123;</span>
    match <span class="token keyword">if</span> substring <span class="token punctuation">(</span>option vendor-class-identifier, <span class="token number">0</span>, <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"PXEClient"</span><span class="token punctuation">;</span>
    next-server <span class="token number">192.168</span>.184.129<span class="token punctuation">;</span>
    <span class="token keyword">if</span> option architecture-type <span class="token operator">=</span> 00:07 <span class="token punctuation">&#123;</span>
      filename <span class="token string">"uefi/shim.efi"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      filename <span class="token string">"pxelinux/pxelinux.0"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 现在您需要 shim 软件包中的 shim.efi 文件，以及 ISO 映像文件中 grub2-efi 软件包的 grubx64.efi 文件。要访问该文件，请作为 root 运行以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># mount -t iso9660 /path_to_image/name_of_image.iso /mount_point -o loop,ro</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># cp -pr /mount_point/Packages/shim-version-architecture.rpm /publicly_available_directory</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># cp -pr /mount_point/Packages/grub2-efi-version-architecture.rpm /publicly_available_directory</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># umount /mount_point</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p> 提取软件包：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># rpm2cpio shim-version-architecture.rpm | cpio -dimv</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># rpm2cpio grub2-efi-version-architecture.rpm | cpio -dimv</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 在 tftpboot&#x2F; 目录中为 EFI 引导映像创建名为 uefi&#x2F; 的目录，并从您的 boot 目录复制它们：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/lib/tftpboot/uefi</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># cp publicly_available_directory/boot/efi/EFI/redhat/shim.efi /var/lib/tftpboot/uefi/</span>
<span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># cp publicly_available_directory/boot/efi/EFI/redhat/grubx64.efi /var/lib/tftpboot/uefi/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 在 uefi&#x2F; 目录中添加名为 grub.cfg 的配置文件。<code>/var/lib/tftpboot/uefi/grub.cfg</code> 配置文件示例类似如下：  </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">timeout</span><span class="token operator">=</span><span class="token number">60</span>
menuentry <span class="token string">'RHEL 7'</span> <span class="token punctuation">&#123;</span>
  linuxefi uefi/vmlinuz <span class="token assign-left variable">ip</span><span class="token operator">=</span>dhcp <span class="token assign-left variable">inst.repo</span><span class="token operator">=</span>http://192.168.184.129/mnt/archive/RHEL-7/7.1/Server/x86_64/os/
  initrdefi uefi/initrd.img
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 将引导映像复制到您的 uefi&#x2F; 目录下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment">#  cp /path/to/x86_64/os/images/pxeboot/&#123;vmlinuz,initrd.img&#125; /var/lib/tftpboot/uefi/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 最后，如果没有运行 xinetd 和 dhcp 服务，则需要启动该服务；如果该服务已运行，则需重新载入 tftp、xinetd 和 dhcp。</p>
<p> 如果这些服务之前没有运行，则需启动这些服务：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start xinetd.service dhcpd.service</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 如果要永久启用这些服务以便每次系统重启后自动启动，则还需要执行以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rhel-7 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable xinetd.service dhcpd.service  </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 要重新载入已运行服务的配置，请使用 <code>systemctl reload</code> 命令。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PXE</category>
      </categories>
      <tags>
        <tag>pxe</tag>
      </tags>
  </entry>
  <entry>
    <title>Maintenance</title>
    <url>/blog/posts/a918773e.html</url>
    <content><![CDATA[<h1 id="Maintenance"><a href="#Maintenance" class="headerlink" title="Maintenance"></a>Maintenance</h1><p> 待机模式 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs <span class="token function">node</span> standby <span class="token operator">&lt;</span>node<span class="token operator">></span>
pcs <span class="token function">node</span> unstandby <span class="token operator">&lt;</span>node<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 维护模式 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs <span class="token function">node</span> maintenance <span class="token operator">&lt;</span>node<span class="token operator">></span>
pcs <span class="token function">node</span> unmaintenance <span class="token operator">&lt;</span>node<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 清除群集资源故障状态信息 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs cluster cleanup<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 移动群集资源 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs resource move <span class="token operator">&lt;</span>resource<span class="token operator">></span> <span class="token operator">&lt;</span>node<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<div class="note info simple"><p> 何种情况下，群集为防止脑裂会启动隔离机制 STONITH</p>
<ol>
<li> 群集节点间心跳网络故障，为防止节点争抢群集资源，会将投票数少的节点 STONITH</li>
<li> 某一节点发生故障，在资源无法正常释放情况下，为强制释放群集资源，会将该故障节点 STONITH</li>
</ol>
</div>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle database in Pacemaker</title>
    <url>/blog/posts/d6fbce00.html</url>
    <content><![CDATA[<h1 id="Oracle-database-in-Pacemaker"><a href="#Oracle-database-in-Pacemaker" class="headerlink" title="Oracle database in Pacemaker"></a>Oracle database in Pacemaker</h1><h2 id="CONFIGURING-AN-LVM-VOLUME-WITH-AN-EXT4-FILE-SYSTEM"><a href="#CONFIGURING-AN-LVM-VOLUME-WITH-AN-EXT4-FILE-SYSTEM" class="headerlink" title="CONFIGURING AN LVM VOLUME WITH AN EXT4 FILE SYSTEM"></a>CONFIGURING AN LVM VOLUME WITH AN EXT4 FILE SYSTEM</h2><ol>
<li><p>Create an LVM physical volume</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pvcreate /dev/sdb1
pvcreate /dev/sdc1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Create the volume group</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">vgcreate data_vg /dev/sdb1
vgcreate arch_vg /dev/sdc1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Create a logical volume</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lvcreate <span class="token parameter variable">-l</span> +100%FREE <span class="token parameter variable">-n</span> data_lv data_vg
lvcreate <span class="token parameter variable">-l</span> +100%FREE <span class="token parameter variable">-n</span> arch_lv arch_vg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Create an ext4 file system</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mkfs.ext4 /dev/data_vg/data_lv
mkfs.ext4 /dev/arch_vg/arch_lv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="EXCLUSIVE-ACTIVATION-OF-A-VOLUME-GROUP-IN-A-CLUSTER"><a href="#EXCLUSIVE-ACTIVATION-OF-A-VOLUME-GROUP-IN-A-CLUSTER" class="headerlink" title="EXCLUSIVE ACTIVATION OF A VOLUME GROUP IN A CLUSTER"></a>EXCLUSIVE ACTIVATION OF A VOLUME GROUP IN A CLUSTER</h2><ol>
<li><p>Execute the following command to ensure that <strong>locking_type</strong> is set to 1 and that <strong>use_lvmetad</strong> is set to 0 in the <strong>&#x2F;etc&#x2F;lvm&#x2F;lvm.conf</strong> file. This command also disables and stops any lvmetad processes immediately.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lvmconf --enable-halvm <span class="token parameter variable">--services</span> <span class="token parameter variable">--startstopservices</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Determine which volume groups are currently configured on your local storage with the following command.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># vgs --noheadings -o vg_name</span>
  arch_vg
  data_vg
  rhel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Add the volume groups other than <strong>data_vg&#x2F;arch_vg</strong> (the volume group you have just defined for the cluster) as entries to <strong>volume_list</strong> in the &#x2F;etc&#x2F;lvm&#x2F;lvm.conf configuration file.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">volume_list <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"rhel"</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Rebuild the <strong>initramfs</strong> boot image to guarantee that the boot image will not try to activate avolume group controlled by the cluster. Update the <strong>initramfs</strong> device with the following command. This command may take up to a minute to complete.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dracut <span class="token parameter variable">-H</span> <span class="token parameter variable">-f</span> /boot/initramfs-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>.img <span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Reboot the node.</p>
</li>
<li><p>Start clusterservices on each of the nodes with the following command.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs cluster start <span class="token parameter variable">--all</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="CREATING-THE-RESOURCES-AND-RESOURCE-GROUPS"><a href="#CREATING-THE-RESOURCES-AND-RESOURCE-GROUPS" class="headerlink" title="CREATING THE RESOURCES AND RESOURCE GROUPS"></a>CREATING THE RESOURCES AND RESOURCE GROUPS</h2><ol>
<li><p>Create LVM resource</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs resource create data_lvm LVM <span class="token assign-left variable">volgrpname</span><span class="token operator">=</span>data_vg <span class="token assign-left variable">exclusive</span><span class="token operator">=</span>true <span class="token parameter variable">--group</span> coco_inst_grp
pcs resource create arch_lvm LVM <span class="token assign-left variable">volgrpname</span><span class="token operator">=</span>arch_vg <span class="token assign-left variable">exclusive</span><span class="token operator">=</span>true <span class="token parameter variable">--group</span> coco_inst_grp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Create Filesystem resource</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs resource create data_fs Filesystem <span class="token punctuation">\</span>
<span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token string">"/dev/data_vg/data_lv"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"/database/datafile"</span> <span class="token assign-left variable">fstype</span><span class="token operator">=</span><span class="token string">"ext4"</span> <span class="token parameter variable">--group</span> coco_inst_grp
pcs resource create arch_fs Filesystem <span class="token punctuation">\</span>
<span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token string">"/dev/arch_vg/arch_lv"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"/database/archive"</span> <span class="token assign-left variable">fstype</span><span class="token operator">=</span><span class="token string">"ext4"</span> <span class="token parameter variable">--group</span> coco_inst_grp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Create VirtualIP resource</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs resource create VirtualIP IPaddr2 <span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token number">192.168</span>.184.149 <span class="token punctuation">\</span>
<span class="token assign-left variable">cidr_netmask</span><span class="token operator">=</span><span class="token number">24</span> <span class="token assign-left variable">nic</span><span class="token operator">=</span>ens32 <span class="token parameter variable">--group</span> coco_inst_grp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Create Oracle Database Listener resource</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs resource create coco_lsnr oralsnr <span class="token punctuation">\</span>
<span class="token assign-left variable">sid</span><span class="token operator">=</span><span class="token string">"coco"</span> <span class="token assign-left variable">home</span><span class="token operator">=</span><span class="token string">"/u01/app/oracle/product/11.2.0/db_1"</span> <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">"oracle"</span> <span class="token punctuation">\</span>
<span class="token assign-left variable">listener</span><span class="token operator">=</span><span class="token string">"LISTENER"</span> <span class="token assign-left variable">tns_admin</span><span class="token operator">=</span><span class="token string">"/u01/app/oracle/product/11.2.0/db_1/network/admin"</span> <span class="token parameter variable">--group</span> coco_inst_grp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Create Oracle Database resource</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pcs resource create coco_inst oracle <span class="token punctuation">\</span>
<span class="token assign-left variable">sid</span><span class="token operator">=</span><span class="token string">"coco"</span> <span class="token assign-left variable">home</span><span class="token operator">=</span><span class="token string">"/u01/app/oracle/product/11.2.0/db_1"</span> <span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token string">"oracle"</span> <span class="token parameter variable">--group</span> coco_inst_grp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>Ports</title>
    <url>/blog/posts/485effc9.html</url>
    <content><![CDATA[<h1 id="Ports"><a href="#Ports" class="headerlink" title="Ports"></a>Ports</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># firewall-cmd --permanent --add-service=high-availability</span>
<span class="token comment"># firewall-cmd --add-service=high-availability</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<table>
<thead>
<tr>
<th>Port</th>
<th>When Required</th>
</tr>
</thead>
<tbody><tr>
<td>TCP 2224</td>
<td>Required on all nodes (needed by the <code>pcsd</code> Web UI and required for node-to-node communication)<br><br>It is crucial to open port 2224 in such a way that <code>pcs</code> from any node can talk to all nodes in the cluster, including itself. When using the Booth cluster ticket manager or a quorum device you must open port 2224 on all related hosts, such as Booth arbiters or the quorum device host.</td>
</tr>
<tr>
<td>TCP 3121</td>
<td>Required on all nodes if the cluster has any Pacemaker Remote nodes<br><br>Pacemaker’s <code>crmd</code> daemon on the full cluster nodes will contact the <code>pacemaker_remoted</code> daemon on Pacemaker Remote nodes at port 3121. If a separate interface is used for cluster communication, the port only needs to be open on that interface. At a minimum, the port should open on Pacemaker Remote nodes to full cluster nodes. Because users may convert a host between a full node and a remote node, or run a remote node inside a container using the host’s network, it can be useful to open the port to all nodes. It is not necessary to open the port to any hosts other than nodes.</td>
</tr>
<tr>
<td>TCP 5403</td>
<td>Required on the quorum device host when using a quorum device with <code>corosync-qnetd</code>. The default value can be changed with the <code>-p</code> option of the <code>corosync-qnetd</code> command.</td>
</tr>
<tr>
<td>UDP 5404</td>
<td>Required on corosync nodes if <code>corosync</code> is configured for multicast UDP</td>
</tr>
<tr>
<td>UDP 5405</td>
<td>Required on all corosync nodes (needed by <code>corosync</code>)</td>
</tr>
<tr>
<td>TCP 21064</td>
<td>Required on all nodes if the cluster contains any resources requiring DLM (such as <code>clvm</code> or <code>GFS2</code>)</td>
</tr>
<tr>
<td>TCP 9929, UDP 9929</td>
<td>Required to be open on all cluster nodes and booth arbitrator nodes to connections from any of those same nodes when the Booth ticket manager is used to establish a multi-site cluster.</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Pacemaker</category>
      </categories>
      <tags>
        <tag>pacemaker</tag>
      </tags>
  </entry>
  <entry>
    <title>File Archive</title>
    <url>/blog/posts/2c6685ff.html</url>
    <content><![CDATA[<h1 id="File-Archive"><a href="#File-Archive" class="headerlink" title="File Archive"></a>File Archive</h1><p> 归档 1 天前的文件，并将原文件删除。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token function">find</span> /log/ <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">'file_*'</span> <span class="token parameter variable">-atime</span> <span class="token parameter variable">-1</span> <span class="token parameter variable">-exec</span> <span class="token function">mv</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> /log/bak/ <span class="token punctuation">\</span><span class="token punctuation">;</span>
<span class="token function">tar</span> <span class="token parameter variable">-zcf</span> /log/bak_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%H%M%S<span class="token variable">`</span></span>.tar.gz <span class="token parameter variable">-P</span> /log/bak/

<span class="token function">rm</span> <span class="token parameter variable">-f</span> /l/bak/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>echo_color</title>
    <url>/blog/posts/92f698f7.html</url>
    <content><![CDATA[<h1 id="echo-color"><a href="#echo-color" class="headerlink" title="echo_color"></a>echo_color</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token assign-left variable">ecred</span><span class="token operator">=</span><span class="token string">'\033[0;31m'</span>
<span class="token assign-left variable">ecyellow</span><span class="token operator">=</span><span class="token string">'\033[0;33m'</span>
<span class="token assign-left variable">ecgreen</span><span class="token operator">=</span><span class="token string">'\033[32m'</span>
<span class="token assign-left variable">ecend</span><span class="token operator">=</span><span class="token string">'\033[0m'</span>

<span class="token function-name function">echo_red</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">$&#123;ecred&#125;</span><span class="token variable">$@</span><span class="token variable">$&#123;ecend&#125;</span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token function-name function">echo_yellow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">$&#123;ecyellow&#125;</span><span class="token variable">$@</span><span class="token variable">$&#123;ecend&#125;</span>"</span>
<span class="token punctuation">&#125;</span>

<span class="token function-name function">echo_green</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">$&#123;ecgreen&#125;</span><span class="token variable">$@</span><span class="token variable">$&#123;ecend&#125;</span>"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong> 格式解析 </strong></p>
<p>@<a href="https://s2.loli.net/2022/07/08/LqJ8Dch6GHlQjYt.png"></a></p>
<p><strong>Colors Reference</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> 字颜色：30—–37
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>30m 黑色字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>31m 红色字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>32m 绿色字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>33m 黄色字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>34m 蓝色字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>35m 紫色字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>36m 天蓝字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span>37m 白色字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”

字背景颜色范围：40—–47
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">;</span>37m 黑底白字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">;</span>37m 红底白字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">;</span>37m 绿底白字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">;</span>37m 黄底白字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">44</span><span class="token punctuation">;</span>37m 蓝底白字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">45</span><span class="token punctuation">;</span>37m 紫底白字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">;</span>37m 天蓝底白字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”
　　<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> “<span class="token punctuation">\</span>033<span class="token punctuation">[</span><span class="token number">47</span><span class="token punctuation">;</span>30m 白底黑字 <span class="token punctuation">\</span>033<span class="token punctuation">[</span>0m”

最后面控制选项说明
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>0m 关闭所有属性
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>1m 设置高亮度
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>4m 下划线
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>5m 闪烁
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>7m 反显
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>8m 消隐
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>30m — <span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>37m 设置前景色
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>40m — <span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>47m 设置背景色
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>nA 光标上移 n 行
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>nB 光标下移 n 行
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>nC 光标右移 n 行
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>nD 光标左移 n 行
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>y<span class="token punctuation">;</span>xH 设置光标位置
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>2J 清屏
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>K 清除从光标到行尾的内容
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>s 保存光标位置
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>u 恢复光标位置
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>?25l 隐藏光标
　　<span class="token punctuation">\</span><span class="token number">33</span><span class="token punctuation">[</span>?25h 显示光标 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>oracle_11g_setup</title>
    <url>/blog/posts/333e3a3a.html</url>
    <content><![CDATA[<h1 id="oracle-11g-setup"><a href="#oracle-11g-setup" class="headerlink" title="oracle_11g_setup"></a>oracle_11g_setup</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /usr/bin/env bash</span>
<span class="token comment"># set -e  Exit immediately if a command exits with a non-zero status.</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

<span class="token builtin class-name">source</span> /assets/colorecho
<span class="token builtin class-name">trap</span> <span class="token string">"echo_red'******* ERROR: Something went wrong.'; exit 1"</span> SIGTERM
<span class="token builtin class-name">trap</span> <span class="token string">"echo_red'******* Caught SIGINT signal. Stopping...'; exit 2"</span> SIGINT

<span class="token comment">#Install prerequisites directly without virtual package</span>
<span class="token function-name function">deps</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Installing dependencies"</span>
  yum <span class="token parameter variable">-y</span> <span class="token function">install</span> binutils compat-libstdc++-33 compat-libstdc++-33.i686 <span class="token punctuation">\</span>
  ksh elfutils-libelf elfutils-libelf-devel glibc glibc-common glibc-devel <span class="token punctuation">\</span>
  gcc gcc-c++ libaio libaio.i686 libaio-devel libaio-devel.i686 libgcc libstdc++ <span class="token punctuation">\</span>
  libstdc++.i686 libstdc++-devel libstdc++-devel.i686 <span class="token function">make</span> sysstat unixODBC unixODBC-devel
  yum clean all
  <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/<span class="token punctuation">&#123;</span>cache,log<span class="token punctuation">&#125;</span> /var/log/lastlog
<span class="token punctuation">&#125;</span>

<span class="token function-name function">create_users</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Configuring users"</span>
  <span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">500</span> oinstall
  <span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">501</span> dba
  <span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">500</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba oracle
  <span class="token builtin class-name">echo</span> <span class="token string">"oracle:oracle"</span> <span class="token operator">|</span> chpasswd
  <span class="token builtin class-name">echo</span> <span class="token string">"root:welcome"</span> <span class="token operator">|</span> chpasswd
  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-m</span> <span class="token number">755</span> /u01/app/oracle
  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-m</span> <span class="token number">755</span> /u01/app/oraInventory
  <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-m</span> <span class="token number">755</span> /u01/app/dpdump
  <span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01/app
  <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">"s/pam_namespace.so/pam_namespace.so<span class="token entity"title="\n">\n</span>session    required     pam_limits.so/g"</span> /etc/pam.d/login
  <span class="token function">cat</span> /assets/profile <span class="token operator">>></span> ~oracle/.bash_profile
  <span class="token function">cat</span> /assets/profile <span class="token operator">>></span> ~oracle/.bashrc
<span class="token punctuation">&#125;</span>

<span class="token function-name function">sysctl_and_limits</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">cat</span> /assets/sysctl.conf <span class="token operator">>></span> /etc/sysctl.conf
  <span class="token function">cat</span> /assets/limits.conf <span class="token operator">>></span> /etc/security/limits.conf
<span class="token punctuation">&#125;</span>

deps
create_users
sysctl_and_limits<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux Commands</title>
    <url>/blog/posts/1c8267d6.html</url>
    <content><![CDATA[<h1 id="Linux-Commands"><a href="#Linux-Commands" class="headerlink" title="Linux Commands"></a>Linux Commands</h1><p>Repalce <code>CRLF</code> to <code>LF</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/\r//g'</span> filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Replace filename <code>SPACE</code> to <code>-</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> *<span class="token punctuation">\</span> *<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">mv</span> <span class="token string">"<span class="token variable">$f</span>"</span> <span class="token string">"<span class="token variable">$&#123;f<span class="token operator">/</span><span class="token operator">/</span> <span class="token operator">/</span>-&#125;</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>lsb_functions</title>
    <url>/blog/posts/2debbdbd.html</url>
    <content><![CDATA[<h1 id="lsb-functions"><a href="#lsb-functions" class="headerlink" title="lsb_functions"></a>lsb_functions</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#</span>
<span class="token comment"># Use LSB init script functions for printing messages, if possible</span>
<span class="token comment">#</span>
<span class="token assign-left variable">lsb_functions</span><span class="token operator">=</span><span class="token string">"/lib/lsb/init-functions"</span>
<span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-f</span> <span class="token variable">$lsb_functions</span> <span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">.</span> <span class="token variable">$lsb_functions</span>
<span class="token keyword">else</span>
  <span class="token comment"># Include non-LSB Redhat init functions to make systemctl redirect work</span>
  <span class="token assign-left variable">init_functions</span><span class="token operator">=</span><span class="token string">"/etc/init.d/functions"</span>
  <span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-f</span> <span class="token variable">$init_functions</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">.</span> <span class="token variable">$init_functions</span>
  <span class="token keyword">fi</span>
  <span class="token function-name function">log_success_msg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"SUCCESS! <span class="token variable">$@</span>"</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function-name function">log_failure_msg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"ERROR! <span class="token variable">$@</span>"</span>
  <span class="token punctuation">&#125;</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ping</title>
    <url>/blog/posts/25d53dfd.html</url>
    <content><![CDATA[<p> 检测某个网段的 IP 地址是否可达。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">254</span><span class="token punctuation">&#125;</span>
<span class="token keyword">do</span>
<span class="token punctuation">&#123;</span>
 <span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">1</span> <span class="token number">192.168</span>.0.<span class="token variable">$&#123;i&#125;</span> <span class="token operator">&amp;></span> /dev/null <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"192.168.0.<span class="token variable">$&#123;i&#125;</span> is alive"</span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"192.168.0.<span class="token variable">$&#123;i&#125;</span> is down"</span>
<span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span>
<span class="token keyword">done</span>
<span class="token function">wait</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>wait</code> - Wait for job completion and return exit status.</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Shell</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>dracut initqueue swap does not exist</title>
    <url>/blog/posts/23f36911.html</url>
    <content><![CDATA[<h1 id="dracut-initqueue-swap-does-not-exist"><a href="#dracut-initqueue-swap-does-not-exist" class="headerlink" title="dracut initqueue swap does not exist"></a>dracut initqueue swap does not exist</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.4</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p><font color=error>[198.935138] dracut-initqueue[310]: Warning: Could not boot.<br>[198.971675] dracut-initqueue[310]: Warning: &#x2F;dev&#x2F;ol&#x2F;swap does not exist<br>Starting Dracut Emergency Shell…<br>Warning: &#x2F;dev&#x2F;ol&#x2F;swap does not exist</font></p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-19-00.png"></p>
<h2 id="CASE"><a href="#CASE" class="headerlink" title="CASE"></a>CASE</h2><p>The logical volume &#x2F;dev&#x2F;ol&#x2F;swap was lost or not exist.</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><h3 id="Method-1"><a href="#Method-1" class="headerlink" title="Method 1"></a>Method 1</h3><ol>
<li><p>Type <code>blkid</code> to list device information.</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-21-55.png"></p>
</li>
<li><p>Mount <code>sysroot</code>.</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-25-23.png"></p>
</li>
<li><p>Mount <code>boot</code>.</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-27-08.png"></p>
</li>
<li><p>Changing the default boot entry.</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-31-17.png"></p>
</li>
<li><p>Chanaging the the grub.cfg file.</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-34-48.png" alt="before"></p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-36-49.png" alt="after"></p>
</li>
<li><p>Reboot system.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dracut:/<span class="token comment"># init 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h3 id="Method-2-Recommended"><a href="#Method-2-Recommended" class="headerlink" title="Method 2 (Recommended)"></a>Method 2 (Recommended)</h3><ol>
<li><p>Reboot system.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dracut:/<span class="token comment"># init 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Press <code>e</code> to modify grub menu entries.</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-49-01.png"></p>
</li>
<li><p>Remove <code>rd.lvm.lv=ol/swap</code> parameter in the <code>linux16</code> line</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-50-11.png" alt="before"></p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-50-34.png" alt="after"></p>
</li>
<li><p>Press <code>Crtl-x</code> to boot system.</p>
</li>
<li><p>Make a backup for grub file.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-a</span> /etc/default/grub<span class="token punctuation">&#123;</span>,.bak<span class="token punctuation">&#125;</span>
<span class="token function">cp</span> <span class="token parameter variable">-a</span> /boot/grub2/grub.cfg<span class="token punctuation">&#123;</span>,.bak<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Changing the default boot entry, and rebuilding the grub.cfg file</p>
<p><img src="/blog/assets/pic/2023/06/15/2023-06-15_10-52-32.png"></p>
</li>
<li><p>Reboot system.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>dracut</tag>
      </tags>
  </entry>
  <entry>
    <title>hacmp extendvg</title>
    <url>/blog/posts/b517c7c1.html</url>
    <content><![CDATA[<h1 id="hacmp-extendvg"><a href="#hacmp-extendvg" class="headerlink" title="hacmp extendvg"></a>hacmp extendvg</h1><pre class="line-numbers language-ksh" data-language="ksh"><code class="language-ksh">smitty hacmp
-&gt; System Management (C-SPOC)
-&gt; Storage
-&gt; Logical Volumes
-&gt; Add a Logical Volume
-&gt; &lt;pacsdatavg&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Unix</category>
        <category>AIX</category>
      </categories>
      <tags>
        <tag>hacmp</tag>
      </tags>
  </entry>
  <entry>
    <title>Found Duplicate PV</title>
    <url>/blog/posts/cf80567.html</url>
    <content><![CDATA[<h1 id="Found-Duplicate-PV"><a href="#Found-Duplicate-PV" class="headerlink" title="Found Duplicate PV"></a>Found Duplicate PV</h1><h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>存储 LUN 做 LVM，执行 <code>pvs</code> 命令时，出现如下报错：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># pvs</span>
Found duplicate PV gdJ3qQtqoOjwZs2dtFw9vP0zIpz0HQhj: using /dev/sdba not /dev/emcpowerai
Found duplicate PV 8jLc3hNNwiSnGz4fEEasw8PQwthrGBpO: using /dev/sdbq not /dev/emcpowers
Found duplicate PV BY29XsIxW1I4LUOcoqAepnG7eGUcPxZl: using /dev/emcpoweru not /dev/sdbo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CASE"><a href="#CASE" class="headerlink" title="CASE"></a>CASE</h2><p>在默认配置下，LVM 对所有磁盘进行扫描，以确定哪一块上面包含 PV。如果使用了 device-mapper-multipath 或其他多路径软件如 EMC PowerPath 或 Hitachi Dynamic Link Manager (HDLM)，那么对于每一个 LUN 的每一条路径就注册成为一个不同的 SCSI 设备。如 &#x2F;dev&#x2F;sdb，&#x2F;dev&#x2F;sdc，等等。多路径软件之后会创建一个新的设备映射到这些路径如：&#x2F;dev&#x2F;mapper&#x2F;mpath1 (device-mapper-multipath)，&#x2F;dev&#x2F;emcpowerb (EMC PowerPath)，或 &#x2F;dev&#x2F;sddlmab (HDLM)。由于每一个设备都指向同一个 LUN，所以它们都包含相同的 LVM 元数据，因此在扫描时显示为 duplicate。运行任何 LVM 命令，都会出现重复 PV 告警。</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>要确保 LVM 只扫描想要的多路径设备而不是单条路径，需要在 <code>/etc/lvm/lvm.conf</code> 文件中加上过滤条件，格式如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Example</span>
<span class="token comment"># Accept every block device:</span>
<span class="token comment"># filter = ["a|.*|"]</span>
<span class="token comment"># Reject the cdrom drive:</span>
<span class="token comment"># filter = ["r|/dev/cdrom|"]</span>
<span class="token comment"># Work with just loopback devices, e.g. for testing:</span>
<span class="token comment"># filter = ["a|loop|", "r|.*|"]</span>
<span class="token comment"># Accept all loop devices and ide drives except hdc:</span>
<span class="token comment"># filter = ["a|loop|", "r|/dev/hdc|", "a|/dev/ide|", "r|.*|"]</span>
<span class="token comment"># Use anchors to be very specific:</span>
<span class="token comment"># filter = ["a|^/dev/hda8$|", "r|.*|"]</span>
<span class="token comment">#</span>
<span class="token comment"># This configuration option has an automatic default value.</span>
<span class="token comment"># filter = ["a|.*|"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>过滤语法接收多重条件。形式如 “a” (add) or “r” (remove)，中间以逗号为间隔。所有符合 add 条件的设备都会被扫描，同时忽略所有符合 remove 条件的设备。<br>注意：如果本地存储设备包含物理卷，确保除了多路径设备外，这些设备也包含在过滤条件中。<br>比如，只扫描 device-mapper-multipath 设备：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">filter <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"a|/dev/mapper/mpath.*|"</span>, <span class="token string">"r|.*|"</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>只扫描 EMC PowerPath 设备:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">filter <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">"a|/dev/emcpower.*|"</span>, <span class="token string">"r|.*|"</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Linux</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>lvm</tag>
      </tags>
  </entry>
  <entry>
    <title>Replace harddisk for rootvg</title>
    <url>/blog/posts/22af3e09.html</url>
    <content><![CDATA[<h1 id="Replace-harddisk-for-rootvg"><a href="#Replace-harddisk-for-rootvg" class="headerlink" title="Replace harddisk for rootvg"></a>Replace harddisk for rootvg</h1><ol>
<li><p>查看系统故障日志，确定故障硬盘信息</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:taadm<span class="token punctuation">]</span> /home/taadm<span class="token operator">></span> errpt
IDENTIFIER TIMESTAMP  T C RESOURCE_NAME  DESCRIPTION
EAA3D429   <span class="token number">1113051522</span> U S LVDD           PHYSICAL PARTITION MARKED STALE
E86653C3   <span class="token number">1113051522</span> P H LVDD           I/O ERROR DETECTED BY LVM
B6267342   <span class="token number">1113051522</span> P H hdisk0         DISK OPERATION ERROR

<span class="token punctuation">[</span>TRDGMES1:taadm<span class="token punctuation">]</span> /home/taadm<span class="token operator">></span> errpt <span class="token parameter variable">-aj</span> B6267342
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Diagnostic Analysis
Diagnostic Log sequence number: <span class="token number">2639</span>
Resource tested:        hdisk0
Resource Description:   SAS Disk Drive
Location:               U78AA.001.WZSKPLU-P2-D1
SRN:                    <span class="token number">2672</span>-128
Description:            Error log analysis indicates a hardware failure.
Possible FRUs:
hdisk0      FRU: 00E6167      U78AA.001.WZSKPLU-P2-D1      SAS Disk Drive

<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lscfg -vl hdisk0</span>
hdisk0           U78AA.001.WZSKPLU-P2-D1  SAS Disk Drive <span class="token punctuation">(</span><span class="token number">300000</span> MB<span class="token punctuation">)</span>
Manufacturer<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>IBM     
Machine Type and Model<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>HUC109030CSS600 
FRU Number<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>00E6167     
ROS Level and ID<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token number">45354336</span>
Serial Number<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.KFGK2XER
EC Level<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>L37106    
Part Number<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.74Y9268     
Device Specific.<span class="token punctuation">(</span>Z0<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>000006329F011002
Device Specific.<span class="token punctuation">(</span>Z1<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>CEIPE5C6    
Device Specific.<span class="token punctuation">(</span>Z2<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>00SS
Device Specific.<span class="token punctuation">(</span>Z3<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token number">14156</span>
Device Specific.<span class="token punctuation">(</span>Z4<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Device Specific.<span class="token punctuation">(</span>Z5<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token number">22</span>
Device Specific.<span class="token punctuation">(</span>Z6<span class="token punctuation">)</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>L37510    
Hardware Location Code<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>U78AA.001.WZSKPLU-P2-D1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查看系统启动逻辑卷</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#bootlist -m normal -o</span>
hdisk0 <span class="token assign-left variable">blv</span><span class="token operator">=</span>hd5 <span class="token assign-left variable">pathid</span><span class="token operator">=</span><span class="token number">0</span>
hdisk1 <span class="token assign-left variable">blv</span><span class="token operator">=</span>hd5 <span class="token assign-left variable">pathid</span><span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>检查 rootvg 卷组状态信息</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg rootvg</span>
VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf
VG STATE:           active                   PP SIZE:        <span class="token number">512</span> megabyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
VG PERMISSION:      read/write               TOTAL PPs:      <span class="token number">1116</span> <span class="token punctuation">(</span><span class="token number">571392</span> megabytes<span class="token punctuation">)</span>
MAX LVs:            <span class="token number">256</span>                      FREE PPs:       <span class="token number">520</span> <span class="token punctuation">(</span><span class="token number">266240</span> megabytes<span class="token punctuation">)</span>
LVs:                <span class="token number">15</span>                       USED PPs:       <span class="token number">596</span> <span class="token punctuation">(</span><span class="token number">305152</span> megabytes<span class="token punctuation">)</span>
OPEN LVs:           <span class="token number">14</span>                       QUORUM:         <span class="token number">1</span> <span class="token punctuation">(</span>Disabled<span class="token punctuation">)</span>
TOTAL PVs:          <span class="token number">2</span>                        VG DESCRIPTORS: <span class="token number">3</span>
STALE PVs:          <span class="token number">1</span>                        STALE PPs:      <span class="token number">1</span>
ACTIVE PVs:         <span class="token number">2</span>                        AUTO ON:        <span class="token function">yes</span>
MAX PPs per VG:     <span class="token number">32512</span>                                     
MAX PPs per PV:     <span class="token number">1016</span>                     MAX PVs:        <span class="token number">32</span>
LTG size <span class="token punctuation">(</span>Dynamic<span class="token punctuation">)</span>: <span class="token number">1024</span> kilobyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>         AUTO SYNC:      no
HOT SPARE:          no                       BB POLICY:      relocatable 
PV RESTRICTION:     none                     INFINITE RETRY: no
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg -p rootvg</span>
rootvg:
PV_NAME           PV STATE          TOTAL PPs   FREE PPs    FREE DISTRIBUTION
hdisk0            active            <span class="token number">558</span>         <span class="token number">250</span>         <span class="token number">111</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">27</span><span class="token punctuation">..</span><span class="token number">112</span>
hdisk1            active            <span class="token number">558</span>         <span class="token number">270</span>         <span class="token number">111</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">47</span><span class="token punctuation">..</span><span class="token number">112</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg -l rootvg</span>
rootvg:
LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT
hd5                 boot       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    closed/syncd  N/A
hd6                 paging     <span class="token number">32</span>      <span class="token number">64</span>      <span class="token number">2</span>    open/syncd    N/A
hd8                 jfs2log    <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    N/A
hd4                 jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /
hd2                 jfs2       <span class="token number">30</span>      <span class="token number">60</span>      <span class="token number">2</span>    open/syncd    /usr
hd9var              jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /var
hd3                 jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /tmp
hd1                 jfs2       <span class="token number">120</span>     <span class="token number">240</span>     <span class="token number">2</span>    open/stale    /home
hd10opt             jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /opt
hd11admin           jfs2       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    /admin
lg_dumplv           sysdump    <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    N/A
livedump            jfs2       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    /var/adm/ras/livedump
loglv00             jfslog     <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    N/A
lv00                jfs        <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    /var/adm/csd
fslv00              jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /isc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看到 rootvg 卷组中存在 1 个过期的 STALE PPs。卷组的 LPs:PPs 为 1:2 处于镜像中。</p>
</li>
<li><p>查看卷组的物理卷状态</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lspv hdisk0</span>
PHYSICAL VOLUME:    hdisk0                   VOLUME GROUP:     rootvg
PV IDENTIFIER:      00f9838959802512 VG IDENTIFIER     00f9838900004c0000000149a2d111cf
PV STATE:           active                                     
STALE PARTITIONS:   <span class="token number">1</span>                        ALLOCATABLE:      <span class="token function">yes</span>
PP SIZE:            <span class="token number">512</span> megabyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>          LOGICAL VOLUMES:  <span class="token number">15</span>
TOTAL PPs:          <span class="token number">558</span> <span class="token punctuation">(</span><span class="token number">285696</span> megabytes<span class="token punctuation">)</span>   VG DESCRIPTORS:   <span class="token number">2</span>
FREE PPs:           <span class="token number">250</span> <span class="token punctuation">(</span><span class="token number">128000</span> megabytes<span class="token punctuation">)</span>   HOT SPARE:        no
USED PPs:           <span class="token number">308</span> <span class="token punctuation">(</span><span class="token number">157696</span> megabytes<span class="token punctuation">)</span>   MAX REQUEST:      <span class="token number">1</span> megabyte
FREE DISTRIBUTION:  <span class="token number">111</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">27</span><span class="token punctuation">..</span><span class="token number">112</span>                       
USED DISTRIBUTION:  01<span class="token punctuation">..</span><span class="token number">112</span><span class="token punctuation">..</span><span class="token number">111</span><span class="token punctuation">..</span><span class="token number">84</span><span class="token punctuation">..</span>00                       
MIRROR POOL:        None                                       
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#  </span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lspv hdisk1</span>
PHYSICAL VOLUME:    hdisk1                   VOLUME GROUP:     rootvg
PV IDENTIFIER:      00f98389cb6fdbfe VG IDENTIFIER     00f9838900004c0000000149a2d111cf
PV STATE:           active                                     
STALE PARTITIONS:   <span class="token number">0</span>                        ALLOCATABLE:      <span class="token function">yes</span>
PP SIZE:            <span class="token number">512</span> megabyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>          LOGICAL VOLUMES:  <span class="token number">14</span>
TOTAL PPs:          <span class="token number">558</span> <span class="token punctuation">(</span><span class="token number">285696</span> megabytes<span class="token punctuation">)</span>   VG DESCRIPTORS:   <span class="token number">1</span>
FREE PPs:           <span class="token number">270</span> <span class="token punctuation">(</span><span class="token number">138240</span> megabytes<span class="token punctuation">)</span>   HOT SPARE:        no
USED PPs:           <span class="token number">288</span> <span class="token punctuation">(</span><span class="token number">147456</span> megabytes<span class="token punctuation">)</span>   MAX REQUEST:      <span class="token number">1</span> megabyte
FREE DISTRIBUTION:  <span class="token number">111</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">47</span><span class="token punctuation">..</span><span class="token number">112</span>                       
USED DISTRIBUTION:  01<span class="token punctuation">..</span><span class="token number">112</span><span class="token punctuation">..</span><span class="token number">111</span><span class="token punctuation">..</span><span class="token number">64</span><span class="token punctuation">..</span>00                       
MIRROR POOL:        None                                       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>过期的 STALE PPs 位于物理卷 hdisk0，即故障盘 hdisk0，因此无需处理。否则需要执行物理卷同步命令<code>syncvg –p hdisk0 hdisk1</code></p>
</li>
<li><p>迁移 sysdump 设备</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lspv -l hdisk0</span>
hdisk0:
LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT
hd10opt               <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /opt
hd2                   <span class="token number">30</span>      <span class="token number">30</span>      00<span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /usr
hd9var                <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /var
hd3                   <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /tmp
hd1                   <span class="token number">120</span>     <span class="token number">120</span>     00<span class="token punctuation">..</span><span class="token number">27</span><span class="token punctuation">..</span>09<span class="token punctuation">..</span><span class="token number">84</span><span class="token punctuation">..</span>00    /home
hd5                   <span class="token number">1</span>       <span class="token number">1</span>       01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
hd6                   <span class="token number">32</span>      <span class="token number">32</span>      00<span class="token punctuation">..</span><span class="token number">32</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
hd8                   <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
hd4                   <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /
hd11admin             <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /admin
lg_dumplv             <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
livedump              <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /var/adm/ras/livedump
loglv00               <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
lv00                  <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /var/adm/csd
fslv00                <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /isc
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#migratepv -l lg_dumplv hdisk0 hdisk1</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lspv -l hdisk1</span>
hdisk1:
LV NAME               LPs     PPs     DISTRIBUTION          MOUNT POINT
hd10opt               <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /opt
hd2                   <span class="token number">30</span>      <span class="token number">30</span>      00<span class="token punctuation">..</span>01<span class="token punctuation">..</span><span class="token number">29</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /usr
hd9var                <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /var
hd3                   <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /tmp
hd1                   <span class="token number">120</span>     <span class="token number">120</span>     00<span class="token punctuation">..</span><span class="token number">36</span><span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span><span class="token number">64</span><span class="token punctuation">..</span>00    /home
hd5                   <span class="token number">1</span>       <span class="token number">1</span>       01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
hd6                   <span class="token number">32</span>      <span class="token number">32</span>      00<span class="token punctuation">..</span><span class="token number">32</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
hd8                   <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
hd4                   <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span>00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /
hd11admin             <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /admin
lg_dumplv             <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
livedump              <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /var/adm/ras/livedump
loglv00               <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    N/A
lv00                  <span class="token number">1</span>       <span class="token number">1</span>       00<span class="token punctuation">..</span>01<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /var/adm/csd
fslv00                <span class="token number">20</span>      <span class="token number">20</span>      00<span class="token punctuation">..</span><span class="token number">20</span><span class="token punctuation">..</span>00<span class="token punctuation">..</span>00<span class="token punctuation">..</span>00    /isc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>取消卷组 rootvg 镜像，移除物理卷 hdisk0</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#unmirrorvg rootvg hdisk0</span>
0516-1246 rmlvcopy: If hd5 is the boot logical volume, please run <span class="token string">'chpv -c &lt;diskname>'</span>
     as root user to <span class="token function">clear</span> the boot record and avoid a potential boot
     off an old boot image that may reside on the disk from <span class="token function">which</span> this
     logical volume is moved/removed.
0516-1804 chvg: The quorum change takes effect immediately.
0516-1144 unmirrorvg: rootvg successfully unmirrored, user should perform
     bosboot of system to reinitialize boot records.  Then, user must modify
     bootlist to just include:  hdisk1.
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg rootvg</span>
VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf
VG STATE:           active                   PP SIZE:        <span class="token number">512</span> megabyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
VG PERMISSION:      read/write               TOTAL PPs:      <span class="token number">1116</span> <span class="token punctuation">(</span><span class="token number">571392</span> megabytes<span class="token punctuation">)</span>
MAX LVs:            <span class="token number">256</span>                      FREE PPs:       <span class="token number">808</span> <span class="token punctuation">(</span><span class="token number">413696</span> megabytes<span class="token punctuation">)</span>
LVs:                <span class="token number">15</span>                       USED PPs:       <span class="token number">308</span> <span class="token punctuation">(</span><span class="token number">157696</span> megabytes<span class="token punctuation">)</span>
OPEN LVs:           <span class="token number">14</span>                       QUORUM:         <span class="token number">2</span> <span class="token punctuation">(</span>Enabled<span class="token punctuation">)</span>
TOTAL PVs:          <span class="token number">2</span>                        VG DESCRIPTORS: <span class="token number">3</span>
STALE PVs:          <span class="token number">0</span>                        STALE PPs:      <span class="token number">0</span>
ACTIVE PVs:         <span class="token number">2</span>                        AUTO ON:        <span class="token function">yes</span>
MAX PPs per VG:     <span class="token number">32512</span>                                     
MAX PPs per PV:     <span class="token number">1016</span>                     MAX PVs:        <span class="token number">32</span>
LTG size <span class="token punctuation">(</span>Dynamic<span class="token punctuation">)</span>: <span class="token number">1024</span> kilobyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>         AUTO SYNC:      no
HOT SPARE:          no                       BB POLICY:      relocatable 
PV RESTRICTION:     none                     INFINITE RETRY: no
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg -l rootvg</span>
rootvg:
LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT
hd5                 boot       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>    closed/syncd  N/A
hd6                 paging     <span class="token number">32</span>      <span class="token number">32</span>      <span class="token number">1</span>    open/syncd    N/A
hd8                 jfs2log    <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>    open/syncd    N/A
hd4                 jfs2       <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    /
hd2                 jfs2       <span class="token number">30</span>      <span class="token number">30</span>      <span class="token number">1</span>    open/syncd    /usr
hd9var              jfs2       <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    /var
hd3                 jfs2       <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    /tmp
hd1                 jfs2       <span class="token number">120</span>     <span class="token number">120</span>     <span class="token number">1</span>    open/syncd    /home
hd10opt             jfs2       <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    /opt
hd11admin           jfs2       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>    open/syncd    /admin
lg_dumplv           sysdump    <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    N/A
livedump            jfs2       <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>    open/syncd    /var/adm/ras/livedump
loglv00             jfslog     <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>    open/syncd    N/A
lv00                jfs        <span class="token number">1</span>       <span class="token number">1</span>       <span class="token number">1</span>    open/syncd    /var/adm/csd
fslv00              jfs2       <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    /isc
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#reducevg rootvg hdisk0</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#chpv -c hdisk0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>使用 <code>diag</code> 命令进行硬盘热拔插更换，或使用 <code>rmdev -dl hdisk0</code> 删除硬盘。<br>参考链接：<a href="https://www.ibm.com/docs/en/power6?topic=rdd-replacing-disk-drive-aix-system-logical-partition-powered">Replacing a disk drive with the AIX system or logical partition powered on</a></p>
<p>更换时可能遇到进程占用导致磁盘忙问题，可根据实际情况杀掉占用进程。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#fuser /dev/hdisk0</span>
/dev/hdisk0:  <span class="token number">22282522</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#proctree 22282522</span>
<span class="token number">22282522</span>    /usr/bin/topas_nmon  <span class="token parameter variable">-f</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-T</span> -^ <span class="token parameter variable">-J</span> <span class="token parameter variable">-s</span> <span class="token number">300</span> <span class="token parameter variable">-c</span> <span class="token number">288</span> <span class="token parameter variable">-youtput_dir</span><span class="token operator">=</span>/KIC/LOG/NMON/TR
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#kill -9 22282522</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#fuser /dev/hdisk0</span>
/dev/hdisk0: <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>重新配置卷组 rootvg 镜像</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#cfgmgr -v</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lspv</span>
hdisk0          none                                None                        
hdisk1          00f98389cb6fdbfe                    rootvg          active      
hdisk2          00f98389ad9cf4af                    None                        
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#chdev -l hdisk0 -a pv=yes</span>
hdisk0 changed 
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#extendvg rootvg hdisk0</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lspv</span>
hdisk0          00f983897ac05ab6                    rootvg          active      
hdisk1          00f98389cb6fdbfe                    rootvg          active      
hdisk2          00f98389ad9cf4af                    None              
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#mirrorvg -S rootvg hdisk0</span>
0516-1804 chvg: The quorum change takes effect immediately.
0516-1126 mirrorvg: rootvg successfully mirrored, user should perform
        bosboot of system to initialize boot records.  Then, user must modify
        bootlist to include:  hdisk0 hdisk1.
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg rootvg</span>
VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf
VG STATE:           active                   PP SIZE:        <span class="token number">512</span> megabyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
VG PERMISSION:      read/write               TOTAL PPs:      <span class="token number">1116</span> <span class="token punctuation">(</span><span class="token number">571392</span> megabytes<span class="token punctuation">)</span>
MAX LVs:            <span class="token number">256</span>                      FREE PPs:       <span class="token number">520</span> <span class="token punctuation">(</span><span class="token number">266240</span> megabytes<span class="token punctuation">)</span>
LVs:                <span class="token number">15</span>                       USED PPs:       <span class="token number">596</span> <span class="token punctuation">(</span><span class="token number">305152</span> megabytes<span class="token punctuation">)</span>
OPEN LVs:           <span class="token number">15</span>                       QUORUM:         <span class="token number">1</span> <span class="token punctuation">(</span>Disabled<span class="token punctuation">)</span>
TOTAL PVs:          <span class="token number">2</span>                        VG DESCRIPTORS: <span class="token number">3</span>
STALE PVs:          <span class="token number">1</span>                        STALE PPs:      <span class="token number">288</span>
ACTIVE PVs:         <span class="token number">2</span>                        AUTO ON:        <span class="token function">yes</span>
MAX PPs per VG:     <span class="token number">32512</span>                                     
MAX PPs per PV:     <span class="token number">1016</span>                     MAX PVs:        <span class="token number">32</span>
LTG size <span class="token punctuation">(</span>Dynamic<span class="token punctuation">)</span>: <span class="token number">1024</span> kilobyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>         AUTO SYNC:      no
HOT SPARE:          no                       BB POLICY:      relocatable 
PV RESTRICTION:     none                     INFINITE RETRY: no
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg -l rootvg</span>
rootvg:
LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT
hd5                 boot       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    closed/syncd  N/A
hd6                 paging     <span class="token number">32</span>      <span class="token number">64</span>      <span class="token number">2</span>    open/stale    N/A
hd8                 jfs2log    <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/stale    N/A
hd4                 jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/stale    /
hd2                 jfs2       <span class="token number">30</span>      <span class="token number">60</span>      <span class="token number">2</span>    open/stale    /usr
hd9var              jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/stale    /var
hd3                 jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/stale    /tmp
hd1                 jfs2       <span class="token number">120</span>     <span class="token number">240</span>     <span class="token number">2</span>    open/stale    /home
hd10opt             jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/stale    /opt
hd11admin           jfs2       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/stale    /admin
lg_dumplv           sysdump    <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    N/A
livedump            jfs2       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/stale    /var/adm/ras/livedump
loglv00             jfslog     <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/stale    N/A
lv00                jfs        <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/stale    /var/adm/csd
fslv00              jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/stale    /isc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>等待镜像同步完成，LV STATE 由 stale 变为 syncd。</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg -l rootvg</span>
rootvg:
LV NAME             TYPE       LPs     PPs     PVs  LV STATE      MOUNT POINT
hd5                 boot       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    closed/syncd  N/A
hd6                 paging     <span class="token number">32</span>      <span class="token number">64</span>      <span class="token number">2</span>    open/syncd    N/A
hd8                 jfs2log    <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    N/A
hd4                 jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /
hd2                 jfs2       <span class="token number">30</span>      <span class="token number">60</span>      <span class="token number">2</span>    open/syncd    /usr
hd9var              jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /var
hd3                 jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /tmp
hd1                 jfs2       <span class="token number">120</span>     <span class="token number">240</span>     <span class="token number">2</span>    open/syncd    /home
hd10opt             jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /opt
hd11admin           jfs2       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    /admin
lg_dumplv           sysdump    <span class="token number">20</span>      <span class="token number">20</span>      <span class="token number">1</span>    open/syncd    N/A
livedump            jfs2       <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    /var/adm/ras/livedump
loglv00             jfslog     <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    N/A
lv00                jfs        <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">2</span>    open/syncd    /var/adm/csd
fslv00              jfs2       <span class="token number">20</span>      <span class="token number">40</span>      <span class="token number">2</span>    open/syncd    /isc
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#lsvg rootvg</span>
VOLUME GROUP:       rootvg                   VG IDENTIFIER:  00f9838900004c0000000149a2d111cf
VG STATE:           active                   PP SIZE:        <span class="token number">512</span> megabyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
VG PERMISSION:      read/write               TOTAL PPs:      <span class="token number">1116</span> <span class="token punctuation">(</span><span class="token number">571392</span> megabytes<span class="token punctuation">)</span>
MAX LVs:            <span class="token number">256</span>                      FREE PPs:       <span class="token number">520</span> <span class="token punctuation">(</span><span class="token number">266240</span> megabytes<span class="token punctuation">)</span>
LVs:                <span class="token number">15</span>                       USED PPs:       <span class="token number">596</span> <span class="token punctuation">(</span><span class="token number">305152</span> megabytes<span class="token punctuation">)</span>
OPEN LVs:           <span class="token number">14</span>                       QUORUM:         <span class="token number">1</span> <span class="token punctuation">(</span>Disabled<span class="token punctuation">)</span>
TOTAL PVs:          <span class="token number">2</span>                        VG DESCRIPTORS: <span class="token number">3</span>
STALE PVs:          <span class="token number">0</span>                        STALE PPs:      <span class="token number">0</span>
ACTIVE PVs:         <span class="token number">2</span>                        AUTO ON:        <span class="token function">yes</span>
MAX PPs per VG:     <span class="token number">32512</span>                                     
MAX PPs per PV:     <span class="token number">1016</span>                     MAX PVs:        <span class="token number">32</span>
LTG size <span class="token punctuation">(</span>Dynamic<span class="token punctuation">)</span>: <span class="token number">1024</span> kilobyte<span class="token punctuation">(</span>s<span class="token punctuation">)</span>         AUTO SYNC:      no
HOT SPARE:          no                       BB POLICY:      relocatable 
PV RESTRICTION:     none                     INFINITE RETRY: no<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置系统启动逻辑卷</p>
   <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#bootlist -m normal -o</span>
hdisk0 <span class="token assign-left variable">pathid</span><span class="token operator">=</span><span class="token number">0</span>
hdisk1 <span class="token assign-left variable">blv</span><span class="token operator">=</span>hd5 <span class="token assign-left variable">pathid</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#bosboot -ad hdisk0</span>
bosboot: Boot image is <span class="token number">55324</span> <span class="token number">512</span> byte blocks.
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#</span>
<span class="token punctuation">[</span>TRDGMES1:root<span class="token punctuation">]</span>/<span class="token comment">#bootlist -m normal -o</span>
hdisk0 <span class="token assign-left variable">blv</span><span class="token operator">=</span>hd5 <span class="token assign-left variable">pathid</span><span class="token operator">=</span><span class="token number">0</span>
hdisk1 <span class="token assign-left variable">blv</span><span class="token operator">=</span>hd5 <span class="token assign-left variable">pathid</span><span class="token operator">=</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Unix</category>
        <category>AIX</category>
      </categories>
      <tags>
        <tag>rootvg</tag>
      </tags>
  </entry>
  <entry>
    <title>Overview</title>
    <url>/blog/posts/1eb5b3ed.html</url>
    <content><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><h2 id="Change-ASM-DiskGroup-compatibility"><a href="#Change-ASM-DiskGroup-compatibility" class="headerlink" title="Change ASM DiskGroup compatibility"></a>Change ASM DiskGroup compatibility</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> diskgroup dg2 <span class="token keyword">set</span> attribute <span class="token string">'compatible.asm'</span><span class="token operator">=</span><span class="token string">'11.1'</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> diskgroup dg2 <span class="token keyword">set</span> attribute <span class="token string">'compatible.rdbms'</span><span class="token operator">=</span><span class="token string">'11.1'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="REDUNDANCY"><a href="#REDUNDANCY" class="headerlink" title="REDUNDANCY"></a>REDUNDANCY</h2><p>指的是一个 diskgroup 内同一份数据的保护级别，通过 failgroup 的冗余来保证数据的冗余，有三个取值，external，normal，high。</p>
<h2 id="FAILGROUP"><a href="#FAILGROUP" class="headerlink" title="FAILGROUP"></a>FAILGROUP</h2><p>一个或多个磁盘构成的整体，它是磁盘组的一部分，Oracle 保证每一个 extent 和它对应的镜像不会保存在相同的 failure group 中，从而确保了当 Failure group 中的某一个或多个磁盘，甚至整个 failure group 全部丢失时也不会有数据丢失，并实现了数据的镜像。如果在创建磁盘组时指定了 failure group，数据就以 AU 为单位在 failure group 之间实现镜像，如果创建磁盘组时没有指定 failure group，那么每一块磁盘就作为一个 failure group，以 AU 为单位对数据进行镜像。</p>
<blockquote>
<p><strong>external redundancy</strong><br>冗余级别为 external 时，ASM 不保证数据的冗余，完全依赖于存储的冗余，不能指定 failgroup，但是默认会为每一个 disk 分配一个 failgroup，同一份数据只能存在一个 failgroup 中。<br><strong>normal redundancy</strong><br>冗余级别为 normal 时，ASM 要求至少 2 个 failgroup，可以大于 2 个，每一份数据会存储两份，分别位于两个不同的 failgroup 中 <br><strong>high redundancy</strong><br> 冗余级别为 high 时，ASM 要求至少 3 个 failgroup，可以大于 3 个，每一份数据会存储三份，分别位于三个不同的 failgroup 中</p>
</blockquote>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>overview</tag>
      </tags>
  </entry>
  <entry>
    <title>ASMLib</title>
    <url>/blog/posts/d08e9af.html</url>
    <content><![CDATA[<ol>
<li><p>Install</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># ll /soft/</span>
total <span class="token number">3664732</span>
-r-xr-x---. <span class="token number">1</span> root root         <span class="token number">304920</span> Apr <span class="token number">30</span> <span class="token number">20</span>:50 kmod-oracleasm-2.0.8-28.0.1.el7.x86_64.rpm
-r-xr-x---. <span class="token number">1</span> root root          <span class="token number">19360</span> Apr <span class="token number">30</span> <span class="token number">20</span>:50 oracleasmlib-2.0.12-1.el7.x86_64.rpm
-r-xr-x---. <span class="token number">1</span> root root          <span class="token number">86908</span> Apr <span class="token number">30</span> <span class="token number">20</span>:51 oracleasm-support-2.1.11-2.el7.x86_64.rpm

<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># yum -y localinstall /soft/*</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Configure</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm configure -i</span>
Configuring the Oracle ASM library driver.

This will configure the on-boot properties of the Oracle ASM library
driver.  The following questions will determine whether the driver is
loaded on boot and what permissions it will have.  The current values
will be shown <span class="token keyword">in</span> brackets <span class="token punctuation">(</span><span class="token string">'[]'</span><span class="token punctuation">)</span>.  Hitting <span class="token operator">&lt;</span>ENTER<span class="token operator">></span> without typing an
answer will keep that current value.  Ctrl-C will abort.

Default user to own the driver interface <span class="token punctuation">[</span><span class="token punctuation">]</span>: grid
Default group to own the driver interface <span class="token punctuation">[</span><span class="token punctuation">]</span>: asmadmin
Start Oracle ASM library driver on boot <span class="token punctuation">(</span>y/n<span class="token punctuation">)</span> <span class="token punctuation">[</span>n<span class="token punctuation">]</span>: y
Scan <span class="token keyword">for</span> Oracle ASM disks on boot <span class="token punctuation">(</span>y/n<span class="token punctuation">)</span> <span class="token punctuation">[</span>y<span class="token punctuation">]</span>: y
Writing Oracle ASM library driver configuration: <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>View ASMLib driver configuration file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/sysconfig/oracleasm</span>
<span class="token comment">#</span>
<span class="token comment"># This is a configuration file for automatic loading of the Oracle</span>
<span class="token comment"># Automatic Storage Management library kernel driver.  It is generated</span>
<span class="token comment"># By running /etc/init.d/oracleasm configure.  Please use that method</span>
<span class="token comment"># to modify this file</span>
<span class="token comment">#</span>

<span class="token comment"># ORACLEASM_ENABLED: 'true' means to load the driver on boot.</span>
<span class="token assign-left variable">ORACLEASM_ENABLED</span><span class="token operator">=</span>true

<span class="token comment"># ORACLEASM_UID: Default user owning the /dev/oracleasm mount point.</span>
<span class="token assign-left variable">ORACLEASM_UID</span><span class="token operator">=</span>grid

<span class="token comment"># ORACLEASM_GID: Default group owning the /dev/oracleasm mount point.</span>
<span class="token assign-left variable">ORACLEASM_GID</span><span class="token operator">=</span>asmadmin

<span class="token comment"># ORACLEASM_SCANBOOT: 'true' means scan for ASM disks on boot.</span>
<span class="token assign-left variable">ORACLEASM_SCANBOOT</span><span class="token operator">=</span>true

<span class="token comment"># ORACLEASM_SCANORDER: Matching patterns to order disk scanning</span>
<span class="token assign-left variable">ORACLEASM_SCANORDER</span><span class="token operator">=</span><span class="token string">""</span>

<span class="token comment"># ORACLEASM_SCANEXCLUDE: Matching patterns to exclude disks from scan</span>
<span class="token assign-left variable">ORACLEASM_SCANEXCLUDE</span><span class="token operator">=</span><span class="token string">""</span>

<span class="token comment"># ORACLEASM_SCAN_DIRECTORIES: Scan disks under these directories</span>
<span class="token assign-left variable">ORACLEASM_SCAN_DIRECTORIES</span><span class="token operator">=</span><span class="token string">""</span>

<span class="token comment"># ORACLEASM_USE_LOGICAL_BLOCK_SIZE: 'true' means use the logical block size</span>
<span class="token comment"># reported by the underlying disk instead of the physical. The default</span>
<span class="token comment"># is 'false'</span>
<span class="token assign-left variable">ORACLEASM_USE_LOGICAL_BLOCK_SIZE</span><span class="token operator">=</span>false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Load and initialize the ASMLib driver</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm init</span>
Creating /dev/oracleasm <span class="token function">mount</span> point: /dev/oracleasm
Loading module <span class="token string">"oracleasm"</span><span class="token builtin class-name">:</span> oracleasm
Configuring <span class="token string">"oracleasm"</span> to use device physical block size
Mounting ASMlib driver filesystem: /dev/oracleasm
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm status</span>
Checking <span class="token keyword">if</span> ASM is loaded: <span class="token function">yes</span>
Checking <span class="token keyword">if</span> /dev/oracleasm is mounted: <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Create disks</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm createdisk OCR_VOTE1 /dev/sdb1</span>
Writing disk header: <span class="token keyword">done</span>
Instantiating disk: <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm createdisk OCR_VOTE2 /dev/sdc1</span>
Writing disk header: <span class="token keyword">done</span>
Instantiating disk: <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm createdisk OCR_VOTE3 /dev/sdd1</span>
Writing disk header: <span class="token keyword">done</span>
Instantiating disk: <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm listdisks</span>
OCR_VOTE1
OCR_VOTE2
OCR_VOTE3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Scan disks</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac2 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm scandisks</span>
Reloading disk partitions: <span class="token keyword">done</span>
Cleaning any stale ASM disks<span class="token punctuation">..</span>.
Scanning system <span class="token keyword">for</span> ASM disks<span class="token punctuation">..</span>.
Instantiating disk <span class="token string">"OCR_VOTE1"</span>
Instantiating disk <span class="token string">"OCR_VOTE2"</span>
Instantiating disk <span class="token string">"OCR_VOTE3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>asmlib</tag>
      </tags>
  </entry>
  <entry>
    <title>Maintenance</title>
    <url>/blog/posts/a918773e.html</url>
    <content><![CDATA[<h4 id="Setting-Disk-String"><a href="#Setting-Disk-String" class="headerlink" title="Setting Disk String"></a>Setting Disk String</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> system <span class="token keyword">set</span> asm_diskstring<span class="token operator">=</span><span class="token string">'ORCL:*'</span> scope<span class="token operator">=</span>both sid<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Creating-Disk-Groups"><a href="#Creating-Disk-Groups" class="headerlink" title="Creating Disk Groups"></a>Creating Disk Groups</h4><p><img src="https://docs.oracle.com/cd/B19306_01/server.102/b14200/img/create_diskgroup.gif"><br><img src="https://docs.oracle.com/cd/B19306_01/server.102/b14200/img/qualified_disk_clause.gif"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> DISKGROUP <span class="token keyword">data</span> NORMAL REDUNDANCY
  FAILGROUP controller1 <span class="token keyword">DISK</span>
    <span class="token string">'/devices/diska1'</span> NAME diska1<span class="token punctuation">,</span>
    <span class="token string">'/devices/diska2'</span> NAME diska2<span class="token punctuation">,</span>
    <span class="token string">'/devices/diska3'</span> NAME diska3<span class="token punctuation">,</span>
    <span class="token string">'/devices/diska4'</span> NAME diska4
  FAILGROUP controller2 <span class="token keyword">DISK</span>
    <span class="token string">'/devices/diskb1'</span> NAME diskb1<span class="token punctuation">,</span>
    <span class="token string">'/devices/diskb2'</span> NAME diskb2<span class="token punctuation">,</span>
    <span class="token string">'/devices/diskb3'</span> NAME diskb3<span class="token punctuation">,</span>
    <span class="token string">'/devices/diskb4'</span> NAME diskb4
  ATTRIBUTE <span class="token string">'au_size'</span><span class="token operator">=</span><span class="token string">'4M'</span><span class="token punctuation">,</span>
    <span class="token string">'compatible.asm'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">,</span> 
    <span class="token string">'compatible.rdbms'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">,</span>
    <span class="token string">'compatible.advm'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> DISKGROUP <span class="token keyword">DATA</span> EXTERNAL REDUNDANCY
  <span class="token keyword">DISK</span> <span class="token string">'ORCL:DATA1'</span><span class="token punctuation">,</span><span class="token string">'ORCL:DATA2'</span><span class="token punctuation">,</span><span class="token string">'ORCL:DATA3'</span>
  ATTRIBUTE <span class="token string">'COMPATIBLE.ASM'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="Dropping-Disk-Groups"><a href="#Dropping-Disk-Groups" class="headerlink" title="Dropping Disk Groups"></a>Dropping Disk Groups</h4><p>The default is <code>EXCLUDING CONTENTS</code>, which provides syntactic consistency and prevents you from dropping the disk group if it has any contents.</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> diskgroup <span class="token keyword">DATA</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>You can specify the <code>INCLUDING CONTENTS</code> clause if you also want to delete all files that are contained in the disk group.</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> diskgroup <span class="token keyword">DATA</span> including contents<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>If you cannot mount a disk group but must drop it, you can use the <code>FORCE</code> option of the <code>DROP DISKGROUP</code> statement.</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> diskgroup <span class="token keyword">DATA</span> <span class="token keyword">force</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="Disk-Group-Compatibility"><a href="#Disk-Group-Compatibility" class="headerlink" title="Disk Group Compatibility"></a>Disk Group Compatibility</h4><p>Valid Combinations of Compatibility Attribute Settings for 11g</p>
<table>
<thead>
<tr>
<th>COMPATIBLE.ASM</th>
<th>COMPATIBLE.RDBMS</th>
<th>COMPATIBLE.ADVM</th>
<th>ASM Instance Version</th>
<th>COMPATIBLE Setting for RDBMS Instance</th>
</tr>
</thead>
<tbody><tr>
<td>10.1</td>
<td>10.1</td>
<td>n&#x2F;a</td>
<td>&gt;&#x3D; 10.1</td>
<td>&gt;&#x3D; 10.1</td>
</tr>
<tr>
<td>11.1</td>
<td>10.1</td>
<td>n&#x2F;a</td>
<td>&gt;&#x3D; 11.1</td>
<td>&gt;&#x3D; 10.1</td>
</tr>
<tr>
<td>11.2</td>
<td>11.1</td>
<td>11.2</td>
<td>&gt;&#x3D; 11.2</td>
<td>&gt;&#x3D; 11.1</td>
</tr>
<tr>
<td>11.2</td>
<td>11.2</td>
<td>11.2</td>
<td>&gt;&#x3D; 11.2</td>
<td>&gt;&#x3D; 11.2</td>
</tr>
</tbody></table>
<p>Using <code>ALTER DISKGROUP</code> with Compatibility Attributes</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> DISKGROUP <span class="token keyword">DATA</span> <span class="token keyword">SET</span> ATTRIBUTE <span class="token string">'compatible.asm'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> DISKGROUP <span class="token keyword">DATA</span> <span class="token keyword">SET</span> ATTRIBUTE <span class="token string">'compatible.rdbms'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> DISKGROUP <span class="token keyword">DATA</span> <span class="token keyword">SET</span> ATTRIBUTE <span class="token string">'compatible.advm'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>maintenance</tag>
      </tags>
  </entry>
  <entry>
    <title>Migrate ASM Diskgroup to Another SAN</title>
    <url>/blog/posts/d7934161.html</url>
    <content><![CDATA[<h1 id="Migrate-ASM-Diskgroup-to-Another-SAN"><a href="#Migrate-ASM-Diskgroup-to-Another-SAN" class="headerlink" title="Migrate ASM Diskgroup to Another SAN"></a>Migrate ASM Diskgroup to Another SAN</h1><ol>
<li><p>if necessary, modify asm_diskstring</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> system <span class="token keyword">set</span> asm_diskstring <span class="token operator">=</span> <span class="token string">'/dev/emcpowerc*'</span><span class="token punctuation">,</span><span class="token string">'/dev/emcpowerh*'</span> scope<span class="token operator">=</span>both<span class="token punctuation">;</span>

<span class="token keyword">select</span> path <span class="token keyword">from</span> v$asm_disk<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>query the fail groups</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">col path <span class="token keyword">for</span> a20
col state <span class="token keyword">for</span> a10
col failgroup <span class="token keyword">for</span> a15
col name <span class="token keyword">for</span> a15
<span class="token keyword">select</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>dg<span class="token punctuation">.</span>state<span class="token punctuation">,</span>dg<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">,</span>d<span class="token punctuation">.</span>path<span class="token punctuation">,</span>d<span class="token punctuation">.</span>mount_status<span class="token punctuation">,</span>d<span class="token punctuation">.</span>failgroup<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>state 
<span class="token keyword">from</span> v$asm_diskgroup dg<span class="token punctuation">,</span> v$asm_disk d
<span class="token keyword">where</span> dg<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number <span class="token operator">and</span> dg<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'DATA'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">;</span>

NAME            STATE      <span class="token keyword">TYPE</span>   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE
<span class="token comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span>
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">0</span> ORCL:DATA1           CACHED  DATA1           DATA1           NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">1</span> ORCL:DATA2           CACHED  DATA2           DATA2           NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">2</span> ORCL:DATA3           CACHED  DATA3           DATA3           NORMAL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>create new disks</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm createdisk NEW_DATA1 /dev/sdl1</span>
Writing disk header: <span class="token keyword">done</span>
Instantiating disk: <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm createdisk NEW_DATA2 /dev/sdm1</span>
Writing disk header: <span class="token keyword">done</span>
Instantiating disk: <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm createdisk NEW_DATA3 /dev/sdn1</span>
Writing disk header: <span class="token keyword">done</span>
Instantiating disk: <span class="token keyword">done</span>

<span class="token punctuation">[</span>root@rac2 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm scandisks</span>
Reloading disk partitions: <span class="token keyword">done</span>
Cleaning any stale ASM disks<span class="token punctuation">..</span>.
Scanning system <span class="token keyword">for</span> ASM disks<span class="token punctuation">..</span>.
Instantiating disk <span class="token string">"NEW_DATA1"</span>
Instantiating disk <span class="token string">"NEW_DATA2"</span>
Instantiating disk <span class="token string">"NEW_DATA3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>from node1 add each disk to a fail group</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">sqlplus <span class="token string">"/ as sysasm"</span>

<span class="token comment">-- external type not need to specify a fail group</span>
<span class="token keyword">ALTER</span> DISKGROUP <span class="token keyword">DATA</span> <span class="token keyword">ADD</span> <span class="token keyword">DISK</span>
<span class="token string">'ORCL:NEW_DATA1'</span><span class="token punctuation">,</span>
<span class="token string">'ORCL:NEW_DATA2'</span><span class="token punctuation">,</span>
<span class="token string">'ORCL:NEW_DATA3'</span>
REBALANCE POWER <span class="token number">8</span><span class="token punctuation">;</span>

<span class="token comment">-- chanage rebalance power. compatiable.asm >= 11.2.0.2, power range is 0 to 1024; if &lt; 11.2.0.2, power range is 0 to 11.</span>
<span class="token keyword">alter</span> diskgroup <span class="token keyword">DATA</span> rebalance power <span class="token number">8</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>check gv$asm_operation till it returns no rows</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> gv$asm_operation<span class="token punctuation">;</span>
<span class="token keyword">no</span> <span class="token keyword">rows</span> selected

<span class="token keyword">SQL</span><span class="token operator">></span> col path <span class="token keyword">for</span> a20
col state <span class="token keyword">for</span> a10
col failgroup <span class="token keyword">for</span> a15
col name <span class="token keyword">for</span> a15
<span class="token keyword">select</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>dg<span class="token punctuation">.</span>state<span class="token punctuation">,</span>dg<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">,</span>d<span class="token punctuation">.</span>path<span class="token punctuation">,</span>d<span class="token punctuation">.</span>mount_status<span class="token punctuation">,</span>d<span class="token punctuation">.</span>failgroup<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>state
<span class="token keyword">from</span> v$asm_diskgroup dg<span class="token punctuation">,</span> v$asm_disk d
<span class="token keyword">where</span> dg<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number <span class="token operator">and</span> dg<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'DATA'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">;</span>

NAME            STATE      <span class="token keyword">TYPE</span>   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE
<span class="token comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span>
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">0</span> ORCL:DATA1           CACHED  DATA1           DATA1           NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">1</span> ORCL:DATA2           CACHED  DATA2           DATA2           NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">2</span> ORCL:DATA3           CACHED  DATA3           DATA3           NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">3</span> ORCL:NEW_DATA1       CACHED  NEW_DATA1       NEW_DATA1       NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">4</span> ORCL:NEW_DATA2       CACHED  NEW_DATA2       NEW_DATA2       NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">5</span> ORCL:NEW_DATA3       CACHED  NEW_DATA3       NEW_DATA3       NORMAL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>drop old disks</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> DISKGROUP <span class="token keyword">DATA</span> <span class="token keyword">DROP</span> <span class="token keyword">DISK</span>
<span class="token string">'DATA1'</span><span class="token punctuation">,</span>
<span class="token string">'DATA2'</span><span class="token punctuation">,</span>
<span class="token string">'DATA3'</span>
REBALANCE POWER <span class="token number">8</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>check gv$asm_operation till it returns no rows</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> gv$asm_operation<span class="token punctuation">;</span>
<span class="token keyword">no</span> <span class="token keyword">rows</span> selected

<span class="token keyword">SQL</span><span class="token operator">></span> col path <span class="token keyword">for</span> a20
col state <span class="token keyword">for</span> a10
col failgroup <span class="token keyword">for</span> a15
col name <span class="token keyword">for</span> a15
<span class="token keyword">select</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>dg<span class="token punctuation">.</span>state<span class="token punctuation">,</span>dg<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">,</span>d<span class="token punctuation">.</span>path<span class="token punctuation">,</span>d<span class="token punctuation">.</span>mount_status<span class="token punctuation">,</span>d<span class="token punctuation">.</span>failgroup<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>state
<span class="token keyword">from</span> v$asm_diskgroup dg<span class="token punctuation">,</span> v$asm_disk d
<span class="token keyword">where</span> dg<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number <span class="token operator">and</span> dg<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'DATA'</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">;</span>

NAME            STATE      <span class="token keyword">TYPE</span>   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE
<span class="token comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span>
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">3</span> ORCL:NEW_DATA1       CACHED  NEW_DATA1       NEW_DATA1       NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">4</span> ORCL:NEW_DATA2       CACHED  NEW_DATA2       NEW_DATA2       NORMAL
<span class="token keyword">DATA</span>            MOUNTED    EXTERN           <span class="token number">5</span> ORCL:NEW_DATA3       CACHED  NEW_DATA3       NEW_DATA3       NORMAL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>note: add and drop disks in one command, only one rebalancing operation will occur</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> DISKGROUP <span class="token keyword">DATA</span> <span class="token keyword">ADD</span> <span class="token keyword">DISK</span>
<span class="token string">'ORCL:NEW_DATA1'</span><span class="token punctuation">,</span>
<span class="token string">'ORCL:NEW_DATA2'</span><span class="token punctuation">,</span>
<span class="token string">'ORCL:NEW_DATA3'</span>
<span class="token keyword">DROP</span> <span class="token keyword">DISK</span>
<span class="token string">'DATA1'</span><span class="token punctuation">,</span>
<span class="token string">'DATA2'</span><span class="token punctuation">,</span>
<span class="token string">'DATA3'</span>
REBALANCE POWER <span class="token number">8</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>delete old disks</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm deletedisk DATA1</span>
Clearing disk header: <span class="token keyword">done</span>
Dropping disk: <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm deletedisk DATA2</span>
Clearing disk header: <span class="token keyword">done</span>
Dropping disk: <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm deletedisk DATA3</span>
Clearing disk header: <span class="token keyword">done</span>
Dropping disk: <span class="token keyword">done</span>

<span class="token punctuation">[</span>root@rac2 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm scandisks</span>
Reloading disk partitions: <span class="token keyword">done</span>
Cleaning any stale ASM disks<span class="token punctuation">..</span>.
Cleaning disk <span class="token string">"DATA1"</span>
Cleaning disk <span class="token string">"DATA2"</span>
Cleaning disk <span class="token string">"DATA3"</span>
Scanning system <span class="token keyword">for</span> ASM disks<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>migrate</tag>
      </tags>
  </entry>
  <entry>
    <title>PreCheck</title>
    <url>/blog/posts/28a7074e.html</url>
    <content><![CDATA[<h4 id="PreCheck"><a href="#PreCheck" class="headerlink" title="PreCheck"></a>PreCheck</h4><ol>
<li><p>System info</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 系统版本 </span>
<span class="token function">uname</span> <span class="token parameter variable">-a</span>
<span class="token function">cat</span> /etc/os-release

<span class="token comment"># ASM 磁盘创建方式：udev or asmlib</span>
<span class="token comment"># udev:</span>
<span class="token function">cat</span> /etc/udev/rules.d/99-oracle-asmdevices.rules

<span class="token comment"># asmlib:</span>
<span class="token function">cat</span> /etc/sysconfig/oracleasm
/etc/init.d/oracleasm listdisks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>GI info</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># grid 用户查询，群集资源状态，版本，ocr 信息，votedisk 信息 </span>
crsctl <span class="token function">stat</span> res <span class="token parameter variable">-t</span>
asmcmd lsdg
ocrcheck
crsctl query crs activeversion
crsctl query css votedisk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>ASM DiskGroup info</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 数据库版本 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$version<span class="token punctuation">;</span>

<span class="token comment">-- 磁盘组信息 </span>
<span class="token keyword">set</span> <span class="token keyword">lines</span> <span class="token number">200</span> pages <span class="token number">100</span>
<span class="token keyword">select</span> d<span class="token punctuation">.</span>name group_name<span class="token punctuation">,</span>f<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> cnt <span class="token keyword">from</span> v$asm_file f 
 <span class="token keyword">join</span> v$asm_diskgroup d <span class="token keyword">on</span> f<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number 
 <span class="token keyword">group</span> <span class="token keyword">by</span> rollup <span class="token punctuation">(</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>f<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 磁盘组成员，故障组 </span>
col path <span class="token keyword">for</span> a50
col state <span class="token keyword">for</span> a10
col failgroup <span class="token keyword">for</span> a15
col name <span class="token keyword">for</span> a30
<span class="token keyword">select</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>dg<span class="token punctuation">.</span>state<span class="token punctuation">,</span>dg<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">,</span>d<span class="token punctuation">.</span>path<span class="token punctuation">,</span>d<span class="token punctuation">.</span>mount_status<span class="token punctuation">,</span>d<span class="token punctuation">.</span>failgroup<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>state 
 <span class="token keyword">from</span> v$asm_diskgroup dg<span class="token punctuation">,</span> v$asm_disk d
 <span class="token keyword">where</span> dg<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number
 <span class="token keyword">order</span> <span class="token keyword">by</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">;</span>

<span class="token comment">-- 磁盘组兼容版本 </span>
col COMPATIBILITY form a10
col DATABASE_COMPATIBILITY form a10
col NAME form a20
<span class="token keyword">select</span> group_number<span class="token punctuation">,</span> name<span class="token punctuation">,</span> compatibility<span class="token punctuation">,</span> database_compatibility <span class="token keyword">from</span> v$asm_diskgroup<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>precheck</tag>
      </tags>
  </entry>
  <entry>
    <title>Replace OCR and Voting disks</title>
    <url>/blog/posts/c9d09ad6.html</url>
    <content><![CDATA[<h4 id="OCR"><a href="#OCR" class="headerlink" title="OCR"></a>OCR</h4><ol>
<li><p>Perform ocr backup</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./ocrconfig -manualbackup</span>
rac2     <span class="token number">2022</span>/05/06 09:21:54     /u01/app/11.2.0/grid/cdata/rac-cluster/backup_20220506_092154.ocr

<span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./ocrconfig -showbackup</span>
PROT-24: Auto backups <span class="token keyword">for</span> the Oracle Cluster Registry are not available
rac2     <span class="token number">2022</span>/05/06 09:21:54     /u01/app/11.2.0/grid/cdata/rac-cluster/backup_20220506_092154.ocr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Perform ocrcheck</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./ocrcheck</span>
Status of Oracle Cluster Registry is as follows <span class="token builtin class-name">:</span>
         Version                  <span class="token builtin class-name">:</span>          <span class="token number">3</span>
         Total space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span>     <span class="token builtin class-name">:</span>     <span class="token number">262120</span>
         Used space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span>      <span class="token builtin class-name">:</span>       <span class="token number">3012</span>
         Available space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span> <span class="token builtin class-name">:</span>     <span class="token number">259108</span>
         ID                       <span class="token builtin class-name">:</span>  <span class="token number">354983601</span>
         Device/File Name         <span class="token builtin class-name">:</span>  +OCR_VOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check succeeded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Create a new NEW_OCRVOTE diskgroup</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> DISKGROUP NEW_OCRVOTE NORMAL REDUNDANCY
FAILGROUP F1 <span class="token keyword">DISK</span>
<span class="token string">'ORCL:NEW_OCRVOTE1'</span><span class="token punctuation">,</span><span class="token string">'ORCL:NEW_OCRVOTE2'</span>
FAILGROUP F2 <span class="token keyword">DISK</span>
<span class="token string">'ORCL:NEW_OCRVOTE3'</span><span class="token punctuation">,</span><span class="token string">'ORCL:NEW_OCRVOTE4'</span>
ATTRIBUTE <span class="token string">'COMPATIBLE.ASM'</span> <span class="token operator">=</span> <span class="token string">'11.2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Add new ocrmirror</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./ocrconfig -add +NEW_OCRVOTE</span>
<span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./ocrcheck</span>
Status of Oracle Cluster Registry is as follows <span class="token builtin class-name">:</span>
         Version                  <span class="token builtin class-name">:</span>          <span class="token number">3</span>
         Total space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span>     <span class="token builtin class-name">:</span>     <span class="token number">262120</span>
         Used space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span>      <span class="token builtin class-name">:</span>       <span class="token number">3012</span>
         Available space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span> <span class="token builtin class-name">:</span>     <span class="token number">259108</span>
         ID                       <span class="token builtin class-name">:</span>  <span class="token number">354983601</span>
         Device/File Name         <span class="token builtin class-name">:</span>  +OCR_VOTE
                                    Device/File integrity check succeeded

         Device/File Name         <span class="token builtin class-name">:</span>  +NEW_OCRVOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check succeeded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Delete old ocr device</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./ocrconfig -delete +OCR_VOTE</span>
<span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./ocrcheck</span>
Status of Oracle Cluster Registry is as follows <span class="token builtin class-name">:</span>
         Version                  <span class="token builtin class-name">:</span>          <span class="token number">3</span>
         Total space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span>     <span class="token builtin class-name">:</span>     <span class="token number">262120</span>
         Used space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span>      <span class="token builtin class-name">:</span>       <span class="token number">3012</span>
         Available space <span class="token punctuation">(</span>kbytes<span class="token punctuation">)</span> <span class="token builtin class-name">:</span>     <span class="token number">259108</span>
         ID                       <span class="token builtin class-name">:</span>  <span class="token number">354983601</span>
         Device/File Name         <span class="token builtin class-name">:</span>  +NEW_OCRVOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check succeeded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h4 id="Voting-Disks"><a href="#Voting-Disks" class="headerlink" title="Voting Disks"></a>Voting Disks</h4><ol>
<li><p>Query css votedisk</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@rac1 ~<span class="token punctuation">]</span>$ crsctl query css votedisk
<span class="token comment">##  STATE    File Universal Id                File Name Disk group</span>
--  -----    -----------------                --------- ---------
 <span class="token number">1</span>. ONLINE   adbb58e65c384ff0bf5fc171cba469a4 <span class="token punctuation">(</span>ORCL:OCR_VOTE1<span class="token punctuation">)</span> <span class="token punctuation">[</span>OCR_VOTE<span class="token punctuation">]</span>
Located <span class="token number">1</span> voting disk<span class="token punctuation">(</span>s<span class="token punctuation">)</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Replace votedisk</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@rac1 ~<span class="token punctuation">]</span>$ crsctl replace votedisk +NEW_OCRVOTE

<span class="token punctuation">[</span>grid@rac1 ~<span class="token punctuation">]</span>$ crsctl query css votedisk
<span class="token comment">##  STATE    File Universal Id                File Name Disk group</span>
--  -----    -----------------                --------- ---------
 <span class="token number">1</span>. ONLINE   adbb58e65c384ff0bf5fc171cba469a4 <span class="token punctuation">(</span>ORCL:NEW_OCRVOTE1<span class="token punctuation">)</span> <span class="token punctuation">[</span>NEW_OCRVOTE<span class="token punctuation">]</span>
 <span class="token number">2</span>. ONLINE   07d2464674ac4fabbf27f3132d8448b0 <span class="token punctuation">(</span>ORCL:NEW_OCRVOTE2<span class="token punctuation">)</span> <span class="token punctuation">[</span>NEW_OCRVOTE<span class="token punctuation">]</span>
 <span class="token number">3</span>. ONLINE   9761ccf221524f66bff0766ad5721239 <span class="token punctuation">(</span>ORCL:NEW_OCRVOTE3<span class="token punctuation">)</span> <span class="token punctuation">[</span>NEW_OCRVOTE<span class="token punctuation">]</span>
Located <span class="token number">3</span> voting disk<span class="token punctuation">(</span>s<span class="token punctuation">)</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h4 id="ASM-spfile"><a href="#ASM-spfile" class="headerlink" title="ASM spfile"></a>ASM spfile</h4><ol>
<li><p>Replace asm spfile to new diskgroup</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">show</span> parameter spfile<span class="token punctuation">;</span>
NAME                                <span class="token keyword">TYPE</span>        <span class="token keyword">VALUE</span>
<span class="token comment">------------------------------------ ----------- ------------------------------</span>
spfile                               string      <span class="token operator">+</span>OCR_VOTE<span class="token operator">/</span>rac<span class="token operator">-</span>cluster<span class="token operator">/</span>asmparame
                                                 terfile<span class="token operator">/</span>registry<span class="token punctuation">.</span><span class="token number">253.946671547</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">create</span> pfile<span class="token operator">=</span><span class="token string">'/u01/app/grid/asmpfile.ora'</span> <span class="token keyword">from</span> spfile<span class="token punctuation">;</span>
<span class="token keyword">File</span> created<span class="token punctuation">.</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">create</span> spfile<span class="token operator">=</span><span class="token string">'+NEW_OCRVOTE'</span> <span class="token keyword">from</span> pfile<span class="token operator">=</span><span class="token string">'/u01/app/grid/asmpfile.ora'</span><span class="token punctuation">;</span>
<span class="token keyword">File</span> created<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Restart cluster</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./crsctl stop cluster -all</span>
<span class="token punctuation">[</span>root@rac1 bin<span class="token punctuation">]</span><span class="token comment"># ./crsctl start cluster -all</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>ocr</tag>
        <tag>voting</tag>
        <tag>replace</tag>
      </tags>
  </entry>
  <entry>
    <title>Swap Voting Disks Across Storage</title>
    <url>/blog/posts/463891ca.html</url>
    <content><![CDATA[<h4 id="Swap-Voting-Disks-Across-Storage"><a href="#Swap-Voting-Disks-Across-Storage" class="headerlink" title="Swap Voting Disks Across Storage"></a>Swap Voting Disks Across Storage</h4><ol>
<li><p>Query css votedisk</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">crsctl query css votedisk<span class="token punctuation">;</span>

<span class="token comment">##  STATE    File Universal Id                File Name Disk group</span>
--  -----    -----------------                --------- ---------
<span class="token number">1</span>. ONLINE   73e1c48069d64fefbfc44cd8e65107d8 <span class="token punctuation">(</span>ORCL:OCR_VOTE1<span class="token punctuation">)</span> <span class="token punctuation">[</span>OCR_VOTE<span class="token punctuation">]</span>
Located <span class="token number">1</span> voting disk<span class="token punctuation">(</span>s<span class="token punctuation">)</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Query the fail groups</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">col path <span class="token keyword">for</span> a20
col state <span class="token keyword">for</span> a10
col failgroup <span class="token keyword">for</span> a15
col name <span class="token keyword">for</span> a15
<span class="token keyword">select</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>dg<span class="token punctuation">.</span>state<span class="token punctuation">,</span>dg<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">,</span>d<span class="token punctuation">.</span>path<span class="token punctuation">,</span>d<span class="token punctuation">.</span>mount_status<span class="token punctuation">,</span>d<span class="token punctuation">.</span>failgroup<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>state 
 <span class="token keyword">from</span> v$asm_diskgroup dg<span class="token punctuation">,</span> v$asm_disk d
 <span class="token keyword">where</span> dg<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number <span class="token operator">and</span> dg<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'OCR_VOTE'</span>
 <span class="token keyword">order</span> <span class="token keyword">by</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">;</span>

NAME            STATE      <span class="token keyword">TYPE</span>   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE
<span class="token comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span>
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">0</span> ORCL:OCR_VOTE1       CACHED  OCR_VOTE1       OCR_VOTE1       NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">1</span> ORCL:OCR_VOTE2       CACHED  OCR_VOTE2       OCR_VOTE2       NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">2</span> ORCL:OCR_VOTE3       CACHED  OCR_VOTE3       OCR_VOTE3       NORMAL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Create new disks</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">oracleasm createdisk NEW_OCR_VOTE1 /dev/sdi1
oracleasm createdisk NEW_OCR_VOTE2 /dev/sdj1
oracleasm createdisk NEW_OCR_VOTE3 /dev/sdk1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>From node1 add each disk to a fail group</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">sqlplus <span class="token string">"/ as sysasm"</span>

<span class="token comment">-- external type not need to specify a fail group</span>
<span class="token keyword">ALTER</span> DISKGROUP OCR_VOTE <span class="token keyword">ADD</span> <span class="token keyword">DISK</span>
<span class="token string">'ORCL:NEW_OCR_VOTE1'</span><span class="token punctuation">,</span>
<span class="token string">'ORCL:NEW_OCR_VOTE2'</span><span class="token punctuation">,</span>
<span class="token string">'ORCL:NEW_OCR_VOTE3'</span>
REBALANCE POWER <span class="token number">8</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Check gv$asm_operation till it returns no rows</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> gv$asm_operation<span class="token punctuation">;</span>
<span class="token keyword">no</span> <span class="token keyword">rows</span> selected

<span class="token keyword">SQL</span><span class="token operator">></span> col path <span class="token keyword">for</span> a20
col state <span class="token keyword">for</span> a10
col failgroup <span class="token keyword">for</span> a15
col name <span class="token keyword">for</span> a15
<span class="token keyword">select</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>dg<span class="token punctuation">.</span>state<span class="token punctuation">,</span>dg<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">,</span>d<span class="token punctuation">.</span>path<span class="token punctuation">,</span>d<span class="token punctuation">.</span>mount_status<span class="token punctuation">,</span>d<span class="token punctuation">.</span>failgroup<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>state
 <span class="token keyword">from</span> v$asm_diskgroup dg<span class="token punctuation">,</span> v$asm_disk d
 <span class="token keyword">where</span> dg<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number <span class="token operator">and</span> dg<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'OCR_VOTE'</span>
 <span class="token keyword">order</span> <span class="token keyword">by</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">;</span>

NAME            STATE      <span class="token keyword">TYPE</span>   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE
<span class="token comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span>
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">0</span> ORCL:OCR_VOTE1       CACHED  OCR_VOTE1       OCR_VOTE1       NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">1</span> ORCL:OCR_VOTE2       CACHED  OCR_VOTE2       OCR_VOTE2       NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">2</span> ORCL:OCR_VOTE3       CACHED  OCR_VOTE3       OCR_VOTE3       NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">3</span> ORCL:NEW_OCR_VOTE1   CACHED  NEW_OCR_VOTE1   NEW_OCR_VOTE1   NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">4</span> ORCL:NEW_OCR_VOTE2   CACHED  NEW_OCR_VOTE2   NEW_OCR_VOTE2   NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">5</span> ORCL:NEW_OCR_VOTE3   CACHED  NEW_OCR_VOTE3   NEW_OCR_VOTE3   NORMAL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Drop old disks</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> DISKGROUP OCR_VOTE <span class="token keyword">DROP</span> <span class="token keyword">DISK</span>
<span class="token string">'OCR_VOTE1'</span><span class="token punctuation">,</span>
<span class="token string">'OCR_VOTE2'</span><span class="token punctuation">,</span>
<span class="token string">'OCR_VOTE3'</span>
REBALANCE POWER <span class="token number">8</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Check gv$asm_operation till it returns no rows</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> gv$asm_operation<span class="token punctuation">;</span>
 <span class="token keyword">no</span> <span class="token keyword">rows</span> selected

<span class="token keyword">SQL</span><span class="token operator">></span> col path <span class="token keyword">for</span> a20
col state <span class="token keyword">for</span> a10
col failgroup <span class="token keyword">for</span> a15
col name <span class="token keyword">for</span> a15
<span class="token keyword">select</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>dg<span class="token punctuation">.</span>state<span class="token punctuation">,</span>dg<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">,</span>d<span class="token punctuation">.</span>path<span class="token punctuation">,</span>d<span class="token punctuation">.</span>mount_status<span class="token punctuation">,</span>d<span class="token punctuation">.</span>failgroup<span class="token punctuation">,</span>d<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>state
 <span class="token keyword">from</span> v$asm_diskgroup dg<span class="token punctuation">,</span> v$asm_disk d
 <span class="token keyword">where</span> dg<span class="token punctuation">.</span>group_number<span class="token operator">=</span>d<span class="token punctuation">.</span>group_number <span class="token operator">and</span> dg<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'OCR_VOTE'</span>
 <span class="token keyword">order</span> <span class="token keyword">by</span> dg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>d<span class="token punctuation">.</span>disk_number<span class="token punctuation">;</span>

NAME            STATE      <span class="token keyword">TYPE</span>   DISK_NUMBER PATH                 MOUNT_S FAILGROUP       NAME            STATE
<span class="token comment">--------------- ---------- ------ ----------- -------------------- ------- --------------- --------------- ----------</span>
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">3</span> ORCL:NEW_OCR_VOTE1   CACHED  NEW_OCR_VOTE1   NEW_OCR_VOTE1   NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">4</span> ORCL:NEW_OCR_VOTE2   CACHED  NEW_OCR_VOTE2   NEW_OCR_VOTE2   NORMAL
OCR_VOTE        MOUNTED    EXTERN           <span class="token number">5</span> ORCL:NEW_OCR_VOTE3   CACHED  NEW_OCR_VOTE3   NEW_OCR_VOTE3   NORMAL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Delete old disks</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">oracleasm deletedisk OCR_VOTE1
oracleasm deletedisk OCR_VOTE2
oracleasm deletedisk OCR_VOTE3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>voting</tag>
        <tag>swap</tag>
      </tags>
  </entry>
  <entry>
    <title>UDEV SCSI Rules</title>
    <url>/blog/posts/f173f122.html</url>
    <content><![CDATA[<h1 id="UDEV-SCSI-Rules-Configuration-In-Oracle-Linux-5-8"><a href="#UDEV-SCSI-Rules-Configuration-In-Oracle-Linux-5-8" class="headerlink" title="UDEV SCSI Rules Configuration In Oracle Linux 5-8"></a>UDEV SCSI Rules Configuration In Oracle Linux 5-8</h1><p>For Oracle Automatic Storage Manager (ASM) to use disks, it needs to be able to identify the devices consistently and for them to have the correct ownership and permissions. In Linux you can use ASMLib to manage these tasks, but it is seen as an additional layer of complexity and has never really gained any popularity. Instead, many people use the Linux device manager “udev” to perform these tasks. This article presents a brief overview of setting up udev rules with respect to disks for use with ASM in Oracle 11g. The examples are all done using Oracle Linux 5, 6, 7 and 8 so they will be consistent with RHEL and CentOS 5, 6, 7 and 8.</p>
<ul>
<li>Identify the Disks (&#x2F;sbin&#x2F;scsi_id)</li>
<li>Make SCSI Devices Trusted</li>
<li>Create UDEV Rules File</li>
<li>Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)</li>
<li>Test Rules (udevtest)</li>
<li>Restart UDEV Service</li>
<li>Check Ownership and Permissions</li>
</ul>
<h2 id="Identify-the-Disks-x2F-sbin-x2F-scsi-id"><a href="#Identify-the-Disks-x2F-sbin-x2F-scsi-id" class="headerlink" title="Identify the Disks (&#x2F;sbin&#x2F;scsi_id)"></a>Identify the Disks (&#x2F;sbin&#x2F;scsi_id)</h2><p>We are going to write device-specific rules, so we need to be able to identify each device consistently, irrespective of the order in which Linux discovers it.<br>To do this we are going to use the SCSI ID for each disk (not the partition), which we get using the scsi_id command. The “-s” option makes the paths relative to the “&#x2F;sys” directory. </p>
<p>For <strong>Oracle Linux 5</strong>, use the following command.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /sbin/scsi_id -g -u -s /block/sdb</span>
SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>The “-s” is not available in <strong>Oracle Linux 6</strong>, so you must use the following syntax.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /sbin/scsi_id -g -u -d /dev/sdb</span>
SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>The location of the scsi_id command has changed in <strong>Oracle Linux 7 and 8</strong>, so you must use the following syntax.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /usr/lib/udev/scsi_id -g -u -d /dev/sdb</span>
SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Make-SCSI-Devices-Trusted"><a href="#Make-SCSI-Devices-Trusted" class="headerlink" title="Make SCSI Devices Trusted"></a>Make SCSI Devices Trusted</h2><p>Add the <code>options=-g</code> to the “&#x2F;etc&#x2F;scsi_id.config” file to configure SCSI devices as trusted. Create the file if it doesn’t already exist.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/scsi_id.config <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
options=-g
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="Create-UDEV-Rules-File"><a href="#Create-UDEV-Rules-File" class="headerlink" title="Create UDEV Rules File"></a>Create UDEV Rules File</h2><p>Create the “&#x2F;etc&#x2F;udev&#x2F;rules.d&#x2F;99-oracle-asmdevices.rules” file.<br>The file should contain the following lines for <strong>Oracle Linux 5</strong>. The PROGRAM parameter must match the command you used to retrieve the SCSI ID, and the RESULT parameter must match the value returned from your disks.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> a b c
<span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token string">"KERNEL==<span class="token entity"title="\&quot;">\"</span>sd*<span class="token entity" title="\&quot;">\"</span>, BUS==<span class="token entity"title="\&quot;">\"</span>scsi<span class="token entity" title="\&quot;">\"</span>, PROGRAM==<span class="token entity"title="\&quot;">\"</span>/sbin/scsi_id -g -u -s /block/<span class="token variable">$parent</span>"</span>, <span class="token assign-left variable">RESULT</span><span class="token operator">==</span><span class="token punctuation">\</span>"<span class="token variable"><span class="token variable">`</span>/sbin/scsi_id <span class="token parameter variable">-g</span> <span class="token parameter variable">-u</span> <span class="token parameter variable">-s</span> /block/sd$i<span class="token variable">`</span></span><span class="token punctuation">\</span>", <span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token punctuation">\</span>"asm-disk<span class="token variable">$i</span><span class="token punctuation">\</span>", <span class="token assign-left variable">OWNER</span><span class="token operator">=</span><span class="token punctuation">\</span>"grid<span class="token punctuation">\</span>", <span class="token assign-left variable">GROUP</span><span class="token operator">=</span><span class="token punctuation">\</span>"asmadmin<span class="token punctuation">\</span>", <span class="token assign-left variable">MODE</span><span class="token operator">=</span><span class="token punctuation">\</span>"0660<span class="token punctuation">\</span>""<span class="token operator">>></span> /etc/udev/rules.d/99-oracle-asmdevices.rules
<span class="token keyword">done</span>

<span class="token comment"># $parent is used if the device is partitioned, $name is used if the device is not partitioned.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The equivalent for <strong>Oracle Linux 6</strong> is shown below.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> a b c
<span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token string">"KERNEL==<span class="token entity"title="\&quot;">\"</span>sd*<span class="token entity" title="\&quot;">\"</span>, BUS==<span class="token entity"title="\&quot;">\"</span>scsi<span class="token entity" title="\&quot;">\"</span>, PROGRAM==<span class="token entity"title="\&quot;">\"</span>/sbin/scsi_id -g -u -d /dev/\<span class="token variable">$parent</span><span class="token entity" title="\&quot;">\"</span>, RESULT==<span class="token entity"title="\&quot;">\"</span><span class="token variable"><span class="token variable">`</span>/sbin/scsi_id <span class="token parameter variable">-g</span> <span class="token parameter variable">-u</span> <span class="token parameter variable">-d</span> /dev/sd$i<span class="token variable">`</span></span><span class="token entity" title="\&quot;">\"</span>, NAME=<span class="token entity"title="\&quot;">\"</span>asm-disk<span class="token variable">$i</span><span class="token entity" title="\&quot;">\"</span>, OWNER=<span class="token entity"title="\&quot;">\"</span>grid<span class="token entity" title="\&quot;">\"</span>, GROUP=<span class="token entity"title="\&quot;">\"</span>asmadmin<span class="token entity" title="\&quot;">\"</span>, MODE=<span class="token entity"title="\&quot;">\"</span>0660<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">>></span> /etc/udev/rules.d/99-oracle-asmdevices.rules
<span class="token keyword">done</span>

<span class="token comment"># $parent is used if the device is partitioned, $name is used if the device is not partitioned.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The equivalent for <strong>Oracle Linux 7 and 8</strong> is shown below.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> a b c
<span class="token keyword">do</span>
<span class="token builtin class-name">echo</span> <span class="token string">"KERNEL==<span class="token entity"title="\&quot;">\"</span>sd?1<span class="token entity" title="\&quot;">\"</span>, SUBSYSTEM==<span class="token entity"title="\&quot;">\"</span>block<span class="token entity" title="\&quot;">\"</span>, PROGRAM==<span class="token entity"title="\&quot;">\"</span>/usr/lib/udev/scsi_id -g -u -d /dev/\<span class="token variable">$parent</span><span class="token entity" title="\&quot;">\"</span>, RESULT==<span class="token entity"title="\&quot;">\"</span><span class="token variable"><span class="token variable">`</span>/usr/lib/udev/scsi_id <span class="token parameter variable">-g</span> <span class="token parameter variable">-u</span> <span class="token parameter variable">-d</span> /dev/sd$i<span class="token variable">`</span></span><span class="token entity" title="\&quot;">\"</span>, SYMLINK+=<span class="token entity"title="\&quot;">\"</span>asm-disk<span class="token variable">$i</span><span class="token entity" title="\&quot;">\"</span>, OWNER=<span class="token entity"title="\&quot;">\"</span>grid<span class="token entity" title="\&quot;">\"</span>, GROUP=<span class="token entity"title="\&quot;">\"</span>asmadmin<span class="token entity" title="\&quot;">\"</span>, MODE=<span class="token entity"title="\&quot;">\"</span>0660<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">>></span> /etc/udev/rules.d/99-oracle-asmdevices.rules
<span class="token keyword">done</span>

<span class="token comment"># $parent is used if the device is partitioned, $name is used if the device is not partitioned.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Load-Updated-Block-Device-Partitions-x2F-sbin-x2F-partprobe"><a href="#Load-Updated-Block-Device-Partitions-x2F-sbin-x2F-partprobe" class="headerlink" title="Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)"></a>Load Updated Block Device Partitions (&#x2F;sbin&#x2F;partprobe)</h2><p>Load updated block device partition tables.<br>For OL5, OL6 and OL7</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /sbin/partprobe /dev/sdb1</span>
<span class="token comment"># /sbin/partprobe /dev/sdc1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>For OL8</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /sbin/partx -u /dev/sbc1</span>
<span class="token comment"># /sbin/partx -u /dev/sdc1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Test-Rules-udevtest"><a href="#Test-Rules-udevtest" class="headerlink" title="Test Rules (udevtest)"></a>Test Rules (udevtest)</h2><p>Test the rules are working as expected.<br>For OL5</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># udevtest /block/sdb/sdb1</span>
<span class="token comment"># udevtest /block/sdc/sdc1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>For OL6, OL7 and OL8</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># udevadm test /block/sdb/sdb1</span>
<span class="token comment"># udevadm test /block/sdc/sdc1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>The output from the first disk should look something like this.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># udevtest /block/sdb/sdb1</span>
main: looking at device <span class="token string">'/block/sdb/sdb1'</span> from subsystem <span class="token string">'block'</span>
udev_rules_get_name: <span class="token function">add</span> symlink <span class="token string">'disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1'</span>
udev_rules_get_name: <span class="token function">add</span> symlink <span class="token string">'disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1'</span>
run_program: <span class="token string">'/lib/udev/vol_id --export /dev/.tmp-8-17'</span>
run_program: <span class="token string">'/lib/udev/vol_id'</span> returned with status <span class="token number">4</span>
run_program: <span class="token string">'/sbin/scsi_id -g -u -s /block/sdb/sdb1'</span>
run_program: <span class="token string">'/sbin/scsi_id'</span> <span class="token punctuation">(</span>stdout<span class="token punctuation">)</span> <span class="token string">'SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3_'</span>
run_program: <span class="token string">'/sbin/scsi_id'</span> returned with status <span class="token number">0</span>
udev_rules_get_name: rule applied, <span class="token string">'sdb1'</span> becomes <span class="token string">'asm-disk1'</span>
udev_device_event: device <span class="token string">'/block/sdb/sdb1'</span> already <span class="token keyword">in</span> database, validate currently present symlinks
udev_node_add: creating device <span class="token function">node</span> <span class="token string">'/dev/asm-disk1'</span>, major <span class="token operator">=</span> <span class="token string">'8'</span>, minor <span class="token operator">=</span> <span class="token string">'17'</span>, mode <span class="token operator">=</span> <span class="token string">'0660'</span>, uid <span class="token operator">=</span> <span class="token string">'1100'</span>, gid <span class="token operator">=</span> <span class="token string">'1200'</span>
udev_node_add: creating symlink <span class="token string">'/dev/disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1'</span> to <span class="token string">'../../asm-disk1'</span>
udev_node_add: creating symlink <span class="token string">'/dev/disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1'</span> to <span class="token string">'../../asm-disk1'</span>
main: run: <span class="token string">'socket:/org/kernel/dm/multipath_event'</span>
main: run: <span class="token string">'socket:/org/kernel/udev/monitor'</span>
main: run: <span class="token string">'/lib/udev/udev_run_devd'</span>
main: run: <span class="token string">'socket:/org/freedesktop/hal/udev_event'</span>
main: run: <span class="token string">'/sbin/pam_console_apply /dev/asm-disk1 /dev/disk/by-id/scsi-SATA_VBOX_HARDDISK_VBd306dbe0-df3367e3-part1 /dev/disk/by-path/pci-0000:00:0d.0-scsi-1:0:0:0-part1'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Restart-UDEV-Service"><a href="#Restart-UDEV-Service" class="headerlink" title="Restart UDEV Service"></a>Restart UDEV Service</h2><p>Restart the UDEV service.<br>For OL5</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /sbin/udevcontrol reload_rules</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>For OL5 and OL6 : Not needed for OL7 and OL8</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /sbin/start_udev</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>For OL6, OL7 and OL8</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /sbin/udevadm control --reload-rules</span>
<span class="token comment"># /sbin/udevadm trigger</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Check-Ownership-and-Permissions"><a href="#Check-Ownership-and-Permissions" class="headerlink" title="Check Ownership and Permissions"></a>Check Ownership and Permissions</h2><p>Check the disks are now available with the “asm-disk*” alias and the correct ownership and permissions.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ls -al /dev/asm-disk*</span>
brw-rw---- <span class="token number">1</span> oracle dba <span class="token number">8</span>, <span class="token number">17</span> Apr <span class="token number">8</span> <span class="token number">22</span>:47 asm-disk1
brw-rw---- <span class="token number">1</span> oracle dba <span class="token number">8</span>, <span class="token number">33</span> Apr <span class="token number">8</span> <span class="token number">22</span>:47 asm-disk2
brw-rw---- <span class="token number">1</span> oracle dba <span class="token number">8</span>, <span class="token number">49</span> Apr <span class="token number">8</span> <span class="token number">22</span>:47 asm-disk3
brw-rw---- <span class="token number">1</span> oracle dba <span class="token number">8</span>, <span class="token number">65</span> Apr <span class="token number">8</span> <span class="token number">22</span>:47 asm-disk4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>So the ASM_DISKSTRING initialization parameter in the ASM instance can be set to ‘&#x2F;dev&#x2F;asm-disk*’ to identify the ASM disks.</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>ASM</category>
      </categories>
      <tags>
        <tag>udev</tag>
      </tags>
  </entry>
  <entry>
    <title>Create ASM DiskGroup</title>
    <url>/blog/posts/39334fc0.html</url>
    <content><![CDATA[<h1 id="Create-ASM-DiskGroup"><a href="#Create-ASM-DiskGroup" class="headerlink" title="Create ASM DiskGroup"></a>Create ASM DiskGroup</h1><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> system <span class="token keyword">set</span> asm_diskstring<span class="token operator">=</span><span class="token string">'o/100.100.100.*/*'</span> scope<span class="token operator">=</span>both sid<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> DISKGROUP ARCH NORMAL REDUNDANCY
FAILGROUP EXACELL01 <span class="token keyword">DISK</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk01_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk02_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk03_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk04_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk05_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk06_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk07_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk08_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk09_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk10_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk11_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/arch_CD_disk12_exacell01'</span>
FAILGROUP EXACELL02 <span class="token keyword">DISK</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk01_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk02_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk03_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk04_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk05_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk06_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk07_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk08_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk09_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk10_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk11_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/arch_CD_disk12_exacell02'</span>
ATTRIBUTE <span class="token string">'compatible.asm'</span><span class="token operator">=</span><span class="token string">'11.2.0.0.0'</span><span class="token punctuation">,</span><span class="token string">'compatible.rdbms'</span><span class="token operator">=</span><span class="token string">'11.1.0.7.0'</span><span class="token punctuation">,</span><span class="token string">'au_size'</span><span class="token operator">=</span><span class="token string">'4M'</span><span class="token punctuation">,</span><span class="token string">'cell.smart_scan_capable'</span><span class="token operator">=</span><span class="token string">'TRUE'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> DISKGROUP <span class="token keyword">DATA</span> NORMAL REDUNDANCY
FAILGROUP EXACELL01 <span class="token keyword">DISK</span>
<span class="token string">'o/100.100.100.110/data_CD_disk01_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk02_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk03_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk04_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk05_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk06_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk07_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk08_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk09_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk10_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk11_exacell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.110/data_CD_disk12_exacell01'</span>
FAILGROUP EXACELL02 <span class="token keyword">DISK</span>
<span class="token string">'o/100.100.100.111/data_CD_disk01_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk02_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk03_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk04_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk05_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk06_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk07_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk08_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk09_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk10_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk11_exacell02'</span><span class="token punctuation">,</span>
<span class="token string">'o/100.100.100.111/data_CD_disk12_exacell02'</span>
ATTRIBUTE <span class="token string">'compatible.asm'</span><span class="token operator">=</span><span class="token string">'11.2.0.0.0'</span><span class="token punctuation">,</span><span class="token string">'compatible.rdbms'</span><span class="token operator">=</span><span class="token string">'11.1.0.7.0'</span><span class="token punctuation">,</span><span class="token string">'au_size'</span><span class="token operator">=</span><span class="token string">'4M'</span><span class="token punctuation">,</span><span class="token string">'cell.smart_scan_capable'</span><span class="token operator">=</span><span class="token string">'TRUE'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Exadata</category>
      </categories>
      <tags>
        <tag>exadata</tag>
      </tags>
  </entry>
  <entry>
    <title>Exadata Virtual Machine 18.1.20.0.0</title>
    <url>/blog/posts/db2e84da.html</url>
    <content><![CDATA[<h1 id="Exadata-Virtual-Machine-18-1-20-0-0"><a href="#Exadata-Virtual-Machine-18-1-20-0-0" class="headerlink" title="Exadata Virtual Machine 18.1.20.0.0"></a>Exadata Virtual Machine 18.1.20.0.0</h1><blockquote>
<p>System Operation: Oracle Linux Release 7 Update 4<br>Exadata Softeware: V983555-01.zip<br>Oracle Database: p10404530_112030_Linux-x86-64_{1..3}of7.zip<br>System Memory: 16GB<br>X3-2</p>
</blockquote>
<h2 id="Cell-Node"><a href="#Cell-Node" class="headerlink" title="Cell Node"></a>Cell Node</h2><p>建议 GI 软件安装 11.2.0.3.0 版本，11.2.0.4.0 版本存在 BUG，暂时无法排除处理。具体情况查看 Installation Errors 小节。</p>
<ol>
<li><p>Setting network and hostname.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 网卡 ens32 作为 service 网络，ens35 作为 infiniband 网络</span>
nmcli con modify ens32 ipv4.add <span class="token number">192.168</span>.3.110/24 ipv4.gate <span class="token number">192.168</span>.3.1 ipv4.dns <span class="token number">114.114</span>.114.114 ipv4.method manual autoconnect <span class="token function">yes</span>
nmcli con modify ens35 ipv4.add <span class="token number">100.100</span>.100.110/24 ipv4.method manual autoconnect <span class="token function">yes</span>

<span class="token comment"># 将 ifcfg-ens35 网卡配置文件中的 PREFIX=24 参数变更为 NETMASK=255.255.255.0，具体情况查看 Installation Errors 小节</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/PREFIX=24/s/PREFIX=24/NETMASK=255.255.255.0/'</span> /etc/sysconfig/network-scripts/ifcfg-ens35

<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/::1/s/::1/# ::1/'</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">"100.100.100.110 exacell01"</span> <span class="token operator">>></span> /etc/hosts

systemctl disable firewalld <span class="token parameter variable">--now</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/^SELINUX=/s/enforcing/disabled/'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Configuring kernel parameters</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
fs.file-max = 65536
fs.aio-max-nr = 500000000
vm.min_free_kbytes = 512000
net.core.rmem_default = 262144
net.core.wmem_default = 262144
net.core.rmem_max = 8388608
net.core.wmem_max = 4194304
EOF</span>

<span class="token function">cat</span> <span class="token operator">>></span> /etc/security/limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
root soft nofile 131072
root hard nofile 131072
celladmin soft nproc 2047
celladmin hard nproc 16384
celladmin soft nofile 131072
celladmin hard nofile 131072
EOF</span>

<span class="token function">cat</span> <span class="token operator">>></span> /etc/modprobe.d/rds.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
install rds /sbin/modprobe --ignore -install rds &amp;&amp; /sbin/modprobe rds_tcp &amp;&amp; /sbin/modprobe rds_rdma
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Creating log directories.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/log/oracle
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /var/log/oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Installing Cell software.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /tmp/V983555-01
<span class="token function">unzip</span> <span class="token parameter variable">-d</span> /tmp/V983555-01 /tmp/V983555-01.zip
<span class="token builtin class-name">cd</span> /tmp/V983555-01
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> nfsimg-18.1.20.0.0-190911-cell.tar
<span class="token builtin class-name">cd</span> cellbits/
<span class="token function">tar</span> <span class="token parameter variable">-jxvf</span> cellrpms.tbz
yum <span class="token parameter variable">-y</span> localinstall jdk1.8-1.8.0_221-fcs.x86_64.rpm
<span class="token function">unzip</span> cell.bin
yum <span class="token parameter variable">-y</span> localinstall cell-18.1.20.0.0_LINUX.X64_190911-1.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</li>
<li><p>Starting Cell services.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># cd /opt/oracle/cell/cellsrv/bin/</span>
<span class="token comment"># ./cellcli</span>

CellCLI<span class="token operator">></span> alter cell restart services all
Stopping RS services<span class="token punctuation">..</span>.
CELL-01509: Restart Server <span class="token punctuation">(</span>RS<span class="token punctuation">)</span> not responding.
Starting the RS services<span class="token punctuation">..</span>.
Getting the state of RS services<span class="token punctuation">..</span>.  running
Restarting CELLSRV services<span class="token punctuation">..</span>.
The RESTART of CELLSRV services was not successful.
CELL-01531: Unable to parse the cellinit.ora <span class="token function">file</span> due to incorrect parameters <span class="token keyword">in</span> the file.
Restarting MS services<span class="token punctuation">..</span>.
The RESTART of MS services was successful.

CellCLI<span class="token operator">></span> create cell exacell01 <span class="token assign-left variable">interconnect1</span><span class="token operator">=</span>ens35<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Creating virtual disks.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/oracle/cell/disks/raw

<span class="token function">cat</span> <span class="token operator">></span> /tmp/disk.sh <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk01 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk02 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk03 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk04 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk05 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk06 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk07 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk08 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk09 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk10 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk11 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk12 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH01 bs=1M count=1024
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH02 bs=1M count=1024
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH03 bs=1M count=1024
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH04 bs=1M count=1024
EOF</span>

<span class="token function">sh</span> /tmp/disk.sh
<span class="token function">chmod</span> <span class="token number">660</span> /opt/oracle/cell/disks/raw/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Creating Cell grid disks.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cellcli <span class="token parameter variable">-e</span> create celldisk all
cellcli <span class="token parameter variable">-e</span> create flashcache all <span class="token assign-left variable">size</span><span class="token operator">=</span>2G
cellcli <span class="token parameter variable">-e</span> create flashlog all
cellcli <span class="token parameter variable">-e</span> create griddisk all harddisk <span class="token assign-left variable">prefix</span><span class="token operator">=</span>data,size<span class="token operator">=</span>2G
cellcli <span class="token parameter variable">-e</span> create griddisk all harddisk <span class="token assign-left variable">prefix</span><span class="token operator">=</span>arch,size<span class="token operator">=</span>1G
cellcli <span class="token parameter variable">-e</span> create griddisk all harddisk <span class="token assign-left variable">prefix</span><span class="token operator">=</span>ocr,size<span class="token operator">=</span>500M
cellcli <span class="token parameter variable">-e</span> list griddisk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="DB-Node"><a href="#DB-Node" class="headerlink" title="DB Node"></a>DB Node</h2><h3 id="Installing-Oracle-11g-RAC"><a href="#Installing-Oracle-11g-RAC" class="headerlink" title="Installing Oracle 11g RAC"></a>Installing Oracle 11g RAC</h3><ul>
<li><a href="/blog/posts/cb2b044.html">Installing Oracle 11g RAC</a></li>
</ul>
<h3 id="Setting-Up-Configuration-Files-for-a-Database-Server-Host"><a href="#Setting-Up-Configuration-Files-for-a-Database-Server-Host" class="headerlink" title="Setting Up Configuration Files for a Database Server Host"></a>Setting Up Configuration Files for a Database Server Host</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/oracle/cell/network-config

<span class="token builtin class-name">echo</span> <span class="token string">"ipaddress1=100.100.100.210/24"</span> <span class="token operator">></span> /etc/oracle/cell/network-config/cellinit.ora
<span class="token function">cat</span> <span class="token operator">></span> /etc/oracle/cell/network-config/cellip.ora <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
cell="100.100.100.110","100.100.100.111","100.100.100.112"
EOF</span>

<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /etc/oracle/cell/network-config
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /etc/oracle/cell/network-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>kfod</code> verify.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Login as grid</span>
<span class="token comment"># Path is GI Software Unzip Location</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/soft/grid/stage/ext/lib:/lib:/usr/lib
/soft/grid/stage/ext/bin/kfod <span class="token assign-left variable">disks</span><span class="token operator">=</span>all <span class="token assign-left variable">dscvgroup</span><span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installation-Errors"><a href="#Installation-Errors" class="headerlink" title="Installation Errors"></a>Installation Errors</h2><ul>
<li>cell alert log: <code>/opt/oracle/cell/log/diag/asm/cell/exacell01/trace/alert.log</code></li>
</ul>
<h3 id="CELL-02598"><a href="#CELL-02598" class="headerlink" title="CELL-02598"></a>CELL-02598</h3><p>执行 <code>create cell cell1 interconnect1=ens35</code> 时，出现如下错误</p>
<pre class="line-numbers language-cellcli" data-language="cellcli"><code class="language-cellcli">CellCLI&gt; create cell exacell01 interconnect1&#x3D;ens35
CELL-02598: Ipaddress&#x2F;Netmask attribute is not properly configured for interconnect ens35.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>将 ifcfg-ens35 网卡配置文件中的 <code>PREFIX=24</code> 参数变更为<code>NETMASK=255.255.255.0</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/PREFIX=24/s/PREFIX=24/NETMASK=255.255.255.0/'</span> /etc/sysconfig/network-scripts/ifcfg-ens35<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="CELL-02018"><a href="#CELL-02018" class="headerlink" title="CELL-02018"></a>CELL-02018</h3><p>执行 <code>create cell cell1 interconnect1=ens35</code> 时，出现如下错误</p>
<pre class="line-numbers language-cellcli" data-language="cellcli"><code class="language-cellcli">CellCLI&gt; create cell exacell01 interconnect1&#x3D;ens35
Cell exacell03 successfully created
Starting CELLSRV services...
The STARTUP of CELLSRV services was not successful.
CELL-02018: Internal error detected: Not enough open file descriptors.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h4><p>资源限制 <code>nofile</code> 参数设置不足，增加该参数值。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>celladmin@exacell03 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-Sn</span>
<span class="token number">131072</span>
<span class="token punctuation">[</span>celladmin@exacell03 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-Hn</span>
<span class="token number">131072</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="CELL-01554"><a href="#CELL-01554" class="headerlink" title="CELL-01554"></a>CELL-01554</h3><p>重启 cell 服务，MS 服务无法启动</p>
<pre class="line-numbers language-cellcli" data-language="cellcli"><code class="language-cellcli">CellCLI&gt; alter cell restart services all

Stopping RS services...
The SHUTDOWN of RS services was successful.
Starting the RS services...
Getting the state of RS services...  running
Restarting CELLSRV services...
The RESTART of CELLSRV services was successful.
Restarting MS services...
The RESTART of MS services was not successful.
CELL-01554: MS startup failed for unknown reasons.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看 <code>/opt/oracle/cell/log/diag/asm/cell/exacell01/trace/alert.log</code> 日志文件</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token date number">2023-06-05T</span><span class="token time number">21:14:33.160755+08:00</span>
<span class="token punctuation">[</span>RS<span class="token punctuation">]</span> <span class="token property">Start service MS failed with error:</span> <span class="token operator">-</span><span class="token number">74</span><span class="token punctuation">.</span>
<span class="token date number">2023-06-05T</span><span class="token time number">21:14:33.165961+08:00</span>
<span class="token punctuation">[</span>RS<span class="token punctuation">]</span> Monitoring process <span class="token file-path string">/opt/oracle/cell18.1.20.0.0_LINUX.X64_190911/cellsrv/bin/cellrsmmt</span> <span class="token operator">(</span>pid<span class="token operator">:</span> <span class="token number">1042</span><span class="token operator">)</span> returned with error<span class="token operator">:</span> <span class="token number">162</span>
<span class="token date number">2023-06-05T</span><span class="token time number">21:14:33.166253+08:00</span>
<span class="token punctuation">[</span>RS<span class="token punctuation">]</span> Service MS is no longer present
Errors in file <span class="token file-path string">/opt/oracle/cell18.1.20.0.0_LINUX.X64_190911/log/diag/asm/cell/exacell01/trace/rstrc_556_mmt.trc</span>  <span class="token operator">(</span>incident<span class="token operator">=</span><span class="token number">137</span><span class="token operator">)</span><span class="token operator">:</span>
RS<span class="token operator">-</span><span class="token number">7445</span> <span class="token punctuation">[</span>Serv MS is absent<span class="token punctuation">]</span> <span class="token punctuation">[</span>It will not be restarted<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token property">Incident details in:</span> <span class="token file-path string">/opt/oracle/cell18.1.20.0.0_LINUX.X64_190911/log/diag/asm/cell/exacell01/incident/incdir_137/rstrc_556_mmt_i137.trc</span>

<span class="token punctuation">[</span>RS<span class="token punctuation">]</span> Stopped Service MS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看提示的 <code>trace</code> 文件</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.037</span> <span class="token operator">:</span><span class="token number">00000038</span><span class="token operator">:</span> MS process is not alive<span class="token punctuation">.</span> Pid is missing<span class="token punctuation">.</span>
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.037</span> <span class="token operator">:</span><span class="token number">00000039</span><span class="token operator">:</span> Missed a heartbeat for process MS or leaking memory<span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">75</span>
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.037</span> <span class="token operator">:</span><span class="token number">0000003A</span><span class="token operator">:</span> Service MS was not alive<span class="token punctuation">,</span> try starting
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.255</span> <span class="token operator">:</span><span class="token number">00000048</span><span class="token operator">:</span> OS system dependent operation<span class="token operator">:</span>connect_error failed with status<span class="token operator">:</span> <span class="token number">111</span>
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.255</span> <span class="token operator">:</span><span class="token number">00000049</span><span class="token operator">:</span> OS failure message<span class="token operator">:</span> Connection
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.255</span> <span class="token operator">:</span><span class="token number">0000004A</span><span class="token operator">:</span> failure occurred at<span class="token operator">:</span> sosstcpconne
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.255</span> <span class="token operator">:</span><span class="token number">0000004B</span><span class="token operator">:</span> Failed to heartbeat MS <span class="token operator">(</span>port<span class="token operator">:</span> <span class="token number">5043</span> timeout<span class="token operator">:</span> <span class="token number">60</span> sec<span class="token operator">)</span>
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.255</span> <span class="token operator">:</span><span class="token number">0000004C</span><span class="token operator">:</span> socket open error<span class="token operator">:</span> Port no<span class="token operator">:</span> <span class="token number">8888</span><span class="token punctuation">.</span> Received errorno <span class="token number">111</span><span class="token punctuation">.</span> Connection refused
<span class="token date number">2023-06-05</span> <span class="token time number">21:14:23.356</span> <span class="token operator">:</span><span class="token number">0000004D</span><span class="token operator">:</span> mon_proc_pid oldpid<span class="token operator">:</span> <span class="token number">1097</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h4><p>原因暂时未排查清楚，用 root 用户可正常重启</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@exacell01 ~<span class="token punctuation">]</span><span class="token comment"># cd /opt/oracle/cell/cellsrv/bin</span>
<span class="token punctuation">[</span>root@exacell01 bin<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@exacell01 bin<span class="token punctuation">]</span><span class="token comment"># ./cellcli -e alter cell restart services all</span>
Stopping RS services<span class="token punctuation">..</span>.
The SHUTDOWN of RS services was successful.
Starting the RS services<span class="token punctuation">..</span>.
Getting the state of RS services<span class="token punctuation">..</span>.  running
Restarting CELLSRV services<span class="token punctuation">..</span>.
The RESTART of CELLSRV services was successful.
Restarting MS services<span class="token punctuation">..</span>.
The RESTART of MS services was successful.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="CSS-startup-failed-and-Network-initialization-failed"><a href="#CSS-startup-failed-and-Network-initialization-failed" class="headerlink" title="CSS startup failed and Network initialization failed"></a>CSS startup failed and Network initialization failed</h3><p>CSS startup failed when running root.sh on the first node.</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>root<span class="token operator">@</span>exadb01 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">#</span> <span class="token file-path string">/u01/app/11.2.0/grid/root.sh</span>
Performing root user operation for Oracle <span class="token number">11g</span>

<span class="token property">The following environment variables are set as:</span>
    ORACLE_OWNER<span class="token operator">=</span> grid
    ORACLE_HOME<span class="token operator">=</span>  <span class="token file-path string">/u01/app/11.2.0/grid</span>

<span class="token property">Enter the full pathname of the local bin directory:</span> <span class="token punctuation">[</span><span class="token file-path string">/usr/local/bin</span><span class="token punctuation">]</span><span class="token operator">:</span>
The contents of <span class="token string">"dbhome"</span> have not changed<span class="token punctuation">.</span> No need to overwrite<span class="token punctuation">.</span>
The contents of <span class="token string">"oraenv"</span> have not changed<span class="token punctuation">.</span> No need to overwrite<span class="token punctuation">.</span>
The contents of <span class="token string">"coraenv"</span> have not changed<span class="token punctuation">.</span> No need to overwrite<span class="token punctuation">.</span>

Entries will be added to the <span class="token file-path string">/etc/oratab</span> file as needed by
Database Configuration Assistant when a database is created
Finished running generic part of root script<span class="token punctuation">.</span>
Now product<span class="token operator">-</span>specific root actions will be performed<span class="token punctuation">.</span>
<span class="token property">Using configuration parameter file:</span> <span class="token file-path string">/u01/app/11.2.0/grid/crs/install/crsconfig_params</span>
User ignored Prerequisites during installation
Installing Trace File Analyzer
OLR initialization <span class="token operator">-</span> successful
  root wallet
  root wallet cert
  root cert export
  peer wallet
  profile reader wallet
  pa wallet
  peer wallet keys
  pa wallet keys
  peer cert request
  pa cert request
  peer cert
  pa cert
  peer root cert TP
  profile reader root cert TP
  pa root cert TP
  peer pa cert TP
  pa peer cert TP
  profile reader pa cert TP
  profile reader peer cert TP
  peer user cert
  pa user cert
Adding Clusterware entries to inittab
ohasd failed to start
Failed to start the Clusterware<span class="token punctuation">.</span> Last <span class="token number">20</span> lines of the alert log follow<span class="token operator">:</span>
<span class="token date number">2023-06-04</span> <span class="token time number">22:57:07.442</span><span class="token operator">:</span>
<span class="token punctuation">[</span>client<span class="token operator">(</span><span class="token number">23969</span><span class="token operator">)</span><span class="token punctuation">]</span>CRS<span class="token operator">-</span><span class="token number">2101</span><span class="token operator">:</span>The OLR was formatted using version <span class="token number">3</span><span class="token punctuation">.</span>
<span class="token date number">2023-06-04</span> <span class="token time number">23:01:36.538</span><span class="token operator">:</span>
<span class="token punctuation">[</span>client<span class="token operator">(</span><span class="token number">24889</span><span class="token operator">)</span><span class="token punctuation">]</span>CRS<span class="token operator">-</span><span class="token number">2101</span><span class="token operator">:</span>The OLR was formatted using version <span class="token number">3</span><span class="token punctuation">.</span>

<span class="token property">CRS-2672:</span> Attempting to start <span class="token string">'ora.mdnsd'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2676:</span> Start of <span class="token string">'ora.mdnsd'</span> on <span class="token string">'exadb01'</span> succeeded
<span class="token property">CRS-2672:</span> Attempting to start <span class="token string">'ora.gpnpd'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2676:</span> Start of <span class="token string">'ora.gpnpd'</span> on <span class="token string">'exadb01'</span> succeeded
<span class="token property">CRS-2672:</span> Attempting to start <span class="token string">'ora.cssdmonitor'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2672:</span> Attempting to start <span class="token string">'ora.gipcd'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2676:</span> Start of <span class="token string">'ora.cssdmonitor'</span> on <span class="token string">'exadb01'</span> succeeded
<span class="token property">CRS-2676:</span> Start of <span class="token string">'ora.gipcd'</span> on <span class="token string">'exadb01'</span> succeeded
<span class="token property">CRS-2672:</span> Attempting to start <span class="token string">'ora.cssd'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2672:</span> Attempting to start <span class="token string">'ora.diskmon'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2676:</span> Start of <span class="token string">'ora.diskmon'</span> on <span class="token string">'exadb01'</span> succeeded
<span class="token property">CRS-2674:</span> Start of <span class="token string">'ora.cssd'</span> on <span class="token string">'exadb01'</span> failed
<span class="token property">CRS-2679:</span> Attempting to clean <span class="token string">'ora.cssd'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2681:</span> Clean of <span class="token string">'ora.cssd'</span> on <span class="token string">'exadb01'</span> succeeded
<span class="token property">CRS-2673:</span> Attempting to stop <span class="token string">'ora.gipcd'</span> on <span class="token string">'exadb01'</span>
<span class="token property">CRS-2677:</span> Stop of <span class="token string">'ora.gipcd'</span> on <span class="token string">'exadb01'</span> succeeded
<span class="token property">CRS-4000:</span> Command Start failed<span class="token punctuation">,</span> or completed with errors<span class="token punctuation">.</span>
CSS startup failed with return code <span class="token number">1</span>
The exlusive mode cluster start failed<span class="token punctuation">,</span> see Grid Infrastructure alert log for more information
Initial cluster configuration failed<span class="token punctuation">.</span>  See <span class="token file-path string">/u01/app/11.2.0/grid/cfgtoollogs/crsconfig/rootcrs_exadb01.log</span> for details
<span class="token file-path string">/u01/app/11.2.0/grid/perl/bin/perl</span> <span class="token operator">-</span>I<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span><span class="token number">11.2.0</span><span class="token operator">/</span>grid<span class="token operator">/</span>perl<span class="token operator">/</span>lib <span class="token operator">-</span>I<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span><span class="token number">11.2.0</span><span class="token operator">/</span>grid<span class="token operator">/</span>crs<span class="token operator">/</span>install <span class="token file-path string">/u01/app/11.2.0/grid/crs/install/rootcrs.pl</span> execution failed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>See <code>/u01/app/11.2.0/grid/log/exadb01/cssd/ocssd.log</code></p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token date number">2023-06-04</span> <span class="token time number">23:08:37.504</span><span class="token operator">:</span> <span class="token punctuation">[</span>   SKGFD<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">315557632</span><span class="token punctuation">]</span><span class="token level error important">ERROR</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">8</span><span class="token operator">(</span>OS Error <span class="token number">1</span> <span class="token operator">(</span>bind_fail<span class="token punctuation">,</span>skgxpvifconf<span class="token punctuation">,</span>requested interface <span class="token ip-address constant">100.100.100.210</span> failed b
ind<span class="token punctuation">.</span> Check output from ifconfig command<span class="token punctuation">,</span>Error <span class="token number">0</span><span class="token operator">)</span>
<span class="token operator">)</span>
<span class="token date number">2023-06-04</span> <span class="token time number">23:08:37.504</span><span class="token operator">:</span> <span class="token punctuation">[</span>   SKGFD<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">315557632</span><span class="token punctuation">]</span><span class="token level error important">ERROR</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token operator">(</span>OSS Operation oss_initialize failed with error <span class="token number">4</span> <span class="token punctuation">[</span>Network initialization faile
d<span class="token punctuation">]</span>
<span class="token operator">)</span>
<span class="token date number">2023-06-04</span> <span class="token time number">23:08:37.504</span><span class="token operator">:</span> <span class="token punctuation">[</span>    CSSD<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">315557632</span><span class="token punctuation">]</span><span class="token property">clsssnmvDDiscThread:</span> Unable to create clsf context
<span class="token date number">2023-06-04</span> <span class="token time number">23:08:37.504</span><span class="token operator">:</span> <span class="token punctuation">[</span>    CSSD<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">315557632</span><span class="token punctuation">]</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token date number">2023-06-04</span> <span class="token time number">23:08:37.504</span><span class="token operator">:</span> <span class="token punctuation">[</span>    CSSD<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">315557632</span><span class="token punctuation">]</span><span class="token property">clssscExit:</span> CSSD aborting from thread clssnmvDDiscThread
<span class="token date number">2023-06-04</span> <span class="token time number">23:08:37.504</span><span class="token operator">:</span> <span class="token punctuation">[</span>    CSSD<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">315557632</span><span class="token punctuation">]</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token date number">2023-06-04</span> <span class="token time number">23:08:37.504</span><span class="token operator">:</span> <span class="token punctuation">[</span>    CSSD<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">315557632</span><span class="token punctuation">]</span><span class="token operator">(</span><span class="token operator">:</span>CSSSC00012<span class="token operator">:</span><span class="token operator">)</span>clssscExit<span class="token operator">:</span> A fatal error occurred and the CSS daemon is terminating abnorm
ally<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h4><p>安装 GI 软件 11.2.0.3.0 版本，无此报错。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Exadata</category>
      </categories>
      <tags>
        <tag>exadata</tag>
      </tags>
  </entry>
  <entry>
    <title>Automatic Optimizer Statistics Collection</title>
    <url>/blog/posts/6df4f1a1.html</url>
    <content><![CDATA[<h1 id="概述"><a href="# 概述" class="headerlink" title="概述"></a> 概述 </h1><p>   在 Oracle 10g 之前并没有自动收集统计信息的机制，从 Oracle 10g 开始引入了自动收集统计信息的功能，这个功能在 Oracle 10g 中被称为自动统计信息收集（Automatic Statistics Gathering）<br>   在 Oracle 11g 中被称为自动优化器统计信息收集（Automatic Optimizer Statistics Collection）。自动统计信息收集作业能够每天收集普通对象和数据字典的统计信息，但不会收集 X$ 系列表的内部对象统计信息。</p>
<p>  Oracle 的初始化参数 STATISTICS_LEVEL 控制收集统计信息的级别，有三个参数值：<br>  1、 BASIC：收集基本的统计信息 <br>  2、 TYPICAL：收集大部分统计信息（数据库的默认设置）<br>  3、 ALL：收集全部统计信息 <br>  当使用 Oracle 自动收集统计信息时，必须要确保 Oracle 的参数 STATISTICS_LEVEL 的值为 TYPICAL 或者 ALL。默认值为 TYPICAL，该值可以确保数据库自我管理功能所需求的所有主要统计信息的正确收集，及提供最好的综合性能。这个默认值可以能胜任大多数的环境，并且 Oracle 不推荐去修改该值。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>statistics</tag>
      </tags>
  </entry>
  <entry>
    <title>Exadata Virtual Machine 11</title>
    <url>/blog/posts/78416e0d.html</url>
    <content><![CDATA[<h1 id="Exadata-Virtual-Machine-11"><a href="#Exadata-Virtual-Machine-11" class="headerlink" title="Exadata Virtual Machine 11"></a>Exadata Virtual Machine 11</h1><h2 id="Cell-Node"><a href="#Cell-Node" class="headerlink" title="Cell Node:"></a>Cell Node:</h2><ol>
<li><p> 软件包下载 </p>
<p> 可到 <a href="https://edelivery.oracle.com/">https://edelivery.oracle.com/</a> 下载 V46145-01.zip，V27570-01.zip。<br>V46145-01.zip 为 Exadata Cell 11.2.3.2 介质；<br>V27570-01.zip 为 OracleLinux-R5-U7-Server-x86_64-dvd.iso；<br>Oracle 安装包：p10404530_112030_Linux-x86-64_1of7.zip; p10404530_112030_Linux-x86-64_2of7.zip<br>Grid 安装包：p10404530_112030_Linux-x86-64_3of7.zip</p>
</li>
<li><p> 配置 hosts，修改启动内核 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"192.168.184.160 oradb01"</span> <span class="token operator">>></span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">"192.168.184.170 oracell01"</span> <span class="token operator">>></span> /etc/hosts

<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^default.*/default=1/'</span> /etc/grub.conf

<span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 修改资源限制 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"fs.file-max = 65536"</span> <span class="token operator">>></span> /etc/sysctl.conf
<span class="token function">sysctl</span> <span class="token parameter variable">-p</span>

<span class="token function">cat</span> <span class="token operator">>></span> /etc/security/limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
* soft nofile 65536
* hard nofile 65536
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 安装 oracle-vaildated</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> oracle-validated<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 创建日志文件夹 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/log/oracle
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /var/log/oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 安装 Cell 软件 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> V46145-01.zip
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> cellImageMaker_11.2.3.3.1_LINUX.X64_140708-1.x86_64.tar
<span class="token builtin class-name">cd</span> dl180/boot/cellbits

<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> cellrpms.tbz jdk-1.7.0_55-fcs.x86_64.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> jdk-1.7.0_55-fcs.x86_64.rpm

<span class="token function">unzip</span> cell.bin
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> cell-11.2.3.3.1_LINUX.X64_140708-1.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 创建虚拟磁盘 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/oracle/cell/disks/raw
<span class="token function">cat</span> <span class="token operator">></span> disk.sh <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk01 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk02 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk03 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk04 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk05 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk06 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk07 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk08 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk09 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk10 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk11 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/disk12 bs=1M count=5120
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH01 bs=1M count=1024
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH02 bs=1M count=1024
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH03 bs=1M count=1024
dd if=/dev/zero of=/opt/oracle/cell/disks/raw/FLASH04 bs=1M count=1024
EOF</span>

<span class="token function">sh</span> disk.sh
<span class="token function">chmod</span> <span class="token number">660</span> /opt/oracle/cell/disks/raw/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 启动 cell 服务 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">su</span> - celladmin

cellcli <span class="token parameter variable">-e</span> create cell cell01 <span class="token assign-left variable">interconnect1</span><span class="token operator">=</span>eth0
cellcli <span class="token parameter variable">-e</span> alter cell restart services all<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 创建磁盘 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cellcli <span class="token parameter variable">-e</span> create celldisk all
cellcli <span class="token parameter variable">-e</span> create flashcache all <span class="token assign-left variable">size</span><span class="token operator">=</span>2G
cellcli <span class="token parameter variable">-e</span> create flashlog all
cellcli <span class="token parameter variable">-e</span> create griddisk all harddisk <span class="token assign-left variable">prefix</span><span class="token operator">=</span>data,size<span class="token operator">=</span>4G
cellcli <span class="token parameter variable">-e</span> create griddisk all harddisk <span class="token assign-left variable">prefix</span><span class="token operator">=</span>reco
cellcli <span class="token parameter variable">-e</span> list griddisk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="DB-Node"><a href="#DB-Node" class="headerlink" title="DB Node:"></a>DB Node:</h2><ol>
<li><p> 创建 Exadata 配置文件 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/oracle/cell/network-config
<span class="token builtin class-name">echo</span> <span class="token string">"ipaddress1=192.168.184.160/24"</span> <span class="token operator">></span> /etc/oracle/cell/network-config/cellinit.ora
<span class="token builtin class-name">echo</span> <span class="token string">"cell=<span class="token entity"title="\&quot;">\"</span>192.168.184.170<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">></span> /etc/oracle/cell/network-config/cellip.ora
<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /etc/oracle/cell/network-config
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /etc/oracle/cell/network-config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 安装完 Grid 后，创建磁盘组 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> DISKGROUP <span class="token keyword">DATA</span> NORMAL REDUNDANCY
FAILGROUP CELL01_DATA_F1 <span class="token keyword">DISK</span>
<span class="token string">'o/192.168.184.170/data_CD_disk01_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk02_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk03_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk04_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk05_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk06_cell01'</span>
FAILGROUP CELL01_DATA_F2 <span class="token keyword">DISK</span>
<span class="token string">'o/192.168.184.170/data_CD_disk07_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk08_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk09_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk10_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk11_cell01'</span><span class="token punctuation">,</span>
<span class="token string">'o/192.168.184.170/data_CD_disk12_cell01'</span>
ATTRIBUTE <span class="token string">'compatible.asm'</span><span class="token operator">=</span><span class="token string">'11.2.0.0.0'</span><span class="token punctuation">,</span><span class="token string">'compatible.rdbms'</span><span class="token operator">=</span><span class="token string">'11.1.0.7.0'</span><span class="token punctuation">,</span><span class="token string">'au_size'</span><span class="token operator">=</span><span class="token string">'4M'</span><span class="token punctuation">,</span><span class="token string">'cell.smart_scan_capable'</span><span class="token operator">=</span><span class="token string">'TRUE'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Exadata</category>
      </categories>
      <tags>
        <tag>exadata</tag>
      </tags>
  </entry>
  <entry>
    <title>How to Setting Oracle Huagepages Parameters</title>
    <url>/blog/posts/1ae7b462.html</url>
    <content><![CDATA[<h1 id="How-to-Setting-Oracle-Huagepages-Parameters"><a href="#How-to-Setting-Oracle-Huagepages-Parameters" class="headerlink" title="How to Setting Oracle Huagepages Parameters"></a>How to Setting Oracle Huagepages Parameters</h1><ul>
<li><strong>memlock</strong>: KB, At least 90 percent of the current RAM when HugePages memory is enabled and at least 3145728 KB (3 GB) when HugePages memory is disabled.</li>
<li><strong>kernel.shmall</strong>: This parameter sets the total amount of shared memory pages that can be used system wide. Hence, SHMALL should always be at least ceil(SHMMAX &#x2F; PAGESIZE).</li>
<li><strong>kernel.shmmax</strong>: B, This parameter defines the maximum size in bytes of a single shared memory segment that a Linux process can allocate in its virtual address space. Recommended half the size of physical memory in bytes.</li>
<li><strong>vm.nr_hugepages</strong>: value &#x3D; TotalSharedMemory &#x2F; Hugepagesize</li>
</ul>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><div class="note info modern"><p>physical memory: 12288 MB<br>sga_target: 6144 MB<br>pga_aggregate_target: 2048 MB</p>
</div>

<p><strong>MemTotal</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># grep MemTotal /proc/meminfo</span>
MemTotal:       <span class="token number">12077768</span> kB
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># free -k</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:       <span class="token number">12077768</span>     <span class="token number">9707116</span>      <span class="token number">533356</span>      <span class="token number">221304</span>     <span class="token number">1837296</span>     <span class="token number">1843296</span>
Swap:       <span class="token number">8278012</span>     <span class="token number">2460812</span>     <span class="token number">5817200</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Script:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># Check for the kernel version</span>
<span class="token assign-left variable">KERN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-r</span> <span class="token operator">|</span> <span class="token function">awk</span> -F. <span class="token string">'&#123; printf("%d.%d\n",$1,$2); &#125;'</span><span class="token variable">`</span></span>

<span class="token comment"># Find out the Page size</span>
<span class="token assign-left variable">PG_SIZE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>getconf PAGESIZE<span class="token variable">`</span></span>

<span class="token comment"># Find out the HugePage size</span>
<span class="token assign-left variable">HPG_SZ</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> Hugepagesize /proc/meminfo <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">`</span></span>
<span class="token keyword">if</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$HPG_SZ</span>"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"The hugepages may not be supported in the system where the script is being executed."</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># Initialize the counter</span>
<span class="token assign-left variable">NUM_PG</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">'Please input sga_target expect value (GB):'</span> SGA_SIZE
<span class="token assign-left variable">MEM_LOCK</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token parameter variable">-k</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/Mem/ &#123;printf"%d\n",$2*0.9+1&#125;'</span><span class="token variable">`</span></span>
<span class="token assign-left variable">SGE_BYTES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token parameter variable">-b</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/Mem/ &#123;printf"%d\n",$2*0.5+1&#125;'</span><span class="token variable">`</span></span>
<span class="token assign-left variable">ALL_SGES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"(<span class="token variable">$SGA_SIZE</span>+1)*1024*1024*1024/<span class="token variable">$PG_SIZE</span>"</span> <span class="token operator">|</span> <span class="token function">bc</span> <span class="token parameter variable">-q</span><span class="token variable">`</span></span>
<span class="token assign-left variable">NUM_PG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"(<span class="token variable">$SGA_SIZE</span>+1)*1024*1024/<span class="token variable">$HPG_SZ</span>"</span> <span class="token operator">|</span> <span class="token function">bc</span> <span class="token parameter variable">-q</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"memlock = <span class="token variable">$MEM_LOCK</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"shmmax = <span class="token variable">$SGE_BYTES</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"shmall = <span class="token variable">$ALL_SGES</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"nr_hugepages = <span class="token variable">$NUM_PG</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Output:</p>
<pre class="line-numbers language-none"><code class="language-none">Please input sga_target expect value (GB): 6
memlock &#x3D; 10869992
shmmax &#x3D; 6183817217
shmall &#x3D; 1835008
nr_hugepages &#x3D; 3584<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>hugepages</tag>
      </tags>
  </entry>
  <entry>
    <title>How to Switch ArchiveLog Mode</title>
    <url>/blog/posts/35cf2db4.html</url>
    <content><![CDATA[<h1 id="Enabling-ArchiveLog-Mode"><a href="#Enabling-ArchiveLog-Mode" class="headerlink" title="Enabling ArchiveLog Mode"></a>Enabling ArchiveLog Mode</h1><h2 id="For-Single-Instance"><a href="#For-Single-Instance" class="headerlink" title="For Single Instance"></a>For Single Instance</h2><p><strong>Oracle 10g and latest</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_dest_1<span class="token operator">=</span><span class="token string">'location=/archivelog'</span> scope<span class="token operator">=</span>spfile<span class="token punctuation">;</span>

<span class="token keyword">shutdown</span> immediate
startup mount

<span class="token keyword">alter</span> <span class="token keyword">database</span> archivelog<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span><span class="token punctuation">;</span>

<span class="token keyword">alter</span> system switch logfile<span class="token punctuation">;</span>  <span class="token comment">-- 切换归档 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="For-Real-Application-Clusters"><a href="#For-Real-Application-Clusters" class="headerlink" title="For Real Application Clusters"></a>For Real Application Clusters</h2><p><strong>Oracle 10gR2 and latest</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_dest_1<span class="token operator">=</span><span class="token string">'location=+ARCH'</span> sid<span class="token operator">=</span><span class="token string">'*'</span> scope<span class="token operator">=</span>spfile<span class="token punctuation">;</span>

srvctl stop <span class="token keyword">database</span> <span class="token operator">-</span>d coco
srvctl <span class="token keyword">start</span> instance <span class="token operator">-</span>d coco <span class="token operator">-</span>i coco1 <span class="token operator">-</span>o mount

<span class="token keyword">alter</span> <span class="token keyword">database</span> archivelog<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span><span class="token punctuation">;</span>

srvctl <span class="token keyword">start</span> <span class="token keyword">database</span> <span class="token operator">-</span>d coco

<span class="token keyword">alter</span> system archive log <span class="token keyword">current</span><span class="token punctuation">;</span>  <span class="token comment">-- 切换归档 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="Disabling-ArchiveLog-Mode"><a href="#Disabling-ArchiveLog-Mode" class="headerlink" title="Disabling ArchiveLog Mode"></a>Disabling ArchiveLog Mode</h1><h2 id="For-Single-Instance-1"><a href="#For-Single-Instance-1" class="headerlink" title="For Single Instance"></a>For Single Instance</h2><p><strong>Oracle 10g and latest</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">shutdown</span> immediate
startup mount

<span class="token keyword">alter</span> <span class="token keyword">database</span> noarchivelog<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="For-Real-Application-Clusters-1"><a href="#For-Real-Application-Clusters-1" class="headerlink" title="For Real Application Clusters"></a>For Real Application Clusters</h2><p><strong>Oracle 10gR2 and latest</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">srvctl stop <span class="token keyword">database</span> <span class="token operator">-</span>d coco
srvctl <span class="token keyword">start</span> instance <span class="token operator">-</span>d coco <span class="token operator">-</span>i coco1 <span class="token operator">-</span>o mount

<span class="token keyword">alter</span> <span class="token keyword">database</span> noarchivelog<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span><span class="token punctuation">;</span>

srvctl <span class="token keyword">start</span> <span class="token keyword">database</span> <span class="token operator">-</span>d coco<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>archivelog</tag>
      </tags>
  </entry>
  <entry>
    <title>Index</title>
    <url>/blog/posts/41b24805.html</url>
    <content><![CDATA[<p><img src="https://images.cnblogs.com/cnblogs_com/liuning8023/201211/201211172345262843.jpg"></p>
<p>访问索引列的数据一般需要 3 次 IO，Root-Branch-Leaf。<br>访问索引列外的数据需要 4 次 IO，Root-Branch-Leaf- 回表 (TABLE ACCESS BY INDEX ROWID)。<br> 索引对 DML 操作的影响，INSERT &gt; DELETE &gt; UPDATE</p>
<p>[创建索引会引发排序及全表索，排序会非常消耗 CPU 性能，全表锁会阻止 DML 操作]{.red}</p>
<p><strong>索引的三大特点</strong></p>
<ul>
<li>索引树的高度一般比较低。</li>
<li>索引由索引列存储的值及 ROWID 组成。</li>
<li>索引本身是有序的。</li>
</ul>
<p><strong>分区表索引</strong></p>
<ul>
<li>分为全局索引和分区索引。</li>
<li>分区索引，要有使用分区字段条件的场景，否则建议使用全局索引。</li>
</ul>
<p><strong>count(*)优化</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--NULL 和 NOT NULL 不等价，排除 NULL 值，执行计划由 TABLE ACCESS FULL 变为 INDEX FAST FULL SCAN</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> id <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>

<span class="token comment">-- 或将列设置 NOT NULL，执行计划为 INDEX FAST FULL SCAN</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> t <span class="token keyword">modify</span> id <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>MAX&#x2F;MIN 优化</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">--NULL 和 NOT NULL 等价，执行计划为 INDEX FULL SCAN (MIN/MAX)，MIN 一定位于左边的叶子块，MAX 一定位于最右边的叶子块</span>
<span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span>

<span class="token comment">--Oracle 无法同时在左边和最右边读取，执行计划为 TABLE ACCESS FULL</span>
<span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span>

<span class="token comment">-- 分开查询，执行计划为 INDEX FULL SCAN (MIN/MAX)</span>
<span class="token keyword">select</span> min<span class="token punctuation">,</span>max <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> mix<span class="token punctuation">(</span>id<span class="token punctuation">)</span> min <span class="token keyword">from</span> t<span class="token punctuation">)</span> a<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> max <span class="token keyword">from</span> t<span class="token punctuation">)</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>回表优化</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查看索引列以外的数据，会出现回表，执行计划 TABLE ACCESS BY INDEX ROWID</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>索引全扫与索引快速全扫</strong></p>
<ul>
<li>INDEX FAST FULL SCAN 一次读取多个索引块，INDEX FULL SCAN 一次只读取一个索引块。</li>
<li>INDEX FAST FULL SCAN 一次读取多个索引块不容易保持有序，而 INDEX FULL SCAN 一次读取一个索引块可以保持有序，因此在有排序的场合，INDEX FULL SCAN 的顺序读可以消除排序，INDEX FAST FULL SCAN 虽然减少了逻辑读，但是无法消除排序。</li>
</ul>
<p><strong>UNION 合并优化</strong></p>
<p>UNION 合并会去除重复记录，UNION ALL 则是简单的合并，在 UNION 中索引一般无法消除排序，最常见的优化是将 UNION 改为 UNION ALL。</p>
<p><strong>联合索引</strong></p>
<p>联合索引不宜超过 3 个字段，否则不仅影响定位数据，更严重影响更新性能。可以用类似如下方式测试联合字段返回的记录是否比单个字段记录少得多。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> a<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>在两列都是等值查询的情况下，组合索引的列无论哪一列在前，性能都一样;</p>
<p>在一列是范围查询，一列是等值查询的情况下，等值查询列在前，范围查询列在后，这样索引才最高效；</p>
<p>单列的查询列和联合索引的前置列一样，那单列可以不建索引，直接利用联合索引来进行检索数据。</p>
</blockquote>
<p><strong>位图索引</strong></p>
<p>位图索引的适用场景要满足两个条件：一，位图索引列大量重复；二，该表极少更新。</p>
<p><strong>函数索引</strong></p>
<p>对索引列进行运算会导致索引无法使用，在无法避免列运算时，可以创建函数索引加以优化。</p>
<h4 id="分析是否需要重建索引"><a href="# 分析是否需要重建索引" class="headerlink" title="分析是否需要重建索引"></a>分析是否需要重建索引 </h4><p> 分析索引的数据块是否有坏块，以及根据分析得到的数据（存放在 index_stats）來判断索引是否需要重新建立。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">analyze</span> <span class="token keyword">index</span> AATD_IDX1 validate structure<span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>validate structure 有两种模式：<br>online ：（默认）会对表加一个 4 级別的锁（表共享），对 run 系統可能造成一定的影响。<br>offline ：没有表 lock 的影响，但当以 online 模式分析时， 在视图 index_stats 没有统计信息。</p>
</blockquote>
<p>从 9i 开始，Oracle 以建议使用 dbms_stats package 代替 analyze 了。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>gather_table_stats<span class="token punctuation">(</span>‘用户名’<span class="token punctuation">,</span>‘表名’<span class="token punctuation">,</span><span class="token keyword">cascade</span><span class="token operator">=</span><span class="token operator">></span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>下面视图只支持：analyze index 命令</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> height<span class="token punctuation">,</span>DEL_LF_ROWS<span class="token operator">/</span>LF_ROWS <span class="token keyword">from</span> index_stats<span class="token punctuation">;</span>
HEIGHT DEL_LF_ROWS<span class="token operator">/</span>LF_ROWS
<span class="token comment">---------- -------------------</span>
    <span class="token number">1</span>                   <span class="token number">0</span>
Executed <span class="token operator">in</span> <span class="token number">0.381</span> seconds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当查询出来的 height&gt;&#x3D;4，或者 DEL_LF_ROWS&#x2F;LF_ROWS&gt;0.2 的场合, 该索引考虑重建。</p>
<h4 id="重建索引"><a href="# 重建索引" class="headerlink" title="重建索引"></a>重建索引</h4><ol>
<li><p>删除创建索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">index</span> idx_id_t1<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> idx_id_t1 <span class="token keyword">on</span> t1<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>说明：此方式耗时间，无法在 24*7 环境中实现，不建议使用。</p>
</li>
<li><p>重建索引</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">index</span> idx_id_t1 rebuild<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">index</span> idx_id_t1 rebuild online<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>说明：此方式比较快，可以在 24*7 环境中实现，建议使用此方式。</p>
<blockquote>
<p>rebuild 与 rebuild online 的区别</p>
<ol>
<li><p>rebuild 根据统计信息的 cost 采用 index fast full scan 或者 table full scan 方式读取原索引中的数据来构建一个新的索引，有排序的操作; rebuild online 执行表扫描获取数据，有排序的操作。</p>
</li>
<li><p>rebuild 会阻塞 dml 操作，rebuild online 不会阻塞 dml 操作。rebuild online 时系统会产生一个 SYS_JOURNAL_xxx 的 IOT 类型的系统临时日志表, 所有 rebuild online 时索引的变化都记录在这个表中，当新的索引创建完成后，把这个表的记录维护到新的索引中去，然后 drop 掉旧的索引，rebuild online 就完成了。</p>
</li>
</ol>
</blockquote>
</li>
</ol>
<p>注意点：</p>
<ol>
<li>执行 rebuild 操作时，需要检查表空间是否足够</li>
<li>虽然说 rebuild online 操作允许 dml 操作，但是还是建议在业务不繁忙时间段进行 rebuild 操作会产生大量 redo log</li>
</ol>
<h4 id="重建分区索引"><a href="# 重建分区索引" class="headerlink" title="重建分区索引"></a>重建分区索引</h4><ol>
<li>重建分区表上的分区索引:</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">index</span> indexname rebuild <span class="token keyword">partition</span> PARTITION_NAME <span class="token keyword">tablespace</span> tablespacename<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'alter index'</span><span class="token operator">||</span> index_name <span class="token operator">||</span> <span class="token string">'rebuild partition'</span><span class="token operator">||</span> partition_name <span class="token operator">||</span> <span class="token string">'online;'</span> <span class="token keyword">from</span> user_ind_partitions <span class="token keyword">where</span> index_name <span class="token operator">=</span><span class="token string">'索引'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>子分区索引重建：</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">index</span> indexname rebuild subpartition PARTITION_NAME <span class="token keyword">tablespace</span> tablespacename<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'alter index'</span><span class="token operator">||</span> index_name <span class="token operator">||</span> <span class="token string">'rebuild subpartition'</span><span class="token operator">||</span> subpartition_name <span class="token operator">||</span> <span class="token string">'online;'</span> <span class="token keyword">from</span> user_ind_subpartitions<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>注：这里的 PARTITION_NAME 指 USER_IND_PARTITIONS 中的 PARTITION_NAME(索引分区中的索引分区名)</p>
<ol start="3">
<li>查询分区表索引所在的分区</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> PI<span class="token punctuation">.</span>TABLE_NAME<span class="token punctuation">,</span>
IP<span class="token punctuation">.</span>INDEX_NAME<span class="token punctuation">,</span>
IP<span class="token punctuation">.</span>PARTITION_NAME<span class="token punctuation">,</span>
IP<span class="token punctuation">.</span><span class="token keyword">STATUS</span><span class="token punctuation">,</span>
IP<span class="token punctuation">.</span>GLOBAL_STATS
<span class="token keyword">FROM</span> USER_PART_INDEXES PI<span class="token punctuation">,</span> USER_IND_PARTITIONS IP
<span class="token keyword">WHERE</span> PI<span class="token punctuation">.</span>INDEX_NAME <span class="token operator">=</span> IP<span class="token punctuation">.</span>INDEX_NAME <span class="token operator">AND</span> PI<span class="token punctuation">.</span>TABLE_NAME <span class="token operator">=</span> <span class="token string">'表名'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>index</tag>
      </tags>
  </entry>
  <entry>
    <title>Password Expired Limited</title>
    <url>/blog/posts/f6117f7c.html</url>
    <content><![CDATA[<h1 id="Oracle 密码过期，取消密码 180 天限制"><a href="#Oracle 密码过期，取消密码 180 天限制" class="headerlink" title="Oracle 密码过期，取消密码 180 天限制"></a>Oracle 密码过期，取消密码 180 天限制 </h1><ol>
<li> 查看用户的 profile</li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> username<span class="token punctuation">,</span> profile <span class="token keyword">FROM</span> dba_users <span class="token keyword">WHERE</span> username<span class="token operator">=</span><span class="token string">'EXFSYS'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li> 查看 profile 的密码有效期设置 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dba_profiles s <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span>profile<span class="token operator">=</span><span class="token string">'DEFAULT'</span> <span class="token operator">AND</span> resource_name <span class="token operator">LIKE</span> <span class="token string">'PASSWORD%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="3">
<li> 将密码有效期由默认的 180 天修改成“无限制”，修改之后不需要重启动数据库，会立即生效 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> PROFILE <span class="token keyword">DEFAULT</span> <span class="token keyword">LIMIT</span> PASSWORD_LIFE_TIME UNLIMITED<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="4">
<li> 用户再改一次密码 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> exfsys identified <span class="token keyword">by</span> abc123<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="5">
<li> 用户解锁 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> exfsys account <span class="token keyword">unlock</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>Job Schedule</title>
    <url>/blog/posts/f322012a.html</url>
    <content><![CDATA[<ol>
<li><p> 运行 job</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">begin</span>
  DBMS_JOB<span class="token punctuation">.</span>RUN<span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* job id */</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 禁用 &#x2F; 启用 job</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">begin</span>
  dbms_job<span class="token punctuation">.</span>broken<span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token operator">/</span>

<span class="token keyword">begin</span>
  dbms_job<span class="token punctuation">.</span>broken<span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 删除 job</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">begin</span>
  dbms_job<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>job</tag>
      </tags>
  </entry>
  <entry>
    <title>Script Hugepages Settings</title>
    <url>/blog/posts/c62bc587.html</url>
    <content><![CDATA[<h1 id="Script-Hugepages-Settings"><a href="#Script-Hugepages-Settings" class="headerlink" title="Script Hugepages Settings"></a>Script Hugepages Settings</h1><p>Oracle database hugepages settings script.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#</span>
<span class="token comment"># hugepages_settings.sh</span>
<span class="token comment">#</span>
<span class="token comment"># Linux bash script to compute values for the</span>
<span class="token comment"># recommended HugePages/HugeTLB configuration</span>
<span class="token comment"># on Oracle Linux</span>
<span class="token comment">#</span>
<span class="token comment"># Note: This script does calculation for all shared memory</span>
<span class="token comment"># segments available when the script is run, no matter it</span>
<span class="token comment"># is an Oracle RDBMS shared memory segment or not.</span>
<span class="token comment">#</span>
<span class="token comment"># This script is provided by Doc ID 401749.1 from My Oracle Support</span>
<span class="token comment"># http://support.oracle.com</span>

<span class="token comment"># Welcome text</span>
<span class="token builtin class-name">echo</span> <span class="token string">"
This script is provided by Doc ID 401749.1 from My Oracle Support
(http://support.oracle.com) where it is intended to compute values for
the recommended HugePages/HugeTLB configuration for the current shared
memory segments on Oracle Linux. Before proceeding with the execution please note following:
 * For ASM instance, it needs to configure ASMM instead of AMM.
 * The 'pga_aggregate_target' is outside the SGA and
   you should accommodate this while calculating the overall size.
 * In case you changes the DB SGA size,
   as the new SGA will not fit in the previous HugePages configuration,
   it had better disable the whole HugePages,
   start the DB with new SGA size and run the script again.
And make sure that:
 * Oracle Database instance(s) are up and running
 * Oracle Database 11g Automatic Memory Management (AMM) is not setup
   (See Doc ID 749851.1)
 * The shared memory segments can be listed by command:
     # ipcs -m


Press Enter to proceed..."</span>

<span class="token builtin class-name">read</span>

<span class="token comment"># Check for the kernel version</span>
<span class="token assign-left variable">KERN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-r</span> <span class="token operator">|</span> <span class="token function">awk</span> -F. <span class="token string">'&#123; printf("%d.%d\n",$1,$2); &#125;'</span><span class="token variable">`</span></span>

<span class="token comment"># Find out the HugePage size</span>
<span class="token assign-left variable">HPG_SZ</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> Hugepagesize /proc/meminfo <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $2&#125;'</span><span class="token variable">`</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$HPG_SZ</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"The hugepages may not be supported in the system where the script is being executed."</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># Initialize the counter</span>
<span class="token assign-left variable">NUM_PG</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token comment"># Cumulative number of pages required to handle the running shared memory segments</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">SEG_BYTES</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span>ipcs <span class="token parameter variable">-m</span> <span class="token operator">|</span> <span class="token function">cut</span> -c44-300 <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"[0-9][0-9]*"</span><span class="token variable">`</span></span>
<span class="token keyword">do</span>
    <span class="token assign-left variable">MIN_PG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$SEG_BYTES</span>/(<span class="token variable">$HPG_SZ</span>*1024)"</span> <span class="token operator">|</span> <span class="token function">bc</span> <span class="token parameter variable">-q</span><span class="token variable">`</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$MIN_PG</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">NUM_PG</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$NUM_PG</span>+<span class="token variable">$MIN_PG</span>+1"</span> <span class="token operator">|</span> <span class="token function">bc</span> <span class="token parameter variable">-q</span><span class="token variable">`</span></span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>

<span class="token assign-left variable">RES_BYTES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$NUM_PG</span> * <span class="token variable">$HPG_SZ</span> * 1024"</span> <span class="token operator">|</span> <span class="token function">bc</span> <span class="token parameter variable">-q</span><span class="token variable">`</span></span>

<span class="token comment"># An SGA less than 100MB does not make sense</span>
<span class="token comment"># Bail out if that is the case</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$RES_BYTES</span> <span class="token parameter variable">-lt</span> <span class="token number">100000000</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"***********"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"** ERROR **"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"***********"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"Sorry! There are not enough total of shared memory segments allocated for
HugePages configuration. HugePages can only be used for shared memory segments
that you can list by command:

    # ipcs -m

of a size that can match an Oracle Database SGA. Please make sure that:
 * Oracle Database instance is up and running
 * Oracle Database 11g Automatic Memory Management (AMM) is not configured"</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># Finish with results</span>
<span class="token keyword">case</span> <span class="token variable">$KERN</span> <span class="token keyword">in</span>
    <span class="token string">'2.4'</span><span class="token punctuation">)</span> <span class="token assign-left variable">HUGETLB_POOL</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$NUM_PG</span>*<span class="token variable">$HPG_SZ</span>/1024"</span> <span class="token operator">|</span> <span class="token function">bc</span> <span class="token parameter variable">-q</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
           <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.hugetlb_pool = <span class="token variable">$HUGETLB_POOL</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">'2.6'</span><span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.nr_hugepages = <span class="token variable">$NUM_PG</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">'3.8'</span><span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.nr_hugepages = <span class="token variable">$NUM_PG</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">'3.10'</span><span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.nr_hugepages = <span class="token variable">$NUM_PG</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">'4.1'</span><span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.nr_hugepages = <span class="token variable">$NUM_PG</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">'4.14'</span><span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.nr_hugepages = <span class="token variable">$NUM_PG</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">'4.18'</span><span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.nr_hugepages = <span class="token variable">$NUM_PG</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token string">'5.4'</span><span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Recommended setting: vm.nr_hugepages = <span class="token variable">$NUM_PG</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    *<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Kernel version <span class="token variable">$KERN</span> is not supported by this script (yet). Exiting."</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>

<span class="token comment"># End</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>hugepages</tag>
      </tags>
  </entry>
  <entry>
    <title>Table</title>
    <url>/blog/posts/37e8a042.html</url>
    <content><![CDATA[<p><strong>DBA_TABLES &gt;&#x3D; ALL_TABLES &gt;&#x3D; USER_TABLES</strong></p>
<ul>
<li>DBA_TABLES：DBA 拥有的或者可以访问的所有关系表 </li>
<li>ALL_TABLES：某一用户所拥有的或者可以访问的所有关系表 </li>
<li>USER_TABLES：某一用户所拥有的所有关系表 </li>
</ul>
<p> 查看表属于哪个用户 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> owner <span class="token keyword">from</span> dba_tables <span class="token keyword">where</span> table_name<span class="token operator">=</span>upper<span class="token punctuation">(</span><span class="token string">'table_name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>table</tag>
      </tags>
  </entry>
  <entry>
    <title>user_privs</title>
    <url>/blog/posts/eb6b8ac4.html</url>
    <content><![CDATA[<h1 id="user-privs"><a href="#user-privs" class="headerlink" title="user_privs"></a>user_privs</h1><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询系统权限，角色 </span>
<span class="token keyword">select</span> grantee<span class="token punctuation">,</span>privilege <span class="token keyword">as</span> privs_or_roles<span class="token punctuation">,</span>admin_option <span class="token keyword">from</span> dba_sys_privs <span class="token keyword">where</span> grantee<span class="token operator">=</span><span class="token string">'JOVE'</span>
<span class="token keyword">union</span>
<span class="token keyword">select</span> grantee<span class="token punctuation">,</span>granted_role<span class="token punctuation">,</span>admin_option <span class="token keyword">from</span> dba_role_privs <span class="token keyword">where</span> grantee<span class="token operator">=</span><span class="token string">'JOVE'</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询对象权限 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_tab_privs <span class="token keyword">where</span> grantee<span class="token operator">=</span><span class="token string">'JOVE'</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询角色 / 角色权限 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_roles<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> role_sys_privs <span class="token keyword">where</span> role<span class="token operator">=</span><span class="token string">'DBA'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> role_tab_privs <span class="token keyword">where</span> role<span class="token operator">=</span><span class="token string">'DBA'</span><span class="token punctuation">;</span>

<span class="token comment">-- 数据库提供的系统权限 / 对象权限 </span>
<span class="token keyword">select</span> name <span class="token keyword">from</span> sys<span class="token punctuation">.</span>system_privilege_map<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_privilege_map<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>privs</tag>
      </tags>
  </entry>
  <entry>
    <title>About DataGuard</title>
    <url>/blog/posts/33ac12b3.html</url>
    <content><![CDATA[<h1 id="About-DataGuard"><a href="#About-DataGuard" class="headerlink" title="About DataGuard"></a>About DataGuard</h1><h2 id="Protection-Modes"><a href="#Protection-Modes" class="headerlink" title="Protection Modes"></a>Protection Modes</h2><ul>
<li><p><strong>Maximum Availability</strong>: This mode provides the highest level of data protection by ensuring zero data loss during primary database shutdown or failure.</p>
</li>
<li><p><strong>Maximum Performance</strong>: This mode aims to minimize any performance impact on the primary database by allowing potential data loss in case of a disaster. In this mode, the primary database does not wait for confirmation from one or more standby databases before committing transactions.</p>
</li>
<li><p><strong>Maximum Protection</strong>: This mode prioritizes data safety over performance by ensuring that transactions are not considered committed until all configured standby databases have received and written the redo data. As a result, it provides the highest resilience against data loss but may have an impact on primary database performance.</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>DataGuard</category>
      </categories>
      <tags>
        <tag>about</tag>
      </tags>
  </entry>
  <entry>
    <title>Creating a Physical Standby Database</title>
    <url>/blog/posts/a127f611.html</url>
    <content><![CDATA[<h1 id="Creating-a-Physical-Standby-Database"><a href="#Creating-a-Physical-Standby-Database" class="headerlink" title="Creating a Physical Standby Database"></a>Creating a Physical Standby Database</h1><h2 id="Preparing-the-Primary-Database-for-Standby-Database-Creation"><a href="#Preparing-the-Primary-Database-for-Standby-Database-Creation" class="headerlink" title="Preparing the Primary Database for Standby Database Creation"></a>Preparing the Primary Database for Standby Database Creation</h2><h3 id="Enable-an-Appropriate-Logging-Mode"><a href="#Enable-an-Appropriate-Logging-Mode" class="headerlink" title="Enable an Appropriate Logging Mode"></a>Enable an Appropriate Logging Mode</h3><ul>
<li><p><code>FORCE LOGGING</code> mode prevents any load operation from being performed in a nonlogged manner. This can slow down the load process because the loaded data must be copied into the redo logs. FORCE LOGGING mode is enabled using the following command:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">FORCE</span> LOGGING<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>STANDBY NOLOGGING FOR DATA AVAILABILITY</code> mode causes the load operation to send the loaded data to each standby through its own connection to the standby. The commit is delayed until all the standbys have applied the data as part of running managed recovery in an Active Data Guard environment. It is enabled with the following command:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">SET</span> STANDBY NOLOGGING <span class="token keyword">FOR</span> <span class="token keyword">DATA</span> AVAILABILITY<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><code>STANDBY NOLOGGING FOR LOAD PERFORMANCE</code> is similar to the previous mode except that the loading process can stop sending the data to the standbys if the network cannot keep up with the speed at which data is being loaded to the primary. In this mode it is possible that the standbys may have missing data, but each standby automatically fetches the data from the primary as a normal part of running managed recovery in an Active Data Guard environment. It is enabled with the following command:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">SET</span> STANDBY NOLOGGING <span class="token keyword">FOR</span> <span class="token keyword">LOAD</span> PERFORMANCE<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<div class="note info modern"><p>Note:When you enable <code>STANDBY NOLOGGING FOR DATA AVAILABILITY</code> or <code>STANDBY NOLOGGING FOR LOAD PERFORMANCE</code> on the primary database, any standbys that are using multi-instance redo apply functionality will stop applying redo with the error ORA-10892. You must first restart redo apply and allow the affected standbys to progress past the NOLOGGING operation period and then enable multi-instance redo apply.</p>
</div>

<h3 id="Configure-Redo-Transport-Authentication"><a href="#Configure-Redo-Transport-Authentication" class="headerlink" title="Configure Redo Transport Authentication"></a>Configure Redo Transport Authentication</h3><h3 id="Configure-the-Primary-Database-to-Receive-Redo-Data"><a href="#Configure-the-Primary-Database-to-Receive-Redo-Data" class="headerlink" title="Configure the Primary Database to Receive Redo Data"></a>Configure the Primary Database to Receive Redo Data</h3><p>It is a best practice to configure the primary database to receive redo if this is the first time a standby database is added to the configuration.<br>The primary database can then quickly transition to the standby role and begin receiving redo data, if necessary.<br>To create a standby redo log, use the SQL <code>ALTER DATABASE ADD STANDBY LOGFILE</code> statement. For example:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">ADD</span> STANDBY LOGFILE <span class="token punctuation">(</span><span class="token string">'/oracle/dbs/slog1.rdo'</span><span class="token punctuation">)</span> SIZE <span class="token number">500</span>M<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">ADD</span> STANDBY LOGFILE <span class="token punctuation">(</span><span class="token string">'/oracle/dbs/slog2.rdo'</span><span class="token punctuation">)</span> SIZE <span class="token number">500</span>M<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="Set-Primary-Database-Initialization-Parameters"><a href="#Set-Primary-Database-Initialization-Parameters" class="headerlink" title="Set Primary Database Initialization Parameters"></a>Set Primary Database Initialization Parameters</h3><p>The configuration examples use the names shown in the following table:</p>
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Primary</th>
<th>Physical standby</th>
</tr>
</thead>
<tbody><tr>
<td>DB_NAME</td>
<td>orcl</td>
<td>orcl</td>
</tr>
<tr>
<td>DB_UNIQUE_NAME</td>
<td>chicago</td>
<td>boston</td>
</tr>
<tr>
<td>Oracle Net Service Name</td>
<td>chicago</td>
<td>boston</td>
</tr>
</tbody></table>
<p>The parameters shown in this example are valid for the Chicago database when it is running in either the primary or the standby database role.</p>
<pre class="line-numbers language-none"><code class="language-none">DB_NAME&#x3D;orcl
DB_UNIQUE_NAME&#x3D;chicago
LOG_ARCHIVE_CONFIG&#x3D;&#39;DG_CONFIG&#x3D;(chicago,boston)&#39;
CONTROL_FILES&#x3D;&#39;&#x2F;arch1&#x2F;chicago&#x2F;control1.ctl&#39;, &#39;&#x2F;arch2&#x2F;chicago&#x2F;control2.ctl&#39;
LOG_ARCHIVE_DEST_1&#x3D;
 &#39;LOCATION&#x3D;USE_DB_RECOVERY_FILE_DEST 
  VALID_FOR&#x3D;(ALL_LOGFILES,ALL_ROLES)
  DB_UNIQUE_NAME&#x3D;chicago&#39;
LOG_ARCHIVE_DEST_2&#x3D;
 &#39;SERVICE&#x3D;boston ASYNC
  VALID_FOR&#x3D;(ONLINE_LOGFILES,PRIMARY_ROLE) 
  DB_UNIQUE_NAME&#x3D;boston&#39;
REMOTE_LOGIN_PASSWORDFILE&#x3D;EXCLUSIVE
LOG_ARCHIVE_FORMAT&#x3D;%t_%s_%r.arc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>The following shows the additional standby role initialization parameters on the primary database. These parameters take effect when the primary database is transitioned to the standby role.</p>
<pre class="line-numbers language-none"><code class="language-none">FAL_SERVER&#x3D;boston
DB_FILE_NAME_CONVERT&#x3D;&#39;&#x2F;boston&#x2F;&#39;,&#39;&#x2F;chicago&#x2F;&#39;
LOG_FILE_NAME_CONVERT&#x3D;&#39;&#x2F;boston&#x2F;&#39;,&#39;&#x2F;chicago&#x2F;&#39; 
STANDBY_FILE_MANAGEMENT&#x3D;AUTO<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>DataGuard</category>
      </categories>
      <tags>
        <tag>physical standby</tag>
      </tags>
  </entry>
  <entry>
    <title>endian_format</title>
    <url>/blog/posts/24a83795.html</url>
    <content><![CDATA[<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$transportable_platform <span class="token keyword">order</span> <span class="token keyword">by</span> platform_id<span class="token punctuation">;</span>

PLATFORM_ID PLATFORM_NAME                            ENDIAN_FORMAT
<span class="token comment">----------- ---------------------------------------- --------------</span>
          <span class="token number">1</span> Solaris<span class="token punctuation">[</span>tm<span class="token punctuation">]</span> OE <span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>                  Big
          <span class="token number">2</span> Solaris<span class="token punctuation">[</span>tm<span class="token punctuation">]</span> OE <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>                  Big
          <span class="token number">3</span> HP<span class="token operator">-</span>UX <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>                           Big
          <span class="token number">4</span> HP<span class="token operator">-</span>UX IA <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>                        Big
          <span class="token number">5</span> HP Tru64 UNIX                            Little
          <span class="token number">6</span> AIX<span class="token operator">-</span>Based Systems <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>               Big
          <span class="token number">7</span> Microsoft Windows IA <span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>            Little
          <span class="token number">8</span> Microsoft Windows IA <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>            Little
          <span class="token number">9</span> IBM zSeries Based Linux                  Big
         <span class="token number">10</span> Linux IA <span class="token punctuation">(</span><span class="token number">32</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>                        Little
         <span class="token number">11</span> Linux IA <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span><span class="token punctuation">)</span>                        Little
         <span class="token number">12</span> Microsoft Windows x86 <span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span>             Little
         <span class="token number">13</span> Linux x86 <span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span>                         Little
         <span class="token number">15</span> HP <span class="token keyword">Open</span> VMS                              Little
         <span class="token number">16</span> Apple Mac OS                             Big
         <span class="token number">17</span> Solaris Operating System <span class="token punctuation">(</span>x86<span class="token punctuation">)</span>           Little
         <span class="token number">18</span> IBM Power Based Linux                    Big
         <span class="token number">19</span> HP IA <span class="token keyword">Open</span> VMS                           Little
         <span class="token number">20</span> Solaris Operating System <span class="token punctuation">(</span>x86<span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">)</span>        Little
         <span class="token number">21</span> Apple Mac OS <span class="token punctuation">(</span>x86<span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">)</span>                    Little<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>endian</tag>
      </tags>
  </entry>
  <entry>
    <title>exp 9i - 11g</title>
    <url>/blog/posts/d13c15c9.html</url>
    <content><![CDATA[<ol>
<li> 检查 segment 大小、对象个数、job、所有表的记录数 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">spool check_object_source<span class="token operator">/</span>target<span class="token punctuation">.</span>log
<span class="token keyword">set</span> pagesize <span class="token number">10000</span>
prompt <span class="token comment">---------------segments_bytes_G</span>
<span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span> owner<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span>
prompt <span class="token comment">---------------object total amounts</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dba_objects <span class="token keyword">where</span> owner<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span>
prompt <span class="token comment">---------------object type amounts</span>
<span class="token keyword">select</span> owner<span class="token punctuation">,</span>object_type<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dba_objects <span class="token keyword">where</span> owner<span class="token operator">=</span><span class="token string">'XXXX'</span> <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span>object_type <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span>
prompt<span class="token comment">-----------------job amounts</span>
<span class="token keyword">select</span> job<span class="token punctuation">,</span>what<span class="token punctuation">,</span>broken <span class="token keyword">from</span> dba_jobs <span class="token keyword">where</span> log_user<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span>
prompt <span class="token comment">---------------table records</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> XXXX<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span>
spool <span class="token keyword">off</span>
<span class="token keyword">exit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li> 创建表空间 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">tablespace</span> XX datafile <span class="token string">'/xxx/xxx1.dbf'</span> size <span class="token number">30</span>g<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">tablespace</span> XX <span class="token keyword">add</span> datafile <span class="token string">'/xxx/xxx2.dbf'</span> size <span class="token number">30</span>g<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">tablespace</span> XX <span class="token keyword">add</span> datafile <span class="token string">'/xxx/xxx3.dbf'</span> size <span class="token number">30</span>g<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li> 创建用户 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> dbms_metadata<span class="token punctuation">.</span>get_ddl<span class="token punctuation">(</span><span class="token string">'USER'</span><span class="token punctuation">,</span><span class="token string">'XXXX'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dba_users<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="4">
<li> 迁移用户权限 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 表空间配额 </span>
<span class="token keyword">select</span> dbms_metadata<span class="token punctuation">.</span>get_granted_ddl<span class="token punctuation">(</span><span class="token string">'TABLESPACE_QUOTA'</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span> <span class="token keyword">from</span> dba_users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'XXXXX'</span><span class="token punctuation">;</span>
<span class="token comment">-- 角色 </span>
<span class="token keyword">select</span> dbms_metadata<span class="token punctuation">.</span>get_granted_ddl<span class="token punctuation">(</span><span class="token string">'ROLE_GRANT'</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span> <span class="token keyword">from</span> dba_users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'XXXXX'</span><span class="token punctuation">;</span>
<span class="token comment">-- 系统权限 </span>
<span class="token keyword">select</span> dbms_metadata<span class="token punctuation">.</span>get_granted_ddl<span class="token punctuation">(</span><span class="token string">'SYSTEM_GRANT'</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span> <span class="token keyword">from</span> dba_users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'XXXXX'</span><span class="token punctuation">;</span>
<span class="token comment">-- 对象权限，最后导入完后执行 </span>
<span class="token keyword">select</span> dbms_metadata<span class="token punctuation">.</span>get_granted_ddl<span class="token punctuation">(</span><span class="token string">'OBJECT_GRANT'</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span> <span class="token keyword">from</span> dba_users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'XXXXX'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li> 清空回收站 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_recyclebin<span class="token punctuation">;</span>
<span class="token keyword">purge</span> recyclebin<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="6">
<li> 检查失效对象 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> owner<span class="token punctuation">,</span>object_name<span class="token punctuation">,</span>object_type <span class="token keyword">from</span> dba_objects <span class="token keyword">where</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token string">'INVALID'</span> <span class="token operator">and</span> OWNER<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="7">
<li> 记录 JOB，并禁用 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> job<span class="token punctuation">,</span>what<span class="token punctuation">,</span>broken <span class="token keyword">from</span> dba_jobs <span class="token keyword">where</span> log_user<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token string">'exec dbms_ijob.broken('</span><span class="token operator">||</span>job<span class="token operator">||</span><span class="token string">',true);'</span> <span class="token keyword">from</span> dba_jobs <span class="token keyword">where</span> log_user<span class="token operator">=</span>’XXXX’<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol start="8">
<li> 锁定用户 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> XXXX account <span class="token keyword">lock</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="9">
<li> 导出 </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>XXX
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK
exp system/oracle <span class="token assign-left variable">full</span><span class="token operator">=</span>y <span class="token assign-left variable">FILE</span><span class="token operator">=</span>/expdata/exp_full_date.dmp <span class="token assign-left variable">log</span><span class="token operator">=</span>/expdata/exp_full_date.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="10">
<li> 关闭归档 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">shutdown</span> immediate
startup mount
<span class="token keyword">alter</span> <span class="token keyword">database</span> noarchivelog<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="11">
<li> 导入 </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>XXX
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK
imp system/oracle <span class="token assign-left variable">file</span><span class="token operator">=</span>/expdata/exp_full_date.dmp <span class="token assign-left variable">log</span><span class="token operator">=</span>/expdata/imp_username_date.log <span class="token assign-left variable">fromuser</span><span class="token operator">=</span>XXXX <span class="token assign-left variable">touser</span><span class="token operator">=</span>XXXX <span class="token assign-left variable">commit</span><span class="token operator">=</span>y <span class="token assign-left variable">buffer</span><span class="token operator">=</span><span class="token number">819200000</span> <span class="token assign-left variable">ignore</span><span class="token operator">=</span>y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="12">
<li> 检查导入的对象 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">spool check_object_source<span class="token operator">/</span>target<span class="token punctuation">.</span>log
<span class="token keyword">set</span> pagesize <span class="token number">10000</span>
prompt <span class="token comment">---------------segments_bytes_G</span>
<span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>byetes<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span> owner<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span>
prompt <span class="token comment">---------------object total amounts</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dba_objects <span class="token keyword">where</span> owner<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span>
prompt <span class="token comment">---------------object type amounts</span>
<span class="token keyword">select</span> owner<span class="token punctuation">,</span>object_type<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dba_objects <span class="token keyword">where</span> owner<span class="token operator">=</span><span class="token string">'XXXX'</span> <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span>object_type <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span>
prompt<span class="token comment">-----------------job amounts</span>
<span class="token keyword">select</span> job<span class="token punctuation">,</span>what<span class="token punctuation">,</span>broken <span class="token keyword">from</span> dba_jobs <span class="token keyword">where</span> log_user<span class="token operator">=</span><span class="token string">'XXXX'</span><span class="token punctuation">;</span>
prompt <span class="token comment">---------------table records</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> XXXX<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">;</span>
spool <span class="token keyword">off</span>
<span class="token keyword">exit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="13">
<li> 检查失效对象 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> owner<span class="token punctuation">,</span>object_name<span class="token punctuation">,</span>object_type <span class="token keyword">from</span> dba_objects <span class="token keyword">where</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'INVALID'</span> <span class="token operator">and</span> OWNER<span class="token operator">=</span><span class="token string">'XXXXX'</span><span class="token punctuation">;</span>

@?<span class="token operator">/</span>rdbms<span class="token operator">/</span>admin<span class="token operator">/</span>utlrp<span class="token punctuation">.</span><span class="token keyword">sql</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="14">
<li> 重新收集用户统计信息 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 用户统计信息收集 </span>
<span class="token keyword">exec</span> DBMS_STATS<span class="token punctuation">.</span>GATHER_SCHEMA_STATS<span class="token punctuation">(</span>ownname<span class="token operator">=</span><span class="token operator">></span><span class="token string">'SCOTT'</span><span class="token punctuation">,</span>degree<span class="token operator">=</span><span class="token operator">></span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 全库统计信息收集 </span>
<span class="token keyword">exec</span> DBMS_STATS<span class="token punctuation">.</span>GATHER_DATABASE_STATS<span class="token punctuation">(</span>degree<span class="token operator">=</span><span class="token operator">></span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>exp</tag>
        <tag>imp</tag>
      </tags>
  </entry>
  <entry>
    <title>Migration Method Comparison</title>
    <url>/blog/posts/c6c09ea3.html</url>
    <content><![CDATA[<p> 数据库平台迁移，常用工具优缺点对比：</p>
<table>
<thead>
<tr>
<th> 方法 </th>
<th> 优点 </th>
<th> 缺点 </th>
</tr>
</thead>
<tbody><tr>
<td>RMAN</td>
<td> 操作简单 </td>
<td> 不适用于不同字节序之间的平台迁移 </td>
</tr>
<tr>
<td> 数据泵 </td>
<td> 操作简单 </td>
<td> 数据量大时需要的停机时间很长 </td>
</tr>
<tr>
<td>OGG</td>
<td> 对源端目标端平台无要求 </td>
<td> 操作较复杂，维护成本高 </td>
</tr>
<tr>
<td>XTTS</td>
<td> 源端与目标端字节序可以不同，停机时间短 </td>
<td> 被移动的表空间不能包含 offline 的数据文件 </td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Migrate</category>
      </categories>
      <tags>
        <tag>migration</tag>
      </tags>
  </entry>
  <entry>
    <title>Installing Oracle 10.2.0.5 On CentOS 7.9</title>
    <url>/blog/posts/f3918776.html</url>
    <content><![CDATA[<h1 id="Installing-Oracle-10-2-0-5-On-CentOS-7-9"><a href="#Installing-Oracle-10-2-0-5-On-CentOS-7-9" class="headerlink" title="Installing Oracle 10.2.0.5 On CentOS 7.9"></a>Installing Oracle 10.2.0.5 On CentOS 7.9</h1><blockquote>
<p>Operating System: CentOS 7.9<br>Database Software: 10201_database_linux_x86_64.cpio<br>Database Patches: p8202632_10205_Linux-x86-64.zip</p>
</blockquote>
<h2 id="Operating-System-Package-Requirements"><a href="#Operating-System-Package-Requirements" class="headerlink" title="Operating System Package Requirements"></a>Operating System Package Requirements</h2><p><strong>Checking Package Requirements</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">--qf</span> <span class="token string">'%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n'</span> <span class="token punctuation">\</span>
<span class="token function">make</span> gcc glibc glibc-devel compat-db compat-gcc compat-gcc-c++ <span class="token punctuation">\</span>
compat-libstdc++ compat-libstdc++-devel gnome-libs openmotif21 setarch <span class="token punctuation">\</span>
libaio libaio-devel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Installing Packages</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> binutils compat-libstdc++-33 compat-libstdc++-33.i686 <span class="token punctuation">\</span>
elfutils-libelf elfutils-libelf-devel gcc gcc-c++ glibc glibc.i686 glibc-common <span class="token punctuation">\</span>
glibc-devel glibc-devel.i686 glibc-headers ksh libaio libaio.i686 libaio-devel <span class="token punctuation">\</span>
libaio-devel.i686 libgcc libgcc.i686 libstdc++ libstdc++.i686 libstdc++-devel <span class="token function">make</span> sysstat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Disable Firewall and SElinux</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"192.168.184.150 <span class="token variable"><span class="token variable">`</span><span class="token function">hostname</span><span class="token variable">`</span></span>"</span> <span class="token operator">>></span> /etc/hosts
systemctl disable firewalld <span class="token parameter variable">--now</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/SELINUX=/&#123;s/enforcing/disabled/&#125;'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>Creating Oracle User Accounts</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> oinstall
<span class="token function">groupadd</span> dba
<span class="token function">useradd</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba <span class="token parameter variable">-c</span> <span class="token string">"Oracle Software Owner"</span> oracle
<span class="token builtin class-name">echo</span> oracle <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Creating Oracle Directories</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle.oinstall /u01
<span class="token function">chmod</span> <span class="token number">775</span> <span class="token parameter variable">-R</span> /u01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>Setting Oracle Environment Variables</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /home/oracle/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
export ORACLE_SID=orcl
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/10.2.0/db_1
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$ORACLE_HOME/lib32
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Changing system release</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">'s/CentOS/# CentOS/'</span> <span class="token parameter variable">-e</span> <span class="token string">'1i redhat 4'</span> /etc/redhat-release<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>Setting kernel parameters</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
kernel.shmall = 4294967296
kernel.shmmax = 68719476736
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 1024 65000
net.core.rmem_default = 4194304
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 262144
# hugetlb_shm_group is dba group id
vm.hugetlb_shm_group = 1001
EOF</span>

<span class="token function">sysctl</span> <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Setting shell limits</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/security/limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
oracle soft nproc 2047
oracle hard nproc 16384
oracle soft nofile 1024
oracle hard nofile 65536
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Setting pam login</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/pam.d/login <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
session required /lib64/security/pam_limits.so
session required pam_limits.so
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Unpacking-the-Installation-Files-and-starting-runInstaller"><a href="#Unpacking-the-Installation-Files-and-starting-runInstaller" class="headerlink" title="Unpacking the Installation Files and starting runInstaller"></a>Unpacking the Installation Files and starting runInstaller</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle.oinstall /soft
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /soft

<span class="token comment"># Login as oracle user</span>
<span class="token builtin class-name">cd</span> /soft
gunzip 10201_database_linux_x86_64.cpio.gz
cpio <span class="token parameter variable">-idmv</span> <span class="token operator">&lt;</span> 10201_database_linux_x86_64.cpio
database/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Patching-Oracle-10g-to-10-2-0-5-19"><a href="#Patching-Oracle-10g-to-10-2-0-5-19" class="headerlink" title="Patching Oracle 10g to 10.2.0.5.19"></a>Patching Oracle 10g to 10.2.0.5.19</h2><p><strong>Patching to 10.2.0.5.0</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Login as oracle user</span>
<span class="token function">unzip</span> p8202632_10205_Linux-x86-64.zip
/soft/Disk1/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>Patching to 10.2.0.5.19</strong></p>
<p><a href="https://jove-2761781.github.io/hexo_blog/database/oracle/upgrade/patch%20p20299014/">patch p20299014</a></p>
<h2 id="Oracle-Post-Installation-Tasks"><a href="#Oracle-Post-Installation-Tasks" class="headerlink" title="Oracle Post Installation Tasks"></a>Oracle Post Installation Tasks</h2><p><strong>Setting automatic restart</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/N$/Y/'</span> /etc/oratab

<span class="token function">cat</span> <span class="token operator">>></span> /etc/rc.d/rc.local <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
su oracle -lc "/u01/app/oracle/product/10.2.0/db_1/bin/lsnrctl start"
su oracle -lc "/u01/app/oracle/product/10.2.0/db_1/bin/dbstart"
EOF</span>

<span class="token function">chmod</span> +x /etc/rc.d/rc.local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Setting EM</strong></p>
 <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">emca <span class="token parameter variable">-repos</span> recreate
emca <span class="token parameter variable">-config</span> dbcontrol db <span class="token parameter variable">-repos</span> create
emca <span class="token parameter variable">-deconfig</span> dbcontrol db <span class="token parameter variable">-repos</span> drop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Installing Oracle 11.2.0.3 RAC On OL 7.4</title>
    <url>/blog/posts/cb2b044.html</url>
    <content><![CDATA[<h1 id="Installing-Oracle-11-2-0-3-RAC-On-OL-7-4"><a href="#Installing-Oracle-11-2-0-3-RAC-On-OL-7-4" class="headerlink" title="Installing Oracle 11.2.0.3 RAC On OL 7.4"></a>Installing Oracle 11.2.0.3 RAC On OL 7.4</h1><blockquote>
<p>Operating System: Oracle Linux Server 7.4<br>Oracle Database: p10404530_112030_Linux-x86-64_{1..3}of7.zip<br>Database Patches: </p>
</blockquote>
<h2 id="Oracle-Standalone-Cluster-Requirements"><a href="#Oracle-Standalone-Cluster-Requirements" class="headerlink" title="Oracle Standalone Cluster Requirements"></a>Oracle Standalone Cluster Requirements</h2><h3 id="Packages-Requirements"><a href="#Packages-Requirements" class="headerlink" title="Packages Requirements"></a>Packages Requirements</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">--qf</span> <span class="token string">'%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n'</span> <span class="token punctuation">\</span>
<span class="token function">bc</span> binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel <span class="token punctuation">\</span>
glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau <span class="token punctuation">\</span>
libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel <span class="token punctuation">\</span>
libxcb libibverbs <span class="token function">make</span> smartmontools sysstat pdksh gcc-c++ compat-libstdc++-33 <span class="token punctuation">\</span>
gcc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Operating-Systems-for-Oracle-Grid-Infrastructure-on-Linux"><a href="#Configuring-Operating-Systems-for-Oracle-Grid-Infrastructure-on-Linux" class="headerlink" title="Configuring Operating Systems for Oracle Grid Infrastructure on Linux"></a>Configuring Operating Systems for Oracle Grid Infrastructure on Linux</h2><p>Setting Meida ISO YUM Repository.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> /dev/cdrom /mnt

<span class="token function">cat</span> <span class="token operator">></span> /etc/yum.repos.d/media.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[InstallMedia]
name=Oracle Linux Server 7.4
baseurl=file:///mnt
gpgcheck=0
enabled=1
EOF</span>

yum clean all <span class="token operator">&amp;&amp;</span> yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Installing Operating System Packages.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token punctuation">\</span>
<span class="token function">bc</span> binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel <span class="token punctuation">\</span>
glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau <span class="token punctuation">\</span>
libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel <span class="token punctuation">\</span>
libxcb libibverbs <span class="token function">make</span> smartmontools sysstat pdksh gcc-c++ compat-libstdc++-33 <span class="token punctuation">\</span>
gcc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Disabling Firewall and SElinux.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl disable firewalld <span class="token parameter variable">--now</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/SELINUX=/&#123;s/enforcing/disabled/&#125;'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Zero Configuration Network.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-p</span> /etc/sysconfig/network<span class="token punctuation">&#123;</span>,.bak.<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%m%d<span class="token variable">`</span></span><span class="token punctuation">&#125;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"NOZEROCONF=yes"</span> <span class="token operator">>></span> /etc/sysconfig/network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Transparent Huagepages.</p>
<ul>
<li><a href="/blog/posts/ffa54a43.html">How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</a></li>
</ul>
<p>Configuring Public, Private, Virtual and SCAN IP names and Addresses.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
192.168.3.210   exadb01
192.168.3.211   exadb02
192.168.3.212   exadb01-vip
192.168.3.213   exadb02-vip
192.168.3.214   exadb-scan
100.100.100.210 exadb01-priv
100.100.100.211 exadb02-priv
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database"><a href="#Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database" class="headerlink" title="Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database"></a>Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database</h2><p>Create Oracle software owner user accounts on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1000</span> oinstall
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1200</span> asmadmin
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1201</span> asmdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1202</span> asmoper
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1300</span> dba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1301</span> oper
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">1101</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> asmadmin,asmdba,asmoper,dba <span class="token parameter variable">-m</span> <span class="token parameter variable">-d</span> /home/grid <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-c</span> <span class="token string">"Grid Infrastructure Owner"</span> grid
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">1100</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba,oper,asmdba,asmadmin <span class="token parameter variable">-m</span> <span class="token parameter variable">-d</span> /home/oracle <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-c</span> <span class="token string">"Oracle Software Owner"</span> oracle
<span class="token builtin class-name">echo</span> <span class="token string">"grid"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> grid
<span class="token builtin class-name">echo</span> <span class="token string">"oracle"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Create Grid home and Oracle home directories on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/11.2.0/grid
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/grid
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/11.2.0/db_1
<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /u01
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01/app/oracle
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /u01/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Configure Oracle Software owner user account environment on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /home/grid/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">"EOF"
# The following is add for Oracle 11g
export ORACLE_SID=+ASM1
export ORACLE_BASE=/u01/app/grid
export ORACLE_HOME=/u01/app/11.2.0/grid
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
# alias sqlplus='rlwrap sqlplus'
EOF</span>

<span class="token function">cat</span> <span class="token operator">>></span> /home/oracle/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">"EOF"
# The following is add for Oracle 11g
export ORACLE_SID=coco1
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
# alias sqlplus='rlwrap sqlplus'
# alias rman='rlwrap rman'
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-SSH-Manually-on-All-Cluster-Nodes"><a href="#Configuring-SSH-Manually-on-All-Cluster-Nodes" class="headerlink" title="Configuring SSH Manually on All Cluster Nodes"></a>Configuring SSH Manually on All Cluster Nodes</h3><p>Login as grid user, create SSH keys on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@exadb01 ~<span class="token punctuation">]</span>$ ssh-keygen <span class="token parameter variable">-t</span> rsa
<span class="token punctuation">[</span>grid@exadb02 ~<span class="token punctuation">]</span>$ ssh-keygen <span class="token parameter variable">-t</span> rsa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Copy keys to a remote authorized_keys file.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@exadb01 ~<span class="token punctuation">]</span>$ ssh-copy-id exadb01
<span class="token punctuation">[</span>grid@exadb01 ~<span class="token punctuation">]</span>$ ssh-copy-id exadb02
<span class="token punctuation">[</span>grid@exadb02 ~<span class="token punctuation">]</span>$ ssh-copy-id exadb01
<span class="token punctuation">[</span>grid@exadb02 ~<span class="token punctuation">]</span>$ ssh-copy-id exadb02<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Verifying SSH user equivalency on cluster nodes <strong>without</strong> being prompted for a password.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@exadb01 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> exadb02 <span class="token function">date</span>
Sun Jun  <span class="token number">4</span> <span class="token number">19</span>:04:35 CST <span class="token number">2023</span>
<span class="token punctuation">[</span>grid@exadb02 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> exadb01 <span class="token function">date</span>
Sun Jun  <span class="token number">4</span> <span class="token number">19</span>:05:07 CST <span class="token number">2023</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Repeat as oracle user.</p>
<h3 id="Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB"><a href="#Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB" class="headerlink" title="Configuring Storage Device Path Persistence Using Oracle ASMLIB"></a>Configuring Storage Device Path Persistence Using Oracle ASMLIB</h3><p>none.</p>
<h3 id="Configuring-Kernel-Parameters-for-Linux"><a href="#Configuring-Kernel-Parameters-for-Linux" class="headerlink" title="Configuring Kernel Parameters for Linux"></a>Configuring Kernel Parameters for Linux</h3><p>Create or edit the <code>/etc/sysctl.d/97-oracle-database-sysctl.conf</code> file, and add or edit lines similar to:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/97-oracle-database-sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
fs.file-max = 6815744
kernel.sem = 250 32000 100 128
kernel.shmmni = 4096
kernel.shmall = 1073741824
kernel.shmmax = 4398046511104
kernel.panic_on_oops = 1
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
net.ipv4.conf.all.rp_filter = 2
net.ipv4.conf.default.rp_filter = 2
fs.aio-max-nr = 1048576
net.ipv4.ip_local_port_range = 9000 65500
EOF</span>

<span class="token function">sysctl</span> <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Configuring-Resource-Limits-for-Oracle-Software-Installation-Users"><a href="#Configuring-Resource-Limits-for-Oracle-Software-Installation-Users" class="headerlink" title="Configuring Resource Limits for Oracle Software Installation Users"></a>Configuring Resource Limits for Oracle Software Installation Users</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/security/limits.d/oracle-database-limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
oracle   soft   nofile    1024
oracle   hard   nofile    65536
oracle   soft   nproc    16384
oracle   hard   nproc    16384
oracle   soft   stack    10240
oracle   hard   stack    32768
oracle   hard   memlock    134217728
oracle   soft   memlock    134217728
grid   soft   nofile    1024
grid   hard   nofile    65536
grid   soft   nproc    16384
grid   hard   nproc    16384
grid   soft   stack    10240
grid   hard   stack    32768
grid   hard   memlock    134217728
grid   soft   memlock    134217728
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><p>Unzip GI Software file.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># chmod -R 775 /soft</span>
<span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># chmod -R grid:oinstall /soft</span>

<span class="token comment"># Log in as grid user</span>
<span class="token punctuation">[</span>grid@exadb01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /soft
<span class="token punctuation">[</span>grid@exadb01 soft<span class="token punctuation">]</span>$ <span class="token function">unzip</span> <span class="token parameter variable">-q</span> p13390677_112040_Linux-x86-64_3of7.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Installing the cvuqdisk RPM for Linux.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># cp /soft/grid/rpm/cvuqdisk-1.0.9-1.rpm /soft</span>
<span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># set CVUQDISK_GRP=oinstall</span>
<span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh /soft/cvuqdisk-1.0.9-1.rpm</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Using CVU to Determine if Installation Prerequisites are Complete.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@exadb01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /soft/grid
<span class="token punctuation">[</span>grid@exadb01 grid<span class="token punctuation">]</span>$ ./runcluvfy.sh stage <span class="token parameter variable">-pre</span> crsinst <span class="token parameter variable">-fixup</span> <span class="token parameter variable">-n</span> exadb01,exadb02 <span class="token parameter variable">-verbose</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>output:</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>grid<span class="token operator">@</span>exadb01 grid<span class="token punctuation">]</span><span class="token operator">$</span> <span class="token file-path string">./runcluvfy.sh</span> stage <span class="token operator">-</span>pre crsinst <span class="token operator">-</span>fixup <span class="token operator">-</span>n exadb01<span class="token punctuation">,</span>exadb02

Performing pre<span class="token operator">-</span>checks for cluster services setup

Checking node reachability<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Node reachability check passed from node <span class="token string">"exadb01"</span>


Checking user equivalence<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
User equivalence check passed for user <span class="token string">"grid"</span>

Checking node connectivity<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

Checking hosts config file<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

Verification of the hosts config file successful

Node connectivity passed for subnet <span class="token string">"192.168.3.0"</span> with node<span class="token operator">(</span>s<span class="token operator">)</span> exadb02<span class="token punctuation">,</span>exadb01
TCP connectivity check passed for subnet <span class="token string">"192.168.3.0"</span>

Node connectivity passed for subnet <span class="token string">"100.100.100.0"</span> with node<span class="token operator">(</span>s<span class="token operator">)</span> exadb02<span class="token punctuation">,</span>exadb01
TCP connectivity check passed for subnet <span class="token string">"100.100.100.0"</span>


Interfaces found on subnet <span class="token string">"192.168.3.0"</span> <span class="token property">that are likely candidates for VIP are:</span>
exadb02 ens192<span class="token operator">:</span><span class="token ip-address constant">192.168.3.211</span>
exadb01 ens192<span class="token operator">:</span><span class="token ip-address constant">192.168.3.210</span>

Interfaces found on subnet <span class="token string">"100.100.100.0"</span> <span class="token property">that are likely candidates for VIP are:</span>
exadb02 ens224<span class="token operator">:</span><span class="token ip-address constant">100.100.100.211</span>
exadb01 ens224<span class="token operator">:</span><span class="token ip-address constant">100.100.100.210</span>

<span class="token level warning important">WARNING</span><span class="token operator">:</span>
Could not find a suitable set of interfaces for the private interconnect
Checking subnet mask consistency<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Subnet mask consistency check passed for subnet <span class="token string">"192.168.3.0"</span><span class="token punctuation">.</span>
Subnet mask consistency check passed for subnet <span class="token string">"100.100.100.0"</span><span class="token punctuation">.</span>
Subnet mask consistency check passed<span class="token punctuation">.</span>

Node connectivity check passed

Checking multicast communication<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

Checking subnet <span class="token string">"192.168.3.0"</span> for multicast communication with multicast group <span class="token string">"230.0.1.0"</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Check of subnet <span class="token string">"192.168.3.0"</span> for multicast communication with multicast group <span class="token string">"230.0.1.0"</span> passed<span class="token punctuation">.</span>

Checking subnet <span class="token string">"100.100.100.0"</span> for multicast communication with multicast group <span class="token string">"230.0.1.0"</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Check of subnet <span class="token string">"100.100.100.0"</span> for multicast communication with multicast group <span class="token string">"230.0.1.0"</span> passed<span class="token punctuation">.</span>

Check of multicast communication passed<span class="token punctuation">.</span>

Checking ASMLib configuration<span class="token punctuation">.</span>
Check for ASMLib configuration passed<span class="token punctuation">.</span>
Total memory check passed
Available memory check passed
Swap space check passed
Free disk space check passed for <span class="token string">"exadb02:/tmp"</span>
Free disk space check passed for <span class="token string">"exadb01:/tmp"</span>
Check for multiple users with UID value <span class="token number">1100</span> passed
User existence check passed for <span class="token string">"grid"</span>
Group existence check passed for <span class="token string">"oinstall"</span>
Group existence check passed for <span class="token string">"dba"</span>
Membership check for user <span class="token string">"grid"</span> in group <span class="token string">"oinstall"</span> <span class="token punctuation">[</span>as Primary<span class="token punctuation">]</span> passed
Membership check for user <span class="token string">"grid"</span> in group <span class="token string">"dba"</span> passed
Run level check passed
Hard limits check passed for <span class="token string">"maximum open file descriptors"</span>
Soft limits check passed for <span class="token string">"maximum open file descriptors"</span>
Hard limits check passed for <span class="token string">"maximum user processes"</span>
Soft limits check passed for <span class="token string">"maximum user processes"</span>
System architecture check passed
Kernel version check passed
Kernel parameter check passed for <span class="token string">"semmsl"</span>
Kernel parameter check passed for <span class="token string">"semmns"</span>
Kernel parameter check passed for <span class="token string">"semopm"</span>
Kernel parameter check passed for <span class="token string">"semmni"</span>
Kernel parameter check passed for <span class="token string">"shmmax"</span>
Kernel parameter check passed for <span class="token string">"shmmni"</span>
Kernel parameter check passed for <span class="token string">"shmall"</span>
Kernel parameter check passed for <span class="token string">"file-max"</span>
Kernel parameter check passed for <span class="token string">"ip_local_port_range"</span>
Kernel parameter check passed for <span class="token string">"rmem_default"</span>
Kernel parameter check passed for <span class="token string">"rmem_max"</span>
Kernel parameter check passed for <span class="token string">"wmem_default"</span>
Kernel parameter check passed for <span class="token string">"wmem_max"</span>
Kernel parameter check passed for <span class="token string">"aio-max-nr"</span>
Package existence check passed for <span class="token string">"make"</span>
Package existence check passed for <span class="token string">"binutils"</span>
Package existence check passed for <span class="token string">"gcc(x86_64)"</span>
Package existence check passed for <span class="token string">"libaio(x86_64)"</span>
Package existence check passed for <span class="token string">"glibc(x86_64)"</span>
Package existence check passed for <span class="token string">"compat-libstdc++-33(x86_64)"</span>
Package existence check passed for <span class="token string">"elfutils-libelf(x86_64)"</span>
Package existence check passed for <span class="token string">"elfutils-libelf-devel"</span>
Package existence check passed for <span class="token string">"glibc-common"</span>
Package existence check passed for <span class="token string">"glibc-devel(x86_64)"</span>
Package existence check passed for <span class="token string">"glibc-headers"</span>
Package existence check passed for <span class="token string">"gcc-c++(x86_64)"</span>
Package existence check passed for <span class="token string">"libaio-devel(x86_64)"</span>
Package existence check passed for <span class="token string">"libgcc(x86_64)"</span>
Package existence check passed for <span class="token string">"libstdc++(x86_64)"</span>
Package existence check passed for <span class="token string">"libstdc++-devel(x86_64)"</span>
Package existence check passed for <span class="token string">"sysstat"</span>
Package existence check failed for <span class="token string">"pdksh"</span>
<span class="token property">Check failed on nodes:</span>
        exadb02<span class="token punctuation">,</span>exadb01
Package existence check passed for <span class="token string">"expat(x86_64)"</span>
Check for multiple users with UID value <span class="token number">0</span> passed
Current group ID check passed

Starting check for consistency of primary group of root user

Check for consistency of root user's primary group passed

Starting Clock synchronization checks using Network Time Protocol<span class="token operator">(</span>NTP<span class="token operator">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

NTP Configuration file check started<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
No NTP Daemons or Services were found to be running

Clock synchronization check using Network Time Protocol<span class="token operator">(</span>NTP<span class="token operator">)</span> passed

Core file name pattern consistency check passed<span class="token punctuation">.</span>

User <span class="token string">"grid"</span> is not part of <span class="token string">"root"</span> group<span class="token punctuation">.</span> Check passed
Default user file creation mask check passed
Checking consistency of file <span class="token string">"/etc/resolv.conf"</span> across nodes

File <span class="token string">"/etc/resolv.conf"</span> does not have both domain and search entries defined
domain entry in file <span class="token string">"/etc/resolv.conf"</span> is consistent across nodes
search entry in file <span class="token string">"/etc/resolv.conf"</span> is consistent across nodes
The DNS response time for an unreachable node is within acceptable limit on all nodes

File <span class="token string">"/etc/resolv.conf"</span> is consistent across nodes

Time zone consistency check passed
Fixup information has been generated for following node<span class="token operator">(</span>s<span class="token operator">)</span><span class="token operator">:</span>
exadb01<span class="token punctuation">,</span>exadb02
Please run the following script on each node as <span class="token string">"root"</span> <span class="token property">user to execute the fixups:</span>
<span class="token string">'/tmp/CVU_11.2.0.4.0_grid/runfixup.sh'</span>

Pre<span class="token operator">-</span>check for cluster services setup was unsuccessful on all the nodes<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><ol>
<li><p>Download and change the Oracle Database image files permissions.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /soft/p10404530_112030_Linux-x86-64_<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span>of7.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, extract the files into the Oracle home.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-d</span> /soft /soft/p10404530_112030_Linux-x86-64_1of7.zip
<span class="token function">unzip</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-d</span> /soft /soft/p10404530_112030_Linux-x86-64_2of7.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, run installer.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/soft/database/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="Installation-Errors"><a href="#Installation-Errors" class="headerlink" title="Installation Errors"></a>Installation Errors</h2><h3 id="runInstaller-OUI-start-error"><a href="#runInstaller-OUI-start-error" class="headerlink" title="runInstaller(OUI) start error."></a>runInstaller(OUI) start error.</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@exadb01 grid<span class="token punctuation">]</span>$ ./runInstaller
Starting Oracle Universal Installer<span class="token punctuation">..</span>.

Checking Temp space: must be greater than <span class="token number">120</span> MB.   Actual <span class="token number">43392</span> MB    Passed
Checking swap space: must be greater than <span class="token number">150</span> MB.   Actual <span class="token number">8063</span> MB    Passed
Checking monitor: must be configured to display at least <span class="token number">256</span> colors
    <span class="token operator">>></span><span class="token operator">></span> Could not execute auto check <span class="token keyword">for</span> display colors using <span class="token builtin class-name">command</span> /usr/bin/xdpyinfo. Check <span class="token keyword">if</span> the <span class="token environment constant">DISPLAY</span> variable is set.    Failed <span class="token operator">&lt;&lt;&lt;</span><span class="token operator">&lt;</span>

Some requirement checks failed. You must fulfill these requirements before

continuing with the installation,

Continue? <span class="token punctuation">(</span>y/n<span class="token punctuation">)</span> <span class="token punctuation">[</span>n<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># yum provides xdpyinfo</span>
Loaded plugins: ulninfo
xorg-x11-utils-7.5-22.el7.x86_64 <span class="token builtin class-name">:</span> X.Org X11 X client utilities
Repo        <span class="token builtin class-name">:</span> InstallMedia
Matched from:
Provides    <span class="token builtin class-name">:</span> xdpyinfo
<span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install xorg-x11-utils</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="error-while-loading-shared-libraries-libcap-so-1"><a href="#error-while-loading-shared-libraries-libcap-so-1" class="headerlink" title="error while loading shared libraries: libcap.so.1"></a>error while loading shared libraries: libcap.so.1</h3><p>Loading shared libraries: libcap.so.1 fails when running root.sh on the first node.</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log">Creating <span class="token file-path string">/etc/oratab</span> file<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Entries will be added to the <span class="token file-path string">/etc/oratab</span> file as needed by
Database Configuration Assistant when a database is created
Finished running generic part of root script<span class="token punctuation">.</span>
Now product<span class="token operator">-</span>specific root actions will be performed<span class="token punctuation">.</span>
<span class="token property">Using configuration parameter file:</span> <span class="token file-path string">/u01/app/11.2.0/grid/crs/install/crsconfig_params</span>
Creating trace directory
User ignored Prerequisites during installation
Installing Trace File Analyzer
Failed to create keys in the OLR<span class="token punctuation">,</span> rc <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">,</span> Message<span class="token operator">:</span>
  <span class="token file-path string">/u01/app/11.2.0/grid/bin/clscfg.bin</span><span class="token operator">:</span> error while loading shared libraries<span class="token operator">:</span> libcap<span class="token punctuation">.</span>so<span class="token punctuation">.</span>1<span class="token operator">:</span> cannot open shared object file<span class="token operator">:</span> No such file or directory

Failed to create keys in the OLR at <span class="token file-path string">/u01/app/11.2.0/grid/crs/install/crsconfig_lib.pm</span> line <span class="token number">7660</span><span class="token punctuation">.</span>
<span class="token file-path string">/u01/app/11.2.0/grid/perl/bin/perl</span> <span class="token operator">-</span>I<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span><span class="token number">11.2.0</span><span class="token operator">/</span>grid<span class="token operator">/</span>perl<span class="token operator">/</span>lib <span class="token operator">-</span>I<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span><span class="token number">11.2.0</span><span class="token operator">/</span>grid<span class="token operator">/</span>crs<span class="token operator">/</span>install <span class="token file-path string">/u01/app/11.2.0/grid/crs/install/rootcrs.pl</span> execution failed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h4><p>Install <code>compat-libcap1</code> package.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># yum provides libcap.so.1</span>
Loaded plugins: ulninfo
compat-libcap1-1.10-7.el7.i686 <span class="token builtin class-name">:</span> Library <span class="token keyword">for</span> getting and setting POSIX.1e capabilities
Repo        <span class="token builtin class-name">:</span> InstallMedia
Matched from:
Provides    <span class="token builtin class-name">:</span> libcap.so.1

<span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install compat-libcap1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Installing Oracle 11.2.0.3 On OL 7.4</title>
    <url>/blog/posts/27f1b415.html</url>
    <content><![CDATA[<h1 id="Installing-Oracle-11-2-0-3-On-OL-7-4"><a href="#Installing-Oracle-11-2-0-3-On-OL-7-4" class="headerlink" title="Installing Oracle 11.2.0.3 On OL 7.4"></a>Installing Oracle 11.2.0.3 On OL 7.4</h1><blockquote>
<p>Operating System: Oracle Linux Server 7.4<br>Oracle Database: p10404530_112030_Linux-x86-64_{1..3}of7.zip<br>Database Patches: </p>
</blockquote>
<h2 id="Oracle-Oracle-Single-Instance-Requirements"><a href="#Oracle-Oracle-Single-Instance-Requirements" class="headerlink" title="Oracle Oracle Single Instance Requirements"></a>Oracle Oracle Single Instance Requirements</h2><h2 id="Configuring-Operating-Systems-for-Oracle-Single-Instance"><a href="#Configuring-Operating-Systems-for-Oracle-Single-Instance" class="headerlink" title="Configuring Operating Systems for Oracle Single Instance"></a>Configuring Operating Systems for Oracle Single Instance</h2><p>Disabling Firewall and SElinux.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl disable firewalld <span class="token parameter variable">--now</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/SELINUX=/&#123;s/enforcing/disabled/&#125;'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Zero Configuration Network.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-p</span> /etc/sysconfig/network<span class="token punctuation">&#123;</span>,.bak.<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%m%d<span class="token variable">`</span></span><span class="token punctuation">&#125;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"NOZEROCONF=yes"</span> <span class="token operator">>></span> /etc/sysconfig/network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Transparent Huagepages.</p>
<ul>
<li><a href="/blog/posts/ffa54a43.html">How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</a></li>
</ul>
<p>Configuring Public, Private, Virtual and SCAN IP names and Addresses.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 19c
192.168.3.221   oracle11g
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Setting Yum Repository.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> /dev/cdrom /mnt

<span class="token function">cat</span> <span class="token operator">></span> /etc/yum.repos.d/media.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[InstallMedia]
name=Oracle Linux Server 7.4
baseurl=file:///mnt
gpgcheck=0
enabled=1
EOF</span>

yum clean all <span class="token operator">&amp;&amp;</span> yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Installing Operating System Packages.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">--qf</span> <span class="token string">'%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n'</span> <span class="token punctuation">\</span>
<span class="token function">bc</span> binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel <span class="token punctuation">\</span>
glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau <span class="token punctuation">\</span>
libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel <span class="token punctuation">\</span>
libxcb libibverbs <span class="token function">make</span> smartmontools sysstat pdksh gcc-c++ compat-libstdc++-33 <span class="token punctuation">\</span>
gcc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database"><a href="#Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database" class="headerlink" title="Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database"></a>Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database</h2><p>Create Oracle software owner user accounts on each cluster node</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54321</span> oinstall
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54322</span> dba
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">54321</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba <span class="token parameter variable">-m</span> <span class="token parameter variable">-d</span> /home/oracle <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-c</span> <span class="token string">"Oracle Software Owner"</span> oracle
<span class="token builtin class-name">echo</span> <span class="token string">"oracle"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Create Grid home and Oracle home directories on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/11.2.0/db_1
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /u01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Configure Oracle Software owner user account environment on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /home/oracle/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">"EOF"
# The following is add for Oracle 11g
export ORACLE_SID=coco
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
# alias sqlplus='rlwrap sqlplus'
# alias rman='rlwrap rman'
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-Kernel-Parameters-for-Linux"><a href="#Configuring-Kernel-Parameters-for-Linux" class="headerlink" title="Configuring Kernel Parameters for Linux"></a>Configuring Kernel Parameters for Linux</h3><p>Create or edit the <code>/etc/sysctl.d/97-oracle-database-sysctl.conf</code> file, and add or edit lines similar to:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/97-oracle-database-sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
fs.file-max = 6815744
kernel.sem = 250 32000 100 128
kernel.shmmni = 4096
kernel.shmall = 1073741824
kernel.shmmax = 4398046511104
kernel.panic_on_oops = 1
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
net.ipv4.conf.all.rp_filter = 2
net.ipv4.conf.default.rp_filter = 2
fs.aio-max-nr = 1048576
net.ipv4.ip_local_port_range = 9000 65500
EOF</span>

<span class="token function">sysctl</span> <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Configuring-Resource-Limits-for-Oracle-Software-Installation-Users"><a href="#Configuring-Resource-Limits-for-Oracle-Software-Installation-Users" class="headerlink" title="Configuring Resource Limits for Oracle Software Installation Users"></a>Configuring Resource Limits for Oracle Software Installation Users</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/security/limits.d/oracle-database-limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
oracle   soft   nofile    1024
oracle   hard   nofile    65536
oracle   soft   nproc    16384
oracle   hard   nproc    16384
oracle   soft   stack    10240
oracle   hard   stack    32768
oracle   hard   memlock    134217728
oracle   soft   memlock    134217728
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><ol>
<li><p>Download and change the Oracle Database image files permissions.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /soft/p10404530_112030_Linux-x86-64_<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span>of7.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, extract the files into the Oracle home.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-d</span> /soft /soft/p10404530_112030_Linux-x86-64_1of7.zip
<span class="token function">unzip</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-d</span> /soft /soft/p10404530_112030_Linux-x86-64_2of7.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, run installer.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/soft/database/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Installing Oracle 19.3.0.0 RAC On RHEL 8.7</title>
    <url>/blog/posts/11dd2bb7.html</url>
    <content><![CDATA[<h1 id="Installing-Oracle-19-3-0-0-RAC-On-RHEL-8-7"><a href="#Installing-Oracle-19-3-0-0-RAC-On-RHEL-8-7" class="headerlink" title="Installing Oracle 19.3.0.0 RAC On RHEL 8.7"></a>Installing Oracle 19.3.0.0 RAC On RHEL 8.7</h1><blockquote>
<p>Operating System: RHEL 8.7<br>Database Software: LINUX.X64_193000_grid_home.zip, LINUX.X64_193000_db_home.zip</p>
</blockquote>
<h2 id="Oracle-Standalone-Cluster-Requirements"><a href="#Oracle-Standalone-Cluster-Requirements" class="headerlink" title="Oracle Standalone Cluster Requirements"></a>Oracle Standalone Cluster Requirements</h2><p>Minimum Available Space Requirements for Oracle Standalone Cluster With GIMR Configuration</p>
<table>
<thead>
<tr>
<th>Redundancy Level</th>
<th>DATA Disk Group</th>
<th>MGMT Disk Group</th>
<th>Oracle Fleet Patching and Provisioning</th>
<th>Total Storage</th>
</tr>
</thead>
<tbody><tr>
<td>External</td>
<td>1 GB</td>
<td>28 GB Each node beyond four: 5 GB</td>
<td>1 GB</td>
<td>30 GB</td>
</tr>
<tr>
<td>Normal</td>
<td>2 GB</td>
<td>56 GB Each node beyond four: 5 GB</td>
<td>2 GB</td>
<td>60 GB</td>
</tr>
<tr>
<td>High&#x2F;Flex&#x2F;Extended</td>
<td>3 GB</td>
<td>84 GB Each node beyond four: 5 GB</td>
<td>3 GB</td>
<td>90 GB</td>
</tr>
</tbody></table>
<div class="note info modern"><p>a. The DATA disk group stores OCR and voting files, and the MGMT disk group stores GIMR and Oracle Clusterware backup files.<br>b. Starting with Oracle Grid Infrastructure 19c, configuring GIMR is optional for Oracle Standalone Cluster deployments.</p>
</div>

<h3 id="Packages-Requirements"><a href="#Packages-Requirements" class="headerlink" title="Packages Requirements"></a>Packages Requirements</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">--qf</span> <span class="token string">'%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n'</span> <span class="token punctuation">\</span>
<span class="token function">bc</span> binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel <span class="token punctuation">\</span>
glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau <span class="token punctuation">\</span>
libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel <span class="token punctuation">\</span>
libxcb libibverbs <span class="token function">make</span> smartmontools sysstat <span class="token function">unzip</span> xorg-x11-xauth<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Operating-Systems-for-Oracle-Grid-Infrastructure-on-Linux"><a href="#Configuring-Operating-Systems-for-Oracle-Grid-Infrastructure-on-Linux" class="headerlink" title="Configuring Operating Systems for Oracle Grid Infrastructure on Linux"></a>Configuring Operating Systems for Oracle Grid Infrastructure on Linux</h2><p>Setting Meida ISO YUM Repository.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> /dev/sr0 /mnt

<span class="token function">cat</span> <span class="token operator">></span> /etc/yum.repos.d/media.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[InstallMedia_BaseOS]
name=Red Hat Enterprise Linux 8.7.0 BaseOS
baseurl=file:///mnt/BaseOS
gpgcheck=0
enabled=1

[InstallMedia_AppStream]
name=Red Hat Enterprise Linux 8.7.0 AppStream
baseurl=file:///mnt/AppStream
gpgcheck=0
enabled=1
EOF</span>

yum clean all <span class="token operator">&amp;&amp;</span> yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Installing Operating System Packages.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token punctuation">\</span>
<span class="token function">bc</span> binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel <span class="token punctuation">\</span>
glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau <span class="token punctuation">\</span>
libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel <span class="token punctuation">\</span>
libxcb libibverbs <span class="token function">make</span> smartmontools sysstat <span class="token function">unzip</span> xorg-x11-xauth<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Disabling Firewall and SElinux.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl disable firewalld <span class="token parameter variable">--now</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/SELINUX=/&#123;s/enforcing/disabled/&#125;'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Zero Configuration Network.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-p</span> /etc/sysconfig/network<span class="token punctuation">&#123;</span>,.bak.<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%m%d<span class="token variable">`</span></span><span class="token punctuation">&#125;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"NOZEROCONF=yes"</span> <span class="token operator">>></span> /etc/sysconfig/network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Transparent Huagepages.</p>
<ul>
<li><a href="/blog/posts/ffa54a43.html">How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</a></li>
</ul>
<p>Configuring Public, Private, Virtual and SCAN IP names and Addresses.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 19c
192.168.3.101   oracle19crac01
192.168.3.102   oracle19crac02
192.168.3.103   oracle19crac03
192.168.3.104   oracle19crac01-vip
192.168.3.105   oracle19crac02-vip
192.168.3.106   oracle19crac02-vip
192.168.3.107   oracle19crac-scan
100.100.100.101 oracle19crac01-priv
100.100.100.102 oracle19crac02-priv
100.100.100.103 oracle19crac03-priv
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database"><a href="#Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database" class="headerlink" title="Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database"></a>Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database</h2><p>Create Oracle software owner user accounts on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54321</span> oinstall
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54322</span> dba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54323</span> oper
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54324</span> backupdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54325</span> dgdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54326</span> kmdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54327</span> asmdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54328</span> asmoper
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54329</span> asmadmin
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54330</span> racdba
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">54331</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba,asmdba,asmoper,asmadmin,racdba <span class="token parameter variable">-m</span> <span class="token parameter variable">-d</span> /home/grid <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-c</span> <span class="token string">"Grid Infrastructure Owner"</span> grid
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">54321</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba,oper,backupdba,dgdba,kmdba,asmdba,racdba <span class="token parameter variable">-m</span> <span class="token parameter variable">-d</span> /home/oracle <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-c</span> <span class="token string">"Oracle Software Owner"</span> oracle
<span class="token builtin class-name">echo</span> <span class="token string">"grid"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> grid
<span class="token builtin class-name">echo</span> <span class="token string">"oracle"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Create Grid home and Oracle home directories on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/19.0.0/grid
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/grid
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/19.0.0/dbhome_1
<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /u01
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01/app/oracle
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /u01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Configure Oracle Software owner user account environment on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /home/grid/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">"EOF"
# The following is add for Oracle 19c
umask 022
export ORACLE_SID=+ASM1
export ORACLE_BASE=/u01/app/grid
export ORACLE_HOME=/u01/app/19.0.0/grid
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
# alias sqlplus='rlwrap sqlplus'
EOF</span>

<span class="token function">cat</span> <span class="token operator">>></span> /home/oracle/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">"EOF"
# The following is add for Oracle 19c
umask 022
export ORACLE_SID=coco1
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/19.0.0/dbhome_1
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
# alias sqlplus='rlwrap sqlplus'
# alias rman='rlwrap rman'
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-SSH-Manually-on-All-Cluster-Nodes"><a href="#Configuring-SSH-Manually-on-All-Cluster-Nodes" class="headerlink" title="Configuring SSH Manually on All Cluster Nodes"></a>Configuring SSH Manually on All Cluster Nodes</h3><h4 id="Create-SSH-Directory-and-Create-SSH-Keys-On-Each-Node"><a href="#Create-SSH-Directory-and-Create-SSH-Keys-On-Each-Node" class="headerlink" title="Create SSH Directory and Create SSH Keys On Each Node"></a>Create SSH Directory and Create SSH Keys On Each Node</h4><ol>
<li><p>Logged in as <code>grid</code>, create the .ssh directory in the grid user’s home directory, and set permissions on it to ensure that only the oracle user has read and write permissions:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> ~/.ssh
<span class="token function">chmod</span> <span class="token number">700</span> ~/.ssh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Create <code>RSA</code> or <code>DSA</code> key:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/bin/ssh-keygen <span class="token parameter variable">-t</span> rsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>At the prompts, accept the default location for the key file (press <strong>Enter</strong>).</p>
</li>
<li><p>Repeat the steps 1 through 2 on each node that you intend to make a member of the cluster, using the DSA key.</p>
</li>
</ol>
<h4 id="Add-All-Keys-to-a-Common-authorized-keys-File"><a href="#Add-All-Keys-to-a-Common-authorized-keys-File" class="headerlink" title="Add All Keys to a Common authorized_keys File"></a>Add All Keys to a Common authorized_keys File</h4><p>To configure SSH, copy all the generated keys on all cluster node members into an authorized keys file that is identical on each node.<br>On the local node, add the DSA key to the authorized_keys file, then copy the authorized_keys file to the user .ssh directory on a remote node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/.ssh
<span class="token function">cat</span> id_rsa.pub <span class="token operator">>></span> authorized_keys
<span class="token function">scp</span> authorized_keys oracle19crac02:~/.ssh/
<span class="token function">scp</span> authorized_keys oracle19crac03:~/.ssh/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Repeat from each node to each other member node in the cluster.</p>
<h4 id="Verifying-SSH-User-Equivalency-on-Cluster-Nodes"><a href="#Verifying-SSH-User-Equivalency-on-Cluster-Nodes" class="headerlink" title="Verifying SSH User Equivalency on Cluster Nodes"></a>Verifying SSH User Equivalency on Cluster Nodes</h4><p>On the system where you want to run OUI, log in as the <code>grid</code> user.<br>If you have configured SSH correctly, then you can now use the ssh or scp commands <strong>without</strong> being prompted for a password. For example:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@oracle19crac01 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> oracle19crac02 <span class="token function">date</span>
Wed May <span class="token number">10</span> <span class="token number">11</span>:02:23 CST <span class="token number">2023</span>
<span class="token punctuation">[</span>grid@oracle19crac01 ~<span class="token punctuation">]</span>$ <span class="token function">ssh</span> oracle19crac03 <span class="token function">date</span>
Wed May <span class="token number">10</span> <span class="token number">11</span>:02:27 CST <span class="token number">2023</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Repeat from each node to each other member node in the cluster.<br>If any node prompts for a password, then verify that the <code>~/.ssh/authorized_keys</code> file on that node contains the correct public keys, and that you have created an Oracle software owner with identical group membership and IDs.</p>
<h3 id="Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB"><a href="#Configuring-Storage-Device-Path-Persistence-Using-Oracle-ASMLIB" class="headerlink" title="Configuring Storage Device Path Persistence Using Oracle ASMLIB"></a>Configuring Storage Device Path Persistence Using Oracle ASMLIB</h3><div class="note info modern"><p>If you configure disks using Oracle ASMLIB, then you must change the disk discovery string to <strong>ORCL:</strong><em>. If the diskstring is set to ORCL:</em>, or is left empty (“”), then the installer discovers these disks.</p>
</div>

<h4 id="Installing-and-Configuring-Oracle-ASMLIB-Software"><a href="#Installing-and-Configuring-Oracle-ASMLIB-Software" class="headerlink" title="Installing and Configuring Oracle ASMLIB Software"></a>Installing and Configuring Oracle ASMLIB Software</h4><p>To install and configure the Oracle Automatic Storage Management library driver software manually, perform the following steps:</p>
<ol>
<li><p>Depending on your operating system version, download the required Oracle Automatic Storage Management library driver packages and driver:</p>
<p><a href="https://support.oracle.com/knowledge/Oracle%20Linux%20and%20Virtualization/1089399_1.html">Oracle ASMLib Software Update and Support Policy (Doc ID 1089399.1)</a></p>
<p><a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html">http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html</a></p>
</li>
<li><p>Install the oracleasmlib and oracleasm-support packages for all Oracle ASMLIB installations.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dnf <span class="token parameter variable">-y</span> <span class="token function">install</span> kmod-redhat-oracleasm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> oracleasmlib-2.0.17-1.el8.x86_64.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> oracleasm-support-2.1.12-1.el8.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Run the oracleasm initialization script with the configure option:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac01 soft<span class="token punctuation">]</span><span class="token comment"># /usr/sbin/oracleasm configure -i</span>
Configuring the Oracle ASM library driver.

This will configure the on-boot properties of the Oracle ASM library
driver.  The following questions will determine whether the driver is
loaded on boot and what permissions it will have.  The current values
will be shown <span class="token keyword">in</span> brackets <span class="token punctuation">(</span><span class="token string">'[]'</span><span class="token punctuation">)</span>.  Hitting <span class="token operator">&lt;</span>ENTER<span class="token operator">></span> without typing an
answer will keep that current value.  Ctrl-C will abort.

Default user to own the driver interface <span class="token punctuation">[</span><span class="token punctuation">]</span>: grid
Default group to own the driver interface <span class="token punctuation">[</span><span class="token punctuation">]</span>: asmadmin
Start Oracle ASM library driver on boot <span class="token punctuation">(</span>y/n<span class="token punctuation">)</span> <span class="token punctuation">[</span>n<span class="token punctuation">]</span>: y
Scan <span class="token keyword">for</span> Oracle ASM disks on boot <span class="token punctuation">(</span>y/n<span class="token punctuation">)</span> <span class="token punctuation">[</span>y<span class="token punctuation">]</span>: y
Writing Oracle ASM library driver configuration: <span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Load the oracleasm kernel module:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac01 soft<span class="token punctuation">]</span><span class="token comment"># /usr/sbin/oracleasm init</span>
Creating /dev/oracleasm <span class="token function">mount</span> point: /dev/oracleasm
Loading module <span class="token string">"oracleasm"</span><span class="token builtin class-name">:</span> oracleasm
Configuring <span class="token string">"oracleasm"</span> to use device physical block size
Mounting ASMlib driver filesystem: /dev/oracleasm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h4 id="Configuring-Disk-Devices-to-Use-Oracle-ASMLIB"><a href="#Configuring-Disk-Devices-to-Use-Oracle-ASMLIB" class="headerlink" title="Configuring Disk Devices to Use Oracle ASMLIB"></a>Configuring Disk Devices to Use Oracle ASMLIB</h4><ol>
<li><p>Use either <code>fdisk</code> or <code>parted</code> to create a single whole-disk partition on the disk devices, only on local node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">fdisk</span> /dev/sdb
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Mark a disk as an Oracle Automatic Storage Management disk, only on local node:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/usr/sbin/oracleasm createdisk OCR01 /dev/sdb1
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>To make the disk available on the other nodes in the cluster, enter the following command as root on each node:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac02 soft<span class="token punctuation">]</span><span class="token comment"># oracleasm scandisks</span>
Reloading disk partitions: <span class="token keyword">done</span>
Cleaning any stale ASM disks<span class="token punctuation">..</span>.
Scanning system <span class="token keyword">for</span> ASM disks<span class="token punctuation">..</span>.
Instantiating disk <span class="token string">"OCR01"</span>
Instantiating disk <span class="token string">"OCR02"</span>
Instantiating disk <span class="token string">"DATA01"</span>
Instantiating disk <span class="token string">"MGMT01"</span>
Instantiating disk <span class="token string">"OCR03"</span>
Instantiating disk <span class="token string">"ARCH01"</span>
<span class="token punctuation">[</span>root@oracle19crac02 soft<span class="token punctuation">]</span><span class="token comment"># oracleasm listdisks</span>
ARCH01
DATA01
MGMT01
OCR01
OCR02
OCR03<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="Configuring-Kernel-Parameters-for-Linux"><a href="#Configuring-Kernel-Parameters-for-Linux" class="headerlink" title="Configuring Kernel Parameters for Linux"></a>Configuring Kernel Parameters for Linux</h3><p>Create or edit the <code>/etc/sysctl.d/97-oracle-database-sysctl.conf</code> file, and add or edit lines similar to:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/97-oracle-database-sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
fs.file-max = 6815744
kernel.sem = 250 32000 100 128
kernel.shmmni = 4096
kernel.shmall = 1835008
kernel.shmmax = 6442450944
kernel.panic_on_oops = 1
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
net.ipv4.conf.all.rp_filter = 2
net.ipv4.conf.default.rp_filter = 2
fs.aio-max-nr = 1048576
net.ipv4.ip_local_port_range = 9000 65500
vm.nr_hugepages = 3584
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Configuring-Resource-Limits-for-Oracle-Software-Installation-Users"><a href="#Configuring-Resource-Limits-for-Oracle-Software-Installation-Users" class="headerlink" title="Configuring Resource Limits for Oracle Software Installation Users"></a>Configuring Resource Limits for Oracle Software Installation Users</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/security/limits.d/oracle-database-limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
grid   soft   nofile    1024
grid   hard   nofile    65536
grid   soft   nproc    2047
grid   hard   nproc    16384
grid   soft   stack    10240
grid   hard   stack    32768
grid   hard   memlock    10869992
grid   soft   memlock    10869992
oracle   soft   nofile    1024
oracle   hard   nofile    65536
oracle   soft   nproc    2047
oracle   hard   nproc    16384
oracle   soft   stack    10240
oracle   hard   stack    32768
oracle   hard   memlock    10869992
oracle   soft   memlock    10869992
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><ol>
<li><p>Download and change the Oracle Grid Infrastructure image files permissions.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /soft/LINUX.X64_193000_grid_home.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>grid</code> user, extract the files into the Grid home.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> <span class="token parameter variable">-q</span> /soft/LINUX.X64_193000_grid_home.zip <span class="token parameter variable">-d</span> <span class="token variable">$GRID_HOME</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>root</code> user, installing the cvuqdisk RPM on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">CVUQDISK_GRP</span><span class="token operator">=</span>oinstall<span class="token punctuation">;</span> <span class="token builtin class-name">export</span> CVUQDISK_GRP
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> /u01/app/19.0.0/grid/cv/rpm/cvuqdisk-1.0.10-1.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>grid</code> user, verify that all of the cluster nodes meet the installation requirements:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$GRID_HOME</span>/runcluvfy.sh stage <span class="token parameter variable">-pre</span> crsinst <span class="token parameter variable">-n</span> oracle19crac01,oracle19crac02,oracle19crac03<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>grid</code> user, run installer script.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$GRID_HOME</span>/gridSetup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><ol>
<li><p>Download and change the Oracle Database image files permissions.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /soft/LINUX.X64_193000_db_home.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, extract the files into the Oracle home.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> <span class="token parameter variable">-q</span> /soft/LINUX.X64_193000_db_home.zip <span class="token parameter variable">-d</span> <span class="token variable">$ORACLE_HOME</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, run installer.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h1 id="Patch-34130714-GI-Release-Update-19-16-0-0-220719"><a href="#Patch-34130714-GI-Release-Update-19-16-0-0-220719" class="headerlink" title="Patch 34130714 - GI Release Update 19.16.0.0.220719"></a>Patch 34130714 - GI Release Update 19.16.0.0.220719</h1><ul>
<li><a href="/blog/posts/c3410626.html">Patch 34130714_190000</a></li>
</ul>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Installing Oracle 19.3.0.0 On RHEL 8.7</title>
    <url>/blog/posts/253ef826.html</url>
    <content><![CDATA[<h1 id="Installing-Oracle-19-3-0-0-On-RHEL-8-7"><a href="#Installing-Oracle-19-3-0-0-On-RHEL-8-7" class="headerlink" title="Installing Oracle 19.3.0.0 On RHEL 8.7"></a>Installing Oracle 19.3.0.0 On RHEL 8.7</h1><blockquote>
<p>Operating System: RHEL 8.7<br>Database Software: LINUX.X64_193000_db_home.zip</p>
</blockquote>
<h2 id="Oracle-Oracle-Single-Instance-Requirements"><a href="#Oracle-Oracle-Single-Instance-Requirements" class="headerlink" title="Oracle Oracle Single Instance Requirements"></a>Oracle Oracle Single Instance Requirements</h2><h2 id="Configuring-Operating-Systems-for-Oracle-Single-Instance"><a href="#Configuring-Operating-Systems-for-Oracle-Single-Instance" class="headerlink" title="Configuring Operating Systems for Oracle Single Instance"></a>Configuring Operating Systems for Oracle Single Instance</h2><p>Disabling Firewall and SElinux.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl disable firewalld <span class="token parameter variable">--now</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/SELINUX=/&#123;s/enforcing/disabled/&#125;'</span> /etc/selinux/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Zero Configuration Network.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-p</span> /etc/sysconfig/network<span class="token punctuation">&#123;</span>,.bak.<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%m%d<span class="token variable">`</span></span><span class="token punctuation">&#125;</span>
<span class="token builtin class-name">echo</span> <span class="token string">"NOZEROCONF=yes"</span> <span class="token operator">>></span> /etc/sysconfig/network<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Disabling Transparent Huagepages.</p>
<ul>
<li><a href="/blog/posts/ffa54a43.html">How to disable transparent hugepages (THP) on Red Hat Enterprise Linux 7, 8 and 9</a></li>
</ul>
<p>Configuring Public, Private, Virtual and SCAN IP names and Addresses.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 19c
192.168.3.108   oracle19cdg
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Setting Yum Repository.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> /dev/sr0 /mnt

<span class="token function">cat</span> <span class="token operator">></span> /etc/yum.repos.d/media.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[InstallMedia_BaseOS]
name=Red Hat Enterprise Linux 8.7.0 BaseOS
baseurl=file:///mnt/BaseOS
gpgcheck=0
enabled=1

[InstallMedia_AppStream]
name=Red Hat Enterprise Linux 8.7.0 AppStream
baseurl=file:///mnt/AppStream
gpgcheck=0
enabled=1
EOF</span>

yum clean all <span class="token operator">&amp;&amp;</span> yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Installing Operating System Packages.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">--qf</span> <span class="token string">'%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125;  (%&#123;ARCH&#125;)\n'</span> <span class="token punctuation">\</span>
<span class="token function">bc</span> binutils elfutils-libelf elfutils-libelf-devel fontconfig-devel <span class="token punctuation">\</span>
glibc glibc-devel ksh libaio libaio-devel libXrender libX11 libXau <span class="token punctuation">\</span>
libXi libXtst libgcc libnsl librdmacm libstdc++ libstdc++-devel <span class="token punctuation">\</span>
libxcb libibverbs <span class="token function">make</span> smartmontools sysstat <span class="token function">unzip</span> xorg-x11-xauth<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database"><a href="#Configuring-Users-Groups-and-Environments-for-Oracle-Grid-Infrastructure-and-Oracle-Database" class="headerlink" title="Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database"></a>Configuring Users, Groups and Environments for Oracle Grid Infrastructure and Oracle Database</h2><p>Create Oracle software owner user accounts on each cluster node</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54321</span> oinstall
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54322</span> dba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54323</span> oper
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54324</span> backupdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54325</span> dgdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54326</span> kmdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">54330</span> racdba
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">54321</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba,oper,backupdba,dgdba,kmdba,racdba <span class="token parameter variable">-m</span> <span class="token parameter variable">-d</span> /home/oracle <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-c</span> <span class="token string">"Oracle Software Owner"</span> oracle
<span class="token builtin class-name">echo</span> <span class="token string">"oracle"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Create Grid home and Oracle home directories on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/19.0.0/dbhome_1
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /u01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Configure Oracle Software owner user account environment on each cluster node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /home/oracle/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">"EOF"
# The following is add for Oracle 19c
umask 022
export ORACLE_SID=coco
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/19.0.0/dbhome_1
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
# alias sqlplus='rlwrap sqlplus'
# alias rman='rlwrap rman'
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Completing-Preinstallation-Tasks-Manually"><a href="#Completing-Preinstallation-Tasks-Manually" class="headerlink" title="Completing Preinstallation Tasks Manually"></a>Completing Preinstallation Tasks Manually</h2><h3 id="Configuring-Kernel-Parameters-for-Linux"><a href="#Configuring-Kernel-Parameters-for-Linux" class="headerlink" title="Configuring Kernel Parameters for Linux"></a>Configuring Kernel Parameters for Linux</h3><p>Create or edit the <code>/etc/sysctl.d/97-oracle-database-sysctl.conf</code> file, and add or edit lines similar to:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/97-oracle-database-sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
fs.file-max = 6815744
kernel.sem = 250 32000 100 128
kernel.shmmni = 4096
kernel.shmall = 1835008
kernel.shmmax = 6442450944
kernel.panic_on_oops = 1
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
net.ipv4.conf.all.rp_filter = 2
net.ipv4.conf.default.rp_filter = 2
fs.aio-max-nr = 1048576
net.ipv4.ip_local_port_range = 9000 65500
vm.nr_hugepages = 3584
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Configuring-Resource-Limits-for-Oracle-Software-Installation-Users"><a href="#Configuring-Resource-Limits-for-Oracle-Software-Installation-Users" class="headerlink" title="Configuring Resource Limits for Oracle Software Installation Users"></a>Configuring Resource Limits for Oracle Software Installation Users</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /etc/security/limits.d/oracle-database-limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
oracle   soft   nofile    1024
oracle   hard   nofile    65536
oracle   soft   nproc    2047
oracle   hard   nproc    16384
oracle   soft   stack    10240
oracle   hard   stack    32768
oracle   hard   memlock    10869992
oracle   soft   memlock    10869992
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><ol>
<li><p>Download and change the Oracle Database image files permissions.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /soft/LINUX.X64_193000_db_home.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, extract the files into the Grid home.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> <span class="token parameter variable">-q</span> /soft/LINUX.X64_193000_db_home.zip <span class="token parameter variable">-d</span> <span class="token variable">$ORACLE_HOME</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log in as the <code>oracle</code> user, Run installer.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="Patch-34133642-Database-Release-Update-19-16-0-0-220719"><a href="#Patch-34133642-Database-Release-Update-19-16-0-0-220719" class="headerlink" title="Patch 34133642 - Database Release Update 19.16.0.0.220719"></a>Patch 34133642 - Database Release Update 19.16.0.0.220719</h2><ul>
<li><a href="/blog/posts/4422928f.html">Patch 34133642_190000</a></li>
</ul>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>db_install_11g.rsp</title>
    <url>/blog/posts/fc154a3d.html</url>
    <content><![CDATA[<h1 id="db-install-11g-rsp"><a href="#db-install-11g-rsp" class="headerlink" title="db_install_11g.rsp"></a>db_install_11g.rsp</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">####################################################################</span>
<span class="token comment">## Copyright(c) Oracle Corporation 1998,2013. All rights reserved.##</span>
<span class="token comment">##                                                                ##</span>
<span class="token comment">## Specify values for the variables listed below to customize     ##</span>
<span class="token comment">## your installation.                                             ##</span>
<span class="token comment">##                                                                ##</span>
<span class="token comment">## Each variable is associated with a comment. The comment        ##</span>
<span class="token comment">## can help to populate the variables with the appropriate        ##</span>
<span class="token comment">## values.                                                        ##</span>
<span class="token comment">##                                                                ##</span>
<span class="token comment">## IMPORTANT NOTE: This file contains plain text passwords and    ##</span>
<span class="token comment">## should be secured to have read permission only by oracle user  ##</span>
<span class="token comment">## or db administrator who owns this installation.                ##</span>
<span class="token comment">##                                                                ##</span>
<span class="token comment">####################################################################</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Do not change the following system generated value.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.responseFileVersion</span><span class="token operator">=</span>/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the installation option.</span>
<span class="token comment"># It can be one of the following:</span>
<span class="token comment">#   - INSTALL_DB_SWONLY</span>
<span class="token comment">#   - INSTALL_DB_AND_CONFIG</span>
<span class="token comment">#   - UPGRADE_DB</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.option</span><span class="token operator">=</span>INSTALL_DB_SWONLY

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the hostname of the system as set during the install. It can be used</span>
<span class="token comment"># to force the installation to use an alternative hostname rather than using the</span>
<span class="token comment"># first hostname found on the system. (e.g., for systems with multiple hostnames</span>
<span class="token comment"># and network interfaces)</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">ORACLE_HOSTNAME</span><span class="token operator">=</span>localhost

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the Unix group to be set for the inventory directory.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">UNIX_GROUP_NAME</span><span class="token operator">=</span>oinstall

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the location which holds the inventory files.</span>
<span class="token comment"># This is an optional parameter if installing on</span>
<span class="token comment"># Windows based Operating System.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">INVENTORY_LOCATION</span><span class="token operator">=</span>/u01/app/oraInventory

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the languages in which the components will be installed.</span>
<span class="token comment">#</span>
<span class="token comment"># en   : English                  ja   : Japanese</span>
<span class="token comment"># fr   : French                   ko   : Korean</span>
<span class="token comment"># ar   : Arabic                   es   : Latin American Spanish</span>
<span class="token comment"># bn   : Bengali                  lv   : Latvian</span>
<span class="token comment"># pt_BR: Brazilian Portuguese     lt   : Lithuanian</span>
<span class="token comment"># bg   : Bulgarian                ms   : Malay</span>
<span class="token comment"># fr_CA: Canadian French          es_MX: Mexican Spanish</span>
<span class="token comment"># ca   : Catalan                  no   : Norwegian</span>
<span class="token comment"># hr   : Croatian                 pl   : Polish</span>
<span class="token comment"># cs   : Czech                    pt   : Portuguese</span>
<span class="token comment"># da   : Danish                   ro   : Romanian</span>
<span class="token comment"># nl   : Dutch                    ru   : Russian</span>
<span class="token comment"># ar_EG: Egyptian                 zh_CN: Simplified Chinese</span>
<span class="token comment"># en_GB: English (Great Britain)  sk   : Slovak</span>
<span class="token comment"># et   : Estonian                 sl   : Slovenian</span>
<span class="token comment"># fi   : Finnish                  es_ES: Spanish</span>
<span class="token comment"># de   : German                   sv   : Swedish</span>
<span class="token comment"># el   : Greek                    th   : Thai</span>
<span class="token comment"># iw   : Hebrew                   zh_TW: Traditional Chinese</span>
<span class="token comment"># hu   : Hungarian                tr   : Turkish</span>
<span class="token comment"># is   : Icelandic                uk   : Ukrainian</span>
<span class="token comment"># in   : Indonesian               vi   : Vietnamese</span>
<span class="token comment"># it   : Italian</span>
<span class="token comment">#</span>
<span class="token comment"># all_langs   : All languages</span>
<span class="token comment">#</span>
<span class="token comment"># Specify value as the following to select any of the languages.</span>
<span class="token comment"># Example : SELECTED_LANGUAGES=en,fr,ja</span>
<span class="token comment">#</span>
<span class="token comment"># Specify value as the following to select all the languages.</span>
<span class="token comment"># Example : SELECTED_LANGUAGES=all_langs</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">SELECTED_LANGUAGES</span><span class="token operator">=</span>en,zh_CN

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the complete path of the Oracle Home.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span>/u01/app/oracle/product/11.2.0/dbhome_1

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the complete path of the Oracle Base.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the installation edition of the component.</span>
<span class="token comment">#</span>
<span class="token comment"># The value should contain only one of these choices.</span>
<span class="token comment">#   - EE     : Enterprise Edition</span>
<span class="token comment">#   - SE     : Standard Edition</span>
<span class="token comment">#   - SEONE  : Standard Edition One</span>
<span class="token comment">#   - PE     : Personal Edition (WINDOWS ONLY)</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.InstallEdition</span><span class="token operator">=</span>EE

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable is used to enable or disable custom install and is considered</span>
<span class="token comment"># only if InstallEdition is EE.</span>
<span class="token comment">#</span>
<span class="token comment"># true  : Components mentioned as part of 'optionalComponents' property</span>
<span class="token comment">#         are considered for install.</span>
<span class="token comment"># false : Value for 'optionalComponents' is not considered.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.EEOptionsSelection</span><span class="token operator">=</span>false

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable is considered only if 'EEOptionsSelection' is set to true.</span>
<span class="token comment">#</span>
<span class="token comment"># Description: List of Enterprise Edition Options you would like to enable.</span>
<span class="token comment">#</span>
<span class="token comment">#              The following choices are available. You may specify any</span>
<span class="token comment">#              combination of these choices.  The components you choose should</span>
<span class="token comment">#              be specified in the form "internal-component-name:version"</span>
<span class="token comment">#              Below is a list of components you may specify to enable.</span>
<span class="token comment">#</span>
<span class="token comment">#              oracle.oraolap:11.2.0.4.0 - Oracle OLAP</span>
<span class="token comment">#              oracle.rdbms.dm:11.2.0.4.0 - Oracle Data Mining</span>
<span class="token comment">#              oracle.rdbms.dv:11.2.0.4.0 - Oracle Database Vault</span>
<span class="token comment">#              oracle.rdbms.lbac:11.2.0.4.0 - Oracle Label Security</span>
<span class="token comment">#              oracle.rdbms.partitioning:11.2.0.4.0 - Oracle Partitioning</span>
<span class="token comment">#              oracle.rdbms.rat:11.2.0.4.0 - Oracle Real Application Testing</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.optionalComponents</span><span class="token operator">=</span>oracle.rdbms.partitioning:11.2.0.4.0,oracle.oraolap:11.2.0.4.0,oracle.rdbms.dm:11.2.0.4.0,oracle.rdbms.dv:11.2.0.4.0,oracle.rdbms.lbac:11.2.0.4.0,oracle.rdbms.rat:11.2.0.4.0

<span class="token comment">###############################################################################</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment"># PRIVILEGED OPERATING SYSTEM GROUPS                                          #</span>
<span class="token comment"># ------------------------------------------                                  #</span>
<span class="token comment"># Provide values for the OS groups to which OSDBA and OSOPER privileges       #</span>
<span class="token comment"># needs to be granted. If the install is being performed as a member of the   #</span>
<span class="token comment"># group "dba", then that will be used unless specified otherwise below.       #</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment"># The value to be specified for OSDBA and OSOPER group is only for UNIX based #</span>
<span class="token comment"># Operating System.                                                           #</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment">###############################################################################</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># The DBA_GROUP is the OS group which is to be granted OSDBA privileges.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.DBA_GROUP</span><span class="token operator">=</span>dba

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># The OPER_GROUP is the OS group which is to be granted OSOPER privileges.</span>
<span class="token comment"># The value to be specified for OSOPER group is optional.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.OPER_GROUP</span><span class="token operator">=</span>dba

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the cluster node names selected during the installation.</span>
<span class="token comment"># Example : oracle.install.db.CLUSTER_NODES=node1,node2</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.CLUSTER_NODES</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable is used to enable or disable RAC One Node install.</span>
<span class="token comment">#</span>
<span class="token comment">#   - true  : Value of RAC One Node service name is used.</span>
<span class="token comment">#   - false : Value of RAC One Node service name is not used.</span>
<span class="token comment">#</span>
<span class="token comment"># If left blank, it will be assumed to be false</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.isRACOneInstall</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the name for RAC One Node Service.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.racOneServiceName</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the type of database to create.</span>
<span class="token comment"># It can be one of the following:</span>
<span class="token comment">#   - GENERAL_PURPOSE/TRANSACTION_PROCESSING</span>
<span class="token comment">#   - DATA_WAREHOUSE</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.type</span><span class="token operator">=</span>GENERAL_PURPOSE

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the Starter Database Global Database Name.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.globalDBName</span><span class="token operator">=</span>orcl

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the Starter Database SID.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.SID</span><span class="token operator">=</span>orcl

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the Starter Database character set.</span>
<span class="token comment">#</span>
<span class="token comment"># It can be one of the following:</span>
<span class="token comment"># AL32UTF8, WE8ISO8859P15, WE8MSWIN1252, EE8ISO8859P2,</span>
<span class="token comment"># EE8MSWIN1250, NE8ISO8859P10, NEE8ISO8859P4, BLT8MSWIN1257,</span>
<span class="token comment"># BLT8ISO8859P13, CL8ISO8859P5, CL8MSWIN1251, AR8ISO8859P6,</span>
<span class="token comment"># AR8MSWIN1256, EL8ISO8859P7, EL8MSWIN1253, IW8ISO8859P8,</span>
<span class="token comment"># IW8MSWIN1255, JA16EUC, JA16EUCTILDE, JA16SJIS, JA16SJISTILDE,</span>
<span class="token comment"># KO16MSWIN949, ZHS16GBK, TH8TISASCII, ZHT32EUC, ZHT16MSWIN950,</span>
<span class="token comment"># ZHT16HKSCS, WE8ISO8859P9, TR8MSWIN1254, VN8MSWIN1258</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.characterSet</span><span class="token operator">=</span>AL32UTF8

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable should be set to true if Automatic Memory Management</span>
<span class="token comment"># in Database is desired.</span>
<span class="token comment"># If Automatic Memory Management is not desired, and memory allocation</span>
<span class="token comment"># is to be done manually, then set it to false.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.memoryOption</span><span class="token operator">=</span>true

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the total memory allocation for the database. Value(in MB) should be</span>
<span class="token comment"># at least 256 MB, and should not exceed the total physical memory available</span>
<span class="token comment"># on the system.</span>
<span class="token comment"># Example: oracle.install.db.config.starterdb.memoryLimit=512</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.memoryLimit</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable controls whether to load Example Schemas onto</span>
<span class="token comment"># the starter database or not.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.installExampleSchemas</span><span class="token operator">=</span>false

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable includes enabling audit settings, configuring password profiles</span>
<span class="token comment"># and revoking some grants to public. These settings are provided by default.</span>
<span class="token comment"># These settings may also be disabled.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.enableSecuritySettings</span><span class="token operator">=</span>true

<span class="token comment">###############################################################################</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment"># Passwords can be supplied for the following four schemas in the             #</span>
<span class="token comment"># starter database:                                                           #</span>
<span class="token comment">#   SYS                                                                       #</span>
<span class="token comment">#   SYSTEM                                                                    #</span>
<span class="token comment">#   SYSMAN (used by Enterprise Manager)                                       #</span>
<span class="token comment">#   DBSNMP (used by Enterprise Manager)                                       #</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment"># Same password can be used for all accounts (not recommended)                #</span>
<span class="token comment"># or different passwords for each account can be provided (recommended)       #</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment">###############################################################################</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable holds the password that is to be used for all schemas in the</span>
<span class="token comment"># starter database.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.password.ALL</span><span class="token operator">=</span>oracle

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the SYS password for the starter database.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.password.SYS</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the SYSTEM password for the starter database.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.password.SYSTEM</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the SYSMAN password for the starter database.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.password.SYSMAN</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the DBSNMP password for the starter database.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.password.DBSNMP</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the management option to be selected for the starter database.</span>
<span class="token comment"># It can be one of the following:</span>
<span class="token comment">#   - GRID_CONTROL</span>
<span class="token comment">#   - DB_CONTROL</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.control</span><span class="token operator">=</span>DB_CONTROL

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the Management Service to use if Grid Control is selected to manage</span>
<span class="token comment"># the database.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.gridcontrol.gridControlServiceURL</span><span class="token operator">=</span>

<span class="token comment">###############################################################################</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment"># SPECIFY BACKUP AND RECOVERY OPTIONS                                         #</span>
<span class="token comment"># ------------------------------------                                        #</span>
<span class="token comment"># Out-of-box backup and recovery options for the database can be mentioned    #</span>
<span class="token comment"># using the entries below.                                                    #</span>
<span class="token comment">#                                                                             #</span>
<span class="token comment">###############################################################################</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># This variable is to be set to false if automated backup is not required. Else</span>
<span class="token comment"># this can be set to true.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.automatedBackup.enable</span><span class="token operator">=</span>false

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Regardless of the type of storage that is chosen for backup and recovery, if</span>
<span class="token comment"># automated backups are enabled, a job will be scheduled to run daily to backup</span>
<span class="token comment"># the database. This job will run as the operating system user that is</span>
<span class="token comment"># specified in this variable.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.automatedBackup.osuid</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Regardless of the type of storage that is chosen for backup and recovery, if</span>
<span class="token comment"># automated backups are enabled, a job will be scheduled to run daily to backup</span>
<span class="token comment"># the database. This job will run as the operating system user specified by the</span>
<span class="token comment"># above entry. The following entry stores the password for the above operating</span>
<span class="token comment"># system user.</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.automatedBackup.ospwd</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the type of storage to use for the database.</span>
<span class="token comment"># It can be one of the following:</span>
<span class="token comment">#   - FILE_SYSTEM_STORAGE</span>
<span class="token comment">#   - ASM_STORAGE</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.storageType</span><span class="token operator">=</span>FILE_SYSTEM_STORAGE

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the database file location which is a directory for datafiles, control</span>
<span class="token comment"># files, redo logs.</span>
<span class="token comment">#</span>
<span class="token comment"># Applicable only when oracle.install.db.config.starterdb.storage=FILE_SYSTEM_STORAGE</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the backup and recovery location.</span>
<span class="token comment">#</span>
<span class="token comment"># Applicable only when oracle.install.db.config.starterdb.storage=FILE_SYSTEM_STORAGE</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the existing ASM disk groups to be used for storage.</span>
<span class="token comment">#</span>
<span class="token comment"># Applicable only when oracle.install.db.config.starterdb.storage=ASM_STORAGE</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.asm.diskGroup</span><span class="token operator">=</span>

<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the password for ASMSNMP user of the ASM instance.</span>
<span class="token comment">#</span>
<span class="token comment"># Applicable only when oracle.install.db.config.starterdb.storage=ASM_STORAGE</span>
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.install.db.config.asm.ASMSNMPPassword</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the My Oracle Support Account Username.</span>
<span class="token comment">#</span>
<span class="token comment">#  Example   : MYORACLESUPPORT_USERNAME=abc@oracle.com</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">MYORACLESUPPORT_USERNAME</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the My Oracle Support Account Username password.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : MYORACLESUPPORT_PASSWORD=password</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">MYORACLESUPPORT_PASSWORD</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify whether to enable the user to set the password for</span>
<span class="token comment"># My Oracle Support credentials. The value can be either true or false.</span>
<span class="token comment"># If left blank it will be assumed to be false.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : SECURITY_UPDATES_VIA_MYORACLESUPPORT=true</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">SECURITY_UPDATES_VIA_MYORACLESUPPORT</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify whether user doesn't want to configure Security Updates.</span>
<span class="token comment"># The value for this variable should be true if you don't want to configure</span>
<span class="token comment"># Security Updates, false otherwise.</span>
<span class="token comment">#</span>
<span class="token comment"># The value can be either true or false. If left blank it will be assumed</span>
<span class="token comment"># to be false.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : DECLINE_SECURITY_UPDATES=false</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">DECLINE_SECURITY_UPDATES</span><span class="token operator">=</span>true

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the Proxy server name. Length should be greater than zero.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : PROXY_HOST=proxy.domain.com</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">PROXY_HOST</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the proxy port number. Should be Numeric and at least 2 chars.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : PROXY_PORT=25</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">PROXY_PORT</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the proxy user name. Leave PROXY_USER and PROXY_PWD</span>
<span class="token comment"># blank if your proxy server requires no authentication.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : PROXY_USER=username</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">PROXY_USER</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the proxy password. Leave PROXY_USER and PROXY_PWD</span>
<span class="token comment"># blank if your proxy server requires no authentication.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : PROXY_PWD=password</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">PROXY_PWD</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the proxy realm. This value is used if auto-updates option is selected.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : PROXY_REALM=metalink</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">PROXY_REALM</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the Oracle Support Hub URL.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : COLLECTOR_SUPPORTHUB_URL=https://orasupporthub.company.com:8080/</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">COLLECTOR_SUPPORTHUB_URL</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the auto-updates option. It can be one of the following:</span>
<span class="token comment">#   - MYORACLESUPPORT_DOWNLOAD</span>
<span class="token comment">#   - OFFLINE_UPDATES</span>
<span class="token comment">#   - SKIP_UPDATES</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.installer.autoupdates.option</span><span class="token operator">=</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># In case MYORACLESUPPORT_DOWNLOAD option is chosen, specify the location where</span>
<span class="token comment"># the updates are to be downloaded.</span>
<span class="token comment"># In case OFFLINE_UPDATES option is chosen, specify the location where the updates</span>
<span class="token comment"># are present.</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">oracle.installer.autoupdates.downloadUpdatesLoc</span><span class="token operator">=</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the My Oracle Support Account Username which has the patches download privileges</span>
<span class="token comment"># to be used for software updates.</span>
<span class="token comment">#  Example   : AUTOUPDATES_MYORACLESUPPORT_USERNAME=abc@oracle.com</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">AUTOUPDATES_MYORACLESUPPORT_USERNAME</span><span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token comment"># Specify the My Oracle Support Account Username password which has the patches download privileges</span>
<span class="token comment"># to be used for software updates.</span>
<span class="token comment">#</span>
<span class="token comment"># Example    : AUTOUPDATES_MYORACLESUPPORT_PASSWORD=password</span>
<span class="token comment">#------------------------------------------------------------------------------</span>
<span class="token assign-left variable">AUTOUPDATES_MYORACLESUPPORT_PASSWORD</span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>rsp</tag>
      </tags>
  </entry>
  <entry>
    <title>dbca_11g.rsp</title>
    <url>/blog/posts/c589b96.html</url>
    <content><![CDATA[<h1 id="dbca-rsp"><a href="#dbca-rsp" class="headerlink" title="dbca.rsp"></a>dbca.rsp</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">##############################################################################</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">##                            DBCA response file                            ##</span>
<span class="token comment">##                            ------------------                            ##</span>
<span class="token comment">## Copyright   1998, 2014, Oracle Corporation. All Rights Reserved.         ##</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">## Specify values for the variables listed below to customize Oracle        ##</span>
<span class="token comment">## Database Configuration installation.                                     ##</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">## Each variable is associated with a comment. The comment identifies the   ##</span>
<span class="token comment">## variable type.                                                           ##</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">## Please specify the values in the following format :                      ##</span>
<span class="token comment">##          Type       :  Example                                           ##</span>
<span class="token comment">##          String     :  "&lt;value>"                                         ##</span>
<span class="token comment">##          Boolean    :  True or False                                     ##</span>
<span class="token comment">##          Number     :  &lt;numeric value>                                   ##</span>
<span class="token comment">##          StringList :  &#123;"&lt;value1>","&lt;value2>"&#125;                           ##</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">## Examples :                                                               ##</span>
<span class="token comment">##     1. dbca -progress_only -responseFile &lt;response file>                 ##</span>
<span class="token comment">##        Display a progress bar depicting progress of database creation    ##</span>
<span class="token comment">##        process.                                                          ##</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">##     2. dbca -silent -responseFile &lt;response file>                        ##</span>
<span class="token comment">##        Creates database silently. No user interface is displayed.        ##</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">##     3. dbca -silent -createDatabase -cloneTemplate                       ##</span>
<span class="token comment">##             -responseFile &lt;response file>                      ##</span>
<span class="token comment">##        Creates database silently with clone template. The template in    ##</span>
<span class="token comment">##      responsefile is a clone template.                         ##</span>
<span class="token comment">##                                                                          ##</span>
<span class="token comment">##     4. dbca -silent -deleteDatabase -responseFile &lt;response file>        ##</span>
<span class="token comment">##        Deletes database silently.                                        ##</span>
<span class="token comment">##############################################################################</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># GENERAL section is required for all types of database creations.</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>GENERAL<span class="token punctuation">]</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : RESPONSEFILE_VERSION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Version of the database to create</span>
<span class="token comment"># Valid values  : "11.2.0"</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
RESPONSEFILE_VERSION <span class="token operator">=</span> <span class="token string">"11.2.0"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OPERATION_TYPE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Type of operation</span>
<span class="token comment"># Valid values  : "createDatabase" \ "createTemplateFromDB" \ "createCloneTemplate" \ "deleteDatabase" \ "configureDatabase" \ "addInstance" (RAC-only) \ "deleteInstance" (RAC-only) \ "createPluggableDatabase" \ "unplugDatabase" \ "deletePluggableDatabase" \ "configurePluggableDatabase"</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
OPERATION_TYPE <span class="token operator">=</span> <span class="token string">"createDatabase"</span>

<span class="token comment">#-----------------------*** End of GENERAL section ***------------------------</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># CREATEDATABASE section is used when OPERATION_TYPE is defined as "createDatabase".</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>CREATEDATABASE<span class="token punctuation">]</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : GDBNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Global database name of the database</span>
<span class="token comment"># Valid values  : &lt;db_name>.&lt;db_domain> - when database domain isn't NULL</span>
<span class="token comment">#                 &lt;db_name>             - when database domain is NULL</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
GDBNAME <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DATABASECONFTYPE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : database conf type as Single Instance, Real Application Cluster or Real Application Cluster One Nodes database</span>
<span class="token comment"># Valid values  : SI\RAC\RACONENODE</span>
<span class="token comment"># Default value : SI</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
DATABASECONFTYPE  <span class="token operator">=</span> <span class="token string">"SI"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : RACONENODESERVICENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Service is required by application to connect to RAC One</span>
<span class="token comment">#          Node Database</span>
<span class="token comment"># Valid values  : Service Name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No [required in case DATABASECONFTYPE is set to RACONENODE]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#RACONENODESERVICENAME =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : POLICYMANAGED</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Set to true if Database is policy managed and</span>
<span class="token comment">#          set to false if  Database is admin managed</span>
<span class="token comment"># Valid values  : TRUE\FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#POLICYMANAGED = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CREATESERVERPOOL</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Set to true if new server pool need to be created for database</span>
<span class="token comment">#          if this option is specified then the newly created database</span>
<span class="token comment">#          will use this newly created serverpool.</span>
<span class="token comment">#          Multiple serverpoolname can not be specified for database</span>
<span class="token comment"># Valid values  : TRUE\FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#CREATESERVERPOOL = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SERVERPOOLNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Only one serverpool name need to be specified</span>
<span class="token comment">#           if Create Server Pool option is specified.</span>
<span class="token comment">#           Comma-separated list of Serverpool names if db need to use</span>
<span class="token comment">#           multiple Server pool</span>
<span class="token comment"># Valid values  : ServerPool name</span>

<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No [required in case of RAC service centric database]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SERVERPOOLNAME =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CARDINALITY</span>
<span class="token comment"># Datatype      : Number</span>
<span class="token comment"># Description   : Specify Cardinality for create server pool operation</span>

<span class="token comment"># Valid values  : any positive Integer value</span>
<span class="token comment"># Default value : Number of qualified nodes on cluster</span>
<span class="token comment"># Mandatory     : No [Required when a new serverpool need to be created]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#CARDINALITY =</span>




<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : FORCE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Set to true if new server pool need to be created by force</span>
<span class="token comment">#          if this option is specified then the newly created serverpool</span>
<span class="token comment">#          will be assigned server even if no free servers are available.</span>
<span class="token comment">#          This may affect already running database.</span>
<span class="token comment">#          This flag can be specified for Admin managed as well as policy managed db.</span>
<span class="token comment"># Valid values  : TRUE\FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#FORCE = "false"</span>



<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PQPOOLNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Only one serverpool name needs to be specified</span>
<span class="token comment">#           if create server pool option is specified.</span>
<span class="token comment">#           Comma-separated list of serverpool names if use</span>
<span class="token comment">#           server pool. This is required to</span>
<span class="token comment">#                  create Parallel Query (PQ) database. Applicable to Big Cluster</span>
<span class="token comment"># Valid values  :  Parallel Query (PQ) pool name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No [required in case of RAC service centric database]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#PQPOOLNAME =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PQCARDINALITY</span>
<span class="token comment"># Datatype      : Number</span>
<span class="token comment"># Description   : Specify Cardinality for create server pool operation.</span>
<span class="token comment">#                 Applicable to Big Cluster</span>
<span class="token comment"># Valid values  : any positive Integer value</span>
<span class="token comment"># Default value : Number of qualified nodes on cluster</span>
<span class="token comment"># Mandatory     : No [Required when a new serverpool need to be created]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#PQCARDINALITY =</span>




<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SID</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : System identifier (SID) of the database</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : &lt;db_name> specified in GDBNAME</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SID <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CREATEASCONTAINERDATABASE</span>
<span class="token comment"># Datatype      : boolean</span>
<span class="token comment"># Description   : flag to create database as container database</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : false</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#CREATEASCONTAINERDATABASE =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : NUMBEROFPDBS</span>
<span class="token comment"># Datatype      : Number</span>
<span class="token comment"># Description   : Specify the number of pdb to be created</span>
<span class="token comment"># Valid values  : 0 to 252</span>
<span class="token comment"># Default value : 0</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#NUMBEROFPDBS =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specify the pdbname/pdbanme prefix if one or more pdb need to be created</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#PDBNAME =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBADMINPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : PDB Administrator user password</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBADMINPASSWORD = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : NODELIST</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Comma-separated list of cluster nodes</span>
<span class="token comment"># Valid values  : Cluster node names</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No (Yes for RAC database-centric database)</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#NODELIST=</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : TEMPLATENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Name of the template</span>
<span class="token comment"># Valid values  : Template file name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
TEMPLATENAME <span class="token operator">=</span> <span class="token string">"General_Purpose.dbc"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OBFUSCATEDPASSWORDS</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Set to true if passwords are encrypted</span>
<span class="token comment"># Valid values  : TRUE\FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OBFUSCATEDPASSWORDS = FALSE</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for SYS user</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SYSPASSWORD <span class="token operator">=</span> <span class="token string">"oracle"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSTEMPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for SYSTEM user</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SYSTEMPASSWORD <span class="token operator">=</span> <span class="token string">"oracle"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SERVICEUSERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for Windows Service user</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : If Oracle home is installed with windows service user</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SERVICEUSERPASSWORD = "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMCONFIGURATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Enterprise Manager Configuration Type</span>
<span class="token comment"># Valid values  : CENTRAL|DBEXPRESS|ALL|NONE</span>
<span class="token comment"># Default value : NONE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMCONFIGURATION = "NONE"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMEXPRESSPORT</span>
<span class="token comment"># Datatype      : Number</span>
<span class="token comment"># Description   : Enterprise Manager Configuration Type</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : NONE</span>
<span class="token comment"># Mandatory     : No, will be picked up from DBEXPRESS_HTTPS_PORT env variable</span>
<span class="token comment">#                 or auto generates a free port between 5500 and 5599</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMEXPRESSPORT = ""</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : RUNCVUCHECKS</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify whether to run Cluster Verification Utility checks</span>
<span class="token comment">#                 periodically in Cluster environment</span>
<span class="token comment"># Valid values  : TRUE\FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#RUNCVUCHECKS = FALSE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DBSNMPPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for DBSNMP user</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if EMCONFIGURATION is specified or</span>
<span class="token comment">#                 the value of RUNCVUCHECKS is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DBSNMPPASSWORD = "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OMSHOST</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : EM management server host name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OMSHOST =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OMSPORT</span>
<span class="token comment"># Datatype      : Number</span>
<span class="token comment"># Description   : EM management server port number</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OMSPORT =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMUSER</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : EM Admin username to add or modify targets</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMUSER =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : EM Admin user password</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMPASSWORD=</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVCONFIGURATION</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify "True" to configure and enable Oracle Database vault</span>
<span class="token comment"># Valid values  : True/False</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVCONFIGURATION = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERPASSWORD = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for  DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERPASSWORD = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OLSCONFIGURATION</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify "True" to configure and enable Oracle Label Security</span>
<span class="token comment"># Valid values  : True/False</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OLSCONFIGURATION = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DATAFILEJARLOCATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Location of the data file jar</span>
<span class="token comment"># Valid values  : Directory containing compressed datafile jar</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DATAFILEJARLOCATION =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DATAFILEDESTINATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Location of the data file's</span>
<span class="token comment"># Valid values  : Directory for all the database files</span>
<span class="token comment"># Default value : $ORACLE_BASE/oradata</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token assign-left variable">DATAFILEDESTINATION</span><span class="token operator">=</span>/u01/app/oracle/oradata

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : RECOVERYAREADESTINATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Location of the data file's</span>
<span class="token comment"># Valid values  : Recovery Area location</span>
<span class="token comment"># Default value : $ORACLE_BASE/flash_recovery_area</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token assign-left variable">RECOVERYAREADESTINATION</span><span class="token operator">=</span>/u01/app/oracle/oradata

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : STORAGETYPE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the storage on which the database is to be created</span>
<span class="token comment"># Valid values  : FS (CFS for RAC), ASM</span>
<span class="token comment"># Default value : FS</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token assign-left variable">STORAGETYPE</span><span class="token operator">=</span>FS

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DISKGROUPNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the disk group name for the storage</span>
<span class="token comment"># Default value : DATA</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DISKGROUPNAME=DATA</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : ASMSNMP_PASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for ASM Monitoring</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#ASMSNMP_PASSWORD=""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : RECOVERYGROUPNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the disk group name for the recovery area</span>
<span class="token comment"># Default value : RECOVERY</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#RECOVERYGROUPNAME=RECOVERY</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CHARACTERSET</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Character set of the database</span>
<span class="token comment"># Valid values  : Check Oracle12c National Language Support Guide</span>
<span class="token comment"># Default value : "US7ASCII"</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token assign-left variable">CHARACTERSET</span><span class="token operator">=</span><span class="token string">"AL32UTF8"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : NATIONALCHARACTERSET</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : National Character set of the database</span>
<span class="token comment"># Valid values  : "UTF8" or "AL16UTF16". For details, check Oracle12c National Language Support Guide</span>
<span class="token comment"># Default value : "AL16UTF16"</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#NATIONALCHARACTERSET= "UTF8"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : REGISTERWITHDIRSERVICE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether to register with Directory Service.</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#REGISTERWITHDIRSERVICE= TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the name of the directory service user</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEUSERNAME= "name"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the directory service user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : WALLETPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password for wallet to created or modified.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#WALLETPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : LISTENERS</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies list of listeners to register the database with.</span>
<span class="token comment">#          By default the database is configured for all the listeners specified in the</span>
<span class="token comment">#          $ORACLE_HOME/network/admin/listener.ora</span>
<span class="token comment"># Valid values  : The list should be comma separated like "listener1,listener2".</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#LISTENERS = "listener1,listener2"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : VARIABLESFILE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Location of the file containing variable value pair</span>
<span class="token comment"># Valid values  : A valid file-system file. The variable value pair format in this file</span>
<span class="token comment">#          is &lt;variable>=&lt;value>. Each pair should be in a new line.</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#VARIABLESFILE=</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : VARIABLES</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : comma separated list of name=value pairs. Overrides variables defined in variablefile and templates</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#VARIABLES=</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : INITPARAMS</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : comma separated list of name=value pairs. Overrides initialization parameters defined in templates</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token assign-left variable">INITPARAMS</span><span class="token operator">=</span><span class="token string">"memory_target=0,sga_target=500,pga_aggregate_target=100,java_jit_enabled=false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SAMPLESCHEMA</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether or not to add the Sample Schemas to your database</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FASLE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SAMPLESCHEMA=TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : MEMORYPERCENTAGE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : percentage of physical memory for Oracle</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#MEMORYPERCENTAGE = "40"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DATABASETYPE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : used for memory distribution when MEMORYPERCENTAGE specified</span>
<span class="token comment"># Valid values  : MULTIPURPOSE|DATA_WAREHOUSING|OLTP</span>
<span class="token comment"># Default value : MULTIPURPOSE</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DATABASETYPE = "MULTIPURPOSE"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : AUTOMATICMEMORYMANAGEMENT</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : flag to indicate Automatic Memory Management is used</span>
<span class="token comment"># Valid values  : TRUE/FALSE</span>
<span class="token comment"># Default value : TRUE</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token assign-left variable">AUTOMATICMEMORYMANAGEMENT</span><span class="token operator">=</span><span class="token string">"False"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : TOTALMEMORY</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : total memory in MB to allocate to Oracle</span>
<span class="token comment"># Valid values  :</span>
<span class="token comment"># Default value :</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#TOTALMEMORY = "800"</span>


<span class="token comment">#-----------------------*** End of CREATEDATABASE section ***------------------------</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># createTemplateFromDB section is used when OPERATION_TYPE is defined as "createTemplateFromDB".</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>createTemplateFromDB<span class="token punctuation">]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database from which to create the template</span>
<span class="token comment"># Valid values  : The format is &lt;host>:&lt;port>:&lt;sid></span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SOURCEDB <span class="token operator">=</span> <span class="token string">"myhost:1521:orcl"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : A user with DBA role.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SYSDBAUSERNAME <span class="token operator">=</span> <span class="token string">"system"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the DBA user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAPASSWORD = "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : TEMPLATENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Name for the new template.</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
TEMPLATENAME <span class="token operator">=</span> <span class="token string">"My Copy TEMPLATE"</span>

<span class="token comment">#-----------------------*** End of createTemplateFromDB section ***------------------------</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># createCloneTemplate section is used when OPERATION_TYPE is defined as "createCloneTemplate".</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>createCloneTemplate<span class="token punctuation">]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database is the SID from which to create the template.</span>
<span class="token comment">#          This database must be local and on the same ORACLE_HOME.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SOURCEDB <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : A user with DBA role.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES, if no OS authentication</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAUSERNAME = "sys"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the DBA user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAPASSWORD = "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : TEMPLATENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Name for the new template.</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
TEMPLATENAME <span class="token operator">=</span> <span class="token string">"My Clone TEMPLATE"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DATAFILEJARLOCATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Location of the data file jar</span>
<span class="token comment"># Valid values  : Directory where the new compressed datafile jar will be placed</span>
<span class="token comment"># Default value : $ORACLE_HOME/assistants/dbca/templates</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DATAFILEJARLOCATION =</span>

<span class="token comment">#-----------------------*** End of createCloneTemplate section ***------------------------</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># DELETEDATABASE section is used when DELETE_TYPE is defined as "deleteDatabase".</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>DELETEDATABASE<span class="token punctuation">]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database is the SID</span>
<span class="token comment">#          This database must be local and on the same ORACLE_HOME.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SOURCEDB <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : A user with DBA role.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES, if no OS authentication</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAUSERNAME = "sys"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the DBA user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES, if no OS authentication</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAPASSWORD = "password"</span>
<span class="token comment">#-----------------------*** End of deleteDatabase section ***------------------------</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># GENERATESCRIPTS section</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>generateScripts<span class="token punctuation">]</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : TEMPLATENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Name of the template</span>
<span class="token comment"># Valid values  : Template name as seen in DBCA</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
TEMPLATENAME <span class="token operator">=</span> <span class="token string">"New Database"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : GDBNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Global database name of the database</span>
<span class="token comment"># Valid values  : &lt;db_name>.&lt;db_domain> - when database domain isn't NULL</span>
<span class="token comment">#                 &lt;db_name>             - when database domain is NULL</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
GDBNAME <span class="token operator">=</span> <span class="token string">"orcl11.us.oracle.com"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SCRIPTDESTINATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Location of the scripts</span>
<span class="token comment"># Valid values  : Directory for all the scripts</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SCRIPTDESTINATION =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMCONFIGURATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Enterprise Manager Configuration Type</span>
<span class="token comment"># Valid values  : CENTRAL</span>
<span class="token comment"># Default value : NONE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMCONFIGURATION = "NONE"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OMSHOST</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : EM management server host name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OMSHOST =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OMSPORT</span>
<span class="token comment"># Datatype      : Number</span>
<span class="token comment"># Description   : EM management server port number</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OMSPORT =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMUSER</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : EM Admin username to add or modify targets</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMUSER =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : EM Admin user password</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if CENTRAL is specified for EMCONFIGURATION</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMPASSWORD=</span>

<span class="token comment">#-----------------------*** End of deleteDatabase section ***------------------------</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># CONFIGUREDATABASE section is used when OPERATION_TYPE is defined as "configureDatabase".</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>CONFIGUREDATABASE<span class="token punctuation">]</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database is the SID</span>
<span class="token comment">#          This database must be local and on the same ORACLE_HOME.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SOURCEDB = "orcl"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : A user with DBA role.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES, if no OS authentication</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAUSERNAME = "sys"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the DBA user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES, if no OS authentication</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAPASSWORD =</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : REGISTERWITHDIRSERVICE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether to register with Directory Service.</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#REGISTERWITHDIRSERVICE= TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : UNREGISTERWITHDIRSERVICE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether to unregister with Directory Service.</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#UNREGISTERWITHDIRSERVICE= TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : REGENERATEDBPASSWORD</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether regenerate database password in OID/Wallet</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#REGENERATEDBPASSWORD= TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the name of the directory service user</span>
<span class="token comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEUSERNAME= "name"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the directory service user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : WALLETPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password for wallet to created or modified.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the any of the reg/unreg/regenPasswd options specified</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#WALLETPASSWORD= "password"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : ENABLESECURITYCONFIGURATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Database Security Settings</span>
<span class="token comment"># Valid values  : true|false</span>
<span class="token comment"># Default value : true</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#ENABLESECURITYCONFIGURATION = "true"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DBSNMPPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for DBSNMP user</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if EMCONFIGURATION is specified</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DBSNMPPASSWORD = "password"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVCONFIGURATION</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify "True" to configure and enable Oracle Database vault</span>
<span class="token comment"># Valid values  : True/False</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVCONFIGURATION = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERPASSWORD = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for  DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERPASSWORD = ""</span>

<span class="token comment">#-----------------------*** End of CONFIGUREDATABASE section ***------------------------</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># ADDINSTANCE section is used when OPERATION_TYPE is defined as "addInstance".</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>ADDINSTANCE<span class="token punctuation">]</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DB_UNIQUE_NAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DB Unique Name of the RAC database</span>
<span class="token comment"># Valid values  : &lt;db_unique_name></span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
DB_UNIQUE_NAME <span class="token operator">=</span> <span class="token string">"orcl11c.us.oracle.com"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : INSTANCENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : RAC instance name to be added</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : &lt;sid_prefix>+&lt;highest_current_thread+1></span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#INSTANCENAME = "orcl1"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : NODENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Node on which to add new instance</span>
<span class="token comment">#                 (in 10gR2, instance addition is supported on 1 node at a time)</span>
<span class="token comment"># Valid values  : Cluster node name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token assign-left variable">NODENAME</span><span class="token operator">=</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OBFUSCATEDPASSWORDS</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Set to true if passwords are encrypted</span>
<span class="token comment"># Valid values  : TRUE\FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OBFUSCATEDPASSWORDS = FALSE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : A user with DBA role.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SYSDBAUSERNAME <span class="token operator">=</span> <span class="token string">"sys"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the DBA user.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAPASSWORD = "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SERVICEUSERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for Windows Service user</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : If Oracle home is installed with windows service user</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SERVICEUSERPASSWORD = "password"</span>

<span class="token comment">#-----------------------*** End of ADDINSTANCE section ***------------------------</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># DELETEINSTANCE section is used when OPERATION_TYPE is defined as "deleteInstance".</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>DELETEINSTANCE<span class="token punctuation">]</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DB_UNIQUE_NAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DB Unique Name of the RAC database</span>
<span class="token comment"># Valid values  : &lt;db_unique_name></span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
DB_UNIQUE_NAME <span class="token operator">=</span> <span class="token string">"orcl11c.us.oracle.com"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : INSTANCENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : RAC instance name to be deleted</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
INSTANCENAME <span class="token operator">=</span> <span class="token string">"orcl11g"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : NODENAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Node on which instance to be deleted (SID) is located</span>
<span class="token comment"># Valid values  : Cluster node name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#NODENAME=</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OBFUSCATEDPASSWORDS</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Set to true if passwords are encrypted</span>
<span class="token comment"># Valid values  : TRUE\FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OBFUSCATEDPASSWORDS = FALSE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : A user with DBA role.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SYSDBAUSERNAME <span class="token operator">=</span> <span class="token string">"sys"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SYSDBAPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the DBA user.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#SYSDBAPASSWORD = "password"</span>


<span class="token comment">#-----------------------*** End of DELETEINSTANCE section ***------------------------</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># CREATEPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as "createPluggableDatabase".</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>CREATEPLUGGABLEDATABASE<span class="token punctuation">]</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database is the SID</span>
<span class="token comment">#          This database must be local and on the same ORACLE_HOME.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SOURCEDB <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The name of new pluggable database</span>
<span class="token comment">#          This pdb name must not be same as sourcedb name.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
PDBNAME <span class="token operator">=</span> <span class="token string">"PDB1"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CREATEASCLONE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : specify true or false for PDB to be create as Clone.</span>
<span class="token comment">#               : When "true" is passed a new PDB GUID is generated for the plugged in PDB</span>
<span class="token comment"># Default value : true</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># CREATEASCLONE = "TRUE"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CREATEPDBFROM</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : specify the source of pdb to be plugged</span>
<span class="token comment"># Valid values  : DEFAULT | FILEARCHIVE | RMANBACKUP | USINGXML</span>
<span class="token comment"># Default value : DEFAULT</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># CREATEPDBFROM = "DEFAULT"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBARCHIVEFILE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Full path and name for pdbArchive file</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Mandatory when creating new PDB using FILEARCHIVE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBARCHIVEFILE = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBBACKUPFILE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Full path and name for pdb back up file</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Mandatory when creating new PDB using RMANBACKUP</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBBACKUPFILE = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBMETADATAFILE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Full path and name for pdb metadata file</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Mandatory when creating new PDB using RMANBACKUP or USINGXML</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBMETADATAFILE = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBUSEMULTIPLEBACKUP</span>
<span class="token comment"># Datatype      : boolean</span>
<span class="token comment"># Description   : Flag that can used to create PDB from single or multiple backupsets</span>
<span class="token comment"># Default value : true</span>
<span class="token comment"># Mandatory     : Optional when creating new PDB using RMANBACKUP or USINGXML</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBUSEMULTIPLEBACKUP =</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBADMINUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : PDB Administrator user name</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Mandatory only when creating new DEFAULT PDB</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBADMINUSERNAME = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBADMINPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : PDB Administrator user password</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Mandatory only when creating new DEFAULT PDB</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBADMINPASSWORD = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CREATENEWPDBADMINUSER</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : When Plugging a pdb from FILEARCHIVE or RMANBACKUP</span>
<span class="token comment">#          a new PDB Administrator user can be created using this option</span>
<span class="token comment">#          This option should be given along with pdbadmin username and password</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># CREATENEWPDBADMINUSER = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEFILENAMECONVERT</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : This clause specifies how to locate files listed in an XML file</span>
<span class="token comment">#          describing a Pluggable Database if they reside in a location different</span>
<span class="token comment">#          from that specified in the XML file.</span>
<span class="token comment">#          This clause is valid when creating Pluggable database in USINGXML option</span>
<span class="token comment"># Valid values  : (&lt;filename_pattern>, &lt;replacement_filename_pattern>,....)</span>
<span class="token comment"># Default value : "NONE"</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># SOURCEFILENAMECONVERT = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : FILENAMECONVERT</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : This clause specifies how to generate names of files</span>
<span class="token comment">#          for the Pluggable Database being created using names of existing files</span>
<span class="token comment">#          This clause is valid when creating Pluggable database in USINGXML option</span>
<span class="token comment"># Valid values  : (&lt;filename_pattern>, &lt;replacement_filename_pattern>,....)</span>
<span class="token comment"># Default value : "NONE"</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># FILENAMECONVERT = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : COPYPDBFILES</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : If COPY is specified, it will indicate that datafiles need to be copied.</span>
<span class="token comment">#        : This option can be true only when FILENAMECONVERT is specified or</span>
<span class="token comment">#           CDB files are Oracle Managed Files(OMF)</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># COPYPDBFILES = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBDATAFILEDESTINATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : common location for PDB datafile area</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBDATAFILEDESTINATION = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : USEMETADATAFILELOCATION</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify true if datafile path defined in Meta datafile within PDB</span>
<span class="token comment">#          archive file is to be used to un-archive datafile.</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># USEMETADATAFILELOCATION = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : REGISTERWITHDIRSERVICE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether to register with Directory Service.</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#REGISTERWITHDIRSERVICE= TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the name of the directory service user</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEUSERNAME= "name"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the directory service user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : WALLETPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password for wallet to created or modified.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#WALLETPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : LBACSYSPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for LBACSYS user</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService are TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#LBACSYSPASSWORD= "password"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : CREATEUSERTABLESPACE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify true if a default user tablespace need to be created in new PDB</span>
<span class="token comment">#</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : TRUE</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># CREATEUSERTABLESPACE = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVCONFIGURATION</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify "True" to configure and enable Oracle Database vault</span>
<span class="token comment"># Valid values  : True/False</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVCONFIGURATION = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERPASSWORD = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for  DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERPASSWORD = ""</span>

<span class="token comment">#-----------------------*** End of createPluggableDatabase section ***------------------------</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># UNPLUGDATABASE section is used when OPERATION_TYPE is defined as "unplugDatabase".</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>UNPLUGDATABASE<span class="token punctuation">]</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database is the SID</span>
<span class="token comment">#          This database must be local and on the same ORACLE_HOME.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SOURCEDB <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The name of new pluggable database</span>
<span class="token comment">#          This pdb name must not be same as sourcedb name.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
PDBNAME <span class="token operator">=</span> <span class="token string">"PDB1"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : ARCHIVETYPE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The unplugged database datafile backup will in tar.gz or rman backup</span>
<span class="token comment">#          This pdb name must not be same as sourcedb name.</span>
<span class="token comment"># Valid values  : TAR | RMAN</span>
<span class="token comment"># Default value : TAR</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
ARCHIVETYPE <span class="token operator">=</span> <span class="token string">"TAR"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBARCHIVEFILE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Full path and name for pdbArchive file</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : NO</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBARCHIVEFILE = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBBACKUPFILE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Full path and name for pdb back up file</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBBACKUPFILE = ""</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBMETADATAFILE</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Full path and name for pdb metadata file</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># PDBMETADATAFILE = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : UNREGISTERWITHDIRSERVICE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether to unregister with Directory Service.</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#UNREGISTERWITHDIRSERVICE= TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the name of the directory service user</span>
<span class="token comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEUSERNAME= "name"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the directory service user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : WALLETPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password for wallet to created or modified.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of unregisterWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#WALLETPASSWORD= "password"</span>

<span class="token comment">#-----------------------*** End of unplugDatabase section ***------------------------</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># DELETEPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as "deletePluggableDatabase".</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>DELETEPLUGGABLEDATABASE<span class="token punctuation">]</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database is the SID</span>
<span class="token comment">#          This database must be local and on the same ORACLE_HOME.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SOURCEDB <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The name of new pluggable database</span>
<span class="token comment">#          This pdb name must not be same as sourcedb name.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
PDBNAME <span class="token operator">=</span> <span class="token string">"PDB1"</span>

<span class="token comment">#-----------------------*** End of deletePluggableDatabase section ***------------------------</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># CONFIGUREPLUGGABLEDATABASE section is used when OPERATION_TYPE is defined as "configurePluggableDatabase".</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>CONFIGUREPLUGGABLEDATABASE<span class="token punctuation">]</span>
<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : SOURCEDB</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The source database is the SID</span>
<span class="token comment">#          This database must be local and on the same ORACLE_HOME.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
SOURCEDB <span class="token operator">=</span> <span class="token string">"orcl"</span>

<span class="token comment">#----------------------------------------------------------------------------------</span>
<span class="token comment"># Name          : PDBNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The name of new pluggable database</span>
<span class="token comment">#          This pdb name must not be same as sourcedb name.</span>
<span class="token comment"># Default value : none</span>
<span class="token comment"># Mandatory     : YES</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
PDBNAME <span class="token operator">=</span> <span class="token string">"PDB1"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVCONFIGURATION</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify "True" to configure and enable Oracle Database vault</span>
<span class="token comment"># Valid values  : True/False</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVCONFIGURATION = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVOWNERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for DataVault Owner</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : Yes, if DataVault option is chosen</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVOWNERPASSWORD = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERNAME = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DVACCOUNTMANAGERPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for  DataVault Account Manager</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : None</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DVACCOUNTMANAGERPASSWORD = ""</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : OLSCONFIGURATION</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specify "True" to configure and enable Oracle Label Security</span>
<span class="token comment"># Valid values  : True/False</span>
<span class="token comment"># Default value : False</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#OLSCONFIGURATION = "false"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : REGISTERWITHDIRSERVICE</span>
<span class="token comment"># Datatype      : Boolean</span>
<span class="token comment"># Description   : Specifies whether to register with Directory Service.</span>
<span class="token comment"># Valid values  : TRUE \ FALSE</span>
<span class="token comment"># Default value : FALSE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#REGISTERWITHDIRSERVICE= TRUE</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEUSERNAME</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Specifies the name of the directory service user</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEUSERNAME= "name"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : DIRSERVICEPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password of the directory service user.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#DIRSERVICEPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : WALLETPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : The password for wallet to created or modified.</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of registerWithDirService is TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#WALLETPASSWORD= "password"</span>

<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : LBACSYSPASSWORD</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Password for LBACSYS user</span>
<span class="token comment">#          You can also specify the password at the command prompt instead of here.</span>
<span class="token comment"># Mandatory     : YES, if the value of olsConfiguration and registerWithDirService are TRUE</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#LBACSYSPASSWORD= "password"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMCONFIGURATION</span>
<span class="token comment"># Datatype      : String</span>
<span class="token comment"># Description   : Enterprise Manager Configuration Type</span>
<span class="token comment"># Valid values  : DBEXPRESS|NONE</span>
<span class="token comment"># Default value : NONE</span>
<span class="token comment"># Mandatory     : No</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMCONFIGURATION = "NONE"</span>


<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment"># Name          : EMEXPRESSPORT</span>
<span class="token comment"># Datatype      : Number</span>
<span class="token comment"># Description   : Enterprise Manager Configuration Type</span>
<span class="token comment"># Valid values  : Check Oracle12c Administrator's Guide</span>
<span class="token comment"># Default value : NONE</span>
<span class="token comment"># Mandatory     : No, will be picked up from DBEXPRESS_HTTPS_PORT env variable</span>
<span class="token comment">#                 or auto generates a free port between 5500 and 5599</span>
<span class="token comment">#-----------------------------------------------------------------------------</span>
<span class="token comment">#EMEXPRESSPORT = ""</span>

<span class="token comment">#-----------------------*** End of configurePluggableDatabase section ***------------------------</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>rsp</tag>
      </tags>
  </entry>
  <entry>
    <title>Deleting Oracle 19c RAC from Nodes on Linux</title>
    <url>/blog/posts/6a9e00b5.html</url>
    <content><![CDATA[<h1 id="Deleting-Oracle-19c-RAC-from-Nodes-on-Linux"><a href="#Deleting-Oracle-19c-RAC-from-Nodes-on-Linux" class="headerlink" title="Deleting Oracle 19c RAC from Nodes on Linux"></a>Deleting Oracle 19c RAC from Nodes on Linux</h1><h2 id="Deleting-Instances-from-Oracle-RAC-Databases"><a href="#Deleting-Instances-from-Oracle-RAC-Databases" class="headerlink" title="Deleting Instances from Oracle RAC Databases"></a>Deleting Instances from Oracle RAC Databases</h2><p>Use DBCA in silent mode to delete a database instance from a node, execute on the remaining nodes.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19crac01 ~<span class="token punctuation">]</span>$ dbca <span class="token parameter variable">-silent</span> <span class="token parameter variable">-deleteInstance</span> <span class="token parameter variable">-nodeList</span> oracle19crac03 <span class="token parameter variable">-gdbName</span> coco <span class="token parameter variable">-instanceName</span> coco3 <span class="token parameter variable">-sysDBAUserName</span> sys <span class="token parameter variable">-sysDBAPassword</span> oracle
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> <span class="token punctuation">[</span>DBT-19203<span class="token punctuation">]</span> The Database Configuration Assistant will delete the Oracle instance and its associated OFA directory structure. All information about this instance will be deleted.

Prepare <span class="token keyword">for</span> db operation
<span class="token number">40</span>% complete
Deleting instance
<span class="token number">48</span>% complete
<span class="token number">52</span>% complete
<span class="token number">56</span>% complete
<span class="token number">60</span>% complete
<span class="token number">64</span>% complete
<span class="token number">68</span>% complete
<span class="token number">72</span>% complete
<span class="token number">76</span>% complete
<span class="token number">80</span>% complete
Completing instance management.
<span class="token number">100</span>% complete
Instance <span class="token string">"coco3"</span> deleted successfully from <span class="token function">node</span> <span class="token string">"oracle19crac03"</span><span class="token builtin class-name">.</span>
Look at the log <span class="token function">file</span> <span class="token string">"/u01/app/oracle/cfgtoollogs/dbca/coco/coco.log"</span> <span class="token keyword">for</span> further details.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Removing-Oracle-RAC"><a href="#Removing-Oracle-RAC" class="headerlink" title="Removing Oracle RAC"></a>Removing Oracle RAC</h2><p>If there is a listener in the Oracle RAC home on the node you are deleting, then you must disable and stop it before deleting the Oracle RAC software. </p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>grid<span class="token operator">@</span>oracle19crac01 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> srvctl disable listener <span class="token operator">-</span>l LISTENER <span class="token operator">-</span>n oracle19crac03
<span class="token punctuation">[</span>grid<span class="token operator">@</span>oracle19crac01 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> srvctl stop listener <span class="token operator">-</span>l LISTENER <span class="token operator">-</span>n oracle19crac03

<span class="token punctuation">[</span>grid<span class="token operator">@</span>oracle19crac01 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> crsctl stat res ora<span class="token punctuation">.</span>LISTENER<span class="token punctuation">.</span>lsnr <span class="token operator">-</span>t
<span class="token separator comment">--------------------------------------------------------------------------------</span>
Name           Target  State        Server                   State details
<span class="token separator comment">--------------------------------------------------------------------------------</span>
Local Resources
<span class="token separator comment">--------------------------------------------------------------------------------</span>
ora<span class="token punctuation">.</span>LISTENER<span class="token punctuation">.</span>lsnr
               ONLINE  ONLINE       oracle19crac01           STABLE
               ONLINE  ONLINE       oracle19crac02           STABLE
               OFFLINE OFFLINE      oracle19crac03           STABLE
<span class="token separator comment">--------------------------------------------------------------------------------</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Deinstall the Oracle home — only if the Oracle home is not shared.</p>
<p>Oracle Software:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19crac03 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">CV_ASSUME_DISTID</span><span class="token operator">=</span>OL7
<span class="token punctuation">[</span>oracle@oracle19crac03 ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/deinstall/deinstall <span class="token parameter variable">-local</span>
Checking <span class="token keyword">for</span> required files and bootstrapping <span class="token punctuation">..</span>.
Please <span class="token function">wait</span> <span class="token punctuation">..</span>.
Location of logs /u01/app/oraInventory/logs/

<span class="token comment">############ ORACLE DECONFIG TOOL START ############</span>


<span class="token comment">######################### DECONFIG CHECK OPERATION START #########################</span>
<span class="token comment">## [START] Install check configuration ##</span>


Checking <span class="token keyword">for</span> existence of the Oracle home location /u01/app/oracle/product/19.0.0/dbhome_1
Oracle Home <span class="token builtin class-name">type</span> selected <span class="token keyword">for</span> deinstall is: Oracle Real Application Cluster Database
Oracle Base selected <span class="token keyword">for</span> deinstall is: /u01/app/oracle
Checking <span class="token keyword">for</span> existence of central inventory location /u01/app/oraInventory
Checking <span class="token keyword">for</span> existence of the Oracle Grid Infrastructure home /u01/app/19.0.0/grid
The following nodes are part of this cluster: oracle19crac03,oracle19crac02,oracle19crac01
Checking <span class="token keyword">for</span> sufficient temp space availability on node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token builtin class-name">:</span> <span class="token string">'oracle19crac03'</span>

<span class="token comment">## [END] Install check configuration ##</span>


Network Configuration check config START

Network de-configuration trace <span class="token function">file</span> location: /u01/app/oraInventory/logs/netdc_check2023-06-04_02-43-15PM.log

Network Configuration check config END

Database Check Configuration START

Database de-configuration trace <span class="token function">file</span> location: /u01/app/oraInventory/logs/databasedc_check2023-06-04_02-43-15PM.log

Use comma as separator when specifying list of values as input

Specify the list of database names that are configured locally on this <span class="token function">node</span> <span class="token keyword">for</span> this Oracle home. Local configurations of the discovered databases will be removed <span class="token punctuation">[</span><span class="token punctuation">]</span>:
Database Check Configuration END

<span class="token comment">######################### DECONFIG CHECK OPERATION END #########################</span>


<span class="token comment">####################### DECONFIG CHECK OPERATION SUMMARY #######################</span>
Oracle Grid Infrastructure Home is: /u01/app/19.0.0/grid
The following nodes are part of this cluster: oracle19crac03,oracle19crac02,oracle19crac01
The cluster node<span class="token punctuation">(</span>s<span class="token punctuation">)</span> on <span class="token function">which</span> the Oracle home deinstallation will be performed are:oracle19crac03
Oracle Home selected <span class="token keyword">for</span> deinstall is: /u01/app/oracle/product/19.0.0/dbhome_1
Inventory Location where the Oracle home registered is: /u01/app/oraInventory
Do you want to <span class="token builtin class-name">continue</span> <span class="token punctuation">(</span>y - yes, n - no<span class="token punctuation">)</span>? <span class="token punctuation">[</span>n<span class="token punctuation">]</span>: y
A log of this session will be written to: <span class="token string">'/u01/app/oraInventory/logs/deinstall_deconfig2023-06-04_02-43-02-PM.out'</span>
Any error messages from this session will be written to: <span class="token string">'/u01/app/oraInventory/logs/deinstall_deconfig2023-06-04_02-43-02-PM.err'</span>

<span class="token comment">######################## DECONFIG CLEAN OPERATION START ########################</span>
Database de-configuration trace <span class="token function">file</span> location: /u01/app/oraInventory/logs/databasedc_clean2023-06-04_02-43-15PM.log

Network Configuration clean config START

Network de-configuration trace <span class="token function">file</span> location: /u01/app/oraInventory/logs/netdc_clean2023-06-04_02-43-15PM.log

Network Configuration clean config END


<span class="token comment">######################### DECONFIG CLEAN OPERATION END #########################</span>


<span class="token comment">####################### DECONFIG CLEAN OPERATION SUMMARY #######################</span>
<span class="token comment">#######################################################################</span>


<span class="token comment">############# ORACLE DECONFIG TOOL END #############</span>

Using properties <span class="token function">file</span> /tmp/deinstall2023-06-04_02-42-05PM/response/deinstall_2023-06-04_02-43-02-PM.rsp
Location of logs /u01/app/oraInventory/logs/

<span class="token comment">############ ORACLE DEINSTALL TOOL START ############</span>


<span class="token comment">####################### DEINSTALL CHECK OPERATION SUMMARY #######################</span>
A log of this session will be written to: <span class="token string">'/u01/app/oraInventory/logs/deinstall_deconfig2023-06-04_02-43-02-PM.out'</span>
Any error messages from this session will be written to: <span class="token string">'/u01/app/oraInventory/logs/deinstall_deconfig2023-06-04_02-43-02-PM.err'</span>

<span class="token comment">######################## DEINSTALL CLEAN OPERATION START ########################</span>
<span class="token comment">## [START] Preparing for Deinstall ##</span>
Setting LOCAL_NODE to oracle19crac03
Setting CLUSTER_NODES to oracle19crac03
Setting CRS_HOME to <span class="token boolean">false</span>
Setting oracle.installer.invPtrLoc to /tmp/deinstall2023-06-04_02-42-05PM/oraInst.loc
Setting oracle.installer.local to <span class="token boolean">true</span>

<span class="token comment">## [END] Preparing for Deinstall ##</span>

Setting the force flag to <span class="token boolean">false</span>
Setting the force flag to cleanup the Oracle Base
Oracle Universal Installer clean START

Detach Oracle home <span class="token string">'/u01/app/oracle/product/19.0.0/dbhome_1'</span> from the central inventory on the <span class="token builtin class-name">local</span> <span class="token function">node</span> <span class="token builtin class-name">:</span> Done

Delete directory <span class="token string">'/u01/app/oracle/product/19.0.0/dbhome_1'</span> on the <span class="token builtin class-name">local</span> <span class="token function">node</span> <span class="token builtin class-name">:</span> Done

The Oracle Base directory <span class="token string">'/u01/app/oracle'</span> will not be removed on <span class="token builtin class-name">local</span> node. The directory is not empty. User needs to manually cleanup this directory.

Oracle Universal Installer cleanup was successful.

Oracle Universal Installer clean END


<span class="token comment">## [START] Oracle install clean ##</span>


<span class="token comment">## [END] Oracle install clean ##</span>


<span class="token comment">######################### DEINSTALL CLEAN OPERATION END #########################</span>


<span class="token comment">####################### DEINSTALL CLEAN OPERATION SUMMARY #######################</span>
Successfully detached Oracle home <span class="token string">'/u01/app/oracle/product/19.0.0/dbhome_1'</span> from the central inventory on the <span class="token builtin class-name">local</span> node.
Successfully deleted directory <span class="token string">'/u01/app/oracle/product/19.0.0/dbhome_1'</span> on the <span class="token builtin class-name">local</span> node.
Oracle Universal Installer cleanup was successful.

Review the permissions and contents of <span class="token string">'/u01/app/oracle'</span> on nodes<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token string">'oracle19crac03'</span><span class="token builtin class-name">.</span>
If there are no Oracle home<span class="token punctuation">(</span>s<span class="token punctuation">)</span> associated with <span class="token string">'/u01/app/oracle'</span>, manually delete <span class="token string">'/u01/app/oracle'</span> and its contents.
Oracle deinstall tool successfully cleaned up temporary directories.
<span class="token comment">#######################################################################</span>


<span class="token comment">############# ORACLE DEINSTALL TOOL END #############</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Grid Infrastructure:</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>grid<span class="token operator">@</span>oracle19crac03 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> export CV_ASSUME_DISTID<span class="token operator">=</span>OL7
<span class="token punctuation">[</span>grid<span class="token operator">@</span>oracle19crac03 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">$</span> <span class="token operator">$</span>ORACLE_HOME<span class="token operator">/</span>deinstall<span class="token operator">/</span>deinstall <span class="token operator">-</span>local
Checking for required files and bootstrapping <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Please wait <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Location of logs <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/</span>

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> ORACLE DECONFIG TOOL START <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DECONFIG CHECK OPERATION START <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token punctuation">[</span>START<span class="token punctuation">]</span> Install check configuration <span class="token operator">#</span><span class="token operator">#</span>


Checking for existence of the Oracle home location <span class="token file-path string">/u01/app/19.0.0/grid</span>
<span class="token property">Oracle Home type selected for deinstall is:</span> Oracle Grid Infrastructure for a Cluster
<span class="token property">Oracle Base selected for deinstall is:</span> <span class="token file-path string">/u01/app/grid</span>
Checking for existence of central inventory location <span class="token file-path string">/u01/app/oraInventory</span>
Checking for existence of the Oracle Grid Infrastructure home <span class="token file-path string">/u01/app/19.0.0/grid</span>
<span class="token property">The following nodes are part of this cluster:</span> oracle19crac03<span class="token punctuation">,</span>oracle19crac02<span class="token punctuation">,</span>oracle19crac01
Checking for sufficient temp space availability on node<span class="token operator">(</span>s<span class="token operator">)</span> <span class="token operator">:</span> <span class="token string">'oracle19crac03'</span>

<span class="token operator">#</span><span class="token operator">#</span> <span class="token punctuation">[</span>END<span class="token punctuation">]</span> Install check configuration <span class="token operator">#</span><span class="token operator">#</span>

<span class="token property">Traces log file:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs//crsdc_2023-06-04_02-46-48-PM.log</span>

Network Configuration check config START

<span class="token property">Network de-configuration trace file location:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/netdc_check2023-06-04_02-46-52PM.log</span>

Network Configuration check config END

Asm Check Configuration START

<span class="token property">ASM de-configuration trace file location:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/asmcadc_check2023-06-04_02-46-52PM.log</span>

Database Check Configuration START

<span class="token property">Database de-configuration trace file location:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/databasedc_check2023-06-04_02-46-52PM.log</span>

Oracle Grid Management database was found in this Grid Infrastructure home

Database Check Configuration END

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DECONFIG CHECK OPERATION END <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DECONFIG CHECK OPERATION SUMMARY <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token property">Oracle Grid Infrastructure Home is:</span> <span class="token file-path string">/u01/app/19.0.0/grid</span>
<span class="token property">The following nodes are part of this cluster:</span> oracle19crac03<span class="token punctuation">,</span>oracle19crac02<span class="token punctuation">,</span>oracle19crac01
The cluster node<span class="token operator">(</span>s<span class="token operator">)</span> on which the Oracle home deinstallation will be performed are<span class="token operator">:</span>oracle19crac03
<span class="token property">Oracle Home selected for deinstall is:</span> <span class="token file-path string">/u01/app/19.0.0/grid</span>
<span class="token property">Inventory Location where the Oracle home registered is:</span> <span class="token file-path string">/u01/app/oraInventory</span>
Option <span class="token operator">-</span>local will not modify any ASM configuration<span class="token punctuation">.</span>
Oracle Grid Management database was found in this Grid Infrastructure home
Oracle Grid Management database will be relocated to another node during deconfiguration of local node
Do you want to continue <span class="token operator">(</span>y <span class="token operator">-</span> yes<span class="token punctuation">,</span> n <span class="token operator">-</span> no<span class="token operator">)</span><span class="token operator">?</span> <span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">:</span> y
<span class="token property">A log of this session will be written to:</span> <span class="token string">'/tmp/deinstall2023-06-04_02-45-48PM/logs/deinstall_deconfig2023-06-04_02-46-43-PM.out'</span>
<span class="token property">Any error messages from this session will be written to:</span> <span class="token string">'/tmp/deinstall2023-06-04_02-45-48PM/logs/deinstall_deconfig2023-06-04_02-46-43-PM.err'</span>

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DECONFIG CLEAN OPERATION START <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token property">Database de-configuration trace file location:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/databasedc_clean2023-06-04_02-46-52PM.log</span>
<span class="token property">ASM de-configuration trace file location:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/asmcadc_clean2023-06-04_02-46-52PM.log</span>
ASM Clean Configuration END

Network Configuration clean config START

<span class="token property">Network de-configuration trace file location:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/netdc_clean2023-06-04_02-46-52PM.log</span>

Network Configuration clean config END


Run the following command as the root user or the administrator on node <span class="token string">"oracle19crac03"</span><span class="token punctuation">.</span>

<span class="token file-path string">/u01/app/19.0.0/grid/crs/install/rootcrs.sh</span> <span class="token operator">-</span>force  <span class="token operator">-</span>deconfig <span class="token operator">-</span>paramfile <span class="token string">"/tmp/deinstall2023-06-04_02-45-48PM/response/deinstall_OraGI19Home1.rsp"</span>

Press Enter after you finish running the above commands

<span class="token operator">&lt;</span><span class="token separator comment">----------------------------------------</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DECONFIG CLEAN OPERATION END <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DECONFIG CLEAN OPERATION SUMMARY <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
Local node configuration of Oracle Grid Management database was removed successfully
Oracle Clusterware is stopped and successfully de<span class="token operator">-</span>configured on node <span class="token string">"oracle19crac03"</span>
Oracle Clusterware is stopped and de<span class="token operator">-</span>configured successfully<span class="token punctuation">.</span>
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> ORACLE DECONFIG TOOL END <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>

Using properties file <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/response/deinstall_2023-06-04_02-46-43-PM.rsp</span>
Location of logs <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/</span>

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> ORACLE DEINSTALL TOOL START <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>





<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DEINSTALL CHECK OPERATION SUMMARY <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token property">A log of this session will be written to:</span> <span class="token string">'/tmp/deinstall2023-06-04_02-45-48PM/logs/deinstall_deconfig2023-06-04_02-46-43-PM.out'</span>
<span class="token property">Any error messages from this session will be written to:</span> <span class="token string">'/tmp/deinstall2023-06-04_02-45-48PM/logs/deinstall_deconfig2023-06-04_02-46-43-PM.err'</span>

<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DEINSTALL CLEAN OPERATION START <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
<span class="token operator">#</span><span class="token operator">#</span> <span class="token punctuation">[</span>START<span class="token punctuation">]</span> Preparing for Deinstall <span class="token operator">#</span><span class="token operator">#</span>
Setting LOCAL_NODE to oracle19crac03
Setting CLUSTER_NODES to oracle19crac03
Setting CRS_HOME to <span class="token boolean">true</span>
Setting oracle<span class="token punctuation">.</span>installer<span class="token punctuation">.</span>invPtrLoc to <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/oraInst.loc</span>
Setting <span class="token domain constant">oracle.installer.local</span> to <span class="token boolean">true</span>

<span class="token operator">#</span><span class="token operator">#</span> <span class="token punctuation">[</span>END<span class="token punctuation">]</span> Preparing for Deinstall <span class="token operator">#</span><span class="token operator">#</span>

Setting the force flag to <span class="token boolean">false</span>
Setting the force flag to cleanup the Oracle Base
Oracle Universal Installer clean START

Detach Oracle home <span class="token string">'/u01/app/19.0.0/grid'</span> from the central inventory on the local node <span class="token operator">:</span> Done

Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/jet/v6.0.0'</span><span class="token punctuation">.</span> Either user has no permission to delete or it is in use<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/jet'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/css/images'</span><span class="token punctuation">.</span> Either user has no permission to delete or it is in use<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/css/rat'</span><span class="token punctuation">.</span> Either user has no permission to delete or it is in use<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/css/codeMirror'</span><span class="token punctuation">.</span> Either user has no permission to delete or it is in use<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/css/fonts'</span><span class="token punctuation">.</span> Either user has no permission to delete or it is in use<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/css/site'</span><span class="token punctuation">.</span> Either user has no permission to delete or it is in use<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa/css'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps/tfa'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat/webapps'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home/tomcat'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03/tfa_home'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa/oracle19crac03'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid/tfa'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Failed to delete the directory <span class="token string">'/u01/app/19.0.0/grid'</span><span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span>
Delete directory <span class="token string">'/u01/app/19.0.0/grid'</span> on the local node <span class="token operator">:</span> Failed <span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span>

Delete directory <span class="token string">'/u01/app/oraInventory'</span> on the local node <span class="token operator">:</span> Done

The Oracle Base directory <span class="token string">'/u01/app/grid'</span> will not be removed on local node<span class="token punctuation">.</span> The directory is not empty<span class="token punctuation">.</span> User needs to manually cleanup this directory<span class="token punctuation">.</span>

Oracle Universal Installer cleanup was successful<span class="token punctuation">.</span>

Oracle Universal Installer clean END


<span class="token operator">#</span><span class="token operator">#</span> <span class="token punctuation">[</span>START<span class="token punctuation">]</span> Oracle install clean <span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span> <span class="token punctuation">[</span>END<span class="token punctuation">]</span> Oracle install clean <span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DEINSTALL CLEAN OPERATION END <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> DEINSTALL CLEAN OPERATION SUMMARY <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>
Successfully detached Oracle home <span class="token string">'/u01/app/19.0.0/grid'</span> from the central inventory on the local node<span class="token punctuation">.</span>
Failed to delete directory <span class="token string">'/u01/app/19.0.0/grid'</span> on the local node due to error <span class="token operator">:</span> Either user has no permission to delete or file is in use<span class="token punctuation">.</span>
Review the permissions and manually delete <span class="token string">'/u01/app/19.0.0/grid'</span> on local node<span class="token punctuation">.</span>
Successfully deleted directory <span class="token string">'/u01/app/oraInventory'</span> on the local node<span class="token punctuation">.</span>
Oracle Universal Installer cleanup was successful<span class="token punctuation">.</span>


Run <span class="token string">'rm -r /etc/oraInst.loc'</span> as root on node<span class="token operator">(</span>s<span class="token operator">)</span> <span class="token string">'oracle19crac03'</span> at the end of the session<span class="token punctuation">.</span>

Run <span class="token string">'rm -r /opt/ORCLfmap'</span> as root on node<span class="token operator">(</span>s<span class="token operator">)</span> <span class="token string">'oracle19crac03'</span> at the end of the session<span class="token punctuation">.</span>
Review the permissions and contents of <span class="token string">'/u01/app/grid'</span> on nodes<span class="token operator">(</span>s<span class="token operator">)</span> <span class="token string">'oracle19crac03'</span><span class="token punctuation">.</span>
If there are no Oracle home<span class="token operator">(</span>s<span class="token operator">)</span> associated with <span class="token string">'/u01/app/grid'</span><span class="token punctuation">,</span> manually delete <span class="token string">'/u01/app/grid'</span> and its contents<span class="token punctuation">.</span>
Oracle deinstall tool successfully cleaned up temporary directories<span class="token punctuation">.</span>
<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span>


<span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span> ORACLE DEINSTALL TOOL END <span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span class="token operator">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Deleting-Nodes-from-the-Cluster"><a href="#Deleting-Nodes-from-the-Cluster" class="headerlink" title="Deleting Nodes from the Cluster"></a>Deleting Nodes from the Cluster</h2><p>During remove RAC software, running the prompted command de-configure the local node from cluster.</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>root<span class="token operator">@</span>oracle19crac03 <span class="token operator">~</span><span class="token punctuation">]</span><span class="token operator">#</span> <span class="token file-path string">/u01/app/19.0.0/grid/crs/install/rootcrs.sh</span> <span class="token operator">-</span>force  <span class="token operator">-</span>deconfig <span class="token operator">-</span>paramfile <span class="token string">"/tmp/deinstall2023-06-04_02-45-48PM/response/deinstall_OraGI19Home1.rsp"</span>
<span class="token property">Using configuration parameter file:</span> <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/response/deinstall_OraGI19Home1.rsp</span>
<span class="token property">The log of current session can be found at:</span>
  <span class="token file-path string">/tmp/deinstall2023-06-04_02-45-48PM/logs/crsdeconfig_oracle19crac03_2023-06-04_02-49-24PM.log</span>
Redirecting to <span class="token file-path string">/bin/systemctl</span> restart <span class="token domain constant">rsyslog.service</span>
<span class="token date number">2023/06/04</span> <span class="token time number">14:52:14</span> CLSRSC<span class="token operator">-</span><span class="token number">4006</span><span class="token operator">:</span> Removing Oracle Trace File Analyzer <span class="token operator">(</span>TFA<span class="token operator">)</span> Collector<span class="token punctuation">.</span>
<span class="token date number">2023/06/04</span> <span class="token time number">14:52:14</span> CLSRSC<span class="token operator">-</span><span class="token number">4007</span><span class="token operator">:</span> Successfully removed Oracle Trace File Analyzer <span class="token operator">(</span>TFA<span class="token operator">)</span> Collector<span class="token punctuation">.</span>
<span class="token date number">2023/06/04</span> <span class="token time number">14:52:39</span> CLSRSC<span class="token operator">-</span><span class="token number">336</span><span class="token operator">:</span> Successfully deconfigured Oracle Clusterware stack on this node<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>delete</tag>
      </tags>
  </entry>
  <entry>
    <title>Deinstall for RAC</title>
    <url>/blog/posts/b50a3062.html</url>
    <content><![CDATA[<h1 id="Deinstall-for-rac-11g-and-latest"><a href="#Deinstall-for-rac-11g-and-latest" class="headerlink" title="Deinstall for rac 11g and latest"></a>Deinstall for rac 11g and latest</h1><p>执行如下操作 (所有的目录以实际为准)：<br> 关闭数据库，如果数据库关闭不了强行杀进程，关闭监听。<br>清除 GRID 家目录(视版本而定)：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/grid/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/11.2.0/grid/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/oraInventory/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/oracle/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>清除相关文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /tmp/.oracle
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/tmp/.oracle
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/init/oracle-ohasd.conf
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/init.d/ohasd
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/init.d/init.ohasd
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/oraInst.loc
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/oratab
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>清除 ASM 磁盘信息(根据真实情况而定)：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/sdb <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">8192</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">128000</span>
<span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/sdc <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">8192</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">128000</span>
<span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/sdd <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">8192</span> <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">128000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h1 id="Deinstall-for-rac-10g"><a href="#Deinstall-for-rac-10g" class="headerlink" title="Deinstall for rac 10g"></a>Deinstall for rac 10g</h1><p>删除 Oracle database db sofetware:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/oracle/product/10.2.0/db_1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>删除 Oracle database clustware sofetware:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/oracle/product/10.2.0/crs_1
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/oracle/oraInventory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>清除相关文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/rc5.d/S96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/init.d/init.crs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/rc4.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/rc6.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/rc1.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/rc0.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/rc2.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/rc.d/rc3.d/S96init.crs

<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/oracle/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/oraInst.loc
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/oratab

<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/local/bin/coraenv
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/local/bin/dbhome
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /usr/local/bin/oraenv

<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/init.d/init.cssd
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/init.d/init.crs
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/init.d/init.crsd
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/init.d/init.evmd

<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/rc2.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/rc2.d/S96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/rc3.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/rc3.d/S96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/rc5.d/K96init.crs
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/rc5.d/S96init.crs

<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/inittab.crs

<span class="token comment"># restore inittab</span>
<span class="token function">mv</span> /etc/inittab /etc/inittab_bak
<span class="token function">cp</span> /etc/inittab.orig /etc/inittab<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>清理裸设备：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/raw/raw1 <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">300</span>
<span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/raw/raw2 <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">300</span>
<span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/raw/raw3 <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">300</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>deinstall</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle-database-preinstall-11g-rpm</title>
    <url>/blog/posts/fba8cafc.html</url>
    <content><![CDATA[<h1 id="Oracle-database-preinstall-11g-rpm"><a href="#Oracle-database-preinstall-11g-rpm" class="headerlink" title="Oracle-database-preinstall-11g-rpm"></a>Oracle-database-preinstall-11g-rpm</h1><h2 id="Installing-the-Oracle-Preinstallation-RPM"><a href="#Installing-the-Oracle-Preinstallation-RPM" class="headerlink" title="Installing the Oracle Preinstallation RPM"></a>Installing the Oracle Preinstallation RPM</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac-1 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install oracle-rdbms-server-11gR2-preinstall.x86_64</span>
<span class="token punctuation">[</span>root@rac-1 ~<span class="token punctuation">]</span><span class="token comment"># cat /var/log/oracle-rdbms-server-11gR2-preinstall/results/orakernel.log</span>
Adding group oinstall with gid <span class="token number">54321</span>
Adding group dba
Adding user oracle with user <span class="token function">id</span> <span class="token number">54321</span>, initial login group oinstall, supplementary group dba and  home directory /home/oracle
Changing ownership of /home/oracle to oracle:oinstall
Please <span class="token builtin class-name">set</span> password <span class="token keyword">for</span> oracle user
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">54321</span><span class="token punctuation">(</span>oracle<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">54321</span><span class="token punctuation">(</span>oinstall<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">54321</span><span class="token punctuation">(</span>oinstall<span class="token punctuation">)</span>,54322<span class="token punctuation">(</span>dba<span class="token punctuation">)</span>
Creating oracle user passed

Saving a copy of the initial sysctl.conf
Verifying  kernel parameters as per Oracle recommendations<span class="token punctuation">..</span>.
Adding fs.file-max <span class="token operator">=</span> <span class="token number">6815744</span>
Adding kernel.sem <span class="token operator">=</span> <span class="token number">250</span> <span class="token number">32000</span> <span class="token number">100</span> <span class="token number">128</span>
Adding kernel.shmmni <span class="token operator">=</span> <span class="token number">4096</span>
Adding kernel.shmall <span class="token operator">=</span> <span class="token number">1073741824</span>
Adding kernel.shmmax <span class="token operator">=</span> <span class="token number">4398046511104</span>
Adding kernel.panic_on_oops <span class="token operator">=</span> <span class="token number">1</span>
Adding net.core.rmem_default <span class="token operator">=</span> <span class="token number">262144</span>
Adding net.core.rmem_max <span class="token operator">=</span> <span class="token number">4194304</span>
Adding net.core.wmem_default <span class="token operator">=</span> <span class="token number">262144</span>
Adding net.core.wmem_max <span class="token operator">=</span> <span class="token number">1048576</span>
Adding net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">2</span>
Adding net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">2</span>
Adding fs.aio-max-nr <span class="token operator">=</span> <span class="token number">1048576</span>
Adding net.ipv4.ip_local_port_range <span class="token operator">=</span> <span class="token number">9000</span> <span class="token number">65500</span>
Setting kernel parameters as per oracle recommendations<span class="token punctuation">..</span>.
Altered <span class="token function">file</span> /etc/sysctl.conf
Saved a copy of the current <span class="token function">file</span> <span class="token keyword">in</span> /etc/sysctl.d/99-oracle-rdbms-server-11gR2-preinstall-sysctl.conf
Check /etc/sysctl.d <span class="token keyword">for</span> backups
Verifying <span class="token operator">&amp;</span> setting of kernel parameters passed

Setting user limits using /etc/security/limits.conf

Verifying oracle user OS limits as per Oracle recommendations<span class="token punctuation">..</span>.
Adding oracle soft nofile  <span class="token number">1024</span>
Adding oracle hard nofile  <span class="token number">65536</span>
Adding oracle soft nproc  <span class="token number">16384</span>
Adding oracle hard nproc  <span class="token number">16384</span>
Adding oracle soft stack  <span class="token number">10240</span>
Adding oracle hard stack  <span class="token number">32768</span>
Adding oracle hard memlock  <span class="token number">134217728</span>
Adding oracle soft memlock  <span class="token number">134217728</span>
Setting oracle user OS limits as per Oracle recommendations<span class="token punctuation">..</span>.
Altered <span class="token function">file</span> /etc/security/limits.conf
Original <span class="token function">file</span> backed up at /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00
Verifying <span class="token operator">&amp;</span> setting of user limits passed

Saving a copy of /etc/default/grub <span class="token function">file</span> <span class="token keyword">in</span> /etc/default/grub-initial.orabackup
Saving a copy of /etc/default/grub <span class="token keyword">in</span> /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00<span class="token punctuation">..</span>.
Verifying kernel boot parameters as per Oracle recommendations<span class="token punctuation">..</span>.
old boot params: <span class="token string">"rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet"</span>
new boot params: <span class="token string">"rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off"</span>

old boot params: <span class="token string">"rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off"</span>
new boot params: <span class="token string">"rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never"</span>

Setting kernel boot parameters as per Oracle recommendations<span class="token punctuation">..</span>.
<span class="token assign-left variable">G_DIR</span><span class="token operator">=</span>/boot/grub2
Default kernel is -<span class="token operator">></span>  <span class="token number">5.4</span>.17-2011.6.2.el7uek.x86_64
Default saved_entry is -<span class="token operator">></span> Oracle Linux Server <span class="token punctuation">(</span><span class="token number">5.4</span>.17-2011.6.2.el7uek.x86_64 with Unbreakable Enterprise Kernel<span class="token punctuation">)</span> <span class="token number">7.9</span>
Default saved_entry_line is -<span class="token operator">></span>  linux16 /vmlinuz-5.4.17-2011.6.2.el7uek.x86_64
Saving a copy of grubenv<span class="token punctuation">..</span>. <span class="token keyword">in</span> /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00
Generating grub configuration <span class="token function">file</span> <span class="token punctuation">..</span>.
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">15821</span>: /usr/sbin/grub2-probe
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">15821</span>: /usr/sbin/grub2-probe
Found linux image: /boot/vmlinuz-5.4.17-2011.6.2.el7uek.x86_64
Found initrd image: /boot/initramfs-5.4.17-2011.6.2.el7uek.x86_64.img
Found linux image: /boot/vmlinuz-3.10.0-1160.el7.x86_64
Found initrd image: /boot/initramfs-3.10.0-1160.el7.x86_64.img
Found linux image: /boot/vmlinuz-0-rescue-1d1dab430dc147b6bd12cb0ed4a8e0cb
Found initrd image: /boot/initramfs-0-rescue-1d1dab430dc147b6bd12cb0ed4a8e0cb.img
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">16117</span>: /usr/sbin/grub2-probe
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">16117</span>: /usr/sbin/grub2-probe
<span class="token keyword">done</span>
The saved kernel <span class="token number">5.4</span>.17-2011.6.2.el7uek.x86_64 is now at position - <span class="token number">0</span>
Boot parameters will be effected on next <span class="token function">reboot</span>
Altered <span class="token function">file</span> /etc/default/grub
Copy of the changed <span class="token function">file</span> is <span class="token keyword">in</span> - /etc/default/grub-oracle-rdbms-server-11gR2-preinstall.orabackup
Copy of the original <span class="token function">file</span> is <span class="token keyword">in</span> - /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00
Verifying <span class="token operator">&amp;</span> setting of boot parameters passed

Trying to <span class="token function">add</span> NOZEROCONF parameter<span class="token punctuation">..</span>.
Taking a backup of existing <span class="token function">file</span> to /etc/sysconfig/network.orabackup
Successfully added parameter NOZEROCONF to /etc/sysconfig/network
Setting /etc/sysconfig/network parameters passed

Disabling Transparent Hugepages.
Refer Oracle Note:1557478.1

Disabling defrag.
Refer Oracle Note:1557478.1

Taking a backup of old config files under /var/log/oracle-rdbms-server-11gR2-preinstall/backup/Apr-29-2022-20-33-00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Creating-Owner-User"><a href="#Creating-Owner-User" class="headerlink" title="Creating Owner User"></a>Creating Owner User</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1000</span> oinstall
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1200</span> asmadmin
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1201</span> asmdba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1202</span> asmoper
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1300</span> dba
<span class="token function">groupadd</span> <span class="token parameter variable">-g</span> <span class="token number">1301</span> oper
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">1100</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> asmadmin,asmdba,asmoper grid
<span class="token function">useradd</span> <span class="token parameter variable">-u</span> <span class="token number">1101</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba,oper,asmdba oracle
<span class="token builtin class-name">echo</span> <span class="token string">"oracle"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> oracle 
<span class="token builtin class-name">echo</span> <span class="token string">"grid"</span> <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> grid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Creating-the-Oracle-Home-and-Oracle-Base-Directory"><a href="#Creating-the-Oracle-Home-and-Oracle-Base-Directory" class="headerlink" title="Creating the Oracle Home and Oracle Base Directory"></a>Creating the Oracle Home and Oracle Base Directory</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/11.2.0/grid
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/grid
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oraInventory
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/11.2.0/db_1
<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /u01
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01/app/oracle
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /u01/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Owner-User-Environments"><a href="#Configuring-Owner-User-Environments" class="headerlink" title="Configuring Owner User Environments"></a>Configuring Owner User Environments</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span>/home/oracle/.bash_profile <span class="token operator">&lt;&lt;</span><span class="token string">"EOF"
export ORACLE_SID=coco1
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
alias sqlplus='rlwrap sqlplus'
alias rman='rlwrap rman'
EOF</span>
<span class="token function">su</span> - oracle <span class="token parameter variable">-c</span> <span class="token string">'source ~/.bash_profile'</span>

<span class="token function">cat</span> <span class="token operator">>></span>/home/grid/.bash_profile <span class="token operator">&lt;&lt;</span><span class="token string">"EOF"
export ORACLE_SID=+ASM1
export ORACLE_BASE=/u01/app/grid
export ORACLE_HOME=/u01/app/11.2.0/grid
export PATH=$ORACLE_HOME/bin:$PATH
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib
alias sqlplus='rlwrap sqlplus'
EOF</span>
<span class="token function">su</span> - grid <span class="token parameter variable">-c</span> <span class="token string">'source ~/.bash_profile'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Checking-Resource-Limits"><a href="#Checking-Resource-Limits" class="headerlink" title="Checking Resource Limits"></a>Checking Resource Limits</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac-1 ~<span class="token punctuation">]</span><span class="token comment"># grep ^oracle /etc/security/limits.conf | sed 's/oracle/grid/' >> /etc/security/limits.conf</span>
<span class="token punctuation">[</span>root@rac-1 ~<span class="token punctuation">]</span><span class="token comment"># grep -E '^oracle|^grid' /etc/security/limits.conf</span>
oracle   soft   nofile    <span class="token number">1024</span>
oracle   hard   nofile    <span class="token number">65536</span>
oracle   soft   nproc    <span class="token number">16384</span>
oracle   hard   nproc    <span class="token number">16384</span>
oracle   soft   stack    <span class="token number">10240</span>
oracle   hard   stack    <span class="token number">32768</span>
oracle   hard   memlock    <span class="token number">134217728</span>
oracle   soft   memlock    <span class="token number">134217728</span>
grid   soft   nofile    <span class="token number">1024</span>
grid   hard   nofile    <span class="token number">65536</span>
grid   soft   nproc    <span class="token number">16384</span>
grid   hard   nproc    <span class="token number">16384</span>
grid   soft   stack    <span class="token number">10240</span>
grid   hard   stack    <span class="token number">32768</span>
grid   hard   memlock    <span class="token number">134217728</span>
grid   soft   memlock    <span class="token number">134217728</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installing-the-cvuqdisk-RPM-for-Linux"><a href="#Installing-the-cvuqdisk-RPM-for-Linux" class="headerlink" title="Installing the cvuqdisk RPM for Linux"></a>Installing the cvuqdisk RPM for Linux</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">CVUQDISK_GRP</span><span class="token operator">=</span>oinstall<span class="token punctuation">;</span> <span class="token builtin class-name">export</span> CVUQDISK_GRP
<span class="token function">rpm</span> <span class="token parameter variable">-iv</span> /soft/grid/rpm/cvuqdisk-1.0.9-1.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster"><a href="#Installing-Oracle-Grid-Infrastructure-for-a-New-Cluster" class="headerlink" title="Installing Oracle Grid Infrastructure for a New Cluster"></a>Installing Oracle Grid Infrastructure for a New Cluster</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> /soft/p13390677_112040_Linux-x86-64_3of7.zip
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /soft/grid
<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /soft/grid

<span class="token comment"># login oracle user</span>
<span class="token builtin class-name">cd</span> /soft/grid
./runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installing-the-Oracle-Database-Software"><a href="#Installing-the-Oracle-Database-Software" class="headerlink" title="Installing the Oracle Database Software"></a>Installing the Oracle Database Software</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">unzip</span> p13390677_112040_Linux-x86-64_1of7.zip<span class="token punctuation">;</span> <span class="token function">unzip</span> p13390677_112040_Linux-x86-64_2of7.zip
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /soft/database
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /soft/database

<span class="token comment"># login oracle user</span>
<span class="token builtin class-name">cd</span> /soft/database
./runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Installing Oracle 9.2.0.8 On RHEL 4.8</title>
    <url>/blog/posts/fdf22d0b.html</url>
    <content><![CDATA[<h1 id="Installing-Oracle-9-2-0-8-On-RHEL-4-8"><a href="#Installing-Oracle-9-2-0-8-On-RHEL-4-8" class="headerlink" title="Installing Oracle 9.2.0.8 On RHEL 4.8"></a>Installing Oracle 9.2.0.8 On RHEL 4.8</h1><blockquote>
<p>Operating System: RHEL 4.8<br>Database Software: amd64_db_9204_Disk{1..3}.cpio.gz<br>Database Patches: p4547809_92080_Linux-x86-64.zip</p>
</blockquote>
<h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h2><ul>
<li><a href="/blog/assets/pdf/oracle/Document-169706.1.pdf">Oracle Database (RDBMS) on Unix AIX,HP-UX,Linux,Mac OS X,Solaris,Tru64 Unix Operating Systems Installation and Configuration Requirements Quick Reference (8.0.5 to 11.2) (Doc ID 169706.1)</a></li>
<li><a href="Document-353529.1.pdf">Requirements for Installing Oracle 9iR2 64-bit on RHEL 4 x86-64 (AMD64&#x2F;EM64T) (Doc ID353529.1)</a></li>
</ul>
<p><strong>Checking Package Requirements</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">--qf</span> <span class="token string">'%&#123;NAME&#125;-%&#123;VERSION&#125;-%&#123;RELEASE&#125; (%&#123;ARCH&#125;)\n'</span> <span class="token punctuation">\</span>
compat-gcc-32 compat-gcc-32-c++ glibc-kernheaders glibc-headers glibc-devel <span class="token punctuation">\</span>
libstdc++-devel glibc-devel.i386 libaio ORBit.i386 gnome-libs.i386<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="Configuring-Operating-Systems"><a href="#Configuring-Operating-Systems" class="headerlink" title="Configuring Operating Systems"></a>Configuring Operating Systems</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/sysconfig/network-scripts/ifcfg-eth0</span>
<span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.184.10
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.184.2
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># service restart network</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment">#echo "192.168.184.10  oracle9i" >> /etc/hosts</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># service iptables stop</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># chkconfig iptables off</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># sed -i '/SELINUX=/&#123;s/enforcing/disabled/&#125;' /etc/selinux/config</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/^HOSTNAME=.*/HOSTNAME=oracle9i/' /etc/sysconfig/network</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Setting-Up-a-Working-Environment-for-Oracle"><a href="#Setting-Up-a-Working-Environment-for-Oracle" class="headerlink" title="Setting Up a Working Environment for Oracle"></a>Setting Up a Working Environment for Oracle</h2><p><strong>Creating Oracle User Accounts</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> dba
<span class="token function">groupadd</span> oinstall
<span class="token function">useradd</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba <span class="token parameter variable">-c</span> <span class="token string">"Oracle Software Owner"</span> oracle
<span class="token builtin class-name">echo</span> oracle <span class="token operator">|</span> <span class="token function">passwd</span> <span class="token parameter variable">--stdin</span> oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Creating Oracle Directories</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/9.2.0
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle.oinstall /u01
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /u01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>Setting Oracle Environment Variables</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /home/oracle/.bash_profile <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
# The following is add for Oracle 9i
umask 0022
# export LD_ASSUME_KERNEL=2.4.1    # for Red Hat Enterprise Linux 3
export LD_ASSUME_KERNEL=2.4.19   # for Red Hat Enterprise Linux 4
export ORACLE_BASE=/u01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/9.2.0
export ORACLE_SID=orcl
export ORACLE_TERM=xterm
export NLS_LANG=AMERICAN;
export ORA_NLS33=$ORACLE_HOME/ocommon/nls/admin/data
LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
export LD_LIBRARY_PATH
export PATH=$PATH:$ORACLE_HOME/bin
EOF</span>

<span class="token function">cat</span> <span class="token operator">>></span> /etc/profile <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 9i
if [<span class="token environment constant">$USER</span> = "oracle" ]; then
  if [<span class="token environment constant">$SHELL</span> = "/bin/ksh" ]; then
    ulimit -p 16384
    ulimit -n 65536
  else
    ulimit -u 16384 -n 65536
  fi
fi
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Setting-System-Parameters"><a href="#Setting-System-Parameters" class="headerlink" title="Setting System Parameters"></a>Setting System Parameters</h2><p><strong>Setting kernel parameters</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 9i
kernel.sem=250 32000 100 128
kernel.shmmax=2147483648
kernel.shmmni=4096
kernel.shmall=2097152
fs.file-max=65536
net.ipv4.ip_local_port_range=9000 65500
EOF</span>

<span class="token function">sysctl</span> <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Setting shell limits</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/security/limits.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 9i
oracle  soft  nproc  2047
oracle  hard  nproc  16384
oracle  soft  nofile  1024
oracle  hard  nofile  65536
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Setting PAM</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /etc/pam.d/login <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 9i
session  required  pam_limits.so
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Unpacking-the-Installation-Files-and-starting-runInstaller"><a href="#Unpacking-the-Installation-Files-and-starting-runInstaller" class="headerlink" title="Unpacking the Installation Files and starting runInstaller"></a>Unpacking the Installation Files and starting runInstaller</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle.dba /soft
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">775</span> /soft

<span class="token comment"># login as oracle user</span>
<span class="token builtin class-name">cd</span> /soft
zcat amd64_db_9204_Disk1.cpio.gz <span class="token operator">|</span> cpio <span class="token parameter variable">-idmv</span>
zcat amd64_db_9204_Disk2.cpio.gz <span class="token operator">|</span> cpio <span class="token parameter variable">-idmv</span>
zcat amd64_db_9204_Disk3.cpio.gz <span class="token operator">|</span> cpio <span class="token parameter variable">-idmv</span>
Disk1/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Use <code>netca</code> create a listener, <code>dbca</code> create a instance.</p>
<h2 id="Patching-Oracle-9-2-0-4-0-to-9-2-0-8-0"><a href="#Patching-Oracle-9-2-0-4-0-to-9-2-0-8-0" class="headerlink" title="Patching Oracle 9.2.0.4.0 to 9.2.0.8.0"></a>Patching Oracle 9.2.0.4.0 to 9.2.0.8.0</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /soft
<span class="token function">unzip</span> p4547809_92080_Linux-x86-64.zip <span class="token parameter variable">-d</span> p4547809
p4547809/Disk1/runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="Oracle-Post-Installation-Tasks"><a href="#Oracle-Post-Installation-Tasks" class="headerlink" title="Oracle Post Installation Tasks"></a>Oracle Post Installation Tasks</h2><p><strong>Setting automatic startup</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/orcl/s/:N/:Y/'</span> /etc/oratab

<span class="token function">cat</span> <span class="token operator">>></span> /etc/rc.local <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
# The following is add for Oracle 9i
su - oracle -c "lsnrctl start"
su - oracle -c "dbstart"
EOF</span>

<span class="token function">su</span> - oracle <span class="token parameter variable">-c</span> <span class="token string">'sqlplus /nolog &lt;&lt; EOF
conn / as sysdba
create pfile from spfile;
exit
EOF'</span><span aria-hidden="true"class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Installation-Errors"><a href="#Installation-Errors" class="headerlink" title="Installation Errors"></a>Installation Errors</h2><ol>
<li><p>The <code>scp</code> command upload software files error.</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token property">Unable to negotiate with 192.168.184.10 port 22:</span> no matching key exchange method found<span class="token punctuation">.</span> Their offer<span class="token operator">:</span> diffie<span class="token operator">-</span>hellman<span class="token operator">-</span>group<span class="token operator">-</span>exchange<span class="token operator">-</span>sha1<span class="token punctuation">,</span>diffie<span class="token operator">-</span>hellman<span class="token operator">-</span>group14<span class="token operator">-</span>sha1<span class="token punctuation">,</span>diffie<span class="token operator">-</span>hellman<span class="token operator">-</span>group1<span class="token operator">-</span>sha1
<span class="token file-path string">/bin/scp</span><span class="token operator">:</span> Connection closed

<span class="token property">Unable to negotiate with 192.168.184.10 port 22:</span> no matching host key type found<span class="token punctuation">.</span> Their offer<span class="token operator">:</span> ssh<span class="token operator">-</span>rsa<span class="token punctuation">,</span>ssh<span class="token operator">-</span>dss
<span class="token file-path string">/bin/scp</span><span class="token operator">:</span> Connection closed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Workaround: Add scp options:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> <span class="token parameter variable">-oKexAlgorithms</span><span class="token operator">=</span>+diffie-hellman-group1-sha1 <span class="token parameter variable">-oHostKeyAlgorithms</span><span class="token operator">=</span>+ssh-dss amd64_db_9204_Disk* root@192.168.184.10:/soft<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>runInstaller(OUI) starting error.<br><font color=error>Exception in thread “main” java.lang.UnsatisfiedLinkError: &#x2F;tmp&#x2F;OraInstall2023-06-03_11-46-39PM&#x2F;jre&#x2F;lib&#x2F;i386&#x2F;libawt.so: libXp.so.6: cannot open shared object file: No such file or directory</font></p>
<p>Workaround: </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> <span class="token parameter variable">--nodeps</span> xorg-x11-deprecated-libs-6.8.2-1.EL.63.i386.rpm
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> <span class="token parameter variable">--nodeps</span> xorg-x11-libs-6.8.2-1.EL.63.i386.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>runInstaller(OUI) Install pop-up error.<br>runInstaller(OUI) Install at 88% pop-up <font color=error>Error in invoking target install of makefile ins_sqlplus.mk.</font><br>You may see the following errors in <code>$ORACLE_HOME/install/make.log</code>:</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token file-path string">/usr/bin/ld</span><span class="token operator">:</span> crt1<span class="token punctuation">.</span>o<span class="token operator">:</span> No such file<span class="token operator">:</span> No such file or directory
<span class="token property">collect2:</span> ld returned <span class="token number">1</span> exit status
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token separator comment">***</span> <span class="token punctuation">[</span>installisqlplus32<span class="token punctuation">]</span> Error <span class="token number">1</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> Leaving directory `<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>product<span class="token operator">/</span><span class="token number">9.2.0</span><span class="token operator">/</span>sqlplus<span class="token operator">/</span>lib'<span class="token property">make:</span> <span class="token separator comment">***</span> <span class="token punctuation">[</span>isqlplus<span class="token punctuation">]</span> Error <span class="token number">2</span><span aria-hidden="true"class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>or runInstaller(OUI) Install at 98% pop-up <font color=error>Error in invoking target install of makefile &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;9.2.0&#x2F;rdbms&#x2F;lib&#x2F;ins_rdbms.mk</font><br>You may see the following errors in <code>$ORACLE_HOME/install/make.log</code>:</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token file-path string">/usr/bin/ld</span><span class="token operator">:</span> warning<span class="token operator">:</span> libwtc9<span class="token punctuation">.</span>so<span class="token punctuation">,</span> needed by <span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token punctuation">,</span> not found <span class="token operator">(</span>try using <span class="token operator">-</span>rpath or <span class="token operator">-</span>rpath<span class="token operator">-</span>link<span class="token operator">)</span>
<span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token operator">:</span> undefined reference to `wtcstu'<span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token operator">:</span> undefined reference to `wtclkm'
<span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token operator">:</span> undefined reference to `wtcsrin'<span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token operator">:</span> undefined reference to `wtcMerr'
<span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token operator">:</span> undefined reference to `wtcsrin0'<span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token operator">:</span> undefined reference to `wtcsrfre'
<span class="token file-path string">/u01/app/oracle/product/9.2.0/lib32//libclntsh.so</span><span class="token operator">:</span> undefined reference to `wtcLerr'<span class="token property">collect2:</span> ld returned <span class="token number">1</span> exit status
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token separator comment">***</span> <span class="token punctuation">[</span><span class="token file-path string">/u01/app/oracle/product/9.2.0/rdbms/lib/extproc32</span><span class="token punctuation">]</span> Error <span class="token number">1</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> Leaving directory `<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>product<span class="token operator">/</span><span class="token number">9.2.0</span><span class="token operator">/</span>rdbms<span class="token operator">/</span>lib'<span class="token property">make:</span> <span class="token separator comment">***</span> <span class="token punctuation">[</span>extproc32<span class="token punctuation">]</span> Error <span class="token number">2</span><span aria-hidden="true"class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Workaround: Install glibc-devel.i386 and downgrade gcc&#x2F;g++ version. And then <code>reboot</code> the system.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> /usr/bin/gcc /usr/bin/gcc.orig
<span class="token function">mv</span> /usr/bin/g++ /usr/bin/g++.orig
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/bin/x86_64-redhat-linux-gcc32 /usr/bin/gcc
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/bin/x86_64-redhat-linux-g++32 /usr/bin/g++

<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> glibc-devel-2.3.4-2.43.i386.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h1 id="Deinstall-Oracle-9i"><a href="#Deinstall-Oracle-9i" class="headerlink" title="Deinstall Oracle 9i"></a>Deinstall Oracle 9i</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/oraInst.loc
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/oratab
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /usr/local/bin/dbhome
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /usr/local/bin/oraenv
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /usr/local/bin/coraenv
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracle-database-preinstall-19c-rpm</title>
    <url>/blog/posts/341c84ed.html</url>
    <content><![CDATA[<h1 id="Oracle-database-preinstall-19c-rpm"><a href="#Oracle-database-preinstall-19c-rpm" class="headerlink" title="Oracle-database-preinstall-19c-rpm"></a>Oracle-database-preinstall-19c-rpm</h1><h2 id="Installing-the-Oracle-Preinstallation-RPM"><a href="#Installing-the-Oracle-Preinstallation-RPM" class="headerlink" title="Installing the Oracle Preinstallation RPM"></a>Installing the Oracle Preinstallation RPM</h2><p>Use Oracle Preinstallation RPM to simplify operating system configuration in preparation for Oracle software installations.</p>
<ul>
<li><p>When installed, the Oracle Preinstallation RPM does the following:<br>Automatically downloads and installs any additional RPM packages needed forinstalling Oracle Grid Infrastructure and Oracle Database, and resolves anydependencies</p>
</li>
<li><p>Creates an oracle user, and creates the oraInventory (oinstall) and OSDBA (dba) groups for that user</p>
</li>
<li><p>As needed, sets sysctl.conf settings, system startup parameters, and driver parameters to values based on recommendations from the Oracle Preinstallation RPM program</p>
</li>
<li><p>Sets hard and soft resource limits</p>
</li>
<li><p>Sets other recommended parameters, depending on your kernel version</p>
</li>
<li><p>Sets numa&#x3D;off in the kernel for Linux x86_64 machines.</p>
</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19c ~<span class="token punctuation">]</span><span class="token comment"># yum -y install oracle-database-preinstall-19c</span>
<span class="token punctuation">[</span>root@oracle19c ~<span class="token punctuation">]</span><span class="token comment"># cat /var/log/oracle-database-preinstall-19c/results/orakernel.log</span>
Adding group oinstall with gid <span class="token number">54321</span>
Adding group dba with gid <span class="token number">54322</span>
Adding group oper with gid <span class="token number">54323</span>
Adding group backupdba with gid <span class="token number">54324</span>
Adding group dgdba with gid <span class="token number">54325</span>
Adding group kmdba with gid <span class="token number">54326</span>
Adding group racdba with gid <span class="token number">54330</span>
Adding user oracle with user <span class="token function">id</span> <span class="token number">54321</span>, initial login group oinstall, supplementary <span class="token function">groups</span> oinstall,dba,oper,backupdba,dgdba,kmdba,racdba and  home directory /home/oracle
Changing ownership of /home/oracle to oracle:oinstall
Please <span class="token builtin class-name">set</span> password <span class="token keyword">for</span> user - oracle
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">54321</span><span class="token punctuation">(</span>oracle<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">54321</span><span class="token punctuation">(</span>oinstall<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">54321</span><span class="token punctuation">(</span>oinstall<span class="token punctuation">)</span>,54330<span class="token punctuation">(</span>racdba<span class="token punctuation">)</span>,54322<span class="token punctuation">(</span>dba<span class="token punctuation">)</span>,54323<span class="token punctuation">(</span>oper<span class="token punctuation">)</span>,54324<span class="token punctuation">(</span>backupdba<span class="token punctuation">)</span>,54325<span class="token punctuation">(</span>dgdba<span class="token punctuation">)</span>,54326<span class="token punctuation">(</span>kmdba<span class="token punctuation">)</span>
User creation passed

Saving a copy of the initial sysctl.conf
Verifying  kernel parameters as per Oracle recommendations<span class="token punctuation">..</span>.
Adding fs.file-max <span class="token operator">=</span> <span class="token number">6815744</span>
Adding kernel.sem <span class="token operator">=</span> <span class="token number">250</span> <span class="token number">32000</span> <span class="token number">100</span> <span class="token number">128</span>
Adding kernel.shmmni <span class="token operator">=</span> <span class="token number">4096</span>
Adding kernel.shmall <span class="token operator">=</span> <span class="token number">1073741824</span>
Adding kernel.shmmax <span class="token operator">=</span> <span class="token number">4398046511104</span>
Adding kernel.panic_on_oops <span class="token operator">=</span> <span class="token number">1</span>
Adding net.core.rmem_default <span class="token operator">=</span> <span class="token number">262144</span>
Adding net.core.rmem_max <span class="token operator">=</span> <span class="token number">4194304</span>
Adding net.core.wmem_default <span class="token operator">=</span> <span class="token number">262144</span>
Adding net.core.wmem_max <span class="token operator">=</span> <span class="token number">1048576</span>
Adding net.ipv4.conf.all.rp_filter <span class="token operator">=</span> <span class="token number">2</span>
Adding net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">2</span>
Adding fs.aio-max-nr <span class="token operator">=</span> <span class="token number">1048576</span>
Adding net.ipv4.ip_local_port_range <span class="token operator">=</span> <span class="token number">9000</span> <span class="token number">65500</span>
Setting kernel parameters as per oracle recommendations<span class="token punctuation">..</span>.
Altered <span class="token function">file</span> /etc/sysctl.conf
Saved a copy of the current <span class="token function">file</span> <span class="token keyword">in</span> /etc/sysctl.d/99-oracle-database-preinstall-19c-sysctl.conf
Check /etc/sysctl.d <span class="token keyword">for</span> backups
Verification <span class="token operator">&amp;</span> setting of kernel parameters passed

Setting user limits using /etc/security/limits.d/oracle-database-preinstall-19c.conf

Verifying oracle user OS limits as per Oracle recommendations<span class="token punctuation">..</span>.
Adding oracle soft nofile  <span class="token number">1024</span>
Adding oracle hard nofile  <span class="token number">65536</span>
Adding oracle soft nproc  <span class="token number">16384</span>
Adding oracle hard nproc  <span class="token number">16384</span>
Adding oracle soft stack  <span class="token number">10240</span>
Adding oracle hard stack  <span class="token number">32768</span>
Adding oracle hard memlock  <span class="token number">134217728</span>
Adding oracle soft memlock  <span class="token number">134217728</span>
Adding oracle soft data  unlimited
Adding oracle hard data  unlimited
Setting oracle user OS limits as per Oracle recommendations<span class="token punctuation">..</span>.
Altered <span class="token function">file</span> /etc/security/limits.d/oracle-database-preinstall-19c.conf
Original <span class="token function">file</span> backed up at /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53
Verification <span class="token operator">&amp;</span> setting of user limits passed

Saving a copy of /etc/default/grub <span class="token function">file</span> <span class="token keyword">in</span> /etc/default/grub-initial.orabackup
Saving a copy of /etc/default/grub <span class="token keyword">in</span> /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53<span class="token punctuation">..</span>.
Verifying kernel boot parameters as per Oracle recommendations<span class="token punctuation">..</span>.
old boot params: <span class="token string">"resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet"</span>
new boot params: <span class="token string">"resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off"</span>

Setting boot params - Checking <span class="token keyword">for</span> blscfg
<span class="token assign-left variable">GRUB_ENABLE_BLSCFG</span><span class="token operator">=</span>true
options <span class="token variable">$kernelopts</span> <span class="token variable">$tuned_params</span>
options <span class="token variable">$kernelopts</span> <span class="token variable">$tuned_params</span>
options <span class="token variable">$kernelopts</span> <span class="token variable">$tuned_params</span>
old boot params: <span class="token string">"resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off"</span>
new boot params: <span class="token string">"resume=/dev/mapper/ol-swap rd.lvm.lv=ol/root rd.lvm.lv=ol/swap rhgb quiet numa=off transparent_hugepage=never"</span>

Setting boot params - Checking <span class="token keyword">for</span> blscfg
<span class="token assign-left variable">GRUB_ENABLE_BLSCFG</span><span class="token operator">=</span>true
options <span class="token variable">$kernelopts</span> <span class="token variable">$tuned_params</span>
options <span class="token variable">$kernelopts</span> <span class="token variable">$tuned_params</span>
options <span class="token variable">$kernelopts</span> <span class="token variable">$tuned_params</span>
Setting kernel boot parameters as per Oracle recommendations<span class="token punctuation">..</span>.
<span class="token assign-left variable">G_DIR</span><span class="token operator">=</span>/boot/grub2
Checking <span class="token keyword">for</span> blscfg
<span class="token assign-left variable">GRUB_ENABLE_BLSCFG</span><span class="token operator">=</span>true
Saved Entry <span class="token operator">=</span> 63e2e66b7eb349e4b44eded7924c6643-5.4.17-2136.300.7.el8uek.x86_64
Running grub2-mkconfig
Generating grub configuration <span class="token function">file</span> <span class="token punctuation">..</span>.
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">15020</span>: /usr/sbin/grub2-probe
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">15020</span>: /usr/sbin/grub2-probe
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">15195</span>: /usr/sbin/grub2-probe
File descriptor <span class="token number">199</span> <span class="token punctuation">(</span>/run/lock/subsys/oracle-preinstall.lock<span class="token punctuation">)</span> leaked on vgs invocation. Parent PID <span class="token number">15195</span>: /usr/sbin/grub2-probe
<span class="token keyword">done</span>
Restore default
Boot parameters will be effected on next <span class="token function">reboot</span>
Altered <span class="token function">file</span> /etc/default/grub
Copy of the changed <span class="token function">file</span> is <span class="token keyword">in</span> - /etc/default/grub-oracle-database-preinstall-19c.orabackup
Copy of the original <span class="token function">file</span> is <span class="token keyword">in</span> - /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53
Verification <span class="token operator">&amp;</span> setting of boot parameters passed

Trying to <span class="token function">add</span> NOZEROCONF parameter<span class="token punctuation">..</span>.
Taking a backup of existing <span class="token function">file</span> to /etc/sysconfig/network.orabackup
Successfully added parameter NOZEROCONF to /etc/sysconfig/network
Setting /etc/sysconfig/network parameters passed

Disabling Transparent Hugepages.
Refer Oracle Note:1557478.1

Disabling defrag.
Refer Oracle Note:1557478.1

Taking a backup of old config files under /var/log/oracle-database-preinstall-19c/backup/Dec-29-2021-09-20-53<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>High CPU Usage</title>
    <url>/blog/posts/c0cd38d7.html</url>
    <content><![CDATA[<p>数据库运行慢，登录操作系统发现 CPU 使用率比平常要高 <br> 查看当前会话运行的 SQL Text 和 PLAN</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> sql_id<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> gv$<span class="token keyword">session</span> <span class="token keyword">where</span> <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">'USER'</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'ACTIVE'</span> <span class="token keyword">group</span> <span class="token keyword">by</span> sql_id<span class="token punctuation">;</span>
SQL_ID          <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">------------- ----------</span>
arz2wrgd05c5z          <span class="token number">1</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> addr<span class="token punctuation">,</span>spid <span class="token keyword">from</span> v$process <span class="token keyword">where</span> spid<span class="token operator">=</span><span class="token string">'3268'</span><span class="token punctuation">;</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> sid<span class="token punctuation">,</span>sql_id <span class="token keyword">from</span> v$<span class="token keyword">session</span> <span class="token keyword">where</span> paddr<span class="token operator">=</span><span class="token string">'0000000090CCF600'</span><span class="token punctuation">;</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> sql_text <span class="token keyword">from</span> v$<span class="token keyword">sql</span> <span class="token keyword">where</span> sql_id<span class="token operator">=</span><span class="token string">'arz2wrgd05c5z'</span><span class="token punctuation">;</span>

<span class="token keyword">SQL</span><span class="token operator">></span> 
<span class="token keyword">select</span> sql_id
 <span class="token keyword">from</span> v$<span class="token keyword">session</span>
 <span class="token keyword">where</span> paddr <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> addr <span class="token keyword">from</span> v$process
 <span class="token keyword">where</span> spid <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'5621'</span><span class="token punctuation">,</span><span class="token string">'31801'</span><span class="token punctuation">,</span><span class="token string">'31463'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> PLAN_TABLE_OUTPUT <span class="token keyword">FROM</span> <span class="token keyword">TABLE</span><span class="token punctuation">(</span>DBMS_XPLAN<span class="token punctuation">.</span>DISPLAY_CURSOR<span class="token punctuation">(</span><span class="token string">'&amp;sql_id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看 SQL_TEXT</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">[</span>root<span class="token variable">@oracle</span> <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># top</span>
    PID <span class="token keyword">USER</span>      PR  NI    VIRT    RES    SHR S  <span class="token operator">%</span>CPU <span class="token operator">%</span>MEM     <span class="token keyword">TIME</span><span class="token operator">+</span> COMMAND
 <span class="token number">3428</span> oracle    <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">1060988</span>  <span class="token number">80356</span>  <span class="token number">77608</span> R  <span class="token number">97.7</span>  <span class="token number">4.0</span>   <span class="token number">0</span>:<span class="token number">32.34</span> oracle

<span class="token keyword">SQL</span><span class="token operator">></span>
<span class="token keyword">SELECT</span> sql_text
 <span class="token keyword">FROM</span> v$sqltext a
 <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>hash_value<span class="token punctuation">,</span> a<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> DECODE<span class="token punctuation">(</span>sql_hash_value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> prev_hash_value<span class="token punctuation">,</span> sql_hash_value<span class="token punctuation">)</span><span class="token punctuation">,</span>
 DECODE<span class="token punctuation">(</span>sql_hash_value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> prev_sql_addr<span class="token punctuation">,</span> sql_address<span class="token punctuation">)</span>
 <span class="token keyword">FROM</span> v$<span class="token keyword">session</span> b
 <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>paddr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> addr <span class="token keyword">FROM</span> v$process c <span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>spid <span class="token operator">=</span> <span class="token string">'&amp;pid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> piece <span class="token keyword">ASC</span><span class="token punctuation">;</span>

Enter <span class="token keyword">value</span> <span class="token keyword">for</span> pid: <span class="token number">3428</span>
old   <span class="token number">7</span>:  <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>paddr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> addr <span class="token keyword">FROM</span> v$process c <span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>spid <span class="token operator">=</span> <span class="token string">'&amp;pid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
new   <span class="token number">7</span>:  <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>paddr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> addr <span class="token keyword">FROM</span> v$process c <span class="token keyword">WHERE</span> c<span class="token punctuation">.</span>spid <span class="token operator">=</span> <span class="token string">'3428'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

SQL_TEXT
<span class="token comment">----------------------------------------------------------------</span>
<span class="token keyword">declare</span> num <span class="token keyword">int</span>:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">begin</span> <span class="token keyword">loop</span> num:<span class="token operator">=</span>num<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span> <span class="token keyword">end</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>生成 kill session 语句</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token string">'alter system kill session'''</span> <span class="token operator">||</span> sid <span class="token operator">||</span> <span class="token string">','</span> <span class="token operator">||</span> <span class="token keyword">serial</span><span class="token comment"># || '''immediate;'</span>
<span class="token keyword">FROM</span> v$<span class="token keyword">session</span> <span class="token keyword">WHERE</span> sql_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'&amp;sql_id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Optimization</category>
      </categories>
      <tags>
        <tag>optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>Optimization</title>
    <url>/blog/posts/787d9e55.html</url>
    <content><![CDATA[<ol>
<li><p>what oracle waiting for ???</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> 
 <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> event<span class="token punctuation">,</span> sql_id<span class="token punctuation">,</span> program<span class="token punctuation">,</span> inst_id
  <span class="token keyword">from</span> gv$active_session_history
  <span class="token keyword">where</span> sample_time <span class="token operator">></span> sysdate<span class="token operator">-</span><span class="token number">5</span><span class="token operator">/</span><span class="token number">1440</span>
  <span class="token keyword">group</span> <span class="token keyword">by</span> event<span class="token punctuation">,</span> sql_id<span class="token punctuation">,</span> program<span class="token punctuation">,</span> inst_id
  <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span> <span class="token keyword">desc</span><span class="token punctuation">)</span>
<span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>query execution plan</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> plan_table_output <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">(</span>dbms_xplan<span class="token punctuation">.</span>display_cursor<span class="token punctuation">(</span><span class="token string">'&amp;sql_id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- 已知 SQL_Id 的情况下 </span>

<span class="token keyword">explain</span> <span class="token keyword">plan</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>SQL_TEXT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">(</span>dbms_xplan<span class="token punctuation">.</span>display<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">set</span> autotrace <span class="token keyword">on</span> <span class="token keyword">explain</span> <span class="token comment">-- 显示值和执行计划 </span>
<span class="token keyword">set</span> autotrace traceonly <span class="token keyword">explain</span> <span class="token comment">-- 只显示执行计划 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Optimization</category>
      </categories>
      <tags>
        <tag>optimization</tag>
      </tags>
  </entry>
  <entry>
    <title>CRS-1714 Unable to discover any voting files</title>
    <url>/blog/posts/4b6becc3.html</url>
    <content><![CDATA[<h1 id="CRS-1714-Unable-to-discover-any-voting-files"><a href="#CRS-1714-Unable-to-discover-any-voting-files" class="headerlink" title="CRS-1714 Unable to discover any voting files"></a>CRS-1714 Unable to discover any voting files</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9<br>Oracle Database - Enterprise Edition - Version 11.2.0.4.0<br>Oracle Grid Infrastructure - Version 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>操作系统重启后，crs 无法正常启动</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@rac1 ~<span class="token punctuation">]</span>$ crsctl <span class="token function">stat</span> res <span class="token parameter variable">-t</span>
CRS-4535: Cannot communicate with Cluster Ready Services
CRS-4000: Command Status failed, or completed with errors.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>查看 <code>/u01/app/11.2.0/grid/log/rac1/alertrac1.log</code> 日志，出现无法识别到 voting files 报错</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token punctuation">[</span>cssd<span class="token operator">(</span><span class="token number">3348</span><span class="token operator">)</span><span class="token punctuation">]</span>CRS<span class="token operator">-</span><span class="token number">1714</span><span class="token operator">:</span>Unable to discover any voting files<span class="token punctuation">,</span> retrying discovery in <span class="token number">15</span> seconds<span class="token operator">;</span> Details at <span class="token operator">(</span><span class="token operator">:</span>CSSNM00070<span class="token operator">:</span><span class="token operator">)</span> in <span class="token file-path string">/u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log</span>
<span class="token date number">2022-05-01</span> <span class="token time number">12:51:13.898</span><span class="token operator">:</span>
<span class="token punctuation">[</span>cssd<span class="token operator">(</span><span class="token number">3348</span><span class="token operator">)</span><span class="token punctuation">]</span>CRS<span class="token operator">-</span><span class="token number">1714</span><span class="token operator">:</span>Unable to discover any voting files<span class="token punctuation">,</span> retrying discovery in <span class="token number">15</span> seconds<span class="token operator">;</span> Details at <span class="token operator">(</span><span class="token operator">:</span>CSSNM00070<span class="token operator">:</span><span class="token operator">)</span> in <span class="token file-path string">/u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log</span>
<span class="token date number">2022-05-01</span> <span class="token time number">12:51:28.914</span><span class="token operator">:</span>
<span class="token punctuation">[</span>cssd<span class="token operator">(</span><span class="token number">3348</span><span class="token operator">)</span><span class="token punctuation">]</span>CRS<span class="token operator">-</span><span class="token number">1714</span><span class="token operator">:</span>Unable to discover any voting files<span class="token punctuation">,</span> retrying discovery in <span class="token number">15</span> seconds<span class="token operator">;</span> Details at <span class="token operator">(</span><span class="token operator">:</span>CSSNM00070<span class="token operator">:</span><span class="token operator">)</span> in <span class="token file-path string">/u01/app/11.2.0/grid/log/rac1/cssd/ocssd.log</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>检查 oracleasm configure，已经设置开机启动扫描磁盘</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm configure</span>
<span class="token assign-left variable">ORACLEASM_ENABLED</span><span class="token operator">=</span>true
<span class="token assign-left variable">ORACLEASM_UID</span><span class="token operator">=</span>grid
<span class="token assign-left variable">ORACLEASM_GID</span><span class="token operator">=</span>asmadmin
<span class="token assign-left variable">ORACLEASM_SCANBOOT</span><span class="token operator">=</span>true
<span class="token assign-left variable">ORACLEASM_SCANORDER</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token assign-left variable">ORACLEASM_SCANEXCLUDE</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token assign-left variable">ORACLEASM_SCAN_DIRECTORIES</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token assign-left variable">ORACLEASM_USE_LOGICAL_BLOCK_SIZE</span><span class="token operator">=</span><span class="token string">"false"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>而且手动扫描磁盘是可以扫到磁盘的，说明配置是没啥问题的</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># oracleasm scandisks</span>
Reloading disk partitions: <span class="token keyword">done</span>
Cleaning any stale ASM disks<span class="token punctuation">..</span>.
Scanning system <span class="token keyword">for</span> ASM disks<span class="token punctuation">..</span>.
Instantiating disk <span class="token string">"OCR_VOTE1"</span>
Instantiating disk <span class="token string">"OCR_VOTE2"</span>
Instantiating disk <span class="token string">"OCR_VOTE3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>由于磁盘通过 iSCSI 共享映射的，经过排查是因为 <code>oracleasm.service</code> 的服务比 <code>iscsid.service</code> 的服务更早启动，导致 oracleasm 没有扫描到 iSCSI 共享磁盘</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>修改一下服务让 oracleasm 在 iscsid 后面启动</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@rac1 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /usr/lib/systemd/system/oracleasm.service
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Load oracleasm Modules
<span class="token assign-left variable">Requires</span><span class="token operator">=</span>iscsid.service <span class="token comment"># add</span>
<span class="token assign-left variable">After</span><span class="token operator">=</span>iscsi.service iscsid.service <span class="token comment"># add</span>

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>oneshot
<span class="token assign-left variable">RemainAfterExit</span><span class="token operator">=</span>yes
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/oracleasm.init start_sysctl
<span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/usr/sbin/oracleasm.init stop_sysctl
<span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/usr/sbin/oracleasm.init restart_sysctl

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重启后，问题解决。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>CRS-4124 Oracle High Availability Services startup failed</title>
    <url>/blog/posts/53153380.html</url>
    <content><![CDATA[<h1 id="CRS-4124-Oracle-High-Availability-Services-startup-failed"><a href="#CRS-4124-Oracle-High-Availability-Services-startup-failed" class="headerlink" title="CRS-4124 Oracle High Availability Services startup failed"></a>CRS-4124 Oracle High Availability Services startup failed</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9 &#x2F; Linux 7<br>Oracle Database - Enterprise Edition - Version 11.2.0.3.0 - 11.2.0.4.0<br>Oracle Grid Infrastructure - Version 11.2.2.0 - 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>安装 GI 软件，执行 <code>root.sh</code> 时报错：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token property">CRS-4124:</span> Oracle High Availability Services startup failed<span class="token punctuation">.</span>
<span class="token property">CRS-4000:</span> Command Start failed<span class="token punctuation">,</span> or completed with errors<span class="token punctuation">.</span>
<span class="token property">ohasd failed to start:</span> Inappropriate ioctl for device
ohasd failed to start at <span class="token file-path string">/oracle/app/product/grid/crs/install/rootcrs.pl</span> line <span class="token number">443</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>已知的问题，OL7 期望使用 systemd 而不是 initd 来运行进程和重新启动它们，而 root.sh 目前无法处理这个问题。</p>
<ul>
<li><a href="/blog/assets/pdf/oracle/Document-1959008.1.pdf">Install of Clusterware fails while running root.sh on OL7 - ohasd fails to start (Doc ID 1959008.1)</a></li>
</ul>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><ol>
<li><p>执行脚本回滚 root.sh 操作</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># $&lt;GRID_HOME>/crs/install/rootcrs.pl -deconfig -force -verbose</span>
<span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># $&lt;GRID_HOME>/crs/install/roothas.pl -deconfig -force -verbose</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>窗口一重新执行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># $&lt;GRID_HOME>/root.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>窗口二执行</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rac1 ~<span class="token punctuation">]</span><span class="token comment"># while true; do if [[-e /var/tmp/.oracle/npohasd]]; then echo exist; dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1; else echo noexist; sleep 1; fi; done</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>安装完 GI 后创建 <code>ohas.service</code> 服务，使得服务器重启时能够自动启动 CRS</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> /usr/lib/systemd/system/ohas.service <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[Unit]
Description=Oracle High Availability Services
After=syslog.target

[Service]
ExecStart=/etc/init.d/init.ohasd run > /dev/null 2>&amp;1 &lt; /dev/null
Type=simple
Restart=always

[Install]
WantedBy=multi-user.target
EOF</span>

systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> ohas.service <span class="token parameter variable">--now</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Execution rootcrs.pl fails</title>
    <url>/blog/posts/c8fcf40e.html</url>
    <content><![CDATA[<h1 id="Execution-rootcrs-pl-fails"><a href="#Execution-rootcrs-pl-fails" class="headerlink" title="Execution rootcrs.pl fails"></a>Execution rootcrs.pl fails</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9<br>Oracle Database - Enterprise Edition - Version 11.2.0.4.0<br>Oracle Grid Infrastructure - Version 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>执行 <code>$&lt;GI_HOME&gt;/crs/install/rootcrs.pl</code> 命令回滚 crs 配置，出现如下报错：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/11.2.0/grid/crs/install/rootcrs.pl -deconfig -force -verbose</span>
Can't <span class="token function">locate</span> Env.pm <span class="token keyword">in</span> @INC <span class="token punctuation">(</span>@INC contains: /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 <span class="token builtin class-name">.</span> /u01/app/11.2.0/grid/crs/install<span class="token punctuation">)</span> at /u01/app/11.2.0/grid/crs/install/crsconfig_lib.pm line <span class="token number">703</span>.
BEGIN failed--compilation aborted at /u01/app/11.2.0/grid/crs/install/crsconfig_lib.pm line <span class="token number">703</span>.
Compilation failed <span class="token keyword">in</span> require at /u01/app/11.2.0/grid/crs/install/rootcrs.pl line <span class="token number">305</span>.
BEGIN failed--compilation aborted at /u01/app/11.2.0/grid/crs/install/rootcrs.pl line <span class="token number">305</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>缺少 <code>perl-Env</code> 依赖包。</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>安装 <code>perl-Env</code> 依赖包</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@exadb01 ~<span class="token punctuation">]</span><span class="token comment"># yum -y install perl-Env.noarch</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00600 2662</title>
    <url>/blog/posts/1a397da3.html</url>
    <content><![CDATA[<h1 id="ORA-00600-2662"><a href="#ORA-00600-2662" class="headerlink" title="ORA-00600 2662"></a>ORA-00600 2662</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>在一次数据库恢复过程中，使用 <code>_ALLOW_RESETLOGS_CORRUPTION = TRUE</code> 这个隐含参数来强制打开数据库，遇到 ORA-00600: internal error code, arguments: [2662] 报错如下：</p>
<p><font color=error>Errors in file &#x2F;app&#x2F;oracle&#x2F;admin&#x2F;rac&#x2F;udump&#x2F;rac1_ora_3997860.trc:ORA-00600: internal error code, arguments: [2662], [3186][3707069194], [3186], [3707142625], [29580553], [], []</font></p>
<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>关于 ORA-00600: internal error code, arguments: [2662]这个报错的解释如下：<br>ORA-00600 [2662] “Block SCN is ahead of Current SCN”，说明当前数据库的据块的 SCN 早于当前的 SCN，主要是和存储在 UGA 变量中的 dependent SCN 进行比较，如当前的 SCN 小于它，数据库就会产生这个 ORA-00600 [2662]的错误了。这个错误一共有 5 个数，分别代表不同的含义</p>
<p><strong>ORA-00600 [2662] [a] [b] {c} [d] [e]</strong></p>
<blockquote>
<p>Arg [a] Current SCN WRAP;<br>Arg [b] Current SCN BASE;<br>Arg {c} dependent SCN WRAP;<br>Arg [d] dependent SCN BASE;<br>Arg [e] Where present this is the DBA where the dependent SCN came from.</p>
</blockquote>
<p>我们分析错误中的提示，它的参数 b&#x3D;3707069194,d&#x3D;3707142625, 表明当前的 SCN 确实小于 dependent SCN，所以产生了这个 ORA-00600 的错误。<br>通过查阅 oracle metalink 文档得知，出现这个报错主要有以下原因：</p>
<ol>
<li>使用隐含参数_ALLOW_RESETLOGS_CORRUPTION 后 resetlogs 打开数据库；</li>
<li>恢复了控制文件但是没有使用 recover database using backup controlfile 进行恢复；</li>
<li>数据库 crash 后设置了_DISABLE_LOGGING 隐含参数；</li>
<li>在并行服务器环境中 DLM 存在问题；</li>
<li>硬件错误引起数据库没法写控制文件和重做日志文件；</li>
<li>错误的部分恢复数据库。</li>
</ol>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>ORA-00600: internal error code, arguments: [2662]这个报错的方法如下：</p>
<ol>
<li>如果 SCN 相差不多，可以通过多次重起数据库解决（每次加 1）</li>
<li>通过 10015 ADJUST_SCN 事件来增进 current SCN<br>1）计算 level<br>1.1) Arg [c] * 4 得出一个数值，假设为 V_Wrap<br>1.2) 如果 Arg [d] &#x3D; 0，则 V_Wrap 值为需要的 level<br>Arg [d] &lt; 1073741824，V_Wrap+1 为需要的 level<br>Arg [d] &lt; 2147483648，V_Wrap+2 为需要的 level<br>Arg [d] &lt; 3221225472，V_Wrap+3 为需要的 level<br>1.3）SCN 被增进了 1024 x 1024 x 1024 x level（level x 10 billion）<br>2）执行内部事件将数据库强行打开<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">session</span> <span class="token keyword">set</span> events <span class="token string">'10015 trace name adjust_scn level N'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
注：mount 状态下执行（open 下无效）</li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Installation Errors for Oracle 19.3 RAC on RHEL 8.7</title>
    <url>/blog/posts/43622e5f.html</url>
    <content><![CDATA[<h1 id="Installation-Errors-for-Oracle-19-3-RAC-on-RHEL-8-7"><a href="#Installation-Errors-for-Oracle-19-3-RAC-on-RHEL-8-7" class="headerlink" title="Installation Errors for Oracle 19.3 RAC on RHEL 8.7"></a>Installation Errors for Oracle 19.3 RAC on RHEL 8.7</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - RHEL 8.7<br>Oracle Database - Enterprise Edition - Version 19.3.0.0.0 RAC with 3 nodes<br>Oracle Grid Infrastructure - Version 19.3.0.0.0</p>
</blockquote>
<h2 id="Symptoms"><a href="#Symptoms" class="headerlink" title="Symptoms"></a>Symptoms</h2><p>执行 GI 软件 OUI<code>$GRID_HOME/gridSetup.sh</code>和 Oracle 数据库软件 OUI<code>$ORACLE_HOME/runInstaller</code>时，出现如下错误：</p>
<p><font color=error>[WARNING] [INS-08101] Unexpected error while executing the action at state: ‘supportedOSCheck’.</font></p>
<h3 id="Workaround"><a href="#Workaround" class="headerlink" title="Workaround"></a>Workaround</h3><p>参考 Requirements for Installing Oracle Database&#x2F;Client 19c on OL8 or RHEL8 64-bit (x86-64)(Doc ID 2668780.1)</p>
<p><a href="/blog/assets/pdf/oracle/Document-2668780.1.pdf">Document-2668780.1</a></p>
<p>OL&#x2F;RHEL8 操作系统版本不在 19c 预检列表中，在 RU 19.6 及更高版本中修复。<br>在执行安装脚本前，设置 <code>CV_ASSUME_DISTID</code> 变量假设操作系统版本为 OL7：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">CV_ASSUME_DISTID</span><span class="token operator">=</span>OEL7
./gridSetup.sh

<span class="token builtin class-name">export</span> <span class="token assign-left variable">CV_ASSUME_DISTID</span><span class="token operator">=</span>OEL7
./runInstaller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="INS-06006"><a href="#INS-06006" class="headerlink" title="INS-06006"></a>INS-06006</h2><p>在节点 SSH 免密验证时，出现如下错误：</p>
<p><font color=error>[INS-06006] Passwordless SSH connectivity not set up between the following node(s): [oracle19crac02, oracle19crac03].</font></p>
<h3 id="Workaround-1"><a href="#Workaround-1" class="headerlink" title="Workaround"></a>Workaround</h3><p>参考 INS-06006 GI RunInstaller Fails If OpenSSH Is Upgraded to 8.x (Doc ID 2555697.1)</p>
<p><a href="/blog/assets/pdf/oracle/Document-2555697.1.pdf">Document-2555697.1</a></p>
<p>OpenSSH 8.x 安全机制问题，安装前，添加 <code>scp</code> 选项<code>-T</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Rename the original scp.</span>
<span class="token function">mv</span> /usr/bin/scp /usr/bin/scp.orig
<span class="token comment"># Create a new file &lt;/usr/bin/scp>.</span>
<span class="token function">vi</span> /usr/bin/scp
<span class="token comment"># Add the below line to the new created file &lt;/usr/bin/scp>.</span>
/usr/bin/scp.orig <span class="token parameter variable">-T</span> <span class="token variable">$*</span>
<span class="token comment"># Change the file permission.</span>
<span class="token function">chmod</span> <span class="token number">555</span> /usr/bin/scp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>安装后：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> /usr/bin/scp.orig /usr/bin/scp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="INS-10113"><a href="#INS-10113" class="headerlink" title="INS-10113"></a>INS-10113</h2><p>OUI 在执行拷贝 <code>$GRID_HOME</code> 到其他节点时，出现如下错误：</p>
<p><font color=error>[INS-10113] Installer encountered errors while copying &#x2F;opt&#x2F;grid&#x2F;products&#x2F;19.3.0 to nodes [<node2>, <node3>].</font><br><font color=error>PRCF-2041 : The transfer failed for all nodes</font></p>
<h3 id="Workaround-2"><a href="#Workaround-2" class="headerlink" title="Workaround"></a>Workaround</h3><p>参考 19c [INS-10113] And PRCF-2041 When Installing 3 Nodes RAC (Doc ID 2662954.1)</p>
<p><a href="/blog/assets/pdf/oracle/Document-2662954.1.pdf">Document-2662954.1</a></p>
<p>在启动 OUI 前，设置 <code>SRVM_DISABLE_MTTRANS</code> 变量：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">SRVM_DISABLE_MTTRANS</span><span class="token operator">=</span>true
./gridSetup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>设置完后可能出现如下报错，忽略即可。</p>
<p>[INS-06009] SSH performance is detected to be slow, which may impact performance during remote node operations like copying the software and executing prerequisite checks.</p>
<h2 id="INS-41208"><a href="#INS-41208" class="headerlink" title="INS-41208"></a>INS-41208</h2><p>在 ASM 私有网络验证时，出现如下错误：</p>
<p><font color=error>[INS-41208] None of the available network subnets is marked for use by Oracle Automatic Storage Management (ASM)</p>
<ul>
<li>PRVG-11081 : unable to find the matching networks for the interface “ens256” and the subnet “100.100.100.0” on nodes “oracle19crac03”  </li>
<li>Cause:  Cluster Verification Utility (CVU) connectivity checking determined that the interface-subnet combination was not found on the indicated nodes.  </li>
<li>Action:  Ensure that the interface-subnet combination is installed, is online on the indicated nodes, and retry the node connectivity checks.</font></li>
</ul>
<h3 id="Workaround-3"><a href="#Workaround-3" class="headerlink" title="Workaround"></a>Workaround</h3><p>第三节点的网卡设备名称 <code>ens256</code> 与第一节点和第二节点的网卡设备名 <code>ens224</code> 不一致。<br>修改第三节点的网卡设备名称，可参考<a href="/blog/assets/pdf/linux/How-to-assign-a-specific-network-interface-name-in-RHEL7,8.pdf">How to assign a specific network interface name in RHEL7, 8</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmcli con <span class="token function">add</span> con-name ens224 <span class="token builtin class-name">type</span> ethernet mac <span class="token string">"xx.xx.xx.xx"</span> ifname ens224
nmcli con modify ens224 ipv4.add <span class="token number">100.100</span>.100.103/24 ipv4.method manual autoconnect <span class="token function">yes</span>
nmcli con up ens224
<span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Error-while-restoring-PDB-backup-piece"><a href="#Error-while-restoring-PDB-backup-piece" class="headerlink" title="Error while restoring PDB backup piece"></a>Error while restoring PDB backup piece</h2><p>DBCA 创建数据库时，出现 PDB 数据库无法从备份集中还原</p>
<p><font color=error>[FATAL] Error while restoring PDB backup piece</font></p>
<p>查看 DBCA 日志文件<code>/u01/app/oracle/cfgtoollogs/dbca/coco/trace.log_2023-05-24_10-22-51PM</code>，详细报错如下：</p>
<pre class="line-numbers language-none"><code class="language-none">[progressPage.flowWorker] [2023-05-24 15:36:07.613 CST] [RMANUtil.restorePDBBackUp:1697]  Error while restoring PDB backup piece: echo set off
RMAN&gt; 2&gt; 3&gt; 4&gt; 5&gt;
executing command: SET COMMAND ID
Starting restore at 24-MAY-23
using target database control file instead of recovery catalog
allocated channel: ORA_DISK_1
channel ORA_DISK_1: SID&#x3D;13 device type&#x3D;DISK
channel ORA_DISK_1: starting datafile backup set restore
channel ORA_DISK_1: specifying datafile(s) to restore from backup set
channel ORA_DISK_1: restoring foreign file 00002
channel ORA_DISK_1: restoring foreign file 00004
channel ORA_DISK_1: restoring foreign file 00009
channel ORA_DISK_1: reading from backup piece &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;19.0.0&#x2F;dbhome_1&#x2F;assistants&#x2F;dbca&#x2F;templates&#x2F;pdbseed.dfb
channel ORA_DISK_1: restoring foreign file 2 to +DATA&#x2F;COCO&#x2F;pdbseed&#x2F;system01.dbf
channel ORA_DISK_1: restoring foreign file 4 to +DATA&#x2F;COCO&#x2F;pdbseed&#x2F;sysaux01.dbf
channel ORA_DISK_1: restoring foreign file 9 to +DATA&#x2F;COCO&#x2F;pdbseed&#x2F;undotbs01.dbf
RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
RMAN-00569: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ERROR MESSAGE STACK FOLLOWS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
RMAN-03002: failure of restore command at 05&#x2F;24&#x2F;2023 15:36:07
ORA-19870: error while restoring backup piece &#x2F;u01&#x2F;app&#x2F;oracle&#x2F;product&#x2F;19.0.0&#x2F;dbhome_1&#x2F;assistants&#x2F;dbca&#x2F;templates&#x2F;pdbseed.dfb
ORA-19504: failed to create file &quot;+DATA&#x2F;COCO&#x2F;pdbseed&#x2F;system01.dbf&quot;
ORA-17502: ksfdcre:4 Failed to create file +DATA&#x2F;COCO&#x2F;pdbseed&#x2F;system01.dbf
ORA-15173: entry &#39;pdbseed&#39; does not exist in directory &#39;COCO&#39;
RMAN&gt;

SEVERE: May 24, 2023 3:36:08 PM oracle.install.commons.util.exception.AbstractErrorAdvisor getDetailedMessage
SEVERE: [FATAL] Error while restoring PDB backup piece<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Workaround-4"><a href="#Workaround-4" class="headerlink" title="Workaround"></a>Workaround</h3><p>PDB 数据库创建 BUG，无法自动创建 <code>PDBSEED</code> 和<code>&lt;PDB&gt;</code>数据文件目录，需要手动进行创建</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">asmcmd<span class="token operator">></span> <span class="token builtin class-name">cd</span> +DATA/COCO/
asmcmd<span class="token operator">></span> <span class="token function">mkdir</span> PDBSEED
asmcmd<span class="token operator">></span> <span class="token function">mkdir</span> PDB<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="PRCR-1079"><a href="#PRCR-1079" class="headerlink" title="PRCR-1079"></a>PRCR-1079</h2><p>DBCA 创建数据库，出现数据库无法启动，共享内存段（SGA）分配错误</p>
<p><font color=error>PRCR-1079 : Failed to start resource ora.coco.db<br>CRS-5017: The resource action “ora.coco.db start” encountered the following error:<br>ORA-27125: unable to create shared memory segment</font></p>
<p>查看数据库 <code>alert_&lt;sid&gt;.log</code> 日志文件，详细错误日志如下：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.696916+08:00</span>
<span class="token property">Error:</span> ENOSPC while creating shared memory segment of size <span class="token number">6425673728</span> bytes
Check the system shared memory parameters
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.697766+08:00</span>
<span class="token property">Error:</span> ENOSPC while creating shared memory segment of size <span class="token number">6425673728</span> bytes
Check the system shared memory parameters
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.698456+08:00</span>
<span class="token separator comment">**********************************************************************</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.698751+08:00</span>
Dump of system resources acquired for SHARED GLOBAL AREA <span class="token operator">(</span>SGA<span class="token operator">)</span>

<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.699297+08:00</span>
 Per process system memlock <span class="token operator">(</span>soft<span class="token operator">)</span> limit <span class="token operator">=</span> <span class="token number">7168M</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.699599+08:00</span>
 Expected per process system memlock <span class="token operator">(</span>soft<span class="token operator">)</span> limit to lock
 <span class="token property">instance MAX SHARED GLOBAL AREA (SGA) into memory:</span> <span class="token number">6146M</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.700236+08:00</span>
 <span class="token property">Available system pagesizes:</span>
  <span class="token number">4K</span><span class="token punctuation">,</span> <span class="token number">2048K</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.700836+08:00</span>
 Supported system pagesize<span class="token operator">(</span>s<span class="token operator">)</span><span class="token operator">:</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.701123+08:00</span>
  PAGESIZE  AVAILABLE_PAGES  EXPECTED_PAGES  ALLOCATED_PAGES  <span class="token level error important">ERROR</span><span class="token operator">(</span>s<span class="token operator">)</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.701447+08:00</span>
        <span class="token number">4K</span>       Configured               <span class="token number">9</span>               <span class="token number">0</span>   ORA<span class="token operator">-</span><span class="token number">27125</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.701942+08:00</span>
     <span class="token number">2048K</span>             <span class="token number">3071</span>            <span class="token number">3073</span>               <span class="token number">5</span>   ORA<span class="token operator">-</span><span class="token number">27125</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.702271+08:00</span>
<span class="token property">RECOMMENDATION:</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.702601+08:00</span>
 <span class="token number">1</span><span class="token punctuation">.</span> Configure system with expected number of pages for every
 supported system pagesize prior to the next instance restart operation<span class="token punctuation">.</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.725346+08:00</span>
<span class="token separator comment">**********************************************************************</span>
<span class="token date number">2023-05-24T</span><span class="token time number">13:11:59.747369+08:00</span>
<span class="token property">SGA:</span> Realm creation failed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Workaround-5"><a href="#Workaround-5" class="headerlink" title="Workaround"></a>Workaround</h3><p>共享内存段参数设置错误，导致共享内存段不足，相关参数有 <code>memlock</code>, <code>kernel.shmmax</code>, <code>kernel.shmall</code>, <code>vm.nr_hugepages</code>。<br> 重新配置后，正常启动。</p>
<h2 id="CRS-4535"><a href="#CRS-4535" class="headerlink" title="CRS-4535"></a>CRS-4535</h2><p>安装完 GI 软件，重启服务器后，CRS 服务无法启动</p>
<p><font color=error>CRS-4535: Cannot communicate with Cluster Ready Services<br>CRS-4000: Command Status failed, or completed with errors.</font></p>
<p><code>ora.crsd</code>资源无法联机</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac02 bin<span class="token punctuation">]</span><span class="token comment"># ./crsctl stat res -t -init</span>
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.asm
      <span class="token number">1</span>        ONLINE  OFFLINE                               STABLE
ora.cluster_interconnect.haip
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.crf
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.crsd
      <span class="token number">1</span>        ONLINE  OFFLINE                               STABLE
ora.cssd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.cssdmonitor
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.ctssd
      <span class="token number">1</span>        ONLINE  OFFLINE                               STABLE
ora.diskmon
      <span class="token number">1</span>        OFFLINE OFFLINE                               STABLE
ora.evmd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.gipcd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.gpnpd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.mdnsd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.storage
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
--------------------------------------------------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Workaround-6"><a href="#Workaround-6" class="headerlink" title="Workaround"></a>Workaround</h3><p>手动启动 <code>ora.crsd</code> 资源</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac02 bin<span class="token punctuation">]</span><span class="token comment"># ./crsctl start res ora.crsd -init</span>
CRS-2672: Attempting to start <span class="token string">'ora.ctssd'</span> on <span class="token string">'oracle19crac02'</span>
CRS-2676: Start of <span class="token string">'ora.ctssd'</span> on <span class="token string">'oracle19crac02'</span> succeeded
CRS-2672: Attempting to start <span class="token string">'ora.asm'</span> on <span class="token string">'oracle19crac02'</span>
CRS-2672: Attempting to start <span class="token string">'ora.crsd'</span> on <span class="token string">'oracle19crac02'</span>
CRS-2676: Start of <span class="token string">'ora.asm'</span> on <span class="token string">'oracle19crac02'</span> succeeded
CRS-2676: Start of <span class="token string">'ora.crsd'</span> on <span class="token string">'oracle19crac02'</span> succeeded<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>重新查看状态</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac02 bin<span class="token punctuation">]</span><span class="token comment"># ./crsctl stat res -t -init</span>
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.asm
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.cluster_interconnect.haip
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.crf
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.crsd
      <span class="token number">1</span>        ONLINE  INTERMEDIATE oracle19crac02           STABLE
ora.cssd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.cssdmonitor
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.ctssd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           ACTIVE:-8600,STABLE
ora.diskmon
      <span class="token number">1</span>        OFFLINE OFFLINE                               STABLE
ora.evmd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.gipcd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.gpnpd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.mdnsd
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.storage
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
--------------------------------------------------------------------------------

<span class="token punctuation">[</span>root@oracle19crac02 bin<span class="token punctuation">]</span><span class="token comment"># ./crsctl stat res -t</span>
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.LISTENER.lsnr
               ONLINE  ONLINE       oracle19crac01           STABLE
               ONLINE  ONLINE       oracle19crac02           STABLE
               ONLINE  ONLINE       oracle19crac03           STABLE
ora.chad
               ONLINE  ONLINE       oracle19crac01           STABLE
               ONLINE  ONLINE       oracle19crac02           STABLE
               ONLINE  ONLINE       oracle19crac03           STABLE
ora.net1.network
               ONLINE  ONLINE       oracle19crac01           STABLE
               ONLINE  ONLINE       oracle19crac02           STABLE
               ONLINE  ONLINE       oracle19crac03           STABLE
ora.ons
               ONLINE  ONLINE       oracle19crac01           STABLE
               ONLINE  ONLINE       oracle19crac02           STABLE
               ONLINE  ONLINE       oracle19crac03           STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.ARCH.dg<span class="token punctuation">(</span>ora.asmgroup<span class="token punctuation">)</span>
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           STABLE
      <span class="token number">2</span>        ONLINE  ONLINE       oracle19crac02           STABLE
      <span class="token number">3</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.ASMNET1LSNR_ASM.lsnr<span class="token punctuation">(</span>ora.asmgroup<span class="token punctuation">)</span>
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           STABLE
      <span class="token number">2</span>        ONLINE  ONLINE       oracle19crac02           STABLE
      <span class="token number">3</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.DATA.dg<span class="token punctuation">(</span>ora.asmgroup<span class="token punctuation">)</span>
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           STABLE
      <span class="token number">2</span>        ONLINE  ONLINE       oracle19crac02           STABLE
      <span class="token number">3</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.LISTENER_SCAN1.lsnr
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.MGMT.dg<span class="token punctuation">(</span>ora.asmgroup<span class="token punctuation">)</span>
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           STABLE
      <span class="token number">2</span>        ONLINE  ONLINE       oracle19crac02           STABLE
      <span class="token number">3</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.MGMTLSNR
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac03           <span class="token number">169.254</span>.10.67 <span class="token number">100.10</span>
                                                             <span class="token number">0.100</span>.103,STABLE
ora.OCR.dg<span class="token punctuation">(</span>ora.asmgroup<span class="token punctuation">)</span>
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           STABLE
      <span class="token number">2</span>        ONLINE  ONLINE       oracle19crac02           STABLE
      <span class="token number">3</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.asm<span class="token punctuation">(</span>ora.asmgroup<span class="token punctuation">)</span>
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           Started,STABLE
      <span class="token number">2</span>        ONLINE  ONLINE       oracle19crac02           Started,STABLE
      <span class="token number">3</span>        ONLINE  ONLINE       oracle19crac03           Started,STABLE
ora.asmnet1.asmnetwork<span class="token punctuation">(</span>ora.asmgroup<span class="token punctuation">)</span>
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           STABLE
      <span class="token number">2</span>        ONLINE  ONLINE       oracle19crac02           STABLE
      <span class="token number">3</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.cvu
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.mgmtdb
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac03           Open,STABLE
ora.oracle19crac01.vip
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac01           STABLE
ora.oracle19crac02.vip
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac02           STABLE
ora.oracle19crac03.vip
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.qosmserver
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac03           STABLE
ora.scan1.vip
      <span class="token number">1</span>        ONLINE  ONLINE       oracle19crac03           STABLE
--------------------------------------------------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="OPATCHAUTO-72030"><a href="#OPATCHAUTO-72030" class="headerlink" title="OPATCHAUTO-72030"></a>OPATCHAUTO-72030</h1><p>opatchauto failed.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/34130714 -analyze</span>
OPatchauto session is initiated at Tue May <span class="token number">23</span> <span class="token number">23</span>:22:37 <span class="token number">2023</span>

System initialization log <span class="token function">file</span> is /u01/app/19.0.0/grid/cfgtoollogs/opatchautodb/systemconfig2023-05-23_11-22-43PM.log.

Session log <span class="token function">file</span> is /u01/app/19.0.0/grid/cfgtoollogs/opatchauto/opatchauto2023-05-23_11-23-02PM.log
The <span class="token function">id</span> <span class="token keyword">for</span> this session is QDHA
Shared home /u01/app/19.0.0/grid can only be patched <span class="token keyword">in</span> nonrolling mode.

OPATCHAUTO-72030: Execution mode invalid.
OPATCHAUTO-72030: Cannot execute <span class="token keyword">in</span> rolling mode, as CRS home is shared.
OPATCHAUTO-72030: Execute <span class="token keyword">in</span> non-rolling mode.
OPatchAuto failed.

OPatchauto session completed at Tue May <span class="token number">23</span> <span class="token number">23</span>:23:32 <span class="token number">2023</span>
Time taken to complete the session <span class="token number">0</span> minute, <span class="token number">55</span> seconds

opatchauto failed with error code <span class="token number">42</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>found errors in System initialization log file <code>/u01/app/19.0.0/grid/cfgtoollogs/opatchautodb/systemconfig2023-05-23_11-17-19PM.log</code>.</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token date number">2023-05-23</span> <span class="token time number">23:17:39,695</span> <span class="token level warning important">WARNING</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> oracle<span class="token punctuation">.</span>dbsysmodel<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span>util<span class="token punctuation">.</span>OsysUtility <span class="token operator">-</span> Failed<span class="token operator">:</span>
Verifying <span class="token string">'/tmp/'</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>FAILED <span class="token operator">(</span>PRVG<span class="token operator">-</span><span class="token number">1901</span><span class="token operator">)</span>

Verification of shared storage accessibility was unsuccessful on all the specified nodes<span class="token punctuation">.</span>
NODE_STATUS<span class="token operator">:</span><span class="token operator">:</span>oracle19crac01<span class="token operator">:</span>EFAIL
The result of cluvfy command contain EFAIL NODE_STATUS<span class="token operator">:</span><span class="token operator">:</span>oracle19crac01<span class="token operator">:</span>EFAIL
<span class="token date number">2023-05-23</span> <span class="token time number">23:17:39,697</span> <span class="token level error important">SEVERE</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> com<span class="token punctuation">.</span>oracle<span class="token punctuation">.</span>glcm<span class="token punctuation">.</span>patch<span class="token punctuation">.</span>auto<span class="token punctuation">.</span>db<span class="token punctuation">.</span>integration<span class="token punctuation">.</span>model<span class="token punctuation">.</span>productsupport<span class="token punctuation">.</span>topology<span class="token punctuation">.</span>TopologyCreator <span class="token operator">-</span> Stacktrace <span class="token operator">:</span><span class="token operator">:</span> <span class="token domain constant">oracle.dbsysmodel.driver.sdk.prod</span>
<span class="token property">uctdriver.ProductDriverException:</span> Unable to determine if <span class="token string">"/u01/app/19.0.0/grid"</span> is a shared oracle home<span class="token punctuation">.</span>
<span class="token property">Failed:</span>
Verifying <span class="token string">'/tmp/'</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>FAILED <span class="token operator">(</span>PRVG<span class="token operator">-</span><span class="token number">1901</span><span class="token operator">)</span>

Verification of shared storage accessibility was unsuccessful on all the specified nodes<span class="token punctuation">.</span>
NODE_STATUS<span class="token operator">:</span><span class="token operator">:</span>oracle19crac01<span class="token operator">:</span>EFAIL
The result of cluvfy command contain EFAIL NODE_STATUS<span class="token operator">:</span><span class="token operator">:</span>oracle19crac01<span class="token operator">:</span>EFAIL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Workaround-7"><a href="#Workaround-7" class="headerlink" title="Workaround"></a>Workaround</h3><p>Since 19c(19.3) is already released a while ago, It does not contain Pre-req checks specific to OL&#x2F;RHEL 8.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># export CV_ASSUME_DISTID=OEL7</span>
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/34130714 -analyze</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>makefile ins_emagent.mk fails</title>
    <url>/blog/posts/7453db1b.html</url>
    <content><![CDATA[<h1 id="makefile-ins-emagent-mk-fails"><a href="#makefile-ins-emagent-mk-fails" class="headerlink" title="makefile ins_emagent.mk fails"></a>makefile ins_emagent.mk fails</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9<br>Oracle Database - Enterprise Edition - Version 11.2<br>Oracle Grid Infrastructure - Version 11.2</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p> 安装 database 软件时，出现如下报错：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token level info keyword">INFO</span><span class="token operator">:</span> make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token separator comment">***</span> <span class="token punctuation">[</span><span class="token file-path string">/u01/app/oracle/product/11.2.0.4/db_1/sysman/lib/emdctl</span><span class="token punctuation">]</span> Error <span class="token number">1</span>
<span class="token property">make:</span> <span class="token separator comment">***</span> <span class="token punctuation">[</span>emdctl<span class="token punctuation">]</span> Error <span class="token number">2</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span> End output from spawned process<span class="token punctuation">.</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span> <span class="token separator comment">----------------------------------</span>
<span class="token level info keyword">INFO</span><span class="token operator">:</span> Exception thrown from action<span class="token operator">:</span> make
<span class="token property">Exception Name:</span> MakefileException
<span class="token property">Exception String:</span> Error in invoking target <span class="token string">'agent nmhs'</span> of makefile <span class="token string">'/u01/app/oracle/product/11.2.0.4/db_1/sysman/lib/ins_emagent.mk'</span><span class="token punctuation">.</span> 
See <span class="token string">'/u01/app/oraInventory/logs/installActions2019-12-19_07-13-02PM.log'</span> for details<span class="token punctuation">.</span>
<span class="token property">Exception Severity:</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p> 备份 makefile</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk <span class="token variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk.bak<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 编辑 $ORACLE_HOME&#x2F;sysman&#x2F;lib&#x2F;ins_emagent.mk, 查找下面内容 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#===========================</span>
<span class="token comment">#  emdctl</span>
<span class="token comment">#===========================</span>

<span class="token variable"><span class="token variable">$(</span>SYSMANBIN<span class="token variable">)</span></span>emdctl:
        <span class="token variable"><span class="token variable">$(</span>MK_EMAGENT_NMECTL<span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Then append the line with <strong>-lnnz11</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#===========================</span>
<span class="token comment">#  emdctl</span>
<span class="token comment">#===========================</span>

<span class="token variable"><span class="token variable">$(</span>SYSMANBIN<span class="token variable">)</span></span>emdctl:
        <span class="token variable"><span class="token variable">$(</span>MK_EMAGENT_NMECTL<span class="token variable">)</span></span> <span class="token parameter variable">-lnnz11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Use following command to modify.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s|$(MK_EMAGENT_NMECTL)|$(MK_EMAGENT_NMECTL) -lnnz11|'</span> <span class="token variable">$ORACLE_HOME</span>/sysman/lib/ins_emagent.mk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00600 6856</title>
    <url>/blog/posts/b3855024.html</url>
    <content><![CDATA[<h1 id="ORA-00600-6856"><a href="#ORA-00600-6856" class="headerlink" title="ORA-00600 6856"></a>ORA-00600 6856</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Oracle Database - Enterprise Edition - Version 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>数据库异常宕机重新启动后，实例自动关闭无法拉起，告警日志 <code>alert_orcl.log</code> 出现以下错误：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log">time<span class="token operator">=</span><span class="token string">'2022-01-15T17:37:25.255 08:00'</span> org_id<span class="token operator">=</span><span class="token string">'oracle'</span> comp_id<span class="token operator">=</span><span class="token string">'rdbms'</span>type<span class="token operator">=</span><span class="token string">'UNKNOWN'</span> level<span class="token operator">=</span><span class="token string">'16'</span> host_id<span class="token operator">=</span><span class="token string">'localhost.localdomain'</span>host_addr<span class="token operator">=</span><span class="token string">'::1'</span> pid<span class="token operator">=</span><span class="token string">'53213'</span>
ORACLE Instance xxxxx <span class="token operator">(</span>pid <span class="token operator">=</span> <span class="token number">25</span><span class="token operator">)</span> <span class="token operator">-</span> Error <span class="token number">607</span> encountered while recovering transaction <span class="token operator">(</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token operator">)</span> on object <span class="token number">5341044</span><span class="token punctuation">.</span>

time<span class="token operator">=</span><span class="token string">'2022-01-15T17:37:25.255+08:00'</span> org_id<span class="token operator">=</span><span class="token string">'oracle'</span> comp_id<span class="token operator">=</span><span class="token string">'rdbms'</span>type<span class="token operator">=</span><span class="token string">'UNKNOWN'</span> level<span class="token operator">=</span><span class="token string">'16'</span> host_id<span class="token operator">=</span><span class="token string">'localhost.localdomain'</span>host_addr<span class="token operator">=</span><span class="token string">'::1'</span> pid<span class="token operator">=</span><span class="token string">'53213'</span>
Errors in file <span class="token file-path string">/u01/app/oracle/diag/rdbms/xxxxx/xxxxx/trace/xxxxx_smon_53213.trc</span><span class="token operator">:</span>
<span class="token property">ORA-00607:</span> Internal error occurred while making a change to a data block
<span class="token property">ORA-00600:</span> internal error code<span class="token punctuation">,</span> arguments<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">6856</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

time<span class="token operator">=</span><span class="token string">'2022-01-15T17:37:34.483+08:00'</span> org_id<span class="token operator">=</span><span class="token string">'oracle'</span> comp_id<span class="token operator">=</span><span class="token string">'rdbms'</span>type<span class="token operator">=</span><span class="token string">'UNKNOWN'</span> level<span class="token operator">=</span><span class="token string">'16'</span> host_id<span class="token operator">=</span><span class="token string">'localhost.localdomain'</span>host_addr<span class="token operator">=</span><span class="token string">'::1'</span> pid<span class="token operator">=</span><span class="token string">'53165'</span>
<span class="token property">Instance Critical Process (pid:</span> <span class="token number">25</span><span class="token punctuation">,</span> ospid<span class="token operator">:</span> <span class="token number">53213</span><span class="token punctuation">,</span> SMON<span class="token operator">)</span> died unexpectedly

time<span class="token operator">=</span><span class="token string">'2022-01-15T17:37:34.526+08:00'</span> org_id<span class="token operator">=</span><span class="token string">'oracle'</span> comp_id<span class="token operator">=</span><span class="token string">'rdbms'</span>type<span class="token operator">=</span><span class="token string">'UNKNOWN'</span> level<span class="token operator">=</span><span class="token string">'16'</span> host_id<span class="token operator">=</span><span class="token string">'localhost.localdomain'</span>host_addr<span class="token operator">=</span><span class="token string">'::1'</span> pid<span class="token operator">=</span><span class="token string">'53165'</span>
<span class="token property">PMON (ospid:</span> <span class="token number">53165</span><span class="token operator">)</span><span class="token operator">:</span> terminating the instance due to error <span class="token number">474</span>

数据库实例在恢复 <span class="token number">5341044</span> 对象的事务时异常，导致 SMON 进程退出。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CASE"><a href="#CASE" class="headerlink" title="CASE"></a>CASE</h2><ul>
<li>ORA-600 [6006] ORA-600 [6856] During Startup Instance, Followed by Termination by SMON (Doc ID 549000.1)</li>
</ul>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>生成 pfile 文件，并添加禁止 smon 恢复事务的 event</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">create <span class="token assign-left variable">pfile</span><span class="token operator">=</span>’/tmp/pfile01.ora’ from spfile<span class="token punctuation">;</span>

<span class="token builtin class-name">echo</span> <span class="token string">'*.event="10513 trace name context forever, level 2"'</span> <span class="token operator">>></span> /tmp/pfile01.ora<span aria-hidden="true"class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>用修改后的 pfile 拉起实例，确认 smon 恢复事务的对象</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">startup <span class="token assign-left variable">pfile</span><span class="token operator">=</span>’/tmp/pfile01.ora’<span class="token punctuation">;</span>

<span class="token keyword">select</span> object_id, data_object_id, owner, object_name from dba_objects where object_id <span class="token operator">=</span> <span class="token number">5341044</span> or <span class="token assign-left variable">data_object_id</span><span class="token operator">=</span><span class="token number">5341044</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>删除对象，清空回收站经客户确认，对象为 5341044 的表数据从其他库中抽取了，此表可以删除</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">drop table xxxxx<span class="token punctuation">;</span>
purge dba_recyclebin<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>关闭数据库用原 spfile 文件起动数据库</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">shutdown</span> immediate
startup
<span class="token keyword">select</span> * from <span class="token function">v</span><span class="token variable">$recover_file</span><span class="token punctuation">;</span>
alter system switch logfile<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-00845</title>
    <url>/blog/posts/3f84873d.html</url>
    <content><![CDATA[<h1 id="ORA-00845"><a href="#ORA-00845" class="headerlink" title="ORA-00845"></a>ORA-00845</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Oracle Database - Enterprise Edition - Version 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>数据库启动后，<code>alert_orcl.log</code>日志文件出现如下报错：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token level warning important">WARNING</span><span class="token operator">:</span> You are trying to use the MEMORY_TARGET feature<span class="token punctuation">.</span> This feature requires the <span class="token file-path string">/dev/shm</span> file system to be mounted for at least <span class="token number">830472192</span> bytes<span class="token punctuation">.</span> <span class="token file-path string">/dev/shm</span> is either not mounted or is mounted with available space less than this size<span class="token punctuation">.</span> Please fix this so that MEMORY_TARGET can work as expected<span class="token punctuation">.</span> Current available is <span class="token number">453869568</span> and used is <span class="token number">55934976</span> bytes<span class="token punctuation">.</span> Ensure that the mount point is <span class="token file-path string">/dev/shm</span> for this directory<span class="token punctuation">.</span> memory_target needs larger <span class="token file-path string">/dev/shm.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>系统 <code>/dev/shm</code> 空间不足。</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mount</span> <span class="token parameter variable">-t</span> tmpfs shmfs <span class="token parameter variable">-o</span> <span class="token assign-left variable">size</span><span class="token operator">=</span>1g /dev/shm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改 &#x2F;etc&#x2F;fstab</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"shmfs /dev/shm tmpfs size=1g 0 0"</span> <span class="token operator">>></span> /etc/fstab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-01152</title>
    <url>/blog/posts/f967f35.html</url>
    <content><![CDATA[<h1 id="ORA-01152"><a href="#ORA-01152" class="headerlink" title="ORA-01152"></a>ORA-01152</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Oracle Database - Enterprise Edition - Version 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p> 在用 rman 恢复数据库时当执行到将数据库 open 阶段遇到 ORA-01152 错误 </p>
<p>[RMAN&gt; alter database open;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00569: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ERROR MESSAGE STACK FOLLOWS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-03002: failure of alter db command at 03&#x2F;05&#x2F;2013 14:34:16<br>ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</p>
<p>RMAN&gt; alter database open resetlogs;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00569: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; ERROR MESSAGE STACK FOLLOWS &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-00571: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<br>RMAN-03002: failure of alter db command at 03&#x2F;05&#x2F;2013 14:34:37<br>ORA-01152: file 1 was not restored from a sufficiently old backup<br>ORA-01110: data file 1: ‘&#x2F;oracle&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;oradata&#x2F;orcl&#x2F;system01.dbf’]{.red}</p>
<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p> 这是由于 controlfile 里记录的 SCN 与 datafile 里的不一致导致。比如通过 restore 出来的 controlfile 的 SCN 比 datafile 记录的要小。解决方法有两条：</p>
<ol>
<li> 以 datafile 的 SCN 为准，将 controlfile 恢复到与其一致，此时就会报 ORA-01152 的错误，然后我们通过 recover database，进而利用归档日志来完成 controlfile 和 datafile 的 SCN 一致，归档找不到再去利用 redolog 来恢复。</li>
<li> 通过更改内置参数跳过一致性的检查启动数据库，不过可能发生 ORA-00600[2662] 错误。</li>
</ol>
<h2 id="SULUTION-1：手动利用归档恢复数据库"><a href="#SULUTION-1：手动利用归档恢复数据库" class="headerlink" title="SULUTION 1：手动利用归档恢复数据库"></a>SULUTION 1：手动利用归档恢复数据库 </h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SQL<span class="token operator">></span> recover database<span class="token punctuation">;</span>
ORA-00283: recovery session canceled due to errors
ORA-01610: recovery using the BACKUP CONTROLFILE option must be <span class="token keyword">done</span>


SQL<span class="token operator">></span> recover database using backup controlfile<span class="token punctuation">;</span>
ORA-00279: change <span class="token number">5634731</span> generated at 03/05/2013 <span class="token number">14</span>:23:36 needed <span class="token keyword">for</span> thread <span class="token number">1</span>
ORA-00289: suggestion <span class="token builtin class-name">:</span>
/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf
ORA-00280: change <span class="token number">5634731</span> <span class="token keyword">for</span> thread <span class="token number">1</span> is <span class="token keyword">in</span> sequence <span class="token comment">#315</span>
Specify log: <span class="token punctuation">&#123;</span><span class="token operator">=</span>suggested <span class="token operator">|</span> filename <span class="token operator">|</span> AUTO <span class="token operator">|</span> CANCEL<span class="token punctuation">&#125;</span>
Auto

ORA-00308: cannot <span class="token function">open</span> archived log
<span class="token string">'/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf'</span>
ORA-27037: unable to obtain <span class="token function">file</span> status
Linux-x86_64 Error: <span class="token number">2</span>: No such <span class="token function">file</span> or directory
Additional information: <span class="token number">3</span>

ORA-00308: cannot <span class="token function">open</span> archived log
<span class="token string">'/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf'</span>
ORA-27037: unable to obtain <span class="token function">file</span> status
Linux-x86_64 Error: <span class="token number">2</span>: No such <span class="token function">file</span> or directory
Additional information: <span class="token number">3</span>

-- 此时找不到 1_315_796990179.dbf 这个归档文件，其实是在 redolog 中，手动指定 redo 路径

SQL<span class="token operator">></span> recover database using backup controlfile<span class="token punctuation">;</span>
ORA-00279: change <span class="token number">5634731</span> generated at 03/05/2013 <span class="token number">14</span>:23:36 needed <span class="token keyword">for</span> thread <span class="token number">1</span>
ORA-00289: suggestion <span class="token builtin class-name">:</span>
/oracle/u01/app/oracle/oradata/orcl/archive/1_315_796990179.dbf
ORA-00280: change <span class="token number">5634731</span> <span class="token keyword">for</span> thread <span class="token number">1</span> is <span class="token keyword">in</span> sequence <span class="token comment">#315</span>

Specify log: <span class="token punctuation">&#123;</span><span class="token operator">=</span>suggested <span class="token operator">|</span> filename <span class="token operator">|</span> AUTO <span class="token operator">|</span> CANCEL<span class="token punctuation">&#125;</span>
/oracle/u01/app/oracle/oradata/orcl/redo01.log
Log applied.
Media recovery complete.

-- 此时恢复完成，应用完所有归档，并重新应用了 redolog，启动数据库到 open 状态
SQL<span class="token operator">></span>alter database <span class="token function">open</span> resetlogs<span class="token punctuation">;</span>
Database altered.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SOLUTION-2：利用 RMAN 自动利用归档恢复数据库"><a href="#SOLUTION-2：利用 RMAN 自动利用归档恢复数据库" class="headerlink" title="SOLUTION 2：利用 RMAN 自动利用归档恢复数据库"></a>SOLUTION 2：利用 RMAN 自动利用归档恢复数据库 </h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">RMAN<span class="token operator">></span> recover database<span class="token punctuation">;</span>

Starting recover at 05-MAR-13
Starting implicit crosscheck backup at 05-MAR-13
allocated channel: ORA_DISK_1
channel ORA_DISK_1: <span class="token assign-left variable">sid</span><span class="token operator">=</span><span class="token number">540</span> <span class="token assign-left variable">devtype</span><span class="token operator">=</span>DISK
Finished implicit crosscheck backup at 05-MAR-13

Starting implicit crosscheck copy at 05-MAR-13
using channel ORA_DISK_1
Crosschecked <span class="token number">2</span> objects
Finished implicit crosscheck copy at 05-MAR-13

searching <span class="token keyword">for</span> all files <span class="token keyword">in</span> the recovery area
cataloging files<span class="token punctuation">..</span>.
cataloging <span class="token keyword">done</span>

List of Cataloged Files
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
File Name: /oracle/u01/app/oracle/flash_recovery_area/ORCL/backupset/2013_03_05/o1_mf_ncnnf_TAG20130305T144504_8mc53kcr_.bkp
using channel ORA_DISK_1 
starting media recovery
archive log thread <span class="token number">1</span> sequence <span class="token number">1</span> is already on disk as <span class="token function">file</span> /oracle/u01/app/oracle/oradata/orcl/redo01.log
archive log <span class="token assign-left variable">filename</span><span class="token operator">=</span>/oracle/u01/app/oracle/oradata/orcl/redo01.log <span class="token assign-left variable">thread</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">sequence</span><span class="token operator">=</span><span class="token number">1</span>
media recovery complete, elapsed time: 00:00:01
Finished recover at 05-MAR-13

-- 此时恢复完成，启动数据库到 open 状态
RMAN<span class="token operator">></span> alter database <span class="token function">open</span> resetlogs<span class="token punctuation">;</span>
database opened<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SOLUTION-3：更改内置参数"><a href="#SOLUTION-3：更改内置参数" class="headerlink" title="SOLUTION 3：更改内置参数"></a>SOLUTION 3：更改内置参数 </h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">RMAN<span class="token operator">></span> alter database <span class="token function">open</span> resetlogs<span class="token punctuation">;</span> 
RMAN-00571: <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
RMAN-00569: <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> ERROR MESSAGE STACK FOLLOWS <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
RMAN-00571: <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
RMAN-03002: failure of alter db <span class="token builtin class-name">command</span> at 03/05/2013 <span class="token number">14</span>:56:41
ORA-01152: <span class="token function">file</span> <span class="token number">1</span> was not restored from a sufficiently old backup
ORA-01110: data <span class="token function">file</span> <span class="token number">1</span>: <span class="token string">'/oracle/u01/app/oracle/oradata/orcl/system01.dbf'</span>

-- 重启数据库
SQL<span class="token operator">></span> startup force<span class="token punctuation">;</span>
ORA-32004: obsolete and/or deprecated parameter<span class="token punctuation">(</span>s<span class="token punctuation">)</span> specified
ORACLE instance started.
Total System Global Area <span class="token number">1224736768</span> bytes
Fixed Size                  <span class="token number">2020384</span> bytes
Variable Size             <span class="token number">352324576</span> bytes
Database Buffers          <span class="token number">855638016</span> bytes
Redo Buffers               <span class="token number">14753792</span> bytes
Database mounted.
ORA-01589: must use RESETLOGS or NORESETLOGS option <span class="token keyword">for</span> database <span class="token function">open</span>

-- 更改参数
SQL<span class="token operator">></span> alter system <span class="token builtin class-name">set</span> <span class="token string">"_allow_resetlogs_corruption"</span><span class="token operator">=</span>true <span class="token assign-left variable">scope</span><span class="token operator">=</span>spfile<span class="token punctuation">;</span>
System altered.

-- 恢复数据库
SQL<span class="token operator">></span> recover database using backup controlfile <span class="token keyword">until</span> cancel<span class="token punctuation">;</span>
ORA-00279: change <span class="token number">5638424</span> generated at 03/05/2013 <span class="token number">14</span>:48:17 needed <span class="token keyword">for</span> thread <span class="token number">1</span>
ORA-00289: suggestion <span class="token builtin class-name">:</span>
/oracle/u01/app/oracle/oradata/orcl/archive/1_1_809275697.dbf
ORA-00280: change <span class="token number">5638424</span> <span class="token keyword">for</span> thread <span class="token number">1</span> is <span class="token keyword">in</span> sequence <span class="token comment">#1</span>
Specify log: <span class="token punctuation">&#123;</span><span class="token operator">=</span>suggested <span class="token operator">|</span> filename <span class="token operator">|</span> AUTO <span class="token operator">|</span> CANCEL<span class="token punctuation">&#125;</span>
cancel                          ---- 这里选择了取消

ORA-01547: warning: RECOVER succeeded but OPEN RESETLOGS would get error below
ORA-01152: <span class="token function">file</span> <span class="token number">1</span> was not restored from a sufficiently old backup
ORA-01110: data <span class="token function">file</span> <span class="token number">1</span>: <span class="token string">'/oracle/u01/app/oracle/oradata/orcl/system01.dbf'</span>
ORA-01112: media recovery not started

SQL<span class="token operator">></span> alter database <span class="token function">open</span> resetlogs<span class="token punctuation">;</span>
alter database <span class="token function">open</span> resetlogs
*
ERROR at line <span class="token number">1</span>:
ORA-01092: ORACLE instance terminated. Disconnection forced

SQL<span class="token operator">></span> startup force<span class="token punctuation">;</span>
ORA-32004: obsolete and/or deprecated parameter<span class="token punctuation">(</span>s<span class="token punctuation">)</span> specified
ORACLE instance started.
Total System Global Area <span class="token number">1224736768</span> bytes
Fixed Size                  <span class="token number">2020384</span> bytes
Variable Size             <span class="token number">352324576</span> bytes
Database Buffers          <span class="token number">855638016</span> bytes
Redo Buffers               <span class="token number">14753792</span> bytes
Database mounted.
Database opened.

-- 将内置参数改回来
SQL<span class="token operator">></span> alter system <span class="token builtin class-name">set</span> <span class="token string">"_allow_resetlogs_corruption"</span><span class="token operator">=</span>false <span class="token assign-left variable">scope</span><span class="token operator">=</span>spfile<span class="token punctuation">;</span>
System altered.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-12547</title>
    <url>/blog/posts/4e3b9479.html</url>
    <content><![CDATA[<h1 id="ORA-12547"><a href="#ORA-12547" class="headerlink" title="ORA-12547"></a>ORA-12547</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9<br>Oracle Database - Enterprise Edition - Version 11.2.0.4.0<br>Oracle Grid Infrastructure - Version 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p><code>dbca</code> 建库时，弹出 ORA-12547 报错。</p>
<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p> 操作系统缺少 baio 依赖包。</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p> 安装完后，重新执行 dbca 建库。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle ~<span class="token punctuation">]</span>$ yum <span class="token parameter variable">-y</span> <span class="token function">install</span> baio
<span class="token punctuation">[</span>root@oracle ~<span class="token punctuation">]</span>$ <span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span> <span class="token function">grep</span> baio
libaio-devel-0.3.109-13.el7.x86_64
libaio-0.3.109-13.el7.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-15274 Not enough failgroups (3) to create voting files</title>
    <url>/blog/posts/93568fe7.html</url>
    <content><![CDATA[<h1 id="ORA-15274-Not-enough-failgroups-3-to-create-voting-files"><a href="#ORA-15274-Not-enough-failgroups-3-to-create-voting-files" class="headerlink" title="ORA-15274 Not enough failgroups (3) to create voting files"></a>ORA-15274 Not enough failgroups (3) to create voting files</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9<br>Oracle Database - Enterprise Edition - Version 11.2.0.3.0<br>Oracle Grid Infrastructure - Version 11.2.0.3.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>安装 GI 软件，节点 1 执行 <code>root.sh</code> 时，出现如下错误：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token property">clscfg:</span> <span class="token operator">-</span>install mode specified
Successfully accumulated necessary OCR keys<span class="token punctuation">.</span>
Creating OCR keys for user <span class="token string">'root'</span><span class="token punctuation">,</span> privgrp <span class="token string">'root'</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Operation successful<span class="token punctuation">.</span>
Failed to create voting files on disk group OCR<span class="token punctuation">.</span>
Change to configuration failed<span class="token punctuation">,</span> but was successfully rolled back<span class="token punctuation">.</span>
<span class="token property">CRS-4000:</span> Command Replace failed<span class="token punctuation">,</span> or completed with errors<span class="token punctuation">.</span>
Voting file add failed
Failed to add voting disks at <span class="token file-path string">/u01/app/11.2.0/grid/crs/install/crsconfig_lib.pm</span> line <span class="token number">6780</span><span class="token punctuation">.</span>
<span class="token file-path string">/u01/app/11.2.0/grid/perl/bin/perl</span> <span class="token operator">-</span>I<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span><span class="token number">11.2.0</span><span class="token operator">/</span>grid<span class="token operator">/</span>perl<span class="token operator">/</span>lib <span class="token operator">-</span>I<span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span><span class="token number">11.2.0</span><span class="token operator">/</span>grid<span class="token operator">/</span>crs<span class="token operator">/</span>install <span class="token file-path string">/u01/app/11.2.0/grid/crs/install/rootcrs.pl</span> execution failed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看 <code>/u01/app/grid/diag/asm/+asm/+ASM1/trace/alert_+ASM1.log</code> 日志：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token date number">Mon Jun 05</span> <span class="token time number">17:42:48</span> <span class="token number">2023</span>
<span class="token property">NOTE:</span> <span class="token property">updated gpnp profile ASM diskstring:</span> o<span class="token operator">/</span><span class="token number">100.100.100</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">/</span><span class="token operator">*</span>
<span class="token date number">Mon Jun 05</span> <span class="token time number">17:42:48</span> <span class="token number">2023</span>
<span class="token property">NOTE:</span> Creating voting files in diskgroup OCR
<span class="token date number">Mon Jun 05</span> <span class="token time number">17:42:58</span> <span class="token number">2023</span>
<span class="token property">NOTE:</span> Voting File refresh pending for group <span class="token number">1</span><span class="token operator">/</span><span class="token number">0xbdcf9e4b</span> <span class="token operator">(</span>OCR<span class="token operator">)</span>
<span class="token date number">Mon Jun 05</span> <span class="token time number">17:42:58</span> <span class="token number">2023</span>
<span class="token property">NOTE:</span> Attempting voting file creation in diskgroup OCR
<span class="token property">NOTE:</span> voting file allocation on grp <span class="token number">1</span> disk OCR_CD_DISK01_EXACELL01
<span class="token property">NOTE:</span> voting file allocation on grp <span class="token number">1</span> disk OCR_CD_DISK01_EXACELL02
<span class="token level error important">ERROR</span><span class="token operator">:</span> Voting file allocation failed for group OCR
Errors in file <span class="token file-path string">/u01/app/grid/diag/asm/+asm/+ASM1/trace/+ASM1_ora_24662.trc</span><span class="token operator">:</span>
<span class="token property">ORA-15274:</span> Not enough failgroups <span class="token operator">(</span><span class="token number">3</span><span class="token operator">)</span> to create voting files
<span class="token property">NOTE:</span> Attempting voting file refresh on diskgroup OCR
<span class="token property">NOTE:</span> Voting file relocation is required in diskgroup OCR
<span class="token property">NOTE:</span> Attempting voting file relocation on diskgroup OCR
<span class="token property">NOTE:</span> voting file deletion on grp <span class="token number">1</span> disk OCR_CD_DISK01_EXACELL01
<span class="token property">NOTE:</span> voting file deletion on grp <span class="token number">1</span> disk OCR_CD_DISK01_EXACELL02
<span class="token date number">Mon Jun 05</span> <span class="token time number">20:47:05</span> <span class="token number">2023</span>
<span class="token property">NOTE:</span> <span class="token punctuation">[</span>ocrcheck<span class="token punctuation">.</span>bin<span class="token operator">@</span>exadb01 <span class="token operator">(</span>TNS <span class="token number">V1</span><span class="token operator">-</span><span class="token number">V3</span><span class="token operator">)</span> <span class="token number">3827</span><span class="token punctuation">]</span> opening OCR file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>存放 voting file 的 diskgroup 必须满足下面的要求:</p>
<ul>
<li>如果 diskgroup 是 normal redundant，那么要求有 3 个 failure group 才能存放 vote disk。</li>
<li>如果 diskgroup 是 high redundant，那么要求有 5 个 failure group 才能存放 vote disk。</li>
</ul>
<p>当前 OCR 磁盘组配置的是 normal redundant，而且只有 2 个 failure group，不满足上面的要求 failgroup 不足。</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><p>重新配置共享磁盘，使其满足 3 个 failure group 要求。</p>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-27302</title>
    <url>/blog/posts/2ece53a2.html</url>
    <content><![CDATA[<h1 id="ORA-27302"><a href="#ORA-27302" class="headerlink" title="ORA-27302"></a>ORA-27302</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9<br>Oracle Database - Enterprise Edition - Version 12.1.0.2.0<br>Oracle Grid Infrastructure - Version 12.1.0.2.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p> 节点 2 <code>alert_+ASM2.log</code> 日志文件持续出现如下错误:</p>
<pre class="line-numbers language-none"><code class="language-none">Tue Mar 29 07:31:25 2022
skgxpvfynet: mtype: 61 process 4632 failed because of a resource problem in the OS. The OS has most likely run out of buffers (rval: 4)
Errors in file &#x2F;u01&#x2F;app&#x2F;grid&#x2F;diag&#x2F;asm&#x2F;+asm&#x2F;+ASM2&#x2F;trace&#x2F;+ASM2_m000_4632.trc  (incident&#x3D;179220):
ORA-00603: ORACLE server session terminated by fatal error
ORA-27504: IPC error creating OSD context
ORA-27300: OS system dependent operation:sendmsg failed with status: 105
ORA-27301: OS failure message: No buffer space available
ORA-27302: failure occurred at: sskgxpsnd2
opidrv aborting process M000 ospid (4632) as a result of ORA-603
Process m000 died, see its trace file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CAUSE"><a href="#CAUSE" class="headerlink" title="CAUSE"></a>CAUSE</h2><p>This happens due to less space avaliable for network buffer reservation.</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><ol>
<li><p>Shrink database instance SGA size to give more memory back to OS. After OS gets more available memory, the issue is gone.</p>
</li>
<li><p>Oracle has reported this issue in <strong>Doc ID 2041723.1</strong>. by changing the MTU of the loopback interface,  and changing the value of kernel parameter min_free_kbytes.</p>
<p>a) Lower MTU to 16436 by adding following to &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-lo.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"MTU=16436"</span> <span class="token operator">>></span> /etc/sysconfig/network-scripts/ifcfg-lo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Then restart the network service.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl restart network.service<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>b) Increase the value of vm.min_free_kbytes to <strong>0.4%</strong> of the total physical memory of the server. This can be done by adding following to &#x2F;etc&#x2F;sysctl.conf.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"vm.min_free_kbytes = 2097152"</span> <span class="token operator">>></span> /etc/sysctl.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>and then run below command to make it effective:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sysctl</span> <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Active Database Duplication</title>
    <url>/blog/posts/ce80a7f9.html</url>
    <content><![CDATA[<ol>
<li><p>Creating a Password File for the Auxiliary Instance, When you create a standby database by using RMAN duplication, password files are always copied.</p>
</li>
<li><p>Add Net Services for primary and standby databases in the tnsnames.ora file.</p>
</li>
<li><p>Adding Static Service to Listener in the listener.ora file.</p>
</li>
<li><p>Create an Initialization Parameter File for the Auxiliary Instance.</p>
</li>
<li><p>Start the auxiliary instance in NOMOUNT mode.</p>
</li>
<li><p>Duplication database.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">rman target sys/oracle@Matrix auxiliary sys/oracle@Matrix_DR0

run <span class="token punctuation">&#123;</span>
    allocate channel ch00 <span class="token builtin class-name">type</span> disk<span class="token punctuation">;</span>
    allocate channel ch01 <span class="token builtin class-name">type</span> disk<span class="token punctuation">;</span>
    allocate auxiliary channel ch10 <span class="token builtin class-name">type</span> disk<span class="token punctuation">;</span>
    allocate auxiliary channel ch11 <span class="token builtin class-name">type</span> disk<span class="token punctuation">;</span>
    duplicate target database <span class="token keyword">for</span> standby from active database
    spfile
        parameter_valume_convert <span class="token string">'Matrix'</span>,<span class="token string">'Matrix_DR0'</span>
        <span class="token builtin class-name">set</span> <span class="token assign-left variable">db_unique_name</span><span class="token operator">=</span><span class="token string">'Matrix_DR0'</span>
        <span class="token builtin class-name">set</span> <span class="token assign-left variable">control_files</span><span class="token operator">=</span><span class="token string">'+DATA/Matrix_DR0/control1.ctl'</span>
        <span class="token builtin class-name">set</span> <span class="token assign-left variable">db_create_file_dest</span><span class="token operator">=</span><span class="token string">'+DATA'</span>
        <span class="token builtin class-name">set</span> <span class="token assign-left variable">db_create_online_log_dest_1</span><span class="token operator">=</span><span class="token string">'+FLASH'</span>
        <span class="token builtin class-name">set</span> <span class="token assign-left variable">db_recovery_file_dest_1</span><span class="token operator">=</span><span class="token string">'+FLASH'</span>
        <span class="token builtin class-name">set</span> <span class="token assign-left variable">DB_RECOVERY_FILE_DEST_SIZE</span><span class="token operator">=</span><span class="token string">'10G'</span>
    nofilenamecheck<span class="token punctuation">;</span>
    release channel ch00<span class="token punctuation">;</span>
    release channel ch01<span class="token punctuation">;</span>
    release channel ch10<span class="token punctuation">;</span>
    release channel ch11<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Use the <strong>NOFILENAMECHECK</strong> clause to indicate that RMAN must not display an error when the names of the database files are the same in the source and duplicate database.</p>
<p>If the source database uses a server parameter file, then including the <strong>SPFILE</strong> option in the DUPLICATE command directs RMAN to use the server parameter file from the source database for the auxiliary instance.</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>duplication</tag>
      </tags>
  </entry>
  <entry>
    <title>ORA-17503</title>
    <url>/blog/posts/1ae46556.html</url>
    <content><![CDATA[<h1 id="ORA-17503"><a href="#ORA-17503" class="headerlink" title="ORA-17503"></a>ORA-17503</h1><h2 id="APPLIES-TO"><a href="#APPLIES-TO" class="headerlink" title="APPLIES TO:"></a>APPLIES TO:</h2><blockquote>
<p>Operating System - Oracle Linux Server 7.9<br>Oracle Database - Enterprise Edition - Version 11.2.0.4.0<br>Oracle Grid Infrastructure - Version 11.2.0.4.0</p>
</blockquote>
<h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>GI 群集正常，ASM 磁盘挂载正常，启动数据库报错：</p>
<pre class="line-numbers language-log" data-language="log"><code class="language-log"><span class="token property">ORA-01078:</span> failure in processing system parameters
<span class="token property">ORA-01565:</span> error in identifying file <span class="token string">'+DATA/coco/spfilecoco.ora'</span>
<span class="token property">ORA-17503:</span> ksfdopn<span class="token operator">:</span><span class="token number">2</span> Failed to open file <span class="token operator">+</span>DATA<span class="token operator">/</span>coco<span class="token operator">/</span>spfilecoco<span class="token punctuation">.</span>ora
<span class="token property">ORA-12547:</span> TNS<span class="token operator">:</span>lost contact<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CASUE"><a href="#CASUE" class="headerlink" title="CASUE"></a>CASUE</h2><p>Oracle binary should have permission of <strong>6751</strong>. To correct the permission, as owner of oracle binary</p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle ~<span class="token punctuation">]</span><span class="token comment"># chmod 6751 $GRID_HOME/bin/oracle</span>
<span class="token punctuation">[</span>root@oracle ~<span class="token punctuation">]</span><span class="token comment"># ll $GRID_HOME/bin/oracle</span>
-rwsr-s--x <span class="token number">1</span> grid oinstall <span class="token number">209840392</span> Dec <span class="token number">19</span> <span class="token number">17</span>:28 /u01/app/grid/product/11.2.0.4/grid/bin/oracle<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup for Linux</title>
    <url>/blog/posts/65ab7f54.html</url>
    <content><![CDATA[<ol>
<li><p> 创建备份目录 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /rmanbackup/rmanlog
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /rmanbackup/dbbak
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /rmanbackup/scripts
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /rmanbackup/week
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /rmanbackup/day
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /rmanbackup
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /rmanbackup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 备份脚本 &#x2F;rmanbackup&#x2F;scripts&#x2F;rmanbackup.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#/bin/bash </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span><span class="token variable">$ORACLE_BASE</span>/product/11.2.0/db_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_OWNER</span><span class="token operator">=</span>oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>nwppdb_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_UNQNAME</span><span class="token operator">=</span>nwppdb
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/bin:<span class="token variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/lib:<span class="token variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/JRE:<span class="token variable">$ORACLE_HOME</span>/jlib:<span class="token variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="token variable">$ORACLE_HOME</span>/network/jlib
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_DATE_FORMAT</span><span class="token operator">=</span><span class="token string">"yyyy-mm-dd HH24:MI:SS"</span>
<span class="token assign-left variable">today</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y-%m-%d<span class="token variable">`</span></span> 

<span class="token comment"># 删除 7 天过期的 </span>
<span class="token function">find</span> /rmanbackup/dbbak/ <span class="token parameter variable">-name</span> <span class="token string">"*full*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
<span class="token function">find</span> /rmanbackup/dbbak/ <span class="token parameter variable">-name</span> <span class="token string">"*archivelog*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
<span class="token function">find</span> /rmanbackup/dbbak/ <span class="token parameter variable">-name</span> <span class="token string">"controlfile*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
<span class="token function">find</span> /rmanbackup/dbbak/ <span class="token parameter variable">-name</span> <span class="token string">"spfile*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>

<span class="token comment"># 全备 </span>
rman target / nocatalog log /rmanbackup/rmanlog/rmanbk_<span class="token variable">$today</span>.log append <span class="token operator">&lt;&lt;</span><span class="token string">EOF
run &#123;
crosscheck backup;
delete noprompt expired backup; 
allocate channel c1 device type disk;
allocate channel c2 device type disk;
allocate channel c3 device type disk;
allocate channel c4 device type disk;
backup as compressed backupset format '/rmanbackup/dbbak/nwppdb_full_%T_%d_%s_%p_%u.dbf' database plus archivelog;
sql "ALTER SYSTEM switch logfile";
sql "ALTER SYSTEM switch logfile";
sql "ALTER SYSTEM switch logfile";
delete noprompt archivelog until time 'sysdate-7';
backup current controlfile format '/rmanbackup/dbbak/controlfile_%T_%U_%t.crl';
backup spfile format '/rmanbackup/dbbak/spfile_%T_%U_%t.ora';
release channel c1;
release channel c2;
release channel c3;
release channel c4;
&#125;
exit
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>0 级备份 &#x2F;rmanbackup&#x2F;scripts&#x2F;rman_0_level_full.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#/bin/bash </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span><span class="token variable">$ORACLE_BASE</span>/product/11.2.0/db_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_OWNER</span><span class="token operator">=</span>oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>nwppdb_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_UNQNAME</span><span class="token operator">=</span>nwppdb
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/bin:<span class="token variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/lib:<span class="token variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/JRE:<span class="token variable">$ORACLE_HOME</span>/jlib:<span class="token variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="token variable">$ORACLE_HOME</span>/network/jlib
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_DATE_FORMAT</span><span class="token operator">=</span><span class="token string">"yyyy-mm-dd HH24:MI:SS"</span>
<span class="token assign-left variable">today</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y-%m-%d<span class="token variable">`</span></span> 

<span class="token comment"># 删除 7 天过期的 </span>
<span class="token function">find</span> /rmanbackup/week/ <span class="token parameter variable">-name</span> <span class="token string">"*full*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 
<span class="token function">find</span> /rmanbackup/week/ <span class="token parameter variable">-name</span> <span class="token string">"*arch*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 
<span class="token function">find</span> /rmanbackup/week/ <span class="token parameter variable">-name</span> <span class="token string">"ctl*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 
<span class="token function">find</span> /rmanbackup/week/ <span class="token parameter variable">-name</span> <span class="token string">"spfile*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 

<span class="token comment"># 0 级全备 </span>
rman target / nocatalog log /rmanbackup/rmanlog/fullback0_<span class="token variable">$today</span>.log <span class="token operator">&lt;&lt;</span><span class="token string">EOF
run&#123;
crosscheck backup;
delete noprompt expired backup;
allocate channel d1 type disk;
allocate channel d2 type disk;
allocate channel d3 type disk;
allocate channel d4 type disk;
backup incremental level 0 as compressed backupset database format '/rmanbackup/week/nwppdbfull0_%d_%T_%t_%s_%p';
sql 'alter system archive log current';
backup as compressed backupset filesperset 10 format '/rmanbackup/week/arch_%d_%T_%t_%s_%p' archivelog all;
backup current controlfile format '/rmanbackup/week/ctl_%d_%T_%t_%s_%p';
backup spfile format '/rmanbackup/week/spfile_%T_%U_%t.ora';
release channel d1;
release channel d2;
release channel d3;
release channel d4;
&#125;
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>1 级增量备份 &#x2F;rmanbackup&#x2F;scripts&#x2F;rman_1_level_incremental.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#/bin/bash </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span><span class="token variable">$ORACLE_BASE</span>/product/11.2.0/db_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_OWNER</span><span class="token operator">=</span>oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>nwppdb_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_UNQNAME</span><span class="token operator">=</span>nwppdb
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/bin:<span class="token variable">$ORACLE_HOME</span>/OPatch:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/oracle/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/lib:<span class="token variable">$ORACLE_HOME</span>/rdbms/lib:/lib:/usr/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/JRE:<span class="token variable">$ORACLE_HOME</span>/jlib:<span class="token variable">$ORACLE_HOME</span>/rdbms/jlib:<span class="token variable">$ORACLE_HOME</span>/network/jlib
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK
<span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_DATE_FORMAT</span><span class="token operator">=</span><span class="token string">"yyyy-mm-dd HH24:MI:SS"</span>
<span class="token assign-left variable">today</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%Y-%m-%d<span class="token variable">`</span></span> 

<span class="token comment"># 删除 7 天过期的 </span>
<span class="token function">find</span> /rmanbackup/day/ <span class="token parameter variable">-name</span> <span class="token string">"*full*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 
<span class="token function">find</span> /rmanbackup/day/ <span class="token parameter variable">-name</span> <span class="token string">"*arch*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 
<span class="token function">find</span> /rmanbackup/day/ <span class="token parameter variable">-name</span> <span class="token string">"ctl*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 
<span class="token function">find</span> /rmanbackup/day/ <span class="token parameter variable">-name</span> <span class="token string">"spfile*"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> 
rman target / nocatalog log /rmanbackup/rmanlog/incrementback1_<span class="token variable">$today</span>.log <span class="token operator">&lt;&lt;</span><span class="token string">EOF
run&#123;
crosscheck backup;
delete noprompt expired backup;
allocate channel d1 type disk;
allocate channel d2 type disk;
allocate channel d3 type disk;
allocate channel d4 type disk;
backup incremental level 1 as compressed backupset database format '/rmanbackup/day/increment1_%d_%T_%t_%s_%p';
sql 'alter system archive log current';
backup as compressed backupset filesperset 10 format '/rmanbackup/day/arch_%d_%T_%t_%s_%p' archivelog all;
backup current controlfile format '/rmanbackup/day/ctl_%d_%T_%t_%s_%p';
backup spfile format '/rmanbackup/day/spfile_%T_%U_%t.ora';
release channel d1;
release channel d2;
release channel d3;
release channel d4;
&#125;
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Backup for Windows</title>
    <url>/blog/posts/62d30125.html</url>
    <content><![CDATA[<ol>
<li><p>full backup</p>
<pre class="line-numbers language-batch" data-language="batch"><code class="language-batch"><span class="token comment">REM 需要修改的变量值开始 </span>
<span class="token command"><span class="token keyword">set</span> <span class="token variable">ORACLE_SID</span><span class="token operator">=</span>xpxyy</span>
<span class="token command"><span class="token keyword">set</span> <span class="token variable">BACKUP_PATH</span><span class="token operator">=</span>E:\RMAN</span>
<span class="token command"><span class="token keyword">set</span> <span class="token variable">SYS_PASSWD</span><span class="token operator">=</span>oracle</span>
<span class="token comment">REM 修改变量结束 </span>

<span class="token comment">REM 在服务器上保留 3 个备份的脚本 </span>
<span class="token command"><span class="token keyword">if</span> <span class="token keyword">exist</span> <span class="token variable">%BACKUP_PATH%</span>\*.OLD</span> <span class="token command"><span class="token keyword">del</span> <span class="token parameter attr-name">/F</span> <span class="token parameter attr-name">/Q</span> <span class="token variable">%BACKUP_PATH%</span>\*.<span class="token number">001</span></span>
<span class="token command"><span class="token keyword">if</span> <span class="token keyword">exist</span> <span class="token variable">%BACKUP_PATH%</span>\*.BAK</span> <span class="token command"><span class="token keyword">rename</span> <span class="token variable">%BACKUP_PATH%</span>\*.OLD  *.<span class="token number">001</span></span>
<span class="token command"><span class="token keyword">if</span> <span class="token keyword">exist</span> <span class="token variable">%BACKUP_PATH%</span>\*.BAK</span> <span class="token command"><span class="token keyword">rename</span> <span class="token variable">%BACKUP_PATH%</span>\*.BAK  *.OLD</span>

<span class="token comment">REM 在服务器上保留 2 个备份的脚本 </span>
<span class="token comment">REM  if exist %BACKUP_PATH%\*.BAK del /F /Q  %BACKUP_PATH%\*.OLD</span>
<span class="token comment">REM  if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD</span>

<span class="token comment">REM 在服务器上保留 1 个备份的脚本 </span>
<span class="token comment">REM if exist %BACKUP_PATH%\*.BAK del /F /Q %BACKUP_PATH%\*.BAK</span>

<span class="token command"><span class="token keyword">rman</span> target sys/<span class="token variable">%SYS_PASSWD%</span> nocatalog cmdfile full.sql log full_log.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">run&#123;
    allocate channel ch1 <span class="token keyword">type</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>

    <span class="token keyword">backup</span>
    format <span class="token operator">=</span> <span class="token string">'K:\Rman\DB_%U.BAK'</span>
    <span class="token keyword">database</span><span class="token punctuation">;</span>

    copy <span class="token keyword">current</span> controlfile <span class="token keyword">to</span> <span class="token string">'K:\Rman\control.bak'</span><span class="token punctuation">;</span>

    <span class="token keyword">release</span> channel ch1<span class="token punctuation">;</span>
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>incremental backup</p>
<pre class="line-numbers language-batch" data-language="batch"><code class="language-batch"><span class="token comment">REM 需要修改的变量值开始 </span>
<span class="token command"><span class="token keyword">set</span> <span class="token variable">ORACLE_SID</span><span class="token operator">=</span>xpxyy</span>
<span class="token command"><span class="token keyword">set</span> <span class="token variable">BACKUP_PATH</span><span class="token operator">=</span>E:\RMAN</span>
<span class="token command"><span class="token keyword">set</span> <span class="token variable">SYS_PASSWD</span><span class="token operator">=</span>oracle</span>
<span class="token comment">REM 修改变量结束 </span>

<span class="token comment">REM 在服务器上保留 3 个备份的脚本 </span>
<span class="token command"><span class="token keyword">if</span> <span class="token keyword">exist</span> <span class="token variable">%BACKUP_PATH%</span>\*.OLD</span> <span class="token command"><span class="token keyword">del</span> <span class="token parameter attr-name">/F</span> <span class="token parameter attr-name">/Q</span> <span class="token variable">%BACKUP_PATH%</span>\*.<span class="token number">001</span> </span>
<span class="token command"><span class="token keyword">if</span> <span class="token keyword">exist</span> <span class="token variable">%BACKUP_PATH%</span>\*.BAK</span> <span class="token command"><span class="token keyword">rename</span> <span class="token variable">%BACKUP_PATH%</span>\*.OLD  *.<span class="token number">001</span></span>
<span class="token command"><span class="token keyword">if</span> <span class="token keyword">exist</span> <span class="token variable">%BACKUP_PATH%</span>\*.BAK</span> <span class="token command"><span class="token keyword">rename</span> <span class="token variable">%BACKUP_PATH%</span>\*.BAK  *.OLD</span>

<span class="token comment">REM 在服务器上保留 2 个备份的脚本 </span>
<span class="token comment">REM  if exist %BACKUP_PATH%\*.BAK del /F /Q  %BACKUP_PATH%\*.OLD </span>
<span class="token comment">REM  if exist %BACKUP_PATH%\*.BAK rename %BACKUP_PATH%\*.BAK  *.OLD</span>

<span class="token comment">REM 在服务器上保留 1 个备份的脚本 </span>
<span class="token comment">REM if exist %BACKUP_PATH%\*.BAK del /F /Q %BACKUP_PATH%\*.BAK</span>

<span class="token command"><span class="token keyword">rman</span> target sys/<span class="token variable">%SYS_PASSWD%</span> nocatalog cmdfile incremental.sql log incremental_log.txt</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">run&#123;
    allocate channel ch01 <span class="token keyword">type</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>

    <span class="token keyword">backup</span> incremental <span class="token keyword">level</span> <span class="token number">1</span>
    format <span class="token operator">=</span> <span class="token string">'K:\Rman\DB_%U.BAK'</span>
    <span class="token keyword">database</span><span class="token punctuation">;</span>

    <span class="token keyword">release</span> channel ch1<span class="token punctuation">;</span>
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Delete ArchiveLog</title>
    <url>/blog/posts/b39ef565.html</url>
    <content><![CDATA[<h1 id="Delete-ArchiveLog"><a href="#Delete-ArchiveLog" class="headerlink" title="Delete ArchiveLog"></a>Delete ArchiveLog</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>coco
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span><span class="token variable">$ORACLE_BASE</span>/product/11.2.0.4/db_1
<span class="token variable">$ORACLE_HOME</span>/bin/rman <span class="token assign-left variable">log</span><span class="token operator">=</span>/home/oracle/rmarch.log <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
connect target /
run&#123;
crosscheck archivelog all;
delete noprompt expired archivelog all;
delete noprompt archivelog all completed before 'sysdate - 1';
&#125;
exit;
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>archivelog</tag>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Restore</title>
    <url>/blog/posts/486a1663.html</url>
    <content><![CDATA[<p><strong>Restore parameter file</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">rman target <span class="token operator">/</span> nocatalog

RUN &#123;
 ALLOCATE CHANNEL ch00 <span class="token keyword">TYPE</span> <span class="token keyword">DISK</span><span class="token punctuation">;</span>
 <span class="token keyword">RESTORE</span> SPFILE <span class="token keyword">FROM</span> <span class="token string">'/BACKUP/SPFILE_01UUF10M_1_1.BAK'</span> <span class="token keyword">TO</span> PFILE <span class="token string">'/tmp/initTEMP.ora'</span><span class="token punctuation">;</span>
 <span class="token keyword">RELEASE</span> CHANNEL ch00<span class="token punctuation">;</span>
&#125;

STARTUP <span class="token keyword">FORCE</span> PFILE<span class="token operator">=</span><span class="token string">'/tmp/initTEMP.ora'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Restore control file</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">rman target <span class="token operator">/</span> nocatalog

startup nomount<span class="token punctuation">;</span>
<span class="token keyword">set</span> dbid <span class="token number">320066378</span><span class="token punctuation">;</span>

run &#123;
 allocate channel ch00 <span class="token keyword">type</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
 <span class="token keyword">restore</span> controlfile <span class="token keyword">from</span> <span class="token string">'/backup/cntrl_46_1_730733685'</span><span class="token punctuation">;</span>
 <span class="token keyword">release</span> channel ch00<span class="token punctuation">;</span>
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Restore database file</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">rman target <span class="token operator">/</span> nocatalog

<span class="token keyword">sql</span> <span class="token string">'alter database mount'</span><span class="token punctuation">;</span>
catalog <span class="token keyword">start</span> <span class="token keyword">with</span> <span class="token string">'/backup/'</span><span class="token punctuation">;</span> <span class="token comment">-- 将备份集信息重新导入到当前控制文件中 </span>

run &#123;
 allocate channel ch00 <span class="token keyword">type</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
 allocate channel ch01 <span class="token keyword">type</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
 <span class="token comment">-- specify the new location for each datafile</span>
 <span class="token keyword">set</span> newname <span class="token keyword">for</span> <span class="token keyword">database</span> <span class="token keyword">to</span> <span class="token string">'/datafile/%U.dbf'</span><span class="token punctuation">;</span>
 <span class="token comment">-- set newname for datafile 1 to '/oracle/oradata/datafile01.dbf';</span>
 <span class="token comment">-- set newname for tempfile 1 to '/oracle/oradata/tempfile01.dbf';</span>
 <span class="token keyword">restore</span> <span class="token keyword">database</span><span class="token punctuation">;</span>
 switch datafile <span class="token keyword">all</span><span class="token punctuation">;</span> <span class="token comment">-- update control file with new filenames</span>
 switch tempfile <span class="token keyword">all</span><span class="token punctuation">;</span>
 <span class="token comment">-- recover database;</span>
 <span class="token keyword">release</span> channel ch00<span class="token punctuation">;</span>
 <span class="token keyword">release</span> channel ch01<span class="token punctuation">;</span>
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Restore tablespace</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">RUN
&#123;
 <span class="token keyword">SQL</span> <span class="token string">'ALTER TABLESPACE users OFFLINE IMMEDIATE'</span><span class="token punctuation">;</span>
 <span class="token keyword">SQL</span> <span class="token string">'ALTER TABLESPACE tools OFFLINE IMMEDIATE'</span><span class="token punctuation">;</span>
 <span class="token comment">-- specify the new location for each datafile</span>
 <span class="token keyword">SET</span> NEWNAME <span class="token keyword">FOR</span> DATAFILE <span class="token string">'/olddisk/users01.dbf'</span> <span class="token keyword">TO</span> <span class="token string">'/newdisk/users01.dbf'</span><span class="token punctuation">;</span>
 <span class="token keyword">SET</span> NEWNAME <span class="token keyword">FOR</span> DATAFILE <span class="token string">'/olddisk/tools01.dbf'</span> <span class="token keyword">TO</span> <span class="token string">'/newdisk/tools01.dbf'</span><span class="token punctuation">;</span>
 <span class="token comment">-- to restore to an ASM disk group named dgroup, use:</span>
 <span class="token comment">-- SET NEWNAME FOR DATAFILE '/olddisk/trgt/tools01.dbf' TO '+dgroup';</span>
 <span class="token keyword">RESTORE</span> <span class="token keyword">TABLESPACE</span> users<span class="token punctuation">,</span> tools<span class="token punctuation">;</span>
 SWITCH DATAFILE <span class="token keyword">ALL</span><span class="token punctuation">;</span> <span class="token comment">-- update control file with new filenames</span>
 RECOVER <span class="token keyword">TABLESPACE</span> users<span class="token punctuation">,</span> tools<span class="token punctuation">;</span>
&#125;

<span class="token keyword">SQL</span> <span class="token string">'ALTER TABLESPACE users ONLINE'</span><span class="token punctuation">;</span>
<span class="token keyword">SQL</span> <span class="token string">'ALTER TABLESPACE tools ONLINE'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Recover archivelog</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">rman target <span class="token operator">/</span> nocatalog

run &#123;
 allocate channel ch00 <span class="token keyword">type</span> <span class="token keyword">disk</span><span class="token punctuation">;</span>
 <span class="token keyword">set</span> archivelog destination <span class="token keyword">to</span> <span class="token string">'/backup/arch/'</span><span class="token punctuation">;</span>
 <span class="token comment">-- restore archivelog from logseq 10 until logseq 14 thread 1;</span>
 <span class="token comment">-- restore archivelog from logseq 10 until logseq 14 thread 2;</span>
 recover <span class="token keyword">database</span><span class="token punctuation">;</span>
 <span class="token keyword">release</span> channel ch00<span class="token punctuation">;</span>
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Recover database using backup controlfile until time</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">sqlplus <span class="token string">"/as sysdba"</span>
<span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_dest<span class="token operator">=</span><span class="token string">'/oracle/arch/'</span><span class="token punctuation">;</span>
recover <span class="token keyword">database</span> <span class="token keyword">using</span> <span class="token keyword">backup</span> controlfile until <span class="token keyword">time</span> <span class="token string">'JUN 29 2011 21:30:00'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>Recover database using backup controlfile</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> recover <span class="token keyword">database</span> <span class="token keyword">using</span> <span class="token keyword">backup</span> controlfile<span class="token punctuation">;</span>
ORA<span class="token operator">-</span><span class="token number">00279</span>: change <span class="token number">2085526</span> generated at <span class="token number">03</span><span class="token operator">/</span><span class="token number">24</span><span class="token operator">/</span><span class="token number">2021</span> <span class="token number">08</span>:<span class="token number">20</span>:<span class="token number">48</span> needed <span class="token keyword">for</span> thread <span class="token number">1</span>
ORA<span class="token operator">-</span><span class="token number">00289</span>: suggestion : <span class="token operator">/</span>archive<span class="token operator">/</span><span class="token number">1</span>_15_1067527310<span class="token punctuation">.</span>dbf
ORA<span class="token operator">-</span><span class="token number">00280</span>: change <span class="token number">2085526</span> <span class="token keyword">for</span> thread <span class="token number">1</span> <span class="token operator">is</span> <span class="token operator">in</span> sequence <span class="token comment">#15</span>

Specify log:
&#123;<span class="token operator">&lt;</span>RET<span class="token operator">>=</span>suggested <span class="token operator">|</span> filename <span class="token operator">|</span> AUTO <span class="token operator">|</span> CANCEL&#125;
<span class="token operator">/</span>datafile<span class="token operator">/</span>racdb<span class="token operator">/</span>redo03<span class="token punctuation">.</span>log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Rename online redo</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'alter database rename file'''</span> <span class="token operator">||</span> member <span class="token operator">||</span> <span class="token string">'''to''/dest_dir/'</span> <span class="token operator">||</span> substr<span class="token punctuation">(</span>member<span class="token punctuation">,</span> instr<span class="token punctuation">(</span>member<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''';'</span> <span class="token keyword">from</span> v$logfile<span class="token punctuation">;</span><span aria-hidden="true"class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>Rename datafile and tempfile</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'alter database rename file'''</span> <span class="token operator">||</span> member <span class="token operator">||</span> <span class="token string">'''to''/dest_dir/'</span> <span class="token operator">||</span> substr<span class="token punctuation">(</span>member<span class="token punctuation">,</span> instr<span class="token punctuation">(</span>member<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''';'</span> <span class="token keyword">from</span> v$datafile<span class="token punctuation">;</span><span aria-hidden="true"class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'alter database rename file'''</span> <span class="token operator">||</span> member <span class="token operator">||</span> <span class="token string">'''to''/dest_dir/'</span> <span class="token operator">||</span> substr<span class="token punctuation">(</span>member<span class="token punctuation">,</span> instr<span class="token punctuation">(</span>member<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''';'</span> <span class="token keyword">from</span> v$tempfile<span class="token punctuation">;</span><span aria-hidden="true"class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>Rename datafile and tempfile on rman script</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'set newname for datafile'''</span> <span class="token operator">||</span> name<span class="token operator">||</span> <span class="token string">'''to''/dest_dir/'</span> <span class="token operator">||</span> substr<span class="token punctuation">(</span>name<span class="token punctuation">,</span> instr<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''';'</span> <span class="token keyword">from</span> v$datafile <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">file</span><span class="token comment">#;</span><span aria-hidden="true"class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'set newname for tempfile'''</span> <span class="token operator">||</span> name <span class="token operator">||</span> <span class="token string">'''to''/dest_dir/'</span> <span class="token operator">||</span> substr<span class="token punctuation">(</span>name<span class="token punctuation">,</span> instr<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''';'</span> <span class="token keyword">from</span> v$tempfile <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">file</span><span class="token comment">#;</span><span aria-hidden="true"class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>Open database with resetlogs</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">sqlplus <span class="token string">"/as sysdba"</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span> resetlogs<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>Troubleshooting</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">open</span> resetlogs 出现 system 表空间没有从一个完整的旧备份中还原错误，解决方法参考 onenote 笔记 ORA<span class="token operator">-</span><span class="token number">01152</span>

RMAN<span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span> resetlogs<span class="token punctuation">;</span>
RMAN<span class="token operator">-</span><span class="token number">00571</span>: <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span>
RMAN<span class="token operator">-</span><span class="token number">00569</span>: <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span> ERROR MESSAGE STACK FOLLOWS <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span>
RMAN<span class="token operator">-</span><span class="token number">00571</span>: <span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span>
RMAN<span class="token operator">-</span><span class="token number">03002</span>: failure <span class="token keyword">of</span> <span class="token keyword">alter</span> db command at <span class="token number">03</span><span class="token operator">/</span><span class="token number">05</span><span class="token operator">/</span><span class="token number">2013</span> <span class="token number">14</span>:<span class="token number">34</span>:<span class="token number">37</span>
ORA<span class="token operator">-</span><span class="token number">01152</span>: <span class="token keyword">file</span> <span class="token number">1</span> was <span class="token operator">not</span> restored <span class="token keyword">from</span> a sufficiently old <span class="token keyword">backup</span>
ORA<span class="token operator">-</span><span class="token number">01110</span>: <span class="token keyword">data</span> <span class="token keyword">file</span> <span class="token number">1</span>: <span class="token string">'/oracle/u01/app/oracle/oradata/orcl/system01.dbf'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>RMAN</category>
      </categories>
      <tags>
        <tag>rman</tag>
      </tags>
  </entry>
  <entry>
    <title>Block Browser and EDitor</title>
    <url>/blog/posts/82bc98c5.html</url>
    <content><![CDATA[<ol>
<li> 编译 bbed</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@centos7 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> <span class="token variable">$ORACLE_HOME</span>/rdbms/lib
<span class="token punctuation">[</span>oracle@centos7 lib<span class="token punctuation">]</span>$ <span class="token function">make</span> <span class="token parameter variable">-f</span> ins_rdbms.mk <span class="token variable">$ORACLE_HOME</span>/rdbms/lib/bbed
<span class="token punctuation">[</span>oracle@centos7 lib<span class="token punctuation">]</span>$ ./bbed
Password: blockedit

BBED: Release <span class="token number">2.0</span>.0.0.0 - Limited Production on Tue Mar <span class="token number">8</span> <span class="token number">14</span>:35:08 <span class="token number">2022</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2007</span>, Oracle.  All rights reserved.

************* <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span> For Oracle Internal Use only <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span> ***************

BBED<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li> 设置参数 </li>
</ol>
<p> 查询数据文件信息，并保存至 bbed filelist 文件中 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">set</span> heading <span class="token keyword">off</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">set</span> feedback <span class="token keyword">off</span>
<span class="token keyword">SQL</span><span class="token operator">></span> spool <span class="token operator">/</span>u01<span class="token operator">/</span>bbedlist<span class="token punctuation">.</span>parf
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token keyword">file</span><span class="token comment">#||''||name||' '||bytes from v$datafile;</span>
<span class="token number">1</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>oradata<span class="token operator">/</span>orcl<span class="token operator">/</span>system01<span class="token punctuation">.</span>dbf <span class="token number">461373440</span>
<span class="token number">2</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>oradata<span class="token operator">/</span>orcl<span class="token operator">/</span>undotbs01<span class="token punctuation">.</span>dbf <span class="token number">414187520</span>
<span class="token number">3</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>oradata<span class="token operator">/</span>orcl<span class="token operator">/</span>sysaux01<span class="token punctuation">.</span>dbf <span class="token number">272629760</span>
<span class="token number">4</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>oradata<span class="token operator">/</span>orcl<span class="token operator">/</span>users01<span class="token punctuation">.</span>dbf <span class="token number">5242880</span>
<span class="token number">5</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>oradata<span class="token operator">/</span>ccdata<span class="token punctuation">.</span>dbf <span class="token number">1825570816</span>
<span class="token keyword">SQL</span><span class="token operator">></span> spool <span class="token keyword">off</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 创建 parameter file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">>></span> /u01/bbed.par <span class="token operator">&lt;&lt;</span><span class="token string">EOF
blocksize=8192
listfile=/u01/bbedlist.parf
mode=edit
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li> 连接 bbed</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@centos7 lib<span class="token punctuation">]</span>$ ./bbed <span class="token assign-left variable">parfile</span><span class="token operator">=</span>/u01/bbed.par <span class="token assign-left variable">password</span><span class="token operator">=</span>blockedit

BBED: Release <span class="token number">2.0</span>.0.0.0 - Limited Production on Tue Mar <span class="token number">8</span> <span class="token number">15</span>:24:27 <span class="token number">2022</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2007</span>, Oracle.  All rights reserved.

************* <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span> For Oracle Internal Use only <span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span> ***************

BBED<span class="token operator">></span> show
        FILE<span class="token comment">#           1</span>
        BLOCK<span class="token comment">#          1</span>
        OFFSET          <span class="token number">0</span>
        DBA             0x00400001 <span class="token punctuation">(</span><span class="token number">4194305</span> <span class="token number">1,1</span><span class="token punctuation">)</span>
        FILENAME        /u01/app/oracle/oradata/orcl/system01.dbf
        BIFILE          bifile.bbd
        LISTFILE        /u01/bbedlist.parf
        BLOCKSIZE       <span class="token number">8192</span>
        MODE            Edit
        EDIT            Unrecoverable
        IBASE           Dec
        OBASE           Dec
        WIDTH           <span class="token number">80</span>
        COUNT           <span class="token number">512</span>
        LOGFILE         log.bbd
        SPOOL           No

BBED<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>bbed</tag>
      </tags>
  </entry>
  <entry>
    <title>Datapump</title>
    <url>/blog/posts/68862bf4.html</url>
    <content><![CDATA[<h1 id="Datapump"><a href="#Datapump" class="headerlink" title="Datapump"></a>Datapump</h1><h2 id="Create-a-directory-and-grant-privileges"><a href="#Create-a-directory-and-grant-privileges" class="headerlink" title="Create a directory and grant privileges"></a>Create a directory and grant privileges</h2><p><strong>Check directory</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> linesize <span class="token number">200</span> pages <span class="token number">100</span>
col privilege <span class="token keyword">for</span> a10
col directory_path <span class="token keyword">for</span> a25
<span class="token keyword">select</span> t<span class="token punctuation">.</span>owner<span class="token punctuation">,</span> privilege<span class="token punctuation">,</span> directory_name<span class="token punctuation">,</span> directory_path
<span class="token keyword">from</span> user_tab_privs t<span class="token punctuation">,</span> all_directories d 
<span class="token keyword">where</span> t<span class="token punctuation">.</span>table_name<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>directory_name <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_directories<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>Create directory</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> directory expdp1 <span class="token keyword">as</span> <span class="token string">'/expdp'</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">read</span><span class="token punctuation">,</span><span class="token keyword">write</span> <span class="token keyword">on</span> directory expdp1 <span class="token keyword">to</span> sys<span class="token punctuation">,</span>system<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>Drop directory</strong></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">drop</span> directory expdp1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Export-Mode"><a href="#Export-Mode" class="headerlink" title="Export Mode"></a>Export Mode</h2><ul>
<li><p>Full Mode</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK
expdp system/oracle <span class="token assign-left variable">DIRECTORY</span><span class="token operator">=</span>expdp1 <span class="token assign-left variable">DUMPFILE</span><span class="token operator">=</span>his%U.dmp <span class="token assign-left variable">filesize</span><span class="token operator">=</span>8g <span class="token assign-left variable">parallel</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>hisfull.log <span class="token assign-left variable">full</span><span class="token operator">=</span>y <span class="token assign-left variable">cluster</span><span class="token operator">=</span>N<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Schema Mode</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">expdp system/oracle <span class="token assign-left variable">DIRECTORY</span><span class="token operator">=</span>expdp1 <span class="token assign-left variable">DUMPFILE</span><span class="token operator">=</span>spacs%U.dmp <span class="token assign-left variable">filesize</span><span class="token operator">=</span>8g <span class="token assign-left variable">parallel</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">SCHEMAS</span><span class="token operator">=</span>SPACS <span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>spacs.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Table Mode</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">expdp sd_zy/sd_zy <span class="token assign-left variable">DIRECTORY</span><span class="token operator">=</span>expdp1 <span class="token assign-left variable">tables</span><span class="token operator">=</span>ZY_YFSTZ0,ZY_DFSTZ0 <span class="token assign-left variable">DUMPFILE</span><span class="token operator">=</span>zy%U.dmp <span class="token assign-left variable">filesize</span><span class="token operator">=</span>8g <span class="token assign-left variable">parallel</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>zynew.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h2 id="Import-Mode"><a href="#Import-Mode" class="headerlink" title="Import Mode"></a>Import Mode</h2><ul>
<li><p>Full Mode</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">NLS_LANG</span><span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK
impdp system/oracle <span class="token assign-left variable">DIRECTORY</span><span class="token operator">=</span>expdp1 <span class="token assign-left variable">full</span><span class="token operator">=</span>y <span class="token assign-left variable">DUMPFILE</span><span class="token operator">=</span>HIS%U.DMP <span class="token assign-left variable">parallel</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>hisfull.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Schema Mode</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">impdp system/oracle <span class="token assign-left variable">DIRECTORY</span><span class="token operator">=</span>expdp1 <span class="token assign-left variable">schemas</span><span class="token operator">=</span>itpux01,itpux02,itpux03 <span class="token assign-left variable">DUMPFILE</span><span class="token operator">=</span>expdp_itpux010203.dmp <span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>impdp_itpux010203.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Table Mode</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">impdp sd_zs/sd_zs <span class="token assign-left variable">DIRECTORY</span><span class="token operator">=</span>expdp1 <span class="token assign-left variable">tables</span><span class="token operator">=</span>zs_blws00 <span class="token assign-left variable">DUMPFILE</span><span class="token operator">=</span>sd%U.dmp <span class="token assign-left variable">LOGFILE</span><span class="token operator">=</span>zs_blws00.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Other Situation</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">impdp system/oracle <span class="token assign-left variable">directory</span><span class="token operator">=</span>datapump <span class="token assign-left variable">dumpfile</span><span class="token operator">=</span>newtopbox%U.dump <span class="token assign-left variable">EXCLUDE</span><span class="token operator">=</span>statistics,constraint,index <span class="token assign-left variable">remap_tablespace</span><span class="token operator">=</span>users:topbox <span class="token assign-left variable">parallel</span><span class="token operator">=</span><span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h2 id="Datapump-Jobs"><a href="#Datapump-Jobs" class="headerlink" title="Datapump Jobs"></a>Datapump Jobs</h2>   <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查看正在运行的作业 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_datapump_jobs<span class="token punctuation">;</span>

<span class="token comment">-- 附加作业 </span>
expdp system<span class="token operator">/</span>oracle attach<span class="token operator">=</span>SYS_EXPORT_TABLE_01

<span class="token comment">-- 立即停止作业 </span>
Export<span class="token operator">></span> stop_job<span class="token operator">=</span>immeidate

<span class="token comment">-- 分离并删除作业 </span>
Export<span class="token operator">></span> kill_job<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>datapump</tag>
      </tags>
  </entry>
  <entry>
    <title>OSWatcher</title>
    <url>/blog/posts/dcd52c13.html</url>
    <content><![CDATA[<h4 id="安装"><a href="# 安装" class="headerlink" title="安装"></a>安装 </h4><p> 将下载好的安装包（文件名为 oswbb***.tar）上传至每个数据库节点，并解压</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> /u01/oswatcher
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> oswbb840.tar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="配置"><a href="# 配置" class="headerlink" title="配置"></a>配置</h4><ol>
<li><p>（可选）追踪 RAC 私有网络</p>
<p>将 Exampleprivate.net 拷贝至 private.net，编辑 private.net</p>
<p>Linux 平台上的 private.net 示例条目：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">######################################################################</span>
<span class="token comment">#Linux Example</span>
<span class="token comment">######################################################################</span>
<span class="token builtin class-name">echo</span> <span class="token string">"zzz ***"</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span><span class="token variable">`</span></span>
<span class="token function">traceroute</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-F</span> rac01-priv
<span class="token function">traceroute</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-F</span> rac02-priv
<span class="token comment">######################################################################</span>
<span class="token function">rm</span> locks/lock.file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>配置 oswbb 后台运行，每间隔 2 秒采集一次数据，采集数据保存 72 小时</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /u01/oswatcher/oswbb

<span class="token comment"># 默认每隔 30s 采集一次数据，保存 48h</span>
<span class="token function">nohup</span> ./startOSWbb.sh <span class="token number">2</span> <span class="token number">72</span> <span class="token function">gzip</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>编辑系统 &#x2F;etc&#x2F;rc.local 文件，配置 oswbb 任务开机自启动</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> /etc/rc.local
<span class="token function">nohup</span> /u01/oswatcher/oswbb/startOSWbb.sh <span class="token number">2</span> <span class="token number">72</span> <span class="token function">gzip</span> <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>停止 oswbb</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /u01/oswatcher/oswbb
./stopOSWbb.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>java 生成性能图表</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">java</span> <span class="token parameter variable">-jar</span> oswbba.jar <span class="token parameter variable">-i</span> /u01/oswatcher/oswbb/archive<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h4 id="卸载"><a href="# 卸载" class="headerlink" title="卸载"></a>卸载 </h4><p> 删除 oswbb 目录</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/oswatcher/oswbb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Utilities</category>
      </categories>
      <tags>
        <tag>oswatcher</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 18370031_112040</title>
    <url>/blog/posts/b99fec6c.html</url>
    <content><![CDATA[<h1 id="p18370031-112040-Linux-x86-64"><a href="#p18370031-112040-Linux-x86-64" class="headerlink" title="p18370031_112040_Linux-x86-64"></a>p18370031_112040_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p18370031_112040_Linux-x86-64_README.html">p18370031_112040_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><p>You must use the OPatch utility version 11.2.0.3.0 or later to apply this patch.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token operator">&lt;</span>ORACLE_HOME<span class="token operator">></span>/OPatch/opatch version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>if not, patch p6880880.</p>
<h3 id="Validation-of-Oracle-Inventory"><a href="#Validation-of-Oracle-Inventory" class="headerlink" title="Validation of Oracle Inventory"></a>Validation of Oracle Inventory</h3><p>Before beginning patch application, check the consistency of inventory information for GI home and each database home to be patched. Run the following command as respective Oracle home owner to check the consistency.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token operator">&lt;</span>ORACLE_HOME<span class="token operator">></span>/OPatch/opatch lsinventory <span class="token parameter variable">-detail</span> <span class="token parameter variable">-oh</span> <span class="token operator">&lt;</span>ORACLE_HOME<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Unzipping-the-Patch"><a href="#Unzipping-the-Patch" class="headerlink" title="Unzipping the Patch"></a>Unzipping the Patch</h3><p>Do not unzip the patch in the top level &#x2F;tmp directory.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>UNZIPPED_PATCH_LOCATION<span class="token operator">></span>
$ <span class="token function">unzip</span> p18370031_112040_Linux-x86-64.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="OPatch-Automation-for-GI"><a href="#OPatch-Automation-for-GI" class="headerlink" title="OPatch Automation for GI"></a>OPatch Automation for GI</h2><p><strong>Case 1: Patching Oracle RAC Database Homes and the GI Home Together</strong></p>
<p>Follow the instructions in this section if you would like to patch all the Oracle RAC database homes of release version 11.2.0.4.0 and the 11.2.0.4.0 GI home.</p>
<p><strong>Case 1.1: GI Home Is Not Shared</strong></p>
<p><strong>Case 1.1.1: ACFS File System Is Not Configured and Database Homes Are Not Shared</strong></p>
<p>Follow these instructions in this section if the GI home is not shared and none of the Oracle database homes is shared.</p>
<p>As root user execute the following command on each node of the cluster:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># &lt;GI_HOME>/OPatch/opatch auto &lt;UNZIPPED_PATCH_LOCATION></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 20299014_10205</title>
    <url>/blog/posts/4fc711ab.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 20299014 - Database Patch Set Update 10.2.0.5.19 (Includes CPUJul2015)</p>
</blockquote>
<h1 id="p20299014-10205-Linux-x86-64"><a href="#p20299014-10205-Linux-x86-64" class="headerlink" title="p20299014_10205_Linux-x86-64"></a>p20299014_10205_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p20299014_10205_Linux-x86-64_README.html">p20299014_10205_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><blockquote>
<p> 操作系统版本 : CentOS Linux release 7.9.2009 (Core)<br> 数据库版本 : Oracle 10.2.0.5.0 simple instance<br>OPatch : p6880880_102000_Linux-x86-64.zip<br>DB PSU : p20299014_10205_Linux-x86-64.zip<br> 说明：p20299014 补丁包无 CRS 的补丁修复，所以直接打数据库 PSU 即可 </p>
</blockquote>
<ol>
<li><p>Update OPatch</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># chmod 775 /soft/p6880880_102000_Linux-x86-64-opatch.zip</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># chown /soft/oracle:oinstall p6880880_102000_Linux-x86-64-opatch.zip</span>

<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># su - oracle</span>
<span class="token punctuation">[</span>oracle@centos7 ~<span class="token punctuation">]</span>$ <span class="token function">mv</span> /u01/app/oracle/product/10.2.0/db_1/OPatch /tmp/OPatch_bak
<span class="token punctuation">[</span>oracle@centos7 ~<span class="token punctuation">]</span>$ <span class="token function">unzip</span> /soft/p6880880_102000_Linux-x86-64-opatch.zip <span class="token parameter variable">-d</span> <span class="token variable">$ORACLE_HOME</span>

<span class="token punctuation">[</span>oracle@centos7 ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch version
Invoking OPatch <span class="token number">10.2</span>.0.5.1
OPatch Version: <span class="token number">10.2</span>.0.5.1
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Patch p20299014</p>
<p> 解压补丁包 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># chmod 775 PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip</span>
<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># chown oracle:oinstall PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip</span>

<span class="token punctuation">[</span>root@centos7 ~<span class="token punctuation">]</span><span class="token comment"># su - oracle</span>
<span class="token punctuation">[</span>oracle@centos7 soft<span class="token punctuation">]</span>$ <span class="token function">unzip</span> PSU-10.2.0.5.19-p20299014_10205_Linux-x86-64.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 补丁包兼容性检查 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@centos7 soft<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/20299014 <span class="token parameter variable">-oh</span> <span class="token variable">$ORACLE_HOME</span>
Invoking OPatch <span class="token number">10.2</span>.0.5.1

Oracle Interim Patch Installer version <span class="token number">10.2</span>.0.5.1
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2010</span>, Oracle Corporation.  All rights reserved.

PREREQ session

Oracle Home       <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1
Central Inventory <span class="token builtin class-name">:</span> /u01/app/oracle/oraInventory
   from           <span class="token builtin class-name">:</span> /etc/oraInst.loc
OPatch version    <span class="token builtin class-name">:</span> <span class="token number">10.2</span>.0.5.1
OUI version       <span class="token builtin class-name">:</span> <span class="token number">10.2</span>.0.5.0
OUI location      <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1/oui
Log <span class="token function">file</span> location <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_08-50-38AM.log

Patch <span class="token function">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt

Invoking prereq <span class="token string">"checkconflictagainstohwithdetail"</span>

Prereq <span class="token string">"checkConflictAgainstOHWithDetail"</span> passed.

OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 查看该补丁能否采用 rolling 方式升级 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@centos7 ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch query <span class="token parameter variable">-all</span> /soft/20299014/ <span class="token operator">|</span> <span class="token function">grep</span> rolling
 Patch is a rolling patch: <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 关闭数据库和监听 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sqlplus / as sysdba
SQL<span class="token operator">></span> <span class="token function">shutdown</span> immediate

$ lsnrctl stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Patch Apply</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@centos7 ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch apply /soft/20299014/
Invoking OPatch <span class="token number">10.2</span>.0.5.1

Oracle Interim Patch Installer version <span class="token number">10.2</span>.0.5.1
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2010</span>, Oracle Corporation.  All rights reserved.
Oracle Home <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1
 Central Inventory <span class="token builtin class-name">:</span> /u01/app/oracle/oraInventory
 from <span class="token builtin class-name">:</span> /etc/oraInst.loc
 OPatch version <span class="token builtin class-name">:</span> <span class="token number">10.2</span>.0.5.1
 OUI version <span class="token builtin class-name">:</span> <span class="token number">10.2</span>.0.5.0
 OUI location <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1/oui
 Log <span class="token function">file</span> location <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_09-27-57AM.log

Patch <span class="token function">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt

ApplySession applying interim patch <span class="token string">'20299014'</span> to OH <span class="token string">'/u01/app/oracle/product/10.2.0/db_1'</span>

Running prerequisite checks<span class="token punctuation">..</span>.
 Patch <span class="token number">20299014</span>: Optional component<span class="token punctuation">(</span>s<span class="token punctuation">)</span> missing <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> oracle.rdbms.dv, <span class="token number">10.2</span>.0.5.0 <span class="token punctuation">]</span> , <span class="token punctuation">[</span> oracle.rdbms.dv.oc4j, <span class="token number">10.2</span>.0.5.0 <span class="token punctuation">]</span> , <span class="token punctuation">[</span> oracle .network.cman, <span class="token number">10.2</span>.0.5.0 <span class="token punctuation">]</span> , <span class="token punctuation">[</span> oracle.javavm.companion, <span class="token number">10.2</span>.0.5.0 <span class="token punctuation">]</span> , <span class="token punctuation">[</span> oracle.ordim.companion, <span class="token number">10.2</span>.0.5.0 <span class="token punctuation">]</span> , <span class="token punctuation">[</span> oracle.sqlj, <span class="token number">1</span> <span class="token number">0.2</span>.0.5.0 <span class="token punctuation">]</span> , <span class="token punctuation">[</span> oracle.java.sqlj, <span class="token number">10.2</span>.0.5.0 <span class="token punctuation">]</span>
 Provide your email address to be informed of security issues, <span class="token function">install</span> and
 initiate Oracle Configuration Manager. Easier <span class="token keyword">for</span> you <span class="token keyword">if</span> you use your My
 Oracle Support Email address/User Name.
 Visit http://www.oracle.com/support/policies.html <span class="token keyword">for</span> details.
 Email address/User Name:

You have not provided an email address <span class="token keyword">for</span> notification of security issues.
 Do you wish to remain uninformed of security issues <span class="token punctuation">(</span><span class="token punctuation">[</span>Y<span class="token punctuation">]</span>es, <span class="token punctuation">[</span>N<span class="token punctuation">]</span>o<span class="token punctuation">)</span> <span class="token punctuation">[</span>N<span class="token punctuation">]</span>: Y

OPatch detected non-cluster Oracle Home from the inventory and will patch the <span class="token builtin class-name">local</span> system only.

Please <span class="token function">shutdown</span> Oracle instances running out of this ORACLE_HOME on the <span class="token builtin class-name">local</span> system.
 <span class="token punctuation">(</span>Oracle Home <span class="token operator">=</span> <span class="token string">'/u01/app/oracle/product/10.2.0/db_1'</span><span class="token punctuation">)</span>

Is the <span class="token builtin class-name">local</span> system ready <span class="token keyword">for</span> patching? <span class="token punctuation">[</span>y<span class="token operator">|</span>n<span class="token punctuation">]</span>
 y
 User Responded with: Y
 Backing up files and inventory <span class="token punctuation">(</span>not <span class="token keyword">for</span> auto-rollback<span class="token punctuation">)</span> <span class="token keyword">for</span> the Oracle Home
 Backing up files affected by the patch <span class="token string">'20299014'</span> <span class="token keyword">for</span> restore. This might take a while<span class="token punctuation">..</span>.
 Backing up files affected by the patch <span class="token string">'20299014'</span> <span class="token keyword">for</span> rollback. This might take a while<span class="token punctuation">..</span>.
 Execution of <span class="token string">'sh /soft/20299014/custom/scripts/pre -apply 20299014'</span><span class="token builtin class-name">:</span>

Return Code <span class="token operator">=</span> <span class="token number">0</span>

Patching component oracle.rdbms, <span class="token number">10.2</span>.0.5.0<span class="token punctuation">..</span>.

<span class="token punctuation">..</span>. 中间过程省略 <span class="token punctuation">..</span>.

ApplySession adding interim patch <span class="token string">'20299014'</span> to inventory

Verifying the update<span class="token punctuation">..</span>.
 Inventory check OK: Patch ID <span class="token number">20299014</span> is registered <span class="token keyword">in</span> Oracle Home inventory with proper meta-data.
 Files check OK: Files from Patch ID <span class="token number">20299014</span> are present <span class="token keyword">in</span> Oracle Home.
 Execution of <span class="token string">'sh /soft/20299014/custom/scripts/post -apply 20299014'</span><span class="token builtin class-name">:</span>

Return Code <span class="token operator">=</span> <span class="token number">0</span>

The <span class="token builtin class-name">local</span> system has been patched and can be restarted.

OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 检查升级情况 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@centos7 ~<span class="token punctuation">]</span> ORACLE_HOME/OPatch/opatch lsinv
Invoking OPatch <span class="token number">10.2</span>.0.5.1 
Oracle Interim Patch Installer version <span class="token number">10.2</span>.0.5.1
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2010</span>, Oracle Corporation. All rights reserved. 
Oracle Home <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1
Central Inventory <span class="token builtin class-name">:</span> /u01/app/oracle/oraInventory
 from <span class="token builtin class-name">:</span> /etc/oraInst.loc
OPatch version <span class="token builtin class-name">:</span> <span class="token number">10.2</span>.0.5.1
OUI version <span class="token builtin class-name">:</span> <span class="token number">10.2</span>.0.5.0
OUI location <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1/oui
Log <span class="token function">file</span> location <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch2022-02-14_09-36-48AM.log 
Patch <span class="token function">history</span> file: /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/opatch_history.txt 
Lsinventory Output <span class="token function">file</span> location <span class="token builtin class-name">:</span> /u01/app/oracle/product/10.2.0/db_1/cfgtoollogs/opatch/lsinv/lsinventory2022-02-14_09-36-48AM.txt

---

Installed Top-level Products <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>: 
Oracle Database 10g <span class="token number">10.2</span>.0.1.0
Oracle Database 10g Release <span class="token number">2</span> Patch Set <span class="token number">4</span> <span class="token number">10.2</span>.0.5.0
There are <span class="token number">2</span> products installed <span class="token keyword">in</span> this Oracle Home. 
Interim patches <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token builtin class-name">:</span> 
Patch <span class="token number">20299014</span> <span class="token builtin class-name">:</span> applied on Mon Feb <span class="token number">14</span> 09:31:13 CST <span class="token number">2022</span>
Unique Patch ID: <span class="token number">19074368</span>
 Created on <span class="token number">24</span> Jun <span class="token number">2015</span>, 02:35:37 hrs PST8PDT
 Bugs fixed:
 <span class="token number">20074391</span>, <span class="token number">13596521</span>, <span class="token number">17088068</span>, <span class="token number">8865718</span>, <span class="token number">17201047</span>, <span class="token number">13489660</span>, <span class="token number">9020537</span>
 <span class="token number">8664189</span>, <span class="token number">10091698</span>, <span class="token number">14275629</span>, <span class="token number">19909862</span>, <span class="token number">17832122</span>, <span class="token number">17832123</span>, <span class="token number">17832124</span>
 <span class="token number">17832125</span>, <span class="token number">16619894</span>, <span class="token number">8822531</span>, <span class="token number">10139235</span>, <span class="token number">20299014</span>, <span class="token number">8350262</span>, <span class="token number">7119382</span>
 <span class="token number">19274521</span>, <span class="token number">13632738</span>, <span class="token number">11724962</span>, <span class="token number">20331945</span>, <span class="token number">19274523</span>, <span class="token number">9320130</span>, <span class="token number">16961614</span>
 <span class="token number">16961615</span>, <span class="token number">13775862</span>, <span class="token number">16961616</span>, <span class="token number">16961617</span>, <span class="token number">19006757</span>, <span class="token number">16961618</span>, <span class="token number">16961619</span>
 <span class="token number">18221699</span>, <span class="token number">9399589</span>, <span class="token number">14841459</span>, <span class="token number">9672816</span>, <span class="token number">9499302</span>, <span class="token number">20299021</span>, <span class="token number">9659614</span>, <span class="token number">13632743</span>
 <span class="token number">9949948</span>, <span class="token number">14220725</span>, <span class="token number">8882576</span>, <span class="token number">7612454</span>, <span class="token number">7111619</span>, <span class="token number">9711859</span>, <span class="token number">9714832</span>, <span class="token number">12780098</span>
 <span class="token number">13561951</span>, <span class="token number">14665116</span>, <span class="token number">11066597</span>, <span class="token number">16703112</span>, <span class="token number">19231857</span>, <span class="token number">17721717</span>, <span class="token number">9713537</span>
 <span class="token number">14459552</span>, <span class="token number">19458377</span>, <span class="token number">13737773</span>, <span class="token number">13737775</span>, <span class="token number">16212405</span>, <span class="token number">18096714</span>, <span class="token number">16338983</span>
 <span class="token number">14390396</span>, <span class="token number">10249537</span>, <span class="token number">19006849</span>, <span class="token number">7115910</span>, <span class="token number">8354642</span>, <span class="token number">7602341</span>, <span class="token number">14076510</span>
 <span class="token number">12565867</span>, <span class="token number">15987029</span>, <span class="token number">16462834</span>, <span class="token number">18641419</span>, <span class="token number">11693109</span>, <span class="token number">14023636</span>, <span class="token number">9024850</span>
 <span class="token number">8394351</span>, <span class="token number">8224558</span>, <span class="token number">17082365</span>, <span class="token number">14149782</span>, <span class="token number">9109487</span>, <span class="token number">14841558</span>, <span class="token number">9171933</span>
 <span class="token number">10173237</span>, <span class="token number">16817117</span>, <span class="token number">10068982</span>, <span class="token number">10306945</span>, <span class="token number">8666117</span>, <span class="token number">11725006</span>, <span class="token number">10214450</span>
 <span class="token number">14205448</span>, <span class="token number">17082371</span>, <span class="token number">9767674</span>, <span class="token number">16306019</span>, <span class="token number">9323583</span>, <span class="token number">9726739</span>, <span class="token number">16279211</span>
 <span class="token number">8412426</span>, <span class="token number">10326338</span>, <span class="token number">10165083</span>, <span class="token number">6651220</span>, <span class="token number">9145204</span>, <span class="token number">13554409</span>, <span class="token number">11076894</span>
 <span class="token number">19854436</span>, <span class="token number">11893577</span>, <span class="token number">17865671</span>, <span class="token number">16746190</span>, <span class="token number">14492313</span>, <span class="token number">14492314</span>, <span class="token number">11814891</span>
 <span class="token number">14492315</span>, <span class="token number">14492316</span>, <span class="token number">16742123</span>, <span class="token number">21048089</span>, <span class="token number">16864562</span>, <span class="token number">14546638</span>, <span class="token number">12419258</span>
 <span class="token number">16056270</span>, <span class="token number">10010310</span>, <span class="token number">18139709</span>, <span class="token number">9689310</span>, <span class="token number">9390484</span>, <span class="token number">21048090</span>, <span class="token number">21048091</span>
 <span class="token number">9963497</span>, <span class="token number">12551700</span>, <span class="token number">16362358</span>, <span class="token number">12551701</span>, <span class="token number">17465584</span>, <span class="token number">12551702</span>, <span class="token number">12551703</span>
 <span class="token number">12551704</span>, <span class="token number">10076669</span>, <span class="token number">12551705</span>, <span class="token number">16270946</span>, <span class="token number">12551706</span>, <span class="token number">12551707</span>, <span class="token number">6076890</span>
 <span class="token number">9308296</span>, <span class="token number">12551708</span>, <span class="token number">14258925</span>, <span class="token number">12880299</span>, <span class="token number">17381900</span>, <span class="token number">18641451</span>, <span class="token number">17381901</span>
 <span class="token number">17381902</span>, <span class="token number">11790175</span>, <span class="token number">12796518</span>, <span class="token number">9772888</span>, <span class="token number">8650138</span>, <span class="token number">17056813</span>, <span class="token number">14469008</span>
 <span class="token number">12551710</span>, <span class="token number">10092858</span>, <span class="token number">7519406</span>, <span class="token number">9821321</span>, <span class="token number">8771916</span>, <span class="token number">13349665</span>, <span class="token number">7509714</span>
 <span class="token number">10159846</span>, <span class="token number">13257247</span>, <span class="token number">18031728</span>, <span class="token number">18641461</span>, <span class="token number">16372203</span>, <span class="token number">11792865</span>, <span class="token number">19007266</span>
 <span class="token number">19309466</span>, <span class="token number">16309604</span>, <span class="token number">16309605</span>, <span class="token number">16309606</span>, <span class="token number">18522511</span>, <span class="token number">8966823</span>, <span class="token number">11674645</span>
 <span class="token number">17551414</span>, <span class="token number">15877957</span>, <span class="token number">15877958</span>, <span class="token number">7026523</span>, <span class="token number">15877959</span>, <span class="token number">17716305</span>, <span class="token number">13503598</span>
 <span class="token number">18767250</span>, <span class="token number">9150282</span>, <span class="token number">9448311</span>, <span class="token number">10327179</span>, <span class="token number">14774730</span>, <span class="token number">19153980</span>, <span class="token number">9735237</span>
 <span class="token number">9952230</span>, <span class="token number">15877960</span>, <span class="token number">15877961</span>, <span class="token number">15877962</span>, <span class="token number">15877963</span>, <span class="token number">8660422</span>, <span class="token number">18221700</span>
 <span class="token number">18221701</span>, <span class="token number">16279401</span>, <span class="token number">14546673</span>, <span class="token number">14105702</span>, <span class="token number">14105703</span>, <span class="token number">14105704</span>, <span class="token number">13483152</span>
 <span class="token number">14269955</span>, <span class="token number">17285560</span>, <span class="token number">12925532</span>, <span class="token number">12748240</span>, <span class="token number">9694101</span>, <span class="token number">12862186</span>, <span class="token number">12862187</span>
 <span class="token number">14727319</span>, <span class="token number">8211733</span>, <span class="token number">9586877</span>, <span class="token number">9548269</span>, <span class="token number">6694396</span>, <span class="token number">7710224</span>, <span class="token number">9337325</span>, <span class="token number">11856395</span>
 <span class="token number">10157402</span>, <span class="token number">15950541</span>, <span class="token number">19699191</span>, <span class="token number">6402302</span>, <span class="token number">10327190</span>, <span class="token number">10269717</span>, <span class="token number">13015379</span>
 <span class="token number">10017048</span>, <span class="token number">8546356</span>, <span class="token number">13561750</span>, <span class="token number">8821114</span>, <span class="token number">9770451</span>, <span class="token number">9360157</span>, <span class="token number">8488233</span>, <span class="token number">10132870</span>
 <span class="token number">4180770</span>, <span class="token number">9532911</span>, <span class="token number">7361418</span>, <span class="token number">6157713</span>, <span class="token number">9184754</span>, <span class="token number">8544696</span>, <span class="token number">17850678</span>, <span class="token number">8277300</span>
 <span class="token number">13343467</span>, <span class="token number">16382448</span>, <span class="token number">13791364</span>, <span class="token number">12419392</span>, <span class="token number">10208905</span>, <span class="token number">20236416</span>, <span class="token number">20236417</span>
 <span class="token number">20236418</span>, <span class="token number">20236419</span>, <span class="token number">7450366</span>, <span class="token number">8970313</span>, <span class="token number">6690853</span>, <span class="token number">6011045</span>, <span class="token number">10162036</span>, <span class="token number">10248542</span>
 <span class="token number">9469117</span>, <span class="token number">13359623</span>, <span class="token number">9952270</span>, <span class="token number">13343471</span>, <span class="token number">9842573</span>, <span class="token number">17381899</span>, <span class="token number">12710774</span>
 <span class="token number">20558005</span>, <span class="token number">10324526</span>, <span class="token number">9322219</span>, <span class="token number">8636407</span>, <span class="token number">12828105</span>, <span class="token number">19289642</span>, <span class="token number">13736501</span>
 <span class="token number">9824435</span>, <span class="token number">13736502</span>, <span class="token number">18681879</span>, <span class="token number">13736503</span>, <span class="token number">13736504</span>, <span class="token number">13736505</span>, <span class="token number">13736506</span>
 <span class="token number">9032322</span>, <span class="token number">13736507</span>, <span class="token number">14035825</span>, <span class="token number">19769505</span>, <span class="token number">11858315</span>, <span class="token number">14040433</span>, <span class="token number">13916709</span>
 <span class="token number">12827745</span>, <span class="token number">14038805</span>, <span class="token number">19567242</span>, <span class="token number">16721594</span>, <span class="token number">13923855</span>, <span class="token number">19567243</span>, <span class="token number">8528171</span>
 <span class="token number">9072105</span>, <span class="token number">19567244</span>, <span class="token number">11737047</span>

---

OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 升级数据库字典 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ORACLE_HOME</span>/rdbms/admin

sqlplus / as sysdba
SQL<span class="token operator">></span> startup
SQL<span class="token operator">></span> @catbundle.sql psu apply

-- Execute the next statement only <span class="token keyword">if</span> this is the first PSU applied <span class="token keyword">for</span> <span class="token number">10.2</span>.0.5 or this is the first PSU applied since <span class="token number">10.2</span>.0.5.3.
SQL<span class="token operator">></span> @utlrp.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 升级后检查 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> line <span class="token number">200</span>
col ACTION_TIME <span class="token keyword">for</span> a30
col <span class="token keyword">ACTION</span> <span class="token keyword">for</span> a20
col NAMESPACE <span class="token keyword">for</span> a10
col VERSION <span class="token keyword">for</span> a20
col BUNDLE_SERIES <span class="token keyword">for</span> a5
col COMMENTS <span class="token keyword">for</span> a25
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dba_registry_history<span class="token punctuation">;</span>

<span class="token comment">---</span>
ACTION_TIME                    <span class="token keyword">ACTION</span>               NAMESPACE  VERSION                      ID BUNDL COMMENTS
<span class="token comment">------------------------------ -------------------- ---------- -------------------- ---------- ----- -------------------------</span>
<span class="token number">14</span><span class="token operator">-</span>FEB<span class="token operator">-</span><span class="token number">22</span> <span class="token number">09.51</span><span class="token number">.58</span><span class="token number">.594897</span> AM   jvmpsu<span class="token punctuation">.</span><span class="token keyword">sql</span>           SERVER     <span class="token number">10.2</span><span class="token number">.0</span><span class="token number">.5</span><span class="token punctuation">.</span><span class="token number">2</span>OJVMBP              <span class="token number">0</span>       RAN jvmpsu<span class="token punctuation">.</span><span class="token keyword">sql</span>
<span class="token number">14</span><span class="token operator">-</span>FEB<span class="token operator">-</span><span class="token number">22</span> <span class="token number">09.52</span><span class="token number">.08</span><span class="token number">.639503</span> AM   jvmpsu<span class="token punctuation">.</span><span class="token keyword">sql</span>           SERVER     <span class="token number">10.2</span><span class="token number">.0</span><span class="token number">.5</span><span class="token punctuation">.</span><span class="token number">2</span>OJVMBP              <span class="token number">0</span>       RAN jvmpsu<span class="token punctuation">.</span><span class="token keyword">sql</span>
<span class="token number">14</span><span class="token operator">-</span>FEB<span class="token operator">-</span><span class="token number">22</span> <span class="token number">09.55</span><span class="token number">.41</span><span class="token number">.608731</span> AM   <span class="token keyword">APPLY</span>                SERVER     <span class="token number">10.2</span><span class="token number">.0</span><span class="token number">.5</span>                     <span class="token number">19</span> PSU   PSU <span class="token number">10.2</span><span class="token number">.0</span><span class="token number">.5</span><span class="token number">.19</span>

<span class="token number">3</span> <span class="token keyword">rows</span> selected<span class="token punctuation">.</span>
<span class="token comment">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 31718723_112040</title>
    <url>/blog/posts/4d1d7773.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 31718723 - Oracle Grid Infrastructure Patch Set Update 11.2.0.4.201020</p>
</blockquote>
<h1 id="p31718723-112040-Linux-x86-64"><a href="#p31718723-112040-Linux-x86-64" class="headerlink" title="p31718723_112040_Linux-x86-64"></a>p31718723_112040_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p31718723_112040_Linux-x86-64_README.html">p31718723_112040_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 34086870_190000</title>
    <url>/blog/posts/3f8c172e.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 34086870 - Oracle JavaVM Component Release Update 19.16.0.0.220719</p>
</blockquote>
<h1 id="p34086870-190000-Linux-x86-64"><a href="#p34086870-190000-Linux-x86-64" class="headerlink" title="p34086870_190000_Linux-x86-64"></a>p34086870_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p34086870_190000_Linux-x86-64_README.html">p34086870_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 32226239_190000</title>
    <url>/blog/posts/7442eb0a.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 32226239 - GI Release Update 19.10.0.0.210119</p>
</blockquote>
<h1 id="p32226239-190000-Linux-x86-64"><a href="#p32226239-190000-Linux-x86-64" class="headerlink" title="p32226239_190000_Linux-x86-64"></a>p32226239_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p32226239_190000_Linux-x86-64_README.html">p32226239_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 34130714_190000</title>
    <url>/blog/posts/c3410626.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 34130714 - GI Release Update 19.16.0.0.220719</p>
</blockquote>
<h1 id="p34130714-190000-Linux-x86-64"><a href="#p34130714-190000-Linux-x86-64" class="headerlink" title="p34130714_190000_Linux-x86-64"></a>p34130714_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p34130714_190000_Linux-x86-64_README.html">p34130714_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><blockquote>
<p>System Operation: RHEL 8.7<br>Database Software: 19.3.0.0.0 RAC with 3 nodes</p>
</blockquote>
<ol>
<li><p>Update OPatch utility version to <code>12.2.0.1.30</code> or later.</p>
<ul>
<li><a href="/blog/posts/8631a84d.html">Patch 6880880_190000 - record 2</a></li>
</ul>
</li>
<li><p>Validation of Oracle Inventory on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch lsinventory <span class="token parameter variable">-detail</span> <span class="token parameter variable">-oh</span> <span class="token variable">$ORACLE_HOME</span>
<span class="token punctuation">[</span>oracle@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch lsinventory <span class="token parameter variable">-detail</span> <span class="token parameter variable">-oh</span> <span class="token variable">$ORACLE_HOME</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Download and Unzip the Patch on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># chown grid:oinstall /soft/p34130714_190000_Linux-x86-64.zip</span>
<span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token function">unzip</span> <span class="token parameter variable">-q</span> /soft/p34130714_190000_Linux-x86-64.zip <span class="token parameter variable">-d</span> /soft<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Run OPatch Conflict Check on each node.</p>
<ul>
<li>As the Grid home user:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/34130714/34133642
<span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/34130714/34160635
<span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/34130714/34139601
<span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/34130714/34318175
<span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/34130714/33575402<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li>For Oracle home, as home user:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/34130714/34133642
<span class="token punctuation">[</span>oracle@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-phBaseDir</span> /soft/34130714/34160635<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Run OPatch System Space Check on each node.</p>
<ul>
<li><p>For Grid Infrastructure home, as home user:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token operator">></span> /tmp/patch_list_gihome.txt <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
/soft/34130714/34133642
/soft/34130714/34160635
/soft/34130714/34139601
/soft/34130714/34318175
/soft/34130714/33575402
EOF</span>

<span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckSystemSpace <span class="token parameter variable">-phBaseFile</span> /tmp/patch_list_gihome.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>For Oracle home, as home user:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19crac ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token operator">></span> /tmp/patch_list_dbhome.txt <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
/soft/34130714/34133642
/soft/34130714/34160635
EOF</span>

<span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckSystemSpace <span class="token parameter variable">-phBaseFile</span> /tmp/patch_list_dbhome.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p>One-off Patch Conflict Detection and Resolution on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/3413071</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Patch Installation Checks on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ cluvfy stage <span class="token parameter variable">-pre</span> patch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Patch Installation</p>
<ul>
<li>Case 1: Oracle RAC, where the Grid home and the Oracle homes are not shared and Oracle ACFS file system is not configured<br>As root user, execute the following command on each node of the cluster:<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/19.0.0/grid/OPatch/opatchauto apply /soft/34130714</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
</li>
<li><p>Patch Post Installation Instructions<br>After applying the patch, the sanity of the patching operation can be verified by issuing the <code>cluvfy stage -post patch</code> command from any of the cluster nodes upon completion of the patch application process.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@oracle19crac ~<span class="token punctuation">]</span>$ cluvfy stage <span class="token parameter variable">-post</span> patch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>List patches.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>grid@oracle19crac01 ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch lspatches
<span class="token number">34318175</span><span class="token punctuation">;</span>TOMCAT RELEASE UPDATE <span class="token number">19.0</span>.0.0.0 <span class="token punctuation">(</span><span class="token number">34318175</span><span class="token punctuation">)</span>
<span class="token number">34160635</span><span class="token punctuation">;</span>OCW RELEASE UPDATE <span class="token number">19.16</span>.0.0.0 <span class="token punctuation">(</span><span class="token number">34160635</span><span class="token punctuation">)</span>
<span class="token number">34139601</span><span class="token punctuation">;</span>ACFS RELEASE UPDATE <span class="token number">19.16</span>.0.0.0 <span class="token punctuation">(</span><span class="token number">34139601</span><span class="token punctuation">)</span>
<span class="token number">34133642</span><span class="token punctuation">;</span>Database Release Update <span class="token builtin class-name">:</span> <span class="token number">19.16</span>.0.0.220719 <span class="token punctuation">(</span><span class="token number">34133642</span><span class="token punctuation">)</span>
<span class="token number">33575402</span><span class="token punctuation">;</span>DBWLM RELEASE UPDATE <span class="token number">19.0</span>.0.0.0 <span class="token punctuation">(</span><span class="token number">33575402</span><span class="token punctuation">)</span>
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 34133642_190000</title>
    <url>/blog/posts/4422928f.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 34133642 - Database Release Update 19.16.0.0.220719</p>
</blockquote>
<h1 id="p34133642-190000-Linux-x86-64"><a href="#p34133642-190000-Linux-x86-64" class="headerlink" title="p34133642_190000_Linux-x86-64"></a>p34133642_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p34133642_190000_Linux-x86-64_README.html">p34133642_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><blockquote>
<p>System Operation: RHEL 8.7<br>Database Software: 19.3.0.0.0 Single Instance CDB</p>
</blockquote>
<ol>
<li><p>Check the current opatch version and patches.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/oracle/product/19.0.0/dbhome_1/OPatch/opatch version</span>
OPatch Version: <span class="token number">12.2</span>.0.1.17
OPatch succeeded.
<span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch lspatches
<span class="token number">29585399</span><span class="token punctuation">;</span>OCW RELEASE UPDATE <span class="token number">19.3</span>.0.0.0 <span class="token punctuation">(</span><span class="token number">29585399</span><span class="token punctuation">)</span>
<span class="token number">29517242</span><span class="token punctuation">;</span>Database Release Update <span class="token builtin class-name">:</span> <span class="token number">19.3</span>.0.0.190416 <span class="token punctuation">(</span><span class="token number">29517242</span><span class="token punctuation">)</span>
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Update OPatch utility version <code>12.2.0.1.30</code> or later to apply this patch.</p>
<ul>
<li><a href="/blog/posts/8631a84d.html">Patch 6880880_190000 - record 1</a></li>
</ul>
</li>
<li><p>Determine whether any currently installed interim patches conflict with the patch being installed, 34133642.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># chown oracle:oinstall /soft/p34133642_190000_Linux-x86-64.zip</span>
<span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ <span class="token function">unzip</span> <span class="token parameter variable">-q</span> <span class="token parameter variable">-d</span> /soft /soft/p34133642_190000_Linux-x86-64.zip
<span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /soft/34133642
<span class="token punctuation">[</span>oracle@oracle19cdg <span class="token number">34133642</span><span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch prereq CheckConflictAgainstOHWithDetail <span class="token parameter variable">-ph</span> ./<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>If this is not a RAC environment, shut down all instances and listeners associated with the Oracle home that you are updating.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ sqlplus / as sysdba

SQL*Plus: Release <span class="token number">19.0</span>.0.0.0 - Production on Mon May <span class="token number">29</span> <span class="token number">10</span>:25:27 <span class="token number">2023</span>
Version <span class="token number">19.3</span>.0.0.0

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2019</span>, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c Enterprise Edition Release <span class="token number">19.0</span>.0.0.0 - Production
Version <span class="token number">19.3</span>.0.0.0

SQL<span class="token operator">></span> <span class="token function">shutdown</span> immediate
Database closed.
Database dismounted.
ORACLE instance shut down.
SQL<span class="token operator">></span> <span class="token builtin class-name">exit</span>
Disconnected from Oracle Database 19c Enterprise Edition Release <span class="token number">19.0</span>.0.0.0 - Production
Version <span class="token number">19.3</span>.0.0.0
<span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ lsnrctl stop

LSNRCTL <span class="token keyword">for</span> Linux: Version <span class="token number">19.0</span>.0.0.0 - Production on <span class="token number">29</span>-MAY-2023 <span class="token number">10</span>:26:15

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1991</span>, <span class="token number">2019</span>, Oracle.  All rights reserved.

Connecting to <span class="token punctuation">(</span>DESCRIPTION<span class="token operator">=</span><span class="token punctuation">(</span>ADDRESS<span class="token operator">=</span><span class="token punctuation">(</span>PROTOCOL<span class="token operator">=</span>TCP<span class="token punctuation">)</span><span class="token punctuation">(</span>HOST<span class="token operator">=</span>oracle19cdg<span class="token punctuation">)</span><span class="token punctuation">(</span>PORT<span class="token operator">=</span><span class="token number">1521</span><span class="token punctuation">))</span><span class="token punctuation">)</span>
The <span class="token builtin class-name">command</span> completed successfully<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Opatch apply.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> /soft/34133642/
<span class="token punctuation">[</span>oracle@oracle19cdg <span class="token number">34133642</span><span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch apply
<span class="token punctuation">..</span>.
OPatch succeeded.
<span class="token punctuation">[</span>oracle@oracle19cdg <span class="token number">34133642</span><span class="token punctuation">]</span>$ 
<span class="token punctuation">[</span>oracle@oracle19cdg <span class="token number">34133642</span><span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/opatch lspatches
<span class="token number">34133642</span><span class="token punctuation">;</span>Database Release Update <span class="token builtin class-name">:</span> <span class="token number">19.16</span>.0.0.220719 <span class="token punctuation">(</span><span class="token number">34133642</span><span class="token punctuation">)</span>
<span class="token number">29585399</span><span class="token punctuation">;</span>OCW RELEASE UPDATE <span class="token number">19.3</span>.0.0.0 <span class="token punctuation">(</span><span class="token number">29585399</span><span class="token punctuation">)</span>
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Load Modified SQL Files into the Database. For each separate database running on the same shared Oracle home being patched, run the datapatch utility<br>For	Single&#x2F;Multitenant (CDB&#x2F;PDB) DB:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ sqlplus /nolog

SQL*Plus: Release <span class="token number">19.0</span>.0.0.0 - Production on Mon May <span class="token number">29</span> <span class="token number">11</span>:13:32 <span class="token number">2023</span>
Version <span class="token number">19.16</span>.0.0.0

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2022</span>, Oracle.  All rights reserved.

SQL<span class="token operator">></span> conn / as sysdba
Connected to an idle instance.
SQL<span class="token operator">></span>
SQL<span class="token operator">></span> startup
ORACLE instance started.

Total System Global Area <span class="token number">4177523144</span> bytes
Fixed Size                  <span class="token number">9142728</span> bytes
Variable Size             <span class="token number">788529152</span> bytes
Database Buffers         <span class="token number">3372220416</span> bytes
Redo Buffers                <span class="token number">7630848</span> bytes
Database mounted.
Database opened.
SQL<span class="token operator">></span>
SQL<span class="token operator">></span> alter pluggable database all <span class="token function">open</span><span class="token punctuation">;</span>

Pluggable database altered.

SQL<span class="token operator">></span>
SQL<span class="token operator">></span> quit
Disconnected from Oracle Database 19c Enterprise Edition Release <span class="token number">19.0</span>.0.0.0 - Production
Version <span class="token number">19.16</span>.0.0.0
<span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$
<span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/OPatch/datapatch <span class="token parameter variable">-verbose</span>
<span class="token punctuation">..</span>.
Installing patches<span class="token punctuation">..</span>.
Patch installation complete.  Total patches installed: <span class="token number">3</span>

Validating logfiles<span class="token punctuation">..</span>.done
Patch <span class="token number">34133642</span> apply <span class="token punctuation">(</span>pdb CDB<span class="token variable">$ROOT</span><span class="token punctuation">)</span>: SUCCESS
  logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/34133642/24865470/34133642_apply_COCO_CDBROOT_2023May29_11_17_15.log <span class="token punctuation">(</span>no errors<span class="token punctuation">)</span>
Patch <span class="token number">34133642</span> apply <span class="token punctuation">(</span>pdb PDB<span class="token variable">$SEED</span><span class="token punctuation">)</span>: SUCCESS
  logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/34133642/24865470/34133642_apply_COCO_PDBSEED_2023May29_11_27_29.log <span class="token punctuation">(</span>no errors<span class="token punctuation">)</span>
Patch <span class="token number">34133642</span> apply <span class="token punctuation">(</span>pdb PDB<span class="token punctuation">)</span>: SUCCESS
  logfile: /u01/app/oracle/cfgtoollogs/sqlpatch/34133642/24865470/34133642_apply_COCO_PDB_2023May29_11_27_29.log <span class="token punctuation">(</span>no errors<span class="token punctuation">)</span>

Automatic recompilation incomplete<span class="token punctuation">;</span> run utlrp.sql to revalidate.
  PDBs: PDB PDB<span class="token variable">$SEED</span>

SQL Patching tool complete on Mon May <span class="token number">29</span> <span class="token number">11</span>:34:59 <span class="token number">2023</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Check the following log files in <code>$ORACLE_BASE/cfgtoollogs/sqlpatch/34133642/&lt;unique patch ID&gt;</code> for errors</p>
</li>
<li><p>Any (pluggable) database that has invalid objects after the execution of datapatch should have <code>utlrp.sql</code> run to revalidate those objects.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@oracle19cdg ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> <span class="token variable">$ORACLE_HOME</span>/rdbms/admin
<span class="token punctuation">[</span>oracle@oracle19cdg admin<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/perl/bin/perl <span class="token variable">$ORACLE_HOME</span>/rdbms/admin/catcon.pl <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token parameter variable">-e</span> <span class="token parameter variable">-b</span> utlrp <span class="token parameter variable">-d</span> <span class="token variable">$ORACLE_HOME</span>/rdbms/admin utlrp.sql
catcon::set_log_file_base_path: ALL catcon-related output will be written to <span class="token punctuation">[</span>/u01/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/utlrp_catcon_18663.lst<span class="token punctuation">]</span>

catcon::set_log_file_base_path: catcon: See <span class="token punctuation">[</span>/u01/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/utlrp*.log<span class="token punctuation">]</span> files <span class="token keyword">for</span> output generated by scripts

catcon::set_log_file_base_path: catcon: See <span class="token punctuation">[</span>/u01/app/oracle/product/19.0.0/dbhome_1/rdbms/admin/utlrp_*.lst<span class="token punctuation">]</span> files <span class="token keyword">for</span> spool files, <span class="token keyword">if</span> any

catcon.pl: completed successfully
<span class="token punctuation">[</span>oracle@oracle19cdg admin<span class="token punctuation">]</span>$ sqlplus / as sysdba

SQL*Plus: Release <span class="token number">19.0</span>.0.0.0 - Production on Mon May <span class="token number">29</span> <span class="token number">11</span>:43:21 <span class="token number">2023</span>
Version <span class="token number">19.16</span>.0.0.0

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">1982</span>, <span class="token number">2022</span>, Oracle.  All rights reserved.

Connected to:
Oracle Database 19c Enterprise Edition Release <span class="token number">19.0</span>.0.0.0 - Production
Version <span class="token number">19.16</span>.0.0.0

SQL<span class="token operator">></span> alter session <span class="token builtin class-name">set</span> <span class="token assign-left variable">container</span><span class="token operator">=</span>pdb<span class="token punctuation">;</span>

Session altered.

SQL<span class="token operator">></span> SELECT count<span class="token punctuation">(</span>*<span class="token punctuation">)</span> FROM dba_objects WHERE status <span class="token operator">=</span> <span class="token string">'INVALID'</span><span class="token punctuation">;</span>

  COUNT<span class="token punctuation">(</span>*<span class="token punctuation">)</span>
----------
         <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 35042068_190000</title>
    <url>/blog/posts/c0198759.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 35042068 - Database Release Update 19.19.0.0.230418</p>
</blockquote>
<h1 id="p35042068-190000-Linux-x86-64"><a href="#p35042068-190000-Linux-x86-64" class="headerlink" title="p35042068_190000_Linux-x86-64"></a>p35042068_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p35042068_190000_Linux-x86-64_README.html">p35042068_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 35037840_190000</title>
    <url>/blog/posts/2b12b153.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 35037840 - GI Release Update 19.19.0.0.230418</p>
</blockquote>
<h1 id="p35037840-190000-Linux-x86-64"><a href="#p35037840-190000-Linux-x86-64" class="headerlink" title="p35037840_190000_Linux-x86-64"></a>p35037840_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p35037840_190000_Linux-x86-64_README.html">p35037840_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 35050341_190000</title>
    <url>/blog/posts/d95efa59.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 35050341 - Oracle JavaVM Component Release Update 19.19.0.0.230418</p>
</blockquote>
<h1 id="p35050341-190000-Linux-x86-64"><a href="#p35050341-190000-Linux-x86-64" class="headerlink" title="p35050341_190000_Linux-x86-64"></a>p35050341_190000_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p35050341_190000_Linux-x86-64_README.html">p35050341_190000_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><p> 检查 OJVM 是否安装及使用，未安装或未使用时，不进行 OJVM 补丁更新。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> version<span class="token punctuation">,</span> <span class="token keyword">status</span> <span class="token keyword">FROM</span> dba_registry <span class="token keyword">WHERE</span> comp_id<span class="token operator">=</span><span class="token string">'JAVAVM'</span><span class="token punctuation">;</span>

VERSION                        <span class="token keyword">STATUS</span>
<span class="token comment">------------------------------ --------------------------------------------</span>
<span class="token number">19.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token number">.0</span>                     VALID

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> x$kglob <span class="token keyword">where</span> KGLOBTYP <span class="token operator">=</span> <span class="token number">29</span> <span class="token operator">OR</span> KGLOBTYP <span class="token operator">=</span> <span class="token number">56</span><span class="token punctuation">;</span>

  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token comment">----------</span>
         <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 4547809_92080</title>
    <url>/blog/posts/3b32a604.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 4547809 - Release 2 (9.2.0.8) Patch Set 7</p>
</blockquote>
<h1 id="p4547809-92080-Linux-x86-64"><a href="#p4547809-92080-Linux-x86-64" class="headerlink" title="p4547809_92080_Linux-x86-64"></a>p4547809_92080_Linux-x86-64</h1><ul>
<li><a href="/blog/assets/html/p4547809_92080_Linux-x86-64_README.html">p4547809_92080_Linux-x86-64_README</a></li>
</ul>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><h1 id="p4547809-92080-Linux-x86"><a href="#p4547809-92080-Linux-x86" class="headerlink" title="p4547809_92080_Linux-x86"></a>p4547809_92080_Linux-x86</h1><ul>
<li><a href="/blog/assets/html/p4547809_92080_Linux-x86_README.html">p4547809_92080_Linux-x86_README</a></li>
</ul>
<h2 id="Record-1"><a href="#Record-1" class="headerlink" title="Record"></a>Record</h2>]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Patch 6880880_190000</title>
    <url>/blog/posts/8631a84d.html</url>
    <content><![CDATA[<blockquote>
<p>Patch 6880880 - OPatch for DB 19.0.0.0.0</p>
</blockquote>
<h1 id="p6880880-190000-Linux-x86-64"><a href="#p6880880-190000-Linux-x86-64" class="headerlink" title="p6880880_190000_Linux-x86-64"></a>p6880880_190000_Linux-x86-64</h1><h2 id="Update-OPatch-Utility"><a href="#Update-OPatch-Utility" class="headerlink" title="Update OPatch Utility"></a>Update OPatch Utility</h2><p>To update Opatch, use the following instructions:</p>
<ol>
<li>Download the OPatch utility to a temporary directory.</li>
<li>For each Oracle RAC database home and the GI home that are being patched, run the following commands as the home owner to extract the OPatch utility.<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">unzip</span> <span class="token operator">&lt;</span>OPATCH-ZIP<span class="token operator">></span> <span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>ORACLE_HOME<span class="token operator">></span>
$ <span class="token operator">&lt;</span>ORACLE_HOME<span class="token operator">></span>/OPatch/opatch version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="Record-1-Update-OPatch-utility-version-to-12-2-0-1-32-for-Single-Instance"><a href="#Record-1-Update-OPatch-utility-version-to-12-2-0-1-32-for-Single-Instance" class="headerlink" title="Record 1: Update OPatch utility version to 12.2.0.1.32 for Single Instance"></a>Record 1: Update OPatch utility version to 12.2.0.1.32 for Single Instance</h2><p>Check the current opatch version.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/oracle/product/19.0.0/dbhome_1/OPatch/opatch version</span>
OPatch Version: <span class="token number">12.2</span>.0.1.17
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Take a backup of <code>ORACLE_HOME/OPatch</code>.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># mv /u01/app/oracle/product/19.0.0/dbhome_1/OPatch&#123;,.bak.`date +%m%d`&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Unzip the OPatch downloaded zip into <code>ORACLE_HOME</code> directory.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># unzip -q /soft/p6880880_190000_Linux-x86-64.zip -d /u01/app/oracle/product/19.0.0/dbhome_1/</span>
<span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># chown -R oracle:oinstall /u01/app/oracle/product/19.0.0/dbhome_1/OPatch</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Check the version of the opatch utility on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># ls -ld /u01/app/oracle/product/19.0.0/dbhome_1/OPatch</span>
drwxr-x--- <span class="token number">15</span> oracle oinstall <span class="token number">4096</span> Jul  <span class="token number">4</span>  <span class="token number">2022</span> /u01/app/oracle/product/19.0.0/dbhome_1/OPatch
<span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@oracle19cdg ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/oracle/product/19.0.0/dbhome_1/OPatch/opatch version</span>
OPatch Version: <span class="token number">12.2</span>.0.1.32
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Record-2-Update-OPatch-utility-version-to-12-2-0-1-32-for-RAC"><a href="#Record-2-Update-OPatch-utility-version-to-12-2-0-1-32-for-RAC" class="headerlink" title="Record 2: Update OPatch utility version to 12.2.0.1.32 for RAC"></a>Record 2: Update OPatch utility version to 12.2.0.1.32 for RAC</h2><p>Check the current opatch version on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/19.0.0/grid/OPatch/opatch version</span>
OPatch Version: <span class="token number">12.2</span>.0.1.17
OPatch succeeded.
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/oracle/product/19.0.0/dbhome_1/OPatch/opatch version</span>
OPatch Version: <span class="token number">12.2</span>.0.1.17
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Take a backup of <code>ORACLE_HOME/OPatch</code> on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># mv /u01/app/19.0.0/grid/OPatch&#123;,.bak.`date +%m%d`&#125;</span>
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># mv /u01/app/oracle/product/19.0.0/dbhome_1/OPatch&#123;,.bak.`date +%m%d`&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Unzip the OPatch downloaded zip into <code>ORACLE_HOME</code> directory on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># unzip -q /soft/p6880880_190000_Linux-x86-64.zip -d /u01/app/19.0.0/grid/</span>
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># chown -R grid:oinstall /u01/app/19.0.0/grid/OPatch</span>
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># unzip -q /soft/p6880880_190000_Linux-x86-64.zip -d /u01/app/oracle/product/19.0.0/dbhome_1/</span>
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># chown -R oracle:oinstall /u01/app/oracle/product/19.0.0/dbhome_1/OPatch</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Check the version of the opatch utility on each node.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># ls -ld /u01/app/19.0.0/grid/OPatch</span>
drwxr-x--- <span class="token number">15</span> grid oinstall <span class="token number">4096</span> Jul  <span class="token number">4</span>  <span class="token number">2022</span> /u01/app/19.0.0/grid/OPatch
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># ls -ld /u01/app/oracle/product/19.0.0/dbhome_1/OPatch</span>
drwxr-x--- <span class="token number">15</span> oracle oinstall <span class="token number">4096</span> Jul  <span class="token number">4</span>  <span class="token number">2022</span> /u01/app/oracle/product/19.0.0/dbhome_1/OPatch
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/19.0.0/grid/OPatch/opatch version</span>
OPatch Version: <span class="token number">12.2</span>.0.1.32
OPatch succeeded.
<span class="token punctuation">[</span>root@oracle19crac ~<span class="token punctuation">]</span><span class="token comment"># /u01/app/oracle/product/19.0.0/dbhome_1/OPatch/opatch version</span>
OPatch Version: <span class="token number">12.2</span>.0.1.32
OPatch succeeded.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>Update</category>
      </categories>
      <tags>
        <tag>patch</tag>
      </tags>
  </entry>
  <entry>
    <title>Prerequisites</title>
    <url>/blog/posts/8037a8c2.html</url>
    <content><![CDATA[<ol>
<li><p> 平台字节序和字符集，不支持 Windows 平台，源端与目标端的字符集需相同 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询平台和字节序 </span>
col PLATFORM_NAME format a30
<span class="token keyword">SELECT</span> d<span class="token punctuation">.</span>PLATFORM_ID<span class="token punctuation">,</span>d<span class="token punctuation">.</span>PLATFORM_NAME<span class="token punctuation">,</span> tp<span class="token punctuation">.</span>ENDIAN_FORMAT
 <span class="token keyword">FROM</span> V$TRANSPORTABLE_PLATFORM tp<span class="token punctuation">,</span> V$<span class="token keyword">DATABASE</span> d
 <span class="token keyword">WHERE</span> tp<span class="token punctuation">.</span>PLATFORM_NAME <span class="token operator">=</span> d<span class="token punctuation">.</span>PLATFORM_NAME<span class="token punctuation">;</span>

<span class="token comment">-- 查询字符集 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> nls_database_parameters <span class="token keyword">where</span> parameter <span class="token operator">like</span> <span class="token string">'%CHARACTERSET%'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> userenv<span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 数据库时区，源端与目标端的时区需相同 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> dbtimezone <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 数据库版本及补丁，源端 ≥10.2.0.3 企业版，目标端 ≥11.2.0.4 企业版 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$version<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dba_registry_history<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 数据库组件，目标端需要包含源端的所有组件 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> comp_id<span class="token punctuation">,</span>comp_name<span class="token punctuation">,</span>version<span class="token punctuation">,</span><span class="token keyword">status</span> <span class="token keyword">from</span> dba_registry<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p> 归档模式，源端需开启归档模式 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">archive log list<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>compatible 参数和 db_files 参数，源端 compatible 参数需要设置为 ≥10.2.0，目标端 compatible 参数和 db_files 参数要 ≥ 源端 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> parameter compatible<span class="token punctuation">;</span>
<span class="token keyword">show</span> parameter db_files<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 需要迁移的表空间和用户 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> TABLESPACE_NAME<span class="token punctuation">,</span>BLOCK_SIZE<span class="token punctuation">,</span>CONTENTS<span class="token punctuation">,</span><span class="token keyword">STATUS</span>
 <span class="token keyword">from</span> dba_tablespaces
 <span class="token keyword">where</span> tablespace_name <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'EXAMPLE'</span><span class="token punctuation">,</span><span class="token string">'SCOTT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> owner<span class="token punctuation">,</span>tablespace_name<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
 <span class="token keyword">from</span> dba_segments 
 <span class="token keyword">where</span> tablespace_name <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'EXAMPLE'</span><span class="token punctuation">,</span><span class="token string">'SCOTT'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span>tablespace_name <span class="token keyword">order</span> <span class="token keyword">by</span> tablespace_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 确保需要迁移的表空间处于联机可读写模式 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> tablespace_name<span class="token punctuation">,</span><span class="token keyword">status</span> <span class="token keyword">from</span> dba_tablespaces
 <span class="token keyword">where</span> tablespace_name <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'EXAMPLE'</span><span class="token punctuation">,</span><span class="token string">'SCOTT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 表空间自包含检查 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 自包含检查 </span>
<span class="token keyword">execute</span> dbms_tts<span class="token punctuation">.</span>transport_set_check<span class="token punctuation">(</span><span class="token string">'TBS_COCO,ITPUX01,ITPUX02,ITPUX03'</span><span class="token punctuation">,</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 查看结果，结果为空，表示自包含 </span>
col violations <span class="token keyword">for</span> a70
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>transport_set_violations<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 获取用户及其权限的 SQL</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> LONG <span class="token number">9999</span>
<span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_DDL<span class="token punctuation">(</span><span class="token string">'USER'</span><span class="token punctuation">,</span> USERNAME<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">';'</span> DDL_SQL
 <span class="token keyword">FROM</span> DBA_USERS <span class="token keyword">WHERE</span> USERNAME
 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">select</span> owner  <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span> tablespace_name <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'EXAMPLE'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span>tablespace_name<span class="token punctuation">)</span> <span class="token operator">AND</span> USERNAME <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'SCOTT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_GRANTED_DDL<span class="token punctuation">(</span><span class="token string">'SYSTEM_GRANT'</span><span class="token punctuation">,</span> USERNAME<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">';'</span> DDL_SQL
 <span class="token keyword">FROM</span> DBA_USERS <span class="token keyword">WHERE</span> USERNAME
 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">select</span> owner  <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span>  tablespace_name <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'EXAMPLE'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span>tablespace_name<span class="token punctuation">)</span> <span class="token operator">AND</span> USERNAME <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'SCOTT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_GRANTED_DDL<span class="token punctuation">(</span><span class="token string">'ROLE_GRANT'</span><span class="token punctuation">,</span> USERNAME<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">';'</span> DDL_SQL
 <span class="token keyword">FROM</span> DBA_USERS <span class="token keyword">WHERE</span> USERNAME
 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">select</span> owner  <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span>  tablespace_name <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'EXAMPLE'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span>tablespace_name<span class="token punctuation">)</span> <span class="token operator">AND</span> USERNAME <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'SCOTT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_GRANTED_DDL<span class="token punctuation">(</span><span class="token string">'OBJECT_GRANT'</span><span class="token punctuation">,</span> USERNAME<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">';'</span> DDL_SQL
 <span class="token keyword">FROM</span> DBA_USERS <span class="token keyword">WHERE</span> USERNAME
 <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">select</span> owner  <span class="token keyword">from</span> dba_segments <span class="token keyword">where</span>  tablespace_name <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'EXAMPLE'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span>tablespace_name<span class="token punctuation">)</span> <span class="token operator">AND</span> USERNAME <span class="token operator">NOT</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'SCOTT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 对象数量统计 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 需要迁移的对象和数量 </span>
<span class="token keyword">select</span> owner<span class="token punctuation">,</span> object_type<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
 <span class="token keyword">from</span> dba_objects
 <span class="token keyword">where</span> object_name <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'BIN%'</span>
 <span class="token operator">and</span> owner <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'COCO'</span><span class="token punctuation">,</span><span class="token string">'ITPUX01'</span><span class="token punctuation">,</span><span class="token string">'ITPUX02'</span><span class="token punctuation">,</span><span class="token string">'ITPUX03'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span> object_type
 <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token keyword">desc</span><span class="token punctuation">;</span>

<span class="token comment">-- 无效对象 </span>
<span class="token keyword">select</span> owner<span class="token punctuation">,</span> object_type<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
 <span class="token keyword">from</span> dba_objects
<span class="token keyword">where</span> <span class="token keyword">status</span> <span class="token operator">&lt;></span> <span class="token string">'VALID'</span>
 <span class="token operator">and</span> owner <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'COCO'</span><span class="token punctuation">,</span><span class="token string">'ITPUX01'</span><span class="token punctuation">,</span><span class="token string">'ITPUX02'</span><span class="token punctuation">,</span><span class="token string">'ITPUX03'</span><span class="token punctuation">)</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span> object_type
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">desc</span><span class="token punctuation">;</span>

<span class="token comment">-- 非业务用户下是否有业务数据 </span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
 <span class="token keyword">FROM</span> dba_objects d
 <span class="token keyword">where</span> d<span class="token punctuation">.</span>created <span class="token operator">>=</span> sysdate <span class="token operator">-</span> <span class="token number">10</span>
 <span class="token operator">and</span> d<span class="token punctuation">.</span>object_name <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'WR%'</span>
 <span class="token operator">and</span> d<span class="token punctuation">.</span>owner <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'SYSTEM'</span><span class="token punctuation">)</span>
 <span class="token keyword">order</span> <span class="token keyword">by</span> d<span class="token punctuation">.</span>created <span class="token keyword">desc</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 开启块跟踪 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$block_change_tracking<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">enable</span> block change tracking <span class="token keyword">using</span> <span class="token keyword">file</span> <span class="token string">'+DATA'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p> 目标端调整 job 参数，防止 job 调度任务，修改迁移后的数据 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> system <span class="token keyword">set</span> job_queue_processes<span class="token operator">=</span><span class="token number">0</span> sid<span class="token operator">=</span><span class="token string">'*'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
        <tag>prerequisites</tag>
      </tags>
  </entry>
  <entry>
    <title>Using dbms_file_transfer</title>
    <url>/blog/posts/356a1bee.html</url>
    <content><![CDATA[<p>All steps in this procedure are run as the <strong>oracle user</strong> that is a member of the OSDBA group. OS authentication is used to connect to both the source and destination databases.</p>
<ol>
<li><p>Initial Setup</p>
<p>1.1 创建 xtts 目录，解压 rman_xttconvert_v3.zip 软件包 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/oracle/xtts/backup
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/oracle/xtts/backup_incr
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/oracle/xtts/scripts
<span class="token builtin class-name">cd</span> /home/oracle/xtts
<span class="token function">unzip</span> rman_xttconvert_v3.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.2 配置 xtt.properties 参数 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> xtt.properties <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03
platformid=13
srcdir=SOURCEDIR
dstdir=DESTDIR
srclink=ttslink
# dfcopydir=/home/oracle/xtts/backup
backupformat=/home/oracle/xtts/backup_incr
stageondest=/home/oracle/xtts/backup
storageondest=+DATA/coco/pdb
backupondest=/home/oracle/xtts/backup_incr
asm_home=/u01/app/19.0.0/grid
asm_sid=+ASM
parallel=3
rollparallel=2
getfileparallel=4
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.3 （可选）目标端配置临时实例用于增量备份恢复，目标端 11.2.0.4 及以上跳过此步骤 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>xtts
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> <span class="token variable">$ORACLE_HOME</span>/dbs/init<span class="token variable">$ORACLE_SID</span>.ora</span>
db_name=xtts
compatible=19.0.0
EOF</span>

sqlplus / as sysdba
SQL<span class="token operator">></span> startup nomount<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.4 目标端创建连接源端的 dblink</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">public</span> <span class="token keyword">database</span> link ttslink <span class="token keyword">connect</span> <span class="token keyword">to</span> system identified <span class="token keyword">by</span> oracle
 <span class="token keyword">using</span> <span class="token string">'(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.184.145)(PORT = 1521))  ) (CONNECT_DATA = (SERVICE_NAME = coco) ) )'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>1.5 创建数据库目录 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 源端创建 SOURCEDIR</span>
<span class="token keyword">create</span> directory SOURCEDIR <span class="token keyword">as</span> <span class="token string">'+DATA/coco'</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">on</span> directory SOURCEDIR <span class="token keyword">to</span> <span class="token keyword">public</span><span class="token punctuation">;</span>

<span class="token comment">-- 目标端创建 DESTDIR</span>
<span class="token keyword">create</span> directory DESTDIR <span class="token keyword">as</span> <span class="token string">'+DATA/coco/pdb'</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">on</span> directory DESTDIR <span class="token keyword">to</span> <span class="token keyword">public</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.6 源端和目标端设置临时目录 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">TMPDIR</span><span class="token operator">=</span>/home/oracle/xtts/scripts
<span class="token punctuation">[</span>oracle@dest<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">TMPDIR</span><span class="token operator">=</span>/home/oracle/xtts/scripts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Prepare Phase for dbms_file_transfer Method</p>
<p>2.1 源端执行以下命令，创建 getfile.sql 和 xttnewdatafiles.txt 文件 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-S</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.2 拷贝 getfile.sql 和 xttnewdatafiles.txt 文件文件至目标端 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/getfile.sql oracle@dest:<span class="token variable">$TMPDIR</span>
<span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/xttnewdatafiles.txt oracle@dest:<span class="token variable">$TMPDIR</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>2.3 目标端进行数据文件拷贝 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-G</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Roll Forward Phase</p>
<p>3.1 源端生成增量备份文件至 <code>backupformat</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-i</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.2 拷贝增量备份文件、xttplan、tsbkupmap 至目标端 <code>stageondest</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $TMPDIR/incrbackups.txt<span class="token variable">`</span></span> oracle@dest:/home/oracle/xtts/backup
<span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/xttplan.txt oracle@des:<span class="token variable">$TMPDIR</span>
<span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="token variable">$TMPDIR</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>3.3 目标端做增量前滚 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-r</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.4 源端确定下一个增量备份的 FROM_SCN</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-s</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.5 Repeat the Roll Forward Phase (Phase 3)</p>
</li>
<li><p>Transport Phase</p>
<p>4.1 源端将表空间置为只读模式 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'ALTER TABLESPACE'</span><span class="token operator">||</span>name<span class="token operator">||</span><span class="token string">'READ ONLY;'</span> exec_sql
 <span class="token keyword">from</span> v$<span class="token keyword">tablespace</span> <span class="token keyword">where</span> NAME <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'USERS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> tablespace_name<span class="token punctuation">,</span><span class="token keyword">status</span> <span class="token keyword">from</span> dba_tablespaces<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>4.2 重复步骤 3.1 - 3.3，做最后一次增量前滚 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-i</span>

<span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $TMPDIR/incrbackups.txt<span class="token variable">`</span></span> oracle@dest:/home/oracle/xtts/backup

<span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/xttplan.txt oracle@dest:<span class="token variable">$TMPDIR</span>
<span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="token variable">$TMPDIR</span>

<span class="token punctuation">[</span>oracle@dest<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-r</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Import Object Metadata into Destination Database</p>
<p>5.1 目标端创建业务用户 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX01"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:98BB089CD1A16CBD4803C404C3279A570D607F667DD6E5EB7A19735B7FA6;358208C73FF2939C'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"COCO"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:37AB55E527FC21D62DEA2949499DD9D9F7EC2A5C97C9140A23ADEBB365BD;96B138098030A3C8'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX02"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:21BC086145990A7CC133F01E0D80B7548EA49DB694F44E972CEC33685168;499779BC208401AE'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX03"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:4C2C70077865FBFE627E08288E24FC9307DAF72DAC9C36EA9D31AE332263;CE4FDA4704D50F9C'</span><span class="token punctuation">;</span>

<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX01"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX02"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX03"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>5.2 目标端生成 Data Pump TTS 命令 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-e</span>
<span class="token function">cat</span> <span class="token variable">$TMPDIR</span>/xttplugin.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5.3 迁移表空间元数据 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">impdp system/oracle@pdb <span class="token assign-left variable">directory</span><span class="token operator">=</span>DATA_PUMP_DIR <span class="token assign-left variable">logfile</span><span class="token operator">=</span>tts_imp.log <span class="token punctuation">\</span>
<span class="token assign-left variable">network_link</span><span class="token operator">=</span>ttslink <span class="token assign-left variable">transport_full_check</span><span class="token operator">=</span>no <span class="token punctuation">\</span>
<span class="token assign-left variable">exclude</span><span class="token operator">=</span>statistics <span class="token punctuation">\</span>
<span class="token assign-left variable">transport_tablespaces</span><span class="token operator">=</span>TBS_COCO,ITPUX01,ITPUX02,ITPUX03 <span class="token punctuation">\</span>
<span class="token assign-left variable">transport_datafiles</span><span class="token operator">=</span><span class="token string">'+DATA/coco/pdb/tbs_coco01.dbf'</span>,<span class="token string">'+DATA/coco/pdb/itpux01.dbf'</span>,<span class="token string">'+DATA/coco/pdb/itpux02.dbf'</span>,<span class="token string">'+DATA/coco/pdb/itpux03.dbf'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>5.4 迁移存储过程、触发器、函数、包、视图、序列 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">impdp system/oracle@pdb <span class="token assign-left variable">directory</span><span class="token operator">=</span>DATA_PUMP_DIR <span class="token punctuation">\</span>
<span class="token assign-left variable">network_link</span><span class="token operator">=</span>ttslink <span class="token assign-left variable">schemas</span><span class="token operator">=</span>COCO,ITPUX01,ITPUX02,ITPUX03 <span class="token assign-left variable">content</span><span class="token operator">=</span>metadata_only <span class="token assign-left variable">exclude</span><span class="token operator">=</span>index,table <span class="token assign-left variable">parallel</span><span class="token operator">=</span><span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5.5 导入同义词、dblink 和其他对象 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-- 导入公共同义词
<span class="token builtin class-name">set</span> long <span class="token number">9999</span>
<span class="token keyword">select</span> dbms_metadata.get_ddl<span class="token punctuation">(</span><span class="token string">'SYNONYM'</span>,SYNONYM_NAME,OWNER<span class="token punctuation">)</span>
 FROM dba_synonyms where <span class="token assign-left variable">owner</span><span class="token operator">=</span><span class="token string">'PUBLIC'</span> and table_owner <span class="token keyword">in</span>  <span class="token punctuation">(</span><span class="token string">'COCO'</span>,<span class="token string">'ITPUX01'</span>,<span class="token string">'ITPUX02'</span>,<span class="token string">'ITPUX03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

-- 导入 dblink
<span class="token builtin class-name">set</span> long <span class="token number">9999</span>
<span class="token keyword">select</span> dbms_metadata.get_ddl<span class="token punctuation">(</span><span class="token string">'DB_LINK'</span>,DB_LINK,OWNER<span class="token punctuation">)</span> FROM DBA_DB_LINKS<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Post-migration</p>
<p>6.1 检查数据库一致性 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> owner<span class="token punctuation">,</span> object_type<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
 <span class="token keyword">from</span> dba_objects
 <span class="token keyword">where</span> object_name <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'BIN%'</span>
 <span class="token operator">and</span> owner <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'COCO'</span><span class="token punctuation">,</span><span class="token string">'ITPUX01'</span><span class="token punctuation">,</span><span class="token string">'ITPUX02'</span><span class="token punctuation">,</span><span class="token string">'ITPUX03'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span> object_type
 <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token keyword">desc</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>6.2 业务用户修改权限和默认表空间 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX01"</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"ITPUX01"</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TEMP"</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX02"</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"ITPUX02"</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TEMP"</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX03"</span> EFAULT <span class="token keyword">TABLESPACE</span> <span class="token string">"ITPUX03"</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"COCO"</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TBS_COCO"</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TEMP"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> UNLIMITED <span class="token keyword">TABLESPACE</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX01"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> UNLIMITED <span class="token keyword">TABLESPACE</span> <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> UNLIMITED <span class="token keyword">TABLESPACE</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX02"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">CREATE</span> JOB <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> <span class="token string">"COCO"</span><span class="token punctuation">.</span><span class="token string">"TESTTABLE"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX01"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token string">"SYS"</span><span class="token punctuation">.</span><span class="token string">"DBA_USERS"</span> <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>6.3 表空间置为读写模式 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'ALTER TABLESPACE'</span><span class="token operator">||</span>name<span class="token operator">||</span><span class="token string">'READ WRITE;'</span> exec_sql <span class="token keyword">from</span> v$<span class="token keyword">tablespace</span>
 <span class="token keyword">where</span> NAME <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'USERS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>6.4 校验数据文件完整性 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">RMAN<span class="token operator">></span> validate <span class="token keyword">tablespace</span> COCO<span class="token punctuation">,</span>ITPUX01<span class="token punctuation">,</span>ITPUX02<span class="token punctuation">,</span>ITPUX03 <span class="token keyword">check</span> logical<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>6.5 收集统计信息 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>gather_database_stats<span class="token punctuation">(</span>degree <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>gather_dictionary_stats<span class="token punctuation">(</span>degree <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>gather_fixed_objects_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>Using Recovery Manager</title>
    <url>/blog/posts/21719ab3.html</url>
    <content><![CDATA[<p>All steps in this procedure are run as the <strong>oracle user</strong> that is a member of the OSDBA group. OS authentication is used to connect to both the source and destination databases.</p>
<ol>
<li><p>Initial Setup</p>
<p>1.1 创建 xtts 目录，解压 rman_xttconvert_v3.zip 软件包 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/oracle/xtts/backup
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/oracle/xtts/backup_incr
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/oracle/xtts/scripts
<span class="token builtin class-name">cd</span> /home/oracle/xtts
<span class="token function">unzip</span> rman_xttconvert_v3.zip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.2 配置 xtt.properties 参数 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">></span> xtt.properties <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
tablespaces=TBS_COCO,ITPUX01,ITPUX02,ITPUX03
platformid=13
dfcopydir=/home/oracle/xtts/backup
backupformat=/home/oracle/xtts/backup_incr
stageondest=/home/oracle/xtts/backup
storageondest=+DATA/coco/pdb
backupondest=/home/oracle/xtts/backup_incr
asm_home=/u01/app/19.0.0/grid
asm_sid=+ASM
parallel=3
rollparallel=2
getfileparallel=4
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.3 （可选）目标端配置临时实例用于增量备份恢复 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>xtts
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> <span class="token variable">$ORACLE_HOME</span>/dbs/init<span class="token variable">$ORACLE_SID</span>.ora</span>
db_name=xtts
compatible=19.0.0
EOF</span>

sqlplus / as sysdba
SQL<span class="token operator">></span> startup nomount<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>1.4 目标端创建连接源端的 dblink</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">public</span> <span class="token keyword">database</span> link ttslink <span class="token keyword">connect</span> <span class="token keyword">to</span> system identified <span class="token keyword">by</span> oracle
 <span class="token keyword">using</span> <span class="token string">'(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.184.145)(PORT = 1521))  ) (CONNECT_DATA = (SERVICE_NAME = coco) ) )'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>1.5 源端和目标端设置临时目录 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">TMPDIR</span><span class="token operator">=</span>/home/oracle/xtts/scripts
<span class="token punctuation">[</span>oracle@dest<span class="token punctuation">]</span>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">TMPDIR</span><span class="token operator">=</span>/home/oracle/xtts/scripts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Prepare Phase for RMAN Backup Method</p>
<p>2.1 源端生成数据文件副本至 <code>dfcopydir</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2.2 拷贝数据文件副本和 rmanconvert.cmd 文件至目标端 <code>stageondest</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> /home/oracle/xtts/backup/* oracle@dest:/home/oracle/xtts/backup
<span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/rmanconvert.cmd oracle@dest:<span class="token variable">$TMPDIR</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>2.3 目标端进行数据文件字节序转换 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-c</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Roll Forward Phase</p>
<p>3.1 源端生成增量备份文件至 <code>backupformat</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-i</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.2 拷贝增量备份文件、xttplan、tsbkupmap 至目标端 <code>stageondest</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $TMPDIR/incrbackups.txt<span class="token variable">`</span></span> oracle@dest:/home/oracle/xtts/backup
<span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/xttplan.txt oracle@des:<span class="token variable">$TMPDIR</span>
<span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="token variable">$TMPDIR</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>3.3 目标端做增量前滚 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-r</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.4 源端确定下一个增量备份的 FROM_SCN</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-s</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3.5 Repeat the Roll Forward Phase (Phase 3)</p>
</li>
<li><p>Transport Phase</p>
<p>4.1 源端将表空间置为只读模式 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'ALTER TABLESPACE'</span><span class="token operator">||</span>name<span class="token operator">||</span><span class="token string">'READ ONLY;'</span> exec_sql
 <span class="token keyword">from</span> v$<span class="token keyword">tablespace</span> <span class="token keyword">where</span> NAME <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'USERS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> tablespace_name<span class="token punctuation">,</span><span class="token keyword">status</span> <span class="token keyword">from</span> dba_tablespaces<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>4.2 重复步骤 3.1 - 3.3，做最后一次增量前滚 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-i</span>

<span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> incrbackups.txt<span class="token variable">`</span></span> oracle@dest:/home/oracle/xtts/backup

<span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/xttplan.txt oracle@dest:<span class="token variable">$TMPDIR</span>
<span class="token punctuation">[</span>oracle@source<span class="token punctuation">]</span>$ <span class="token function">scp</span> <span class="token variable">$TMPDIR</span>/tsbkupmap.txt oracle@dest:<span class="token variable">$TMPDIR</span>

<span class="token punctuation">[</span>oracle@dest<span class="token punctuation">]</span>$ <span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-r</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Import Object Metadata into Destination Database</p>
<p>5.1 目标端创建业务用户 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX01"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:98BB089CD1A16CBD4803C404C3279A570D607F667DD6E5EB7A19735B7FA6;358208C73FF2939C'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"COCO"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:37AB55E527FC21D62DEA2949499DD9D9F7EC2A5C97C9140A23ADEBB365BD;96B138098030A3C8'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX02"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:21BC086145990A7CC133F01E0D80B7548EA49DB694F44E972CEC33685168;499779BC208401AE'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX03"</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token keyword">VALUES</span> <span class="token string">'S:4C2C70077865FBFE627E08288E24FC9307DAF72DAC9C36EA9D31AE332263;CE4FDA4704D5UX00F9C'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX01"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX02"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token string">"DBA"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX03"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>5.2 目标端生成 Data Pump TTS 命令 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token variable">$ORACLE_HOME</span>/perl/bin/perl xttdriver.pl <span class="token parameter variable">-e</span>
<span class="token function">cat</span> /home/oracle/xtts/scripts/xttplugin.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5.3 迁移表空间元数据 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">impdp system/oracle@pdb <span class="token assign-left variable">directory</span><span class="token operator">=</span>DATA_PUMP_DIR <span class="token assign-left variable">logfile</span><span class="token operator">=</span>tts_imp.log <span class="token punctuation">\</span>
<span class="token assign-left variable">network_link</span><span class="token operator">=</span>ttslink <span class="token assign-left variable">transport_full_check</span><span class="token operator">=</span>no <span class="token punctuation">\</span>
<span class="token assign-left variable">exclude</span><span class="token operator">=</span>statistics <span class="token punctuation">\</span>
<span class="token assign-left variable">transport_tablespaces</span><span class="token operator">=</span>TBS_COCO,ITPUX01,ITPUX02,ITPUX03 <span class="token punctuation">\</span>
<span class="token assign-left variable">transport_datafiles</span><span class="token operator">=</span><span class="token string">'+DATA/tbs_coco_8.dbf'</span>,<span class="token string">'+DATA/itpux01_5.dbf'</span>,<span class="token string">'+DATA/itpux02_6.dbf'</span>,<span class="token string">'+DATA/itpux03_7.dbf'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>5.4 迁移存储过程、触发器、函数、包、视图、序列 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">impdp system/oracle@pdb <span class="token assign-left variable">directory</span><span class="token operator">=</span>DATA_PUMP_DIR <span class="token punctuation">\</span>
<span class="token assign-left variable">network_link</span><span class="token operator">=</span>ttslink <span class="token assign-left variable">schemas</span><span class="token operator">=</span>COCO,ITPUX01,ITPUX02,ITPUX03 <span class="token assign-left variable">content</span><span class="token operator">=</span>metadata_only <span class="token assign-left variable">exclude</span><span class="token operator">=</span>index,table <span class="token assign-left variable">parallel</span><span class="token operator">=</span><span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>5.5 导入同义词、dblink 和其他对象 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 导入公共同义词 </span>
<span class="token keyword">set</span> long <span class="token number">9999</span>
<span class="token keyword">select</span> dbms_metadata<span class="token punctuation">.</span>get_ddl<span class="token punctuation">(</span><span class="token string">'SYNONYM'</span><span class="token punctuation">,</span>SYNONYM_NAME<span class="token punctuation">,</span>OWNER<span class="token punctuation">)</span>
 <span class="token keyword">FROM</span> dba_synonyms <span class="token keyword">where</span> owner<span class="token operator">=</span><span class="token string">'PUBLIC'</span> <span class="token operator">and</span> table_owner <span class="token operator">in</span>  <span class="token punctuation">(</span><span class="token string">'COCO'</span><span class="token punctuation">,</span><span class="token string">'ITPUX01'</span><span class="token punctuation">,</span><span class="token string">'ITPUX02'</span><span class="token punctuation">,</span><span class="token string">'ITPUX03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 导入 dblink</span>
<span class="token keyword">set</span> long <span class="token number">9999</span>
<span class="token keyword">select</span> dbms_metadata<span class="token punctuation">.</span>get_ddl<span class="token punctuation">(</span><span class="token string">'DB_LINK'</span><span class="token punctuation">,</span>DB_LINK<span class="token punctuation">,</span>OWNER<span class="token punctuation">)</span> <span class="token keyword">FROM</span> DBA_DB_LINKS<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Post-migration</p>
<p>6.1 检查数据库一致性 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> owner<span class="token punctuation">,</span> object_type<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
 <span class="token keyword">from</span> dba_objects
 <span class="token keyword">where</span> object_name <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">'BIN%'</span>
 <span class="token operator">and</span> owner <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'COCO'</span><span class="token punctuation">,</span><span class="token string">'ITPUX01'</span><span class="token punctuation">,</span><span class="token string">'ITPUX02'</span><span class="token punctuation">,</span><span class="token string">'ITPUX03'</span><span class="token punctuation">)</span>
 <span class="token keyword">group</span> <span class="token keyword">by</span> owner<span class="token punctuation">,</span> object_type
 <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token keyword">desc</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>6.2 业务用户修改权限和默认表空间 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX01"</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"ITPUX01"</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TEMP"</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX02"</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"ITPUX02"</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TEMP"</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"ITPUX03"</span> EFAULT <span class="token keyword">TABLESPACE</span> <span class="token string">"ITPUX03"</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"COCO"</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TBS_COCO"</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLESPACE</span> <span class="token string">"TEMP"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> UNLIMITED <span class="token keyword">TABLESPACE</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX01"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> UNLIMITED <span class="token keyword">TABLESPACE</span> <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> UNLIMITED <span class="token keyword">TABLESPACE</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX02"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">CREATE</span> JOB <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> <span class="token string">"COCO"</span><span class="token punctuation">.</span><span class="token string">"TESTTABLE"</span> <span class="token keyword">TO</span> <span class="token string">"ITPUX01"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token string">"SYS"</span><span class="token punctuation">.</span><span class="token string">"DBA_USERS"</span> <span class="token keyword">TO</span> <span class="token string">"COCO"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>6.3 表空间置为读写模式 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token string">'ALTER TABLESPACE'</span><span class="token operator">||</span>name<span class="token operator">||</span><span class="token string">'READ WRITE;'</span> exec_sql <span class="token keyword">from</span> v$<span class="token keyword">tablespace</span>
 <span class="token keyword">where</span> NAME <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token string">'SYSAUX'</span><span class="token punctuation">,</span><span class="token string">'UNDOTBS1'</span><span class="token punctuation">,</span><span class="token string">'TEMP'</span><span class="token punctuation">,</span><span class="token string">'USERS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>6.4 校验数据文件完整性 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">RMAN<span class="token operator">></span> validate <span class="token keyword">tablespace</span> COCO<span class="token punctuation">,</span>ITPUX01<span class="token punctuation">,</span>ITPUX02<span class="token punctuation">,</span>ITPUX03 <span class="token keyword">check</span> logical<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>6.5 收集统计信息 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>gather_database_stats<span class="token punctuation">(</span>degree <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>gather_dictionary_stats<span class="token punctuation">(</span>degree <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">exec</span> dbms_stats<span class="token punctuation">.</span>gather_fixed_objects_stats<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>Overview</title>
    <url>/blog/posts/1eb5b3ed.html</url>
    <content><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>XTTS(Cross Platform Transportable Tablespaces)属于跨平台迁移表空间，它是从 Oracle 8i 开始就引入的一种基于表空间传输的物理迁移方法，命名为 TTS，经历各个版本的不断演进，从 11gR2 开始，在相对停机时间要求日益减少的情况，为了应对越来越大的数据量跨平台迁移，Oracle 推出了新的解决方案—加强版 TTS（以下简称 XTTS），XTTS 使用增量备份的方式实现跨平台的数据迁移，从真正意义上大大缩短停机时间。在 U2L 如火如荼的今天，通过 XTTS 快捷、高效、平稳、安全的将 Oracle 数据库“小型机 + 集中式存储”环境迁移至“X86 架构平台 + 分布式存储”已然成为一大神技。</p>
<p>XTTS 的发展历史：</p>
<ul>
<li>从 8i，tts 技术的诞生，引入了相同平台相同块大小之间的表空间传输。到了 9i，tts 开始支持同平台中，不同块大小的表空间传输。</li>
<li>10g 时代，不仅引入了跨平台的表空间传输方案，也就是我们说的 xtts；10gR2 开始支持传输整个数据库。</li>
<li>11gR1 开始，可以传输表空间中的某个特定分区。</li>
<li>在 11.2.0.4 开始，为了应对越来越大的数据量，而停机时间甚至还在减少的情况，出现了新的解决方案—使用增量备份方式的 xtts。</li>
</ul>
<p>XTTS 各版本的功能比对如下：<br><img src="https://s2.loli.net/2022/04/13/jlKP71yr3BCNovk.png"></p>
<p>在 Oracle11gR2（推荐使用 11.2.0.4 及之后版本）以后，Oracle 推出了通过前滚数据文件，拷贝数据后再进行多次增量备份的 XTTS 来完成迁移过程，在这个过程中通过开启块跟踪特性，根据 SCN 号来执行一系列的增量备份，并且通过对块跟踪文件的扫描，来完成增量数据的增量备份应用，最后在通过一定的停机时间，在源库 read only 的状态下进行最后一次增量备份转换应用，使得整个迁移过程的停机时间同源库数据块的变化率成正比。这样大大的缩短了停机时间。</p>
<p>为了减少正式的停机时间，oracle 在 xtts 中引入了 rman 的增量备份前滚功能。通过一次又一次的增量备份，使停应用的时间主要包含四个方面：将表空间置为只读，最后进行一次增量前滚，元数据导入，数据文件校验。和传统的表空间传输相比，通过减少数据文件的传输时间，而大大减少了整体停机时间。</p>
<h2 id="全量迁移方式"><a href="# 全量迁移方式" class="headerlink" title="全量迁移方式"></a>全量迁移方式 </h2><p> 对于 XTTS 的全量操作，Oracle 提供了 2 种方式来进行，分别如下：<br><strong>1）dbms_file_transfer(DFT)</strong> – (using xttdriver.pl -S and -G options)</p>
<p>DBMS_FILE_TRANSFER 包是 Oracle 提供的一个用于复制二进制数据库文件或在数据库之间传输二进制文件的程序包，在 XTTS 迁移中，利用不同的参数进行数据文件传输转换完成迁移。</p>
<p><strong>要求：</strong> 目标端数据库版本必须是 11.2.0.4 以及更新的版本。如果数据库版本低于 11.2.0.4(大于 Oracle10R1)，那么目标端环境，仍然需要安装 11.2.0.4 以及更新版本的临时环境，因为 XTTS 增量的核心脚本功能必须是基于 11.2.0.4(+)版本。</p>
<p>如果准备使用 DDBMS_FILE_TRANSFER 作为全量迁移方法，那么必须创建三个数据库对象：</p>
<ol>
<li>源数据库中的数据库目录对象。</li>
<li>目标数据库中的数据库目录对象，放置数据文件的位置。</li>
<li>在目标数据库中创建指向源库的数据库链接。</li>
</ol>
<p><strong>2）Recovery Manager(RMAN)</strong> – (using xttdriver.pl -p and -c options)</p>
<p>通过使用 rman-xttconvert 包提供的参数，对数据库进行基于表空间的备份，将备份产生的备份集写到本地或者 NFS 盘上，然后再通过 rman-xttconvert 包中包含的不同平台之间数据文件格式转换的包对进行数据文件格式转换，最后通过记录的表空间 FILE_ID 号生产元数据的导入脚本，通过 db_link 执行完成。</p>
<h2 id="xttdriver-pl-opation"><a href="#xttdriver-pl-opation" class="headerlink" title="xttdriver.pl opation"></a>xttdriver.pl opation</h2><p><img src="https://s2.loli.net/2022/04/13/lKSgkRhO9c3TQzI.png"></p>
<h2 id="xtt-properties-parameters"><a href="#xtt-properties-parameters" class="headerlink" title="xtt.properties parameters"></a>xtt.properties parameters</h2><p><img src="https://s2.loli.net/2022/04/13/A4IHuRxsqa8TNGv.png"></p>
<h2 id="file-description"><a href="#file-description" class="headerlink" title="file description"></a>file description</h2><ul>
<li><strong>xttplan.txt</strong> - containing the tablespace names, their current SCNs and their datafile numbers</li>
<li><strong>xttnewdatafiles.txt</strong> - containing the tablespace names, datafile numbers, the destination directory object name and the source filenames</li>
<li><strong>getfile.sql</strong> - The PL&#x2F;SQL script(formatting ours) that will be used at the destination to get the datafilesfrom the source</li>
<li><strong>xttpreparesrc.sql</strong> - the PL&#x2F;SQL scriptused to create the files in this step</li>
<li><strong>xttprepareNaNd</strong> - the command</li>
<li><strong>tsbkupmap.txt</strong> - containing the tablespace names, datafile numbers and the incremental backup pieces</li>
<li><strong>incrbackups.txt</strong> - containing the actual location of the incremental backup pieces</li>
<li><strong>rmanincrNaNd</strong> - containing the RMAN scripts used to create the incremental backups.</li>
<li><strong>xttdetnewfromscnsrc.sql</strong> - the PL&#x2F;SQLscript used to create the files in this step</li>
<li><strong>xttplan.txt.new</strong>- after the first run of’xttdriver.pl -i’ this is just a copy of the xttplan.txt</li>
</ul>
]]></content>
      <categories>
        <category>Database</category>
        <category>Oracle</category>
        <category>XTTS</category>
      </categories>
      <tags>
        <tag>overview</tag>
        <tag>xtts</tag>
      </tags>
  </entry>
  <entry>
    <title>Install MySQL on Linux</title>
    <url>/blog/posts/a792efb.html</url>
    <content><![CDATA[<h1 id="Install-MySQL-on-Linux"><a href="#Install-MySQL-on-Linux" class="headerlink" title="Install MySQL on Linux"></a>Install MySQL on Linux</h1><h2 id="Using-the-MySQL-Yum-Repository"><a href="#Using-the-MySQL-Yum-Repository" class="headerlink" title="Using the MySQL Yum Repository"></a>Using the MySQL Yum Repository</h2><ol>
<li><p>Adding the MySQL Yum Repository</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum localinstall mysql57-community-release-el7-<span class="token punctuation">&#123;</span>version-number<span class="token punctuation">&#125;</span>.noarch.rpm
<span class="token function">sudo</span> yum-config-manager <span class="token parameter variable">--enable</span> mysql57-community<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Disabling the Default MySQL Module</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum module disable mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Installing MySQL</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> mysql-community-server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Starting the MySQL Server</p>
<p>Start the MySQL server</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> mysqld <span class="token parameter variable">--now</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Get root temporary password in the error log file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Change the root password</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'MyNewPass4!'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="Using-Generic-Binaries"><a href="#Using-Generic-Binaries" class="headerlink" title="Using Generic Binaries"></a>Using Generic Binaries</h2><ol>
<li><p>Create a mysql User and Group</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">groupadd</span> mysql
<span class="token function">useradd</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-g</span> mysql <span class="token parameter variable">-s</span> /bin/false mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Obtain and Unpack the Distribution</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /usr/local
<span class="token function">tar</span> zxvf /path/to/mysql-VERSION-OS.tar.gz
<span class="token function">ln</span> <span class="token parameter variable">-s</span> full-path-to-mysql-VERSION-OS mysql
<span class="token builtin class-name">echo</span> <span class="token string">"export PATH=<span class="token environment constant">$PATH</span>:/usr/local/mysql/bin"</span> <span class="token operator">>></span> /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Create directories and grant permissions</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> mysql
<span class="token function">mkdir</span> mysql-files
<span class="token function">chmod</span> <span class="token number">750</span> mysql-files
<span class="token function">chown</span> mysql:mysql mysql-files<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Create my.cnf configuration file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> <span class="token parameter variable">-a</span> /etc/my.cnf /etc/my.cnf_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>
<span class="token function">cat</span> <span class="token operator">></span> /etc/my.cnf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[mysqld]
basedir=/usr/local/mysql
datadir=/usr/local/mysql/data
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Starting the MySQL Server</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bin/mysqld <span class="token parameter variable">--initialize</span> <span class="token parameter variable">--user</span><span class="token operator">=</span>mysql <span class="token parameter variable">--basedir</span><span class="token operator">=</span>/usr/local/mysql <span class="token parameter variable">--datadir</span><span class="token operator">=</span>/usr/local/mysql/data
bin/mysql_ssl_rsa_setup
bin/mysqld_safe <span class="token parameter variable">--user</span><span class="token operator">=</span>mysql <span class="token operator">&amp;</span>

<span class="token comment"># Next command is optional</span>
<span class="token comment"># cp support-files/mysql.server /etc/init.d/mysql.server</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="Using-Source"><a href="#Using-Source" class="headerlink" title="Using Source"></a>Using Source</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Preconfiguration setup</span>
$<span class="token operator">></span> <span class="token function">groupadd</span> mysql
$<span class="token operator">></span> <span class="token function">useradd</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-g</span> mysql <span class="token parameter variable">-s</span> /bin/false mysql
<span class="token comment"># Beginning of source-build specific instructions</span>
$<span class="token operator">></span> <span class="token function">tar</span> zxvf mysql-VERSION.tar.gz
$<span class="token operator">></span> <span class="token builtin class-name">cd</span> mysql-VERSION
$<span class="token operator">></span> <span class="token function">mkdir</span> bld
$<span class="token operator">></span> <span class="token builtin class-name">cd</span> bld
$<span class="token operator">></span> cmake <span class="token punctuation">..</span>
$<span class="token operator">></span> <span class="token function">make</span>
$<span class="token operator">></span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token comment"># End of source-build specific instructions</span>
<span class="token comment"># Postinstallation setup</span>
$<span class="token operator">></span> <span class="token builtin class-name">cd</span> /usr/local/mysql
$<span class="token operator">></span> <span class="token function">mkdir</span> mysql-files
$<span class="token operator">></span> <span class="token function">chown</span> mysql:mysql mysql-files
$<span class="token operator">></span> <span class="token function">chmod</span> <span class="token number">750</span> mysql-files
$<span class="token operator">></span> bin/mysqld <span class="token parameter variable">--initialize</span> <span class="token parameter variable">--user</span><span class="token operator">=</span>mysql
$<span class="token operator">></span> bin/mysql_ssl_rsa_setup
$<span class="token operator">></span> bin/mysqld_safe <span class="token parameter variable">--user</span><span class="token operator">=</span>mysql <span class="token operator">&amp;</span>
<span class="token comment"># Next command is optional</span>
$<span class="token operator">></span> <span class="token function">cp</span> support-files/mysql.server /etc/init.d/mysql.server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Installation</category>
      </categories>
      <tags>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Configure Docker to start on boot with systemd</title>
    <url>/blog/posts/7f2e2fe4.html</url>
    <content><![CDATA[<h1 id="Configure-Docker-to-start-on-boot-with-systemd"><a href="#Configure-Docker-to-start-on-boot-with-systemd" class="headerlink" title="Configure Docker to start on boot with systemd"></a>Configure Docker to start on boot with systemd</h1><ol>
<li><p>Add a systemd service unit configuration file with details about the MySQL service</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$<span class="token operator">></span> <span class="token builtin class-name">cd</span> /usr/lib/systemd/system
$<span class="token operator">></span> <span class="token function">touch</span> mysqld.service
$<span class="token operator">></span> <span class="token function">chmod</span> <span class="token number">644</span> mysqld.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Add this configuration information to the mysqld.service file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>MySQL Server
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>man:mysqld<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token assign-left variable">Documentation</span><span class="token operator">=</span>http://dev.mysql.com/doc/refman/en/using-systemd.html
<span class="token assign-left variable">After</span><span class="token operator">=</span>network.target
<span class="token assign-left variable">After</span><span class="token operator">=</span>syslog.target
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">User</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">Group</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">Type</span><span class="token operator">=</span>forking
<span class="token assign-left variable">PIDFile</span><span class="token operator">=</span>/usr/local/mysql/data/mysqld.pid

<span class="token comment"># Disable service start and stop timeout logic of systemd for mysqld service.</span>
<span class="token assign-left variable">TimeoutSec</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token comment"># Start main service</span>
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/mysql/bin/mysqld --defaults-file<span class="token operator">=</span>/etc/my.cnf <span class="token parameter variable">--daemonize</span> --pid-file<span class="token operator">=</span>/usr/local/mysql/data/mysqld.pid <span class="token variable">$MYSQLD_OPTS</span>

<span class="token comment"># Use this to switch malloc implementation</span>
<span class="token assign-left variable">EnvironmentFile</span><span class="token operator">=</span>-/etc/sysconfig/mysql

<span class="token comment"># Sets open_files_limit</span>
LimitNOFILE <span class="token operator">=</span> <span class="token number">5000</span>
<span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure
<span class="token assign-left variable">RestartPreventExitStatus</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">PrivateTmp</span><span class="token operator">=</span>false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Add a configuration file for the systemd tmpfiles feature</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$<span class="token operator">></span> <span class="token builtin class-name">cd</span> /usr/lib/tmpfiles.d
$<span class="token operator">></span> <span class="token function">touch</span> mysql.conf
$<span class="token operator">></span> <span class="token function">chmod</span> <span class="token number">644</span> mysql.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Add this configuration information to the mysql.conf file</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">d /usr/local/mysql/data 0750 mysql mysql -<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Enable the mysqld service to automatically start at reboot</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> mysqld.service <span class="token parameter variable">--now</span>
systemctl status mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>systemd</tag>
      </tags>
  </entry>
  <entry>
    <title>LVM Snapshot</title>
    <url>/blog/posts/871b8dc0.html</url>
    <content><![CDATA[<h1 id="LVM-Snapshot"><a href="#LVM-Snapshot" class="headerlink" title="LVM Snapshot"></a>LVM Snapshot</h1><ol>
<li> 数据库全局读锁 <br>flush tables with read lock;</li>
<li>LVM 快照 <br>lvcreate -L 500M -s -n mysql-snap &#x2F;dev&#x2F;datavg&#x2F;mysql-snap<br>mysql -uroot -p‘Jove@123’ -e ‘show master status’ &gt; &#x2F;backup&#x2F;<code>date +%F</code>_position.log</li>
<li> 释放全局读锁（关闭全局锁会话时，锁将自动失效）<br>unlock tables;</li>
<li> 挂载快照卷（只读）</li>
<li> 从快照卷中复制数据（cp&#x2F;tar）</li>
<li> 卸载并删除快照卷 </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#! /bin/bash</span>
<span class="token comment"># LVM Snapshot for mysql backup</span>

<span class="token assign-left variable">backup_dir</span><span class="token operator">=</span>/backup/<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>
<span class="token punctuation">[</span> <span class="token parameter variable">-d</span> <span class="token variable">$backup_dir</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$backup_dir</span>

<span class="token builtin class-name">echo</span> <span class="token string">"FLUSH TABLES WITH READ LOCK; \
SYSTEM lvcreate -L 500M -s -n mysql-snap /dev/datavg/mysql; \
SHOW MASTER STATUS; \
UNLOCK TABLES;"</span> <span class="token operator">|</span> mysql <span class="token parameter variable">-uroot</span> -p<span class="token string">'welcome@123'</span> <span class="token operator">></span> <span class="token variable">$backup_dir</span>/backup.log

<span class="token comment"># nouuid, for xfs</span>
<span class="token function">mount</span> <span class="token parameter variable">-o</span> ro,nouuid /dev/datavg/mysql-snap /mnt

<span class="token function">rsync</span> <span class="token parameter variable">-a</span> /mnt/ <span class="token variable">$backup_dir</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token function">umount</span> /mnt
  lvremove <span class="token parameter variable">-f</span> /dev/datavg/mysql-snap
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>backup</tag>
        <tag>snapshot</tag>
      </tags>
  </entry>
  <entry>
    <title>Import and Export</title>
    <url>/blog/posts/a703d20e.html</url>
    <content><![CDATA[<h1 id="Import-and-Export"><a href="#Import-and-Export" class="headerlink" title="Import and Export"></a>Import and Export</h1><ol>
<li>outfile 命令导出表数据 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> @<span class="token variable">@secure_file_priv</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> wiki<span class="token punctuation">.</span>table1 <span class="token keyword">INTO</span> <span class="token keyword">OUTFILE</span> <span class="token string">'/var/lib/mysql-files/wiki_table1'</span>
 <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'---'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>mysql 命令导出表数据 </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-ujove</span> <span class="token parameter variable">-pjove</span> <span class="token parameter variable">-e</span> <span class="token string">'select * from wiki.table1'</span> <span class="token operator">></span> /backup/wiki_table1
mysql <span class="token parameter variable">-ujove</span> <span class="token parameter variable">-pjove</span> <span class="token parameter variable">--xml</span> <span class="token parameter variable">-e</span> <span class="token string">'select * from wiki.table1'</span> <span class="token operator">></span> /backup/wiki_table1.xml
mysql <span class="token parameter variable">-ujove</span> <span class="token parameter variable">-pjove</span> <span class="token parameter variable">--html</span> <span class="token parameter variable">-e</span> <span class="token string">'select * from wiki.table1'</span> <span class="token operator">></span> /backup/wiki_table1.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li> 备份表结构 </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqldump <span class="token parameter variable">-ujove</span> <span class="token parameter variable">-pjove</span> <span class="token parameter variable">-d</span> wiki table1 <span class="token operator">></span> /backup/wiki_table1.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Restore"><a href="#Restore" class="headerlink" title="Restore"></a>Restore</h2><ol>
<li> 先使用 mysqldump 恢复表结构 </li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-ujove</span> <span class="token parameter variable">-pjove</span> wiki <span class="token operator">&lt;</span> /backup/wiki_table1.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li> 导入数据 </li>
</ol>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">INFILE</span> <span class="token string">'/backup/wiki_table1'</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> <span class="token string">'/var/lib/mysql-files/wiki.table1'</span>
 <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">'---'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>import</tag>
        <tag>export</tag>
      </tags>
  </entry>
  <entry>
    <title>Manage Docker as a non-root user</title>
    <url>/blog/posts/19ab1444.html</url>
    <content><![CDATA[<h1 id="Manage-Docker-as-a-non-root-user"><a href="#Manage-Docker-as-a-non-root-user" class="headerlink" title="Manage Docker as a non-root user"></a>Manage Docker as a non-root user</h1><p>To create the docker group and add your user:</p>
<ol>
<li><p>Create the docker group.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">groupadd</span> <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Add your user to the docker group.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">docker</span> <span class="token environment constant">$USER</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Log out and log back in so that your group membership is re-evaluated.</p>
<div class="note info modern"><p>If you’re running Linux in a virtual machine, it may be necessary to restart the virtual machine for changes to take effect.</p>
</div>
</li>
<li><p>You can also run the following command to activate the changes to groups:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">newgrp <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Verify that you can run docker commands without sudo.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>non-root</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqldump</title>
    <url>/blog/posts/fdedf5dc.html</url>
    <content><![CDATA[<h1 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqldump <span class="token parameter variable">-uroot</span> -p<span class="token string">'welcome'</span> <span class="token punctuation">\</span>
--all-databases <span class="token punctuation">\</span>
--single-transaction <span class="token punctuation">\</span>
<span class="token parameter variable">--routines</span> <span class="token punctuation">\</span>
--source-data<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
--flush-logs <span class="token operator">></span> backup.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>-A, –all-databases</strong>    Dump all the databases.<br><strong>-B, –databases</strong>        Dump several databases.<br><strong>-E, –events</strong>           Dump events.<br><strong>-F, –flush-logs</strong>       Flush logs file in server before starting dump.<br><strong>-R, –routines</strong>         Dump stored routines (functions and procedures).<br><strong>–triggers</strong>             Dump triggers for each dumped table. (Defaults to on)<br><strong>–source-data[&#x3D;#]</strong>      This causes the binary log position and filename to be appended to the output.<br><strong>–single-transaction</strong>   Creates a consistent snapshot by dumping all tables in a single transaction.<br><strong>-d, –no-data</strong>          No row information.</p>
</blockquote>
<h2 id="Restore"><a href="#Restore" class="headerlink" title="Restore"></a>Restore</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 设置不记录 binlog 日志 </span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'1i set sql_log_bin=0;'</span> backup.sql

mysql <span class="token parameter variable">-uroot</span> -p<span class="token string">'welcome@123'</span> <span class="token operator">&lt;</span> backup.sql
mysqlbinlog --start-position<span class="token operator">=</span><span class="token number">154</span> binlog.00003 binlog.00004 <span class="token operator">|</span> mysql <span class="token parameter variable">-uroot</span> -p<span class="token string">'welcome@123'</span>
systemctl restart mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>–stop-position, –start-position 误删除时，可以用来跳过误删除语句 </p>
</blockquote>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>backup</tag>
      </tags>
  </entry>
  <entry>
    <title>Resetting Root Password</title>
    <url>/blog/posts/e24cfc6c.html</url>
    <content><![CDATA[<h1 id="Resetting-Root-Password"><a href="#Resetting-Root-Password" class="headerlink" title="Resetting Root Password"></a>Resetting Root Password</h1><h2 id="MySQL-5-7-6-and-later"><a href="#MySQL-5-7-6-and-later" class="headerlink" title="MySQL 5.7.6 and later"></a>MySQL 5.7.6 and later</h2><ol>
<li><p>Modify my.cnf, append <code>skip-grant-tables</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/my.cnf
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
skip-grant-tables<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Restart mysql server, update root password</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>host<span class="token punctuation">,</span>authentication_string <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">set</span> authentication_string<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'Jove!123'</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h2 id="MySQL-5-7-5-and-earlier"><a href="#MySQL-5-7-5-and-earlier" class="headerlink" title="MySQL 5.7.5 and earlier"></a>MySQL 5.7.5 and earlier</h2><ol>
<li><p>Modify my.cnf, append <code>skip-grant-tables</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/my.cnf
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
skip-grant-tables<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Restart mysql server, update root password</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>host<span class="token punctuation">,</span>password <span class="token keyword">from</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">set</span> password<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'Jove!123'</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'root'</span> <span class="token operator">and</span> host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>password</tag>
      </tags>
  </entry>
  <entry>
    <title>ERROR 2059 (HY000)</title>
    <url>/blog/posts/457efc6c.html</url>
    <content><![CDATA[<h1 id="ERROR-2059-HY000"><a href="#ERROR-2059-HY000" class="headerlink" title="ERROR 2059 (HY000)"></a>ERROR 2059 (HY000)</h1><h2 id="SYMPTOMS"><a href="#SYMPTOMS" class="headerlink" title="SYMPTOMS"></a>SYMPTOMS</h2><p>客户端远程连接数据库时出现验证错误</p>
<p><font color=error>ERROR 2059 (HY000): Authentication plugin ‘caching_sha2_password’ cannot be loaded: No such file or directory</font></p>
<h2 id="CASE"><a href="#CASE" class="headerlink" title="CASE"></a>CASE</h2><p>该原因是 MySQL8 以后，加密规则是<strong>caching_sha2_password</strong>，MySQL8 以前加密规则是<strong>mysql_native_password</strong></p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><ol>
<li><p>修改 <code>my.cnf</code> 文件，将加密规则改为<code>mysql_native_password</code>，重启服务</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/\[mysqld\]/a default_authentication_plugin=mysql_native_password'</span> my.cnf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>重置密码，刷新权限</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> identified <span class="token keyword">by</span> <span class="token string">'new_pass'</span> password expire never<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> identified <span class="token keyword">with</span> mysql_native_password <span class="token keyword">by</span> <span class="token string">'new_pass'</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>xtarbackup</title>
    <url>/blog/posts/42df2eeb.html</url>
    <content><![CDATA[<h1 id="xtarbackup"><a href="#xtarbackup" class="headerlink" title="xtarbackup"></a>xtarbackup</h1><h2 id="Full-Backup"><a href="#Full-Backup" class="headerlink" title="Full Backup"></a>Full Backup</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 备份 </span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /xtarbackup/full
innobackupex <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'welcome@123'</span> /xtarbackup/full

<span class="token comment"># 停止 MySQL 服务，删除数据 </span>
systemctl stop mysqld
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/mysql/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/log/mysqld.log
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/log/mysql-slow/slow.log

<span class="token comment"># 备份还原 </span>
innobackupex --apply-log /xtarbackup/full/2022-01-01_00-00-00
innobackupex --copy-back /xtarbackup/full/2022-01-01_00-00-00 /var/lib/mysql
<span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql.mysql /var/lib/mysql
systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Incremental-Backup"><a href="#Incremental-Backup" class="headerlink" title="Incremental Backup"></a>Incremental Backup</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 增量备份 </span>
innobackupex <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'welcome@123'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--incremental</span> /xtarbackup/incr/ <span class="token punctuation">\</span>
--incremental-basedir<span class="token operator">=</span>/xtarbackup/full/2022-01-01_00-00-00/
innobackupex <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'welcome@123'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--incremental</span> /xtarbackup/incr/ <span class="token punctuation">\</span>
--incremental-basedir<span class="token operator">=</span>/xtarbackup/full/2022-01-02_00-00-00/

<span class="token comment"># 停止 MySQL 服务，删除数据 </span>
systemctl stop mysqld
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/mysql/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/log/mysqld.log
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/log/mysql-slow/slow.log

<span class="token comment"># 备份还原 </span>
innobackupex --apply-log --redo-only /xtarbackup/full/2022-01-01_00-00-00/
innobackupex --apply-log --redo-only /xtarbackup/full/2022-01-01_00-00-00/ <span class="token punctuation">\</span>
--increment-dir<span class="token operator">=</span>/xtarbackup/incr/2022-01-02_00-00-00
innobackupex --apply-log --redo-only /xtarbackup/full/2022-01-01_00-00-00/ <span class="token punctuation">\</span>
--increment-dir<span class="token operator">=</span>/xtarbackup/incr/2022-01-03_00-00-00
innobackupex --copy-back /xtarbackup/full/2022-01-01_00-00-00 /var/lib/mysql
<span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql.mysql /var/lib/mysql
systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Differential-Backup"><a href="#Differential-Backup" class="headerlink" title="Differential Backup"></a>Differential Backup</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 差异备份 </span>
innobackupex <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'welcome@123'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--incremental</span> /xtarbackup/incr/ <span class="token punctuation">\</span>
--incremental-basedir<span class="token operator">=</span>/xtarbackup/full/2022-01-01_00-00-00/
innobackupex <span class="token parameter variable">--user</span><span class="token operator">=</span>root <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">'welcome@123'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--incremental</span> /xtarbackup/incr/ <span class="token punctuation">\</span>
--incremental-basedir<span class="token operator">=</span>/xtarbackup/full/2022-01-01_00-00-00/

<span class="token comment"># 停止 MySQL 服务，删除数据 </span>
systemctl stop mysqld
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/mysql/*
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/log/mysqld.log
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/log/mysql-slow/slow.log

<span class="token comment"># 备份还原 </span>
innobackupex --apply-log --redo-only /xtarbackup/full/2022-01-01_00-00-00/
innobackupex --apply-log --redo-only /xtarbackup/full/2022-01-01_00-00-00/ <span class="token punctuation">\</span>
--increment-dir<span class="token operator">=</span>/xtarbackup/incr/2022-01-03_00-00-00
innobackupex --copy-back /xtarbackup/full/2022-01-01_00-00-00 /var/lib/mysql
<span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql.mysql /var/lib/mysql
systemctl start mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Configuration</category>
      </categories>
      <tags>
        <tag>backup</tag>
      </tags>
  </entry>
  <entry>
    <title>Master-Slave</title>
    <url>/blog/posts/af57fbee.html</url>
    <content><![CDATA[<h1 id="Master-Slave"><a href="#Master-Slave" class="headerlink" title="Master-Slave"></a>Master-Slave</h1><img title=""src="https://ts1.cn.mm.bing.net/th/id/R-C.52a1882b25369545d3569c139f02bf00?rik=RPtBsPhVhLNOIQ&riu=http%3a%2f%2fwww.uml.org.cn%2fsjjm%2fimages%2f201801164.png&ehk=B%2bg7sTMQQeK4835uI5NezJkIvmRY1K1d%2bCuNtpi7uE4%3d&risl=&pid=ImgRaw&r=0"alt="" width="700" data-align="center">

<ol>
<li><p> 主库将数据变更（DML&#x2F;DCL&#x2F;DDL)，记录到二进制日志（Binary Log）中；</p>
</li>
<li><p> 备库 IO 线程读取主库的日志，复制到自己的中继日志（Relay Log）中；</p>
</li>
<li><p> 备库 SQL 线程读取中继日志中的事务，将其重放到备库。</p>
</li>
</ol>
<h2 id="Procedure"><a href="#Procedure" class="headerlink" title="Procedure"></a>Procedure</h2><ol>
<li><p> 主库开启二进制日志，设置 server-id</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> master.cnf
<span class="token punctuation">[</span>myaqld<span class="token punctuation">]</span>
<span class="token punctuation">..</span>.
log-bin
service-id<span class="token operator">=</span><span class="token number">1</span>

systemctl restart mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 主库授予复制权限 </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'rep'</span><span class="token variable">@'172.17.0.%'</span> identified <span class="token keyword">by</span> <span class="token string">'welcome'</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">replication</span> slave<span class="token punctuation">,</span> <span class="token keyword">replication</span> client <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'rep'</span><span class="token variable">@'172.17.0.%'</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p> 主库备份数据 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqldump <span class="token parameter variable">-uroot</span> -p<span class="token string">'welcome'</span> <span class="token punctuation">\</span>
--all-databases <span class="token punctuation">\</span>
--single-transaction <span class="token punctuation">\</span>
<span class="token parameter variable">--routines</span> <span class="token punctuation">\</span>
--source-data<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
--flush-logs <span class="token operator">></span> backup<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%F<span class="token variable">`</span></span>.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Replication</category>
      </categories>
      <tags>
        <tag>replication</tag>
      </tags>
  </entry>
  <entry>
    <title>MY-011906</title>
    <url>/blog/posts/c63d3465.html</url>
    <content><![CDATA[<h1 id="MY-011906"><a href="#MY-011906" class="headerlink" title="MY-011906"></a>MY-011906</h1><h2 id="SYMTOMS"><a href="#SYMTOMS" class="headerlink" title="SYMTOMS"></a>SYMTOMS</h2><p>MySQL8 服务器意外掉电，MySQL 启动时报错：</p>
<p><font color=error>InnoDB: End of page dump<br>InnoDB: Page may be an update undo log page<br>2021-02-10T14:22:14.800611Z 0 [ERROR] [MY-011906] [InnoDB] Database page corruption on disk or a failed file read of page [page id: space&#x3D;4294967279, page number&#x3D;611]. You may have to recover from a backup. </font></p>
<h2 id="SOLUTION"><a href="#SOLUTION" class="headerlink" title="SOLUTION"></a>SOLUTION</h2><ol>
<li><p>添加 <code>innodb_force_recovery</code> 参数，重新启动数据库进入恢复模式</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
innodb_force_recovery <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ol>
<blockquote>
<p><strong>1 (SRV_FORCE_IGNORE_CORRUPT)</strong>: 忽略检查到的 corrupt 页。尽管检测到了损坏的 page 仍强制服务运行。一般设置为该值即可，然后 dump 出库表进行重建。<br><strong>2 (SRV_FORCE_NO_BACKGROUND)</strong>: 阻止主线程的运行，如主线程需要执行 full purge 操作，会导致 crash。 阻止 master thread 和任何 purge thread 运行。若 crash 发生在 purge 环节则使用该值。<br><strong>3 (SRV_FORCE_NO_TRX_UNDO)</strong>: 不执行事务回滚操作。<br><strong>4 (SRV_FORCE_NO_IBUF_MERGE)</strong>: 不执行插入缓冲的合并操作。如果可能导致崩溃则不要做这些操作。不要进行统计操作。该值可能永久损坏数据文件。若使用了该值，则将来要删除和重建辅助索引。<br><strong>5 (SRV_FORCE_NO_UNDO_LOG_SCAN)</strong>: 不查看重做日志，InnoDB 存储引擎会将未提交的事务视为已提交。此时 InnoDB 甚至把未完成的事务按照提交处理。该值可能永久性的损坏数据文件。<br><strong>6 (SRV_FORCE_NO_LOG_REDO)</strong>: 不执行前滚的操作。恢复时不做 redo log roll-forward。使数据库页处于废止状态，继而可能引起 B 树或者其他数据库结构更多的损坏。</p>
</blockquote>
<ol start="2">
<li><p>备份所有数据库</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p123456</span> --all-databases <span class="token operator">></span> /backup/all-databases.sql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>清除原数据库文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl stop mysqld
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/mysql/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>重新初始化数据库</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqld  --initialize-insecure <span class="token parameter variable">--user</span><span class="token operator">=</span>mysql
systemctl restart mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>恢复数据库</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p123456</span> <span class="token operator">&lt;</span> /backup/all-databases.sql
systemctl restart mysqld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title>Percona XtraDB Cluster</title>
    <url>/blog/posts/cab61332.html</url>
    <content><![CDATA[<h1 id="Percona-XtraDB-Cluster"><a href="#Percona-XtraDB-Cluster" class="headerlink" title="Percona XtraDB Cluster"></a>Percona XtraDB Cluster</h1><h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples:"></a>Examples:</h2><table>
<thead>
<tr>
<th>Node</th>
<th>Host</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>Node 1</td>
<td>node1.localhost</td>
<td>192.168.184.161</td>
</tr>
<tr>
<td>Node 2</td>
<td>node2.localhost</td>
<td>192.168.184.162</td>
</tr>
<tr>
<td>Node 3</td>
<td>node3.localhost</td>
<td>192.168.184.163</td>
</tr>
</tbody></table>
<h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>Make sure that the following ports are not blocked by firewall or used by other software. Percona XtraDB<br>Cluster requires them for communication.<br>• 3306<br>• 4444<br>• 4567<br>• 4568</p>
<p>The SELinux security module can constrain access to data for Percona XtraDB Cluster. The best solution is to<br>change the mode from enforcing to permissive by running the following command:<br><code>setenforce 0</code></p>
<p><code>sed -i &#39;s/^SELINUX=.*/SELINUX=disabled/&#39; /etc/selinux/config</code></p>
<h2 id="Installing-from-Percona-Repository"><a href="#Installing-from-Percona-Repository" class="headerlink" title="Installing from Percona Repository"></a>Installing from Percona Repository</h2><ol>
<li><p>Configure Percona repositories</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> https://repo.percona.com/yum/percona-release-latest.noarch.rpm
<span class="token function">sudo</span> percona-release setup <span class="token operator">&lt;</span>PRODUCT<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Install the Percona XtraDB Cluster packages</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> Percona-XtraDB-Cluster-57<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Start the Percona XtraDB Cluster server</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Copy the automatically generated temporary password for the superuser account</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Use this password to log in as root</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Change the password for the superuser account and log out. For example</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'welcome'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>Stop the mysql service</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl stop mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="CONFIGURING-NODES-FOR-WRITE-SET-REPLICATION"><a href="#CONFIGURING-NODES-FOR-WRITE-SET-REPLICATION" class="headerlink" title="CONFIGURING NODES FOR WRITE-SET REPLICATION"></a>CONFIGURING NODES FOR WRITE-SET REPLICATION</h2><p>If you are running Red Hat or CentOS, modify the following configuration variables to <code>/etc/percona-xtradb-cluster.conf.d/wsrep.cnf</code> on the first node:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">wsrep_provider</span><span class="token operator">=</span>/usr/lib64/galera3/libgalera_smm.so
<span class="token assign-left variable">wsrep_cluster_name</span><span class="token operator">=</span>pxc-cluster
<span class="token assign-left variable">wsrep_cluster_address</span><span class="token operator">=</span>gcomm://192.168.184.161,192.168.184.162,192.168.184.163
<span class="token assign-left variable">wsrep_node_name</span><span class="token operator">=</span>pxc1
<span class="token assign-left variable">wsrep_node_address</span><span class="token operator">=</span><span class="token number">192.168</span>.184.161
<span class="token assign-left variable">wsrep_sst_method</span><span class="token operator">=</span>xtrabackup-v2
<span class="token assign-left variable">wsrep_sst_auth</span><span class="token operator">=</span>sstuser:passw0rd
<span class="token assign-left variable">pxc_strict_mode</span><span class="token operator">=</span>ENFORCING
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>ROW
<span class="token assign-left variable">default_storage_engine</span><span class="token operator">=</span>InnoDB
<span class="token assign-left variable">innodb_autoinc_lock_mode</span><span class="token operator">=</span><span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Use the same configuration for the second and third nodes, except the <code>wsrep_node_name</code> and <code>wsrep_node_address</code> variables:</p>
<ul>
<li><p>For the second node:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">wsrep_node_name</span><span class="token operator">=</span>pxc2
<span class="token assign-left variable">wsrep_node_address</span><span class="token operator">=</span><span class="token number">192.168</span>.184.162<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>For the second node:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">wsrep_node_name</span><span class="token operator">=</span>pxc3
<span class="token assign-left variable">wsrep_node_address</span><span class="token operator">=</span><span class="token number">192.168</span>.184.163<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
<p>Modify the following configuration variables to <code>/etc/percona-xtradb-cluster.conf.d/mysqld.cnf</code> on the all nodes.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>client<span class="token punctuation">]</span>
<span class="token assign-left variable">socket</span><span class="token operator">=</span>/data/mysql.sock

<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span>mysql
server-id<span class="token operator">=</span><span class="token number">161</span>  <span class="token comment"># node2: 162, node3: 163</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable">datadir</span><span class="token operator">=</span>/data
<span class="token assign-left variable">socket</span><span class="token operator">=</span>/data/mysql.sock
log-error<span class="token operator">=</span>/data/mysqld.log
pid-file<span class="token operator">=</span>/data/mysqld.pid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="BOOTSTRAPPING-THE-FIRST-NODE"><a href="#BOOTSTRAPPING-THE-FIRST-NODE" class="headerlink" title="BOOTSTRAPPING THE FIRST NODE"></a>BOOTSTRAPPING THE FIRST NODE</h2><p>Start the first node with the following command on RedHat or CentOS:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start mysql@bootstrap.service</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>To make sure that the cluster has been initialized, run the following:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@node1</span><span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'wsrep%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token operator">|</span> Variable_name                    <span class="token operator">|</span> <span class="token keyword">Value</span>                                                          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token operator">|</span> wsrep_local_state_uuid           <span class="token operator">|</span> b3d61b95<span class="token operator">-</span><span class="token number">0</span>f21<span class="token operator">-</span><span class="token number">11</span>ed<span class="token operator">-</span>a626<span class="token operator">-</span>e3a8b0be03b3                           <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_local_state                <span class="token operator">|</span> <span class="token number">4</span>                                                              <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_local_state_comment        <span class="token operator">|</span> Synced                                                         <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_cluster_size               <span class="token operator">|</span> <span class="token number">1</span>                                                              <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_cluster_state_uuid         <span class="token operator">|</span> b3d61b95<span class="token operator">-</span><span class="token number">0</span>f21<span class="token operator">-</span><span class="token number">11</span>ed<span class="token operator">-</span>a626<span class="token operator">-</span>e3a8b0be03b3                           <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_cluster_status             <span class="token operator">|</span> <span class="token keyword">Primary</span>                                                        <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_connected                  <span class="token operator">|</span> <span class="token keyword">ON</span>                                                             <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_ready                      <span class="token operator">|</span> <span class="token keyword">ON</span>                                                             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token number">75</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Create a user for SST and provide the necessary privileges for that user account:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@node1</span><span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'sstuser'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'passw0rd'</span><span class="token punctuation">;</span>
mysql<span class="token variable">@node1</span><span class="token operator">></span> <span class="token keyword">GRANT</span> RELOAD<span class="token punctuation">,</span> <span class="token keyword">LOCK</span> <span class="token keyword">TABLES</span><span class="token punctuation">,</span> PROCESS<span class="token punctuation">,</span> <span class="token keyword">REPLICATION</span> CLIENT <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'sstuser'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span>
mysql<span class="token variable">@node1</span><span class="token operator">></span> FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="Starting-the-Second-Node"><a href="#Starting-the-Second-Node" class="headerlink" title="Starting the Second Node"></a>Starting the Second Node</h2><p>Start the second node by using either of the following commands:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@node2 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start mysql</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>After the server starts, it should receive SST automatically.<br>To check the status of the second node, run the following:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@node2</span><span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'wsrep%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token operator">|</span> Variable_name                    <span class="token operator">|</span> <span class="token keyword">Value</span>                                                          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token operator">|</span> wsrep_local_state_uuid           <span class="token operator">|</span> b3d61b95<span class="token operator">-</span><span class="token number">0</span>f21<span class="token operator">-</span><span class="token number">11</span>ed<span class="token operator">-</span>a626<span class="token operator">-</span>e3a8b0be03b3                           <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_local_state                <span class="token operator">|</span> <span class="token number">4</span>                                                              <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_local_state_comment        <span class="token operator">|</span> Synced                                                         <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_cluster_size               <span class="token operator">|</span> <span class="token number">2</span>                                                              <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_cluster_state_uuid         <span class="token operator">|</span> b3d61b95<span class="token operator">-</span><span class="token number">0</span>f21<span class="token operator">-</span><span class="token number">11</span>ed<span class="token operator">-</span>a626<span class="token operator">-</span>e3a8b0be03b3                           <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_cluster_status             <span class="token operator">|</span> <span class="token keyword">Primary</span>                                                        <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_connected                  <span class="token operator">|</span> <span class="token keyword">ON</span>                                                             <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_ready                      <span class="token operator">|</span> <span class="token keyword">ON</span>                                                             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token number">75</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Starting-the-Third-Node"><a href="#Starting-the-Third-Node" class="headerlink" title="Starting the Third Node"></a>Starting the Third Node</h2><p>Start the second node by using either of the following commands:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@node3 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start mysql</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>After the server starts, it should receive SST automatically.<br>To check the status of the second node, run the following:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@node3</span><span class="token operator">></span> <span class="token keyword">show</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'wsrep%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token operator">|</span> Variable_name                    <span class="token operator">|</span> <span class="token keyword">Value</span>                                                          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token operator">|</span> wsrep_local_state_uuid           <span class="token operator">|</span> b3d61b95<span class="token operator">-</span><span class="token number">0</span>f21<span class="token operator">-</span><span class="token number">11</span>ed<span class="token operator">-</span>a626<span class="token operator">-</span>e3a8b0be03b3                           <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_local_state                <span class="token operator">|</span> <span class="token number">4</span>                                                              <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_local_state_comment        <span class="token operator">|</span> Synced                                                         <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_cluster_size               <span class="token operator">|</span> <span class="token number">3</span>                                                              <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_cluster_state_uuid         <span class="token operator">|</span> b3d61b95<span class="token operator">-</span><span class="token number">0</span>f21<span class="token operator">-</span><span class="token number">11</span>ed<span class="token operator">-</span>a626<span class="token operator">-</span>e3a8b0be03b3                           <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_cluster_status             <span class="token operator">|</span> <span class="token keyword">Primary</span>                                                        <span class="token operator">|</span>
<span class="token operator">|</span> wsrep_connected                  <span class="token operator">|</span> <span class="token keyword">ON</span>                                                             <span class="token operator">|</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">|</span> wsrep_ready                      <span class="token operator">|</span> <span class="token keyword">ON</span>                                                             <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------------------+----------------------------------------------------------------+</span>
<span class="token number">75</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="VERIFYING-REPLICATION"><a href="#VERIFYING-REPLICATION" class="headerlink" title="VERIFYING REPLICATION"></a>VERIFYING REPLICATION</h2><p>Use the following procedure to verify replication by creating a new database on the second node, creating a table for that database on the third node, and adding some records to the table on the first node.</p>
<ol>
<li><p>Create a new database on the second node:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@node2</span><span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> percona<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Create a table on the third node:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@node3</span><span class="token operator">></span> <span class="token keyword">USE</span> percona<span class="token punctuation">;</span>
<span class="token keyword">Database</span> changed
mysql<span class="token variable">@node3</span><span class="token operator">></span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> example <span class="token punctuation">(</span>node_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> node_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Insert records on the first node:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@node1</span><span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> percona<span class="token punctuation">.</span>example <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'percona1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>Retrieve rows from that table on the second node:</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token variable">@pxc2</span><span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> percona<span class="token punctuation">.</span>example<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+</span>
<span class="token operator">|</span> node_id <span class="token operator">|</span> node_name <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+</span>
<span class="token operator">|</span>    <span class="token number">1</span>    <span class="token operator">|</span> percona1  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+-----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
]]></content>
      <categories>
        <category>Database</category>
        <category>MySQL</category>
        <category>Replication</category>
      </categories>
      <tags>
        <tag>replication</tag>
      </tags>
  </entry>
</search>
